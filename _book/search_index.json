[
["-.html", "Глава 3 Предварительный анализ 3.1 Введение 3.2 Первые шаги 3.3 Эстетика визуализации 3.4 Панели 3.5 Геометрические объекты", " Глава 3 Предварительный анализ 3.1 Введение Электронная версия книги по адресу http://r4ds.had.co.nz. Для начала работы подключаем библиотеку library(&quot;tidyverse&quot;) Не было упражнений. 3.2 Первые шаги Упражнение 3.2.1 Run ggplot(data = mpg) what do you see? ggplot(data = mpg) Пустое окно построения. Функция ggplot() из пакета ggplot2 только содаёт область построения, функциями мы производим наполнение области построения. Больше инфы смотри в подсказке https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf . Упражнение 3.2.2 How many rows are in mpg? How many columns? Чтобы проверить “строение” фрейма данных mpg,можно воспользоваться двумя способами. Var1: ggplot2::mpg ## # A tibble: 234 x 11 ## manufacturer model displ year cyl trans drv cty hwy fl cla… ## &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;ch&gt; ## 1 audi a4 1.8 1999 4 auto… f 18 29 p com… ## 2 audi a4 1.8 1999 4 manu… f 21 29 p com… ## 3 audi a4 2 2008 4 manu… f 20 31 p com… ## 4 audi a4 2 2008 4 auto… f 21 30 p com… ## 5 audi a4 2.8 1999 6 auto… f 16 26 p com… ## 6 audi a4 2.8 1999 6 manu… f 18 26 p com… ## 7 audi a4 3.1 2008 6 auto… f 18 27 p com… ## 8 audi a4 q… 1.8 1999 4 manu… 4 18 26 p com… ## 9 audi a4 q… 1.8 1999 4 auto… 4 16 25 p com… ## 10 audi a4 q… 2 2008 4 manu… 4 20 28 p com… ## # ... with 224 more rows где видно что mpg это матрица 234 строки на 11 столбцов. Var2: glimpse(mpg) ## Observations: 234 ## Variables: 11 ## $ manufacturer &lt;chr&gt; &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;... ## $ model &lt;chr&gt; &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4 qua... ## $ displ &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0,... ## $ year &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1... ## $ cyl &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6... ## $ trans &lt;chr&gt; &quot;auto(l5)&quot;, &quot;manual(m5)&quot;, &quot;manual(m6)&quot;, &quot;auto(av)... ## $ drv &lt;chr&gt; &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;4&quot;, &quot;4&quot;, &quot;4&quot;,... ## $ cty &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 1... ## $ hwy &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 2... ## $ fl &lt;chr&gt; &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;,... ## $ class &lt;chr&gt; &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;comp... Сразу тут покажу, что каждый параметр означает: Название Описание manufacturer изготовитель model модель displ объём двигателя в литрах year год изготовления cyl количество цилиндров trans тип трансмиссии drv тип привода cty количество пройденных миль по городу на один галлон топлива hwy количество пройденных миль за городом на один галлон топлива fl тип топлива class класс автомобиля Упражнение 3.2.3 What does the drv variable describe? Read the help for ?mpg to find out. drv — это имя одного из параметров, оно обозначает тип привода автомобиля. Краткое название Тип привода f передний r задний 4 полный Упражнение 3.2.4 Make a scatter plot of hwy vs cyl. можно прописывать на одной координатной плоскости разные геометрические функции с индивидуальными параметрами, тогда правильнее будет писать вот так Var 1 ggplot(data = mpg)+ geom_point(mapping = aes(x = hwy, y = cyl)) Но если параметры одни и те же, а требуется построить разные геометрии, то лучше прописать общие параметры вынося их “за скобки” Var 2 ggplot(data = mpg, aes(x = hwy, y = cyl))+ geom_point() Упражнение 3.2.5 What happens if you make a scatterplot of class vs drv? Why is the plot not useful? Оба параметра являются категориальными, или описательными. Можно построить &lt;chr&gt; от &lt;chr&gt;. ggplot(data = mpg) + geom_point(mapping = aes(x = class, y = drv)) Но с точки зрения аналитики, такая информация не несёт большой пользы. В конкретном примере можно только сказать что, все автомобили класса 2seater имеют задний привод. А в классе subcompact есть все типы привода. 3.3 Эстетика визуализации Упражнения 3.3.1 What’s gone wrong with this code? Why are the points not blue? {.unnumbered} ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, colour = &quot;blue&quot;)) Всё потому что colour не вынес за скобки, потому что colour это параметр функции geom_point(), not aes() правильно вот так ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy), colour = &quot;blue&quot;) Упражнения 3.3.2 Which variables in mpg are categorical? Which variables are continuous? (Hint: type ?mpg to read the documentation for the dataset). How can you see this information when you run mpg? {.unnumbered} Это те факторы, которые позволяют разделить на показатели. Чтобы понять какие факторы являются категориальными можно воспользоваться функцией glimpse(), которая показывает тип каждого столбца. Соответственно, те что &lt;chr&gt; и есть категориальные: glimpse(mpg) ## Observations: 234 ## Variables: 11 ## $ manufacturer &lt;chr&gt; &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;... ## $ model &lt;chr&gt; &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4 qua... ## $ displ &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0,... ## $ year &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1... ## $ cyl &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6... ## $ trans &lt;chr&gt; &quot;auto(l5)&quot;, &quot;manual(m5)&quot;, &quot;manual(m6)&quot;, &quot;auto(av)... ## $ drv &lt;chr&gt; &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;4&quot;, &quot;4&quot;, &quot;4&quot;,... ## $ cty &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 1... ## $ hwy &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 2... ## $ fl &lt;chr&gt; &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;,... ## $ class &lt;chr&gt; &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;comp... Упражнения 3.3.3 Map a continuous variable to color, size, and shape. How do these aesthetics behave differently for categorical vs. continuous variables? {.unnumbered} Непрерывные переменные, это такие переменные которые принимают значения в некотором диапазоне. Непрерывной переменной является например cty, city miles per gallon, и показывает сколько проедет автомобиль в черте горда на один галлон топлива. Если сопоставить этой переменной цвет то получится ggplot(mpg, aes(x = displ, y = hwy, colour = cty)) + geom_point() Цвет распределяется в диапазоне переменной cty, то есть в пределах от примерно 10 до 35. Попробуем теперь соспоставить размер ggplot(mpg, aes(x = displ, y = hwy, size = cty)) + geom_point() В принципе получается такая же картина, только точки выделены не цветом, а размером. И наконец, сопоставим форму непрерывной переменной #ggplot(mpg, aes(x = displ, y = hwy, shape = cty)) + geom_point() А вот хуюшки. Программа выдаст Ошибка: A continuous variable can not be mapped to shape. Непрерывные переменные не соотносятся с атрибутом shape, так сделано специально. Потому что фигур всего 24, а наборов значений у непрерывной переменной может быть сколь угодно много Упражнения 3.3.4 What happens if you map the same variable to multiple aesthetics? {.unnumbered} Связать можно, вот например, переменная drv для цвета и для формы ggplot(mpg, aes(x = displ, y = hwy, color = drv, shape = drv)) + geom_point() но это будет избыточное выделение. Упражнения 3.3.5 What does the stroke aesthetic do? What shapes does it work with? (Hint: use ?geom_point) stroke это размер границы фигуры. Он работает с фигурами, у которых помимо полной заливки есть цвет границы т.е. фигуры 21-24 Иллюстрирующий пример. Вот построение обычными точками ggplot(mpg, aes(hwy, cyl))+ geom_point() Теперь зададим красную заливку, и размер границы фигуры \\(2\\) ggplot(mpg, aes(hwy, cyl)) + geom_point(shape=21,colour=&quot;black&quot;,fill=&quot;red&quot;,size=3,stroke=2) Ну а теперь \\(5\\) ggplot(mpg, aes(hwy, cyl)) + geom_point(shape=21,colour=&quot;black&quot;,fill=&quot;red&quot;,size=3,stroke=5) Упражнения 3.3.6 What happens if you map an aesthetic to something other than a variable name, like aes(colour = displ &lt; 5)? Визуальные атрибуты можно задавать и логическими выражениями, как допустим в таком выражении: ggplot(mpg, aes(displ,hwy, color = displ &lt; 2)) + geom_point() ggplot(mpg, aes(displ,hwy, color = displ &lt; 4)) + geom_point() ggplot(mpg, aes(displ,hwy, size = displ &gt; 3)) + geom_point() ## Warning: Using size for a discrete variable is not advised. К тому же R ругается, что лучше бы такое не делать ## Распространённые ошибки Проблемы случаются и это норм. Если что-то не получается, чекни код. Часто бывает что поставил + не туда. Он должен быть в конце строки, а не в начале. 3.4 Панели Упражнение 3.5.1 What happens if you facet on a continuous variable? Как это работает. Построим график highway miles per gallon от engine displacement, in litres. ggplot(mpg, aes(x = displ, y = hwy)) + geom_point() Теперь разделим на “окошки” т.е. возьмём срез графиков с теми же дискретными переменными, но в разрезе типа привода автомобиля drv от количества цилиндров cyl. ggplot(mpg, aes(x = displ, y = hwy)) + geom_point() + facet_grid(drv~ cyl) Получилось \\(12\\) панелей, потому что drv дискретная, ограниченная переменная, у неё всего три набора значения (\\(4, f, d\\)). Количество цилиндров cyl тоже ограниченная \\(4,5,6,8\\). Поэтому получилось \\(3*4=12\\) значений. Так как панелей получилось немного, такое представление осязаемо, с ним можно работать, оно информативно. Если мы попробуем построить в одном измерении непрерывную переменную. То количество панелей возрастёт на количество значений этой переменной. Получится не очень информативно. Заменим в этом же построении количество цилиндров cyl на расстояние, пройденное за один галлон топлива в городской черте cty. Это непрерывная переменная, у которой много значений. ggplot(mpg, aes(x = displ, y = hwy)) + geom_point() + facet_grid(drv~cty) Вот что произойдет, если параметром для панели задать непрерывную переменную. Будет много окошек, информативность представленной информации падает. Упражнение 3.5.2 What do the empty cells in plot with facet_grid(drv ~ cyl) mean? How do they relate to this plot? Построим панели по заданному условию ggplot(mpg, aes(x = displ, y = hwy)) + geom_point() + facet_grid(drv~cyl) Пустые ячейки \\(cyl(5):drv(4)\\); \\(cyl(4):drv(r)\\); \\(cyl(5):drv(r)\\); говорят о том, что нет точек удовлетворяющих этим разрезам данных. Иначе говоря, в наборе данных mpg нет полноприводных авто с 5 цилиндрами заднеприводных авто с 4 цилиндрами заднеприводных авто с 5 цилиндрами Построим заданную функцию ggplot(data = mpg) + geom_point(mapping = aes(x = drv, y = cyl)) Она соотносится с построенными выше панелями в том, что показывает отсутствие данных в комбинациях переменных drv:cyl Упражнение 3.5.3 What plots does the following code make? What does «.» do? ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(drv ~ .) ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(. ~ cyl) Сравним с оригиналом: ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_grid(drv ~ cyl) Как видно на самих построениях, точка убирает одно из измерений панели следующим образом: Если точка стоит в первой координате, (. ~ param), то убираются строки Если точка стоит во второй координате, (param ~ .), то убираются столбцы Упражнение 3.5.4 Take the first faceted plot in this section: ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy)) + facet_wrap(~ class, nrow = 2) What are the advantages to using faceting instead of the colour aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset? Для того чтобы сравнить это цветное выделение с выделением плитками. Посмотрим как выглядит выделение того же построения данных цветом: ggplot(data = mpg) + geom_point(mapping = aes(x = displ, y = hwy, color = class)) Преимущество построения плитками заключается в том, что каждая группы “очищена” от мусора других групп. Плитками проще оценить распределение точек в отдельно взятой группе. Кроме этого если выделять цветом построения с большим количеством групп, то необходимо более ответственно подходить к подбору цветов `– нужно делать их более контрастными. Потому что при увеличении количества групп, цвета начинают сливаться, и уже трудно различать к какой категории относится точка. Недостаток построяния плитками заключается в том, что каждая группа строится в отдельной системе координат. Трудно сравнивать распределение точек между группами. Упражнение 3.5.5 Read ?facet_wrap. What does nrow do? What does ncol do? What other options control the layout of the individual panels? Why doesn’t facet_grid() have nrow and ncol arguments? аргумент что значит nrow количество строк ncol количество столбцов Эти переменные нужны, так как срез графика в facet_wrap() происходит по одной дискретной переменной. В свою очередь facet_grid использует комбинации двех переменных поэтому для построения не нужно выбирать количество строк или колонок. Упражнение 3.5.6 When using facet_grid() you should usually put the variable with more unique levels in the columns. Why? Экраны наших компьютеров, книги, чертежи, имеют альбомную ориентацию и на одном носители умещается больше данных. Поэтому визуально проще сравнивать большее количество переменных по-горизонтали. 3.5 Геометрические объекты Упражнения 3.6.1 What geom would you use to draw a line chart? A boxplot? A histogram? An area chart? На русский язык “boxplot перевели как”полосчатый график“. Это конечно сбивает с толку, потому что boxplot это конечно”ящик с усами“. Исходя из этого Название графика Объект geom linechart geom_line boxplot geom_boxplot histogram geom_histogram area chart geom_area Упражнения 3.6.2 Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions. Это будет распределение displ от hwy. С цветом точек в зависимости от drv, т.е. три цвета - зелёный, красный и голубой. В этой же системе координат будет построена линия среднеквадратичного приближения без доверительного интервала с тем же цветом, что и точки. ggplot(data = mpg, mapping = aes(x = displ, y = hwy, colour = drv)) + geom_point() + geom_smooth(se = FALSE) ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; Поправочка - будет три линии приближений с цветом, соответсвующим цвету точек, по которым строится это приближение Упражнения 3.6.3 What does show.legend = FALSE do? What happens if you remove it? Why do you think I used it earlier in the chapter? Автор имеет в виду этот пример ggplot(mpg) + geom_smooth( mapping = aes(displ, hwy, colour = drv), show.legend = FALSE ) ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; Инструкция show.legend распоряжает показывать легенду графика или нет. По умолчанию эта инструкция имеет значение TRUE. В примере из книги, инструкция show.legend = FALSE использовалась намеренно, чтобы в максимальном размере уместить в одну строку три графика. Тот же график с легендой выглядит вот так: ggplot(mpg) + geom_smooth( mapping = aes(displ, hwy, colour = drv) ) ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; Упражнения 3.6.4 What does the se argument to geom_smooth() do? Аргумент se распоряжает показывать ли доверительный интервал или нет. По умолчанию этот интервал показывается. В примере ниже доверительный интервал показывается: ggplot(mpg) + geom_smooth(mapping = aes(displ, hwy)) ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; Теперь уберём его: ggplot(mpg) + geom_smooth(mapping = aes(displ, hwy), se = FALSE) ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; Упражнения 3.6.5 Will these two graphs look different? Why/why not? ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_point() + geom_smooth() ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; ggplot() + geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy)) ## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39; "]
]
