<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Решение упражнений из книги R Science</title>
  <meta name="description" content="Здесь будут публиковаться решения заданий из книги">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Решение упражнений из книги R Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Здесь будут публиковаться решения заданий из книги" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Решение упражнений из книги R Science" />
  
  <meta name="twitter:description" content="Здесь будут публиковаться решения заданий из книги" />
  

<meta name="author" content="Stas Masuta">


<meta name="date" content="2018-10-25">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="http://r4ds.had.co.nz/index.html">Оригинал книги</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Введение</a></li>
<li class="chapter" data-level="2" data-path="-.html"><a href="-.html"><i class="fa fa-check"></i><b>2</b> Предварительный анализ</a><ul>
<li class="chapter" data-level="2.1" data-path="-.html"><a href="-.html#----ggplot2"><i class="fa fa-check"></i><b>2.1</b> Визуализация данных с помощью <code>ggplot2</code></a><ul>
<li class="chapter" data-level="2.1.1" data-path="-.html"><a href="-.html#-1"><i class="fa fa-check"></i><b>2.1.1</b> Введение</a></li>
<li class="chapter" data-level="2.1.2" data-path="-.html"><a href="-.html#-"><i class="fa fa-check"></i><b>2.1.2</b> Первые шаги</a></li>
<li class="chapter" data-level="2.1.3" data-path="-.html"><a href="-.html#-"><i class="fa fa-check"></i><b>2.1.3</b> Эстетика визуализации</a></li>
<li class="chapter" data-level="2.1.4" data-path="-.html"><a href="-.html#section-2.1.4"><i class="fa fa-check"></i><b>2.1.4</b> Панели</a></li>
<li class="chapter" data-level="2.1.5" data-path="-.html"><a href="-.html#-"><i class="fa fa-check"></i><b>2.1.5</b> Геометрические объекты</a></li>
<li class="chapter" data-level="2.1.6" data-path="-.html"><a href="-.html#-"><i class="fa fa-check"></i><b>2.1.6</b> Статистические преобразования</a></li>
<li class="chapter" data-level="2.1.7" data-path="-.html"><a href="-.html#-"><i class="fa fa-check"></i><b>2.1.7</b> Позиционные настройки</a></li>
<li class="chapter" data-level="2.1.8" data-path="-.html"><a href="-.html#-"><i class="fa fa-check"></i><b>2.1.8</b> Системы координат</a></li>
<li class="chapter" data-level="2.1.9" data-path="-.html"><a href="-.html#--"><i class="fa fa-check"></i><b>2.1.9</b> Многослойная грамматика графики</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="-.html"><a href="-.html#--"><i class="fa fa-check"></i><b>2.2</b> Рабочий процесс: основы</a><ul>
<li class="chapter" data-level="2.2.1" data-path="-.html"><a href="-.html#--"><i class="fa fa-check"></i><b>2.2.1</b> Основы написания кода</a></li>
<li class="chapter" data-level="2.2.2" data-path="-.html"><a href="-.html#-"><i class="fa fa-check"></i><b>2.2.2</b> Вызов функций</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="-.html"><a href="-.html#-----dplyr"><i class="fa fa-check"></i><b>2.3</b> Преобразование данных с помощью пакета <code>dplyr</code></a><ul>
<li class="chapter" data-level="2.3.1" data-path="-.html"><a href="-.html#-2"><i class="fa fa-check"></i><b>2.3.1</b> Введение</a></li>
<li class="chapter" data-level="2.3.2" data-path="-.html"><a href="-.html#-----filter"><i class="fa fa-check"></i><b>2.3.2</b> Фильтрация строк с помощью функции <code>filter()</code></a></li>
<li class="chapter" data-level="2.3.3" data-path="-.html"><a href="-.html#-----arange"><i class="fa fa-check"></i><b>2.3.3</b> Перестановка строк с помощью функции <code>arange()</code></a></li>
<li class="chapter" data-level="2.3.4" data-path="-.html"><a href="-.html#-----select"><i class="fa fa-check"></i><b>2.3.4</b> Выбор столбцов с помощью функции <code>select()</code></a></li>
<li class="chapter" data-level="2.3.5" data-path="-.html"><a href="-.html#-----mutate"><i class="fa fa-check"></i><b>2.3.5</b> Добавление столбцов с помощью функции <code>mutate()</code></a></li>
<li class="chapter" data-level="2.3.6" data-path="-.html"><a href="-.html#------summarize"><i class="fa fa-check"></i><b>2.3.6</b> Получение групповых итогов с помощью функции <code>summarize()</code></a></li>
<li class="chapter" data-level="2.3.7" data-path="-.html"><a href="-.html#---"><i class="fa fa-check"></i><b>2.3.7</b> Групповое изменение (и фильтрация)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Сделано с помощью bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Решение упражнений из книги R Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="-" class="section level1">
<h1><span class="header-section-number">Глава 2</span> Предварительный анализ</h1>
<div id="----ggplot2" class="section level2">
<h2><span class="header-section-number">2.1</span> Визуализация данных с помощью <code>ggplot2</code></h2>
<div id="-1" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Введение</h3>
<p>Электронная версия книги по адресу <a href="http://r4ds.had.co.nz" class="uri">http://r4ds.had.co.nz</a>.</p>
<p>Для начала работы подключаем библиотеку</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>Дополнительно, используются пакеты <code>install.packages(c(&quot;nycflights13&quot;, &quot;gapminder&quot;, &quot;Lahman&quot;))</code></p>
<p>А это шпаргалка <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">cheat_sheet</a></p>
<p>Не было упражнений.</p>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Первые шаги</h3>
<div id="-3.2.1" class="section level4">
<h4><span class="header-section-number">2.1.2.1</span> Упражнение 3.2.1</h4>
<div class="question">
<p>Run <code>ggplot(data = mpg)</code> what do you see?</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Пустое окно построения. Функция <code>ggplot()</code> из пакета <code>ggplot2</code> только содаёт область построения, функциями мы производим наполнение области построения. Больше инфы смотри в подсказке <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf</a> .</p>
</div>
<div id="-3.2.2" class="section level4">
<h4><span class="header-section-number">2.1.2.2</span> Упражнение 3.2.2</h4>
<div class="question">
<p>How many rows are in <code>mpg</code>? How many columns?</p>
</div>
<p>Чтобы проверить “строение” фрейма данных <code>mpg</code>,можно воспользоваться двумя способами. Var1:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ggplot2<span class="op">::</span>mpg</code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    cla…
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;ch&gt;
##  1 audi         a4      1.8  1999     4 auto… f        18    29 p     com…
##  2 audi         a4      1.8  1999     4 manu… f        21    29 p     com…
##  3 audi         a4      2    2008     4 manu… f        20    31 p     com…
##  4 audi         a4      2    2008     4 auto… f        21    30 p     com…
##  5 audi         a4      2.8  1999     6 auto… f        16    26 p     com…
##  6 audi         a4      2.8  1999     6 manu… f        18    26 p     com…
##  7 audi         a4      3.1  2008     6 auto… f        18    27 p     com…
##  8 audi         a4 q…   1.8  1999     4 manu… 4        18    26 p     com…
##  9 audi         a4 q…   1.8  1999     4 auto… 4        16    25 p     com…
## 10 audi         a4 q…   2    2008     4 manu… 4        20    28 p     com…
## # ... with 224 more rows</code></pre>
<p>где видно что <code>mpg</code> это матрица 234 строки на 11 столбцов.</p>
<p>Var2:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(mpg)</code></pre></div>
<pre><code>## Observations: 234
## Variables: 11
## $ manufacturer &lt;chr&gt; &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;...
## $ model        &lt;chr&gt; &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4 qua...
## $ displ        &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0,...
## $ year         &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1...
## $ cyl          &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6...
## $ trans        &lt;chr&gt; &quot;auto(l5)&quot;, &quot;manual(m5)&quot;, &quot;manual(m6)&quot;, &quot;auto(av)...
## $ drv          &lt;chr&gt; &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;4&quot;, &quot;4&quot;, &quot;4&quot;,...
## $ cty          &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 1...
## $ hwy          &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 2...
## $ fl           &lt;chr&gt; &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;,...
## $ class        &lt;chr&gt; &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;comp...</code></pre>
<p>Сразу тут покажу, что каждый параметр означает:</p>
<table>
<thead>
<tr class="header">
<th>Название</th>
<th align="center">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>manufacturer</td>
<td align="center">изготовитель</td>
</tr>
<tr class="even">
<td>model</td>
<td align="center">модель</td>
</tr>
<tr class="odd">
<td>displ</td>
<td align="center">объём двигателя в литрах</td>
</tr>
<tr class="even">
<td>year</td>
<td align="center">год изготовления</td>
</tr>
<tr class="odd">
<td>cyl</td>
<td align="center">количество цилиндров</td>
</tr>
<tr class="even">
<td>trans</td>
<td align="center">тип трансмиссии</td>
</tr>
<tr class="odd">
<td>drv</td>
<td align="center">тип привода</td>
</tr>
<tr class="even">
<td>cty</td>
<td align="center">количество пройденных миль по городу на один галлон топлива</td>
</tr>
<tr class="odd">
<td>hwy</td>
<td align="center">количество пройденных миль за городом на один галлон топлива</td>
</tr>
<tr class="even">
<td>fl</td>
<td align="center">тип топлива</td>
</tr>
<tr class="odd">
<td>class</td>
<td align="center">класс автомобиля</td>
</tr>
</tbody>
</table>
</div>
<div id="-3.2.3" class="section level4">
<h4><span class="header-section-number">2.1.2.3</span> Упражнение 3.2.3</h4>
<div class="question">
<p>What does the <code>drv</code> variable describe? Read the help for <code>?mpg</code> to find out. <code>drv</code> — это имя одного из параметров, оно обозначает тип привода автомобиля.</p>
</div>
<table>
<thead>
<tr class="header">
<th>Краткое название</th>
<th align="center">Тип привода</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>f</td>
<td align="center">передний</td>
</tr>
<tr class="even">
<td>r</td>
<td align="center">задний</td>
</tr>
<tr class="odd">
<td>4</td>
<td align="center">полный</td>
</tr>
</tbody>
</table>
</div>
<div id="-3.2.4" class="section level4">
<h4><span class="header-section-number">2.1.2.4</span> Упражнение 3.2.4</h4>
<div class="question">
<p>Make a scatter plot of <code>hwy</code> vs <code>cyl</code>.</p>
</div>
<p>можно прописывать на одной координатной плоскости разные геометрические функции с индивидуальными параметрами, тогда правильнее будет писать вот так</p>
<p>Var 1</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg)<span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> hwy, <span class="dt">y =</span> cyl))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/41-1.png" width="672" /></p>
<p>Но если параметры одни и те же, а требуется построить разные геометрии, то лучше прописать общие параметры вынося их “за скобки” Var 2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> hwy, <span class="dt">y =</span> cyl))<span class="op">+</span>
<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="-3.2.5" class="section level4">
<h4><span class="header-section-number">2.1.2.5</span> Упражнение 3.2.5</h4>
<div class="question">
<p>What happens if you make a scatterplot of <code>class</code> vs <code>drv</code>? Why is the plot not useful? <di/v></p>
<p>Оба параметра являются категориальными, или описательными. Можно построить <code>&lt;chr&gt;</code> от <code>&lt;chr&gt;</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> drv))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Но с точки зрения аналитики, такая информация не несёт большой пользы. В конкретном примере можно только сказать что, все автомобили класса <code>2seater</code> имеют задний привод. А в классе <code>subcompact</code> есть все типы привода.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Эстетика визуализации</h3>
<div id="-3.3.1" class="section level4">
<h4><span class="header-section-number">2.1.3.1</span> Упражнения 3.3.1</h4>
<div class="question">
<p>What’s gone wrong with this code? Why are the points not blue?</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Всё потому что <code>colour</code> не вынес за скобки, потому что <code>colour</code> это параметр функции <code>geom_point()</code>, not <code>aes()</code> правильно вот так</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="-3.3.2" class="section level4">
<h4><span class="header-section-number">2.1.3.2</span> Упражнения 3.3.2</h4>
<div class="question">
<p>Which variables in <code>mpg</code> are categorical? Which variables are continuous? (Hint: type <code>?mpg</code> to read the documentation for the dataset). How can you see this information when you run <code>mpg</code>?</p>
</div>
<p>Это те факторы, которые позволяют разделить на показатели. Чтобы понять какие факторы являются категориальными можно воспользоваться функцией <code>glimpse()</code>, которая показывает тип каждого столбца. Соответственно, те что <code>&lt;chr&gt;</code> и есть категориальные:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">glimpse</span>(mpg)</code></pre></div>
<pre><code>## Observations: 234
## Variables: 11
## $ manufacturer &lt;chr&gt; &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;...
## $ model        &lt;chr&gt; &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4 qua...
## $ displ        &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0,...
## $ year         &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 1...
## $ cyl          &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6...
## $ trans        &lt;chr&gt; &quot;auto(l5)&quot;, &quot;manual(m5)&quot;, &quot;manual(m6)&quot;, &quot;auto(av)...
## $ drv          &lt;chr&gt; &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;4&quot;, &quot;4&quot;, &quot;4&quot;,...
## $ cty          &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 1...
## $ hwy          &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 2...
## $ fl           &lt;chr&gt; &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;,...
## $ class        &lt;chr&gt; &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;comp...</code></pre>
</div>
<div id="-3.3.3" class="section level4">
<h4><span class="header-section-number">2.1.3.3</span> Упражнения 3.3.3</h4>
<div class="question">
<p>Map a continuous variable to <code>color</code>, <code>size</code>, and <code>shape</code>. How do these aesthetics behave differently for categorical vs. continuous variables?</p>
</div>
<p>Непрерывные переменные, это такие переменные которые принимают значения в некотором диапазоне. Непрерывной переменной является например <code>cty</code>, city miles per gallon, и показывает сколько проедет автомобиль в черте горда на один галлон топлива. Если сопоставить этой переменной <strong>цвет</strong> то получится</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> cty)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Цвет распределяется в диапазоне переменной <code>cty</code>, то есть в пределах от примерно 10 до 35. Попробуем теперь соспоставить <strong>размер</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">size =</span> cty)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>В принципе получается такая же картина, только точки выделены не цветом, а размером. И наконец, сопоставим <strong>форму</strong> непрерывной переменной</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#ggplot(mpg, aes(x = displ, y = hwy, shape = cty)) + geom_point()</span></code></pre></div>
<p>А вот хуюшки. Программа выдаст <code>Ошибка: A continuous variable can not be mapped to shape</code>. Непрерывные переменные не соотносятся с атрибутом <code>shape</code>, так сделано специально. Потому что фигур всего 24, а наборов значений у непрерывной переменной может быть сколь угодно много</p>
</div>
<div id="-3.3.4" class="section level4">
<h4><span class="header-section-number">2.1.3.4</span> Упражнения 3.3.4</h4>
<div class="question">
<p>What happens if you map the same variable to multiple aesthetics?</p>
</div>
<p>Связать можно, вот например, переменная <code>drv</code> для цвета и для формы</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> drv, <span class="dt">shape =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>но это будет избыточное выделение.</p>
</div>
<div id="-3.3.5" class="section level4">
<h4><span class="header-section-number">2.1.3.5</span> Упражнения 3.3.5</h4>
<div class="question">
<p>What does the <code>stroke</code> aesthetic do? What shapes does it work with? (Hint: use <code>?geom_point</code>)</p>
</div>
<p><code>stroke</code> это размер границы фигуры. Он работает с фигурами, у которых помимо полной заливки есть цвет границы т.е. фигуры 21-24 <img src="img/shapes.png" alt="alt text" /></p>
<p>Иллюстрирующий пример. Вот построение обычными точками</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(hwy, cyl))<span class="op">+</span>
<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Теперь зададим красную заливку, и размер границы фигуры <span class="math inline">\(2\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(hwy, cyl)) <span class="op">+</span>
<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;red&quot;</span>,<span class="dt">size=</span><span class="dv">3</span>,<span class="dt">stroke=</span><span class="dv">2</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Ну а теперь <span class="math inline">\(5\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(hwy, cyl)) <span class="op">+</span>
<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;red&quot;</span>,<span class="dt">size=</span><span class="dv">3</span>,<span class="dt">stroke=</span><span class="dv">5</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="-3.3.6" class="section level4">
<h4><span class="header-section-number">2.1.3.6</span> Упражнения 3.3.6</h4>
<div class="question">
<p>What happens if you map an aesthetic to something other than a variable name, like <code>aes(colour = displ &lt; 5)</code>?</p>
</div>
<p>Визуальные атрибуты можно задавать и логическими выражениями, как допустим в таком выражении:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ,hwy, <span class="dt">color =</span> displ <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ,hwy, <span class="dt">color =</span> displ <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ,hwy, <span class="dt">size =</span> displ <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>()</code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>К тому же <code>R</code> ругается, что лучше бы такое не делать ### Распространённые ошибки Проблемы случаются и это норм. Если что-то не получается, чекни код.</p>
<p>Часто бывает что поставил <code>+</code> не туда. Он должен быть в конце строки, а не в начале.</p>
</div>
</div>
<div id="section-2.1.4" class="section level3">
<h3><span class="header-section-number">2.1.4</span> Панели</h3>
<div id="-3.5.1" class="section level4">
<h4><span class="header-section-number">2.1.4.1</span> Упражнение 3.5.1</h4>
<div class="question">
<p>What happens if you facet on a continuous variable?</p>
</div>
<p>Как это работает.</p>
<p>Построим график <code>highway miles per gallon</code> от <code>engine displacement, in litres</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Теперь разделим на “окошки” т.е. возьмём срез графиков с теми же дискретными переменными, но в разрезе типа привода автомобиля <code>drv</code> от количества цилиндров <code>cyl</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(drv<span class="op">~</span><span class="st"> </span>cyl)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-22-1.png" width="672" /> Получилось <span class="math inline">\(12\)</span> панелей, потому что <code>drv</code> дискретная, ограниченная переменная, у неё всего три набора значения (<span class="math inline">\(4, f, d\)</span>). Количество цилиндров <code>cyl</code> тоже ограниченная <span class="math inline">\(4,5,6,8\)</span>. Поэтому получилось <span class="math inline">\(3*4=12\)</span> значений. Так как панелей получилось немного, такое представление осязаемо, с ним можно работать, оно информативно.</p>
<p>Если мы попробуем построить в одном измерении непрерывную переменную. То количество панелей возрастёт на количество значений этой переменной. Получится не очень информативно. Заменим в этом же построении количество цилиндров <code>cyl</code> на расстояние, пройденное за один галлон топлива в городской черте <code>cty</code>. Это непрерывная переменная, у которой много значений.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st"> </span><span class="kw">facet_grid</span>(drv<span class="op">~</span>cty)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-23-1.png" width="672" /> Вот что произойдет, если параметром для панели задать непрерывную переменную. Будет много окошек, информативность представленной информации падает.</p>
</div>
<div id="-3.5.2" class="section level4">
<h4><span class="header-section-number">2.1.4.2</span> Упражнение 3.5.2</h4>
<div class="question">
<p>What do the empty cells in plot with <code>facet_grid(drv ~ cyl)</code> mean? How do they relate to this plot?</p>
</div>
<p>Построим панели по заданному условию</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(drv<span class="op">~</span>cyl)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Пустые ячейки</p>
<ul>
<li><span class="math inline">\(cyl(5):drv(4)\)</span>;</li>
<li><span class="math inline">\(cyl(4):drv(r)\)</span>;</li>
<li><span class="math inline">\(cyl(5):drv(r)\)</span>;</li>
</ul>
<p>говорят о том, что нет точек удовлетворяющих этим разрезам данных. Иначе говоря, в наборе данных <code>mpg</code></p>
<ul>
<li>нет полноприводных авто с 5 цилиндрами</li>
<li>заднеприводных авто с 4 цилиндрами</li>
<li>заднеприводных авто с 5 цилиндрами</li>
</ul>
<p>Построим заданную функцию</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> drv, <span class="dt">y =</span> cyl))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Она соотносится с построенными выше панелями в том, что показывает отсутствие данных в комбинациях переменных <code>drv:cyl</code></p>
</div>
<div id="-3.5.3" class="section level4">
<h4><span class="header-section-number">2.1.4.3</span> Упражнение 3.5.3</h4>
<div class="question">
<p>What plots does the following code make? What does <code>«.»</code> do?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>.)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cyl)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<p>Сравним с оригиналом:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>cyl)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Как видно на самих построениях, точка убирает одно из измерений панели следующим образом:</p>
<p><em>Если точка стоит в первой координате, <code>(. ~ param)</code>, то убираются строки </em>Если точка стоит во второй координате, <code>(param ~ .)</code>, то убираются столбцы</p>
</div>
<div id="-3.5.4" class="section level4">
<h4><span class="header-section-number">2.1.4.4</span> Упражнение 3.5.4</h4>
<div class="question">
<p>Take the first faceted plot in this section:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>class, <span class="dt">nrow =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>What are the advantages to using faceting instead of the colour aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset?</p>
</div>
<p>Для того чтобы сравнить это цветное выделение с выделением плитками. Посмотрим как выглядит выделение того же построения данных цветом:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> class))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<ul>
<li><p><strong>Преимущество</strong> построения плитками заключается в том, что каждая группы “очищена” от мусора других групп. Плитками проще оценить распределение точек в отдельно взятой группе. Кроме этого если выделять цветом построения с большим количеством групп, то необходимо более ответственно подходить к подбору цветов `– нужно делать их более контрастными. Потому что при увеличении количества групп, цвета начинают сливаться, и уже трудно различать к какой категории относится точка.</p></li>
<li><p><strong>Недостаток</strong> построяния плитками заключается в том, что каждая группа строится в отдельной системе координат. Трудно сравнивать распределение точек между группами.</p></li>
</ul>
</div>
<div id="-3.5.5" class="section level4">
<h4><span class="header-section-number">2.1.4.5</span> Упражнение 3.5.5</h4>
<div class="question">
<p>Read <code>?facet_wrap</code>. What does <code>nrow</code> do? What does <code>ncol</code> do? What other options control the layout of the individual panels? Why doesn’t <code>facet_grid()</code> have <code>nrow</code> and <code>ncol</code> arguments?</p>
</div>
<table>
<thead>
<tr class="header">
<th>аргумент</th>
<th align="center">что значит</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>nrow</code></td>
<td align="center">количество строк</td>
</tr>
<tr class="even">
<td><code>ncol</code></td>
<td align="center">количество столбцов</td>
</tr>
</tbody>
</table>
<p>Эти переменные нужны, так как срез графика в <code>facet_wrap()</code> происходит по одной дискретной переменной. В свою очередь <code>facet_grid</code> использует комбинации двех переменных поэтому для построения не нужно выбирать количество строк или колонок.</p>
</div>
<div id="-3.5.6" class="section level4">
<h4><span class="header-section-number">2.1.4.6</span> Упражнение 3.5.6</h4>
<div class="question">
<p>When using <code>facet_grid()</code> you should usually put the variable with more unique levels in the columns. Why?</p>
</div>
<p>Экраны наших компьютеров, книги, чертежи, имеют альбомную ориентацию и на одном носители умещается больше данных. Поэтому визуально проще сравнивать большее количество переменных по-горизонтали.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.5</span> Геометрические объекты</h3>
<div id="-3.6.1" class="section level4">
<h4><span class="header-section-number">2.1.5.1</span> Упражнения 3.6.1</h4>
<div class="question">
<p>What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?</p>
</div>
<p>На русский язык “boxplot перевели как”полосчатый график“. Это конечно сбивает с толку, потому что boxplot это конечно”ящик с усами“. Исходя из этого</p>
<table>
<thead>
<tr class="header">
<th>Название графика</th>
<th align="center">Объект <code>geom</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>linechart</td>
<td align="center"><code>geom_line</code></td>
</tr>
<tr class="even">
<td>boxplot</td>
<td align="center"><code>geom_boxplot</code></td>
</tr>
<tr class="odd">
<td>histogram</td>
<td align="center"><code>geom_histogram</code></td>
</tr>
<tr class="even">
<td>area chart</td>
<td align="center"><code>geom_area</code></td>
</tr>
</tbody>
</table>
</div>
<div id="-3.6.2" class="section level4">
<h4><span class="header-section-number">2.1.5.2</span> Упражнения 3.6.2</h4>
<div class="question">
<p>Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.</p>
</div>
<p>Это будет распределение <code>displ</code> от <code>hwy</code>. С цветом точек в зависимости от <code>drv</code>, т.е. три цвета - зелёный, красный и голубой. В этой же системе координат будет построена линия среднеквадратичного приближения без доверительного интервала с тем же цветом, что и точки.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Поправочка - будет три линии приближений с цветом, соответсвующим цвету точек, по которым строится это приближение</p>
</div>
<div id="-3.6.3" class="section level4">
<h4><span class="header-section-number">2.1.5.3</span> Упражнения 3.6.3</h4>
<div class="question">
<p>What does <code>show.legend = FALSE</code> do? What happens if you remove it? Why do you think I used it earlier in the chapter?</p>
</div>
<p>Автор имеет в виду этот пример</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv),
    <span class="dt">show.legend =</span> <span class="ot">FALSE</span>
  )</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Инструкция <code>show.legend</code> распоряжает показывать легенду графика или нет. По умолчанию эта инструкция имеет значение <code>TRUE</code>. В примере из книги, инструкция <code>show.legend = FALSE</code> использовалась намеренно, чтобы в максимальном размере уместить в одну строку три графика. Тот же график с легендой выглядит вот так:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)
  )</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
<div id="-3.6.4" class="section level4">
<h4><span class="header-section-number">2.1.5.4</span> Упражнения 3.6.4</h4>
<div class="question">
<p>What does the <code>se</code> argument to <code>geom_smooth()</code> do?</p>
</div>
<p>Аргумент <code>se</code> распоряжает показывать ли доверительный интервал или нет. По умолчанию этот интервал показывается. В примере ниже доверительный интервал показывается:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy))</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Теперь уберём его:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy), <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="-3.6.5" class="section level4">
<h4><span class="header-section-number">2.1.5.5</span> Упражнения 3.6.5</h4>
<div class="question">
<p>Will these two graphs look different? Why/why not?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
</div>
<p>Эти графики будут идентичными, потому что в первом случае в функции <code>ggplot()</code> задаются исходные условия сразу для всех функций, которые будут строится на этом поле построения. А во втором случае, все исходные условия для построений указаны в каждой функции индивидуально. И так как различий в этих условиях нет, то выглядеть они будут одинаково:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>()</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="-3.6.6" class="section level4">
<h4><span class="header-section-number">2.1.5.6</span> Упражнения 3.6.6</h4>
<div class="question">
<p>Recreate the R code necessary to generate the following graphs. <img src="img/graphics3.6.6.png" alt="alt text" /></p>
</div>
<ol style="list-style-type: decimal">
<li>В левом верхнем графике наложено два построения. Первое <code>geom_point()</code> - обычное построение без какой либо группировки и цветового выделения. Второе <code>geom_smouth()</code> - построение распределения без группировки и цветового выделения, без построения доверительного интервала. Так как у обоих построений одинаковые исходные условия, их можно “вынести за скобки”, то есть указать в “родительском” <code>ggplot()</code>:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>В правом верхнем графике наложено два построения. Первое <code>geom_point()</code> - обычное построение без какой либо группировки и цветового выделения. Второе <code>geom_smouth()</code> - построение распределения с группировкой по признаку <code>drv</code>, без построения доверительного интервала. Так как у двух постройний разные условия, лучше для каждого прописать исходные данные индивидуально</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">group =</span> drv), <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>В левом среднем графике наложено два построения. Первое <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code>. Второе <code>geom_smouth()</code> - построение распределения с цветовой группировкой по признаку <code>drv</code>, без построения доверительного интервала. Так как у обоих построений одинаковые исходные условия, их можно “вынести за скобки”, то есть указать в “родительском” <code>ggplot()</code>:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>В правом среднем графике наложено два построения. Первое <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code>. Второе <code>geom_smouth()</code> - построение распределения без группировки и цветового выделения, без построения доверительного интервала. Так как у двух постройний разные условия, лучше для каждого прописать исходные данные индивидуально:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy), <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>В левом нижнем графике наложено два построения. Первое <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code>. Второе <code>geom_smouth()</code> - построение распределения с группировкой по признаку <code>drv</code>, с выделением каждой кривой группы разным типом линии, без построения доверительного интервала. Так как у двух постройний разные условия, лучше для каждого прописать исходные данные индивидуально:</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">linetype =</span> drv), <span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<ol start="6" style="list-style-type: decimal">
<li>В правом нижнем графике только одно построение <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code> и толстыми белыми границами у точек.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">fill =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">stroke =</span> <span class="dv">4</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.6</span> Статистические преобразования</h3>
<div id="-3.7.1" class="section level4">
<h4><span class="header-section-number">2.1.6.1</span> Упражнения 3.7.1</h4>
<div class="question">
<p>What is the default geom associated with <code>stat_summary()</code>? How could you rewrite the previous plot to use that geom function instead of the stat function?</p>
</div>
<p>Для того чтобы ответить на этот вопрос, необходимо открыть help - <code>?stat_summary</code></p>
<p><code>stat_summary(mapping = NULL, data = NULL, geom = &quot;pointrange&quot;, position = &quot;identity&quot;, ..., fun.data = NULL, fun.y = NULL, fun.ymax = NULL, fun.ymin = NULL, fun.args = list(), na.rm = FALSE, show.legend = NA, inherit.aes = TRUE)</code></p>
<p>Это и есть ответ - со статистикой <code>stat_summary()</code> связана геометрия <code>geom = &quot;pointrange&quot;</code>.</p>
<p>Теперь ответим на вопрос, как можно переписать код</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_summary</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> depth),
    <span class="dt">fun.ymin =</span> min,
    <span class="dt">fun.ymax =</span> max,
    <span class="dt">fun.y =</span> median
  )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Необходимо заменить <code>stat_summary()</code> на <code>geom_pointrange()</code> и вставить название необходимой статистики:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_pointrange</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> depth),
    <span class="dt">stat =</span> <span class="st">&quot;summary&quot;</span>,
    <span class="dt">fun.ymin =</span> min,
    <span class="dt">fun.ymax =</span> max,
    <span class="dt">fun.y =</span> median
  )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="-3.7.2" class="section level4">
<h4><span class="header-section-number">2.1.6.2</span> Упражнения 3.7.2</h4>
<div class="question">
<p>What does <code>geom_col()</code> do? How is it different to <code>geom_bar()</code>?</p>
</div>
<p>Функции имеют разные статистики по умолчанию. <code>geom_bar()</code> иметт <code>stat_count()</code>, а <code>geom_col()</code> имет <code>stat_identity()</code> Т.е. <code>geom_bar()</code> считает, сколько наблюдений попадает в просматриваемый диапазон и столбец показывает количество попавших наблюдений в диапазон. А <code>geom_col()</code> - строит столбцы по количеству наблюдений в диапазоне, а <code>geom_bar()</code> число наблюдений.</p>
</div>
<div id="-3.7.3" class="section level4">
<h4><span class="header-section-number">2.1.6.3</span> Упражнения 3.7.3</h4>
<div class="question">
<p>Most geoms and stats come in pairs that are almost always used in concert. Read through the documentation and make a list of all the pairs. What do they have in common?</p>
</div>
<p>Общие элементы у статистик и геометрий это <code>aes()</code>, <code>position</code>, а пары геометрия-статистика следующие:</p>
<table>
<thead>
<tr class="header">
<th><code>geom_</code></th>
<th align="center"><code>stat_</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>path</code></td>
<td align="center"><code>eclipse</code>, <code>function</code></td>
</tr>
<tr class="even">
<td><code>point</code></td>
<td align="center"><code>identity</code>, <code>unique</code></td>
</tr>
<tr class="odd">
<td><code>tile</code></td>
<td align="center"><code>summary_2d</code></td>
</tr>
<tr class="even">
<td><code>hex</code></td>
<td align="center"><code>summary_hex</code></td>
</tr>
<tr class="odd">
<td><code>pointrange</code></td>
<td align="center"><code>summary_bin</code>, <code>summary</code></td>
</tr>
</tbody>
</table>
</div>
<div id="-3.7.4" class="section level4">
<h4><span class="header-section-number">2.1.6.4</span> Упражнения 3.7.4</h4>
<div class="question">
<p>What variables does <code>stat_smooth()</code> compute? What parameters control its behavior?</p>
</div>
<ul>
<li><p><code>y</code> - predicted value, прогнозируемое значение</p></li>
<li><p><code>ymin</code> - lower pointwise confidence interval around the mean, нижний уровень доверительного интервала среднего значения</p></li>
<li><p><code>ymax</code> - upper pointwise confidence interval around the mean, верхний уровень доверительного интервала среднего значения</p></li>
<li><p><code>se</code> - standard error, стандтартное отклонение</p></li>
</ul>
<p>Я так полагаю, параметры которые регулируют поведение функции, это специальные методы. Если это не так, то я однажды вернусь сюда и дополню этот ответ.</p>
</div>
<div id="-3.7.5" class="section level4">
<h4><span class="header-section-number">2.1.6.5</span> Упражнения 3.7.5</h4>
<div class="question">
<p>In our proportion bar chart, we need to set group = 1 Why? In other words what is the problem with these two graphs?</p>
<p>Graph #1</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop..))</code></pre></div>
<p>Graph #2</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop..))</code></pre></div>
</div>
<p>Если не указать значение <code>group</code>, то все столбики то есть построения будут иметь <code>prop = 1</code>. Функция <code>geom_bar</code> по умолчанию использует статистику <code>stat_count</code>, которая считает количество значений внутри группы.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop..))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop..))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-50-2.png" width="672" /></p>
<p>Проблема с этими двумя графиками заключается в том, что пропорции вычисляются внутри групп. Чтобы исправить, нужно указать группы в этих графиках:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop.., <span class="dt">group =</span> <span class="dv">1</span>))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop.., <span class="dt">group =</span> color))</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-51-2.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.7</span> Позиционные настройки</h3>
<p>В заданиях часто используется фрейм данных <code>diamonds</code>, укажем его здесь:</p>
<table style="width:42%;">
<colgroup>
<col width="19%" />
<col width="22%" />
</colgroup>
<thead>
<tr class="header">
<th>параметр</th>
<th align="center">описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>price</code></td>
<td align="center">цена в долларах ($326–$18,823)</td>
</tr>
<tr class="even">
<td><code>carat</code></td>
<td align="center">вес бриллианта (0.2–5.01)</td>
</tr>
<tr class="odd">
<td><code>cut</code></td>
<td align="center">качество огранки (Fair, Good, Very Good, Premium, Ideal)</td>
</tr>
<tr class="even">
<td><code>color</code></td>
<td align="center">цвет бриллианта J (worst) to D (best)</td>
</tr>
<tr class="odd">
<td><code>clarity</code></td>
<td align="center">чистота, или прозрачность (I1 (worst), SI2, SI1, VS2, VS1, VVS2, VVS1, IF (best)</td>
</tr>
<tr class="even">
<td><code>x</code></td>
<td align="center">длинна в мм</td>
</tr>
<tr class="odd">
<td><code>y</code></td>
<td align="center">ширина в мм</td>
</tr>
<tr class="even">
<td><code>z</code></td>
<td align="center">высота в мм</td>
</tr>
<tr class="odd">
<td><code>depth</code></td>
<td align="center">величина total depth percentage = z / mean(x, y) = 2 * z / (x + y) (от 43 до 79)</td>
</tr>
<tr class="even">
<td><code>table</code></td>
<td align="center">ширина верхней части алмаза относительно самой широкой точки (от 43 до 95)</td>
</tr>
</tbody>
</table>
<p>варианты использования аргумента <code>position</code>:</p>
<ul>
<li><code>position = &quot;identity&quot;</code>. Строит столбцы с перекрыванием, т.е. в точности, где каждый объект должен находится. Это сложно заметить, поэтому если есть необходимость использовать эту настройку, то чтобы увидеть перекрытие нужно дополнительно указывать параметр прозрачности <code>alpha</code>:</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(
  <span class="dt">data =</span> diamonds,
  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>или делать объекты незалитыми убирая у атрибута <code>fill</code> цвет:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(
  <span class="dt">data =</span> diamonds,
  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">color =</span> clarity)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<ul>
<li><code>position = &quot;fill&quot;</code> Создаёт стековые столбцы одинаковой высоты. Удобно сравнивать пропорции у значений.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),
    <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>
    )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<ul>
<li><code>position = &quot;dodge&quot;</code>. Строит перекрывающиеся столбцы рядом друг с другом</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),
    <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>
    )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<ul>
<li><code>position = &quot;jitter&quot;</code>. Не подходит для столбчатых диаграмм, но отлично подходит для диаграмм рассеивания. Если точки пересекаются, то чтобы показать истинное распределение значений <code>jitter</code> добавляет “шум”</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy),
    <span class="dt">position =</span> <span class="st">&quot;jitter&quot;</span>
  )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div id="-3.8.1" class="section level4">
<h4><span class="header-section-number">2.1.7.1</span> Упражнения 3.8.1</h4>
<div class="question">
<p>What is the problem with this plot? How could you improve it?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<p>Это иллюстрация приведённой в книге проблемы <strong>наложение графиков</strong>. Все значения наносимые на график округляются - поэтому в одной точке может быть наложено несколько значений. Чтобы показать истинное количество точек в одном положении можно воспользоваться функцией <code>geom_jitter</code>, которой добавит случайный шум каждой точке.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
</div>
<div id="-3.8.2" class="section level4">
<h4><span class="header-section-number">2.1.7.2</span> Упражнения 3.8.2</h4>
<div class="question">
<p>What parameters to <code>geom_jitter()</code> control the amount of jittering?</p>
</div>
<p>Согласно описанию <a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html"><code>geom_jitter()</code></a> есть два параметра для управления флуктуациями:</p>
<ul>
<li><code>width</code> для вертикального распределения</li>
<li><code>height</code> для горизонтального распределения</li>
</ul>
<p>Разберём на примере. Возьмём диаграмму рассеивания:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>Добавим флуктуаций:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>Отрегулируем умеренные флуктуации, установив значение параметров <code>width</code> и <code>height</code> равным <span class="math inline">\(0,5\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.5</span>, <span class="dt">height =</span> <span class="fl">0.5</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="-3.8.3" class="section level4">
<h4><span class="header-section-number">2.1.7.3</span> Упражнения 3.8.3</h4>
<div class="question">
<p>Compare and contrast <code>geom_jitter()</code> with <code>geom_count()</code>.</p>
</div>
<p>Возьмём данные из предыдущего примера, в которых уже известно, что происходит наложение данных:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>Теперь посмотрим что делает <code>geom_count()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_count</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>Функция <code>geom_count()</code> тоже демонстрирует, что точки в построении накладываются. Но она делает это изящнее - в зависимости от количества точек, попавших в одно построение, увеличивается диаметр окружности.</p>
<ul>
<li>Преимущество <code>geom_count()</code> - не изменяются координаты точек.</li>
<li>Недостаток <code>geom_count()</code> - в зависимости от количества точек, радиус окружности может перекрывать рядом лежащие точки.</li>
</ul>
<p>Впрочем, в этом случае можно использовать дополнительное выделение цветом:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_count</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
<div id="-3.8.4" class="section level4">
<h4><span class="header-section-number">2.1.7.4</span> Упражнения 3.8.4</h4>
<div class="question">
<p>What’s the default <code>position</code> adjustment for <code>geom_boxplot()</code>? Create a visualization of the <code>mpg</code> dataset that demonstrates it.</p>
</div>
<p>Согласно описанию функции <code>geom_boxplot()</code> значение по умолчанию у параметра <code>position = &quot;dodge2&quot;</code>. Оба парамтера <code>&quot;dodge&quot;</code> и <code>&quot;dodge2&quot;</code> строят рядом перекрывающиеся объекты рядом. Разница в том, что <code>&quot;dodge&quot;</code> лепит их вплотную, а <code>&quot;dodge2&quot;</code> добавляет промежуток. Или не совсем…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),
    <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span>
    )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),
    <span class="dt">position =</span> <span class="st">&quot;dodge2&quot;</span>
    )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>Пример для визуализации.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<p>Если использовать другое значение для <code>position</code>, то ящики будут накладываться друг на друга:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>(<span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.8</span> Системы координат</h3>
<div id="-3.9.1" class="section level4">
<h4><span class="header-section-number">2.1.8.1</span> Упражнения 3.9.1</h4>
<div class="question">
<p>Turn a stacked bar chart into a pie chart using <code>coord_polar()</code></p>
</div>
<p>Хорошо, сначала построим стековую диаграмму:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill =</span> <span class="kw">factor</span>(cyl))) <span class="op">+</span>
<span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p><strong>РАЗОБРАТЬСЯ ЧТО ДЕЛАЕТ <code>factor()</code></strong></p>
<p>Всё описание работы есть <a href="https://ggplot2.tidyverse.org/reference/coord_polar.html"><code>coord_polar()</code></a> поэтому я ограничусь здесь только выполнением задания. В документации к построению “пирогов” сказано что, нужно относится к этим построениям максимально острожно, что коррелирует с тем, что говорится в <a href="https://lpgenerator.ru/blog/2015/11/27/pochemu-vam-luchshe-perestat-ispolzovat-krugovye-diagrammy-ili-net/">дизайне и визуализации</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill =</span> <span class="kw">factor</span>(cyl))) <span class="op">+</span>
<span class="st"> </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<p>Можно использовать пример из упражнений</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),
    <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>
    )</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_bar</span>(
    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),
    <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
</div>
<div id="-3.9.2" class="section level4">
<h4><span class="header-section-number">2.1.8.2</span> Упражнения 3.9.2</h4>
<div class="question">
<p>What does <code>labs()</code> do? Read the documentation.</p>
</div>
<p>Функция <code>labs()</code> нужна для подписей всего того что отображается на графике. Всё описание есть в хэлпе.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(mpg) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;Новое название&quot;</span>, 
         <span class="dt">x =</span> <span class="st">&quot;ося порося&quot;</span>,
         <span class="dt">y =</span> <span class="st">&quot;ося лося&quot;</span>,
         <span class="dt">title =</span> <span class="st">&quot;Заголовок&quot;</span>, 
         <span class="dt">subtitle =</span> <span class="st">&quot;под-заголовок&quot;</span>, 
         <span class="dt">tag =</span> <span class="st">&quot;тэг&quot;</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="-3.9.3" class="section level4">
<h4><span class="header-section-number">2.1.8.3</span> Упражнения 3.9.3</h4>
<div class="question">
<p>What’s the difference between <code>coord_quickmap()</code> and <code>coord_map()</code>?</p>
</div>
<p><code>Coord_map</code> проецирует часть земли, которая к слову является приблизительно сферической, на плоскую 2D-плоскость, используя любую проекцию, определенную пакетом <code>mapproj</code>. Карты, как правило, не сохраняют прямых линий, поэтому это требует значительных вычислений. Coord_quickmap - быстрое приближение, которое сохраняет прямые линии. Он лучше всего подходит для небольших площадей ближе к экватору.</p>
<p>По умолчанию, <code>coord_map()</code> использует <a href="https://ru.wikipedia.org/wiki/Проекция_Меркатора">проекцию Меркатора</a>. Собственно в хэлпе больше информации с примерами. <a href="https://ggplot2.tidyverse.org/reference/coord_map.html">ggplot</a></p>
</div>
<div id="-3.9.4" class="section level4">
<h4><span class="header-section-number">2.1.8.4</span> Упражнения 3.9.4</h4>
<div class="question">
<p>What does the plot below tell you about the relationship between city and highway mpg? Why is <code>coord_fixed()</code> important? What does <code>geom_abline()</code> do?</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Функция <code>coord_fixed()</code> представляет количество единиц по оси Y, эквивалентное одной единице по оси X. Что в свою очередь гарантирует, что линия, созданная <code>geom_abline()</code>, имеет угол <span class="math inline">\(45^{\circ}\)</span>. 45-градусная линия позволяет легко сравнить пробег по шоссе и городу с корпусом, в котором город и шоссе MPG были равны.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_abline</span>()</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">2.1.9</span> Многослойная грамматика графики</h3>
<p>Шаблон кода после всего пройденного материала выглядит следующим образом:</p>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt;</code></pre>
</div>
</div>
<div id="--" class="section level2">
<h2><span class="header-section-number">2.2</span> Рабочий процесс: основы</h2>
<div id="--" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Основы написания кода</h3>
<p>Для вывода символа присвоения <code>&lt;-</code> на MacBook, необходимо нажать комбинацию клавиш <option> + &lt;-&gt; (минус) ### Что представляют собой имена <code>R</code> чувствителен к регистру.</p>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Вызов функций</h3>
<p>Не было упражнений</p>
<div id="-4.4.1" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> Упражнение 4.4.1</h4>
<div class="question">
<p>Why does this code not work?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_variable &lt;-<span class="st"> </span><span class="dv">10</span>
my_varıable</code></pre></div>
<p>Look carefully! (This may seem like an exercise in pointlessness, but training your brain to notice even the tiniest difference will pay off when programming.)</p>
</div>
<p>Код не работает, потому что допущена опечатка при вызове функции. Обратите внимание на <code>i</code>. Пишите без ошибок.</p>
</div>
<div id="-4.4.2" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Упражнение 4.4.2</h4>
<div class="question">
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)

<span class="kw">ggplot</span>(<span class="dt">dota =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))

<span class="kw">fliter</span>(mpg, <span class="dt">cyl =</span> <span class="dv">8</span>)
<span class="kw">filter</span>(diamond, carat <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)</code></pre></div>
</div>
<p>Должно быть так. В названии библиотеки забыли кавычки <code>&quot;&quot;</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</code></pre></div>
<p>При объявнлении исходных данных допущена ошибка. Вместо <code>data</code> написано <code>dota</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</code></pre></div>
<p>В следующем примере пришлось чуть повозиться. Тут одновременно несколько ошибок. Вместо <code>filter()</code> написано <code>fliter()</code>. А при объявлении, нужно было правильно сравнивать вместо <code>=</code> надо <code>==</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(mpg, <span class="dt">cyl =</span> <span class="dv">8</span>)</code></pre></div>
<p>И в последнем примере при объявлении фрейма данных допущена опечатка. Вместо <code>diamond</code> надо писать <code>diamonds</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(diamonds, carat <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)</code></pre></div>
</div>
<div id="-4.4.3" class="section level4">
<h4><span class="header-section-number">2.2.2.3</span> Упражнение 4.4.3</h4>
<div class="question">
<p>Press Alt + Shift + K. What happens? How can you get to the same place using the menus?</p>
</div>
<p>Это открывает меню шорт-катов, чтобы открыть его “вручну” нужно пройти по адресу <code>Tools -&gt; Keyboard Shortcuts Help</code>.</p>
</div>
</div>
</div>
<div id="-----dplyr" class="section level2">
<h2><span class="header-section-number">2.3</span> Преобразование данных с помощью пакета <code>dplyr</code></h2>
<p>Поменять уровень вложенности главы когда разберусь как это делать</p>
<div id="-2" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Введение</h3>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.3.1.1</span> Используемые ресурсы</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(nycflights13)
<span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(dplyr)</code></pre></div>
<p>Некоторые имена функций в разных библиотеках дублируются. Когда в <code>R</code> подключается несколько пакетов, в которых названия функций дублируются, программа выдает сообщение об ошибке</p>
<pre><code>── Conflicts ─────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
<p>Для того чтобы обратится к необходимой функции, нужно использовать полное имя <code>stats::filter()</code>, <code>stats::lag()</code></p>
</div>
<div id="-nycflights13" class="section level4">
<h4><span class="header-section-number">2.3.1.2</span> Пакет <code>nycflights13</code></h4>
<table>
<thead>
<tr class="header">
<th>Переменная</th>
<th align="center">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>int</code></td>
<td align="center">целые числа</td>
</tr>
<tr class="even">
<td><code>dbl</code></td>
<td align="center">числа с плавающей точкой</td>
</tr>
<tr class="odd">
<td><code>chr</code></td>
<td align="center">символьные векторы или строки</td>
</tr>
<tr class="even">
<td><code>dttm</code></td>
<td align="center">дата + время</td>
</tr>
<tr class="odd">
<td><code>lgl</code></td>
<td align="center">булевы векторы</td>
</tr>
<tr class="even">
<td><code>fctr</code></td>
<td align="center">факторы</td>
</tr>
<tr class="odd">
<td><code>date</code></td>
<td align="center">даты</td>
</tr>
</tbody>
</table>
</div>
<div id="----dplyr" class="section level4">
<h4><span class="header-section-number">2.3.1.3</span> Основные сведения о пакете <code>dplyr</code></h4>
<p>Минимум для работы с этим пакетом:</p>
<table style="width:86%;">
<colgroup>
<col width="18%" />
<col width="68%" />
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th align="center">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter()</code></td>
<td align="center">выбор наблюдений по их значениям</td>
</tr>
<tr class="even">
<td><code>arrange()</code></td>
<td align="center">перестановка строк</td>
</tr>
<tr class="odd">
<td><code>select()</code></td>
<td align="center">выбор переменных по их именам</td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td align="center">создание новых переменных с использованием существующих</td>
</tr>
<tr class="odd">
<td><code>summarize()</code></td>
<td align="center">сведение нескольких значений в одно итоговое</td>
</tr>
<tr class="even">
<td><code>group_by()</code></td>
<td align="center">изменяет область действия функции от всего набора данных до отдельных участков</td>
</tr>
</tbody>
</table>
<p>Все глаголы подчиняются одному и тому же синтаксису</p>
<ol style="list-style-type: decimal">
<li><p>Первый аргумент <span class="math inline">\(-\)</span> это фрейм данных</p></li>
<li><p>Последующие аргументы описывают действия, которые должны быть выполнены по отношению к фрейму данных.</p></li>
<li><p>Результат <span class="math inline">\(-\)</span> это новый фрейм данных</p></li>
</ol>
</div>
</div>
<div id="-----filter" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Фильтрация строк с помощью функции <code>filter()</code></h3>
<p>Функция <code>filter()</code> позволяет что бы вы думали? позволяет фильтровать! Первым аргументом указываем фрейм данных, последующие аргументы, это параметры (столбцы) которые мы желаем отфильтровать через операторы сравнения.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<pre><code>## # A tibble: 26,162 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     2       42           2359        43      518
##  2  2013     1     2      126           2250       156      233
##  3  2013     1     2      458            500        -2      703
##  4  2013     1     2      512            515        -3      809
##  5  2013     1     2      535            540        -5      831
##  6  2013     1     2      536            529         7      840
##  7  2013     1     2      539            545        -6      959
##  8  2013     1     2      554            600        -6      845
##  9  2013     1     2      554            600        -6      841
## 10  2013     1     2      554            600        -6      909
## # ... with 26,152 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Функция <code>filter()</code>, как и многие другие расширения пакета <code>dplyr</code>, не изменяют исходных данных. Желаемый фильтр нужно присвоить в новую переменную</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</code></pre></div>
<p>Если нужно выполнить присвоение и вывод на экран, нужно обнять выражение скобками.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</code></pre></div>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 832 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div id="section-2.3.2.1" class="section level4">
<h4><span class="header-section-number">2.3.2.1</span> Сравнения</h4>
<p>Операторы сравнения стандартные <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code></p>
<p>Компьюьеры используют арифметику конечной точности. Поэтому</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.3.2.2</span> Логические операторы</h4>
<p>Булевы операторы: И - <code>&amp;</code>, ИЛИ - <code>|</code>, НЕ - <code>!</code>, исключающее ИЛИ - <code>xor()</code>. Полный набор булевых операций показан на рисунке.</p>
<div class="figure">
<img src="img/transform-logical.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Что следует помнить. Добавляя булевы операторы в функцию <code>filter()</code> необходимо помнить, что сравнивать нужно программно, а не так как это звучит лексически. То есть, если мы хотим все авиарейсы отправленные в декабре и ноябре, нужно писать так.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">|</span><span class="st"> </span>month <span class="op">==</span><span class="st"> </span><span class="dv">12</span>))</code></pre></div>
<pre><code>## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    11     1        5           2359         6      352
##  2  2013    11     1       35           2250       105      123
##  3  2013    11     1      455            500        -5      641
##  4  2013    11     1      539            545        -6      856
##  5  2013    11     1      542            545        -3      831
##  6  2013    11     1      549            600       -11      912
##  7  2013    11     1      550            600       -10      705
##  8  2013    11     1      554            600        -6      659
##  9  2013    11     1      554            600        -6      826
## 10  2013    11     1      554            600        -6      749
## # ... with 55,393 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Что дословно произносится как “отфильтровать все полёты из набора данных <code>flights</code>, вылетавших в месяце ноябре или в месяце декабре”. Можно следовать лексическому соответствию, но для этого нужно использовать оператор <code>%in%</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">12</span>)))</code></pre></div>
<pre><code>## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    11     1        5           2359         6      352
##  2  2013    11     1       35           2250       105      123
##  3  2013    11     1      455            500        -5      641
##  4  2013    11     1      539            545        -6      856
##  5  2013    11     1      542            545        -3      831
##  6  2013    11     1      549            600       -11      912
##  7  2013    11     1      550            600       -10      705
##  8  2013    11     1      554            600        -6      659
##  9  2013    11     1      554            600        -6      826
## 10  2013    11     1      554            600        -6      749
## # ... with 55,393 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><strong>Закон Моргана:</strong></p>
<ul>
<li><p><code>!(x &amp; y) == !x | !y</code></p></li>
<li><p><code>!(x | y) == !x &amp; !y</code></p></li>
</ul>
<p>Проверь на рисунке выше.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.3.2.3</span> Отсутствующие значения</h4>
<p>Функция <code>filter()</code> включает в вывод лишь те строки, для которых условие имеет значение <code>TRUE</code>. <code>FALSE</code> и <code>NA</code> исключаются.</p>
<p>Для того чтобы проверить является ли используемое значением отсутствующим можно использовать функцию <code>is.na()</code></p>
</div>
<div id="-5.2.4.1" class="section level4">
<h4><span class="header-section-number">2.3.2.4</span> Упражнение 5.2.4.1</h4>
<div class="question">
<p>Найдите все авиарейсы, которые</p>
</div>
<ul>
<li>а) задержались с прилётом на два и более часа</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(arr_delay &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">120</span>))</code></pre></div>
<pre><code>## # A tibble: 10,200 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      811            630       101     1047
##  2  2013     1     1      848           1835       853     1001
##  3  2013     1     1      957            733       144     1056
##  4  2013     1     1     1114            900       134     1447
##  5  2013     1     1     1505           1310       115     1638
##  6  2013     1     1     1525           1340       105     1831
##  7  2013     1     1     1549           1445        64     1912
##  8  2013     1     1     1558           1359       119     1718
##  9  2013     1     1     1732           1630        62     2028
## 10  2013     1     1     1803           1620       103     2008
## # ... with 10,190 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>б) вылетали в Хьюстон (аэропорты IAH и HOU)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(hou_flight &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dest <span class="op">==</span><span class="st"> &quot;IAH&quot;</span> <span class="op">|</span><span class="st"> </span>dest <span class="op">==</span><span class="st"> &quot;HOU&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 9,313 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      623            627        -4      933
##  4  2013     1     1      728            732        -4     1041
##  5  2013     1     1      739            739         0     1104
##  6  2013     1     1      908            908         0     1228
##  7  2013     1     1     1028           1026         2     1350
##  8  2013     1     1     1044           1045        -1     1352
##  9  2013     1     1     1114            900       134     1447
## 10  2013     1     1     1205           1200         5     1503
## # ... with 9,303 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>в) Обслуживались авиакомпаниями United, American or Delta</li>
</ul>
<p>Для того чтобы узнать аббревиатуры перевозчиков, смотрим <code>airlanes</code> в хэлпе</p>
<p>Получается: United - это <code>UA</code>, American - <code>AA</code>, Delta - <code>DL</code>. Тогда искомые данные это:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(three_carriers &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, carrier <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;UA&quot;</span>, <span class="st">&quot;AA&quot;</span>, <span class="st">&quot;DL&quot;</span>)))</code></pre></div>
<pre><code>## # A tibble: 139,504 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      554            600        -6      812
##  5  2013     1     1      554            558        -4      740
##  6  2013     1     1      558            600        -2      753
##  7  2013     1     1      558            600        -2      924
##  8  2013     1     1      558            600        -2      923
##  9  2013     1     1      559            600        -1      941
## 10  2013     1     1      559            600        -1      854
## # ... with 139,494 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>г) Вылетали в летнее время (июль, август, сентябрь). Странное у них летнее время</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sum_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)))</code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7     1        1           2029       212      236
##  2  2013     7     1        2           2359         3      344
##  3  2013     7     1       29           2245       104      151
##  4  2013     7     1       43           2130       193      322
##  5  2013     7     1       44           2150       174      300
##  6  2013     7     1       46           2051       235      304
##  7  2013     7     1       48           2001       287      308
##  8  2013     7     1       58           2155       183      335
##  9  2013     7     1      100           2146       194      327
## 10  2013     7     1      100           2245       135      337
## # ... with 86,316 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>д) Прилетали с опозданием более чем на два часа но не задерживались с вылетом</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(dep_arr_delay &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>, dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>))</code></pre></div>
<pre><code>## # A tibble: 29 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    27     1419           1420        -1     1754
##  2  2013    10     7     1350           1350         0     1736
##  3  2013    10     7     1357           1359        -2     1858
##  4  2013    10    16      657            700        -3     1258
##  5  2013    11     1      658            700        -2     1329
##  6  2013     3    18     1844           1847        -3       39
##  7  2013     4    17     1635           1640        -5     2049
##  8  2013     4    18      558            600        -2     1149
##  9  2013     4    18      655            700        -5     1213
## 10  2013     5    22     1827           1830        -3     2217
## # ... with 19 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>е) Вылетали с задержкое не менее чем на час, но наверстывали более 30 минут во время полёта. Если полёт проходит ровно, то задержка отправления равна задержке прибытия. <code>Или dep_delay - arr_delay == 0</code>. Так как самолёт наверстал в пути, значит разница равна не нулю, она больше 30.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(speedy_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dep_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">60</span>, dep_delay <span class="op">-</span><span class="st"> </span>arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span> ))</code></pre></div>
<pre><code>## # A tibble: 1,844 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1     2205           1720       285       46
##  2  2013     1     1     2326           2130       116      131
##  3  2013     1     3     1503           1221       162     1803
##  4  2013     1     3     1839           1700        99     2056
##  5  2013     1     3     1850           1745        65     2148
##  6  2013     1     3     1941           1759       102     2246
##  7  2013     1     3     1950           1845        65     2228
##  8  2013     1     3     2015           1915        60     2135
##  9  2013     1     3     2257           2000       177       45
## 10  2013     1     4     1917           1700       137     2135
## # ... with 1,834 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>ж) Вылетали между полуночью и 6 часами утра включительно</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(moon &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dep_time <span class="op">==</span><span class="st"> </span><span class="dv">2400</span> <span class="op">|</span><span class="st"> </span>dep_time <span class="op">&lt;=</span><span class="st"> </span><span class="dv">600</span>))</code></pre></div>
<pre><code>## # A tibble: 9,373 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 9,363 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.2.4.2" class="section level4">
<h4><span class="header-section-number">2.3.2.5</span> Упражнение 5.2.4.2</h4>
<div class="question">
<p>Another useful <code>dplyr</code> filtering helper is <code>between()</code>. What does it do? Can you use it to simplify the code needed to answer the previous challenges?</p>
</div>
<p>Из описания в хэлпе, функция <code>between()</code> это короткая запись для <code>&gt;= left &amp; x &lt;= right</code>. Или если быть точным: <code>between(x, left, right)</code>. Конечно её гораздо удобнее использовать. Эту функцию можно применить к упражнению <em>г</em>. Сравним:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sum_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)))</code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7     1        1           2029       212      236
##  2  2013     7     1        2           2359         3      344
##  3  2013     7     1       29           2245       104      151
##  4  2013     7     1       43           2130       193      322
##  5  2013     7     1       44           2150       174      300
##  6  2013     7     1       46           2051       235      304
##  7  2013     7     1       48           2001       287      308
##  8  2013     7     1       58           2155       183      335
##  9  2013     7     1      100           2146       194      327
## 10  2013     7     1      100           2245       135      337
## # ... with 86,316 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(sum_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, <span class="kw">between</span>(month, <span class="dv">7</span>, <span class="dv">9</span>)))</code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7     1        1           2029       212      236
##  2  2013     7     1        2           2359         3      344
##  3  2013     7     1       29           2245       104      151
##  4  2013     7     1       43           2130       193      322
##  5  2013     7     1       44           2150       174      300
##  6  2013     7     1       46           2051       235      304
##  7  2013     7     1       48           2001       287      308
##  8  2013     7     1       58           2155       183      335
##  9  2013     7     1      100           2146       194      327
## 10  2013     7     1      100           2245       135      337
## # ... with 86,316 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.2.4.3" class="section level4">
<h4><span class="header-section-number">2.3.2.6</span> Упражнение 5.2.4.3</h4>
<div class="question">
<p>How many flights have a missing <code>dep_time</code>? What other variables are missing? What might these rows represent?</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">filter</span>(flights, <span class="kw">is.na</span>(dep_time)))</code></pre></div>
<pre><code>## # A tibble: 8,255 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA
##  2  2013     1     1       NA           1935        NA       NA
##  3  2013     1     1       NA           1500        NA       NA
##  4  2013     1     1       NA            600        NA       NA
##  5  2013     1     2       NA           1540        NA       NA
##  6  2013     1     2       NA           1620        NA       NA
##  7  2013     1     2       NA           1355        NA       NA
##  8  2013     1     2       NA           1420        NA       NA
##  9  2013     1     2       NA           1321        NA       NA
## 10  2013     1     2       NA           1545        NA       NA
## # ... with 8,245 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Ответ 8255 рейсов. Так же отсутствуют: <code>dep_delay</code>, <code>arr_time</code>, <code>arr_delay</code>. Вероятно это отменённые рейсы.</p>
</div>
<div id="-5.2.4.4" class="section level4">
<h4><span class="header-section-number">2.3.2.7</span> Упражнение 5.2.4.4</h4>
<div class="question">
<p>Why is <code>NA ^ 0</code> not missing? Why is <code>NA | TRUE</code> not missing? Why is <code>FALSE &amp; NA</code> not missing? Can you figure out the general rule? (<code>NA * 0</code> is a tricky counterexample!)</p>
</div>
<ol style="list-style-type: decimal">
<li><p><code>NA ^ 0 == 1</code>. Всё в точности с математикой, которая говорит, что любое значение в степени 0 == 1 или точнее <span class="math inline">\(x^0=1\)</span></p></li>
<li><p><code>NA | TRUE</code>. Всё или ПРАВДА всегда правда :</p></li>
</ol>
<table>
<thead>
<tr class="header">
<th align="center"><span class="math inline">\(a\)</span></th>
<th align="center"><span class="math inline">\(b\)</span></th>
<th align="center"><span class="math inline">\(a\lor b\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><code>FALSE &amp; NA</code>. Всё и ЛОЖЬ всегда Ложь.</li>
</ol>
<table>
<thead>
<tr class="header">
<th align="center"><span class="math inline">\(a\)</span></th>
<th align="center"><span class="math inline">\(b\)</span></th>
<th align="center"><span class="math inline">\(a\land b\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><code>NA * 0</code>. Причина по которой значение неопределено. Это то что умножение чего угодна на бесконечность, равно бесконечности, или правильнее - неопределённое значение. <a href="https://ru.wikipedia.org/wiki/NaN">нечисло</a></li>
</ol>
</div>
</div>
<div id="-----arange" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Перестановка строк с помощью функции <code>arange()</code></h3>
<p>Синтаксис у этой функции такой же как у фильтра. <code>arranga()</code> сортирует по убыванию, а не фильтрует список. При этом отсутствующие значения всегда остаются в конце. При этом для сортировки по возрастанию используется функция <code>desc()</code></p>
<div id="-5.3.1.1" class="section level4">
<h4><span class="header-section-number">2.3.3.1</span> Упражнение 5.3.1.1</h4>
<div class="question">
<p>How could you use <code>arrange()</code> to sort all missing values to the start? (Hint: use <code>is.na()</code>).</p>
</div>
<p>Берём пример из учебника.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(arr_delay))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     7    22     2257            759       898      121
##  9  2013    12     5      756           1700       896     1058
## 10  2013     5     3     1133           2055       878     1250
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Добавляем как подсказывают, функцию <code>is.na()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(<span class="kw">is.na</span>(arr_delay)))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1     1525           1530        -5     1934
##  2  2013     1     1     1528           1459        29     2002
##  3  2013     1     1     1740           1745        -5     2158
##  4  2013     1     1     1807           1738        29     2251
##  5  2013     1     1     1939           1840        59       29
##  6  2013     1     1     1952           1930        22     2358
##  7  2013     1     1     2016           1930        46       NA
##  8  2013     1     1       NA           1630        NA       NA
##  9  2013     1     1       NA           1935        NA       NA
## 10  2013     1     1       NA           1500        NA       NA
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.3.1.2" class="section level4">
<h4><span class="header-section-number">2.3.3.2</span> Упражнение 5.3.1.2</h4>
<div class="question">
<p>Sort <code>flights</code> to find the most delayed flights. Find the flights that left earliest.</p>
</div>
<p>Чтобы найти рейсы с самыми большими задержками, сортируем по возрастанию соответствующий столбец <code>dep_delay</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     6    27      959           1900       899     1236
##  9  2013     7    22     2257            759       898      121
## 10  2013    12     5      756           1700       896     1058
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Первые десять рейсов задерживались на время от 896 минут до 1301, это почти сутки (21 час) в аэропорте. Уффф.</p>
<p>Чтобы найти рейсы с самым ранним временем вылета, сортируем по убыванию соответствующий столбец <code>dep_time</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, dep_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    13        1           2249        72      108
##  2  2013     1    31        1           2100       181      124
##  3  2013    11    13        1           2359         2      442
##  4  2013    12    16        1           2359         2      447
##  5  2013    12    20        1           2359         2      430
##  6  2013    12    26        1           2359         2      437
##  7  2013    12    30        1           2359         2      441
##  8  2013     2    11        1           2100       181      111
##  9  2013     2    24        1           2245        76      121
## 10  2013     3     8        1           2355         6      431
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Ожидаемо, это время вылетов в полночь и минутой позднее.</p>
</div>
<div id="-5.3.1.3" class="section level4">
<h4><span class="header-section-number">2.3.3.3</span> Упражнение 5.3.1.3</h4>
<div class="question">
<p>Sort <code>flights</code> to find the fastest flights.</p>
</div>
<p>Чтобы найти самые быстрые полёты, отсортируем все полёты по времени проведённому в воздухе. Это столбец <code>air_time</code> отсортированный по возрастанию.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, air_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    16     1355           1315        40     1442
##  2  2013     4    13      537            527        10      622
##  3  2013    12     6      922            851        31     1021
##  4  2013     2     3     2153           2129        24     2247
##  5  2013     2     5     1303           1315       -12     1342
##  6  2013     2    12     2123           2130        -7     2211
##  7  2013     3     2     1450           1500       -10     1547
##  8  2013     3     8     2026           1935        51     2131
##  9  2013     3    18     1456           1329        87     1533
## 10  2013     3    19     2226           2145        41     2305
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.3.1.4" class="section level4">
<h4><span class="header-section-number">2.3.3.4</span> Упражнение 5.3.1.4</h4>
<div class="question">
<p>Which flights traveled the longest? Which traveled the shortest?</p>
</div>
<p>Сделаем так, сначала отсортируем по расстоянию, а потом по времени проведённому в воздухе</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      857            900        -3     1516
##  2  2013     1     2      909            900         9     1525
##  3  2013     1     3      914            900        14     1504
##  4  2013     1     4      900            900         0     1516
##  5  2013     1     5      858            900        -2     1519
##  6  2013     1     6     1019            900        79     1558
##  7  2013     1     7     1042            900       102     1620
##  8  2013     1     8      901            900         1     1504
##  9  2013     1     9      641            900      1301     1242
## 10  2013     1    10      859            900        -1     1449
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Самые длинные полёты из <code>JFK</code> в <code>HNL</code>. Из Нью-Йорка в Гонолулу - 4983 мили.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      857            900        -3     1516
##  2  2013     1     2      909            900         9     1525
##  3  2013     1     3      914            900        14     1504
##  4  2013     1     4      900            900         0     1516
##  5  2013     1     5      858            900        -2     1519
##  6  2013     1     6     1019            900        79     1558
##  7  2013     1     7     1042            900       102     1620
##  8  2013     1     8      901            900         1     1504
##  9  2013     1     9      641            900      1301     1242
## 10  2013     1    10      859            900        -1     1449
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><a href="https://www.google.com/maps/dir/Гонолулу+(HNL),+300+Rodgers+Blvd,+Honolulu,+HI+96819,+США/JFK+International+Airport,+New+York,+NY,+USA/@27.4344347,-126.6384014,4.03z/data=!4m14!4m13!1m5!1m1!1s0x7c006f943168f55f:0x7ed111b1cbf331df!2m2!1d-157.9250736!2d21.3245132!1m5!1m1!1s0x89c26650d5404947:0xec4fb213489f11f0!2m2!1d-73.7781391!2d40.6413111!3e4">Полёт длится 691 минуту</a></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, distance)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7    27       NA            106        NA       NA
##  2  2013     1     3     2127           2129        -2     2222
##  3  2013     1     4     1240           1200        40     1333
##  4  2013     1     4     1829           1615       134     1937
##  5  2013     1     4     2128           2129        -1     2218
##  6  2013     1     5     1155           1200        -5     1241
##  7  2013     1     6     2125           2129        -4     2224
##  8  2013     1     7     2124           2129        -5     2212
##  9  2013     1     8     2127           2130        -3     2304
## 10  2013     1     9     2126           2129        -3     2217
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Самый короткий из <code>EWR</code> в <code>LGA</code>. Перелёт в пределах Нью-Йорка, который по всей видимости не состоялся, так как у него нету времени полёта. Следующий за ним это полёт из Нью-Арка в Филадельфию - 80 миль. Посмотрим ещё и по времени, проведённому в воздухе:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">arrange</span>(flights, distance, air_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7    27       NA            106        NA       NA
##  2  2013     2     3     2153           2129        24     2247
##  3  2013     2    12     2123           2130        -7     2211
##  4  2013     1     6     2125           2129        -4     2224
##  5  2013     1    23     2128           2129        -1     2221
##  6  2013     2    10     2127           2129        -2     2209
##  7  2013     2     1     2128           2129        -1     2216
##  8  2013     3    30     1942           1950        -8     2026
##  9  2013     1     7     2124           2129        -5     2212
## 10  2013     1    14     2128           2129        -1     2215
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div id="-----select" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Выбор столбцов с помощью функции <code>select()</code></h3>
<p>Функция <code>select()</code> помогает отобрать из фрейма данных необходимые столбцы. Синтаксис простой и привычный</p>
<ul>
<li>Указать конкретные столбцы можно через запятую</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, year, month, day)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<ul>
<li>Указать столбцы в промежутке</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, year<span class="op">:</span>day)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<ul>
<li>Выбрать всех столбцов за исключением тех, которые находятся между столбцами включая последние</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="op">-</span>(year<span class="op">:</span>day))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      517            515         2      830            819        11
##  2      533            529         4      850            830        20
##  3      542            540         2      923            850        33
##  4      544            545        -1     1004           1022       -18
##  5      554            600        -6      812            837       -25
##  6      554            558        -4      740            728        12
##  7      555            600        -5      913            854        19
##  8      557            600        -3      709            723       -14
##  9      557            600        -3      838            846        -8
## 10      558            600        -2      753            745         8
## # ... with 336,766 more rows, and 10 more variables: carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li><p><code>start_with(&quot;abc&quot;)</code> - соответствует именам, начинающимся с последовательности символов “abc”</p></li>
<li><p><code>end_with(&quot;abc&quot;)</code> - соответствует именам, заканчивающимся последовательностью символов “abc”</p></li>
<li><p><code>contains(&quot;abc&quot;)</code> - соответствует именам, содержащим последовательности символов “abc”</p></li>
<li><p><code>matches(&quot;(.)\\1&quot;)</code> - выбирает переменные, соответствующие регулярному выражению.</p></li>
<li><p><code>num_range(&quot;x&quot;, 1:3)</code> - соответствует <code>x1</code>, <code>x2</code>, <code>x3</code></p></li>
<li><p>Переименовать переменные, сохраняя все переменные не указанные в явном виде</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rename</span>(flights, <span class="dt">tail_num =</span> tailnum)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tail_num &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>Переместить в начало переменные.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, time_hour, air_time, <span class="kw">everything</span>())</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##    time_hour           air_time  year month   day dep_time sched_dep_time
##    &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
##  1 2013-01-01 05:00:00      227  2013     1     1      517            515
##  2 2013-01-01 05:00:00      227  2013     1     1      533            529
##  3 2013-01-01 05:00:00      160  2013     1     1      542            540
##  4 2013-01-01 05:00:00      183  2013     1     1      544            545
##  5 2013-01-01 06:00:00      116  2013     1     1      554            600
##  6 2013-01-01 05:00:00      150  2013     1     1      554            558
##  7 2013-01-01 06:00:00      158  2013     1     1      555            600
##  8 2013-01-01 06:00:00       53  2013     1     1      557            600
##  9 2013-01-01 06:00:00      140  2013     1     1      557            600
## 10 2013-01-01 06:00:00      138  2013     1     1      558            600
## # ... with 336,766 more rows, and 12 more variables: dep_delay &lt;dbl&gt;,
## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
<div id="-5.4.1.1" class="section level4">
<h4><span class="header-section-number">2.3.4.1</span> Упражнение 5.4.1.1</h4>
<div class="question">
<p>Brainstorm as many ways as possible to select <code>dep_time</code>, <code>dep_delay</code>, <code>arr_time</code>, and <code>arr_delay</code> from <code>flights</code>.</p>
</div>
<ol style="list-style-type: decimal">
<li>Указать конкретные столбцы через запятую</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, dep_time, dep_delay, arr_time, arr_delay)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Указать столбцы в промежутке и исключить лишние</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, dep_time<span class="op">:</span>arr_delay, <span class="op">-</span>sched_dep_time, <span class="op">-</span>sched_arr_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Изощренный способ. Перенесём в начало нужные столбцы, отбросим лишние в промежутке</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_flights &lt;-<span class="st"> </span><span class="kw">select</span>(flights, dep_time, dep_delay, arr_time, arr_delay, <span class="kw">everything</span>())
<span class="kw">select</span>(new_flights, <span class="op">-</span>(year<span class="op">:</span>time_hour))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Укажем номера столбцов</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">9</span>)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time sched_dep_time dep_delay arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1      517            515         2        11
##  2      533            529         4        20
##  3      542            540         2        33
##  4      544            545        -1       -18
##  5      554            600        -6       -25
##  6      554            558        -4        12
##  7      555            600        -5        19
##  8      557            600        -3       -14
##  9      557            600        -3        -8
## 10      558            600        -2         8
## # ... with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Столбцы начинающиеся на <code>dep_</code> и <code>arr_</code></li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">starts_with</span>(<span class="st">&quot;dep_&quot;</span>), <span class="kw">starts_with</span>(<span class="st">&quot;arr_&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # ... with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Столбцы содержащие и не содержащие</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;_time&quot;</span>), <span class="kw">contains</span>(<span class="st">&quot;_delay&quot;</span>), <span class="op">-</span><span class="kw">contains</span>(<span class="st">&quot;sched&quot;</span>), <span class="op">-</span><span class="kw">contains</span>(<span class="st">&quot;air&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time arr_time dep_delay arr_delay
##       &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1      517      830         2        11
##  2      533      850         4        20
##  3      542      923         2        33
##  4      544     1004        -1       -18
##  5      554      812        -6       -25
##  6      554      740        -4        12
##  7      555      913        -5        19
##  8      557      709        -3       -14
##  9      557      838        -3        -8
## 10      558      753        -2         8
## # ... with 336,766 more rows</code></pre>
</div>
<div id="-5.4.1.2" class="section level4">
<h4><span class="header-section-number">2.3.4.2</span> Упражнение 5.4.1.2</h4>
<div class="question">
<p>What happens if you include the name of a variable multiple times in a <code>select()</code> call?</p>
</div>
<p>Если одна и та же переменная указана несколько раз, она всё равно отобразится один раз</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, dep_time, dep_time, dep_time)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    dep_time
##       &lt;int&gt;
##  1      517
##  2      533
##  3      542
##  4      544
##  5      554
##  6      554
##  7      555
##  8      557
##  9      557
## 10      558
## # ... with 336,766 more rows</code></pre>
</div>
<div id="-5.4.1.3" class="section level4">
<h4><span class="header-section-number">2.3.4.3</span> Упражнение 5.4.1.3</h4>
<div class="question">
<p>What does the <code>one_of()</code> function do? Why might it be helpful in conjunction with this vector?</p>
</div>
<p>Функция <code>one_of()</code> берёт переменные в символьном векторе. Это может быть полезно, если как в примере у нас есть символьный вектор значений, которые необходимо взять</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)
<span class="kw">select</span>(flights, <span class="kw">one_of</span>(vars))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 5
##     year month   day dep_delay arr_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1  2013     1     1         2        11
##  2  2013     1     1         4        20
##  3  2013     1     1         2        33
##  4  2013     1     1        -1       -18
##  5  2013     1     1        -6       -25
##  6  2013     1     1        -4        12
##  7  2013     1     1        -5        19
##  8  2013     1     1        -3       -14
##  9  2013     1     1        -3        -8
## 10  2013     1     1        -2         8
## # ... with 336,766 more rows</code></pre>
</div>
<div id="-5.4.1.4" class="section level4">
<h4><span class="header-section-number">2.3.4.4</span> Упражнение 5.4.1.4</h4>
<div class="question">
<p>Does the result of running the following code surprise you? How do the select helpers deal with case by default? How can you change that default?</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;
##  1      517            515      830            819      227
##  2      533            529      850            830      227
##  3      542            540      923            850      160
##  4      544            545     1004           1022      183
##  5      554            600      812            837      116
##  6      554            558      740            728      150
##  7      555            600      913            854      158
##  8      557            600      709            723       53
##  9      557            600      838            846      140
## 10      558            600      753            745      138
## # ... with 336,766 more rows, and 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<p>Удивительно, что <code>contains()</code> невосприимчив к регистру:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;time&quot;</span>))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;
##  1      517            515      830            819      227
##  2      533            529      850            830      227
##  3      542            540      923            850      160
##  4      544            545     1004           1022      183
##  5      554            600      812            837      116
##  6      554            558      740            728      150
##  7      555            600      913            854      158
##  8      557            600      709            723       53
##  9      557            600      838            846      140
## 10      558            600      753            745      138
## # ... with 336,766 more rows, and 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<p>Оказывается, это регшулируется параметром <code>ignore.case</code> который по умолчанию <code>TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>, <span class="dt">ignore.case =</span> <span class="ot">FALSE</span>))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 0</code></pre>
<p>Вот список всех функций, согласно хэлпу, невосприимчивых по умолчанию к регистру:</p>
<ul>
<li><p><code>starts_with(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
<li><p><code>ends_with(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
<li><p><code>contains(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
<li><p><code>matches(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
</ul>
</div>
</div>
<div id="-----mutate" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Добавление столбцов с помощью функции <code>mutate()</code></h3>
<p>Функция <code>mutate()</code> позволяет добавлять в конец исходного фрейма данных столбцы.</p>
<p>Сделаем чуть более показательный набор данных:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, 
  year<span class="op">:</span>day, 
  <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), 
  distance, 
  air_time
)</code></pre></div>
<p>Теперь добавим в конец этого набора дополнительные вычисления</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights_sml,
  <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,
  <span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span>
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day dep_delay arr_delay distance air_time  gain speed
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227    -9  370.
##  2  2013     1     1         4        20     1416      227   -16  374.
##  3  2013     1     1         2        33     1089      160   -31  408.
##  4  2013     1     1        -1       -18     1576      183    17  517.
##  5  2013     1     1        -6       -25      762      116    19  394.
##  6  2013     1     1        -4        12      719      150   -16  288.
##  7  2013     1     1        -5        19     1065      158   -24  404.
##  8  2013     1     1        -3       -14      229       53    11  259.
##  9  2013     1     1        -3        -8      944      140     5  405.
## 10  2013     1     1        -2         8      733      138   -10  319.
## # ... with 336,766 more rows</code></pre>
<p>Чтобы сохранить только вычисления, без указания дополнительных столбцов, используется функция <code>transmute()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(flights,
  <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,
  <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,
  <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     gain hours gain_per_hour
##    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1    -9 3.78          -2.38
##  2   -16 3.78          -4.23
##  3   -31 2.67         -11.6 
##  4    17 3.05           5.57
##  5    19 1.93           9.83
##  6   -16 2.5           -6.4 
##  7   -24 2.63          -9.11
##  8    11 0.883         12.5 
##  9     5 2.33           2.14
## 10   -10 2.3           -4.35
## # ... with 336,766 more rows</code></pre>
<div id="---" class="section level4">
<h4><span class="header-section-number">2.3.5.1</span> Полезные функции создания объектов</h4>
<ul>
<li><p>Арифметические операторы <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code></p></li>
<li><p>Модулярная арифметика. Целочисленное деление - <code>%/%</code>. Взятие остатка - <code>%%</code>. Показательный пример:</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(flights,
  dep_time,
  <span class="dt">hour =</span> dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>,
  <span class="dt">minute =</span> dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    dep_time  hour minute
##       &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1      517     5     17
##  2      533     5     33
##  3      542     5     42
##  4      544     5     44
##  5      554     5     54
##  6      554     5     54
##  7      555     5     55
##  8      557     5     57
##  9      557     5     57
## 10      558     5     58
## # ... with 336,766 more rows</code></pre>
<ul>
<li><p>Логарифмические функции <code>log()</code>, <code>log2</code>, <code>log10()</code></p></li>
<li><p>Смещения. Вперёд - <code>lag()</code>. Назад - <code>lead()</code></p></li>
<li><p>Кумулятивные и скользящие агрегаты. <code>cumsum()</code>, <code>cummin()</code>, <code>cumprod()</code>, <code>cummax()</code>, <code>cummean()</code></p></li>
<li><p>Логические операторы <code>&lt;</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code></p></li>
<li><p>Ранжирование. Функции ранжирования <code>row_number(x)</code>, <code>ntile(x, n)</code>, <code>min_rank(x)</code>, <code>dense_rank(x)</code>,<code>percent_rank(x)</code>, <code>cume_dist(x)</code>. В этих функциях <code>desc()</code> меняет направление.</p></li>
</ul>
</div>
<div id="-5.5.2.1" class="section level4">
<h4><span class="header-section-number">2.3.5.2</span> Упражнение 5.5.2.1</h4>
<div class="question">
<p>Currently <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</p>
</div>
<p>Заданные параметры <code>dep_time</code> and <code>sched_dep_time</code> записаны в формате HHMM. Чтобы получить из исходных данных последовательный формат, необходимо произвести целочисленное деление на 100, и к результату добавить остаток от деления.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(flights,
  dep_time,
  sched_dep_time,
  <span class="dt">dep_time_minute =</span> ((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>,
  <span class="dt">sched_dep_time_minute =</span> ((sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time sched_dep_time dep_time_minute sched_dep_time_minute
##       &lt;int&gt;          &lt;int&gt;           &lt;dbl&gt;                 &lt;dbl&gt;
##  1      517            515             317                   315
##  2      533            529             333                   329
##  3      542            540             342                   340
##  4      544            545             344                   345
##  5      554            600             354                   360
##  6      554            558             354                   358
##  7      555            600             355                   360
##  8      557            600             357                   360
##  9      557            600             357                   360
## 10      558            600             358                   360
## # ... with 336,766 more rows</code></pre>
<p>Можно добавить эти значения в исходную выборку:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">mutate</span>(flights,
  <span class="dt">dep_time_minute =</span> ((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>,
  <span class="dt">sched_dep_time_minute =</span> ((sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 21
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 14 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_time_minute &lt;dbl&gt;,
## #   sched_dep_time_minute &lt;dbl&gt;</code></pre>
</div>
<div id="-5.5.2.2" class="section level4">
<h4><span class="header-section-number">2.3.5.3</span> Упражнение 5.5.2.2</h4>
<div class="question">
<p>Compare <code>air_time</code> with <code>arr_time - dep_time</code>. What do you expect to see? What do you see? What do you need to do to fix it?</p>
</div>
<p>Значения данных <code>dep_time</code> и <code>arr_time</code> это время отправления и время прибытия соответственно записанные в формате HHMM. <code>air_time</code> - это время полёта, записанное в минутах. Естественно, если мы просто вычтем из времени прибытия время отправления в текущем формате, мы не получим <code>air_time</code>.</p>
<p>Таким образом, моё предположение сводится к следующему - чтобы разность <code>arr_time - dep_time</code> и <code>air_time</code> совпадали, необходимо:</p>
<ol style="list-style-type: decimal">
<li>для начала привести их к общей форме записи в минутах.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">transmute</span>(flights,
  air_time,
  <span class="dt">arr_minus_dep =</span> (((arr_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>arr_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">-</span><span class="st"> </span>(((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>)
)</code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    air_time arr_minus_dep
##       &lt;dbl&gt;         &lt;dbl&gt;
##  1      227           193
##  2      227           197
##  3      160           221
##  4      183           260
##  5      116           138
##  6      150           106
##  7      158           198
##  8       53            72
##  9      140           161
## 10      138           115
## # ... with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li><p>затем необходимо учесть прилёт на другой день</p></li>
<li><p>и ещё необходимо учитывать разное время часовых поясов отлёта и прибытия, так как время в данных указано локальное</p></li>
</ol>
<p>Так как два последних предположения текущим набором данных мне проверить не предвидится возможным, я заглядываю в подсказку</p>
<p>В имеющимся в сети <a href="https://jrnold.github.io/r4ds-exercise-solutions/data-transformation.html">решении</a> заданий от пользователя jrnold я нашёл что, в своём предположении я не учёл особенность сбора данных. Особенность заключается в том, что время отправления и время прибытия считаются от момента когда самолёт оторвал шасси и коснулся земли соответсвенно. В это время не входит время проведённое при посадке и прохождении регистрации, которое учитано в <code>air_time</code>.</p>
</div>
<div id="-5.5.2.3" class="section level4">
<h4><span class="header-section-number">2.3.5.4</span> Упражнение 5.5.2.3</h4>
<div class="question">
<p>Compare <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code>. How would you expect those three numbers to be related?</p>
</div>
<p>Разберёмся в том, что каждый столбец данных представляет.</p>
<ul>
<li><p><code>sched_dep_time</code> - это запланированное время вылета в формате HHMM по местному времени</p></li>
<li><p><code>dep_time</code> - это актуальное время вылета в формате HHMM по местному времени</p></li>
<li><p><code>dep_delay</code> - это время задержки вылета в минутах. Отрицательное время будет показывать ранний вылет.</p></li>
</ul>
<p>То есть по сути <code>dep_delay</code> это разность между актуальным временем вылета и запланированным временем. Чтобы разность <code>dep_time - sched_dep_time</code> соотносилась с <code>dep_delay</code>, формат HHMM необходимо перевести в минуты.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_new_dep &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights,
  <span class="dt">dep_delay_ng =</span> dep_time <span class="op">-</span><span class="st"> </span>sched_dep_time,
  <span class="dt">dep_delay_ok =</span> (((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">-</span><span class="st"> </span>
<span class="st">    </span>(((sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>))</code></pre></div>
<p>Однако подобный формат записи приводит к тому, что если вылет фактический и вылет планируемый находятся по разную сторону от полуночи, то разница будет большой либо в отрицательную, либо в положительную сторону. Что конечно же не соответствует фактическому времени задержки. Тут вроде бы <code>dep_delay</code> и полученный в результате приведения к одному формату и разности планируемого и фактического времени <code>dep_delay_ok</code> сходятся. Однако уже даже при обратной сортировке видно, что есть большие различия, связанные, как я уже сказал, с особенностью внесения этих данных:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new_delay &lt;-<span class="st"> </span><span class="kw">select</span>(flights_new_dep, dep_delay_ok, dep_delay, dep_delay_ng)
<span class="kw">arrange</span>(new_delay, <span class="kw">desc</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    dep_delay_ok dep_delay dep_delay_ng
##           &lt;dbl&gt;     &lt;dbl&gt;        &lt;int&gt;
##  1         -139      1301         -259
##  2         -303      1137         -503
##  3         -314      1126         -514
##  4         -426      1014         -706
##  5         -435      1005         -755
##  6         -480       960         -800
##  7          911       911         1511
##  8         -541       899         -941
##  9          898       898         1498
## 10         -544       896         -944
## # ... with 336,766 more rows</code></pre>
</div>
<div id="-5.5.2.4" class="section level4">
<h4><span class="header-section-number">2.3.5.5</span> Упражнение 5.5.2.4</h4>
<div class="question">
<p>Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefully read the documentation for <code>min_rank()</code>.</p>
</div>
<p>Задрежка вылета <code>dep_delay</code>. Найти 10 авиарейсов, можно функцией <code>arrange()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay)))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     6    27      959           1900       899     1236
##  9  2013     7    22     2257            759       898      121
## 10  2013    12     5      756           1700       896     1058
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Но так мы возьмём все связанные данные. Чтобы ограничить выдачу, можно использовать функцию <code>min_rank()</code>. Я воспользуюсь этой функцией чтобы взять первые 10 авиарейсов по рангу. Сначала посмотрим что делает <code>min_rank()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">transmute</span>(flights, <span class="dt">dep_delay_rank =</span> <span class="kw">min_rank</span>(<span class="op">-</span>dep_delay)))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    dep_delay_rank
##             &lt;int&gt;
##  1         114150
##  2         103893
##  3         114150
##  4         144947
##  5         258934
##  6         209494
##  7         234113
##  8         185276
##  9         185276
## 10         163760
## # ... with 336,766 more rows</code></pre>
<p>Теперь добавим к имеющемуся набору данных новых столбуц с обратным ранжированным столбцом <code>dep_delay()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(flights_delayed &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights, <span class="dt">dep_delay_rank =</span> <span class="kw">min_rank</span>(<span class="op">-</span>dep_delay)))</code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_delay_rank &lt;int&gt;</code></pre>
<p>Затем возьмём первые 10 значений:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(<span class="kw">filter</span>(flights_delayed, dep_delay_rank <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>))</code></pre></div>
<pre><code>## # A tibble: 10 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     1    10     1121           1635      1126     1239
##  3  2013    12     5      756           1700       896     1058
##  4  2013     3    17     2321            810       911      135
##  5  2013     4    10     1100           1900       960     1342
##  6  2013     6    15     1432           1935      1137     1607
##  7  2013     6    27      959           1900       899     1236
##  8  2013     7    22      845           1600      1005     1044
##  9  2013     7    22     2257            759       898      121
## 10  2013     9    20     1139           1845      1014     1457
## # ... with 13 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;, dep_delay_rank &lt;int&gt;</code></pre>
</div>
<div id="-5.5.2.5" class="section level4">
<h4><span class="header-section-number">2.3.5.6</span> Упражнение 5.5.2.5</h4>
<div class="question">
<p>What does <code>1:3 + 1:10</code> return? Why?</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></code></pre></div>
<pre><code>## Warning in 1:3 + 1:10: длина большего объекта не является произведением
## длины меньшего объекта</code></pre>
<pre><code>##  [1]  2  4  6  5  7  9  8 10 12 11</code></pre>
<p>Это возвращает такой странный результат, потому что при складывании двух векторов разной длинны, происходит “дополнение” длинного вектора, повторением сначала значениями короткого. Проще говоря: <code>c(1 + 1, 2 + 2, 3 + 3, 1 + 4, 2 + 5, 3 + 6, 1 + 7, 2 + 8, 3 + 9, 1 + 10)</code></p>
</div>
<div id="-5.5.2.6" class="section level4">
<h4><span class="header-section-number">2.3.5.7</span> Упражнение 5.5.2.6</h4>
<div class="question">
<p>What trigonometric functions does R provide?</p>
</div>
<p>В R есть следующие тригонометрические функции.</p>
<ul>
<li><p>Простые: <code>cos(x)</code>, <code>sin(x)</code>, <code>tan(x)</code></p></li>
<li><p>Арки <code>acos(x)</code>, <code>asin(x)</code>, <code>atan(x)</code>, <code>atan2(y, x)</code></p></li>
<li><p>И ещё <code>cospi(x)</code>, <code>sinpi(x)</code>, <code>tanpi(x)</code></p></li>
</ul>
</div>
</div>
<div id="------summarize" class="section level3">
<h3><span class="header-section-number">2.3.6</span> Получение групповых итогов с помощью функции <code>summarize()</code></h3>
<div id="-----" class="section level4">
<h4><span class="header-section-number">2.3.6.1</span> Объединение нескольких операций с помощью канала</h4>
<p>Мы хотим исследовать связь между расстоянием <code>distance</code> и средним временем задержки рейса <code>arr_delay</code> для всех пунктов приема и вылета.</p>
<p>Для этого необходимо.</p>
<ol style="list-style-type: decimal">
<li>Группирование рейсов по пунктам назначения</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">by_dest &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, dest)</code></pre></div>
<ol style="list-style-type: decimal">
<li>Получение сводных данных (суммарных), касающихся расстояний <code>distance</code>, среднего времени задержки <code>mean(arr_delay)</code> и количества авиарейсов <code>count()</code>.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">delay &lt;-<span class="st"> </span><span class="kw">summarise</span>(by_dest,
  <span class="dt">count =</span> <span class="kw">n</span>(),
  <span class="dt">dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
  <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
)</code></pre></div>
<ol style="list-style-type: decimal">
<li>Фильтрация данных с целью исключения точек данных, создающих информационный шум, и аэропорта Гонолулу <code>NHL</code>, который распологется на расстоянии, почти вдвое превышающем расстояние до следующего ближайшего аэропорта.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">delay &lt;-<span class="st"> </span><span class="kw">filter</span>(delay, count <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, dest <span class="op">!=</span><span class="st"> &quot;NHL&quot;</span>)
<span class="kw">ggplot</span>(<span class="dt">data =</span> delay, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> delay)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> count), <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<p>Это решение, но такой код трудно писать, поскольку нужно присваивать каждому промежуточному фрейму данных отдельное имя. Есть такая штука как канал <code>%&gt;%</code>. Канал фактически позволяет говорить “затем”.</p>
<p>Сначала сгруппируй %&gt;% (затем) просуммируй по количеству значений и посчитай среднее в группах по <code>distance</code> и <code>arr_delay</code> %&gt;% (затем) отфильтруй. Получаются все те же самые блоки, только без промежуточных присваиваний имён.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">delays &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">count =</span> <span class="kw">n</span>(),
    <span class="dt">dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(count <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, dest <span class="op">!=</span><span class="st"> &quot;NHL&quot;</span>)</code></pre></div>
</div>
<div id="--1" class="section level4">
<h4><span class="header-section-number">2.3.6.2</span> Отсутствующие значения</h4>
<p>Я предполагал, что параметр <code>na.rm</code> отвечает за нормальное распределение. Но это было неверное предположение. Разберём пример.</p>
<p>Если суммировать число с пропущенным значением (неизвестным), результат будет тоже неизвестным:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="ot">NA</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Параметр <code>na.rm</code> отвечает за пропущенные значения. Точнее за игнорирование пропущенных значений.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1    NA
##  2  2013     1     2    NA
##  3  2013     1     3    NA
##  4  2013     1     4    NA
##  5  2013     1     5    NA
##  6  2013     1     6    NA
##  7  2013     1     7    NA
##  8  2013     1     8    NA
##  9  2013     1     9    NA
## 10  2013     1    10    NA
## # ... with 355 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
<p>В последующем будет использоваться этот срез данных, так что здесь же объявим его:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_canceled &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))
not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.4 
##  2  2013     1     2 13.7 
##  3  2013     1     3 10.9 
##  4  2013     1     4  8.97
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.56
##  9  2013     1     9  2.30
## 10  2013     1    10  2.84
## # ... with 355 more rows</code></pre>
</div>
<div id="section-2.3.6.3" class="section level4">
<h4><span class="header-section-number">2.3.6.3</span> Счетчики</h4>
<p>Счётчик наблюдений это <code>n()</code>. Счетчик отсутствующих значений это <code>sum(!is.na(x))</code>. Проведём лабораторную работу.</p>
<p>Предположим что нас интересуют самолёты с наибольшим средним временем задержки.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">delays &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay))
<span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-147-1.png" width="672" /></p>
<p>Такой график показывает распределение, почти как гистограммы, только вместо столбцов тут линии. Как и в гистограммах, такие графики показывают количество наблюдений, попавших в заданный диапазон. Постройнный график имеет диапазон 10. Поиграемся немного:</p>
<p>Установив значение диапазона 1 - получаем “зашумлённый” график</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-148-1.png" width="672" /></p>
<p>Устанавливая значение диапазона = 100, получаем график в котором потеряно много ценной информации, график получился переглаженным</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
<p>Соответственно 1000 не даёт понять даже общую тенденцию, потому что крайние точки выборки, находятся далеко от 1000.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">1000</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-150-1.png" width="672" /></p>
<p>Но вернёмся к нашему распределению с диапазоном в 10 точек. Можно посмотреть под другим углом на эти данные если построить диаграмму рассеяния:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">delays &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                  </span><span class="co"># Присвой значению `delays` данные `not_canceled` ЗАТЕМ</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Сгруппируй эти данные по номерам самолётов ЗАТЕМ</span>
<span class="st">  </span><span class="kw">summarise</span>(
    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),  <span class="co"># Посчитаем среднее значение по параметру `arr_delay`, не учитывая пропуски</span>
    <span class="dt">n =</span> <span class="kw">n</span>()                                 <span class="co"># Со счётчиком количества наблюдений</span>
  )
<span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> delay)) <span class="op">+</span><span class="st">     </span><span class="co"># Построим точечную диаграмму рассеяния количества наблюдений от времени задержки</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)                  <span class="co"># Точки сделаем прозрачными</span></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>На этой диаграмме видно, что хвост у основного распределения длинный. Тоесть от основного количества точек в “районе” нуля есть единичные выбросы вплоть до 300 по оси ординат <code>delay</code>. Часто от такого хвоста, то есть выбросов, необходимо будет избавляться. Как советуют в книге, помогает в этом использование пакета <code>ggplot</code> в потоке <code>dplyr</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">delays <span class="op">%&gt;%</span><span class="st">                                   </span><span class="co"># Возьми данные `delays` ЗАТЕМ</span>
<span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>) <span class="op">%&gt;%</span><span class="st">                         </span><span class="co"># отфильтруй группы, в которых количество наблюдений меньше `25` ЗАТЕМ</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> delay)) <span class="op">+</span><span class="st">  </span><span class="co"># Построй точечную диаграмму `n` от `delay`. Точки сделай прозрачными на 1/10.</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)</code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>
<p>Рассмотрим связь между средней результативностью отбивающих в бейсболе и количеством их вызовов на удар.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">batting &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(Lahman<span class="op">::</span>Batting)      <span class="co"># Из большого набора данных `Lahman` возьми фрейм данных `Batting`.</span>

batters &lt;-<span class="st"> </span>batting <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Присвой переменной `batters` значение `batting` ЗАТЕМ</span>
<span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st">                   </span><span class="co"># группируй данные по ID игрока ЗАТЕМ</span>
<span class="st">  </span><span class="kw">summarise</span>(                               <span class="co"># посчитай средний коэффициент результативности</span>
    <span class="dt">ba =</span> <span class="kw">sum</span>(H, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span> (AB, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),     
    <span class="dt">ab =</span> <span class="kw">sum</span>(AB, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)             <span class="co"># Определи суммарное количество возможностей выполнить удар `ab`. </span>
  )

batters <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Возьми данные `batters` ЗАТЕМ</span>
<span class="st">  </span><span class="kw">filter</span>(ab <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Возьми данные с количеством возможностей на удар больше 100 ЗАТЕМ</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> ab, <span class="dt">y =</span> ba)) <span class="op">+</span><span class="st">  </span><span class="co"># Построй диаграмму рассеяния возможностей удара от от коэффициента результативности</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)                  <span class="co"># А так же сглаженную прямую без построения доверительного интервала</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-153-1.png" width="672" /></p>
<p>Средний коэффициент результативности - суммарное количество ударов, делённое на суммарное количество возможностей сделать удар?.</p>
<p>Этот график показывает положительную зависимость коэффициент результативности от количества ударов.</p>
<p>Тут есть одна закономерная интересность - чем меньше количество наблюдений, тем существеннее влияет единичное наблюдение на среднее значение. Следствием этого утверждения является тот факт, что самые высокие коэффициенты у тех кому просто повезло разочек ударить по мячу и больше не вызываться к отбиванию:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">batters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(ba))</code></pre></div>
<pre><code>## # A tibble: 18,915 x 3
##    playerID     ba    ab
##    &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 abramge01     1     1
##  2 banisje01     1     1
##  3 bartocl01     1     1
##  4 bassdo01      1     1
##  5 berrijo01     1     1
##  6 birasst01     1     2
##  7 bruneju01     1     1
##  8 burnscb01     1     1
##  9 cammaer01     1     1
## 10 campsh01      1     1
## # ... with 18,905 more rows</code></pre>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">2.3.6.4</span> Полезные итоговые функции</h4>
<ul>
<li><p>Меры положения - <code>mean(x)</code>, <code>median(x)</code></p></li>
<li><p>Меры изменчивости - среднеквадратичное отклонение <code>sd()</code>, межквартильный размах - <code>IQR()</code>, медианное абсолютное отклонение - <code>mad()</code></p></li>
<li><p>Меры ранжирования - максимум <code>max(x)</code>, минимум<code>min(x)</code>, квантиль 25% <code>quantile(x, 0,25)</code>, квантиль 75% <code>quantile(x, 0,75)</code></p></li>
<li><p>Порядковые меры - первый <code>first(x)</code>, последний <code>last(x)</code>, точная позиция <code>nth(x, 2)</code></p></li>
<li><p>Счетчики - размер текущей группы <code>n()</code>, количество значений не являющихся отсутствующими <code>sum(!is.na(x))</code>, количество уникальных значений<code>n_distinct(x)</code></p></li>
<li><p>Подсчет количества и долей логических значений <code>sum(x &gt; 10)</code>, <code>mean(y == 0)</code></p></li>
</ul>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">2.3.6.5</span> Группирование по нескольким переменным</h4>
<p>Когда мы группируем данные по нескольким переменным, каждый сформированный итог уменьшает колтчество уровней группировки на единицу. Это упрощает последовательное свёртывание.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)
(per_day &lt;-<span class="st"> </span><span class="kw">summarize</span>(daily, <span class="dt">flights =</span> <span class="kw">n</span>()))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day flights
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1     842
##  2  2013     1     2     943
##  3  2013     1     3     914
##  4  2013     1     4     915
##  5  2013     1     5     720
##  6  2013     1     6     832
##  7  2013     1     7     933
##  8  2013     1     8     899
##  9  2013     1     9     902
## 10  2013     1    10     932
## # ... with 355 more rows</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(per_month &lt;-<span class="st"> </span><span class="kw">summarize</span>(per_day, <span class="dt">flights =</span> <span class="kw">sum</span>(flights)))</code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   year [?]
##     year month flights
##    &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1   27004
##  2  2013     2   24951
##  3  2013     3   28834
##  4  2013     4   28330
##  5  2013     5   28796
##  6  2013     6   28243
##  7  2013     7   29425
##  8  2013     8   29327
##  9  2013     9   27574
## 10  2013    10   28889
## 11  2013    11   27268
## 12  2013    12   28135</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(per_year &lt;-<span class="st"> </span><span class="kw">summarise</span>(per_month, <span class="dt">flights =</span> <span class="kw">sum</span>(flights)))</code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    year flights
##   &lt;int&gt;   &lt;int&gt;
## 1  2013  336776</code></pre>
<p>Буду аккуратен когда буду свёртывать например медианы. Сумма групповых сумм равна общей сумме, но медиана групповых медиан не равна общей медиане.</p>
</div>
<div id="section-2.3.6.6" class="section level4">
<h4><span class="header-section-number">2.3.6.6</span> Разгруппирование</h4>
<p>Тут всё просто - нужно что-то разгруппировать, пользуемся функцией <code>ungroup()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">daily <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">            </span><span class="co"># больше не группировать по дате</span>
<span class="st">  </span><span class="kw">summarize</span>(<span class="dt">flights =</span> <span class="kw">n</span>()) <span class="co"># все рейсы</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   flights
##     &lt;int&gt;
## 1  336776</code></pre>
</div>
<div id="-5.6.7.1" class="section level4">
<h4><span class="header-section-number">2.3.6.7</span> Упражнение 5.6.7.1</h4>
<div class="question">
<p>Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios:</p>
<ul>
<li><p>A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time.</p></li>
<li><p>A flight is always 10 minutes late.</p></li>
<li><p>A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of the time.</p></li>
<li><p>99% of the time a flight is on time. 1% of the time it’s 2 hours late.</p></li>
</ul>
<p>Which is more important: arrival delay or departure delay?</p>
</div>
<p>Разобьём ответ на части.</p>
<ul>
<li>Часть 1. Вначале напридумываем как минимум пять типичных характеристик времени задержки для групп авиарейсов:</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Мера положения - <em>среднее время</em> задержки вылета самолёта</p></li>
<li><p>Мера положения - <em>среднее время</em> задержки прилёта самолёта</p></li>
<li><p>Мера изменчивости - <em>среднеквадратичное отклонение</em> времени задержки вылета самолёта</p></li>
<li><p>Мера изменчивости - <em>среднеквадратичное отклонение</em> времени задержки прилёта самолёта</p></li>
<li><p>Мера ранжирования - <em>максимальное</em> время задержки вылет самолёта</p></li>
<li><p>Мера ранжирования - <em>максимальное</em> время задержки прилёта самолёта</p></li>
</ol>
<p>Далее будем придумывать способы доступа к придуманным характеристикам. Группировать будем по дню вылета. В зависимости от задачи, группировать можно по разным параметрам - аэропорт прилёта, аэропорт вылета, время в пути, по любому доступному временному срезу, по номеру авиарейса.</p>
<p><em>Cреднее время</em> задержки вылета самолёта</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dep_delay_mean &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Присвой в dep_delay_mean значения из набора данных flights ЗАТЕМ</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">                             </span><span class="co"># Сгруппируй по дням прилёта</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        <span class="co"># В dep_mean посчитай среднее время задержки вылета</span>
<span class="kw">ggplot</span>(dep_delay_mean) <span class="op">+</span><span class="st">                                     </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, dep_mean), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span><span class="co"># Построй прямые по дням без стандартного отклонения</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                            <span class="co"># Сгруппируй построения по месяцам в три строки</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<p><em>Cреднее время</em> задержки прилёта самолёта</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">arr_delay_mean &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">                           </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_mean =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        
<span class="kw">ggplot</span>(arr_delay_mean) <span class="op">+</span><span class="st">                                     </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, arr_mean), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                            </code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<p><em>Cреднеквадратичное отклонение</em> времени задержки вылета самолёта</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">arr_delay_sd &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">                               </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">       </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_sd =</span> <span class="kw">sd</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))      
<span class="kw">ggplot</span>(arr_delay_sd) <span class="op">+</span><span class="st">                                     </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, arr_sd), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                   </code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
<p><em>Cреднеквадратичное отклонение</em> времени задержки прилёта самолёта</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dep_delay_sd &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">     </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">                    </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_sd =</span> <span class="kw">sd</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))     
<span class="kw">ggplot</span>(dep_delay_sd) <span class="op">+</span><span class="st">                                     </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, dep_sd), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                         </code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
<p><em>Максимальное</em> время задержки вылета самолёта</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dep_delay_max &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">               </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">         </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_max =</span> <span class="kw">max</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        
<span class="kw">ggplot</span>(dep_delay_max) <span class="op">+</span><span class="st">                                     </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, dep_max), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
<p><em>Максимальное</em> время задержки прилета самолёта</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">arr_delay_max &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">               </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">         </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_max =</span> <span class="kw">max</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        
<span class="kw">ggplot</span>(arr_delay_max) <span class="op">+</span><span class="st">                                     </span>
<span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, arr_max), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)</code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<ul>
<li><p>Часть 2 Рассмотрим предложенные сценарии</p></li>
<li><p>Я буду группировать по номеру авиарейса, перевозчику, пункту вылета и пункту назначения. Делаю так, посколько номер авиарейса в данном наборе данных не является уникальным. Под одним номером, в зависимости от перевозчика могут авиарейсы с разными пунктами вылета и назначения Итак, авиарейсы, опережающие график на 15 минут в 50% случаев. Таких рейсов немного:</p></li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fast &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                          </span><span class="co"># присвой в fast фрейм данных not_canceled (это flights без пропусков)</span>
<span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span><span class="st">     </span><span class="co"># сгруппируй по номеру полёта, аэропорту вылета и аэропорту прилёта</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fast_15min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">15</span>))  <span class="co"># посчитай долю рейсов, которые опережали график на 15 минут</span>
<span class="kw">filter</span>(fast, fast_15min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)                   <span class="co"># отфильтруй рейсы, у которых задержка 15 минут составляет 50% от всех случаев</span></code></pre></div>
<pre><code>## # A tibble: 3 x 5
## # Groups:   flight, carrier, origin [3]
##   flight carrier origin dest  fast_15min
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
## 1    998 UA      EWR    MSY          0.5
## 2   1780 US      LGA    CLT          0.5
## 3   3425 9E      LGA    GSP          0.5</code></pre>
<ul>
<li>Поиск авиарейсов, опаздывающих на 15 минут в 50% случаев, отличается только знаком в задержке вылета</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slow &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">slow_15min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">15</span>))
<span class="kw">filter</span>(slow, slow_15min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)</code></pre></div>
<pre><code>## # A tibble: 20 x 5
## # Groups:   flight, carrier, origin [20]
##    flight carrier origin dest  slow_15min
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
##  1    246 UA      EWR    RSW          0.5
##  2    339 UA      EWR    DEN          0.5
##  3    342 UA      EWR    MIA          0.5
##  4    448 UA      EWR    LAX          0.5
##  5    562 UA      LGA    DEN          0.5
##  6    794 WN      EWR    STL          0.5
##  7   1059 UA      LGA    DEN          0.5
##  8   1061 UA      EWR    ORD          0.5
##  9   1483 UA      EWR    CLE          0.5
## 10   1575 UA      EWR    PBI          0.5
## 11   1598 UA      EWR    CLE          0.5
## 12   1622 UA      EWR    LAX          0.5
## 13   1675 UA      EWR    IAH          0.5
## 14   1718 UA      EWR    SFO          0.5
## 15   1939 DL      LGA    DEN          0.5
## 16   2048 US      JFK    CLT          0.5
## 17   2315 DL      JFK    MIA          0.5
## 18   4346 EV      EWR    CLE          0.5
## 19   4659 EV      EWR    CLT          0.5
## 20   5560 EV      LGA    BGR          0.5</code></pre>
<ul>
<li>Авиарейсы, которые постоянно опаздывают на 10 минут</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">instant_slow &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Постоянно опаздывающие, означает, что доля вылетов с опозданием</span>
<span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># в 10 минут, дл таких рейсов равна 100%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">inst_slow_10min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">10</span>))
<span class="kw">filter</span>(instant_slow, inst_slow_10min <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) </code></pre></div>
<pre><code>## # A tibble: 27 x 5
## # Groups:   flight, carrier, origin [27]
##    flight carrier origin dest  inst_slow_10min
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt;
##  1     52 WN      LGA    BNA                 1
##  2    107 WN      LGA    MKE                 1
##  3    239 UA      EWR    DEN                 1
##  4    255 US      JFK    PHL                 1
##  5    402 UA      EWR    PDX                 1
##  6    468 UA      EWR    SFO                 1
##  7    544 WN      LGA    BNA                 1
##  8    676 UA      EWR    DEN                 1
##  9   1014 UA      LGA    DEN                 1
## 10   1037 UA      EWR    MCO                 1
## # ... with 17 more rows</code></pre>
<ul>
<li>Авиарейсы, опережающие график на 30 минут в 50% случаев (таких нету)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fast_<span class="dv">30</span> &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fast_30min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="dv">30</span>))
<span class="kw">filter</span>(fast_<span class="dv">30</span>, fast_30min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)</code></pre></div>
<pre><code>## # A tibble: 0 x 5
## # Groups:   flight, carrier, origin [0]
## # ... with 5 variables: flight &lt;int&gt;, carrier &lt;chr&gt;, origin &lt;chr&gt;,
## #   dest &lt;chr&gt;, fast_30min &lt;dbl&gt;</code></pre>
<ul>
<li>Авиарейсы, опаздывающие на 30 минут в 50% случаев</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">slow_<span class="dv">30</span> &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">slow_30min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">30</span>))
<span class="kw">filter</span>(slow_<span class="dv">30</span>, slow_30min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)</code></pre></div>
<pre><code>## # A tibble: 7 x 5
## # Groups:   flight, carrier, origin [7]
##   flight carrier origin dest  slow_30min
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
## 1    746 UA      EWR    ORD          0.5
## 2   1248 UA      EWR    SAT          0.5
## 3   1250 UA      EWR    ORD          0.5
## 4   1288 UA      EWR    SEA          0.5
## 5   1554 UA      EWR    DEN          0.5
## 6   4287 EV      EWR    MSP          0.5
## 7   4301 EV      EWR    RDU          0.5</code></pre>
<ul>
<li>Авиарейсы, которые в 99% случаев укладывались в график и в 1% случаев опаздывали на 2 часа</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">interest_flight &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                  </span><span class="co"># Так как условия два, поэтому и параметра будем вводить два</span>
<span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># то и критерия будет два</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">interest1 =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">120</span>),      <span class="co"># Первый для условия в 1% с опозданием на два часа</span>
            <span class="dt">interest2 =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">0</span>))        <span class="co"># Второй для условия в 99% со своевременным вылетом</span>
<span class="kw">filter</span>(interest_flight, interest1 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="dv">01</span>, interest2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="dv">99</span>) </code></pre></div>
<pre><code>## # A tibble: 7,895 x 6
## # Groups:   flight, carrier, origin [4,546]
##    flight carrier origin dest  interest1 interest2
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1      1 UA      EWR    ORD           0         0
##  2      1 WN      LGA    MDW           0         0
##  3      2 WN      EWR    MDW           0         0
##  4      3 B6      JFK    FLL           0         0
##  5      3 UA      EWR    BOS           0         0
##  6      3 UA      EWR    DEN           0         0
##  7      3 UA      EWR    TPA           0         0
##  8      7 WN      LGA    DEN           0         0
##  9     10 UA      EWR    ORD           0         0
## 10     12 UA      EWR    LAX           0         0
## # ... with 7,885 more rows</code></pre>
<ul>
<li>Часть 3 Отвечаю на вопрос о более важном факторе</li>
</ul>
<p>Для ответа на тот вопрос необходимо определить критерии оценки.</p>
<p>С одной стороны, если говорить о своевременности предоставляемых данных, то задержка прилёта несёт больший урон. Поскольку находясь в воздухе, пассажир не сможет предупредить кого-то о своей задержке (в случае деловой встречи, например) и от пассажира в воздухе ничего не зависит. Получив информацию о том, что рейс задерживает вылет ещё на земле, пассажир может скоординировать свои планы, поменять в конце концов способ перемещения.</p>
</div>
<div id="-5.6.7.2" class="section level4">
<h4><span class="header-section-number">2.3.6.8</span> Упражнение 5.6.7.2</h4>
<div class="question">
<p>Come up with another approach that will give you the same output as <code>not_canceled %&gt;% count(dest)</code> and <code>not_canceled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>).</p>
</div>
<p>Для вывода количества значений используется счётчки <code>count()</code> входящий в пакет <code>dplyr</code>. Можно обойти и просуммировать другими доступными средствами, например используя функцию <code>sum(!is.na(x)</code>, которая считает количество различных уникальных значений.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_canceled <span class="op">%&gt;%</span><span class="st">                          </span><span class="co"># в наборе данных</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st">                      </span><span class="co"># сгруппируй по направлению вылета</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dest =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(dest))) <span class="co"># создай переменную в которую просуммируй уникальные значения по направлениям</span></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  sum_dest
##    &lt;chr&gt;    &lt;int&gt;
##  1 ABQ        254
##  2 ACK        264
##  3 ALB        418
##  4 ANC          8
##  5 ATL      16837
##  6 AUS       2411
##  7 AVL        261
##  8 BDL        412
##  9 BGR        358
## 10 BHM        269
## # ... with 94 more rows</code></pre>
<p>или можно посчитать через счётчик <code>n()</code>, что видится более изящным решением, и делает код более читаемым.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dest =</span> <span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  sum_dest
##    &lt;chr&gt;    &lt;int&gt;
##  1 ABQ        254
##  2 ACK        264
##  3 ALB        418
##  4 ANC          8
##  5 ATL      16837
##  6 AUS       2411
##  7 AVL        261
##  8 BDL        412
##  9 BGR        358
## 10 BHM        269
## # ... with 94 more rows</code></pre>
<p>Чтобы посчитать сумму по всем перемещениям из второго условия, достаточно сделать следующее:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dist =</span> <span class="kw">sum</span>(distance))</code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
##    tailnum sum_dist
##    &lt;chr&gt;      &lt;dbl&gt;
##  1 D942DN      3418
##  2 N0EGMQ    239143
##  3 N10156    109664
##  4 N102UW     25722
##  5 N103US     24619
##  6 N104UW     24616
##  7 N10575    139903
##  8 N105UW     23618
##  9 N107US     21677
## 10 N108UW     32070
## # ... with 4,027 more rows</code></pre>
</div>
<div id="-5.6.7.3" class="section level4">
<h4><span class="header-section-number">2.3.6.9</span> Упражнение 5.6.7.3</h4>
<div class="question">
<p>Our definition of cancelled flights (<code>is.na(dep_delay) | is.na(arr_delay)</code> ) is slightly suboptimal. Why? Which is the most important column?</p>
</div>
<p>Потому что мы берём и те рейсы у которых нет данных о задержки вылета, и те рейсы у которых нет данных о задержки прилёта. Во второе множество могут попасть самолёты, у которых был вылет. Таким образом, фактически такой рейс неправильно называть отменённым. Определяющим столбцом в этом случае будет время в полёте, если нет информации и о времени полёта, то с большей вероятностью этот рейс отменили. В довесок, лучше заменить логическое ИЛИ на логическое И:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="kw">is.na</span>(dep_delay) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(arr_delay))</code></pre></div>
<pre><code>## # A tibble: 8,255 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA
##  2  2013     1     1       NA           1935        NA       NA
##  3  2013     1     1       NA           1500        NA       NA
##  4  2013     1     1       NA            600        NA       NA
##  5  2013     1     2       NA           1540        NA       NA
##  6  2013     1     2       NA           1620        NA       NA
##  7  2013     1     2       NA           1355        NA       NA
##  8  2013     1     2       NA           1420        NA       NA
##  9  2013     1     2       NA           1321        NA       NA
## 10  2013     1     2       NA           1545        NA       NA
## # ... with 8,245 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>ТАким образом, выражение ниже, больше похоже на отменённые рейсы</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(flights, <span class="kw">is.na</span>(dep_delay) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(arr_delay) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(air_time))</code></pre></div>
<pre><code>## # A tibble: 8,255 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA
##  2  2013     1     1       NA           1935        NA       NA
##  3  2013     1     1       NA           1500        NA       NA
##  4  2013     1     1       NA            600        NA       NA
##  5  2013     1     2       NA           1540        NA       NA
##  6  2013     1     2       NA           1620        NA       NA
##  7  2013     1     2       NA           1355        NA       NA
##  8  2013     1     2       NA           1420        NA       NA
##  9  2013     1     2       NA           1321        NA       NA
## 10  2013     1     2       NA           1545        NA       NA
## # ... with 8,245 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.6.7.4" class="section level4">
<h4><span class="header-section-number">2.3.6.10</span> Упражнение 5.6.7.4</h4>
<div class="question">
<p>Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">not_canceled <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">summarise</span>(<span class="dt">sum_dist =</span> <span class="kw">sum</span>(<span class="kw">is.na</span>(dep_time)))</code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [?]
##     year month   day sum_dist
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;
##  1  2013     1     1        0
##  2  2013     1     2        0
##  3  2013     1     3        0
##  4  2013     1     4        0
##  5  2013     1     5        0
##  6  2013     1     6        0
##  7  2013     1     7        0
##  8  2013     1     8        0
##  9  2013     1     9        0
## 10  2013     1    10        0
## # ... with 355 more rows</code></pre>
<p>ДОДЕЛАТЬ</p>
</div>
<div id="-5.6.7.5" class="section level4">
<h4><span class="header-section-number">2.3.6.11</span> Упражнение 5.6.7.5</h4>
<div class="question">
<p>Which <code>carrier</code> has the worst delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about <code>flights %&gt;% group_by(carrier, dest) %&gt;% summarise(n())</code>)</p>
</div>
</div>
<div id="-5.6.7.6" class="section level4">
<h4><span class="header-section-number">2.3.6.12</span> Упражнение 5.6.7.6</h4>
<div class="question">
<p>Подсчитайте для каждого воздушного судна количество авиарейсов, совершенных до первой задержки более чем на 1 час.</p>
</div>
</div>
<div id="-5.6.7.7" class="section level4">
<h4><span class="header-section-number">2.3.6.13</span> Упражнение 5.6.7.7</h4>
<div class="question">
<p>What does the <code>sort</code> argument to <code>count()</code> do. When might you use it?</p>
</div>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">2.3.7</span> Групповое изменение (и фильтрация)</h3>
<ul>
<li>Найти члены каждой группы имеющие наихудшие показатели</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, 
  year<span class="op">:</span>day, 
  <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), 
  distance, 
  air_time)

flights_sml <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">rank</span>(<span class="kw">desc</span>(arr_delay)) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>)</code></pre></div>
<pre><code>## # A tibble: 3,306 x 7
## # Groups:   year, month, day [365]
##     year month   day dep_delay arr_delay distance air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1       853       851      184       41
##  2  2013     1     1       290       338     1134      213
##  3  2013     1     1       260       263      266       46
##  4  2013     1     1       157       174      213       60
##  5  2013     1     1       216       222      708      121
##  6  2013     1     1       255       250      589      115
##  7  2013     1     1       285       246     1085      146
##  8  2013     1     1       192       191      199       44
##  9  2013     1     1       379       456     1092      222
## 10  2013     1     2       224       207      550       94
## # ... with 3,296 more rows</code></pre>
<ul>
<li>Найти все группы которым соответствует превышение порогового значения</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">popular_dests &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">365</span>)
popular_dests</code></pre></div>
<pre><code>## # A tibble: 332,577 x 19
## # Groups:   dest [77]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 332,567 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>Стандартизировать для вычисоения метрик групп</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">popular_dests <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_delay =</span> arr_delay <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(arr_delay)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, dest, arr_delay, prop_delay)</code></pre></div>
<pre><code>## # A tibble: 131,106 x 6
## # Groups:   dest [77]
##     year month   day dest  arr_delay prop_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1 IAH          11  0.000111 
##  2  2013     1     1 IAH          20  0.000201 
##  3  2013     1     1 MIA          33  0.000235 
##  4  2013     1     1 ORD          12  0.0000424
##  5  2013     1     1 FLL          19  0.0000938
##  6  2013     1     1 ORD           8  0.0000283
##  7  2013     1     1 LAX           7  0.0000344
##  8  2013     1     1 DFW          31  0.000282 
##  9  2013     1     1 ATL          12  0.0000400
## 10  2013     1     1 DTW          16  0.000116 
## # ... with 131,096 more rows</code></pre>
<div id="-5.7.1.1" class="section level4">
<h4><span class="header-section-number">2.3.7.1</span> Упражнение 5.7.1.1</h4>
<div class="question">

</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["r4ds-ex-sol.pdf", "r4ds-ex-sol.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
