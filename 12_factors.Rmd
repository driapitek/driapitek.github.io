---
output: html_document
editor_options: 
  chunk_output_type: console
---

## Работа с факторами с помощью пакета `forcats`

### Введение

Факторы используются для работы с категориальными переменными. Их так же можно использовать если нужно отобразить символьные векторы в порядке следования, отличающимся от алфавитного.

#### Используемые ресурсы

```{r}
library(tidyverse)
library(forcats)
```

### Создание факторов

Предположим есть переменная, в которой внесены названия месяцев

```{r}
x1 <- c("Dec", "Apr", "Jan", "Mar")
```

Есть пару проблем с записью строки в эти перменные

* Возможны опечатки

```{r}
x2 <- c("Dec", "Apr", "Jam", "Mar")
```

* Список сортируется не правильно, т.е. он сортируется не по месяцам а по алфавиту.

```{r}
sort(x1)
```

Обе проблемы решаются использованием фактора. Чтобы создать фактор нужно

1. Создать список допустимых уровней.

```{r}
month_levels <- c(
  "Jan", "Feb", "Mar", "Apr", "May", "Jun", 
  "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
)
```

1. Теперь можно создать фактор

```{r}
y1 <- factor(x1, levels = month_levels)
y1
sort(y1)
```

Любые значения не входящие в этот набор автоматически будут преобразовываться в `NA`. 

```{r}
y2 <- factor(x2, levels = month_levels)
y2
```

Можно получить сообщения об ошибках, используя функцию `readr::parse_factor()`

```{r}
y2 <- parse_factor(x2, levels = month_levels)
```

Если опустить уровни, они будут браться из данных в алфавитном порядке

```{r}
factor(x1)
```

Иногда предпочтительнее, чтобы порядок уровней совпадал с порядком первого появления в данных. Можно сделать это в процессе создания фактора путем задания уровней для функции `unique()` или уже постфактум с помощью функции `fct_inorder()`

```{r}
f1 <- factor(x1, levels = unique(x1))
f1
f2 <- x1 %>% factor() %>% fct_inorder()
f2
```

Если потребуется непосредственный доступ к набору допустимых уровней, это можно сделать с помошью функции `levels()`

```{r}
levels(f2)
```

### Опрос GSS
