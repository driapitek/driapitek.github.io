<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Решение упражнений из книги R Science</title>
  <meta name="description" content="Здесь будут публиковаться решения заданий из книги">
  <meta name="generator" content="bookdown <!--bookdown:version--> and GitBook 2.6.7">

  <meta property="og:title" content="Решение упражнений из книги R Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Здесь будут публиковаться решения заданий из книги" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Решение упражнений из книги R Science" />
  
  <meta name="twitter:description" content="Здесь будут публиковаться решения заданий из книги" />
  

<meta name="author" content="Stas Masuta">


<meta name="date" content="2019-07-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/htmlwidgets-1.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">Решение упражнений из книги R Science</h1>
<p class="author"><em>Stas Masuta</em></p>
<p class="date"><em>2019-07-30</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a><span class="toc-section-number">1</span> Введение</a></li>
<li><a href="#-"><span class="toc-section-number">2</span> Предварительный анализ</a><ul>
<li><a href="#----ggplot2"><span class="toc-section-number">2.1</span> Визуализация данных с помощью <code>ggplot2</code></a><ul>
<li><a href="#-1"><span class="toc-section-number">2.1.1</span> Введение</a></li>
<li><a href="#-"><span class="toc-section-number">2.1.2</span> Первые шаги</a></li>
<li><a href="#-"><span class="toc-section-number">2.1.3</span> Эстетика визуализации</a></li>
<li><a><span class="toc-section-number">2.1.4</span> Панели</a></li>
<li><a href="#-"><span class="toc-section-number">2.1.5</span> Геометрические объекты</a></li>
<li><a href="#-"><span class="toc-section-number">2.1.6</span> Статистические преобразования</a></li>
<li><a href="#-"><span class="toc-section-number">2.1.7</span> Позиционные настройки</a></li>
<li><a href="#-"><span class="toc-section-number">2.1.8</span> Системы координат</a></li>
<li><a href="#--"><span class="toc-section-number">2.1.9</span> Многослойная грамматика графики</a></li>
</ul></li>
<li><a href="#--"><span class="toc-section-number">2.2</span> Рабочий процесс: основы</a><ul>
<li><a href="#--"><span class="toc-section-number">2.2.1</span> Основы написания кода</a></li>
<li><a href="#-"><span class="toc-section-number">2.2.2</span> Вызов функций</a></li>
</ul></li>
<li><a href="#-----dplyr"><span class="toc-section-number">2.3</span> Преобразование данных с помощью пакета <code>dplyr</code></a><ul>
<li><a href="#-2"><span class="toc-section-number">2.3.1</span> Введение</a></li>
<li><a href="#-----filter"><span class="toc-section-number">2.3.2</span> Фильтрация строк с помощью функции <code>filter()</code></a></li>
<li><a href="#-----arange"><span class="toc-section-number">2.3.3</span> Перестановка строк с помощью функции <code>arange()</code></a></li>
<li><a href="#-----select"><span class="toc-section-number">2.3.4</span> Выбор столбцов с помощью функции <code>select()</code></a></li>
<li><a href="#-----mutate"><span class="toc-section-number">2.3.5</span> Добавление столбцов с помощью функции <code>mutate()</code></a></li>
<li><a href="#------summarize"><span class="toc-section-number">2.3.6</span> Получение групповых итогов с помощью функции <code>summarize()</code></a></li>
<li><a href="#---"><span class="toc-section-number">2.3.7</span> Групповое видоизменение (и фильтрация)</a></li>
</ul></li>
<li><a href="#---"><span class="toc-section-number">2.4</span> Организация рабочего процесса: скрипты</a><ul>
<li><a href="#-"><span class="toc-section-number">2.4.1</span> Выполнение кода</a></li>
<li><a href="#--rstudio"><span class="toc-section-number">2.4.2</span> Диагностические средства RStudio</a></li>
</ul></li>
<li><a href="#--"><span class="toc-section-number">2.5</span> Предварительный анализ данных</a><ul>
<li><a href="#-3"><span class="toc-section-number">2.5.1</span> Введение</a></li>
<li><a><span class="toc-section-number">2.5.2</span> Вопросы</a></li>
<li><a><span class="toc-section-number">2.5.3</span> Вариация</a></li>
<li><a href="#--2"><span class="toc-section-number">2.5.4</span> Отсутствующие значения</a></li>
<li><a><span class="toc-section-number">2.5.5</span> Ковариация</a></li>
<li><a href="#----"><span class="toc-section-number">2.5.6</span> Шаблоны поведения переменных и модели</a></li>
<li><a href="#--ggplot"><span class="toc-section-number">2.5.7</span> Вызов функций <code>ggplot</code></a></li>
<li><a href="#-"><span class="toc-section-number">2.5.8</span> Дополнительная информация</a></li>
</ul></li>
<li><a href="#---"><span class="toc-section-number">2.6</span> Организация рабочего процесса: проекты</a><ul>
<li><a href="#---"><span class="toc-section-number">2.6.1</span> Что является вашим достоянием</a></li>
<li><a href="#---"><span class="toc-section-number">2.6.2</span> Где находится ваш анализ</a></li>
<li><a href="#--"><span class="toc-section-number">2.6.3</span> Пути и каталоги</a></li>
<li><a href="#-rstudio"><span class="toc-section-number">2.6.4</span> Проекты RStudio</a></li>
<li><a><span class="toc-section-number">2.6.5</span> Резюме</a></li>
</ul></li>
</ul></li>
<li><a href="#-"><span class="toc-section-number">3</span> Подготовка данных</a><ul>
<li><a href="#-tibble-----tibble"><span class="toc-section-number">3.1</span> Создание tibble-фреймов с помощью пакета <code>tibble</code></a><ul>
<li><a href="#-4"><span class="toc-section-number">3.1.1</span> Введение</a></li>
<li><a href="#-tibble-"><span class="toc-section-number">3.1.2</span> Создание tibble-фреймов</a></li>
<li><a href="#-tibble----data.frame"><span class="toc-section-number">3.1.3</span> Сравнение tibble-фреймов с фреймами <code>data.frame</code></a></li>
<li><a href="#----"><span class="toc-section-number">3.1.4</span> Взаимодействие с разработанным ранее кодом</a></li>
</ul></li>
<li><a href="#-----reader"><span class="toc-section-number">3.2</span> Импорт данных с помощью пакета <code>reader</code></a><ul>
<li><a href="#-5"><span class="toc-section-number">3.2.1</span> Введение</a></li>
<li><a href="#--"><span class="toc-section-number">3.2.2</span> Приступаем к работе</a></li>
<li><a href="#--"><span class="toc-section-number">3.2.3</span> Синтаксический анализ векторов</a></li>
<li><a href="#--"><span class="toc-section-number">3.2.4</span> Синтаксический анализ файлов</a></li>
<li><a href="#--"><span class="toc-section-number">3.2.5</span> Запись в файл</a></li>
<li><a href="#--"><span class="toc-section-number">3.2.6</span> Другие типы данных</a></li>
</ul></li>
<li><a href="#-----tidyr"><span class="toc-section-number">3.3</span> Аккуратизация данных с помощью пакета <code>tidyr</code></a><ul>
<li><a href="#-6"><span class="toc-section-number">3.3.1</span> Введение</a></li>
<li><a href="#-"><span class="toc-section-number">3.3.2</span> Аккуратные данные</a></li>
<li><a href="#---"><span class="toc-section-number">3.3.3</span> Рассредоточение и сведение столбцов</a></li>
<li><a href="#---"><span class="toc-section-number">3.3.4</span> Разделение и объединение столбцов</a></li>
<li><a href="#--3"><span class="toc-section-number">3.3.5</span> Отсутствующие значения</a></li>
<li><a href="#-"><span class="toc-section-number">3.3.6</span> Учебный пример</a></li>
<li><a href="#-"><span class="toc-section-number">3.3.7</span> Неаккуратные данные</a></li>
</ul></li>
<li><a href="#-----tidyr-1"><span class="toc-section-number">3.4</span> Аккуратизация данных с помощью пакета <code>tidyr</code></a><ul>
<li><a href="#-7"><span class="toc-section-number">3.4.1</span> Введение</a></li>
<li><a href="#-nycflights13-1"><span class="toc-section-number">3.4.2</span> Пакет <code>nycflights13</code></a></li>
<li><a href="#-"><span class="toc-section-number">3.4.3</span> Мутирующие соединения</a></li>
<li><a href="#-"><span class="toc-section-number">3.4.4</span> Фильтрующие соединения</a></li>
<li><a href="#-"><span class="toc-section-number">3.4.5</span> Проблемы соединений</a></li>
<li><a href="#--"><span class="toc-section-number">3.4.6</span> Операции над множествами</a></li>
</ul></li>
<li><a href="#-----tidyr-2"><span class="toc-section-number">3.5</span> Аккуратизация данных с помощью пакета <code>tidyr</code></a><ul>
<li><a href="#-8"><span class="toc-section-number">3.5.1</span> Введение</a></li>
<li><a href="#---"><span class="toc-section-number">3.5.2</span> Основы работы со строками</a></li>
<li><a href="#------"><span class="toc-section-number">3.5.3</span> Поиск соответствия шаблонам с помощью регулярных выражений</a></li>
<li><a><span class="toc-section-number">3.5.4</span> Инструментарий</a></li>
<li><a href="#--"><span class="toc-section-number">3.5.5</span> Другие типы шаблонов</a></li>
<li><a href="#---"><span class="toc-section-number">3.5.6</span> Другие применения регулярных выражений</a></li>
<li><a href="#-stringi"><span class="toc-section-number">3.5.7</span> Пакет <code>stringi</code></a></li>
</ul></li>
<li><a href="#------forcats"><span class="toc-section-number">3.6</span> Работа с факторами с помощью пакета <code>forcats</code></a><ul>
<li><a href="#-9"><span class="toc-section-number">3.6.1</span> Введение</a></li>
<li><a href="#-"><span class="toc-section-number">3.6.2</span> Создание факторов</a></li>
<li><a href="#-gss"><span class="toc-section-number">3.6.3</span> Опрос GSS</a></li>
<li><a href="#--"><span class="toc-section-number">3.6.4</span> Изменение уровней факторов</a></li>
</ul></li>
<li><a href="#--------lubridate"><span class="toc-section-number">3.7</span> Работа с датами и временем с помощью пакета <code>lubridate</code></a><ul>
<li><a href="#-10"><span class="toc-section-number">3.7.1</span> Введение</a></li>
<li><a href="#-----"><span class="toc-section-number">3.7.2</span> Создание перменных описывающих дату и время</a></li>
<li><a href="#-"><span class="toc-section-number">3.7.3</span> Компоненты даты/времени</a></li>
<li><a href="#-"><span class="toc-section-number">3.7.4</span> Временные промежутки</a></li>
<li><a href="#-"><span class="toc-section-number">3.7.5</span> Часовые пояса</a></li>
</ul></li>
</ul></li>
<li><a><span class="toc-section-number">4</span> Программирование</a><ul>
<li><a href="#-11"><span class="toc-section-number">4.1</span> Введение</a></li>
<li><a href="#-"><span class="toc-section-number">4.2</span> Узнайте больше</a></li>
<li><a href="#------magrittr"><span class="toc-section-number">4.3</span> Работа с каналами с помощью пакета <code>magrittr</code></a><ul>
<li><a href="#-12"><span class="toc-section-number">4.3.1</span> Введение</a></li>
<li><a href="#-"><span class="toc-section-number">4.3.2</span> Альтернативы каналам</a></li>
<li><a href="#----"><span class="toc-section-number">4.3.3</span> Когда канал не следует использовать</a></li>
<li><a href="#-"><span class="toc-section-number">4.3.4</span> Другие инструменты</a></li>
</ul></li>
<li><a><span class="toc-section-number">4.4</span> Функции</a><ul>
<li><a href="#-13"><span class="toc-section-number">4.4.1</span> Введение</a></li>
<li><a href="#---"><span class="toc-section-number">4.4.2</span> Когда следует писать функции</a></li>
<li><a href="#-----"><span class="toc-section-number">4.4.3</span> Функции создаются для компьютеров и людей</a></li>
<li><a href="#-"><span class="toc-section-number">4.4.4</span> Условное выполнение</a></li>
<li><a href="#-"><span class="toc-section-number">4.4.5</span> Аргументы функций</a></li>
<li><a href="#-"><span class="toc-section-number">4.4.6</span> Возвращаемые значения</a></li>
<li><a><span class="toc-section-number">4.4.7</span> Окружение</a></li>
</ul></li>
<li><a><span class="toc-section-number">4.5</span> Векторы</a><ul>
<li><a href="#-14"><span class="toc-section-number">4.5.1</span> Введение</a></li>
<li><a href="#---"><span class="toc-section-number">4.5.2</span> Основные сведения о векторах</a></li>
<li><a href="#---"><span class="toc-section-number">4.5.3</span> Важные типы атомарных векторов</a></li>
<li><a href="#--"><span class="toc-section-number">4.5.4</span> Использование атомарных векторов</a></li>
<li><a href="#--"><span class="toc-section-number">4.5.5</span> Рекурсивные векторы (списки)</a></li>
<li><a><span class="toc-section-number">4.5.6</span> Атрибуты</a></li>
<li><a href="#-"><span class="toc-section-number">4.5.7</span> Расширенные векторы</a></li>
</ul></li>
<li><a href="#----purrr"><span class="toc-section-number">4.6</span> Итерирование с помощью пакета <code>purrr</code></a><ul>
<li><a href="#-15"><span class="toc-section-number">4.6.1</span> Введение</a></li>
<li><a href="#-for"><span class="toc-section-number">4.6.2</span> Циклы <code>for</code></a></li>
<li><a href="#--for"><span class="toc-section-number">4.6.3</span> Варианты цикла <code>for</code></a></li>
<li><a href="#-for--"><span class="toc-section-number">4.6.4</span> Циклы <code>for</code> и функционалы</a></li>
<li><a href="#--map"><span class="toc-section-number">4.6.5</span> Функции семейства <code>map</code></a></li>
<li><a href="#-"><span class="toc-section-number">4.6.6</span> Обработка ошибок</a></li>
<li><a href="#--map----"><span class="toc-section-number">4.6.7</span> Функции семейства <code>map</code> с несоколькими входными переменными</a></li>
<li><a href="#--walk"><span class="toc-section-number">4.6.8</span> Функции семейства <code>walk</code></a></li>
<li><a href="#---for"><span class="toc-section-number">4.6.9</span> Другие шаблоны циклов <code>for</code></a></li>
</ul></li>
</ul></li>
<li><a><span class="toc-section-number">5</span> Моделирование</a><ul>
<li><a href="#----"><span class="toc-section-number">5.0.1</span> Выдвижение гипотез и их подтверждение</a></li>
<li><a href="#-----modelr"><span class="toc-section-number">5.1</span> Базовое моделирование при помощи пакета <code>modelr</code></a><ul>
<li><a href="#-16"><span class="toc-section-number">5.1.1</span> Введение</a></li>
<li><a href="#-"><span class="toc-section-number">5.1.2</span> Простая модель</a></li>
<li><a href="#-"><span class="toc-section-number">5.1.3</span> Визуализация моделей</a></li>
<li><a href="#---"><span class="toc-section-number">5.1.4</span> Формулы и семейства моделей</a></li>
<li><a href="#--5"><span class="toc-section-number">5.1.5</span> Отсутствующие значения</a></li>
<li><a href="#--"><span class="toc-section-number">5.1.6</span> Другие семейства моделей</a></li>
</ul></li>
<li><a href="#-"><span class="toc-section-number">5.2</span> Создание модели</a><ul>
<li><a href="#-17"><span class="toc-section-number">5.2.1</span> Введение</a></li>
<li><a href="#------"><span class="toc-section-number">5.2.2</span> Почему бриллианты низкого качества оказались более дорогими</a></li>
<li><a href="#--"><span class="toc-section-number">5.2.3</span> Более сложная модель</a></li>
<li><a href="#-----"><span class="toc-section-number">5.2.4</span> Что влияет на количество ежедневных авиарейсов</a></li>
<li><a href="#--"><span class="toc-section-number">5.2.5</span> Больше о моделях</a></li>
</ul></li>
<li><a href="#------purrr--broom"><span class="toc-section-number">5.3</span> Обработка множества моделей с помощью пакетов <code>purrr</code> и <code>broom</code></a><ul>
<li><a href="#-18"><span class="toc-section-number">5.3.1</span> Введение</a></li>
<li><a href="#--gapminder"><span class="toc-section-number">5.3.2</span> Набор данных <code>gapminder</code></a></li>
<li><a href="#--1"><span class="toc-section-number">5.3.3</span> Столбцы-списки</a></li>
<li><a href="#--"><span class="toc-section-number">5.3.4</span> Создание столбцов-списков</a></li>
<li><a href="#--"><span class="toc-section-number">5.3.5</span> Упрощение столбцов-списков</a></li>
<li><a href="#--------broom"><span class="toc-section-number">5.3.6</span> Приведение данных к аккуратной форме при помоще пакета <code>broom</code></a></li>
</ul></li>
</ul></li>
<li><a><span class="toc-section-number">6</span> Коммуникация</a><ul>
<li><a href="#--r-markdown"><span class="toc-section-number">6.1</span> Язык разметки R Markdown</a><ul>
<li><a href="#-19"><span class="toc-section-number">6.1.1</span> Введение</a></li>
</ul></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Решение упражнений из книги R Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div class="section level1">
<h1><span class="header-section-number">1</span> Введение</h1>
<p>Это электронная версия решений упражнений, свёрстанная при помощи <strong>bookdown</strong>, который можно установить здесь:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">install.packages</span>(<span class="st">&quot;bookdown&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># or the development version</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># devtools::install_github(&quot;rstudio/bookdown&quot;)</span></a></code></pre></div>
<!--chapter:end:index.Rmd-->
</div>
<div id="-" class="section level1">
<h1><span class="header-section-number">2</span> Предварительный анализ</h1>
<div id="----ggplot2" class="section level2">
<h2><span class="header-section-number">2.1</span> Визуализация данных с помощью <code>ggplot2</code></h2>
<div id="-1" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Введение</h3>
<p>Электронная версия книги по адресу <a href="http://r4ds.had.co.nz" class="uri">http://r4ds.had.co.nz</a>.</p>
<p>Для начала работы подключаем библиотеки</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a></code></pre></div>
<pre><code>## ── Attaching packages ─────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.1.0       ✔ purrr   0.3.0  
## ✔ tibble  2.0.1       ✔ dplyr   0.8.0.1
## ✔ tidyr   0.8.2       ✔ stringr 1.4.0  
## ✔ readr   1.3.1       ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)</a></code></pre></div>
<pre><code>## Loading required package: viridisLite</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;Lahman&quot;</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<p>Дополнительно, используются пакеты <code>&quot;nycflights13&quot;, &quot;gapminder&quot;, &quot;Lahman&quot;</code></p>
<p>А это шпаргалка <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf">cheat_sheet</a></p>
<p>Не было упражнений.</p>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Первые шаги</h3>
<div id="-3.2.1" class="section level4">
<h4><span class="header-section-number">2.1.2.1</span> Упражнение 3.2.1</h4>
<div class="question">
<p>Run <code>ggplot(data = mpg)</code> what do you see?</p>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Пустое окно построения. Функция <code>ggplot()</code> из пакета <code>ggplot2</code> только содаёт область построения, функциями мы производим наполнение области построения. Больше инфы смотри в подсказке <a href="https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf" class="uri">https://github.com/rstudio/cheatsheets/blob/master/data-visualization-2.1.pdf</a> .</p>
</div>
<div id="-3.2.2" class="section level4">
<h4><span class="header-section-number">2.1.2.2</span> Упражнение 3.2.2</h4>
<div class="question">
<p>How many rows are in <code>mpg</code>? How many columns?</p>
</div>
<p>Чтобы проверить “строение” фрейма данных <code>mpg</code>,можно воспользоваться двумя способами.
Var1:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">ggplot2<span class="op">::</span>mpg</a></code></pre></div>
<pre><code>## # A tibble: 234 x 11
##    manufacturer model displ  year   cyl trans drv     cty   hwy fl    class
##    &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt;
##  1 audi         a4      1.8  1999     4 auto… f        18    29 p     comp…
##  2 audi         a4      1.8  1999     4 manu… f        21    29 p     comp…
##  3 audi         a4      2    2008     4 manu… f        20    31 p     comp…
##  4 audi         a4      2    2008     4 auto… f        21    30 p     comp…
##  5 audi         a4      2.8  1999     6 auto… f        16    26 p     comp…
##  6 audi         a4      2.8  1999     6 manu… f        18    26 p     comp…
##  7 audi         a4      3.1  2008     6 auto… f        18    27 p     comp…
##  8 audi         a4 q…   1.8  1999     4 manu… 4        18    26 p     comp…
##  9 audi         a4 q…   1.8  1999     4 auto… 4        16    25 p     comp…
## 10 audi         a4 q…   2    2008     4 manu… 4        20    28 p     comp…
## # … with 224 more rows</code></pre>
<p>где видно что <code>mpg</code> это матрица 234 строки на 11 столбцов.</p>
<p>Var2:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw">glimpse</span>(mpg)</a></code></pre></div>
<pre><code>## Observations: 234
## Variables: 11
## $ manufacturer &lt;chr&gt; &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;au…
## $ model        &lt;chr&gt; &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4 quatt…
## $ displ        &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0, 2…
## $ year         &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 199…
## $ cyl          &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, …
## $ trans        &lt;chr&gt; &quot;auto(l5)&quot;, &quot;manual(m5)&quot;, &quot;manual(m6)&quot;, &quot;auto(av)&quot;,…
## $ drv          &lt;chr&gt; &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;4&quot;, &quot;4&quot;, &quot;4&quot;, &quot;…
## $ cty          &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 17,…
## $ hwy          &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 25,…
## $ fl           &lt;chr&gt; &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;…
## $ class        &lt;chr&gt; &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compac…</code></pre>
<p>Сразу тут покажу, что каждый параметр означает:</p>
<table>
<thead>
<tr class="header">
<th>Название</th>
<th align="center">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>manufacturer</td>
<td align="center">изготовитель</td>
</tr>
<tr class="even">
<td>model</td>
<td align="center">модель</td>
</tr>
<tr class="odd">
<td>displ</td>
<td align="center">объём двигателя в литрах</td>
</tr>
<tr class="even">
<td>year</td>
<td align="center">год изготовления</td>
</tr>
<tr class="odd">
<td>cyl</td>
<td align="center">количество цилиндров</td>
</tr>
<tr class="even">
<td>trans</td>
<td align="center">тип трансмиссии</td>
</tr>
<tr class="odd">
<td>drv</td>
<td align="center">тип привода</td>
</tr>
<tr class="even">
<td>cty</td>
<td align="center">кол-во миль по городу на галлон</td>
</tr>
<tr class="odd">
<td>hwy</td>
<td align="center">кол-во миль за городом на галлон</td>
</tr>
<tr class="even">
<td>fl</td>
<td align="center">тип топлива</td>
</tr>
<tr class="odd">
<td>class</td>
<td align="center">класс автомобиля</td>
</tr>
</tbody>
</table>
</div>
<div id="-3.2.3" class="section level4">
<h4><span class="header-section-number">2.1.2.3</span> Упражнение 3.2.3</h4>
<div class="question">
<p>What does the <code>drv</code> variable describe? Read the help for <code>?mpg</code> to find out.
<code>drv</code> — это имя одного из параметров, оно обозначает тип привода автомобиля.</p>
</div>
<table>
<thead>
<tr class="header">
<th>Краткое название</th>
<th align="center">Тип привода</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>f</td>
<td align="center">передний</td>
</tr>
<tr class="even">
<td>r</td>
<td align="center">задний</td>
</tr>
<tr class="odd">
<td>4</td>
<td align="center">полный</td>
</tr>
</tbody>
</table>
</div>
<div id="-3.2.4" class="section level4">
<h4><span class="header-section-number">2.1.2.4</span> Упражнение 3.2.4</h4>
<div class="question">
<p>Make a scatter plot of <code>hwy</code> vs <code>cyl</code>.</p>
</div>
<p>можно прописывать на одной координатной плоскости разные геометрические функции с индивидуальными параметрами, тогда правильнее будет писать вот так</p>
<p>Var 1</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg)<span class="op">+</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> hwy, <span class="dt">y =</span> cyl))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/41-1.png" width="672" /></p>
<p>Но если параметры одни и те же, а требуется построить разные геометрии, то лучше прописать общие параметры вынося их “за скобки”
Var 2</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="kw">aes</span>(<span class="dt">x =</span> hwy, <span class="dt">y =</span> cyl))<span class="op">+</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="-3.2.5" class="section level4">
<h4><span class="header-section-number">2.1.2.5</span> Упражнение 3.2.5</h4>
<div class="question">
<p>What happens if you make a scatterplot of <code>class</code> vs <code>drv</code>? Why is the plot not useful?</p>
</div>
<p>Оба параметра являются категориальными, или описательными. Можно построить <code>&lt;chr&gt;</code> от <code>&lt;chr&gt;</code>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> class, <span class="dt">y =</span> drv))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Но с точки зрения аналитики, такая информация не несёт большой пользы. В конкретном примере можно только сказать что, все автомобили класса <code>2seater</code> имеют задний привод. А в классе <code>subcompact</code> есть все типы привода.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Эстетика визуализации</h3>
<div id="-3.3.1" class="section level4">
<h4><span class="header-section-number">2.1.3.1</span> Упражнения 3.3.1</h4>
<div class="question">
<p>What’s gone wrong with this code? Why are the points not blue?</p>
</div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Всё потому что <code>colour</code> не вынес за скобки, потому что <code>colour</code> это параметр функции <code>geom_point()</code>, not <code>aes()</code>
правильно вот так</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy), <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
</div>
<div id="-3.3.2" class="section level4">
<h4><span class="header-section-number">2.1.3.2</span> Упражнения 3.3.2</h4>
<div class="question">
<p>Which variables in <code>mpg</code> are categorical? Which variables are continuous? (Hint: type <code>?mpg</code> to read the documentation for the dataset). How can you see this information when you run <code>mpg</code>?</p>
</div>
<p>Это те факторы, которые позволяют разделить на показатели. Чтобы понять какие факторы являются категориальными можно воспользоваться функцией <code>glimpse()</code>, которая показывает тип каждого столбца. Соответственно, те что <code>&lt;chr&gt;</code> и есть категориальные:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">glimpse</span>(mpg)</a></code></pre></div>
<pre><code>## Observations: 234
## Variables: 11
## $ manufacturer &lt;chr&gt; &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;audi&quot;, &quot;au…
## $ model        &lt;chr&gt; &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4&quot;, &quot;a4 quatt…
## $ displ        &lt;dbl&gt; 1.8, 1.8, 2.0, 2.0, 2.8, 2.8, 3.1, 1.8, 1.8, 2.0, 2…
## $ year         &lt;int&gt; 1999, 1999, 2008, 2008, 1999, 1999, 2008, 1999, 199…
## $ cyl          &lt;int&gt; 4, 4, 4, 4, 6, 6, 6, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, …
## $ trans        &lt;chr&gt; &quot;auto(l5)&quot;, &quot;manual(m5)&quot;, &quot;manual(m6)&quot;, &quot;auto(av)&quot;,…
## $ drv          &lt;chr&gt; &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;4&quot;, &quot;4&quot;, &quot;4&quot;, &quot;…
## $ cty          &lt;int&gt; 18, 21, 20, 21, 16, 18, 18, 18, 16, 20, 19, 15, 17,…
## $ hwy          &lt;int&gt; 29, 29, 31, 30, 26, 26, 27, 26, 25, 28, 27, 25, 25,…
## $ fl           &lt;chr&gt; &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;p&quot;, &quot;…
## $ class        &lt;chr&gt; &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compact&quot;, &quot;compac…</code></pre>
</div>
<div id="-3.3.3" class="section level4">
<h4><span class="header-section-number">2.1.3.3</span> Упражнения 3.3.3</h4>
<div class="question">
<p>Map a continuous variable to <code>color</code>, <code>size</code>, and <code>shape</code>. How do these aesthetics behave differently for categorical vs. continuous variables?</p>
</div>
<p>Непрерывные переменные, это такие переменные которые принимают значения в некотором диапазоне. Непрерывной переменной является например <code>cty</code>, city miles per gallon, и показывает сколько проедет автомобиль в черте горда на один галлон топлива.
Если сопоставить этой переменной <strong>цвет</strong> то получится</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> cty)) <span class="op">+</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>Цвет распределяется в диапазоне переменной <code>cty</code>, то есть в пределах от примерно 10 до 35.
Попробуем теперь соспоставить <strong>размер</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">size =</span> cty)) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>В принципе получается такая же картина, только точки выделены не цветом, а размером.
И наконец, сопоставим <strong>форму</strong> непрерывной переменной</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="co">#ggplot(mpg, aes(x = displ, y = hwy, shape = cty)) + geom_point()</span></a></code></pre></div>
<p>А вот и нет. Программа выдаст <code>Ошибка: A continuous variable can not be mapped to shape</code>.
Непрерывные переменные не соотносятся с атрибутом <code>shape</code>, так сделано специально. Потому что фигур всего 24, а наборов значений у непрерывной переменной может быть сколь угодно много</p>
</div>
<div id="-3.3.4" class="section level4">
<h4><span class="header-section-number">2.1.3.4</span> Упражнения 3.3.4</h4>
<div class="question">
<p>What happens if you map the same variable to multiple aesthetics?</p>
</div>
<p>Связать можно, вот например, переменная <code>drv</code> для цвета и для формы</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> drv, <span class="dt">shape =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>но это будет избыточное выделение.</p>
</div>
<div id="-3.3.5" class="section level4">
<h4><span class="header-section-number">2.1.3.5</span> Упражнения 3.3.5</h4>
<div class="question">
<p>What does the <code>stroke</code> aesthetic do? What shapes does it work with? (Hint: use <code>?geom_point</code>)</p>
</div>
<p><code>stroke</code> это размер границы фигуры. Он работает с фигурами, у которых помимо полной заливки есть цвет границы т.е. фигуры 21-24
<img src="img/shapes.png" alt="alt text" /></p>
<p>Иллюстрирующий пример. Вот построение обычными точками</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(hwy, cyl))<span class="op">+</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Теперь зададим красную заливку, и размер границы фигуры <span class="math inline">\(2\)</span></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(hwy, cyl)) <span class="op">+</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;red&quot;</span>,<span class="dt">size=</span><span class="dv">3</span>,<span class="dt">stroke=</span><span class="dv">2</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>Ну а теперь <span class="math inline">\(5\)</span></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(hwy, cyl)) <span class="op">+</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">shape=</span><span class="dv">21</span>,<span class="dt">colour=</span><span class="st">&quot;black&quot;</span>,<span class="dt">fill=</span><span class="st">&quot;red&quot;</span>,<span class="dt">size=</span><span class="dv">3</span>,<span class="dt">stroke=</span><span class="dv">5</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
</div>
<div id="-3.3.6" class="section level4">
<h4><span class="header-section-number">2.1.3.6</span> Упражнения 3.3.6</h4>
<div class="question">
<p>What happens if you map an aesthetic to something other than a variable name, like <code>aes(colour = displ &lt; 5)</code>?</p>
</div>
<p>Визуальные атрибуты можно задавать и логическими выражениями, как допустим в таком выражении:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ,hwy, <span class="dt">color =</span> displ <span class="op">&lt;</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ,hwy, <span class="dt">color =</span> displ <span class="op">&lt;</span><span class="st"> </span><span class="dv">4</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(displ,hwy, <span class="dt">size =</span> displ <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>()</a></code></pre></div>
<pre><code>## Warning: Using size for a discrete variable is not advised.</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>К тому же <code>R</code> ругается, что лучше бы такое не делать
### Распространённые ошибки
Проблемы случаются и это норм. Если что-то не получается, чекни код.</p>
<p>Часто бывает что поставил <code>+</code> не туда. Он должен быть в конце строки, а не в начале.</p>
</div>
</div>
<div class="section level3">
<h3><span class="header-section-number">2.1.4</span> Панели</h3>
<div id="-3.5.1" class="section level4">
<h4><span class="header-section-number">2.1.4.1</span> Упражнение 3.5.1</h4>
<div class="question">
<p>What happens if you facet on a continuous variable?</p>
</div>
<p>Как это работает.</p>
<p>Построим график <code>highway miles per gallon</code> от <code>engine displacement, in litres</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Теперь разделим на “окошки” т.е. возьмём срез графиков с теми же дискретными переменными, но в разрезе типа привода автомобиля <code>drv</code> от количества цилиндров <code>cyl</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>cyl)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-22-1.png" width="672" />
Получилось <span class="math inline">\(12\)</span> панелей, потому что <code>drv</code> дискретная, ограниченная переменная, у неё всего три набора значения (<span class="math inline">\(4, f, d\)</span>). Количество цилиндров <code>cyl</code> тоже ограниченная <span class="math inline">\(4,5,6,8\)</span>. Поэтому получилось <span class="math inline">\(3*4=12\)</span> значений. Так как панелей получилось немного, такое представление осязаемо, с ним можно работать, оно информативно.</p>
<p>Если мы попробуем построить в одном измерении непрерывную переменную. То количество панелей возрастёт на количество значений этой переменной. Получится не очень информативно. Заменим в этом же построении количество цилиндров <code>cyl</code> на расстояние, пройденное за один галлон топлива в городской черте <code>cty</code>. Это непрерывная переменная, у которой много значений.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="st"> </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>cty)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-23-1.png" width="672" />
Вот что произойдет, если параметром для панели задать непрерывную переменную. Будет много окошек, информативность представленной информации падает.</p>
</div>
<div id="-3.5.2" class="section level4">
<h4><span class="header-section-number">2.1.4.2</span> Упражнение 3.5.2</h4>
<div class="question">
<p>What do the empty cells in plot with <code>facet_grid(drv ~ cyl)</code> mean? How do they relate to this plot?</p>
</div>
<p>Построим панели по заданному условию</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="st">    </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>cyl)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
<p>Пустые ячейки</p>
<ul>
<li><span class="math inline">\(cyl(5):drv(4)\)</span>;</li>
<li><span class="math inline">\(cyl(4):drv(r)\)</span>;</li>
<li><span class="math inline">\(cyl(5):drv(r)\)</span>;</li>
</ul>
<p>говорят о том, что нет точек удовлетворяющих этим разрезам данных. Иначе говоря, в наборе данных <code>mpg</code></p>
<ul>
<li>нет полноприводных авто с 5 цилиндрами</li>
<li>заднеприводных авто с 4 цилиндрами</li>
<li>заднеприводных авто с 5 цилиндрами</li>
</ul>
<p>Построим заданную функцию</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> drv, <span class="dt">y =</span> cyl))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>Она соотносится с построенными выше панелями в том, что показывает отсутствие данных в комбинациях переменных <code>drv:cyl</code></p>
</div>
<div id="-3.5.3" class="section level4">
<h4><span class="header-section-number">2.1.4.3</span> Упражнение 3.5.3</h4>
<div class="question">
<p>What plots does the following code make? What does <code>«.»</code> do?</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>.)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>cyl)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-27-1.png" width="672" /></p>
</div>
<p>Сравним с оригиналом:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_grid</span>(drv <span class="op">~</span><span class="st"> </span>cyl)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-28-1.png" width="672" /></p>
<p>Как видно на самих построениях, точка убирает одно из измерений панели следующим образом:</p>
<p><em>Если точка стоит в первой координате, <code>(. ~ param)</code>, то убираются строки
</em>Если точка стоит во второй координате, <code>(param ~ .)</code>, то убираются столбцы</p>
</div>
<div id="-3.5.4" class="section level4">
<h4><span class="header-section-number">2.1.4.4</span> Упражнение 3.5.4</h4>
<div class="question">
<p>Take the first faceted plot in this section:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>class, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-29-1.png" width="672" /></p>
<p>What are the advantages to using faceting instead of the colour aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset?</p>
</div>
<p>Для того чтобы сравнить это цветное выделение с выделением плитками. Посмотрим как выглядит выделение того же построения данных цветом:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">color =</span> class))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<ul>
<li><p><strong>Преимущество</strong> построения плитками заключается в том, что каждая группы “очищена” от мусора других групп. Плитками проще оценить распределение точек в отдельно взятой группе. Кроме этого если выделять цветом построения с большим количеством групп, то необходимо более ответственно подходить к подбору цветов `– нужно делать их более контрастными. Потому что при увеличении количества групп, цвета начинают сливаться, и уже трудно различать к какой категории относится точка.</p></li>
<li><p><strong>Недостаток</strong> построяния плитками заключается в том, что каждая группа строится в отдельной системе координат. Трудно сравнивать распределение точек между группами.</p></li>
</ul>
</div>
<div id="-3.5.5" class="section level4">
<h4><span class="header-section-number">2.1.4.5</span> Упражнение 3.5.5</h4>
<div class="question">
<p>Read <code>?facet_wrap</code>. What does <code>nrow</code> do? What does <code>ncol</code> do? What other options control the layout of the individual panels? Why doesn’t <code>facet_grid()</code> have <code>nrow</code> and <code>ncol</code> arguments?</p>
</div>
<table>
<thead>
<tr class="header">
<th>аргумент</th>
<th align="center">что значит</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>nrow</code></td>
<td align="center">количество строк</td>
</tr>
<tr class="even">
<td><code>ncol</code></td>
<td align="center">количество столбцов</td>
</tr>
</tbody>
</table>
<p>Эти переменные нужны, так как срез графика в <code>facet_wrap()</code> происходит по одной дискретной переменной. В свою очередь <code>facet_grid</code> использует комбинации двех переменных поэтому для построения не нужно выбирать количество строк или колонок.</p>
</div>
<div id="-3.5.6" class="section level4">
<h4><span class="header-section-number">2.1.4.6</span> Упражнение 3.5.6</h4>
<div class="question">
<p>When using <code>facet_grid()</code> you should usually put the variable with more unique levels in the columns. Why?</p>
</div>
<p>Экраны наших компьютеров, книги, чертежи, имеют альбомную ориентацию и на одном носители умещается больше данных. Поэтому визуально проще сравнивать большее количество переменных по-горизонтали.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.5</span> Геометрические объекты</h3>
<div id="-3.6.1" class="section level4">
<h4><span class="header-section-number">2.1.5.1</span> Упражнения 3.6.1</h4>
<div class="question">
<p>What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?</p>
</div>
<p>На русский язык “boxplot перевели как”полосчатый график“. Это конечно сбивает с толку, потому что boxplot это конечно”ящик с усами&quot;. Исходя из этого</p>
<table>
<thead>
<tr class="header">
<th>Название графика</th>
<th align="center">Объект <code>geom</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>linechart</td>
<td align="center"><code>geom_line</code></td>
</tr>
<tr class="even">
<td>boxplot</td>
<td align="center"><code>geom_boxplot</code></td>
</tr>
<tr class="odd">
<td>histogram</td>
<td align="center"><code>geom_histogram</code></td>
</tr>
<tr class="even">
<td>area chart</td>
<td align="center"><code>geom_area</code></td>
</tr>
</tbody>
</table>
</div>
<div id="-3.6.2" class="section level4">
<h4><span class="header-section-number">2.1.5.2</span> Упражнения 3.6.2</h4>
<div class="question">
<p>Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.</p>
</div>
<p>Это будет распределение <code>displ</code> от <code>hwy</code>. С цветом точек в зависимости от <code>drv</code>, т.е. три цвета - зелёный, красный и голубой. В этой же системе координат будет построена линия среднеквадратичного приближения без доверительного интервала с тем же цветом, что и точки.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span></a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Поправочка - будет три линии приближений с цветом, соответсвующим цвету точек, по которым строится это приближение</p>
</div>
<div id="-3.6.3" class="section level4">
<h4><span class="header-section-number">2.1.5.3</span> Упражнения 3.6.3</h4>
<div class="question">
<p>What does <code>show.legend = FALSE</code> do? What happens if you remove it? Why do you think I used it earlier in the chapter?</p>
</div>
<p>Автор имеет в виду этот пример</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_smooth</span>(</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv),</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">    <span class="dt">show.legend =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb44-5" data-line-number="5">  )</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>Инструкция <code>show.legend</code> распоряжает показывать легенду графика или нет. По умолчанию эта инструкция имеет значение <code>TRUE</code>. В примере из книги, инструкция <code>show.legend = FALSE</code> использовалась намеренно, чтобы в максимальном размере уместить в одну строку три графика. Тот же график с легендой выглядит вот так:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_smooth</span>(</a>
<a class="sourceLine" id="cb46-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)</a>
<a class="sourceLine" id="cb46-4" data-line-number="4">  )</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
<div id="-3.6.4" class="section level4">
<h4><span class="header-section-number">2.1.5.4</span> Упражнения 3.6.4</h4>
<div class="question">
<p>What does the <code>se</code> argument to <code>geom_smooth()</code> do?</p>
</div>
<p>Аргумент <code>se</code> распоряжает показывать ли доверительный интервал или нет. По умолчанию этот интервал показывается. В примере ниже доверительный интервал показывается:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy))</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Теперь уберём его:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy), <span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
</div>
<div id="-3.6.5" class="section level4">
<h4><span class="header-section-number">2.1.5.5</span> Упражнения 3.6.5</h4>
<div class="question">
<p>Will these two graphs look different? Why/why not?</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a></code></pre></div>
</div>
<p>Эти графики будут идентичными, потому что в первом случае в функции <code>ggplot()</code> задаются исходные условия сразу для всех функций, которые будут строится на этом поле построения. А во втором случае, все исходные условия для построений указаны в каждой функции индивидуально. И так как различий в этих условиях нет, то выглядеть они будут одинаково:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="-3.6.6" class="section level4">
<h4><span class="header-section-number">2.1.5.6</span> Упражнения 3.6.6</h4>
<div class="question">
<p>Recreate the R code necessary to generate the following graphs.
<img src="img/graphics3.6.6.png" alt="alt text" /></p>
</div>
<ol style="list-style-type: decimal">
<li>В левом верхнем графике наложено два построения. Первое <code>geom_point()</code> - обычное построение без какой либо группировки и цветового выделения. Второе <code>geom_smouth()</code> - построение распределения без группировки и цветового выделения, без построения доверительного интервала. Так как у обоих построений одинаковые исходные условия, их можно “вынести за скобки”, то есть указать в “родительском” <code>ggplot()</code>:</li>
</ol>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="st">   </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb58-3" data-line-number="3"><span class="st">   </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>В правом верхнем графике наложено два построения. Первое <code>geom_point()</code> - обычное построение без какой либо группировки и цветового выделения. Второе <code>geom_smouth()</code> - построение распределения с группировкой по признаку <code>drv</code>, без построения доверительного интервала. Так как у двух постройний разные условия, лучше для каждого прописать исходные данные индивидуально</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">group =</span> drv), <span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>В левом среднем графике наложено два построения. Первое <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code>. Второе <code>geom_smouth()</code> - построение распределения с цветовой группировкой по признаку <code>drv</code>, без построения доверительного интервала. Так как у обоих построений одинаковые исходные условия, их можно “вынести за скобки”, то есть указать в “родительском” <code>ggplot()</code>:</li>
</ol>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>В правом среднем графике наложено два построения. Первое <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code>. Второе <code>geom_smouth()</code> - построение распределения без группировки и цветового выделения, без построения доверительного интервала. Так как у двух постройний разные условия, лучше для каждого прописать исходные данные индивидуально:</li>
</ol>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb64-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span></a>
<a class="sourceLine" id="cb64-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy), <span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>В левом нижнем графике наложено два построения. Первое <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code>. Второе <code>geom_smouth()</code> - построение распределения с группировкой по признаку <code>drv</code>, с выделением каждой кривой группы разным типом линии, без построения доверительного интервала. Так как у двух постройний разные условия, лучше для каждого прописать исходные данные индивидуально:</li>
</ol>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">linetype =</span> drv), <span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<ol start="6" style="list-style-type: decimal">
<li>В правом нижнем графике только одно построение <code>geom_point()</code> - с цветовой группировкой по признаку <code>drv</code> и толстыми белыми границами у точек.</li>
</ol>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">fill =</span> drv)) <span class="op">+</span></a>
<a class="sourceLine" id="cb68-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">stroke =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.6</span> Статистические преобразования</h3>
<div id="-3.7.1" class="section level4">
<h4><span class="header-section-number">2.1.6.1</span> Упражнения 3.7.1</h4>
<div class="question">
<p>What is the default geom associated with <code>stat_summary()</code>? How could you rewrite the previous plot to use that geom function instead of the stat function?</p>
</div>
<p>Для того чтобы ответить на этот вопрос, необходимо открыть help - <code>?stat_summary</code></p>
<p><code>stat_summary(mapping = NULL, data = NULL, geom = &quot;pointrange&quot;, position = &quot;identity&quot;, ..., fun.data = NULL, fun.y = NULL, fun.ymax = NULL, fun.ymin = NULL, fun.args = list(), na.rm = FALSE, show.legend = NA, inherit.aes = TRUE)</code></p>
<p>Это и есть ответ - со статистикой <code>stat_summary()</code> связана геометрия <code>geom = &quot;pointrange&quot;</code>.</p>
<p>Теперь ответим на вопрос, как можно переписать код</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="st">  </span><span class="kw">stat_summary</span>(</a>
<a class="sourceLine" id="cb69-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> depth),</a>
<a class="sourceLine" id="cb69-4" data-line-number="4">    <span class="dt">fun.ymin =</span> min,</a>
<a class="sourceLine" id="cb69-5" data-line-number="5">    <span class="dt">fun.ymax =</span> max,</a>
<a class="sourceLine" id="cb69-6" data-line-number="6">    <span class="dt">fun.y =</span> median</a>
<a class="sourceLine" id="cb69-7" data-line-number="7">  )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>Необходимо заменить <code>stat_summary()</code> на <code>geom_pointrange()</code> и вставить название необходимой статистики:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb70-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb70-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_pointrange</span>(</a>
<a class="sourceLine" id="cb70-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> depth),</a>
<a class="sourceLine" id="cb70-4" data-line-number="4">    <span class="dt">stat =</span> <span class="st">&quot;summary&quot;</span>,</a>
<a class="sourceLine" id="cb70-5" data-line-number="5">    <span class="dt">fun.ymin =</span> min,</a>
<a class="sourceLine" id="cb70-6" data-line-number="6">    <span class="dt">fun.ymax =</span> max,</a>
<a class="sourceLine" id="cb70-7" data-line-number="7">    <span class="dt">fun.y =</span> median</a>
<a class="sourceLine" id="cb70-8" data-line-number="8">  )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
</div>
<div id="-3.7.2" class="section level4">
<h4><span class="header-section-number">2.1.6.2</span> Упражнения 3.7.2</h4>
<div class="question">
<p>What does <code>geom_col()</code> do? How is it different to <code>geom_bar()</code>?</p>
</div>
<p>Функции имеют разные статистики по умолчанию. <code>geom_bar()</code> иметт <code>stat_count()</code>, а <code>geom_col()</code> имет <code>stat_identity()</code> Т.е. <code>geom_bar()</code> считает, сколько наблюдений попадает в просматриваемый диапазон и столбец показывает количество попавших наблюдений в диапазон. А <code>geom_col()</code> - строит столбцы по количеству наблюдений в диапазоне, а <code>geom_bar()</code> число наблюдений.</p>
</div>
<div id="-3.7.3" class="section level4">
<h4><span class="header-section-number">2.1.6.3</span> Упражнения 3.7.3</h4>
<div class="question">
<p>Most geoms and stats come in pairs that are almost always used in concert. Read through the documentation and make a list of all the pairs. What do they have in common?</p>
</div>
<p>Общие элементы у статистик и геометрий это <code>aes()</code>, <code>position</code>, а пары геометрия-статистика следующие:</p>
<table>
<thead>
<tr class="header">
<th><code>geom_</code></th>
<th align="center"><code>stat_</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>path</code></td>
<td align="center"><code>eclipse</code>, <code>function</code></td>
</tr>
<tr class="even">
<td><code>point</code></td>
<td align="center"><code>identity</code>, <code>unique</code></td>
</tr>
<tr class="odd">
<td><code>tile</code></td>
<td align="center"><code>summary_2d</code></td>
</tr>
<tr class="even">
<td><code>hex</code></td>
<td align="center"><code>summary_hex</code></td>
</tr>
<tr class="odd">
<td><code>pointrange</code></td>
<td align="center"><code>summary_bin</code>, <code>summary</code></td>
</tr>
</tbody>
</table>
</div>
<div id="-3.7.4" class="section level4">
<h4><span class="header-section-number">2.1.6.4</span> Упражнения 3.7.4</h4>
<div class="question">
<p>What variables does <code>stat_smooth()</code> compute? What parameters control its behavior?</p>
</div>
<ul>
<li><p><code>y</code> - predicted value, прогнозируемое значение</p></li>
<li><p><code>ymin</code> - lower pointwise confidence interval around the mean, нижний уровень доверительного интервала среднего значения</p></li>
<li><p><code>ymax</code> - upper pointwise confidence interval around the mean, верхний уровень доверительного интервала среднего значения</p></li>
<li><p><code>se</code> - standard error, стандтартное отклонение</p></li>
</ul>
<p>Я так полагаю, параметры которые регулируют поведение функции, это специальные методы. Если это не так, то я однажды вернусь сюда и дополню этот ответ.</p>
</div>
<div id="-3.7.5" class="section level4">
<h4><span class="header-section-number">2.1.6.5</span> Упражнения 3.7.5</h4>
<div class="question">
<p>In our proportion bar chart, we need to set group = 1 Why? In other words what is the problem with these two graphs?</p>
<p>Graph #1</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop..))</a></code></pre></div>
<p>Graph #2</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb72-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb72-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop..))</a></code></pre></div>
</div>
<p>Если не указать значение <code>group</code>, то все столбики то есть построения будут иметь <code>prop = 1</code>. Функция <code>geom_bar</code> по умолчанию использует статистику <code>stat_count</code>, которая считает количество значений внутри группы.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop..))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop..))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-50-2.png" width="672" /></p>
<p>Проблема с этими двумя графиками заключается в том, что пропорции вычисляются внутри групп. Чтобы исправить, нужно указать группы в этих графиках:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> ..prop.., <span class="dt">group =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb76-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb76-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> color, <span class="dt">y =</span> ..prop.., <span class="dt">group =</span> color))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-51-2.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.7</span> Позиционные настройки</h3>
<p>В заданиях часто используется фрейм данных <code>diamonds</code>, укажем его здесь:</p>
<table>
<colgroup>
<col width="46%" />
<col width="53%" />
</colgroup>
<thead>
<tr class="header">
<th>параметр</th>
<th align="center">описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>price</code></td>
<td align="center">цена в долларах ($326–$18,823)</td>
</tr>
<tr class="even">
<td><code>carat</code></td>
<td align="center">вес бриллианта (0.2–5.01)</td>
</tr>
<tr class="odd">
<td><code>cut</code></td>
<td align="center">качество огранки (Fair, Good, Very Good, Premium, Ideal)</td>
</tr>
<tr class="even">
<td><code>color</code></td>
<td align="center">цвет бриллианта J (worst) to D (best)</td>
</tr>
<tr class="odd">
<td><code>clarity</code></td>
<td align="center">чистота, или прозрачность (I1 (worst), SI2, SI1, VS2, VS1, VVS2, VVS1, IF (best)</td>
</tr>
<tr class="even">
<td><code>x</code></td>
<td align="center">длинна в мм</td>
</tr>
<tr class="odd">
<td><code>y</code></td>
<td align="center">ширина в мм</td>
</tr>
<tr class="even">
<td><code>z</code></td>
<td align="center">высота в мм</td>
</tr>
<tr class="odd">
<td><code>depth</code></td>
<td align="center">величина total depth percentage = z / mean(x, y) = 2 * z / (x + y) (от 43 до 79)</td>
</tr>
<tr class="even">
<td><code>table</code></td>
<td align="center">ширина верхней части алмаза относительно самой широкой точки (от 43 до 95)</td>
</tr>
</tbody>
</table>
<p>варианты использования аргумента <code>position</code>:</p>
<ul>
<li><code>position = &quot;identity&quot;</code>. Строит столбцы с перекрыванием, т.е. в точности, где каждый объект должен находится. Это сложно заметить, поэтому если есть необходимость использовать эту настройку, то чтобы увидеть перекрытие нужно дополнительно указывать параметр прозрачности <code>alpha</code>:</li>
</ul>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb77-2" data-line-number="2">  <span class="dt">data =</span> diamonds,</a>
<a class="sourceLine" id="cb77-3" data-line-number="3">  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity)) <span class="op">+</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>или делать объекты незалитыми убирая у атрибута <code>fill</code> цвет:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb78-1" data-line-number="1"><span class="kw">ggplot</span>(</a>
<a class="sourceLine" id="cb78-2" data-line-number="2">  <span class="dt">data =</span> diamonds,</a>
<a class="sourceLine" id="cb78-3" data-line-number="3">  <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">color =</span> clarity)) <span class="op">+</span></a>
<a class="sourceLine" id="cb78-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">fill =</span> <span class="ot">NA</span>, <span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<ul>
<li><code>position = &quot;fill&quot;</code> Создаёт стековые столбцы одинаковой высоты. Удобно сравнивать пропорции у значений.</li>
</ul>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(</a>
<a class="sourceLine" id="cb79-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),</a>
<a class="sourceLine" id="cb79-4" data-line-number="4">    <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span></a>
<a class="sourceLine" id="cb79-5" data-line-number="5">    )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<ul>
<li><code>position = &quot;dodge&quot;</code>. Строит перекрывающиеся столбцы рядом друг с другом</li>
</ul>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb80-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(</a>
<a class="sourceLine" id="cb80-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),</a>
<a class="sourceLine" id="cb80-4" data-line-number="4">    <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span></a>
<a class="sourceLine" id="cb80-5" data-line-number="5">    )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-55-1.png" width="672" /></p>
<ul>
<li><code>position = &quot;jitter&quot;</code>. Не подходит для столбчатых диаграмм, но отлично подходит для диаграмм рассеивания. Если точки пересекаются, то чтобы показать истинное распределение значений <code>jitter</code> добавляет “шум”</li>
</ul>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(</a>
<a class="sourceLine" id="cb81-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy),</a>
<a class="sourceLine" id="cb81-4" data-line-number="4">    <span class="dt">position =</span> <span class="st">&quot;jitter&quot;</span></a>
<a class="sourceLine" id="cb81-5" data-line-number="5">  )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<div id="-3.8.1" class="section level4">
<h4><span class="header-section-number">2.1.7.1</span> Упражнения 3.8.1</h4>
<div class="question">
<p>What is the problem with this plot? How could you improve it?</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb82-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb82-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
</div>
<p>Это иллюстрация приведённой в книге проблемы <strong>наложение графиков</strong>. Все значения наносимые на график округляются - поэтому в одной точке может быть наложено несколько значений. Чтобы показать истинное количество точек в одном положении можно воспользоваться функцией <code>geom_jitter</code>, которой добавит случайный шум каждой точке.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_jitter</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
</div>
<div id="-3.8.2" class="section level4">
<h4><span class="header-section-number">2.1.7.2</span> Упражнения 3.8.2</h4>
<div class="question">
<p>What parameters to <code>geom_jitter()</code> control the amount of jittering?</p>
</div>
<p>Согласно описанию <a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html"><code>geom_jitter()</code></a> есть два параметра для управления флуктуациями:</p>
<ul>
<li><code>width</code> для вертикального распределения</li>
<li><code>height</code> для горизонтального распределения</li>
</ul>
<p>Разберём на примере. Возьмём диаграмму рассеивания:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb84-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<p>Добавим флуктуаций:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-60-1.png" width="672" /></p>
<p>Отрегулируем умеренные флуктуации, установив значение параметров <code>width</code> и <code>height</code> равным <span class="math inline">\(0,5\)</span></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.5</span>, <span class="dt">height =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-61-1.png" width="672" /></p>
</div>
<div id="-3.8.3" class="section level4">
<h4><span class="header-section-number">2.1.7.3</span> Упражнения 3.8.3</h4>
<div class="question">
<p>Compare and contrast <code>geom_jitter()</code> with <code>geom_count()</code>.</p>
</div>
<p>Возьмём данные из предыдущего примера, в которых уже известно, что происходит наложение данных:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-62-1.png" width="672" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb88-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_jitter</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<p>Теперь посмотрим что делает <code>geom_count()</code></p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_count</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-64-1.png" width="672" /></p>
<p>Функция <code>geom_count()</code> тоже демонстрирует, что точки в построении накладываются. Но она делает это изящнее - в зависимости от количества точек, попавших в одно построение, увеличивается диаметр окружности.</p>
<ul>
<li>Преимущество <code>geom_count()</code> - не изменяются координаты точек.</li>
<li>Недостаток <code>geom_count()</code> - в зависимости от количества точек, радиус окружности может перекрывать рядом лежащие точки.</li>
</ul>
<p>Впрочем, в этом случае можно использовать дополнительное выделение цветом:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb90-1" data-line-number="1"> <span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_count</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
</div>
<div id="-3.8.4" class="section level4">
<h4><span class="header-section-number">2.1.7.4</span> Упражнения 3.8.4</h4>
<div class="question">
<p>What’s the default <code>position</code> adjustment for <code>geom_boxplot()</code>? Create a visualization of the <code>mpg</code> dataset that demonstrates it.</p>
</div>
<p>Согласно описанию функции <code>geom_boxplot()</code> значение по умолчанию у параметра <code>position = &quot;dodge2&quot;</code>.
Оба парамтера <code>&quot;dodge&quot;</code> и <code>&quot;dodge2&quot;</code> строят рядом перекрывающиеся объекты рядом. Разница в том, что <code>&quot;dodge&quot;</code> лепит их вплотную, а <code>&quot;dodge2&quot;</code> добавляет промежуток. Или не совсем…</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb91-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(</a>
<a class="sourceLine" id="cb91-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),</a>
<a class="sourceLine" id="cb91-4" data-line-number="4">    <span class="dt">position =</span> <span class="st">&quot;dodge&quot;</span></a>
<a class="sourceLine" id="cb91-5" data-line-number="5">    )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-66-1.png" width="672" /></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb92-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb92-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(</a>
<a class="sourceLine" id="cb92-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),</a>
<a class="sourceLine" id="cb92-4" data-line-number="4">    <span class="dt">position =</span> <span class="st">&quot;dodge2&quot;</span></a>
<a class="sourceLine" id="cb92-5" data-line-number="5">    )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-67-1.png" width="672" /></p>
<p>Пример для визуализации.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-68-1.png" width="672" /></p>
<p>Если использовать другое значение для <code>position</code>, то ящики будут накладываться друг на друга:</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb94-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(cty, hwy, <span class="dt">color =</span> drv)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>(<span class="dt">position =</span> <span class="st">&quot;identity&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.1.8</span> Системы координат</h3>
<div id="-3.9.1" class="section level4">
<h4><span class="header-section-number">2.1.8.1</span> Упражнения 3.9.1</h4>
<div class="question">
<p>Turn a stacked bar chart into a pie chart using <code>coord_polar()</code></p>
</div>
<p>Хорошо, сначала построим стековую диаграмму:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill =</span> <span class="kw">factor</span>(cyl))) <span class="op">+</span></a>
<a class="sourceLine" id="cb95-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<p><strong>РАЗОБРАТЬСЯ ЧТО ДЕЛАЕТ <code>factor()</code></strong></p>
<p>Всё описание работы есть <a href="https://ggplot2.tidyverse.org/reference/coord_polar.html"><code>coord_polar()</code></a> поэтому я ограничусь здесь только выполнением задания.
В документации к построению “пирогов” сказано что, нужно относится к этим построениям максимально острожно, что коррелирует с тем, что говорится в <a href="https://lpgenerator.ru/blog/2015/11/27/pochemu-vam-luchshe-perestat-ispolzovat-krugovye-diagrammy-ili-net/">дизайне и визуализации</a></p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb96-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">factor</span>(<span class="dv">1</span>), <span class="dt">fill =</span> <span class="kw">factor</span>(cyl))) <span class="op">+</span></a>
<a class="sourceLine" id="cb96-2" data-line-number="2"><span class="st"> </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-71-1.png" width="672" /></p>
<p>Можно использовать пример из упражнений</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb97-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(</a>
<a class="sourceLine" id="cb97-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),</a>
<a class="sourceLine" id="cb97-4" data-line-number="4">    <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span></a>
<a class="sourceLine" id="cb97-5" data-line-number="5">    )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb98-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb98-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(</a>
<a class="sourceLine" id="cb98-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">fill =</span> clarity),</a>
<a class="sourceLine" id="cb98-4" data-line-number="4">    <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb98-5" data-line-number="5"><span class="st">    </span><span class="kw">coord_polar</span>(<span class="dt">theta =</span> <span class="st">&quot;y&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
</div>
<div id="-3.9.2" class="section level4">
<h4><span class="header-section-number">2.1.8.2</span> Упражнения 3.9.2</h4>
<div class="question">
<p>What does <code>labs()</code> do? Read the documentation.</p>
</div>
<p>Функция <code>labs()</code> нужна для подписей всего того что отображается на графике. Всё описание есть в хэлпе.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-2" data-line-number="2"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(displ, hwy, <span class="dt">colour =</span> drv)) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-3" data-line-number="3"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">color =</span> <span class="st">&quot;Новое название&quot;</span>, </a>
<a class="sourceLine" id="cb99-4" data-line-number="4">         <span class="dt">x =</span> <span class="st">&quot;Ось абсцисс&quot;</span>,</a>
<a class="sourceLine" id="cb99-5" data-line-number="5">         <span class="dt">y =</span> <span class="st">&quot;Ось ординат&quot;</span>,</a>
<a class="sourceLine" id="cb99-6" data-line-number="6">         <span class="dt">title =</span> <span class="st">&quot;Заголовок&quot;</span>, </a>
<a class="sourceLine" id="cb99-7" data-line-number="7">         <span class="dt">subtitle =</span> <span class="st">&quot;описание&quot;</span>, </a>
<a class="sourceLine" id="cb99-8" data-line-number="8">         <span class="dt">tag =</span> <span class="st">&quot;тэг&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
</div>
<div id="-3.9.3" class="section level4">
<h4><span class="header-section-number">2.1.8.3</span> Упражнения 3.9.3</h4>
<div class="question">
<p>What’s the difference between <code>coord_quickmap()</code> and <code>coord_map()</code>?</p>
</div>
<p><code>Coord_map</code> проецирует часть земли, которая к слову является приблизительно сферической, на плоскую 2D-плоскость, используя любую проекцию, определенную пакетом <code>mapproj</code>. Карты, как правило, не сохраняют прямых линий, поэтому это требует значительных вычислений. Coord_quickmap - быстрое приближение, которое сохраняет прямые линии. Он лучше всего подходит для небольших площадей ближе к экватору.</p>
<p>По умолчанию, <code>coord_map()</code> использует <a href="https://ru.wikipedia.org/wiki/Проекция_Меркатора">проекцию Меркатора</a>.
Собственно в хэлпе больше информации с примерами. <a href="https://ggplot2.tidyverse.org/reference/coord_map.html">ggplot</a></p>
</div>
<div id="-3.9.4" class="section level4">
<h4><span class="header-section-number">2.1.8.4</span> Упражнения 3.9.4</h4>
<div class="question">
<p>What does the plot below tell you about the relationship between city and highway mpg? Why is <code>coord_fixed()</code> important? What does <code>geom_abline()</code> do?</p>
</div>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb100-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb100-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb100-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_fixed</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<p>Функция <code>coord_fixed()</code> представляет количество единиц по оси Y, эквивалентное одной единице по оси X. Что в свою очередь гарантирует, что линия, созданная <code>geom_abline()</code>, имеет угол <span class="math inline">\(45^{\circ}\)</span>. 45-градусная линия позволяет легко сравнить пробег по шоссе и городу с корпусом, в котором город и шоссе MPG были равны.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb101-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cty, <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb101-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb101-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-76-1.png" width="672" /></p>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">2.1.9</span> Многослойная грамматика графики</h3>
<p>Шаблон кода после всего пройденного материала выглядит следующим образом:</p>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;COORDINATE_FUNCTION&gt; +
  &lt;FACET_FUNCTION&gt;</code></pre>
<!--chapter:end:01_data_visualisation.Rmd-->
</div>
</div>
<div id="--" class="section level2">
<h2><span class="header-section-number">2.2</span> Рабочий процесс: основы</h2>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb103-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb103-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)</a>
<a class="sourceLine" id="cb103-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</a>
<a class="sourceLine" id="cb103-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</a>
<a class="sourceLine" id="cb103-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;Lahman&quot;</span>)</a>
<a class="sourceLine" id="cb103-6" data-line-number="6"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<div id="--" class="section level3">
<h3><span class="header-section-number">2.2.1</span> Основы написания кода</h3>
<p>Для вывода символа присвоения <code>&lt;-</code> на MacBook, необходимо нажать комбинацию клавиш <option> + &lt;-&gt; (минус)
### Что представляют собой имена
<code>R</code> чувствителен к регистру.</p>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.2.2</span> Вызов функций</h3>
<p>Не было упражнений</p>
<div id="-4.4.1" class="section level4">
<h4><span class="header-section-number">2.2.2.1</span> Упражнение 4.4.1</h4>
<div class="question">
<p>Why does this code not work?</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" data-line-number="1">my_variable &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb104-2" data-line-number="2">my_varıable</a></code></pre></div>
<p>Look carefully! (This may seem like an exercise in pointlessness, but training your brain to notice even the tiniest difference will pay off when programming.)</p>
</div>
<p>Код не работает, потому что допущена опечатка при вызове функции. Обратите внимание на <code>i</code>. Пишите без ошибок.</p>
</div>
<div id="-4.4.2" class="section level4">
<h4><span class="header-section-number">2.2.2.2</span> Упражнение 4.4.2</h4>
<div class="question">
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb105-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb105-2" data-line-number="2"></a>
<a class="sourceLine" id="cb105-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="dt">dota =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb105-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a>
<a class="sourceLine" id="cb105-5" data-line-number="5"></a>
<a class="sourceLine" id="cb105-6" data-line-number="6"><span class="kw">fliter</span>(mpg, <span class="dt">cyl =</span> <span class="dv">8</span>)</a>
<a class="sourceLine" id="cb105-7" data-line-number="7"><span class="kw">filter</span>(diamond, carat <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
</div>
<p>Должно быть так. В названии библиотеки забыли кавычки <code>&quot;&quot;</code></p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a></code></pre></div>
<p>При объявнлении исходных данных допущена ошибка. Вместо <code>data</code> написано <code>dota</code></p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb107-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> mpg) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb107-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> displ, <span class="dt">y =</span> hwy))</a></code></pre></div>
<p>В следующем примере пришлось чуть повозиться. Тут одновременно несколько ошибок. Вместо <code>filter()</code> написано <code>fliter()</code>. А при объявлении, нужно было правильно сравнивать вместо <code>=</code> надо <code>==</code></p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" data-line-number="1"><span class="kw">filter</span>(mpg, <span class="dt">cyl =</span> <span class="dv">8</span>)</a></code></pre></div>
<p>И в последнем примере при объявлении фрейма данных допущена опечатка. Вместо <code>diamond</code> надо писать <code>diamonds</code>.</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" data-line-number="1"><span class="kw">filter</span>(diamonds, carat <span class="op">&gt;</span><span class="st"> </span><span class="dv">3</span>)</a></code></pre></div>
</div>
<div id="-4.4.3" class="section level4">
<h4><span class="header-section-number">2.2.2.3</span> Упражнение 4.4.3</h4>
<div class="question">
<p>Press Alt + Shift + K. What happens? How can you get to the same place using the menus?</p>
</div>
<p>Это открывает меню шорт-катов, чтобы открыть его “вручну” нужно пройти по адресу <code>Tools -&gt; Keyboard Shortcuts Help</code>.</p>
<!--chapter:end:02_workflow_basics.Rmd-->
</div>
</div>
</div>
<div id="-----dplyr" class="section level2">
<h2><span class="header-section-number">2.3</span> Преобразование данных с помощью пакета <code>dplyr</code></h2>
<div id="-2" class="section level3">
<h3><span class="header-section-number">2.3.1</span> Введение</h3>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.3.1.1</span> Используемые ресурсы</h4>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb110-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)</a>
<a class="sourceLine" id="cb110-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</a>
<a class="sourceLine" id="cb110-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</a>
<a class="sourceLine" id="cb110-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;Lahman&quot;</span>)</a>
<a class="sourceLine" id="cb110-6" data-line-number="6"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
<p>Некоторые имена функций в разных библиотеках дублируются. Когда в <code>R</code> подключается несколько пакетов, в которых названия функций дублируются, программа выдает сообщение об ошибке</p>
<pre><code># ── Conflicts ─────────────────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
# ✖ dplyr::filter() masks stats::filter()
# ✖ dplyr::lag()    masks stats::lag()</code></pre>
<p>Для того чтобы обратится к необходимой функции, нужно использовать полное имя <code>stats::filter()</code>, <code>stats::lag()</code></p>
</div>
<div id="-nycflights13" class="section level4">
<h4><span class="header-section-number">2.3.1.2</span> Пакет <code>nycflights13</code></h4>
<table>
<thead>
<tr class="header">
<th>Переменная</th>
<th align="center">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>int</code></td>
<td align="center">целые числа</td>
</tr>
<tr class="even">
<td><code>dbl</code></td>
<td align="center">числа с плавающей точкой</td>
</tr>
<tr class="odd">
<td><code>chr</code></td>
<td align="center">символьные векторы или строки</td>
</tr>
<tr class="even">
<td><code>dttm</code></td>
<td align="center">дата + время</td>
</tr>
<tr class="odd">
<td><code>lgl</code></td>
<td align="center">булевы векторы</td>
</tr>
<tr class="even">
<td><code>fctr</code></td>
<td align="center">факторы</td>
</tr>
<tr class="odd">
<td><code>date</code></td>
<td align="center">даты</td>
</tr>
</tbody>
</table>
</div>
<div id="----dplyr" class="section level4">
<h4><span class="header-section-number">2.3.1.3</span> Основные сведения о пакете <code>dplyr</code></h4>
<p>Минимум для работы с этим пакетом:</p>
<table>
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th align="center">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>filter()</code></td>
<td align="center">выбор наблюдений по их значениям</td>
</tr>
<tr class="even">
<td><code>arrange()</code></td>
<td align="center">перестановка строк</td>
</tr>
<tr class="odd">
<td><code>select()</code></td>
<td align="center">выбор переменных по их именам</td>
</tr>
<tr class="even">
<td><code>mutate()</code></td>
<td align="center">создание новых переменных с использованием существующих</td>
</tr>
<tr class="odd">
<td><code>summarize()</code></td>
<td align="center">сведение нескольких значений в одно итоговое</td>
</tr>
<tr class="even">
<td><code>group_by()</code></td>
<td align="center">изменяет область действия функции от всего набора данных до отдельных участков</td>
</tr>
</tbody>
</table>
<p>Все глаголы подчиняются одному и тому же синтаксису</p>
<ol style="list-style-type: decimal">
<li><p>Первый аргумент <span class="math inline">\(-\)</span> это фрейм данных</p></li>
<li><p>Последующие аргументы описывают действия, которые должны быть выполнены по отношению к фрейму данных.</p></li>
<li><p>Результат <span class="math inline">\(-\)</span> это новый фрейм данных</p></li>
</ol>
</div>
</div>
<div id="-----filter" class="section level3">
<h3><span class="header-section-number">2.3.2</span> Фильтрация строк с помощью функции <code>filter()</code></h3>
<p>Функция <code>filter()</code> позволяет что бы вы думали? позволяет фильтровать! Первым аргументом указываем фрейм данных, последующие аргументы, это параметры (столбцы) которые мы желаем отфильтровать через операторы сравнения.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" data-line-number="1"><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 26,162 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     2       42           2359        43      518
##  2  2013     1     2      126           2250       156      233
##  3  2013     1     2      458            500        -2      703
##  4  2013     1     2      512            515        -3      809
##  5  2013     1     2      535            540        -5      831
##  6  2013     1     2      536            529         7      840
##  7  2013     1     2      539            545        -6      959
##  8  2013     1     2      554            600        -6      845
##  9  2013     1     2      554            600        -6      841
## 10  2013     1     2      554            600        -6      909
## # … with 26,152 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Функция <code>filter()</code>, как и многие другие расширения пакета <code>dplyr</code>, не изменяют исходных данных. Желаемый фильтр нужно присвоить в новую переменную</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" data-line-number="1">jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<p>Если нужно выполнить присвоение и вывод на экран, нужно обнять выражение скобками.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" data-line-number="1">(jan1 &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">1</span>))</a></code></pre></div>
<pre><code>## # A tibble: 842 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 832 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="section level4">
<h4><span class="header-section-number">2.3.2.1</span> Сравнения</h4>
<p>Операторы сравнения стандартные <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code></p>
<p>Компьюьеры используют арифметику конечной точности. Поэтому</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" data-line-number="1"><span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.3.2.2</span> Логические операторы</h4>
<p>Булевы операторы: И - <code>&amp;</code>, ИЛИ - <code>|</code>, НЕ - <code>!</code>, исключающее ИЛИ - <code>xor()</code>.
Полный набор булевых операций показан на рисунке.</p>
<div class="figure">
<img src="img/transform-logical.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Что следует помнить. Добавляя булевы операторы в функцию <code>filter()</code> необходимо помнить, что сравнивать нужно программно, а не так как это звучит лексически. То есть, если мы хотим все авиарейсы отправленные в декабре и ноябре, нужно писать так.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" data-line-number="1">(<span class="kw">filter</span>(flights, month <span class="op">==</span><span class="st"> </span><span class="dv">11</span> <span class="op">|</span><span class="st"> </span>month <span class="op">==</span><span class="st"> </span><span class="dv">12</span>))</a></code></pre></div>
<pre><code>## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    11     1        5           2359         6      352
##  2  2013    11     1       35           2250       105      123
##  3  2013    11     1      455            500        -5      641
##  4  2013    11     1      539            545        -6      856
##  5  2013    11     1      542            545        -3      831
##  6  2013    11     1      549            600       -11      912
##  7  2013    11     1      550            600       -10      705
##  8  2013    11     1      554            600        -6      659
##  9  2013    11     1      554            600        -6      826
## 10  2013    11     1      554            600        -6      749
## # … with 55,393 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Что дословно произносится как “отфильтровать все полёты из набора данных <code>flights</code>, вылетавших в месяце ноябре или в месяце декабре”. Можно следовать лексическому соответствию, но для этого нужно использовать оператор <code>%in%</code></p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" data-line-number="1">(<span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">11</span>, <span class="dv">12</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 55,403 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013    11     1        5           2359         6      352
##  2  2013    11     1       35           2250       105      123
##  3  2013    11     1      455            500        -5      641
##  4  2013    11     1      539            545        -6      856
##  5  2013    11     1      542            545        -3      831
##  6  2013    11     1      549            600       -11      912
##  7  2013    11     1      550            600       -10      705
##  8  2013    11     1      554            600        -6      659
##  9  2013    11     1      554            600        -6      826
## 10  2013    11     1      554            600        -6      749
## # … with 55,393 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><strong>Закон Моргана:</strong></p>
<ul>
<li><p><code>!(x &amp; y) == !x | !y</code></p></li>
<li><p><code>!(x | y) == !x &amp; !y</code></p></li>
</ul>
<p>Проверь на рисунке выше.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.3.2.3</span> Отсутствующие значения</h4>
<p>Функция <code>filter()</code> включает в вывод лишь те строки, для которых условие имеет значение <code>TRUE</code>. <code>FALSE</code> и <code>NA</code> исключаются.</p>
<p>Для того чтобы проверить является ли используемое значением отсутствующим можно использовать функцию <code>is.na()</code></p>
</div>
<div id="-5.2.4.1" class="section level4">
<h4><span class="header-section-number">2.3.2.4</span> Упражнение 5.2.4.1</h4>
<div class="question">
<p>Найдите все авиарейсы, которые</p>
</div>
<ul>
<li>а) задержались с прилётом на два и более часа</li>
</ul>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" data-line-number="1">(arr_delay &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">120</span>))</a></code></pre></div>
<pre><code>## # A tibble: 10,200 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      811            630       101     1047
##  2  2013     1     1      848           1835       853     1001
##  3  2013     1     1      957            733       144     1056
##  4  2013     1     1     1114            900       134     1447
##  5  2013     1     1     1505           1310       115     1638
##  6  2013     1     1     1525           1340       105     1831
##  7  2013     1     1     1549           1445        64     1912
##  8  2013     1     1     1558           1359       119     1718
##  9  2013     1     1     1732           1630        62     2028
## 10  2013     1     1     1803           1620       103     2008
## # … with 10,190 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>б) вылетали в Хьюстон (аэропорты IAH и HOU)</li>
</ul>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" data-line-number="1">(hou_flight &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dest <span class="op">==</span><span class="st"> &quot;IAH&quot;</span> <span class="op">|</span><span class="st"> </span>dest <span class="op">==</span><span class="st"> &quot;HOU&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 9,313 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      623            627        -4      933
##  4  2013     1     1      728            732        -4     1041
##  5  2013     1     1      739            739         0     1104
##  6  2013     1     1      908            908         0     1228
##  7  2013     1     1     1028           1026         2     1350
##  8  2013     1     1     1044           1045        -1     1352
##  9  2013     1     1     1114            900       134     1447
## 10  2013     1     1     1205           1200         5     1503
## # … with 9,303 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>в) Обслуживались авиакомпаниями United, American or Delta</li>
</ul>
<p>Для того чтобы узнать аббревиатуры перевозчиков, смотрим <code>airlanes</code> в хэлпе</p>
<p>Получается: United - это <code>UA</code>, American - <code>AA</code>, Delta - <code>DL</code>. Тогда искомые данные это:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" data-line-number="1">(three_carriers &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, carrier <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;UA&quot;</span>, <span class="st">&quot;AA&quot;</span>, <span class="st">&quot;DL&quot;</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 139,504 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      554            600        -6      812
##  5  2013     1     1      554            558        -4      740
##  6  2013     1     1      558            600        -2      753
##  7  2013     1     1      558            600        -2      924
##  8  2013     1     1      558            600        -2      923
##  9  2013     1     1      559            600        -1      941
## 10  2013     1     1      559            600        -1      854
## # … with 139,494 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>г) Вылетали в летнее время (июль, август, сентябрь). Странное у них летнее время</li>
</ul>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" data-line-number="1">(sum_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7     1        1           2029       212      236
##  2  2013     7     1        2           2359         3      344
##  3  2013     7     1       29           2245       104      151
##  4  2013     7     1       43           2130       193      322
##  5  2013     7     1       44           2150       174      300
##  6  2013     7     1       46           2051       235      304
##  7  2013     7     1       48           2001       287      308
##  8  2013     7     1       58           2155       183      335
##  9  2013     7     1      100           2146       194      327
## 10  2013     7     1      100           2245       135      337
## # … with 86,316 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>д) Прилетали с опозданием более чем на два часа но не задерживались с вылетом</li>
</ul>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" data-line-number="1">(dep_arr_delay &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">120</span>, dep_delay <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>))</a></code></pre></div>
<pre><code>## # A tibble: 29 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    27     1419           1420        -1     1754
##  2  2013    10     7     1350           1350         0     1736
##  3  2013    10     7     1357           1359        -2     1858
##  4  2013    10    16      657            700        -3     1258
##  5  2013    11     1      658            700        -2     1329
##  6  2013     3    18     1844           1847        -3       39
##  7  2013     4    17     1635           1640        -5     2049
##  8  2013     4    18      558            600        -2     1149
##  9  2013     4    18      655            700        -5     1213
## 10  2013     5    22     1827           1830        -3     2217
## # … with 19 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>е) Вылетали с задержкое не менее чем на час, но наверстывали более 30 минут во время полёта. Если полёт проходит ровно, то задержка отправления равна задержке прибытия. <code>Или dep_delay - arr_delay == 0</code>. Так как самолёт наверстал в пути, значит разница равна не нулю, она больше 30.</li>
</ul>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" data-line-number="1">(speedy_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dep_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">60</span>, dep_delay <span class="op">-</span><span class="st"> </span>arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">30</span> ))</a></code></pre></div>
<pre><code>## # A tibble: 1,844 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1     2205           1720       285       46
##  2  2013     1     1     2326           2130       116      131
##  3  2013     1     3     1503           1221       162     1803
##  4  2013     1     3     1839           1700        99     2056
##  5  2013     1     3     1850           1745        65     2148
##  6  2013     1     3     1941           1759       102     2246
##  7  2013     1     3     1950           1845        65     2228
##  8  2013     1     3     2015           1915        60     2135
##  9  2013     1     3     2257           2000       177       45
## 10  2013     1     4     1917           1700       137     2135
## # … with 1,834 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>ж) Вылетали между полуночью и 6 часами утра включительно</li>
</ul>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" data-line-number="1">(moon &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, dep_time <span class="op">==</span><span class="st"> </span><span class="dv">2400</span> <span class="op">|</span><span class="st"> </span>dep_time <span class="op">&lt;=</span><span class="st"> </span><span class="dv">600</span>))</a></code></pre></div>
<pre><code>## # A tibble: 9,373 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 9,363 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.2.4.2" class="section level4">
<h4><span class="header-section-number">2.3.2.5</span> Упражнение 5.2.4.2</h4>
<div class="question">
<p>Another useful <code>dplyr</code> filtering helper is <code>between()</code>. What does it do? Can you use it to simplify the code needed to answer the previous challenges?</p>
</div>
<p>Из описания в хэлпе, функция <code>between()</code> это короткая запись для <code>&gt;= left &amp; x &lt;= right</code>. Или если быть точным: <code>between(x, left, right)</code>. Конечно её гораздо удобнее использовать. Эту функцию можно применить к упражнению <em>г</em>. Сравним:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb137-1" data-line-number="1">(sum_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, month <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7     1        1           2029       212      236
##  2  2013     7     1        2           2359         3      344
##  3  2013     7     1       29           2245       104      151
##  4  2013     7     1       43           2130       193      322
##  5  2013     7     1       44           2150       174      300
##  6  2013     7     1       46           2051       235      304
##  7  2013     7     1       48           2001       287      308
##  8  2013     7     1       58           2155       183      335
##  9  2013     7     1      100           2146       194      327
## 10  2013     7     1      100           2245       135      337
## # … with 86,316 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb139-1" data-line-number="1">(sum_flights &lt;-<span class="st"> </span><span class="kw">filter</span>(flights, <span class="kw">between</span>(month, <span class="dv">7</span>, <span class="dv">9</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 86,326 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7     1        1           2029       212      236
##  2  2013     7     1        2           2359         3      344
##  3  2013     7     1       29           2245       104      151
##  4  2013     7     1       43           2130       193      322
##  5  2013     7     1       44           2150       174      300
##  6  2013     7     1       46           2051       235      304
##  7  2013     7     1       48           2001       287      308
##  8  2013     7     1       58           2155       183      335
##  9  2013     7     1      100           2146       194      327
## 10  2013     7     1      100           2245       135      337
## # … with 86,316 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.2.4.3" class="section level4">
<h4><span class="header-section-number">2.3.2.6</span> Упражнение 5.2.4.3</h4>
<div class="question">
<p>How many flights have a missing <code>dep_time</code>? What other variables are missing? What might these rows represent?</p>
</div>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb141-1" data-line-number="1">(<span class="kw">filter</span>(flights, <span class="kw">is.na</span>(dep_time)))</a></code></pre></div>
<pre><code>## # A tibble: 8,255 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA
##  2  2013     1     1       NA           1935        NA       NA
##  3  2013     1     1       NA           1500        NA       NA
##  4  2013     1     1       NA            600        NA       NA
##  5  2013     1     2       NA           1540        NA       NA
##  6  2013     1     2       NA           1620        NA       NA
##  7  2013     1     2       NA           1355        NA       NA
##  8  2013     1     2       NA           1420        NA       NA
##  9  2013     1     2       NA           1321        NA       NA
## 10  2013     1     2       NA           1545        NA       NA
## # … with 8,245 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Ответ 8255 рейсов. Так же отсутствуют: <code>dep_delay</code>, <code>arr_time</code>, <code>arr_delay</code>. Вероятно это отменённые рейсы.</p>
</div>
<div id="-5.2.4.4" class="section level4">
<h4><span class="header-section-number">2.3.2.7</span> Упражнение 5.2.4.4</h4>
<div class="question">
<p>Why is <code>NA ^ 0</code> not missing? Why is <code>NA | TRUE</code> not missing? Why is <code>FALSE &amp; NA</code> not missing? Can you figure out the general rule? (<code>NA * 0</code> is a tricky counterexample!)</p>
</div>
<ol style="list-style-type: decimal">
<li><p><code>NA ^ 0 == 1</code>. Всё в точности с математикой, которая говорит, что любое значение в степени 0 == 1 или точнее <span class="math inline">\(x^0=1\)</span></p></li>
<li><p><code>NA | TRUE</code>. Всё или ПРАВДА всегда правда :</p></li>
</ol>
<table>
<thead>
<tr class="header">
<th align="center"><span class="math inline">\(a\)</span></th>
<th align="center"><span class="math inline">\(b\)</span></th>
<th align="center"><span class="math inline">\(a\lor b\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">1</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><code>FALSE &amp; NA</code>. Всё и ЛОЖЬ всегда Ложь.</li>
</ol>
<table>
<thead>
<tr class="header">
<th align="center"><span class="math inline">\(a\)</span></th>
<th align="center"><span class="math inline">\(b\)</span></th>
<th align="center"><span class="math inline">\(a\land b\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">0</td>
<td align="center">1</td>
<td align="center">0</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">0</td>
<td align="center">0</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
</tbody>
</table>
<ol style="list-style-type: decimal">
<li><code>NA * 0</code>. Причина по которой значение неопределено. Это то что умножение чего угодна на бесконечность, равно бесконечности, или правильнее - неопределённое значение. <a href="https://ru.wikipedia.org/wiki/NaN">нечисло</a></li>
</ol>
</div>
</div>
<div id="-----arange" class="section level3">
<h3><span class="header-section-number">2.3.3</span> Перестановка строк с помощью функции <code>arange()</code></h3>
<p>Синтаксис у этой функции такой же как у фильтра. <code>arranga()</code> сортирует по убыванию, а не фильтрует список. При этом отсутствующие значения всегда остаются в конце. При этом для сортировки по возрастанию используется функция <code>desc()</code></p>
<div id="-5.3.1.1" class="section level4">
<h4><span class="header-section-number">2.3.3.1</span> Упражнение 5.3.1.1</h4>
<div class="question">
<p>How could you use <code>arrange()</code> to sort all missing values to the start? (Hint: use <code>is.na()</code>).</p>
</div>
<p>Берём пример из учебника.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb143-1" data-line-number="1"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(arr_delay))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     7    22     2257            759       898      121
##  9  2013    12     5      756           1700       896     1058
## 10  2013     5     3     1133           2055       878     1250
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Добавляем как подсказывают, функцию <code>is.na()</code></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" data-line-number="1"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(<span class="kw">is.na</span>(arr_delay)))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1     1525           1530        -5     1934
##  2  2013     1     1     1528           1459        29     2002
##  3  2013     1     1     1740           1745        -5     2158
##  4  2013     1     1     1807           1738        29     2251
##  5  2013     1     1     1939           1840        59       29
##  6  2013     1     1     1952           1930        22     2358
##  7  2013     1     1     2016           1930        46       NA
##  8  2013     1     1       NA           1630        NA       NA
##  9  2013     1     1       NA           1935        NA       NA
## 10  2013     1     1       NA           1500        NA       NA
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.3.1.2" class="section level4">
<h4><span class="header-section-number">2.3.3.2</span> Упражнение 5.3.1.2</h4>
<div class="question">
<p>Sort <code>flights</code> to find the most delayed flights. Find the flights that left earliest.</p>
</div>
<p>Чтобы найти рейсы с самыми большими задержками, сортируем по возрастанию соответствующий столбец <code>dep_delay</code></p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" data-line-number="1"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     6    27      959           1900       899     1236
##  9  2013     7    22     2257            759       898      121
## 10  2013    12     5      756           1700       896     1058
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Первые десять рейсов задерживались на время от 896 минут до 1301, это почти сутки (21 час) в аэропорте. Уффф.</p>
<p>Чтобы найти рейсы с самым ранним временем вылета, сортируем по убыванию соответствующий столбец <code>dep_time</code></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" data-line-number="1"><span class="kw">arrange</span>(flights, dep_time)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    13        1           2249        72      108
##  2  2013     1    31        1           2100       181      124
##  3  2013    11    13        1           2359         2      442
##  4  2013    12    16        1           2359         2      447
##  5  2013    12    20        1           2359         2      430
##  6  2013    12    26        1           2359         2      437
##  7  2013    12    30        1           2359         2      441
##  8  2013     2    11        1           2100       181      111
##  9  2013     2    24        1           2245        76      121
## 10  2013     3     8        1           2355         6      431
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Ожидаемо, это время вылетов в полночь и минутой позднее.</p>
</div>
<div id="-5.3.1.3" class="section level4">
<h4><span class="header-section-number">2.3.3.3</span> Упражнение 5.3.1.3</h4>
<div class="question">
<p>Sort <code>flights</code> to find the fastest flights.</p>
</div>
<p>Чтобы найти самые быстрые полёты, отсортируем все полёты по времени проведённому в воздухе. Это столбец <code>air_time</code> отсортированный по возрастанию.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb151-1" data-line-number="1"><span class="kw">arrange</span>(flights, air_time)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    16     1355           1315        40     1442
##  2  2013     4    13      537            527        10      622
##  3  2013    12     6      922            851        31     1021
##  4  2013     2     3     2153           2129        24     2247
##  5  2013     2     5     1303           1315       -12     1342
##  6  2013     2    12     2123           2130        -7     2211
##  7  2013     3     2     1450           1500       -10     1547
##  8  2013     3     8     2026           1935        51     2131
##  9  2013     3    18     1456           1329        87     1533
## 10  2013     3    19     2226           2145        41     2305
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-5.3.1.4" class="section level4">
<h4><span class="header-section-number">2.3.3.4</span> Упражнение 5.3.1.4</h4>
<div class="question">
<p>Which flights traveled the longest? Which traveled the shortest?</p>
</div>
<p>Сделаем так, сначала отсортируем по расстоянию, а потом по времени проведённому в воздухе</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb153-1" data-line-number="1"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      857            900        -3     1516
##  2  2013     1     2      909            900         9     1525
##  3  2013     1     3      914            900        14     1504
##  4  2013     1     4      900            900         0     1516
##  5  2013     1     5      858            900        -2     1519
##  6  2013     1     6     1019            900        79     1558
##  7  2013     1     7     1042            900       102     1620
##  8  2013     1     8      901            900         1     1504
##  9  2013     1     9      641            900      1301     1242
## 10  2013     1    10      859            900        -1     1449
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Самые длинные полёты из <code>JFK</code> в <code>HNL</code>. Из Нью-Йорка в Гонолулу - 4983 мили.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" data-line-number="1"><span class="kw">arrange</span>(flights, <span class="kw">desc</span>(distance))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      857            900        -3     1516
##  2  2013     1     2      909            900         9     1525
##  3  2013     1     3      914            900        14     1504
##  4  2013     1     4      900            900         0     1516
##  5  2013     1     5      858            900        -2     1519
##  6  2013     1     6     1019            900        79     1558
##  7  2013     1     7     1042            900       102     1620
##  8  2013     1     8      901            900         1     1504
##  9  2013     1     9      641            900      1301     1242
## 10  2013     1    10      859            900        -1     1449
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p><a href="https://www.google.com/maps/dir/Гонолулу+(HNL),+300+Rodgers+Blvd,+Honolulu,+HI+96819,+США/JFK+International+Airport,+New+York,+NY,+USA/@27.4344347,-126.6384014,4.03z/data=!4m14!4m13!1m5!1m1!1s0x7c006f943168f55f:0x7ed111b1cbf331df!2m2!1d-157.9250736!2d21.3245132!1m5!1m1!1s0x89c26650d5404947:0xec4fb213489f11f0!2m2!1d-73.7781391!2d40.6413111!3e4">Полёт длится 691 минуту</a></p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" data-line-number="1"><span class="kw">arrange</span>(flights, distance)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7    27       NA            106        NA       NA
##  2  2013     1     3     2127           2129        -2     2222
##  3  2013     1     4     1240           1200        40     1333
##  4  2013     1     4     1829           1615       134     1937
##  5  2013     1     4     2128           2129        -1     2218
##  6  2013     1     5     1155           1200        -5     1241
##  7  2013     1     6     2125           2129        -4     2224
##  8  2013     1     7     2124           2129        -5     2212
##  9  2013     1     8     2127           2130        -3     2304
## 10  2013     1     9     2126           2129        -3     2217
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Самый короткий из <code>EWR</code> в <code>LGA</code>. Перелёт в пределах Нью-Йорка, который по всей видимости не состоялся, так как у него нету времени полёта. Следующий за ним это полёт из Нью-Арка в Филадельфию - 80 миль. Посмотрим ещё и по времени, проведённому в воздухе:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" data-line-number="1"><span class="kw">arrange</span>(flights, distance, air_time)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7    27       NA            106        NA       NA
##  2  2013     2     3     2153           2129        24     2247
##  3  2013     2    12     2123           2130        -7     2211
##  4  2013     1     6     2125           2129        -4     2224
##  5  2013     1    23     2128           2129        -1     2221
##  6  2013     2    10     2127           2129        -2     2209
##  7  2013     2     1     2128           2129        -1     2216
##  8  2013     3    30     1942           1950        -8     2026
##  9  2013     1     7     2124           2129        -5     2212
## 10  2013     1    14     2128           2129        -1     2215
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
</div>
<div id="-----select" class="section level3">
<h3><span class="header-section-number">2.3.4</span> Выбор столбцов с помощью функции <code>select()</code></h3>
<p>Функция <code>select()</code> помогает отобрать из фрейма данных необходимые столбцы. Синтаксис простой и привычный</p>
<ul>
<li>Указать конкретные столбцы можно через запятую</li>
</ul>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="kw">select</span>(flights, year, month, day)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows</code></pre>
<ul>
<li>Указать столбцы в промежутке</li>
</ul>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1"><span class="kw">select</span>(flights, year<span class="op">:</span>day)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # … with 336,766 more rows</code></pre>
<ul>
<li>Выбрать всех столбцов за исключением тех, которые находятся между столбцами включая последние</li>
</ul>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="op">-</span>(year<span class="op">:</span>day))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 16
##    dep_time sched_dep_time dep_delay arr_time sched_arr_time arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;
##  1      517            515         2      830            819        11
##  2      533            529         4      850            830        20
##  3      542            540         2      923            850        33
##  4      544            545        -1     1004           1022       -18
##  5      554            600        -6      812            837       -25
##  6      554            558        -4      740            728        12
##  7      555            600        -5      913            854        19
##  8      557            600        -3      709            723       -14
##  9      557            600        -3      838            846        -8
## 10      558            600        -2      753            745         8
## # … with 336,766 more rows, and 10 more variables: carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li><p><code>start_with(&quot;abc&quot;)</code> - соответствует именам, начинающимся с последовательности символов “abc”</p></li>
<li><p><code>end_with(&quot;abc&quot;)</code> - соответствует именам, заканчивающимся последовательностью символов “abc”</p></li>
<li><p><code>contains(&quot;abc&quot;)</code> - соответствует именам, содержащим последовательности символов “abc”</p></li>
<li><p><code>matches(&quot;(.)\\1&quot;)</code> - выбирает переменные, соответствующие регулярному выражению.</p></li>
<li><p><code>num_range(&quot;x&quot;, 1:3)</code> - соответствует <code>x1</code>, <code>x2</code>, <code>x3</code></p></li>
<li><p>Переименовать переменные, сохраняя все переменные не указанные в явном виде</p></li>
</ul>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1"><span class="kw">rename</span>(flights, <span class="dt">tail_num =</span> tailnum)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tail_num &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>Переместить в начало переменные.</li>
</ul>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" data-line-number="1"><span class="kw">select</span>(flights, time_hour, air_time, <span class="kw">everything</span>())</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##    time_hour           air_time  year month   day dep_time sched_dep_time
##    &lt;dttm&gt;                 &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;
##  1 2013-01-01 05:00:00      227  2013     1     1      517            515
##  2 2013-01-01 05:00:00      227  2013     1     1      533            529
##  3 2013-01-01 05:00:00      160  2013     1     1      542            540
##  4 2013-01-01 05:00:00      183  2013     1     1      544            545
##  5 2013-01-01 06:00:00      116  2013     1     1      554            600
##  6 2013-01-01 05:00:00      150  2013     1     1      554            558
##  7 2013-01-01 06:00:00      158  2013     1     1      555            600
##  8 2013-01-01 06:00:00       53  2013     1     1      557            600
##  9 2013-01-01 06:00:00      140  2013     1     1      557            600
## 10 2013-01-01 06:00:00      138  2013     1     1      558            600
## # … with 336,766 more rows, and 12 more variables: dep_delay &lt;dbl&gt;,
## #   arr_time &lt;int&gt;, sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;,
## #   flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, distance &lt;dbl&gt;,
## #   hour &lt;dbl&gt;, minute &lt;dbl&gt;</code></pre>
<div id="-5.4.1.1" class="section level4">
<h4><span class="header-section-number">2.3.4.1</span> Упражнение 5.4.1.1</h4>
<div class="question">
<p>Brainstorm as many ways as possible to select <code>dep_time</code>, <code>dep_delay</code>, <code>arr_time</code>, and <code>arr_delay</code> from <code>flights</code>.</p>
</div>
<ol style="list-style-type: decimal">
<li>Указать конкретные столбцы через запятую</li>
</ol>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="kw">select</span>(flights, dep_time, dep_delay, arr_time, arr_delay)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # … with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Указать столбцы в промежутке и исключить лишние</li>
</ol>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw">select</span>(flights, dep_time<span class="op">:</span>arr_delay, <span class="op">-</span>sched_dep_time, <span class="op">-</span>sched_arr_time)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # … with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Изощренный способ. Перенесём в начало нужные столбцы, отбросим лишние в промежутке</li>
</ol>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb175-1" data-line-number="1">new_flights &lt;-<span class="st"> </span><span class="kw">select</span>(flights, dep_time, dep_delay, arr_time, arr_delay, <span class="kw">everything</span>())</a>
<a class="sourceLine" id="cb175-2" data-line-number="2"><span class="kw">select</span>(new_flights, <span class="op">-</span>(year<span class="op">:</span>time_hour))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # … with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Укажем номера столбцов</li>
</ol>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">9</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time sched_dep_time dep_delay arr_delay
##       &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1      517            515         2        11
##  2      533            529         4        20
##  3      542            540         2        33
##  4      544            545        -1       -18
##  5      554            600        -6       -25
##  6      554            558        -4        12
##  7      555            600        -5        19
##  8      557            600        -3       -14
##  9      557            600        -3        -8
## 10      558            600        -2         8
## # … with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Столбцы начинающиеся на <code>dep_</code> и <code>arr_</code></li>
</ol>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="kw">starts_with</span>(<span class="st">&quot;dep_&quot;</span>), <span class="kw">starts_with</span>(<span class="st">&quot;arr_&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time dep_delay arr_time arr_delay
##       &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1      517         2      830        11
##  2      533         4      850        20
##  3      542         2      923        33
##  4      544        -1     1004       -18
##  5      554        -6      812       -25
##  6      554        -4      740        12
##  7      555        -5      913        19
##  8      557        -3      709       -14
##  9      557        -3      838        -8
## 10      558        -2      753         8
## # … with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li>Столбцы содержащие и не содержащие</li>
</ol>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;_time&quot;</span>), <span class="kw">contains</span>(<span class="st">&quot;_delay&quot;</span>), <span class="op">-</span><span class="kw">contains</span>(<span class="st">&quot;sched&quot;</span>), <span class="op">-</span><span class="kw">contains</span>(<span class="st">&quot;air&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time arr_time dep_delay arr_delay
##       &lt;int&gt;    &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1      517      830         2        11
##  2      533      850         4        20
##  3      542      923         2        33
##  4      544     1004        -1       -18
##  5      554      812        -6       -25
##  6      554      740        -4        12
##  7      555      913        -5        19
##  8      557      709        -3       -14
##  9      557      838        -3        -8
## 10      558      753        -2         8
## # … with 336,766 more rows</code></pre>
</div>
<div id="-5.4.1.2" class="section level4">
<h4><span class="header-section-number">2.3.4.2</span> Упражнение 5.4.1.2</h4>
<div class="question">
<p>What happens if you include the name of a variable multiple times in a <code>select()</code> call?</p>
</div>
<p>Если одна и та же переменная указана несколько раз, она всё равно отобразится один раз</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" data-line-number="1"><span class="kw">select</span>(flights, dep_time, dep_time, dep_time)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    dep_time
##       &lt;int&gt;
##  1      517
##  2      533
##  3      542
##  4      544
##  5      554
##  6      554
##  7      555
##  8      557
##  9      557
## 10      558
## # … with 336,766 more rows</code></pre>
</div>
<div id="-5.4.1.3" class="section level4">
<h4><span class="header-section-number">2.3.4.3</span> Упражнение 5.4.1.3</h4>
<div class="question">
<p>What does the <code>one_of()</code> function do? Why might it be helpful in conjunction with this vector?</p>
</div>
<p>Функция <code>one_of()</code> берёт переменные в символьном векторе. Это может быть полезно, если как в примере у нас есть символьный вектор значений, которые необходимо взять</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" data-line-number="1">vars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;month&quot;</span>, <span class="st">&quot;day&quot;</span>, <span class="st">&quot;dep_delay&quot;</span>, <span class="st">&quot;arr_delay&quot;</span>)</a>
<a class="sourceLine" id="cb185-2" data-line-number="2"><span class="kw">select</span>(flights, <span class="kw">one_of</span>(vars))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 5
##     year month   day dep_delay arr_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1  2013     1     1         2        11
##  2  2013     1     1         4        20
##  3  2013     1     1         2        33
##  4  2013     1     1        -1       -18
##  5  2013     1     1        -6       -25
##  6  2013     1     1        -4        12
##  7  2013     1     1        -5        19
##  8  2013     1     1        -3       -14
##  9  2013     1     1        -3        -8
## 10  2013     1     1        -2         8
## # … with 336,766 more rows</code></pre>
</div>
<div id="-5.4.1.4" class="section level4">
<h4><span class="header-section-number">2.3.4.4</span> Упражнение 5.4.1.4</h4>
<div class="question">
<p>Does the result of running the following code surprise you? How do the select helpers deal with case by default? How can you change that default?</p>
</div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;
##  1      517            515      830            819      227
##  2      533            529      850            830      227
##  3      542            540      923            850      160
##  4      544            545     1004           1022      183
##  5      554            600      812            837      116
##  6      554            558      740            728      150
##  7      555            600      913            854      158
##  8      557            600      709            723       53
##  9      557            600      838            846      140
## 10      558            600      753            745      138
## # … with 336,766 more rows, and 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<p>Удивительно, что <code>contains()</code> невосприимчив к регистру:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb189-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;time&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##    dep_time sched_dep_time arr_time sched_arr_time air_time
##       &lt;int&gt;          &lt;int&gt;    &lt;int&gt;          &lt;int&gt;    &lt;dbl&gt;
##  1      517            515      830            819      227
##  2      533            529      850            830      227
##  3      542            540      923            850      160
##  4      544            545     1004           1022      183
##  5      554            600      812            837      116
##  6      554            558      740            728      150
##  7      555            600      913            854      158
##  8      557            600      709            723       53
##  9      557            600      838            846      140
## 10      558            600      753            745      138
## # … with 336,766 more rows, and 1 more variable: time_hour &lt;dttm&gt;</code></pre>
<p>Оказывается, это регшулируется параметром <code>ignore.case</code> который по умолчанию <code>TRUE</code>:</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" data-line-number="1"><span class="kw">select</span>(flights, <span class="kw">contains</span>(<span class="st">&quot;TIME&quot;</span>, <span class="dt">ignore.case =</span> <span class="ot">FALSE</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 0</code></pre>
<p>Вот список всех функций, согласно хэлпу, невосприимчивых по умолчанию к регистру:</p>
<ul>
<li><p><code>starts_with(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
<li><p><code>ends_with(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
<li><p><code>contains(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
<li><p><code>matches(match, ignore.case = TRUE, vars = peek_vars())</code></p></li>
</ul>
</div>
</div>
<div id="-----mutate" class="section level3">
<h3><span class="header-section-number">2.3.5</span> Добавление столбцов с помощью функции <code>mutate()</code></h3>
<p>Функция <code>mutate()</code> позволяет добавлять в конец исходного фрейма данных столбцы.</p>
<p>Сделаем чуть более показательный набор данных:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" data-line-number="1">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, </a>
<a class="sourceLine" id="cb193-2" data-line-number="2">  year<span class="op">:</span>day, </a>
<a class="sourceLine" id="cb193-3" data-line-number="3">  <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), </a>
<a class="sourceLine" id="cb193-4" data-line-number="4">  distance, </a>
<a class="sourceLine" id="cb193-5" data-line-number="5">  air_time</a>
<a class="sourceLine" id="cb193-6" data-line-number="6">)</a></code></pre></div>
<p>Теперь добавим в конец этого набора дополнительные вычисления</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" data-line-number="1"><span class="kw">mutate</span>(flights_sml,</a>
<a class="sourceLine" id="cb194-2" data-line-number="2">  <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,</a>
<a class="sourceLine" id="cb194-3" data-line-number="3">  <span class="dt">speed =</span> distance <span class="op">/</span><span class="st"> </span>air_time <span class="op">*</span><span class="st"> </span><span class="dv">60</span></a>
<a class="sourceLine" id="cb194-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 9
##     year month   day dep_delay arr_delay distance air_time  gain speed
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1         2        11     1400      227    -9  370.
##  2  2013     1     1         4        20     1416      227   -16  374.
##  3  2013     1     1         2        33     1089      160   -31  408.
##  4  2013     1     1        -1       -18     1576      183    17  517.
##  5  2013     1     1        -6       -25      762      116    19  394.
##  6  2013     1     1        -4        12      719      150   -16  288.
##  7  2013     1     1        -5        19     1065      158   -24  404.
##  8  2013     1     1        -3       -14      229       53    11  259.
##  9  2013     1     1        -3        -8      944      140     5  405.
## 10  2013     1     1        -2         8      733      138   -10  319.
## # … with 336,766 more rows</code></pre>
<p>Чтобы сохранить только вычисления, без указания дополнительных столбцов, используется функция <code>transmute()</code></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" data-line-number="1"><span class="kw">transmute</span>(flights,</a>
<a class="sourceLine" id="cb196-2" data-line-number="2">  <span class="dt">gain =</span> dep_delay <span class="op">-</span><span class="st"> </span>arr_delay,</a>
<a class="sourceLine" id="cb196-3" data-line-number="3">  <span class="dt">hours =</span> air_time <span class="op">/</span><span class="st"> </span><span class="dv">60</span>,</a>
<a class="sourceLine" id="cb196-4" data-line-number="4">  <span class="dt">gain_per_hour =</span> gain <span class="op">/</span><span class="st"> </span>hours</a>
<a class="sourceLine" id="cb196-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##     gain hours gain_per_hour
##    &lt;dbl&gt; &lt;dbl&gt;         &lt;dbl&gt;
##  1    -9 3.78          -2.38
##  2   -16 3.78          -4.23
##  3   -31 2.67         -11.6 
##  4    17 3.05           5.57
##  5    19 1.93           9.83
##  6   -16 2.5           -6.4 
##  7   -24 2.63          -9.11
##  8    11 0.883         12.5 
##  9     5 2.33           2.14
## 10   -10 2.3           -4.35
## # … with 336,766 more rows</code></pre>
<div id="---" class="section level4">
<h4><span class="header-section-number">2.3.5.1</span> Полезные функции создания объектов</h4>
<ul>
<li><p>Арифметические операторы <code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>^</code></p></li>
<li><p>Модулярная арифметика. Целочисленное деление - <code>%/%</code>. Взятие остатка - <code>%%</code>. Показательный пример:</p></li>
</ul>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" data-line-number="1"><span class="kw">transmute</span>(flights,</a>
<a class="sourceLine" id="cb198-2" data-line-number="2">  dep_time,</a>
<a class="sourceLine" id="cb198-3" data-line-number="3">  <span class="dt">hour =</span> dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb198-4" data-line-number="4">  <span class="dt">minute =</span> dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb198-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    dep_time  hour minute
##       &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1      517     5     17
##  2      533     5     33
##  3      542     5     42
##  4      544     5     44
##  5      554     5     54
##  6      554     5     54
##  7      555     5     55
##  8      557     5     57
##  9      557     5     57
## 10      558     5     58
## # … with 336,766 more rows</code></pre>
<ul>
<li><p>Логарифмические функции <code>log()</code>, <code>log2</code>, <code>log10()</code></p></li>
<li><p>Смещения. Вперёд - <code>lag()</code>. Назад - <code>lead()</code></p></li>
<li><p>Кумулятивные и скользящие агрегаты. <code>cumsum()</code>, <code>cummin()</code>, <code>cumprod()</code>, <code>cummax()</code>, <code>cummean()</code></p></li>
<li><p>Логические операторы <code>&lt;</code>, <code>&gt;</code>, <code>&gt;=</code>, <code>&lt;=</code>, <code>!=</code></p></li>
<li><p>Ранжирование. Функции ранжирования <code>row_number(x)</code>, <code>ntile(x, n)</code>, <code>min_rank(x)</code>, <code>dense_rank(x)</code>,<code>percent_rank(x)</code>, <code>cume_dist(x)</code>. В этих функциях <code>desc()</code> меняет направление.</p></li>
</ul>
</div>
<div id="-5.5.2.1" class="section level4">
<h4><span class="header-section-number">2.3.5.2</span> Упражнение 5.5.2.1</h4>
<div class="question">
<p>Currently <code>dep_time</code> and <code>sched_dep_time</code> are convenient to look at, but hard to compute with because they’re not really continuous numbers. Convert them to a more convenient representation of number of minutes since midnight.</p>
</div>
<p>Заданные параметры <code>dep_time</code> and <code>sched_dep_time</code> записаны в формате HHMM. Чтобы получить из исходных данных последовательный формат, необходимо произвести целочисленное деление на 100, и к результату добавить остаток от деления.</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" data-line-number="1"><span class="kw">transmute</span>(flights,</a>
<a class="sourceLine" id="cb200-2" data-line-number="2">  dep_time,</a>
<a class="sourceLine" id="cb200-3" data-line-number="3">  sched_dep_time,</a>
<a class="sourceLine" id="cb200-4" data-line-number="4">  <span class="dt">dep_time_minute =</span> ((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb200-5" data-line-number="5">  <span class="dt">sched_dep_time_minute =</span> ((sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb200-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 4
##    dep_time sched_dep_time dep_time_minute sched_dep_time_minute
##       &lt;int&gt;          &lt;int&gt;           &lt;dbl&gt;                 &lt;dbl&gt;
##  1      517            515             317                   315
##  2      533            529             333                   329
##  3      542            540             342                   340
##  4      544            545             344                   345
##  5      554            600             354                   360
##  6      554            558             354                   358
##  7      555            600             355                   360
##  8      557            600             357                   360
##  9      557            600             357                   360
## 10      558            600             358                   360
## # … with 336,766 more rows</code></pre>
<p>Можно добавить эти значения в исходную выборку:</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" data-line-number="1"><span class="kw">mutate</span>(flights,</a>
<a class="sourceLine" id="cb202-2" data-line-number="2">  <span class="dt">dep_time_minute =</span> ((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb202-3" data-line-number="3">  <span class="dt">sched_dep_time_minute =</span> ((sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb202-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 21
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 14 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_time_minute &lt;dbl&gt;,
## #   sched_dep_time_minute &lt;dbl&gt;</code></pre>
</div>
<div id="-5.5.2.2" class="section level4">
<h4><span class="header-section-number">2.3.5.3</span> Упражнение 5.5.2.2</h4>
<div class="question">
<p>Compare <code>air_time</code> with <code>arr_time - dep_time</code>. What do you expect to see? What do you see? What do you need to do to fix it?</p>
</div>
<p>Значения данных <code>dep_time</code> и <code>arr_time</code> это время отправления и время прибытия соответственно записанные в формате HHMM. <code>air_time</code> - это время полёта, записанное в минутах. Естественно, если мы просто вычтем из времени прибытия время отправления в текущем формате, мы не получим <code>air_time</code>.</p>
<p>Таким образом, моё предположение сводится к следующему - чтобы разность <code>arr_time - dep_time</code> и <code>air_time</code> совпадали, необходимо:</p>
<ol style="list-style-type: decimal">
<li>для начала привести их к общей форме записи в минутах.</li>
</ol>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" data-line-number="1"><span class="kw">transmute</span>(flights,</a>
<a class="sourceLine" id="cb204-2" data-line-number="2">  air_time,</a>
<a class="sourceLine" id="cb204-3" data-line-number="3">  <span class="dt">arr_minus_dep =</span> (((arr_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>arr_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">-</span><span class="st"> </span>(((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb204-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 2
##    air_time arr_minus_dep
##       &lt;dbl&gt;         &lt;dbl&gt;
##  1      227           193
##  2      227           197
##  3      160           221
##  4      183           260
##  5      116           138
##  6      150           106
##  7      158           198
##  8       53            72
##  9      140           161
## 10      138           115
## # … with 336,766 more rows</code></pre>
<ol style="list-style-type: decimal">
<li><p>затем необходимо учесть прилёт на другой день</p></li>
<li><p>и ещё необходимо учитывать разное время часовых поясов отлёта и прибытия, так как время в данных указано локальное</p></li>
</ol>
<p>Так как два последних предположения текущим набором данных мне проверить не предвидится возможным, я заглядываю в подсказку</p>
<p>В имеющимся в сети <a href="https://jrnold.github.io/r4ds-exercise-solutions/data-transformation.html">решении</a> заданий от пользователя jrnold я нашёл что, в своём предположении я не учёл особенность сбора данных. Особенность заключается в том, что время отправления и время прибытия считаются от момента когда самолёт оторвал шасси и коснулся земли соответсвенно. В это время не входит время проведённое при посадке и прохождении регистрации, которое учитано в <code>air_time</code>.</p>
</div>
<div id="-5.5.2.3" class="section level4">
<h4><span class="header-section-number">2.3.5.4</span> Упражнение 5.5.2.3</h4>
<div class="question">
<p>Compare <code>dep_time</code>, <code>sched_dep_time</code>, and <code>dep_delay</code>. How would you expect those three numbers to be related?</p>
</div>
<p>Разберёмся в том, что каждый столбец данных представляет.</p>
<ul>
<li><p><code>sched_dep_time</code> - это запланированное время вылета в формате HHMM по местному времени</p></li>
<li><p><code>dep_time</code> - это актуальное время вылета в формате HHMM по местному времени</p></li>
<li><p><code>dep_delay</code> - это время задержки вылета в минутах. Отрицательное время будет показывать ранний вылет.</p></li>
</ul>
<p>То есть по сути <code>dep_delay</code> это разность между актуальным временем вылета и запланированным временем. Чтобы разность <code>dep_time - sched_dep_time</code> соотносилась с <code>dep_delay</code>, формат HHMM необходимо перевести в минуты.</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" data-line-number="1">flights_new_dep &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights,</a>
<a class="sourceLine" id="cb206-2" data-line-number="2">  <span class="dt">dep_delay_ng =</span> dep_time <span class="op">-</span><span class="st"> </span>sched_dep_time,</a>
<a class="sourceLine" id="cb206-3" data-line-number="3">  <span class="dt">dep_delay_ok =</span> (((dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb206-4" data-line-number="4"><span class="st">    </span>(((sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>))</a></code></pre></div>
<p>Однако подобный формат записи приводит к тому, что если вылет фактический и вылет планируемый находятся по разную сторону от полуночи, то разница будет большой либо в отрицательную, либо в положительную сторону. Что конечно же не соответствует фактическому времени задержки.
Тут вроде бы <code>dep_delay</code> и полученный в результате приведения к одному формату и разности планируемого и фактического времени <code>dep_delay_ok</code> сходятся. Однако уже даже при обратной сортировке видно, что есть большие различия, связанные, как я уже сказал, с особенностью внесения этих данных:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb207-1" data-line-number="1">new_delay &lt;-<span class="st"> </span><span class="kw">select</span>(flights_new_dep, dep_delay_ok, dep_delay, dep_delay_ng)</a>
<a class="sourceLine" id="cb207-2" data-line-number="2"><span class="kw">arrange</span>(new_delay, <span class="kw">desc</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 3
##    dep_delay_ok dep_delay dep_delay_ng
##           &lt;dbl&gt;     &lt;dbl&gt;        &lt;int&gt;
##  1         -139      1301         -259
##  2         -303      1137         -503
##  3         -314      1126         -514
##  4         -426      1014         -706
##  5         -435      1005         -755
##  6         -480       960         -800
##  7          911       911         1511
##  8         -541       899         -941
##  9          898       898         1498
## 10         -544       896         -944
## # … with 336,766 more rows</code></pre>
</div>
<div id="-5.5.2.4" class="section level4">
<h4><span class="header-section-number">2.3.5.5</span> Упражнение 5.5.2.4</h4>
<div class="question">
<p>Find the 10 most delayed flights using a ranking function. How do you want to handle ties? Carefully read the documentation for <code>min_rank()</code>.</p>
</div>
<p>Задрежка вылета <code>dep_delay</code>. Найти 10 авиарейсов, можно функцией <code>arrange()</code></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb209-1" data-line-number="1">(<span class="kw">arrange</span>(flights, <span class="kw">desc</span>(dep_delay)))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     6    15     1432           1935      1137     1607
##  3  2013     1    10     1121           1635      1126     1239
##  4  2013     9    20     1139           1845      1014     1457
##  5  2013     7    22      845           1600      1005     1044
##  6  2013     4    10     1100           1900       960     1342
##  7  2013     3    17     2321            810       911      135
##  8  2013     6    27      959           1900       899     1236
##  9  2013     7    22     2257            759       898      121
## 10  2013    12     5      756           1700       896     1058
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Но так мы возьмём все связанные данные.
Чтобы ограничить выдачу, можно использовать функцию <code>min_rank()</code>.
Я воспользуюсь этой функцией чтобы взять первые 10 авиарейсов по рангу.
Сначала посмотрим что делает <code>min_rank()</code>:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb211-1" data-line-number="1">(<span class="kw">transmute</span>(flights, <span class="dt">dep_delay_rank =</span> <span class="kw">min_rank</span>(<span class="op">-</span>dep_delay)))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 1
##    dep_delay_rank
##             &lt;int&gt;
##  1         114150
##  2         103893
##  3         114150
##  4         144947
##  5         258934
##  6         209494
##  7         234113
##  8         185276
##  9         185276
## 10         163760
## # … with 336,766 more rows</code></pre>
<p>Теперь добавим к имеющемуся набору данных новых столбуц с обратным ранжированным столбцом <code>dep_delay()</code></p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb213-1" data-line-number="1">(flights_delayed &lt;-<span class="st"> </span><span class="kw">mutate</span>(flights, <span class="dt">dep_delay_rank =</span> <span class="kw">min_rank</span>(<span class="op">-</span>dep_delay)))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_delay_rank &lt;int&gt;</code></pre>
<p>Затем возьмём первые 10 значений:</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb215-1" data-line-number="1">(<span class="kw">filter</span>(flights_delayed, dep_delay_rank <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>))</a></code></pre></div>
<pre><code>## # A tibble: 10 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     9      641            900      1301     1242
##  2  2013     1    10     1121           1635      1126     1239
##  3  2013    12     5      756           1700       896     1058
##  4  2013     3    17     2321            810       911      135
##  5  2013     4    10     1100           1900       960     1342
##  6  2013     6    15     1432           1935      1137     1607
##  7  2013     6    27      959           1900       899     1236
##  8  2013     7    22      845           1600      1005     1044
##  9  2013     7    22     2257            759       898      121
## 10  2013     9    20     1139           1845      1014     1457
## # … with 13 more variables: sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;,
## #   carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;,
## #   air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;,
## #   time_hour &lt;dttm&gt;, dep_delay_rank &lt;int&gt;</code></pre>
</div>
<div id="-5.5.2.5" class="section level4">
<h4><span class="header-section-number">2.3.5.6</span> Упражнение 5.5.2.5</h4>
<div class="question">
<p>What does <code>1:3 + 1:10</code> return? Why?</p>
</div>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb217-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="dv">3</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a></code></pre></div>
<pre><code>## Warning in 1:3 + 1:10: длина большего объекта не является произведением
## длины меньшего объекта</code></pre>
<pre><code>##  [1]  2  4  6  5  7  9  8 10 12 11</code></pre>
<p>Это возвращает такой странный результат, потому что при складывании двух векторов разной длинны, происходит “дополнение” длинного вектора, повторением сначала значениями короткого. Проще говоря: <code>c(1 + 1, 2 + 2, 3 + 3, 1 + 4, 2 + 5, 3 + 6, 1 + 7, 2 + 8, 3 + 9, 1 + 10)</code></p>
</div>
<div id="-5.5.2.6" class="section level4">
<h4><span class="header-section-number">2.3.5.7</span> Упражнение 5.5.2.6</h4>
<div class="question">
<p>What trigonometric functions does R provide?</p>
</div>
<p>В R есть следующие тригонометрические функции.</p>
<ul>
<li><p>Простые: <code>cos(x)</code>, <code>sin(x)</code>, <code>tan(x)</code></p></li>
<li><p>Арки <code>acos(x)</code>, <code>asin(x)</code>, <code>atan(x)</code>, <code>atan2(y, x)</code></p></li>
<li><p>И ещё <code>cospi(x)</code>, <code>sinpi(x)</code>, <code>tanpi(x)</code></p></li>
</ul>
</div>
</div>
<div id="------summarize" class="section level3">
<h3><span class="header-section-number">2.3.6</span> Получение групповых итогов с помощью функции <code>summarize()</code></h3>
<div id="-----" class="section level4">
<h4><span class="header-section-number">2.3.6.1</span> Объединение нескольких операций с помощью канала</h4>
<p>Мы хотим исследовать связь между расстоянием <code>distance</code> и средним временем задержки рейса <code>arr_delay</code> для всех пунктов приема и вылета.</p>
<p>Для этого необходимо.</p>
<ol style="list-style-type: decimal">
<li>Группирование рейсов по пунктам назначения</li>
</ol>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb220-1" data-line-number="1">by_dest &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, dest)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Получение сводных данных (суммарных), касающихся расстояний <code>distance</code>, среднего времени задержки <code>mean(arr_delay)</code> и количества авиарейсов <code>count()</code>.</li>
</ol>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" data-line-number="1">delay &lt;-<span class="st"> </span><span class="kw">summarise</span>(by_dest,</a>
<a class="sourceLine" id="cb221-2" data-line-number="2">  <span class="dt">count =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb221-3" data-line-number="3">  <span class="dt">dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb221-4" data-line-number="4">  <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb221-5" data-line-number="5">)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Фильтрация данных с целью исключения точек данных, создающих информационный шум, и аэропорта Гонолулу <code>NHL</code>, который распологется на расстоянии, почти вдвое превышающем расстояние до следующего ближайшего аэропорта.</li>
</ol>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" data-line-number="1">delay &lt;-<span class="st"> </span><span class="kw">filter</span>(delay, count <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, dest <span class="op">!=</span><span class="st"> &quot;NHL&quot;</span>)</a>
<a class="sourceLine" id="cb222-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="dt">data =</span> delay, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> dist, <span class="dt">y =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">size =</span> count), <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb222-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-142-1.png" width="672" /></p>
<p>Это решение, но такой код трудно писать, поскольку нужно присваивать каждому промежуточному фрейму данных отдельное имя.
Есть такая штука как канал <code>%&gt;%</code>. Канал фактически позволяет говорить “затем”.</p>
<p>Сначала сгруппируй %&gt;% (затем) просуммируй по количеству значений и посчитай среднее в группах по <code>distance</code> и <code>arr_delay</code> %&gt;% (затем) отфильтруй. Получаются все те же самые блоки, только без промежуточных присваиваний имён.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" data-line-number="1">delays &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb224-4" data-line-number="4">    <span class="dt">count =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb224-5" data-line-number="5">    <span class="dt">dist =</span> <span class="kw">mean</span>(distance, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb224-6" data-line-number="6">    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb224-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb224-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(count <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, dest <span class="op">!=</span><span class="st"> &quot;NHL&quot;</span>)</a></code></pre></div>
</div>
<div id="--1" class="section level4">
<h4><span class="header-section-number">2.3.6.2</span> Отсутствующие значения</h4>
<p>Я предполагал, что параметр <code>na.rm</code> отвечает за нормальное распределение. Но это было неверное предположение. Разберём пример.</p>
<p>Если суммировать число с пропущенным значением (неизвестным), результат будет тоже неизвестным:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb225-1" data-line-number="1"><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="ot">NA</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Параметр <code>na.rm</code> отвечает за пропущенные значения. Точнее за игнорирование пропущенных значений.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb227-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb227-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1    NA
##  2  2013     1     2    NA
##  3  2013     1     3    NA
##  4  2013     1     4    NA
##  5  2013     1     5    NA
##  6  2013     1     6    NA
##  7  2013     1     7    NA
##  8  2013     1     8    NA
##  9  2013     1     9    NA
## 10  2013     1    10    NA
## # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb229-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb229-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb229-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.5 
##  2  2013     1     2 13.9 
##  3  2013     1     3 11.0 
##  4  2013     1     4  8.95
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.55
##  9  2013     1     9  2.28
## 10  2013     1    10  2.84
## # … with 355 more rows</code></pre>
<p>В последующем будет использоваться этот срез данных, так что здесь же объявим его:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb231-1" data-line-number="1">not_canceled &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(arr_delay))</a>
<a class="sourceLine" id="cb231-3" data-line-number="3">not_canceled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb231-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day  mean
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
##  1  2013     1     1 11.4 
##  2  2013     1     2 13.7 
##  3  2013     1     3 10.9 
##  4  2013     1     4  8.97
##  5  2013     1     5  5.73
##  6  2013     1     6  7.15
##  7  2013     1     7  5.42
##  8  2013     1     8  2.56
##  9  2013     1     9  2.30
## 10  2013     1    10  2.84
## # … with 355 more rows</code></pre>
</div>
<div class="section level4">
<h4><span class="header-section-number">2.3.6.3</span> Счетчики</h4>
<p>Счётчик наблюдений это <code>n()</code>. Счетчик отсутствующих значений это <code>sum(!is.na(x))</code>.
Проведём лабораторную работу.</p>
<p>Предположим что нас интересуют самолёты с наибольшим средним временем задержки.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb233-1" data-line-number="1">delays &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb233-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb233-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay))</a>
<a class="sourceLine" id="cb233-4" data-line-number="4"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-148-1.png" width="672" /></p>
<p>Такой график показывает распределение, почти как гистограммы, только вместо столбцов тут линии. Как и в гистограммах, такие графики показывают количество наблюдений, попавших в заданный диапазон. Постройнный график имеет диапазон 10. Поиграемся немного:</p>
<p>Установив значение диапазона 1 - получаем “зашумлённый” график</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" data-line-number="1"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
<p>Устанавливая значение диапазона = 100, получаем график в котором потеряно много ценной информации, график получился переглаженным</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb235-1" data-line-number="1"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">100</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-150-1.png" width="672" /></p>
<p>Соответственно 1000 не даёт понять даже общую тенденцию, потому что крайние точки выборки, находятся далеко от 1000.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" data-line-number="1"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> delay)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">1000</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>Но вернёмся к нашему распределению с диапазоном в 10 точек. Можно посмотреть под другим углом на эти данные если построить диаграмму рассеяния:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb237-1" data-line-number="1">delays &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                  </span><span class="co"># Присвой значению `delays` данные `not_canceled` ЗАТЕМ</span></a>
<a class="sourceLine" id="cb237-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Сгруппируй эти данные по номерам самолётов ЗАТЕМ</span></a>
<a class="sourceLine" id="cb237-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb237-4" data-line-number="4">    <span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),  <span class="co"># Посчитаем среднее значение по параметру `arr_delay`, не учитывая пропуски</span></a>
<a class="sourceLine" id="cb237-5" data-line-number="5">    <span class="dt">n =</span> <span class="kw">n</span>()                                 <span class="co"># Со счётчиком количества наблюдений</span></a>
<a class="sourceLine" id="cb237-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb237-7" data-line-number="7"><span class="kw">ggplot</span>(delays, <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> delay)) <span class="op">+</span><span class="st">     </span><span class="co"># Построим точечную диаграмму рассеяния количества наблюдений от времени задержки</span></a>
<a class="sourceLine" id="cb237-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)                  <span class="co"># Точки сделаем прозрачными</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>
<p>На этой диаграмме видно, что хвост у основного распределения длинный. Тоесть от основного количества точек в “районе” нуля есть единичные выбросы вплоть до 300 по оси ординат <code>delay</code>. Часто от такого хвоста, то есть выбросов, необходимо будет избавляться.
Как советуют в книге, помогает в этом использование пакета <code>ggplot</code> в потоке <code>dplyr</code>.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" data-line-number="1">delays <span class="op">%&gt;%</span><span class="st">                                   </span><span class="co"># Возьми данные `delays` ЗАТЕМ</span></a>
<a class="sourceLine" id="cb238-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">25</span>) <span class="op">%&gt;%</span><span class="st">                         </span><span class="co"># отфильтруй группы, в которых количество наблюдений меньше `25` ЗАТЕМ</span></a>
<a class="sourceLine" id="cb238-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> delay)) <span class="op">+</span><span class="st">  </span><span class="co"># Построй точечную диаграмму `n` от `delay`. Точки сделай прозрачными на 1/10.</span></a>
<a class="sourceLine" id="cb238-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">10</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-153-1.png" width="672" /></p>
<p>Рассмотрим связь между средней результативностью отбивающих в бейсболе и количеством их вызовов на удар.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb239-1" data-line-number="1">batting &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(Lahman<span class="op">::</span>Batting)      <span class="co"># Из большого набора данных `Lahman` возьми фрейм данных `Batting`.</span></a>
<a class="sourceLine" id="cb239-2" data-line-number="2"></a>
<a class="sourceLine" id="cb239-3" data-line-number="3">batters &lt;-<span class="st"> </span>batting <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Присвой переменной `batters` значение `batting` ЗАТЕМ</span></a>
<a class="sourceLine" id="cb239-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(playerID) <span class="op">%&gt;%</span><span class="st">                   </span><span class="co"># группируй данные по ID игрока ЗАТЕМ</span></a>
<a class="sourceLine" id="cb239-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(                               <span class="co"># посчитай средний коэффициент результативности</span></a>
<a class="sourceLine" id="cb239-6" data-line-number="6">    <span class="dt">ba =</span> <span class="kw">sum</span>(H, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span> (AB, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),     </a>
<a class="sourceLine" id="cb239-7" data-line-number="7">    <span class="dt">ab =</span> <span class="kw">sum</span>(AB, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)             <span class="co"># Определи суммарное количество возможностей выполнить удар `ab`. </span></a>
<a class="sourceLine" id="cb239-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb239-9" data-line-number="9"></a>
<a class="sourceLine" id="cb239-10" data-line-number="10">batters <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Возьми данные `batters` ЗАТЕМ</span></a>
<a class="sourceLine" id="cb239-11" data-line-number="11"><span class="st">  </span><span class="kw">filter</span>(ab <span class="op">&gt;</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Возьми данные с количеством возможностей на удар больше 100 ЗАТЕМ</span></a>
<a class="sourceLine" id="cb239-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> ab, <span class="dt">y =</span> ba)) <span class="op">+</span><span class="st">  </span><span class="co"># Построй диаграмму рассеяния возможностей удара от от коэффициента результативности</span></a>
<a class="sourceLine" id="cb239-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb239-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)                  <span class="co"># А так же сглаженную прямую без построения доверительного интервала</span></a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-154-1.png" width="672" /></p>
<p>Средний коэффициент результативности - суммарное количество ударов, делённое на суммарное количество возможностей сделать удар?.</p>
<p>Этот график показывает положительную зависимость коэффициент результативности от количества ударов.</p>
<p>Тут есть одна закономерная интересность - чем меньше количество наблюдений, тем существеннее влияет единичное наблюдение на среднее значение. Следствием этого утверждения является тот факт, что самые высокие коэффициенты у тех кому просто повезло разочек ударить по мячу и больше не вызываться к отбиванию:</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb241-1" data-line-number="1">batters <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb241-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(ba))</a></code></pre></div>
<pre><code>## # A tibble: 18,915 x 3
##    playerID     ba    ab
##    &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 abramge01     1     1
##  2 banisje01     1     1
##  3 bartocl01     1     1
##  4 bassdo01      1     1
##  5 berrijo01     1     1
##  6 birasst01     1     2
##  7 bruneju01     1     1
##  8 burnscb01     1     1
##  9 cammaer01     1     1
## 10 campsh01      1     1
## # … with 18,905 more rows</code></pre>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">2.3.6.4</span> Полезные итоговые функции</h4>
<ul>
<li><p>Меры положения - <code>mean(x)</code>, <code>median(x)</code></p></li>
<li><p>Меры изменчивости - среднеквадратичное отклонение <code>sd()</code>, межквартильный размах - <code>IQR()</code>, медианное абсолютное отклонение - <code>mad()</code></p></li>
<li><p>Меры ранжирования - максимум <code>max(x)</code>, минимум<code>min(x)</code>, квантиль 25% <code>quantile(x, 0,25)</code>, квантиль 75% <code>quantile(x, 0,75)</code></p></li>
<li><p>Порядковые меры - первый <code>first(x)</code>, последний <code>last(x)</code>, точная позиция <code>nth(x, 2)</code></p></li>
<li><p>Счетчики - размер текущей группы <code>n()</code>, количество значений не являющихся отсутствующими <code>sum(!is.na(x))</code>, количество уникальных значений<code>n_distinct(x)</code></p></li>
<li><p>Подсчет количества и долей логических значений <code>sum(x &gt; 10)</code>, <code>mean(y == 0)</code></p></li>
</ul>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">2.3.6.5</span> Группирование по нескольким переменным</h4>
<p>Когда мы группируем данные по нескольким переменным, каждый сформированный итог уменьшает колтчество уровней группировки на единицу. Это упрощает последовательное свёртывание.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb243-1" data-line-number="1">daily &lt;-<span class="st"> </span><span class="kw">group_by</span>(flights, year, month, day)</a>
<a class="sourceLine" id="cb243-2" data-line-number="2">(per_day &lt;-<span class="st"> </span><span class="kw">summarize</span>(daily, <span class="dt">flights =</span> <span class="kw">n</span>()))</a></code></pre></div>
<pre><code>## # A tibble: 365 x 4
## # Groups:   year, month [12]
##     year month   day flights
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1     1     842
##  2  2013     1     2     943
##  3  2013     1     3     914
##  4  2013     1     4     915
##  5  2013     1     5     720
##  6  2013     1     6     832
##  7  2013     1     7     933
##  8  2013     1     8     899
##  9  2013     1     9     902
## 10  2013     1    10     932
## # … with 355 more rows</code></pre>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb245-1" data-line-number="1">(per_month &lt;-<span class="st"> </span><span class="kw">summarize</span>(per_day, <span class="dt">flights =</span> <span class="kw">sum</span>(flights)))</a></code></pre></div>
<pre><code>## # A tibble: 12 x 3
## # Groups:   year [1]
##     year month flights
##    &lt;int&gt; &lt;int&gt;   &lt;int&gt;
##  1  2013     1   27004
##  2  2013     2   24951
##  3  2013     3   28834
##  4  2013     4   28330
##  5  2013     5   28796
##  6  2013     6   28243
##  7  2013     7   29425
##  8  2013     8   29327
##  9  2013     9   27574
## 10  2013    10   28889
## 11  2013    11   27268
## 12  2013    12   28135</code></pre>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb247-1" data-line-number="1">(per_year &lt;-<span class="st"> </span><span class="kw">summarise</span>(per_month, <span class="dt">flights =</span> <span class="kw">sum</span>(flights)))</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    year flights
##   &lt;int&gt;   &lt;int&gt;
## 1  2013  336776</code></pre>
<p>Буду аккуратен когда буду свёртывать например медианы. Сумма групповых сумм равна общей сумме, но медиана групповых медиан не равна общей медиане.</p>
</div>
<div class="section level4">
<h4><span class="header-section-number">2.3.6.6</span> Разгруппирование</h4>
<p>Тут всё просто - нужно что-то разгруппировать, пользуемся функцией <code>ungroup()</code></p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb249-1" data-line-number="1">daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb249-2" data-line-number="2"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">            </span><span class="co"># больше не группировать по дате</span></a>
<a class="sourceLine" id="cb249-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">flights =</span> <span class="kw">n</span>()) <span class="co"># все рейсы</span></a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   flights
##     &lt;int&gt;
## 1  336776</code></pre>
</div>
<div id="-5.6.7.1" class="section level4">
<h4><span class="header-section-number">2.3.6.7</span> Упражнение 5.6.7.1</h4>
<div class="question">
<p>Brainstorm at least 5 different ways to assess the typical delay characteristics of a group of flights. Consider the following scenarios:</p>
<ul>
<li><p>A flight is 15 minutes early 50% of the time, and 15 minutes late 50% of the time.</p></li>
<li><p>A flight is always 10 minutes late.</p></li>
<li><p>A flight is 30 minutes early 50% of the time, and 30 minutes late 50% of the time.</p></li>
<li><p>99% of the time a flight is on time. 1% of the time it’s 2 hours late.</p></li>
</ul>
<p>Which is more important: arrival delay or departure delay?</p>
</div>
<p>Разобьём ответ на части.</p>
<ul>
<li>Часть 1. Вначале напридумываем как минимум пять типичных характеристик времени задержки для групп авиарейсов:</li>
</ul>
<ol style="list-style-type: decimal">
<li><p>Мера положения - <em>среднее время</em> задержки вылета самолёта</p></li>
<li><p>Мера положения - <em>среднее время</em> задержки прилёта самолёта</p></li>
<li><p>Мера изменчивости - <em>среднеквадратичное отклонение</em> времени задержки вылета самолёта</p></li>
<li><p>Мера изменчивости - <em>среднеквадратичное отклонение</em> времени задержки прилёта самолёта</p></li>
<li><p>Мера ранжирования - <em>максимальное</em> время задержки вылет самолёта</p></li>
<li><p>Мера ранжирования - <em>максимальное</em> время задержки прилёта самолёта</p></li>
</ol>
<p>Далее будем придумывать способы доступа к придуманным характеристикам. Группировать будем по дню вылета. В зависимости от задачи, группировать можно по разным параметрам - аэропорт прилёта, аэропорт вылета, время в пути, по любому доступному временному срезу, по номеру авиарейса.</p>
<p><em>Cреднее время</em> задержки вылета самолёта</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb251-1" data-line-number="1">dep_delay_mean &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Присвой в dep_delay_mean значения из набора данных flights ЗАТЕМ</span></a>
<a class="sourceLine" id="cb251-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">                             </span><span class="co"># Сгруппируй по дням прилёта</span></a>
<a class="sourceLine" id="cb251-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        <span class="co"># В dep_mean посчитай среднее время задержки вылета</span></a>
<a class="sourceLine" id="cb251-4" data-line-number="4"><span class="kw">ggplot</span>(dep_delay_mean) <span class="op">+</span><span class="st">                                     </span></a>
<a class="sourceLine" id="cb251-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, dep_mean), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span><span class="co"># Построй прямые по дням без стандартного отклонения</span></a>
<a class="sourceLine" id="cb251-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                            <span class="co"># Сгруппируй построения по месяцам в три строки</span></a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<p><em>Cреднее время</em> задержки прилёта самолёта</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" data-line-number="1">arr_delay_mean &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb253-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">                           </span></a>
<a class="sourceLine" id="cb253-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_mean =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        </a>
<a class="sourceLine" id="cb253-4" data-line-number="4"><span class="kw">ggplot</span>(arr_delay_mean) <span class="op">+</span><span class="st">                                     </span></a>
<a class="sourceLine" id="cb253-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, arr_mean), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb253-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                            </a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-159-1.png" width="672" /></p>
<p><em>Cреднеквадратичное отклонение</em> времени задержки вылета самолёта</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" data-line-number="1">arr_delay_sd &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">                               </span></a>
<a class="sourceLine" id="cb255-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">       </span></a>
<a class="sourceLine" id="cb255-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_sd =</span> <span class="kw">sd</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))      </a>
<a class="sourceLine" id="cb255-4" data-line-number="4"><span class="kw">ggplot</span>(arr_delay_sd) <span class="op">+</span><span class="st">                                     </span></a>
<a class="sourceLine" id="cb255-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, arr_sd), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb255-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                   </a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
<p><em>Cреднеквадратичное отклонение</em> времени задержки прилёта самолёта</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" data-line-number="1">dep_delay_sd &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">     </span></a>
<a class="sourceLine" id="cb257-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">                    </span></a>
<a class="sourceLine" id="cb257-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_sd =</span> <span class="kw">sd</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))     </a>
<a class="sourceLine" id="cb257-4" data-line-number="4"><span class="kw">ggplot</span>(dep_delay_sd) <span class="op">+</span><span class="st">                                     </span></a>
<a class="sourceLine" id="cb257-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, dep_sd), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span></a>
<a class="sourceLine" id="cb257-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)                         </a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
<p><em>Максимальное</em> время задержки вылета самолёта</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" data-line-number="1">dep_delay_max &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">               </span></a>
<a class="sourceLine" id="cb259-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">         </span></a>
<a class="sourceLine" id="cb259-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_max =</span> <span class="kw">max</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        </a>
<a class="sourceLine" id="cb259-4" data-line-number="4"><span class="kw">ggplot</span>(dep_delay_max) <span class="op">+</span><span class="st">                                     </span></a>
<a class="sourceLine" id="cb259-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, dep_max), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb259-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
<p><em>Максимальное</em> время задержки прилета самолёта</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb261-1" data-line-number="1">arr_delay_max &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">               </span></a>
<a class="sourceLine" id="cb261-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">         </span></a>
<a class="sourceLine" id="cb261-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">arr_max =</span> <span class="kw">max</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))        </a>
<a class="sourceLine" id="cb261-4" data-line-number="4"><span class="kw">ggplot</span>(arr_delay_max) <span class="op">+</span><span class="st">                                     </span></a>
<a class="sourceLine" id="cb261-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_smooth</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(day, arr_max), <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb261-6" data-line-number="6"><span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>month, <span class="dt">nrow =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-163-1.png" width="672" /></p>
<ul>
<li><p>Часть 2 Рассмотрим предложенные сценарии</p></li>
<li><p>Я буду группировать по номеру авиарейса, перевозчику, пункту вылета и пункту назначения. Делаю так, посколько номер авиарейса в данном наборе данных не является уникальным. Под одним номером, в зависимости от перевозчика могут авиарейсы с разными пунктами вылета и назначения
Итак, авиарейсы, опережающие график на 15 минут в 50% случаев. Таких рейсов немного:</p></li>
</ul>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb263-1" data-line-number="1">fast &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                          </span><span class="co"># присвой в fast фрейм данных not_canceled (это flights без пропусков)</span></a>
<a class="sourceLine" id="cb263-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span><span class="st">     </span><span class="co"># сгруппируй по номеру полёта, аэропорту вылета и аэропорту прилёта</span></a>
<a class="sourceLine" id="cb263-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fast_15min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">-15</span>))  <span class="co"># посчитай долю рейсов, которые опережали график на 15 минут</span></a>
<a class="sourceLine" id="cb263-4" data-line-number="4"><span class="kw">filter</span>(fast, fast_15min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)                   <span class="co"># отфильтруй рейсы, у которых задержка 15 минут составляет 50% от всех случаев</span></a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
## # Groups:   flight, carrier, origin [3]
##   flight carrier origin dest  fast_15min
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
## 1    998 UA      EWR    MSY          0.5
## 2   1780 US      LGA    CLT          0.5
## 3   3425 9E      LGA    GSP          0.5</code></pre>
<ul>
<li>Поиск авиарейсов, опаздывающих на 15 минут в 50% случаев, отличается только знаком в задержке вылета</li>
</ul>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb265-1" data-line-number="1">slow &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb265-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">slow_15min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">15</span>))</a>
<a class="sourceLine" id="cb265-4" data-line-number="4"><span class="kw">filter</span>(slow, slow_15min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 5
## # Groups:   flight, carrier, origin [20]
##    flight carrier origin dest  slow_15min
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
##  1    246 UA      EWR    RSW          0.5
##  2    339 UA      EWR    DEN          0.5
##  3    342 UA      EWR    MIA          0.5
##  4    448 UA      EWR    LAX          0.5
##  5    562 UA      LGA    DEN          0.5
##  6    794 WN      EWR    STL          0.5
##  7   1059 UA      LGA    DEN          0.5
##  8   1061 UA      EWR    ORD          0.5
##  9   1483 UA      EWR    CLE          0.5
## 10   1575 UA      EWR    PBI          0.5
## 11   1598 UA      EWR    CLE          0.5
## 12   1622 UA      EWR    LAX          0.5
## 13   1675 UA      EWR    IAH          0.5
## 14   1718 UA      EWR    SFO          0.5
## 15   1939 DL      LGA    DEN          0.5
## 16   2048 US      JFK    CLT          0.5
## 17   2315 DL      JFK    MIA          0.5
## 18   4346 EV      EWR    CLE          0.5
## 19   4659 EV      EWR    CLT          0.5
## 20   5560 EV      LGA    BGR          0.5</code></pre>
<ul>
<li>Авиарейсы, которые постоянно опаздывают на 10 минут</li>
</ul>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb267-1" data-line-number="1">instant_slow &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># Постоянно опаздывающие, означает, что доля вылетов с опозданием</span></a>
<a class="sourceLine" id="cb267-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># в 10 минут, дл таких рейсов равна 100%</span></a>
<a class="sourceLine" id="cb267-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">inst_slow_10min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">10</span>))</a>
<a class="sourceLine" id="cb267-4" data-line-number="4"><span class="kw">filter</span>(instant_slow, inst_slow_10min <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) </a></code></pre></div>
<pre><code>## # A tibble: 27 x 5
## # Groups:   flight, carrier, origin [27]
##    flight carrier origin dest  inst_slow_10min
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;           &lt;dbl&gt;
##  1     52 WN      LGA    BNA                 1
##  2    107 WN      LGA    MKE                 1
##  3    239 UA      EWR    DEN                 1
##  4    255 US      JFK    PHL                 1
##  5    402 UA      EWR    PDX                 1
##  6    468 UA      EWR    SFO                 1
##  7    544 WN      LGA    BNA                 1
##  8    676 UA      EWR    DEN                 1
##  9   1014 UA      LGA    DEN                 1
## 10   1037 UA      EWR    MCO                 1
## # … with 17 more rows</code></pre>
<ul>
<li>Авиарейсы, опережающие график на 30 минут в 50% случаев (таких нету)</li>
</ul>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb269-1" data-line-number="1">fast_<span class="dv">30</span> &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb269-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb269-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fast_30min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">-30</span>))</a>
<a class="sourceLine" id="cb269-4" data-line-number="4"><span class="kw">filter</span>(fast_<span class="dv">30</span>, fast_30min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 5
## # Groups:   flight, carrier, origin [0]
## # … with 5 variables: flight &lt;int&gt;, carrier &lt;chr&gt;, origin &lt;chr&gt;,
## #   dest &lt;chr&gt;, fast_30min &lt;dbl&gt;</code></pre>
<ul>
<li>Авиарейсы, опаздывающие на 30 минут в 50% случаев</li>
</ul>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb271-1" data-line-number="1">slow_<span class="dv">30</span> &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb271-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb271-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">slow_30min =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">30</span>))</a>
<a class="sourceLine" id="cb271-4" data-line-number="4"><span class="kw">filter</span>(slow_<span class="dv">30</span>, slow_30min <span class="op">==</span><span class="st"> </span><span class="fl">0.5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 7 x 5
## # Groups:   flight, carrier, origin [7]
##   flight carrier origin dest  slow_30min
##    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;
## 1    746 UA      EWR    ORD          0.5
## 2   1248 UA      EWR    SAT          0.5
## 3   1250 UA      EWR    ORD          0.5
## 4   1288 UA      EWR    SEA          0.5
## 5   1554 UA      EWR    DEN          0.5
## 6   4287 EV      EWR    MSP          0.5
## 7   4301 EV      EWR    RDU          0.5</code></pre>
<ul>
<li>Авиарейсы, которые в 99% случаев укладывались в график и в 1% случаев опаздывали на 2 часа</li>
</ul>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb273-1" data-line-number="1">interest_flight &lt;-<span class="st"> </span>not_canceled <span class="op">%&gt;%</span><span class="st">                  </span><span class="co"># Так как условия два, поэтому и параметра будем вводить два</span></a>
<a class="sourceLine" id="cb273-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(flight, carrier, origin, dest) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># то и критерия будет два</span></a>
<a class="sourceLine" id="cb273-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">interest1 =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">120</span>),      <span class="co"># Первый для условия в 1% с опозданием на два часа</span></a>
<a class="sourceLine" id="cb273-4" data-line-number="4">            <span class="dt">interest2 =</span> <span class="kw">mean</span>(dep_delay <span class="op">==</span><span class="st"> </span><span class="dv">0</span>))        <span class="co"># Второй для условия в 99% со своевременным вылетом</span></a>
<a class="sourceLine" id="cb273-5" data-line-number="5"><span class="kw">filter</span>(interest_flight, interest1 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="dv">01</span>, interest2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>,<span class="dv">99</span>) </a></code></pre></div>
<pre><code>## # A tibble: 7,895 x 6
## # Groups:   flight, carrier, origin [4,546]
##    flight carrier origin dest  interest1 interest2
##     &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt;
##  1      1 UA      EWR    ORD           0         0
##  2      1 WN      LGA    MDW           0         0
##  3      2 WN      EWR    MDW           0         0
##  4      3 B6      JFK    FLL           0         0
##  5      3 UA      EWR    BOS           0         0
##  6      3 UA      EWR    DEN           0         0
##  7      3 UA      EWR    TPA           0         0
##  8      7 WN      LGA    DEN           0         0
##  9     10 UA      EWR    ORD           0         0
## 10     12 UA      EWR    LAX           0         0
## # … with 7,885 more rows</code></pre>
<ul>
<li>Часть 3 Отвечаю на вопрос о более важном факторе</li>
</ul>
<p>Для ответа на тот вопрос необходимо определить критерии оценки.</p>
<p>С одной стороны, если говорить о своевременности предоставляемых данных, то задержка прилёта несёт больший урон. Поскольку находясь в воздухе, пассажир не сможет предупредить кого-то о своей задержке (в случае деловой встречи, например) и от пассажира в воздухе ничего не зависит. Получив информацию о том, что рейс задерживает вылет ещё на земле, пассажир может скоординировать свои планы, поменять в конце концов способ перемещения.</p>
</div>
<div id="-5.6.7.2" class="section level4">
<h4><span class="header-section-number">2.3.6.8</span> Упражнение 5.6.7.2</h4>
<div class="question">
<p>Come up with another approach that will give you the same output as <code>not_canceled %&gt;% count(dest)</code> and <code>not_canceled %&gt;% count(tailnum, wt = distance)</code> (without using <code>count()</code>).</p>
</div>
<p>Для вывода количества значений используется счётчки <code>count()</code> входящий в пакет <code>dplyr</code>. Можно обойти и просуммировать другими доступными средствами, например используя функцию <code>sum(!is.na(x)</code>, которая считает количество различных уникальных значений.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb275-1" data-line-number="1">not_canceled <span class="op">%&gt;%</span><span class="st">                          </span><span class="co"># в наборе данных</span></a>
<a class="sourceLine" id="cb275-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st">                      </span><span class="co"># сгруппируй по направлению вылета</span></a>
<a class="sourceLine" id="cb275-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dest =</span> <span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.na</span>(dest))) <span class="co"># создай переменную в которую просуммируй уникальные значения по направлениям</span></a></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  sum_dest
##    &lt;chr&gt;    &lt;int&gt;
##  1 ABQ        254
##  2 ACK        264
##  3 ALB        418
##  4 ANC          8
##  5 ATL      16837
##  6 AUS       2411
##  7 AVL        261
##  8 BDL        412
##  9 BGR        358
## 10 BHM        269
## # … with 94 more rows</code></pre>
<p>или можно посчитать через счётчик <code>n()</code>, что видится более изящным решением, и делает код более читаемым.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb277-1" data-line-number="1">not_canceled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb277-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dest =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 104 x 2
##    dest  sum_dest
##    &lt;chr&gt;    &lt;int&gt;
##  1 ABQ        254
##  2 ACK        264
##  3 ALB        418
##  4 ANC          8
##  5 ATL      16837
##  6 AUS       2411
##  7 AVL        261
##  8 BDL        412
##  9 BGR        358
## 10 BHM        269
## # … with 94 more rows</code></pre>
<p>Чтобы посчитать сумму по всем перемещениям из второго условия, достаточно сделать следующее:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb279-1" data-line-number="1">not_canceled <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb279-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">sum_dist =</span> <span class="kw">sum</span>(distance))</a></code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
##    tailnum sum_dist
##    &lt;chr&gt;      &lt;dbl&gt;
##  1 D942DN      3418
##  2 N0EGMQ    239143
##  3 N10156    109664
##  4 N102UW     25722
##  5 N103US     24619
##  6 N104UW     24616
##  7 N10575    139903
##  8 N105UW     23618
##  9 N107US     21677
## 10 N108UW     32070
## # … with 4,027 more rows</code></pre>
</div>
<div id="-5.6.7.3" class="section level4">
<h4><span class="header-section-number">2.3.6.9</span> Упражнение 5.6.7.3</h4>
<div class="question">
<p>Our definition of cancelled flights (<code>is.na(dep_delay) | is.na(arr_delay)</code> ) is slightly suboptimal. Why? Which is the most important column?</p>
</div>
<p>Потому что мы берём и те рейсы у которых нет данных о задержки вылета, и те рейсы у которых нет данных о задержки прилёта. Во второе множество могут попасть самолёты, у которых был вылет. Таким образом, фактически такой рейс неправильно называть отменённым. Определяющим столбцом в этом случае будет время в полёте, если нет информации и о времени полёта, то с большей вероятностью этот рейс отменили.
В довесок, лучше заменить логическое ИЛИ на логическое И:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb281-1" data-line-number="1"><span class="kw">filter</span>(flights, <span class="kw">is.na</span>(dep_delay) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(arr_delay))</a></code></pre></div>
<pre><code>## # A tibble: 8,255 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1       NA           1630        NA       NA
##  2  2013     1     1       NA           1935        NA       NA
##  3  2013     1     1       NA           1500        NA       NA
##  4  2013     1     1       NA            600        NA       NA
##  5  2013     1     2       NA           1540        NA       NA
##  6  2013     1     2       NA           1620        NA       NA
##  7  2013     1     2       NA           1355        NA       NA
##  8  2013     1     2       NA           1420        NA       NA
##  9  2013     1     2       NA           1321        NA       NA
## 10  2013     1     2       NA           1545        NA       NA
## # … with 8,245 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Таким образом, выражение выше, больше похоже на отменённые рейсы</p>
</div>
<div id="-5.6.7.4" class="section level4">
<h4><span class="header-section-number">2.3.6.10</span> Упражнение 5.6.7.4</h4>
<div class="question">
<p>Look at the number of cancelled flights per day. Is there a pattern? Is the proportion of cancelled flights related to the average delay?</p>
</div>
<p>Это была задача на внимательность. Сначала я искал закономерности в наборе данных <code>not_canceled</code>. И естественно у меня не получалось найти отменённые рейсы, поскольку набор данных <code>not_canceled</code> изначально не содержит пропущенных значений. Остальное дело техники:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb283-1" data-line-number="1">canceled_delayed &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Присвой результаты в переменную</span></a>
<a class="sourceLine" id="cb283-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">canceled =</span> (<span class="kw">is.na</span>(dep_delay) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(arr_delay))) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Добавь параметр отменённых рейсов</span></a>
<a class="sourceLine" id="cb283-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span><span class="st">                               </span><span class="co"># Сгруппируй по дате</span></a>
<a class="sourceLine" id="cb283-4" data-line-number="4"><span class="st">    </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb283-5" data-line-number="5">      <span class="dt">prop_canceled =</span> <span class="kw">mean</span>(canceled),                          <span class="co"># Посчитай долю отмененных рейсов</span></a>
<a class="sourceLine" id="cb283-6" data-line-number="6">      <span class="dt">avg_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))           <span class="co"># Посчитай среднее время задержки</span></a>
<a class="sourceLine" id="cb283-7" data-line-number="7"></a>
<a class="sourceLine" id="cb283-8" data-line-number="8"><span class="kw">ggplot</span>(canceled_delayed, <span class="kw">aes</span>(avg_dep_delay, prop_canceled)) <span class="op">+</span><span class="st">  </span><span class="co"># Построй график для иллюстрации зависимости</span></a>
<a class="sourceLine" id="cb283-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb283-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-174-1.png" width="672" /></p>
<p>Как видно на приведённом графике, зависимость между отменёнными авиарейсами и сдреним временем задержки есть - она прямая и близка к линейной</p>
<p>Интересно, как сильно на график влияет выбор оси ординат:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb285-1" data-line-number="1"><span class="kw">ggplot</span>(canceled_delayed, <span class="kw">aes</span>(prop_canceled, avg_dep_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb285-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb285-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-175-1.png" width="672" /></p>
</div>
<div id="-5.6.7.5" class="section level4">
<h4><span class="header-section-number">2.3.6.11</span> Упражнение 5.6.7.5</h4>
<div class="question">
<p>Which carrier has the worst delays? Challenge: can you disentangle the effects of bad airports vs. bad carriers? Why/why not? (Hint: think about <code>flights %&gt;% group_by(carrier, dest) %&gt;% summarise(n())</code>)</p>
</div>
<p>Что является задержкой? задержка вылета или задержка прилёта? Так как однозначного ответа нет, я буду использовать задержку вылета <code>dep_delay</code>.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb287-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb287-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb287-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb287-4" data-line-number="4">    <span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb287-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dep_delay))</a></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier dep_delay
##    &lt;chr&gt;       &lt;dbl&gt;
##  1 F9          20.2 
##  2 EV          20.0 
##  3 YV          19.0 
##  4 FL          18.7 
##  5 WN          17.7 
##  6 9E          16.7 
##  7 B6          13.0 
##  8 VX          12.9 
##  9 OO          12.6 
## 10 UA          12.1 
## 11 MQ          10.6 
## 12 DL           9.26
## 13 AA           8.59
## 14 AS           5.80
## 15 HA           4.90
## 16 US           3.78</code></pre>
<p>Перевозчик <code>F9</code> чаще остальных допускал задержки.</p>
<p>Разделить эффекты плохих перевозчиков и плохих аэропортов можно.
Если плохой <em>аэропорт</em>, то у всех перевозчиков будут задержки в этом аэропорте.
Если плохой <em>перевозчик</em>, то в сравнении с другими перевозчиками, у него будет выше средняя задержка в каждом аэропорте.
Возможно ли это? Да возможно.</p>
<p>Код из подсказки считает количество рейсов который каждый перевозчик совершил в конкретный аэропорт:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb289-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st">    </span></a>
<a class="sourceLine" id="cb289-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(carrier, dest) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb289-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>())</a></code></pre></div>
<pre><code>## # A tibble: 314 x 3
## # Groups:   carrier [16]
##    carrier dest  count
##    &lt;chr&gt;   &lt;chr&gt; &lt;int&gt;
##  1 9E      ATL      59
##  2 9E      AUS       2
##  3 9E      AVL      10
##  4 9E      BGR       1
##  5 9E      BNA     474
##  6 9E      BOS     914
##  7 9E      BTV       2
##  8 9E      BUF     833
##  9 9E      BWI     856
## 10 9E      CAE       3
## # … with 304 more rows</code></pre>
<p>Можно найти количество рейсов, который совершил каждый перевозчик по маршруту. Для этого надо добавить аэропорт вылета и изменить порядок группировки:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb291-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st">    </span></a>
<a class="sourceLine" id="cb291-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(origin, dest, carrier) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb291-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">count =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb291-4" data-line-number="4">            <span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))<span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb291-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(origin, dest, dep_delay)</a></code></pre></div>
<pre><code>## # A tibble: 439 x 5
## # Groups:   origin, dest [224]
##    origin dest  carrier count dep_delay
##    &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;int&gt;     &lt;dbl&gt;
##  1 EWR    ALB   EV        439     23.6 
##  2 EWR    ANC   UA          8     12.9 
##  3 EWR    ATL   9E          4     -5.75
##  4 EWR    ATL   DL       3153     11.9 
##  5 EWR    ATL   UA        103     15.8 
##  6 EWR    ATL   EV       1762     22.3 
##  7 EWR    AUS   WN        298      3.84
##  8 EWR    AUS   UA        670     14.9 
##  9 EWR    AVL   EV        265      8.62
## 10 EWR    BDL   EV        435     17.6 
## # … with 429 more rows</code></pre>
<p>С этим уже можно работать. Я бы построил по каждому направлению вылета, столбчатую диаграмму, высота которой определялась бы параметром <code>dep_delay</code> и соответствовала каждому перевозчику. Но пока не могу придумать как это лучше сделать. Хотя в принципе и с этой информацией уже можно работать.</p>
</div>
<div id="-5.6.7.6" class="section level4">
<h4><span class="header-section-number">2.3.6.12</span> Упражнение 5.6.7.6</h4>
<div class="question">
<p>Подсчитайте для каждого воздушного судна количество авиарейсов, совершенных до первой задержки более чем на 1 час.</p>
</div>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb293-1" data-line-number="1">not_canceled <span class="op">%&gt;%</span><span class="st">                                      </span><span class="co"># Будем брать те судна, у которых состоялся полёт</span></a>
<a class="sourceLine" id="cb293-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(tailnum, carrier) <span class="op">%&gt;%</span><span class="st">                      </span><span class="co"># Воздушное судно определяется номером самолёта </span></a>
<a class="sourceLine" id="cb293-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(                                          <span class="co"># и перевозчиком</span></a>
<a class="sourceLine" id="cb293-4" data-line-number="4">    <span class="dt">n_first_hour =</span> <span class="kw">sum</span>(dep_delay <span class="op">&gt;=</span><span class="st"> </span><span class="dv">60</span>)) <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># Количество авиарейсов с условием dep_delay &gt;= 60</span></a>
<a class="sourceLine" id="cb293-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n_first_hour))                         <span class="co"># Самые неопаздывающие судна и перевозчики</span></a></code></pre></div>
<pre><code>## # A tibble: 4,054 x 3
## # Groups:   tailnum [4,037]
##    tailnum carrier n_first_hour
##    &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt;
##  1 N192JB  B6                53
##  2 N15910  EV                49
##  3 N16919  EV                47
##  4 N15980  EV                46
##  5 N228JB  B6                46
##  6 N14573  EV                44
##  7 N258JB  B6                44
##  8 N298JB  B6                43
##  9 N10575  EV                42
## 10 N13994  EV                42
## # … with 4,044 more rows</code></pre>
</div>
<div id="-5.6.7.7" class="section level4">
<h4><span class="header-section-number">2.3.6.13</span> Упражнение 5.6.7.7</h4>
<div class="question">
<p>What does the <code>sort</code> argument to <code>count()</code> do. When might you use it?</p>
</div>
<p>Аргумент <code>sort</code> если он <code>TRUE</code>, сортирует в порядке убывания. Сортировка очень часто используется. Взять к примеру предыдущие упражнения.</p>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">2.3.7</span> Групповое видоизменение (и фильтрация)</h3>
<p>Группировку полезно сочетать не только с <code>summerise()</code> но так же с <code>filter()</code> или <code>mutate()</code>:</p>
<ul>
<li>Найти члены каждой группы имеющие наихудшие показатели</li>
</ul>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb295-1" data-line-number="1">flights_sml &lt;-<span class="st"> </span><span class="kw">select</span>(flights, </a>
<a class="sourceLine" id="cb295-2" data-line-number="2">  year<span class="op">:</span>day, </a>
<a class="sourceLine" id="cb295-3" data-line-number="3">  <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), </a>
<a class="sourceLine" id="cb295-4" data-line-number="4">  distance, </a>
<a class="sourceLine" id="cb295-5" data-line-number="5">  air_time)</a>
<a class="sourceLine" id="cb295-6" data-line-number="6"></a>
<a class="sourceLine" id="cb295-7" data-line-number="7">flights_sml <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb295-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(year, month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb295-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">rank</span>(<span class="kw">desc</span>(arr_delay)) <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3,306 x 7
## # Groups:   year, month, day [365]
##     year month   day dep_delay arr_delay distance air_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1       853       851      184       41
##  2  2013     1     1       290       338     1134      213
##  3  2013     1     1       260       263      266       46
##  4  2013     1     1       157       174      213       60
##  5  2013     1     1       216       222      708      121
##  6  2013     1     1       255       250      589      115
##  7  2013     1     1       285       246     1085      146
##  8  2013     1     1       192       191      199       44
##  9  2013     1     1       379       456     1092      222
## 10  2013     1     2       224       207      550       94
## # … with 3,296 more rows</code></pre>
<ul>
<li>Найти все группы которым соответствует превышение порогового значения</li>
</ul>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb297-1" data-line-number="1">popular_dests &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb297-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb297-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">365</span>)</a>
<a class="sourceLine" id="cb297-4" data-line-number="4">popular_dests</a></code></pre></div>
<pre><code>## # A tibble: 332,577 x 19
## # Groups:   dest [77]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 332,567 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>Стандартизировать для вычисления метрик групп</li>
</ul>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb299-1" data-line-number="1">popular_dests <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb299-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb299-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop_delay =</span> arr_delay <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(arr_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb299-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, dest, arr_delay, prop_delay)</a></code></pre></div>
<pre><code>## # A tibble: 131,106 x 6
## # Groups:   dest [77]
##     year month   day dest  arr_delay prop_delay
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1  2013     1     1 IAH          11  0.000111 
##  2  2013     1     1 IAH          20  0.000201 
##  3  2013     1     1 MIA          33  0.000235 
##  4  2013     1     1 ORD          12  0.0000424
##  5  2013     1     1 FLL          19  0.0000938
##  6  2013     1     1 ORD           8  0.0000283
##  7  2013     1     1 LAX           7  0.0000344
##  8  2013     1     1 DFW          31  0.000282 
##  9  2013     1     1 ATL          12  0.0000400
## 10  2013     1     1 DTW          16  0.000116 
## # … with 131,096 more rows</code></pre>
<div id="-5.7.1.1" class="section level4">
<h4><span class="header-section-number">2.3.7.1</span> Упражнение 5.7.1.1</h4>
<div class="question">
<p>Refer back to the table of useful mutate and filtering functions. Describe how each operation changes when you combine it with grouping.</p>
</div>
<p>Они работают для каждого параметра по отдельности, а не по всему фрейму данных. Например среднее будет вычислять среднее значение в каждой группе.</p>
</div>
<div id="-5.7.1.2" class="section level4">
<h4><span class="header-section-number">2.3.7.2</span> Упражнение 5.7.1.2</h4>
<div class="question">
<p>Which plane (<code>tailnum</code>) has the worst on-time record?</p>
</div>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb301-1" data-line-number="1">not_canceled <span class="op">%&gt;%</span><span class="st">                  </span><span class="co"># беру состоявшиеся рейсы</span></a>
<a class="sourceLine" id="cb301-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(tailnum) <span class="op">%&gt;%</span><span class="st">           </span><span class="co"># группирую по номеру самолёта</span></a>
<a class="sourceLine" id="cb301-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb301-4" data-line-number="4">    <span class="dt">worst =</span> <span class="kw">mean</span>(arr_delay)) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># подсчитываю в группе среднее время задержки прибытия</span></a>
<a class="sourceLine" id="cb301-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(worst))            <span class="co"># сортирую список по убыванию</span></a></code></pre></div>
<pre><code>## # A tibble: 4,037 x 2
##    tailnum worst
##    &lt;chr&gt;   &lt;dbl&gt;
##  1 N844MH   320 
##  2 N911DA   294 
##  3 N922EV   276 
##  4 N587NW   264 
##  5 N851NW   219 
##  6 N928DN   201 
##  7 N7715E   188 
##  8 N654UA   185 
##  9 N665MQ   175.
## 10 N427SW   157 
## # … with 4,027 more rows</code></pre>
</div>
<div id="-5.7.1.3" class="section level4">
<h4><span class="header-section-number">2.3.7.3</span> Упражнение 5.7.1.3</h4>
<div class="question">
<p>What time of day should you fly if you want to avoid delays as much as possible?</p>
</div>
<p>Так как есть две задержки, есть два пути осмысления того, какое время считать благоприятным для вылета.
Если рассуждать исходя из времени задержки вылета, то мы не будем знать, сколько времени самолёт проведёт в воздухе. В свою очередь нулевая задержка прилёта, говорит о том, что даже если самолёт опаздал с вылетом, он прибыл во время.</p>
<p>Я буду считать по времени прилёта.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb303-1" data-line-number="1">not_canceled <span class="op">%&gt;%</span><span class="st">                     </span><span class="co"># считаем по состоявшимся рейсам</span></a>
<a class="sourceLine" id="cb303-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(hour) <span class="op">%&gt;%</span><span class="st">                 </span><span class="co"># Группируем по запланированному времени вылета</span></a>
<a class="sourceLine" id="cb303-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb303-4" data-line-number="4">    <span class="dt">best_time =</span> <span class="kw">mean</span>(arr_delay)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># считаем среднее время задержки прибытия в каждой часовой группе</span></a>
<a class="sourceLine" id="cb303-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(best_time)                 <span class="co"># сортируем итог по возрастанию</span></a></code></pre></div>
<pre><code>## # A tibble: 19 x 2
##     hour best_time
##    &lt;dbl&gt;     &lt;dbl&gt;
##  1     7    -5.30 
##  2     5    -4.80 
##  3     6    -3.38 
##  4     9    -1.45 
##  5     8    -1.11 
##  6    10     0.954
##  7    11     1.48 
##  8    12     3.49 
##  9    13     6.54 
## 10    14     9.20 
## 11    23    11.8  
## 12    15    12.3  
## 13    16    12.6  
## 14    18    14.8  
## 15    22    16.0  
## 16    17    16.0  
## 17    19    16.7  
## 18    20    16.7  
## 19    21    18.4</code></pre>
<p>Для ответа, вероятнее всего нужна была одна цифра - время вылета. Но, чтобы иметь более широкое представление я покажу в порядке убывания “лучшести”, благоприятные часы вылета.</p>
</div>
<div id="-5.7.1.4" class="section level4">
<h4><span class="header-section-number">2.3.7.4</span> Упражнение 5.7.1.4</h4>
<div class="question">
<p>For each destination, compute the total minutes of delay. For each flight, compute the proportion of the total delay for its destination.</p>
</div>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb305-1" data-line-number="1">not_canceled <span class="op">%&gt;%</span><span class="st">              </span><span class="co"># Берём состаявшиеся рейсы</span></a>
<a class="sourceLine" id="cb305-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(arr_delay <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># Берём только рейсы с задержками</span></a>
<a class="sourceLine" id="cb305-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st">          </span><span class="co"># Сортируем по направлению вылета</span></a>
<a class="sourceLine" id="cb305-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(                     </a>
<a class="sourceLine" id="cb305-5" data-line-number="5">    <span class="dt">zad =</span> <span class="kw">sum</span>(arr_delay)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Добавляем в выборку параметр суммарной задержки рейса</span></a>
<a class="sourceLine" id="cb305-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(flight) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># Группируем по номеру судна</span></a>
<a class="sourceLine" id="cb305-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(                </a>
<a class="sourceLine" id="cb305-8" data-line-number="8">    <span class="dt">fu =</span> <span class="kw">mean</span>(zad)) <span class="op">%&gt;%</span><span class="st">       </span><span class="co"># Добавляем в выборку параметр средней задержки рейса</span></a>
<a class="sourceLine" id="cb305-9" data-line-number="9"><span class="st">  </span><span class="kw">arrange</span>(fu)                 <span class="co"># Сортируем данные по возрастанию средней времени задержки рейса</span></a></code></pre></div>
<pre><code>## # A tibble: 133,004 x 21
## # Groups:   flight [3,432]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1    26     1051           1055        -4     1401
##  2  2013    12    21     1040           1030        10     1336
##  3  2013     2     2     1051           1055        -4     1404
##  4  2013     2    23     1053           1055        -2     1408
##  5  2013     3    16     1046           1055        -9     1412
##  6  2013     3    23     1050           1055        -5     1400
##  7  2013    10    18     1820           1745        35     2030
##  8  2013     9     8      847            840         7     1043
##  9  2013    12    21     1002           1005        -3     1416
## 10  2013    12    23     1020           1005        15     1345
## # … with 132,994 more rows, and 14 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, zad &lt;dbl&gt;, fu &lt;dbl&gt;</code></pre>
</div>
<div id="-5.7.1.5" class="section level4">
<h4><span class="header-section-number">2.3.7.5</span> Упражнение 5.7.1.5</h4>
<div class="question">
<p>Delays are typically temporally correlated: even once the problem that caused the initial delay has been resolved, later flights are delayed to allow earlier flights to leave. Using <code>lag()</code> explore how the delay of a flight is related to the delay of the immediately preceding flight.</p>
</div>
<p>Следующий код, показывает задержку вылета из того же аэропорта. Похоже на расписание вылетов из каждого аэропорта.</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb307-1" data-line-number="1">(lagged_delays &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st">                       </span><span class="co"># Берём исходный набор данных</span></a>
<a class="sourceLine" id="cb307-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(origin, year, month, day, dep_time) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># Сортируем по возрастанию с указанным порядком</span></a>
<a class="sourceLine" id="cb307-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(origin) <span class="op">%&gt;%</span><span class="st">                              </span><span class="co"># Группируем по пункту назначения</span></a>
<a class="sourceLine" id="cb307-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dep_delay_lag =</span> <span class="kw">lag</span>(dep_delay)) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># Добавляем временное смещение</span></a>
<a class="sourceLine" id="cb307-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_delay), <span class="op">!</span><span class="kw">is.na</span>(dep_delay_lag))) <span class="co"># Убираем отсутствующие значения</span></a></code></pre></div>
<pre><code>## # A tibble: 327,649 x 20
## # Groups:   origin [3]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      554            558        -4      740
##  2  2013     1     1      555            600        -5      913
##  3  2013     1     1      558            600        -2      923
##  4  2013     1     1      559            600        -1      854
##  5  2013     1     1      601            600         1      844
##  6  2013     1     1      606            610        -4      858
##  7  2013     1     1      607            607         0      858
##  8  2013     1     1      608            600         8      807
##  9  2013     1     1      615            615         0      833
## 10  2013     1     1      622            630        -8     1017
## # … with 327,639 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, dep_delay_lag &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb309-1" data-line-number="1">lagged_delays <span class="op">%&gt;%</span><span class="st">                                       </span><span class="co"># Берём набор данных с указанными задержками вылета</span></a>
<a class="sourceLine" id="cb309-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(dep_delay_lag) <span class="op">%&gt;%</span><span class="st">                           </span><span class="co"># Группируем по временному смещению</span></a>
<a class="sourceLine" id="cb309-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb309-4" data-line-number="4">    <span class="dt">dep_delay_mean =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span><span class="st">               </span><span class="co"># Считаем среднюю задержку</span></a>
<a class="sourceLine" id="cb309-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> dep_delay_mean, <span class="dt">x =</span> dep_delay_lag)) <span class="op">+</span><span class="st">  </span><span class="co"># Строим диаграмму рассеяния и сглаженную прямую</span></a>
<a class="sourceLine" id="cb309-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb309-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb309-8" data-line-number="8"><span class="st">  </span><span class="kw">labs</span>(                                                 <span class="co"># Задаём названия осям</span></a>
<a class="sourceLine" id="cb309-9" data-line-number="9">    <span class="dt">y =</span> <span class="st">&quot;Задержка вылета, мин&quot;</span>, </a>
<a class="sourceLine" id="cb309-10" data-line-number="10">    <span class="dt">x =</span> <span class="st">&quot;Предыдущая задержка вылета, мин&quot;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-187-1.png" width="672" /></p>
</div>
<div id="-5.7.1.6" class="section level4">
<h4><span class="header-section-number">2.3.7.6</span> Упражнение 5.7.1.6</h4>
<div class="question">
<p>Look at each destination. Can you find flights that are suspiciously fast? (i.e. flights that represent a potential data entry error). Compute the air time of a flight relative to the shortest flight to that destination. Which flights were most delayed in the air?</p>
</div>
<p>Мой изначальный код:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb311-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n =</span> <span class="kw">mean</span>(air_time, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb311-4" data-line-number="4">         <span class="dt">fu =</span> air_time <span class="op">-</span><span class="st"> </span>n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(fu <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(fu) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb311-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>(day<span class="op">:</span>carrier))</a></code></pre></div>
<pre><code>## # A tibble: 411 x 13
## # Groups:   origin, dest [12]
##     year month flight tailnum origin dest  air_time distance  hour minute
##    &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  2013     5     51 N383HA  JFK    HNL        580     4983    10      0
##  2  2013     6     51 N384HA  JFK    HNL        580     4983    10      0
##  3  2013     9     51 N384HA  JFK    HNL        580     4983    10      0
##  4  2013     6     51 N385HA  JFK    HNL        581     4983    10      0
##  5  2013     6     51 N390HA  JFK    HNL        582     4983    10      0
##  6  2013     9     51 N393HA  JFK    HNL        582     4983    10      0
##  7  2013     2     51 N382HA  JFK    HNL        584     4983     9      0
##  8  2013     5     51 N382HA  JFK    HNL        584     4983    10      0
##  9  2013     9     51 N391HA  JFK    HNL        584     4983    10      0
## 10  2013     7     51 N388HA  JFK    HNL        585     4983    10      0
## # … with 401 more rows, and 3 more variables: time_hour &lt;dttm&gt;, n &lt;dbl&gt;,
## #   fu &lt;dbl&gt;</code></pre>
<p>Я хотел просто посмотреть отклонение от среднего. Однако такой подход в корне неверен. Да и к тому же, я исключал отсутствующие значения только на этапе подсчёта среднего, а их необходимо было удалить сразу.
Изначально я хотел подсчитать средеквадратичное отклонение, но профакапился.</p>
<p>Модифицированный код, который я подсмотрел, основан на <a href="https://ru.wikipedia.org/wiki/Z-оценка">z-Оценка</a>, или другими словами стандартное отклонение. Стандартное отклонение, считается по формуле: <span class="math inline">\({\displaystyle z={x-{\bar {X}} \over S_{x}}}\)</span></p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb313-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st">                                                </span><span class="co"># Берём все полёты</span></a>
<a class="sourceLine" id="cb313-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(air_time)) <span class="op">%&gt;%</span><span class="st">                             </span><span class="co"># Исключаем отсутствующие значения</span></a>
<a class="sourceLine" id="cb313-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(origin, dest) <span class="op">%&gt;%</span><span class="st">                               </span><span class="co"># Группируем по паре место вылета, место назначения</span></a>
<a class="sourceLine" id="cb313-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">air_time_mean =</span> <span class="kw">mean</span>(air_time),                   <span class="co"># Добавляем в набор данных, параметр средного значения</span></a>
<a class="sourceLine" id="cb313-5" data-line-number="5">         <span class="dt">air_time_sd =</span> <span class="kw">sd</span>(air_time),                       <span class="co"># Так же добавляем среднеквадратичное отклонение</span></a>
<a class="sourceLine" id="cb313-6" data-line-number="6">         <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st">                                      </span><span class="co"># Добавляем счётчик рейсов</span></a>
<a class="sourceLine" id="cb313-7" data-line-number="7"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">                                            </span><span class="co"># Ангруппим чтобы вернуться к исходным данным, но с новыми параметрами</span></a>
<a class="sourceLine" id="cb313-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">z =</span> (air_time <span class="op">-</span><span class="st"> </span>air_time_mean) <span class="op">/</span><span class="st"> </span>air_time_sd) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Считаем стандартное отклонение</span></a>
<a class="sourceLine" id="cb313-9" data-line-number="9"><span class="st">  </span><span class="kw">arrange</span>(z) <span class="op">%&gt;%</span><span class="st">                                           </span><span class="co"># Сортируем по возрастанию стандартного отклонения</span></a>
<a class="sourceLine" id="cb313-10" data-line-number="10"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>(day<span class="op">:</span>carrier))                                   <span class="co"># Убираем &quot;лишнее&quot; при выводе в консоль</span></a></code></pre></div>
<pre><code>## # A tibble: 327,346 x 15
##     year month flight tailnum origin dest  air_time distance  hour minute
##    &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  2013     5   1499 N666DN  LGA    ATL         65      762    17      0
##  2  2013     7   4667 N17196  EWR    MSP         93     1008    15     13
##  3  2013     5   4292 N14568  EWR    GSP         55      594    20     25
##  4  2013    11   2002 N317JB  JFK    BUF         38      301    22     50
##  5  2013     3   3805 N12567  EWR    BNA         70      748    19     10
##  6  2013     9   4687 N11544  EWR    CVG         62      569    13     43
##  7  2013     4   5486 N615QX  LGA    PIT         40      335    16     10
##  8  2013     3     30 N323JB  JFK    ROC         35      264    22     50
##  9  2013     1   1902 N956DL  LGA    PBI        105     1035    16      0
## 10  2013     3   2132 N947UW  LGA    BOS         21      184    15      0
## # … with 327,336 more rows, and 5 more variables: time_hour &lt;dttm&gt;,
## #   air_time_mean &lt;dbl&gt;, air_time_sd &lt;dbl&gt;, n &lt;int&gt;, z &lt;dbl&gt;</code></pre>
</div>
<div id="-5.7.1.7" class="section level4">
<h4><span class="header-section-number">2.3.7.7</span> Упражнение 5.7.1.7</h4>
<div class="question">
<p>Find all destinations that are flown by at least two carriers. Use that information to rank the carriers.</p>
</div>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb315-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st">                                        </span><span class="co"># ЧАСТЬ 1. Берём все перелёты</span></a>
<a class="sourceLine" id="cb315-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(carrier, dest) <span class="op">%&gt;%</span><span class="st">                        </span><span class="co"># Отбираем только направления и перевозчиков</span></a>
<a class="sourceLine" id="cb315-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(dest, carrier) <span class="op">%&gt;%</span><span class="st">                      </span><span class="co"># Группируем по направлениям и перевозчикам</span></a>
<a class="sourceLine" id="cb315-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>() <span class="op">==</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st">                    </span><span class="co"># Ранжируем и берём только первые элементы</span></a>
<a class="sourceLine" id="cb315-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span><span class="st">                               </span><span class="co"># Группируем полученный список по направлениям</span></a>
<a class="sourceLine" id="cb315-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">n_carrier =</span> <span class="kw">length</span>(<span class="kw">unique</span>(carrier))) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Добавляем столбец, с количеством уникальных элементов</span></a>
<a class="sourceLine" id="cb315-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(n_carrier <span class="op">&gt;=</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span><span class="st">                       </span><span class="co"># Берём только те что имеют два и более перевозчика</span></a>
<a class="sourceLine" id="cb315-8" data-line-number="8"><span class="st">  </span><span class="kw">group_by</span>(carrier) <span class="op">%&gt;%</span><span class="st">                            </span><span class="co"># ЧАСТЬ 2. Группируем по перевозчикам</span></a>
<a class="sourceLine" id="cb315-9" data-line-number="9"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n_dest =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st">                      </span><span class="co"># Считаем количество пунктов назначения у каждого перевозчика</span></a>
<a class="sourceLine" id="cb315-10" data-line-number="10"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n_dest))                            <span class="co"># Сортируем перевозчиков по максимальному кол-ву пунктов назначения</span></a></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier n_dest
##    &lt;chr&gt;    &lt;int&gt;
##  1 EV          51
##  2 9E          48
##  3 UA          42
##  4 DL          39
##  5 B6          35
##  6 AA          19
##  7 MQ          19
##  8 WN          10
##  9 OO           5
## 10 US           5
## 11 VX           4
## 12 YV           3
## 13 FL           2
## 14 AS           1
## 15 F9           1
## 16 HA           1</code></pre>
<!--chapter:end:03_data_transformation.Rmd-->
</div>
</div>
</div>
<div id="---" class="section level2">
<h2><span class="header-section-number">2.4</span> Организация рабочего процесса: скрипты</h2>
<p>Здесь советуют юзать шорт-каты и окно скриптов.
Это забавно, потому что я с момента открытия книги использую R.markdown файлы, для ведения документа обучения.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb317-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb317-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)</a>
<a class="sourceLine" id="cb317-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</a>
<a class="sourceLine" id="cb317-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</a>
<a class="sourceLine" id="cb317-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;Lahman&quot;</span>)</a></code></pre></div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.4.1</span> Выполнение кода</h3>
<p>Здесь снова советуют юзать шорт-каты. Спасибо, на самом деле очень своевременно. Без иронии.</p>
<p>А так же автор книги приучает к правилам хорошего тона - не вставлять в скрипты исполняющие на чужом компьютере строки кода типа скачивания пакетов <code>install.packeges()</code> или установки рабочей директории<code>setwd()</code>.</p>
</div>
<div id="--rstudio" class="section level3">
<h3><span class="header-section-number">2.4.2</span> Диагностические средства RStudio</h3>
<p>Ошибки и предупреждения видны в окне исполнения скриптов.</p>
<div id="-6.3.1" class="section level4">
<h4><span class="header-section-number">2.4.2.1</span> Упражнение 6.3.1</h4>
<div class="question">
<p>Go to the RStudio Tips twitter account, <a href="https://twitter.com/rstudiotips">https://twitter.com/rstudiotips</a> and find one tip that looks interesting. Practice using it!</p>
</div>
<p>На самом деле, много интересных трюков - использование окна скрипта как в Vim для быстрого редактирования столбиком</p>
<p>Например, есть такое окно</p>
<pre><code>А
А
А
А</code></pre>
<p>нужно зажать “Option” на Маке, и “Alt” на Винде, курсор станет крестиком, необходимо выделить нужный столбец и можно редактировать сразу на всю строку. Это очень удобно.</p>
<pre><code>&quot;А&quot;, %&gt;%
&quot;А&quot;, %&gt;%
&quot;А&quot;, %&gt;%
&quot;А&quot;, %&gt;%</code></pre>
<p>А чтобы всё выстроить в линию, достачно сделать удаление после курсора - на маке комбинация клавиш <code>fn</code>+<code>delete</code>, на винде просто <code>bacspace</code>.</p>
<pre><code>&quot;А&quot;, %&gt;% &quot;А&quot;, %&gt;% &quot;А&quot;, %&gt;% &quot;А&quot;, %&gt;%</code></pre>
<p>Огонь просто.</p>
</div>
<div id="-6.3.2" class="section level4">
<h4><span class="header-section-number">2.4.2.2</span> Упражнение 6.3.2</h4>
<div class="question">
<p>What other common mistakes will RStudio diagnostics report? Read <a href="https://support.rstudio.com/hc/en-us/articles/205753617-Code-Diagnostics">Code diagnostics</a> to find out.</p>
</div>
<ol style="list-style-type: decimal">
<li><p>Проверка отсутствия, несогласованности, частично согласованности и большого количества аргументов для функций</p></li>
<li><p>Предупреждение, если переменная не определена</p></li>
<li><p>Предупреждение, если переменная определена, но не используется</p></li>
<li><p><a href="http://adv-r.had.co.nz/Style.html">Hadley Wickham’s style guide</a></p></li>
<li><p><a href="http://yihui.name/formatr/">Format R code automatically by Yihui Xie</a></p></li>
<li><p>А так же божественные комментарии об ошибках</p></li>
</ol>
<p>Несколько советов от бати, собственно они применимы ко всей деятельности, и с ними я не раз сталкивался:</p>
<ul>
<li><p>Комментируй код. В комменте пиши “Почему”, а не “Что”.</p></li>
<li><p>Не пиши в коде строку длиннее чем 80 символов. Тупо неудобно бегать по строке долго глазами. Позаботься о том, кто возможно будет читать твой код.</p></li>
</ul>
<!--chapter:end:04_workflow_scripts.Rmd-->
</div>
</div>
</div>
<div id="--" class="section level2">
<h2><span class="header-section-number">2.5</span> Предварительный анализ данных</h2>
<div id="-3" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Введение</h3>
<p>По сути ПАД — итеративный процесс, включающий три стадии</p>
<ol style="list-style-type: decimal">
<li><p>Формулирование вопросов относительно данных</p></li>
<li><p>Поиск ответов на поставленные вопросы путем их визуализации, преобразования и моделирования данных</p></li>
<li><p>Использование полученных знаний для уточнения вопросов и (или) формулировки новых запросов.</p></li>
</ol>
<p>ПАД — это способ мышления</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.5.1.1</span> Необходимые ресурсы</h4>
<p>В этой главе закрепляем полученные навыки о пакетах <code>ggplot</code> &amp; <code>dplyr</code>.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb321-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb321-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)</a>
<a class="sourceLine" id="cb321-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</a>
<a class="sourceLine" id="cb321-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</a>
<a class="sourceLine" id="cb321-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;Lahman&quot;</span>)</a></code></pre></div>
</div>
</div>
<div class="section level3">
<h3><span class="header-section-number">2.5.2</span> Вопросы</h3>
<p>Главная цель ПАД — добиться понимания данных.
Для понимания данных, может пригодится знания бизнес-аналитики и правильного формулирования вопросов.</p>
<p>Вопросов много, и научиться правильно их задавать, это целое искусство. Но в центре, по крайне мере этой главы будут два вопроса:</p>
<ol style="list-style-type: decimal">
<li><p>Вариации какого типа существуют среди переменных</p></li>
<li><p>Ковариации какого типа существуют между переменными</p></li>
</ol>
<p>Определимся с терминологией:</p>
<ul>
<li><p><em>Переменная</em> — это количество, качество или свойство, которые можно измерить</p></li>
<li><p><em>Значение</em> — это состояние переменной в момент ее измерения. Значение переменной может изменяться от измерения к измерению.</p></li>
<li><p><em>Наблюдение</em> или <em>случай</em> — это набор измерений, выполненный в одинаоквых условиях обычно все измерения, входящие в наблюдение делаются в одно и тоже время для одного и того же объекта. Наблюдение содержит несколько значений, каждое из которых связано с отдельной переменной. Иногда вместо термина <em>наблюдение</em> мы будем использовать термин <em>точка данных</em></p></li>
<li><p><em>Табличные данные</em> — это набор значений, каждое из которых связано с переменной и наблюдением. Табличные данные считаются аккуратно организованными, если каждое значение находится в собственной ячейку, каждая переменная — в собственном столбце, а каждое наблюдение — в собственной строке.</p></li>
</ul>
<p>В столбцах — переменная, в строке — наблюдение, на пересечении — значение.</p>
</div>
<div class="section level3">
<h3><span class="header-section-number">2.5.3</span> Вариация</h3>
<p>Вариация — это свойство значений переменных изменяться от измерения к измерению.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.5.3.1</span> Визуализация распределений</h4>
<p>Как именно стоит визуализировать переменную, зависит от того какого она типа:</p>
<ul>
<li><em>Категориальными</em> — называются переменные, которые имеют небольшой набор возможных значений.</li>
</ul>
<p>Для визуализации категориальных переменных хорошо подходит столбчатая диаграмма</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb322-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb322-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(cut))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-193-1.png" width="672" /></p>
<p>Высота столбца соответсвует количеству наблюдений для каждого значения. Вычисление вручную:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb323-1" data-line-number="1">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb323-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(cut)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   cut           n
##   &lt;ord&gt;     &lt;int&gt;
## 1 Fair       1610
## 2 Good       4906
## 3 Very Good 12082
## 4 Premium   13791
## 5 Ideal     21551</code></pre>
<ul>
<li><em>Непрерывная</em> переменная — это такая переменная которая принимает любое из бесконечного можества упорядоченных значений.</li>
</ul>
<p>Для визуализации непрерывного распределения нужно использовать гистограмму, она показывает сколько наблюдений попало в конкретный диапазон.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb325-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb325-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat), <span class="dt">binwidth =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-195-1.png" width="672" /></p>
<p>Вычисление вручную:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb326-1" data-line-number="1">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb326-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(<span class="kw">cut_width</span>(carat, <span class="fl">0.5</span>))</a></code></pre></div>
<pre><code>## # A tibble: 11 x 2
##    `cut_width(carat, 0.5)`     n
##    &lt;fct&gt;                   &lt;int&gt;
##  1 [-0.25,0.25]              785
##  2 (0.25,0.75]             29498
##  3 (0.75,1.25]             15977
##  4 (1.25,1.75]              5313
##  5 (1.75,2.25]              2002
##  6 (2.25,2.75]               322
##  7 (2.75,3.25]                32
##  8 (3.25,3.75]                 5
##  9 (3.75,4.25]                 4
## 10 (4.25,4.75]                 1
## 11 (4.75,5.25]                 1</code></pre>
<p>Как учил ещё великий Скоморохов, проверять интервалы гистограмм нужно проверять. Потому что варьируя разбег, можно наткнуться на интересные закономерности. Пример из учебника:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb328-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb328-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(</a>
<a class="sourceLine" id="cb328-3" data-line-number="3">    <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat), <span class="dt">binwidth =</span> <span class="fl">0.1</span>) <span class="co"># Меняем значение для того чтобы показать, как изменится вид гистограммы</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-197-1.png" width="672" /></p>
<p>КОгда нужно наложить несколько гистограмм на один график, следует использовать вместо <code>geom_histogram</code> функцию <code>geom_freqpoly</code>. Статистику для вычисления последняя функция использует такую же как и гистограммы, однако для построения использует линии, а не столбцы.</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb329-1" data-line-number="1">smaller &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb329-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>)</a>
<a class="sourceLine" id="cb329-3" data-line-number="3"></a>
<a class="sourceLine" id="cb329-4" data-line-number="4"><span class="kw">ggplot</span>(<span class="dt">data =</span> smaller, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">colour =</span> cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb329-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-198-1.png" width="672" /></p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.5.3.2</span> Типичные значения</h4>
<p>В этой части главы, открывается очень интересная грань статистического исследования. Она граничит с бизнес-аналитикой — это постановка вопросов и обращение внимания на всякого рода закономерности.</p>
<p>Вопросы которые помогут всегда, я их на всякий случай оставлю тут, может когда-то пригодится:</p>
<ul>
<li><p>Какие значения встречаются наиболее часто? Почему?</p></li>
<li><p>Какие значения являются редкими? Почему? Соответствует ли это вашим ожиданиям?</p></li>
<li><p>Замечаете ли вы некоторые необычные закономерности? Чем их можно объяснить</p></li>
<li><p>Хозяйке на заметку — образование кластеров близких значений, указывает на существование подгрупп среди данных.</p></li>
<li><p>Насколько близки друг к другу наблюдения в пределах каждого кластера?</p></li>
<li><p>Насколько различаются между собой наблюдения, принадлежащие разным кластерам?</p></li>
<li><p>Как можно объяснить или описать кластеры?</p></li>
<li><p>Почему внешний вид кластеров может вводить в заблуждение?</p></li>
</ul>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">2.5.3.3</span> Необычные значения</h4>
<p><em>Выбросами</em> называют необычные наблюдения — точки данных, выпадющих из общего ряда.</p>
<p>Хороший пример из учебника. Наличие выбросов заметить нелегко, и только широкий диапазон построения может указывать на то, что здесь помимо построенных столбцов, существуют ещё значения.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb330-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb330-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> y), <span class="dt">binwidth =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-199-1.png" width="672" /></p>
<p>На построеннии почти ничего не заметно. Для того чтобы увеличить масштаб необходимо воспользоваться функцией <code>coord_cartesian()</code>:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb331-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb331-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> y), <span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb331-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">50</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-200-1.png" width="672" /></p>
<p>Мы обнаружили выбросы, теперь извлечём их:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb332-1" data-line-number="1">(unusual &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb332-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(y <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>y <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb332-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(y))</a></code></pre></div>
<pre><code>## # A tibble: 9 x 10
##   carat cut       color clarity depth table price     x     y     z
##   &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  1    Very Good H     VS2      63.3    53  5139  0      0    0   
## 2  1.14 Fair      G     VS1      57.5    67  6381  0      0    0   
## 3  1.56 Ideal     G     VS2      62.2    54 12800  0      0    0   
## 4  1.2  Premium   D     VVS1     62.1    59 15686  0      0    0   
## 5  2.25 Premium   H     SI2      62.8    59 18034  0      0    0   
## 6  0.71 Good      F     SI2      64.1    60  2130  0      0    0   
## 7  0.71 Good      F     SI2      64.1    60  2130  0      0    0   
## 8  0.51 Ideal     E     VS1      61.8    55  2075  5.15  31.8  5.12
## 9  2    Premium   H     SI2      58.9    57 12210  8.09  58.9  8.06</code></pre>
<p>Таким образом мы нашли бриллианты, которые имеют нулевые размеры и имеют стоимость. А так же имеют гигантские размеры, но при этом стоят копейки. С выбросами всегда надо быть осторожным.</p>
</div>
<div id="-7.3.4.1" class="section level4">
<h4><span class="header-section-number">2.5.3.4</span> Упражнение 7.3.4.1</h4>
<div class="question">
<p>Explore the distribution of each of the <code>x</code>, <code>y</code>, and <code>z</code> variables in <code>diamonds</code>. What do you learn? Think about a diamond and how you might decide which dimension is the length, width, and depth.</p>
</div>
<p>Я хотел построить все три параметра на одной плоскости. Но это было бы не так информативно как панели.</p>
<p>Решение с панелями я подсмотрел <a href="https://github.com/jrnold">Jeffrey Arnold</a>. Но конечено же я не хочу бездумно копировать, поэтому прежде чем приводить его решение, я разберу новые неизвестные для меня, но используемые у Джефри функции.</p>
<ul>
<li>Функция <code>gather()</code> — она используется, когда нужно несколько столбцов поместить в одну переменную. Такое иногда необходимо на практике, и я сам пару раз использовал подобный приём в Excel (В дополнении PLEX Еxcell для подобных нужд даже есть специальная функция) Продемонстрирую как работает <code>gather()</code>:</li>
</ul>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb334-1" data-line-number="1"><span class="co">#--------- Создаём набор данных, в котором есть 10 наблюдений трёх переменных записанных в стандартной форме</span></a>
<a class="sourceLine" id="cb334-2" data-line-number="2">(stocks &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb334-3" data-line-number="3">  <span class="dt">time =</span> <span class="kw">as.Date</span>(<span class="st">&#39;2009-01-01&#39;</span>) <span class="op">+</span><span class="st"> </span><span class="dv">0</span><span class="op">:</span><span class="dv">9</span>,</a>
<a class="sourceLine" id="cb334-4" data-line-number="4">  <span class="dt">X =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb334-5" data-line-number="5">  <span class="dt">Y =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb334-6" data-line-number="6">  <span class="dt">Z =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb334-7" data-line-number="7">))</a></code></pre></div>
<pre><code>##          time            X           Y          Z
## 1  2009-01-01 -0.390183708 -0.79103148  0.2287946
## 2  2009-01-02  1.237201047  0.88063145  6.1055074
## 3  2009-01-03 -1.349383261  0.41893367 -4.2865686
## 4  2009-01-04 -0.049240614 -0.09839749 -1.6791774
## 5  2009-01-05  0.184092137 -0.89164789 -8.3582478
## 6  2009-01-06  0.004450027 -2.51776517 -3.5904285
## 7  2009-01-07  0.438562401  2.97151066 -3.1690580
## 8  2009-01-08 -0.895781165  0.07815787  5.8369925
## 9  2009-01-09 -0.485027704  0.33058179  0.6227094
## 10 2009-01-10  0.864470927 -0.74817801  0.3662933</code></pre>
<p>Теперь мы хотим построить все три переменные за один приём. Чтобы это сделать, необходимо из трёх переменных сделать одну, и ввести идентификатор различия этой переменной. Эту операцию делает как раз функция <code>gather()</code>. Функция первым аргументом берёт набор данных, вторым необходимо указать название переменной, а последующими аргументами необходимо указать требумые переменные.
:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" data-line-number="1"><span class="kw">gather</span>(stocks, nazavanie_peremennoy, price, <span class="op">-</span>time)</a></code></pre></div>
<pre><code>##          time nazavanie_peremennoy        price
## 1  2009-01-01                    X -0.390183708
## 2  2009-01-02                    X  1.237201047
## 3  2009-01-03                    X -1.349383261
## 4  2009-01-04                    X -0.049240614
## 5  2009-01-05                    X  0.184092137
## 6  2009-01-06                    X  0.004450027
## 7  2009-01-07                    X  0.438562401
## 8  2009-01-08                    X -0.895781165
## 9  2009-01-09                    X -0.485027704
## 10 2009-01-10                    X  0.864470927
## 11 2009-01-01                    Y -0.791031479
## 12 2009-01-02                    Y  0.880631446
## 13 2009-01-03                    Y  0.418933668
## 14 2009-01-04                    Y -0.098397491
## 15 2009-01-05                    Y -0.891647886
## 16 2009-01-06                    Y -2.517765171
## 17 2009-01-07                    Y  2.971510659
## 18 2009-01-08                    Y  0.078157869
## 19 2009-01-09                    Y  0.330581790
## 20 2009-01-10                    Y -0.748178006
## 21 2009-01-01                    Z  0.228794556
## 22 2009-01-02                    Z  6.105507392
## 23 2009-01-03                    Z -4.286568588
## 24 2009-01-04                    Z -1.679177353
## 25 2009-01-05                    Z -8.358247777
## 26 2009-01-06                    Z -3.590428497
## 27 2009-01-07                    Z -3.169058013
## 28 2009-01-08                    Z  5.836992471
## 29 2009-01-09                    Z  0.622709413
## 30 2009-01-10                    Z  0.366293303</code></pre>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" data-line-number="1"><span class="co"># stocks %&gt;% gather(nazavanie_peremennoy, price, -time)</span></a></code></pre></div>
<ul>
<li>Функция <code>geom_density()</code>. Это кривая распределения, построенная по вершинам гистограммы. Это полезная альтернатива гистограмме для непрерывных данных, которая исходит из лежащего в основе плавного распределения:</li>
</ul>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb339-1" data-line-number="1"><span class="co">#--Гистограмма</span></a>
<a class="sourceLine" id="cb339-2" data-line-number="2"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb339-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.05</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-204-1.png" width="672" /></p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" data-line-number="1"><span class="co">#--Сглаженная кривая</span></a>
<a class="sourceLine" id="cb340-2" data-line-number="2"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb340-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_density</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-205-1.png" width="672" /></p>
<p>А теперь приступим к разбору предлагаемого решения:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb341-1" data-line-number="1">diamonds <span class="op">%&gt;%</span><span class="st">                         </span><span class="co"># Исходный набор данных с бриллиантами</span></a>
<a class="sourceLine" id="cb341-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>()) <span class="op">%&gt;%</span><span class="st">      </span><span class="co"># Добавить в набор параметр id который нумерует строки</span></a>
<a class="sourceLine" id="cb341-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(x, y, z, id) <span class="op">%&gt;%</span><span class="st">            </span><span class="co"># Взять только изучаемые параметры и номера строк</span></a>
<a class="sourceLine" id="cb341-4" data-line-number="4"><span class="st">  </span><span class="kw">gather</span>(variable, value , <span class="op">-</span>id)  <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Преобразуем три набора параметров в один, исключаем id</span></a>
<a class="sourceLine" id="cb341-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> value)) <span class="op">+</span><span class="st">           </span><span class="co"># В атрибуте aes(), задаём параметр x = value, в котором у нас три переменные x, y, z</span></a>
<a class="sourceLine" id="cb341-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_density</span>() <span class="op">+</span><span class="st">                   </span><span class="co"># Строим сглаженную гистограмму</span></a>
<a class="sourceLine" id="cb341-7" data-line-number="7"><span class="st">  </span><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.)           <span class="co"># Группируем решение в панели, для визуализации распределния параметров x, y, z</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-206-1.png" width="672" /></p>
<p>Отвечая на вопрос о новых знаниях об этих переменных —</p>
<ol style="list-style-type: decimal">
<li><p>у всех трёх переменных есть необычные значения ближе к нулю и подальше 30.</p></li>
<li><p>Все три переменные имеют похожее распределение с двумя ярковыраженными пиками.</p></li>
</ol>
<p>Отвечая на вопрос об измерениях — Бриллианты, как правило, имеют круглую форму. Поэтому два измерения — длинна и ширина, должны иметь примерно одинаковые значения. На графике выше видно, что <code>X</code> и <code>У</code> очень похожи между собой, выходит, что <code>Z</code> — это глубина</p>
</div>
<div id="-7.3.4.2" class="section level4">
<h4><span class="header-section-number">2.5.3.5</span> Упражнение 7.3.4.2</h4>
<div class="question">
<p>Explore the distribution of <code>price</code>. Do you discover anything unusual or surprising? (Hint: Carefully think about the <code>binwidth</code> and make sure you try a wide range of values.)</p>
</div>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb342-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb342-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(price), <span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb342-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2500</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-207-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li><p>Цена на бриллианты в этом наборе данных начинается чуть больше чем с 250, я так полагаю ближе к 300 долларам</p></li>
<li><p>Существует провал в цене рядом со значением 1500</p></li>
<li><p>Есть всплеск в точках около 750</p></li>
<li><p>Распределение цены плавно убывает от всплеска 750, до примерно 19000</p></li>
</ol>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb343-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(price), <span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb343-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">2500</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-208-1.png" width="672" /></p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb344-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb344-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(price), <span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb344-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">15000</span>, <span class="dv">19000</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-209-1.png" width="672" /></p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb345-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb345-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(price), <span class="dt">binwidth =</span> <span class="dv">100</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-210-1.png" width="672" /></p>
</div>
<div id="-7.3.4.3" class="section level4">
<h4><span class="header-section-number">2.5.3.6</span> Упражнение 7.3.4.3</h4>
<div class="question">
<p>How many diamonds are 0.99 carat? How many are 1 carat? What do you think is the cause of the difference?</p>
</div>
<p>разница ощутима:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb346-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb346-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.99</span>, carat <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb346-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(carat)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   carat     n
##   &lt;dbl&gt; &lt;int&gt;
## 1  0.99    23
## 2  1     1558</code></pre>
<p>Истинная природа может скрываться в округлении веса до сотой, ради цены:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb348-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb348-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.99</span>, carat <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb348-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(carat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb348-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_price =</span> <span class="kw">mean</span>(price))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   carat mean_price
##   &lt;dbl&gt;      &lt;dbl&gt;
## 1  0.99      4406.
## 2  1         5242.</code></pre>
<p>А может и не скрываться. Эта визуализация показывает пусть и нелинейную но прямопропорциональную зависимость средней цены от веса бриллианта</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb350-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(carat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb350-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_price =</span> <span class="kw">mean</span>(price)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb350-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(mean_price, carat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb350-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-213-1.png" width="672" /></p>
<p>Вероятно бриллианты с “круглыми” каратами более популярны</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb351-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb351-2" data-line-number="2"><span class="st">   </span><span class="kw">filter</span>(carat <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.9</span>, carat <span class="op">&lt;=</span><span class="st"> </span><span class="fl">1.1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb351-3" data-line-number="3"><span class="st">   </span><span class="kw">count</span>(carat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb351-4" data-line-number="4"><span class="st">   </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">30</span>)</a></code></pre></div>
<pre><code>## # A tibble: 21 x 2
##    carat     n
##    &lt;dbl&gt; &lt;int&gt;
##  1  0.9   1485
##  2  0.91   570
##  3  0.92   226
##  4  0.93   142
##  5  0.94    59
##  6  0.95    65
##  7  0.96   103
##  8  0.97    59
##  9  0.98    31
## 10  0.99    23
## 11  1     1558
## 12  1.01  2242
## 13  1.02   883
## 14  1.03   523
## 15  1.04   475
## 16  1.05   361
## 17  1.06   373
## 18  1.07   342
## 19  1.08   246
## 20  1.09   287
## 21  1.1    278</code></pre>
<p>Не то чтобы это правда, но очень на то похоже</p>
</div>
<div id="-7.3.4.4" class="section level4">
<h4><span class="header-section-number">2.5.3.7</span> Упражнение 7.3.4.4</h4>
<div class="question">
<p>Compare and contrast <code>coord_cartesian()</code> vs <code>xlim()</code> or <code>ylim()</code> when zooming in on a histogram. What happens if you leave <code>binwidth</code> unset? What happens if you try and zoom so only half a bar shows?</p>
</div>
<p>Функция <code>coord_cartesian()</code> как бы увеличивает масштаб в указанных координатах</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb353-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(price), <span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb353-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">2000</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-215-1.png" width="672" /></p>
<p>В то время как <code>xlim()</code> удаляет все значение между указанными координатами. О чем <code>R</code> любезно предупреждает при построении графика.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb354-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb354-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="kw">aes</span>(price), <span class="dt">binwidth =</span> <span class="dv">10</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb354-3" data-line-number="3"><span class="st">  </span><span class="kw">xlim</span>(<span class="dv">1000</span>, <span class="dv">2000</span>)</a></code></pre></div>
<pre><code>## Warning: Removed 44232 rows containing non-finite values (stat_bin).</code></pre>
<pre><code>## Warning: Removed 2 rows containing missing values (geom_bar).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-216-1.png" width="672" /></p>
<p>Если не задать аргумент <code>binwidth</code>, то ав</p>
</div>
</div>
<div id="--2" class="section level3">
<h3><span class="header-section-number">2.5.4</span> Отсутствующие значения</h3>
<p>Необычные значения можно:</p>
<ul>
<li>Отбросить, но это плохо</li>
</ul>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" data-line-number="1">diamonds2 &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb357-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">between</span>(y, <span class="dv">3</span>, <span class="dv">20</span>)) <span class="co"># Возьми только значения между 3 и 20 </span></a></code></pre></div>
<ul>
<li>Лучше всего заменить необычные значения отсутствующими. Для замены можно использовать функцию <code>ifelse()</code>. Эта функция и по смыслу и по синтаксису похожа на функцию <code>ЕСЛИ</code> в Excel.</li>
</ul>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb358-1" data-line-number="1">diamonds2 &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st">                   </span><span class="co"># В новый набор данных добавь новую переменную в которой,</span></a>
<a class="sourceLine" id="cb358-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">ifelse</span>(y <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span> <span class="op">|</span><span class="st"> </span>y <span class="op">&gt;</span><span class="st"> </span><span class="dv">20</span>, <span class="ot">NA</span>, y)) <span class="co"># Если значение &quot;y&quot; меньше 3 или больше 20, замени на NA, иначе, оставь их прежними</span></a></code></pre></div>
<p>ВНИМАНИЕ. Это целая философия — отсутствующие значения никогда не должны молчаливо исчезать. Самый приличный и профессиональный метод — продублировать пресловутую переменную и заменить в ней аномальные значения на отсутствующие. Если возникнет необходимость визуализировать эту переменную, легко можно отбросить отсутствующие значения параметром <code>na.rm = TRUE</code></p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb359-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(x,y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb359-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-219-1.png" width="672" /></p>
<div id="-7.3.5.1" class="section level4">
<h4><span class="header-section-number">2.5.4.1</span> Упражнение 7.3.5.1</h4>
<div class="question">
<p>What happens to missing values in a histogram? What happens to missing values in a bar chart? Why is there a difference?</p>
</div>
<p>В гистограмме переменная <code>x</code> должна быть числовой, а <code>stat_bin()</code> группирует наблюдения по диапазонам в ячейки. Поскольку числовое значение наблюдений <code>NA</code> неизвестно, они не могут быть помещены в конкретный столбец и отбрасываются.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb360-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">binwidth =</span> <span class="fl">0.1</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-220-1.png" width="672" /></p>
<p>В функции <code>geom_bar()</code> отсутствующие значения <code>NA</code> рассматриваются как другая категория. Аргумент <code>aes(x)</code> в <code>geom_bar()</code> требует дискретной (категориальной) переменной, а отсутствующие значения действуют как другая категория.</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" data-line-number="1">diamonds2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb361-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb361-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(y))</a></code></pre></div>
<pre><code>## Warning: Removed 9 rows containing non-finite values (stat_count).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-221-1.png" width="672" /></p>
<p>Пример лучше иллюстрирующий сказанное:</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb363-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cut =</span> <span class="kw">if_else</span>(<span class="kw">runif</span>(<span class="kw">n</span>()) <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.1</span>, <span class="ot">NA_character_</span>, <span class="kw">as.character</span>(cut))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb363-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb363-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-222-1.png" width="672" /></p>
</div>
<div id="-7.3.5.2" class="section level4">
<h4><span class="header-section-number">2.5.4.2</span> Упражнение 7.3.5.2</h4>
<div class="question">
<p>What does <code>na.rm = TRUE</code> do in <code>mean()</code> and <code>sum()</code>?</p>
</div>
<p>Аргумент <code>na.rm = TRUE</code> в функциях <code>mean()</code> и <code>sum()</code>, позволяет производить подсчёт не взирая на отсутствующие значения.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb364-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb364-2" data-line-number="2"><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb366-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb366-2" data-line-number="2"><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 25</code></pre>
</div>
</div>
<div class="section level3">
<h3><span class="header-section-number">2.5.5</span> Ковариация</h3>
<p>Ковариация — это тенденция к взаимосвязанному изменению значений двух и более переменных. И конечно лучший способ отследить ковариацию — визуализирвоать переменные.</p>
<div id="---" class="section level4">
<h4><span class="header-section-number">2.5.5.1</span> Категориальные и непрерывные переменные</h4>
<p>При большом разбросе значений, мелкие интересности на фоне больших значений сложно разглядеть. Рассмотрим в качестве примера, как изменяется цена бриллиантов в зависимости от их качества.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb368-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb368-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="kw">aes</span>(<span class="dt">color =</span> cut), <span class="dt">binwidth =</span> <span class="dv">500</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-225-1.png" width="672" /></p>
<p>Увидеть различия в распределении трудно, ввиду больших различий в размерах групп</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb369-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(cut))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-226-1.png" width="672" /></p>
<p>Чтобы облегчить сравнение распределений, необходимо поменять переменную отображаемую по оси <code>y</code>. Для этого воспользуемся стандартизированной количественной характеристикой — плотностью.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb370-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price, <span class="dt">y =</span> ..density..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb370-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="kw">aes</span>(<span class="dt">color =</span> cut), <span class="dt">binwidth =</span> <span class="dv">500</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-227-1.png" width="672" /></p>
<p>И наконец, мы дошли до ящиков с усами. Диаграммы размаха удобно использовать для визуальной экспресс оценки. Напомню что такое ящик с усами</p>
<p><img src="img/boxplot.png" alt="alt text" />
Рассмотрим распределение цены <code>price</code>в замивсимости от качества огранки <code>cut</code>, используя функцию <code>geom_boxplot()</code></p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(cut, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb371-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-228-1.png" width="672" /></p>
<p>Ящики позволяют сравнивать между собой распределения. Очень удачно, что в текущем примере с бриллиантами все классы качества упорядочены по возрастанию качества от <code>Fair</code> удовлетворительного до <code>Ideal</code> идеального. Конечно же не всегда данные так упорядочены, и для того чтобы удобнее и логичнее выстравить построения можно использовать функцию <code>reorder()</code>.</p>
<p>Рассмотрим например переменную <code>class</code>из набора данных про автомобили. Предположим, мы хотим выяснить как меняется показатель расхода топлива <code>hwy</code> в зависимости от класса автомобиля <code>class</code></p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb372-1" data-line-number="1"><span class="kw">ggplot</span>(mpg, <span class="kw">aes</span>(class, hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb372-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-229-1.png" width="672" /></p>
<p>чтобы сделать тренд более наглядным, переставим значения класса, основываясь на медиане значений <code>hwy</code></p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb373-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(</a>
<a class="sourceLine" id="cb373-3" data-line-number="3">   <span class="dt">mapping =</span> <span class="kw">aes</span>(</a>
<a class="sourceLine" id="cb373-4" data-line-number="4">     <span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median), <span class="co"># меняем местами переменные, по возрастанию медианы</span></a>
<a class="sourceLine" id="cb373-5" data-line-number="5">     <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb373-6" data-line-number="6"><span class="st">  </span><span class="kw">coord_flip</span>()                              <span class="co"># поворачиваем на 90 градусов, чтобы поместились надписи</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-230-1.png" width="672" /></p>
</div>
<div id="-7.5.1.1.1" class="section level4">
<h4><span class="header-section-number">2.5.5.2</span> Упражнение 7.5.1.1.1</h4>
<div class="question">
<p>Use what you’ve learned to improve the visualisation of the departure times of cancelled vs. non-cancelled flights.</p>
</div>
<p>Используем построение ящиками с усами, для того чтобы сделать визуализацию нагляднее</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb374-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb374-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">canceled =</span> <span class="kw">is.na</span>(dep_time),  <span class="co"># Добавляем категориальную переменную, FALSE соответствует отменённым рейсам</span></a>
<a class="sourceLine" id="cb374-3" data-line-number="3">         <span class="dt">sched_dep_time_minute =</span> ((sched_dep_time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">*</span><span class="st"> </span><span class="dv">60</span>) <span class="op">+</span><span class="st"> </span>sched_dep_time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Переводим представление даты</span></a>
<a class="sourceLine" id="cb374-4" data-line-number="4"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb374-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> canceled, <span class="dt">y =</span> sched_dep_time_minute))  <span class="co"># Строим ящик с усами</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-231-1.png" width="672" /></p>
</div>
<div id="-7.5.1.1.2" class="section level4">
<h4><span class="header-section-number">2.5.5.3</span> Упражнение 7.5.1.1.2</h4>
<div class="question">
<p>What variable in the <code>diamonds</code> dataset is most important for predicting the price of a diamond? How is that variable correlated with <code>cut</code>? Why does the combination of those two relationships lead to lower quality diamonds being more expensive?</p>
</div>
<p>Хорошо, что в наборе данных <code>diaminds</code> не так много переменных, и все их можно проверить — это займет не так много времени на первый взгляд. Но будем действовать разумнее и отсечём менее информативные показатели. На мой взгляд, с ценой должен хорошо коррелировать параметр <code>carat</code> — это вес алмаза. Так как вес определяется размерами (и ещё плотностью, которой у нас нет), то параметры относящиеся к размеру мы отсекаем. Собственно после этого останется — <code>cut</code>, <code>color</code>, <code>clarity</code>. В итоге четыре параметра для проверки. Начнем с веса.</p>
<p>Обе переменные <code>carat</code> и <code>price</code> непрерывные, для визуализации зависимости нужно будет немного исхитриться. Но для начала покажем на диграмме рассеяния зависимость цены от веса:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb375-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-232-1.png" width="672" /></p>
<p>Как видно с увеличением веса, по какой-то зависимости происходит и увеличение цены, значит мы в верном направлении. Осталось, для визуализации преобразовать непрерывные данные в категориальные. В этом нам поможет аргумент <code>cut_width()</code> — который разрезат весь интервал на участки. Об этом как раз говорилось в начале главы.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb376-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> carat, <span class="dt">y =</span> price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb376-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.2</span>)))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-233-1.png" width="672" /></p>
<p>Этот график нагляднее показывает скорость роста цены от веса бриллианта. От группе к группе — медиана увеличивается, с некоторыми провалами в райое 3.0-3.5 карат. Посмотрим что с другими выбранными для анализа переменными</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(color, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb377-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-234-1.png" width="672" /></p>
<p>Видно что есть некоторый рост цены с изменением цвета от D к J, однако он не такой существенный как рост цены от веса. Посмотрим как изменяется цена в зависимости чистоты бриллианта</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb378-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(clarity, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb378-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-235-1.png" width="672" /></p>
<p>Ясность вообще выглядит удивительно — чем прозрачнее степень бриллианта, тем меньше его средняя цена. Это контринтуитивно, но вероятно этому есть логическое объяснение. В поиски логического объяснения я пока уходить не буду, потому что изменение цены от ясности не такое большое как от веса бриллианта. Поэтому я остановлю свой выбор среди представленных переменных, для лучшего предсказания цены бриллианта на переменной <code>carat</code>.</p>
<p>Теперь посмотрим как <code>carat</code> зависит от <code>cut</code>.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(cut, carat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb379-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-236-1.png" width="672" /></p>
<p>Наблюдается небольшая обратная зависимость — при улучшении качества огранки, немного изменяется цена. Примечательно, что самые большие бриллианты имеют плохую огранку. Это может быть связано с тем, что большие бриллианты это самородки. Маленьким бриллиантам нужно уделить больше внимания, чтобы они выглядели более презентабельно при продаже.</p>
</div>
<div id="-7.5.1.1.3" class="section level4">
<h4><span class="header-section-number">2.5.5.4</span> Упражнение 7.5.1.1.3</h4>
<div class="question">
<p>Install the <code>ggstance</code> package, and create a horizontal boxplot. How does this compare to using <code>coord_flip()</code>?</p>
</div>
<p>Ранее мы использовали поворот системы координат в примере с визуализацией расхода топлива от класса автомобиля.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb380-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb380-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median), </a>
<a class="sourceLine" id="cb380-3" data-line-number="3">                   <span class="dt">y =</span> hwy)) <span class="op">+</span></a>
<a class="sourceLine" id="cb380-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-237-1.png" width="672" /></p>
<p>Для того что сделать горизонтальную диаграмму размаха через функции пакета <code>ggstance</code>, необходимо подключить его и воспользоваться функцией <code>geom_boxploth()</code>.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb381-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ggstance&quot;</span>)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;ggstance&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:ggplot2&#39;:
## 
##     geom_errorbarh, GeomErrorbarh</code></pre>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb384-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb384-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxploth</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),</a>
<a class="sourceLine" id="cb384-3" data-line-number="3">                    <span class="dt">y =</span> hwy))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-238-1.png" width="672" /></p>
<p>Похоже, что эта функция специально предназначена для построения горизонтальных диаграмм размахов (ящиков с усами).</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb385-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxploth</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),</a>
<a class="sourceLine" id="cb385-3" data-line-number="3">                    <span class="dt">x =</span> hwy))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-239-1.png" width="672" /></p>
</div>
<div id="-7.5.1.1.4" class="section level4">
<h4><span class="header-section-number">2.5.5.5</span> Упражнение 7.5.1.1.4</h4>
<div class="question">
<p>One problem with box plots is that they were developed in an era of much smaller datasets and tend to display a prohibitively large number of “outlying values”. One approach to remedy this problem is the letter value plot. Install the <code>lvplot</code> package, and try using <code>geom_lv()</code> to display the distribution of <code>price</code> vs <code>cut</code>. What do you learn?</p>
<p>How do you interpret the plots?</p>
</div>
<p>Ух ты, много раз задумывался о том, что ящики это что-то старенькое, и на них ну уж очень много данных попадает порой в область выбросов. Оказывается это так и есть. Устанавливаем пакет и подключаем библиотеку</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb386-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;lvplot&quot;</span>)</a>
<a class="sourceLine" id="cb386-2" data-line-number="2"></a>
<a class="sourceLine" id="cb386-3" data-line-number="3"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb386-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_lv</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>..LV..))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-240-1.png" width="672" /></p>
<p><a href="https://vita.had.co.nz/papers/letter-value-plot.pdf">В статье</a> объясняются преимущества Side-by-side LV boxplots, а так же показаны примеры и сравнения. Здесь объяснений приводить не буду, ограничусь тем, что скажу что новый вид диаграмм более информативен посравнению с ящиками с усами Джона Тьюки.</p>
</div>
<div id="-7.5.1.1.5" class="section level4">
<h4><span class="header-section-number">2.5.5.6</span> Упражнение 7.5.1.1.5</h4>
<div class="question">
<p>Compare and contrast <code>geom_violin()</code> with a faceted <code>geom_histogram()</code>, or a colored <code>geom_freqpoly()</code>. What are the pros and cons of each method?</p>
</div>
<p>С построением <code>geom_freqpoly()</code> я уже знаком — его основное преимущество это возможность построить на одном графике разными линиями несколько категориальных переменных. При этом можно бегло оценить их распределение и поверхностно сравнить. Основным недостатком является тот факт, что при большой дисперсии выборок, хотя бы в одной переменной, сравнивать более мелкие ковариации становится затруднительно, нужно либо изменять масштаб, либо отбрасывать данные вокруг рассматриваемого участка.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds,<span class="kw">aes</span>(price, ..density..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb387-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">color =</span> cut), <span class="dt">binwidth =</span> <span class="dv">500</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-241-1.png" width="672" /></p>
<p>Гистограммы в панелях тоже интересное решение, когда нужно сравнить распределение и возможные ковариации нескольких переменных. В этом варианте несколько попроще разгядеть зависимости</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb388-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb388-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">ncol =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-242-1.png" width="672" /></p>
<p>Однако и в этом случае, если встречаются разномасштабные данные, для лучшей визуализации необходимо “поиграться” с масштабом. Для этого устанавливается независимый масштаб у переменных</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb390-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb390-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">ncol =</span> <span class="dv">1</span>, <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>)</a></code></pre></div>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-243-1.png" width="672" /></p>
<p>Теперь попробуем построить скрипичный график.</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1"><span class="kw">ggplot</span>(<span class="dt">data =</span> diamonds, <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> cut, <span class="dt">y =</span> price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb392-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_violin</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-244-1.png" width="672" /></p>
<p>Скрипичный график представляет собой компактную визуализацию непрерывного распределения. <a href="http://www.stat.cmu.edu/~rnugent/PCMI2016/papers/ViolinPlots.pdf">Подробнее о построении скрипичного графика</a></p>
</div>
<div id="-7.5.1.1.6" class="section level4">
<h4><span class="header-section-number">2.5.5.7</span> Упражнение 7.5.1.1.6</h4>
<div class="question">
<p>If you have a small dataset, it’s sometimes useful to use <code>geom_jitter()</code> to see the relationship between a continuous and categorical variable. The ggbeeswarm package provides a number of methods similar to geom_jitter(). List them and briefly describe what each one does.</p>
</div>
<p>В описании встретилось два метода</p>
<ul>
<li><p><code>geom_quasirandom()</code> создает графики, которые представляют собой смесь джиттера и скрипки. Существует несколько разных методов, которые точно определяют, как генерируется случайное расположение точек.</p></li>
<li><p><code>geom_beeswarm()</code> создает построение, подобное построению скрипки, но компенсируя точки.</p></li>
</ul>
<p>Вспомним построение язиков для визуализации расхода топлива в зависимости от класса автомобиля</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb393-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb393-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median), </a>
<a class="sourceLine" id="cb393-3" data-line-number="3">                   <span class="dt">y =</span> hwy))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-245-1.png" width="672" /></p>
<p>Теперь построим квазирандомом</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ggbeeswarm&quot;</span>)</a>
<a class="sourceLine" id="cb394-2" data-line-number="2"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb394-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),</a>
<a class="sourceLine" id="cb394-4" data-line-number="4">                                 <span class="dt">y =</span> hwy))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-246-1.png" width="672" /></p>
<p>Эта визуализация похожа на ящики с усами, но по количеству и плотности точек можно нагляднее представить характер распределения.
У этого построения есть несколько методов задания распределения рандомности точек.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb395-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb395-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),</a>
<a class="sourceLine" id="cb395-3" data-line-number="3">                                 <span class="dt">y =</span> hwy),</a>
<a class="sourceLine" id="cb395-4" data-line-number="4">                   <span class="dt">method =</span> <span class="st">&quot;frowney&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-247-1.png" width="672" /></p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb396-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb396-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_quasirandom</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),</a>
<a class="sourceLine" id="cb396-3" data-line-number="3">                                 <span class="dt">y =</span> hwy),</a>
<a class="sourceLine" id="cb396-4" data-line-number="4">                   <span class="dt">method =</span> <span class="st">&quot;smiley&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-248-1.png" width="672" /></p>
<p>Но перейдём теперь к <code>geom_beeswarm()</code></p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" data-line-number="1"><span class="kw">ggplot</span>(mpg) <span class="op">+</span></a>
<a class="sourceLine" id="cb397-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_beeswarm</span>(<span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">reorder</span>(class, hwy, <span class="dt">FUN =</span> median),</a>
<a class="sourceLine" id="cb397-3" data-line-number="3">                                 <span class="dt">y =</span> hwy))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-249-1.png" width="672" /></p>
<p>В принципе у него тоже есть некий алгоритм рандомности, но в общих чертах выглядит похоже на предыдущие построения. У него плотность точек побольше.</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">2.5.5.8</span> Две категориальные переменные</h4>
<p>Порой необходимо проверить как между собой связаны две категориальные переменные. Например когда необходимо установить, какая пара категориальных переменных чаще всего встречается. Для этого можно воспользоваться несколькими способами.</p>
<ul>
<li>Посчитать количество точек попавших в каждую пару внутренней функцией пакета</li>
</ul>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb398-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_count</span>(<span class="kw">aes</span>(cut, color))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-250-1.png" width="672" /></p>
<ul>
<li>Посчитать через <code>dplyr</code></li>
</ul>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb399-1" data-line-number="1">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb399-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(color, cut)</a></code></pre></div>
<pre><code>## # A tibble: 35 x 3
##    color cut           n
##    &lt;ord&gt; &lt;ord&gt;     &lt;int&gt;
##  1 D     Fair        163
##  2 D     Good        662
##  3 D     Very Good  1513
##  4 D     Premium    1603
##  5 D     Ideal      2834
##  6 E     Fair        224
##  7 E     Good        933
##  8 E     Very Good  2400
##  9 E     Premium    2337
## 10 E     Ideal      3903
## # … with 25 more rows</code></pre>
<p>и затем визуализировать</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" data-line-number="1">diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb401-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb401-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> color, <span class="dt">y =</span> cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb401-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb401-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-252-1.png" width="672" /></p>
</div>
<div id="-7.5.2.1.1" class="section level4">
<h4><span class="header-section-number">2.5.5.9</span> Упражнение 7.5.2.1.1</h4>
<div class="question">
<p>How could you rescale the <code>count</code> dataset above to more clearly show the distribution of <code>cut</code> within <code>colour</code>, or <code>colour</code> within <code>cut</code>?</p>
</div>
<p>Сгруппируем по отдельности, сначала по цвету, потом по степени огранки и в каждом случае введём переменную вычисляющую пропорцию. Для того чтобы можно было сравнить в одних условиях.</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb402-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span><span class="st">                        </span><span class="co"># Считаем количество значений в парах</span></a>
<a class="sourceLine" id="cb402-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(color) <span class="op">%&gt;%</span><span class="st">                          </span><span class="co"># Группирупм по цвету</span></a>
<a class="sourceLine" id="cb402-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span><span class="st">                </span><span class="co"># Добавляем переменную, в которой вычисляем пропорцию</span></a>
<a class="sourceLine" id="cb402-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(color, cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb402-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> prop))                  <span class="co"># Делаем заливку введённой переменной</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-253-1.png" width="672" /></p>
<p>Теперь проделаем всё тоже самое, но с группировкой по <code>cut</code></p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb403-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb403-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb403-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(cut) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb403-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb403-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(color, cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb403-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> prop))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-254-1.png" width="672" /></p>
<p>Группировка по цвету имеет более упорядоченный вид.</p>
</div>
<div id="-7.5.2.1.2" class="section level4">
<h4><span class="header-section-number">2.5.5.10</span> Упражнение 7.5.2.1.2</h4>
<div class="question">
<p>Use <code>geom_tile()</code> together with <code>dplyr</code> to explore how average flight delays vary by destination and month of year. What makes the plot difficult to read? How could you improve it?</p>
</div>
<p>Итак, сначала построим распределение средней задержки в разрезе двух категориальных переменных месяца отправки и направлению вылета.</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb404-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb404-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, dest) <span class="op">%&gt;%</span><span class="st">                           </span><span class="co"># Группируем по месяцу и направлению</span></a>
<a class="sourceLine" id="cb404-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Вводим новую переменную, в которой считаем среднее время задержки в группах</span></a>
<a class="sourceLine" id="cb404-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(month, dest)) <span class="op">+</span></a>
<a class="sourceLine" id="cb404-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> mean)) <span class="op">+</span><span class="st">                       </span><span class="co"># Строим диаграмму распределения с заливкой по среднему значению</span></a>
<a class="sourceLine" id="cb404-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Mесяц&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Направление&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Задержка отправления&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-255-1.png" width="672" /></p>
<p>Затрудняет чтение диаграммы отсутствие месяцев. Чтобы представить месяцы в более привычной форме нужно использовать функцию <code>factor()</code>, я пока не знаю как она работает. Но она помогла.</p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb405-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb405-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, dest) <span class="op">%&gt;%</span><span class="st">                           </span></a>
<a class="sourceLine" id="cb405-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb405-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">factor</span>(month), dest)) <span class="op">+</span></a>
<a class="sourceLine" id="cb405-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb405-6" data-line-number="6"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Mесяц&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Направление&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Задержка отправления&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-256-1.png" width="672" /></p>
<p>Мешают отсутсвующие значения. Удалим их.</p>
<p>С этим пришлось повозиться, и сделать необычную конструкцию.
Её суть заключается в том, чтобы отображать на графике только те направления, по которым летали заданное количество месяцев. Нам интересно видеть круглогодично заполненные аэропорты, поэтому зададим количество месяцев равным 12.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb406-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb406-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, dest) <span class="op">%&gt;%</span><span class="st">                           </span></a>
<a class="sourceLine" id="cb406-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb406-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb406-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb406-6" data-line-number="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb406-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">factor</span>(month), dest)) <span class="op">+</span></a>
<a class="sourceLine" id="cb406-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb406-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Mесяц&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Направление&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Задержка отправления&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-257-1.png" width="672" /></p>
<p>Затрудняет алфавитный порядок, поскольку при беглом анализе несколько теряется информативность. Можно сортировать направление вылета не по алфавиту, а по какому-нибудь значимому параметру, например по среднему количеству полётов в году, или по средней задержки. Для того чтобы отсортировать переменную <code>dest</code> необходимо воспользоваться функцией <code>reorder()</code>. Эта функция«по умолчанию» рассматривает свой первый аргумент как категориальную переменную и переупорядочивает его уровни на основе значений второй переменной, обычно числовой, в нашем случае это будет среднегодовое время задержки вылета.</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb407-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, dest) <span class="op">%&gt;%</span><span class="st">                           </span></a>
<a class="sourceLine" id="cb407-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb407-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dest =</span> <span class="kw">reorder</span>(dest, mean)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb407-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb407-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">factor</span>(month), dest)) <span class="op">+</span></a>
<a class="sourceLine" id="cb407-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> mean)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb407-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Mесяц&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Направление&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Задержка отправления&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-258-1.png" width="672" /></p>
</div>
<div id="-7.5.2.1.2-1" class="section level4">
<h4><span class="header-section-number">2.5.5.11</span> Упражнение 7.5.2.1.2</h4>
<div class="question">
<p>Why is it slightly better to use <code>aes(x = color, y = cut)</code> rather than <code>aes(x = cut, y = color)</code> in the example above?</p>
</div>
<p>Всё просто. Ответ лежит в плоскости листа, точнее его ориентации. Дело в том, что чем больше переменных тем хуже воспринимается альбомная ориентация, поэтому рекомендуется параметр с большим количеством переменных распологать по оси абсцис. Не совсем удачно для этой задачи выбран пример, поскольку имена переменных прекрасно укладываются по обеим осям.</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb408-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb408-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb408-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> color, <span class="dt">x =</span> cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb408-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> n))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-259-1.png" width="672" /></p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb409-1" data-line-number="1">diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb409-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(color, cut) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb409-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> cut, <span class="dt">x =</span> color)) <span class="op">+</span></a>
<a class="sourceLine" id="cb409-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_tile</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">fill =</span> n))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-260-1.png" width="672" /></p>
<p>Однако эту ситуацию идеально иллюстрируют предыдущее упражнение, если поменять оси местами, то совершенно невозомжно будет различить какие где аэропорты:</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb410-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, dest) <span class="op">%&gt;%</span><span class="st">                           </span></a>
<a class="sourceLine" id="cb410-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb410-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">==</span><span class="st"> </span><span class="dv">12</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-6" data-line-number="6"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dest =</span> <span class="kw">reorder</span>(dest, mean)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb410-8" data-line-number="8"><span class="st">  </span></a>
<a class="sourceLine" id="cb410-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="kw">factor</span>(month), dest)) <span class="op">+</span></a>
<a class="sourceLine" id="cb410-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> mean)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb410-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Mесяц&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Направление&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;Задержка отправления&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb410-12" data-line-number="12"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-261-1.png" width="672" /></p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">2.5.5.12</span> Две непрерывные переменные</h4>
<p>С одним из способов визуализации двух непрерывных переменных я уже знаком. Это точечная диаграмма рассеяния.</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb411-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb411-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(carat, price))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-262-1.png" width="672" /></p>
<p>Даже при таком построении просматривается экспоненциальный характер связи. Однако большое скопление точек затрудняет восприятие. Частично эту ситуацию может решит введение уже знакомой мне прозрачности</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb412-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb412-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(carat, price), </a>
<a class="sourceLine" id="cb412-3" data-line-number="3">             <span class="dt">alpha =</span> <span class="fl">0.01</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-263-1.png" width="672" /></p>
<p>Однако это не панацея. Чуть более полезное решение — использование карманов (интервалов значений). Так называем карманы создаются с помощью функций <code>geom_bin2d()</code> и <code>geom_hex()</code>. Для использования последней необходимо установить пакет <code>hexbin</code>.</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb413-1" data-line-number="1"><span class="co">#install.packages(&quot;hexbin&quot;)</span></a>
<a class="sourceLine" id="cb413-2" data-line-number="2"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb413-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bin2d</span>(<span class="kw">aes</span>(carat, price))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-264-1.png" width="672" /></p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb414-1" data-line-number="1"><span class="kw">ggplot</span>(smaller) <span class="op">+</span></a>
<a class="sourceLine" id="cb414-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="kw">aes</span>(carat, price))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-265-1.png" width="672" /></p>
<p>Это красиво. Но есть старые добрые методы от Тьюки — ящики с усами.</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb415-1" data-line-number="1"><span class="kw">ggplot</span>(smaller, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb415-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.1</span>)))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-266-1.png" width="672" /></p>
<p>Однако ящики с усами имеют один и тот же внешний вид, за исключением количества выбросов, независимо от количества наблюдений, которым они соответствуют. ПОэтому судить о том , какое количество наблюдений просуммировано в каждом кармане очень трудно. ОДин из способов сделать это возможным заключается в использовании карманов, ширина которых пропорциональна количеству точек данных <code>varwidth = TRUE</code></p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb416-1" data-line-number="1"><span class="kw">ggplot</span>(smaller, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb416-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.1</span>)),</a>
<a class="sourceLine" id="cb416-3" data-line-number="3">               <span class="dt">varwidth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-267-1.png" width="672" /></p>
<p>Не очень наглядно, но говорят иногда выручает. Ещё один способ, заключается в том, чтобы отражать примерно одно и то же количество точек в каждом кармане. Это делается с помощью функции <code>cut_number()</code></p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1"><span class="kw">ggplot</span>(smaller, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb417-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_number</span>(carat, <span class="dv">20</span>)))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-268-1.png" width="672" /></p>
</div>
<div id="-7.5.3.1.1" class="section level4">
<h4><span class="header-section-number">2.5.5.13</span> Упражнение 7.5.3.1.1</h4>
<div class="question">
<p>Instead of summarizing the conditional distribution with a box plot, you could use a frequency polygon. What do you need to consider when using <code>cut_width()</code> vs <code>cut_number()</code>? How does that impact a visualization of the 2d distribution of <code>carat</code> and <code>price</code>?</p>
</div>
<p>Принимая решение о том какую из функций использовать, необходимо учитывать следующие факторы</p>
<ul>
<li><p>При использовании <code>cut_width()</code> необходимо указать ширину просматриваемого диапазона.</p></li>
<li><p>При использовании <code>cut_number()</code> необходимо указать количество ящиков, которое необходимо построить.</p></li>
</ul>
</div>
<div id="-7.5.3.1.2" class="section level4">
<h4><span class="header-section-number">2.5.5.14</span> Упражнение 7.5.3.1.2</h4>
<div class="question">
<p>Visualize the distribution of <code>carat</code>, partitioned by <code>price</code>.</p>
</div>
<p>Как я понял это задание — нужно сгруппировать данные в ящиках по переменной <code>price</code>. Это означает, что нужно указать группировку либо по количеству ящиков, которые будем строить, т.е.<code>cut_number()</code>. Сначала я построил вот такое распределение.</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(price, carat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb418-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_number</span>(price, <span class="dv">10</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb418-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-269-1.png" width="672" /></p>
<p>Здесь построено 10 ящиков сгруппированных по переменной <code>price</code>, с примерно одним количеством точек в кармане или диапазоне. В принципе подобное же решение но с группировкой по переменной <code>carat</code> приведена в учебнике. Меня смущает здесь тот факт, что столбцы ящиков с усами имеют разную ширину хотя они и показывают количество точек попавших в карман. Чтобы построить ящики равной ширины и при этом отобразить количество точек попавших в наблюдение, можно убрать группировку при построении оставив только функцию <code>cut_number</code></p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="kw">cut_number</span>(price, <span class="dv">10</span>), carat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb419-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb419-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-270-1.png" width="672" /></p>
<p>Как видно такое построение не повлияло на характер распределения, однако сделало визуализацию чуть более аккуратной. Такой подход ситуативен, потому что повторюсь — первый вариант даёт наглядное представление о количестве точек, попавших в карман.</p>
</div>
<div id="-7.5.3.1.3" class="section level4">
<h4><span class="header-section-number">2.5.5.15</span> Упражнение 7.5.3.1.3</h4>
<div class="question">
<p>How does the <code>price</code> distribution of very large diamonds compare to small diamonds. Is it as you expect, or does it surprise you?</p>
</div>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" data-line-number="1"><span class="kw">ggplot</span>(smaller, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb420-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.1</span>)),</a>
<a class="sourceLine" id="cb420-3" data-line-number="3">               <span class="dt">varwidth =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-271-1.png" width="672" /></p>
<p>Как видно из распределения более тяжёлые бриллианты имеют больший межквартильный размах, это говорит о том, что плотность данных не высокая и в нутри выборки в пределах одного веса происходят большие флуктуации — начиная с веса в один карат и выше, размах составляет от 5000 долларов за единицу веса. При этом чем меньше вес бриллианта, тем большая плотность цены у бриллиантов.</p>
<p>По началу меня это удивило. Но если брать в расчёт ранее полученную информацию о прозрачности и цвете бриллиантов, то становится ясно, что чем меньше бриллиант, тем идеальнее он должен быть, чтобы его продать. Большой самородок проще продать, даже если он имеют не идеальные цвет, качество огранки и прозрачность.</p>
</div>
<div id="-7.5.3.1.4" class="section level4">
<h4><span class="header-section-number">2.5.5.16</span> Упражнение 7.5.3.1.4</h4>
<div class="question">
<p>Combine two of the techniques you’ve learned to visualize the combined distribution of <code>cut</code>, <code>carat</code>, and <code>price</code>.</p>
</div>
<p>Попробуем несколько способов визуализации указанных переменных. Один из первых — это объединение панелями.</p>
<p>Уже на этом этапе понятно, что интерпритируемость некоторых вариантов значительно хуже других.</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb421-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_width</span>(carat, <span class="fl">0.5</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb421-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-272-1.png" width="672" /></p>
<p>Построение в панелях ящиков с усами, даёт некоторое представление о взаимном распределении переменных, однако на сравнение необходимо затратить некоторое время. Чуть более интересную визуализацию панелями даёт построение шестигранных диаграмм</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb422-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_hex</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb422-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>cut, <span class="dt">nrow =</span> <span class="dv">2</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-273-1.png" width="672" /></p>
<p>Следующий способ — построить ящики с усами, разбить просматриваемый диапазон на равное количество карманов, и в каждом диапазоне разбить один ящик на несколько, согласно категориальной переменной. Так как категориальная переменная одна <code>cut</code>, то в зависимости от того, распределение какой переменной мы хотим изучить, будем создавать карманы либо по весу</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">cut_number</span>(carat, <span class="dv">6</span>), <span class="dt">y =</span> price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb423-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">color =</span> cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb423-3" data-line-number="3"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;carat&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-274-1.png" width="672" /></p>
<p>Либо по цене</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">cut_number</span>(price, <span class="dv">6</span>), <span class="dt">y =</span> carat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">color =</span> cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb424-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb424-4" data-line-number="4"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;price&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-275-1.png" width="672" /></p>
</div>
<div id="-7.5.3.1.5" class="section level4">
<h4><span class="header-section-number">2.5.5.17</span> Упражнение 7.5.3.1.5</h4>
<div class="question">
<p>Two dimensional plots reveal outliers that are not visible in one dimensional plots. For example, some points in the plot below have an unusual combination of <code>x</code> and <code>y</code> values, which makes the points outliers even though their <code>x</code> and <code>y</code> values appear normal when examined separately.</p>
</div>
<p>Почему в данном случае легче заметить необычные точки на диаграмме рассеяния, чем на диаграмме использующей карманы.</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb425-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb425-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">11</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">11</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-276-1.png" width="672" /></p>
<p>Потому что при построении ящиков или диаграмм с карманами, интересующие нас точки попадая в карман могут во-первых наклыдваться друг на друга.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb426-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">cut_number</span>(x, <span class="dv">10</span>), <span class="dt">y =</span> y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb426-3" data-line-number="3"><span class="st">   </span><span class="kw">coord_cartesian</span>(<span class="dt">xlim =</span> <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">11</span>), <span class="dt">ylim =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">11</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-277-1.png" width="672" /></p>
</div>
</div>
<div id="----" class="section level3">
<h3><span class="header-section-number">2.5.6</span> Шаблоны поведения переменных и модели</h3>
<p>Если в поведении двух перменных наблюдается систематическая закономерность, то это может свидетельствовать о наличии устойчивой связи между данными. Как только я замечаю какую-либо закономерность, мне следует задать себе примерно такие вопросы:</p>
<ul>
<li><p>Может ли эта закономерность быть лишь кажущейся, другими словами — не обусловлена ли она случайным совпадением?</p></li>
<li><p>Как можно описать отношение между переменными, которое следует из наблюдаемой закономерности?</p></li>
<li><p>Насколько сильна связь между переменными, которую можно предпологать, исходя из наблюдаемой закономерности?</p></li>
<li><p>Какие другие пременные могут оказывать влияние на отношение между данными переменными?</p></li>
<li><p>Изменяется ли это отношение при переходе к рассмотрению отдельных подгрупп данных?</p></li>
</ul>
<p>Возьмём к примеру, извержения гейзера.</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" data-line-number="1"><span class="kw">ggplot</span>(faithful) <span class="op">+</span></a>
<a class="sourceLine" id="cb427-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(eruptions, waiting))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-278-1.png" width="672" /></p>
<p>Видно, что чем больше задержка перед извержением, тем дольше длится это извержение. Кроме этого, на графике отчётличво просматриваются два кластера.</p>
<ul>
<li><p>Вариация — явление, создающее неопредлённость.</p></li>
<li><p>Ковариация — это явление, уменьшающее неопрделённость.</p></li>
</ul>
<p>Если между переменными существует ковариация, то значения одной переменной могут быть использованы для предсказания или улучшения предсказания другой переменной. Есть особые случаи — когда ковариация обсуловлена причинно-следственной связью, тогда значения одной пременной могут быть испрльзованы для управления значениями другой переменной.</p>
<p>Модели — это инструмент используемый для выявления закономерностей в поведении данных. Вернёмся снова к бриллиантам.</p>
<p>Понять природу отношения между переменными <code>cut</code>, <code>carat</code>, <code>price</code> не легко потому что они тесно связаны между собой.
МОжно использовать модель, которая исключает влияегие очень сильной связи между переменными <code>carat</code> и <code>price</code> и тем самым предоставляет возможность ислледовать более тонкие детали.</p>
<p>Приведённый ниже код соответствует модели, которая предсказывает ЦЕНУ по ВЕСУ, а затем вычисляет остатки (то есть разницу между предсказанием и фактическим значением). Остатки дают представление о цене бриллиантов после исключения из неё влияния веса.</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" data-line-number="1"><span class="kw">library</span>(modelr)</a>
<a class="sourceLine" id="cb428-2" data-line-number="2"></a>
<a class="sourceLine" id="cb428-3" data-line-number="3">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(<span class="kw">log</span>(price) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(carat), <span class="dt">data =</span> diamonds)</a>
<a class="sourceLine" id="cb428-4" data-line-number="4"></a>
<a class="sourceLine" id="cb428-5" data-line-number="5">diamonds2 &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb428-6" data-line-number="6"><span class="st">  </span><span class="kw">add_residuals</span>(mod) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb428-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid =</span> <span class="kw">exp</span>(resid))</a>
<a class="sourceLine" id="cb428-8" data-line-number="8">  </a>
<a class="sourceLine" id="cb428-9" data-line-number="9"><span class="kw">ggplot</span>(diamonds2) <span class="op">+</span></a>
<a class="sourceLine" id="cb428-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(carat, resid))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-279-1.png" width="672" /></p>
<p>О том как работает этот код мы узнаем позже, пока важно ухватить суть — исключив влияние сильной взаимосвязи переменных <code>carat</code> и <code>price</code> мы видим, что соотношение между переменными <code>cut</code> и <code>price</code> соответствует ожидаемому. Для алмазов сравнимого размера, более высокому качеству соответствует более высокая цена.</p>
<p>Данные без применения модели</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds) <span class="op">+</span></a>
<a class="sourceLine" id="cb429-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(cut, price))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-280-1.png" width="672" /></p>
<p>Данные, полсе применения модели</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2) <span class="op">+</span></a>
<a class="sourceLine" id="cb430-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(cut, resid))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-281-1.png" width="672" /></p>
</div>
<div id="--ggplot" class="section level3">
<h3><span class="header-section-number">2.5.7</span> Вызов функций <code>ggplot</code></h3>
<p>В этой главе рассказано, что у некоторых функций есть короткая запись.
К моменту прочтения этой главы, я уже догадался об этом и использовал ранее в решениях.</p>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">2.5.8</span> Дополнительная информация</h3>
<p>Несколько хороших книг по пройденному материалу</p>
<ul>
<li><p><a href="https://www.amazon.com/dp/1498715230/ref=cm_sw_su_dp">Graphical Data Analysis with R (Chapman &amp; Hall/CRC The R Series)</a></p></li>
<li><p><a href="https://www.amazon.com/dp/1449316956/ref=cm_sw_su_dp">R Graphics Cookbook</a></p></li>
<li><p><a href="https://www.amazon.com/dp/331924275X/ref=cm_sw_su_dp">ggplot2: Elegant Graphics for Data Analysis (Use R!)</a></p></li>
</ul>
<!--chapter:end:05_exploratory_data_analysis.Rmd-->
</div>
</div>
<div id="---" class="section level2">
<h2><span class="header-section-number">2.6</span> Организация рабочего процесса: проекты</h2>
<div id="---" class="section level3">
<h3><span class="header-section-number">2.6.1</span> Что является вашим достоянием</h3>
<ol style="list-style-type: decimal">
<li><p>Это конечно среда, где хранятся данные — список Envirinment</p></li>
<li><p>Но в первую очередь это конечно скрипты.</p></li>
</ol>
<p>В принципе, то что я фиксирую свои ответы в книге — это уже хорошо.
Есть конечно большая задача по тому, чтобы изучить как работает букдаун, чтобы понять как это дело работает.
Однако, меня это уже мало по-малу приучает к тому, чтобы работать скриптами.</p>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Где находится ваш анализ</h3>
<p>В каталогах. Чтобы проверить можно воспользоваться командой <code>getwd()</code></p>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">2.6.3</span> Пути и каталоги</h3>
<ul>
<li>Необходимо помнить что разделителем В Windows — является обратная косая черта (‘'). А в Mac прямая — (’/’). НАм рекомендуют использовать стиль Mac.</li>
</ul>
</div>
<div id="-rstudio" class="section level3">
<h3><span class="header-section-number">2.6.4</span> Проекты RStudio</h3>
<p>Начиная работу с этой книгой, я заглянул вперёд и предусмотрительно создал проект.
А если сохранять графики и данные консольным способом, то при поиске в системе помимо найденного объекта, будет находится ещё и скрипт, который сохранил его. Это поистине чудо!!!</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb431-2" data-line-number="2"></a>
<a class="sourceLine" id="cb431-3" data-line-number="3"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span></a>
<a class="sourceLine" id="cb431-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_hex</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-282-1.png" width="672" /></p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1"><span class="kw">ggsave</span>(<span class="st">&quot;diamonds.pdf&quot;</span>)</a></code></pre></div>
<pre><code>## Saving 7 x 5 in image</code></pre>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1"><span class="kw">write_csv</span>(diamonds, <span class="st">&quot;diamonds.csv&quot;</span>)</a></code></pre></div>
</div>
<div class="section level3">
<h3><span class="header-section-number">2.6.5</span> Резюме</h3>
<p>Ниже приведен краткий перечень тех возможностей работы с R-кодом, который предлагает RStudio:</p>
<ul>
<li><p>Создавать проект RStudio для каждого проекта анализа</p></li>
<li><p>Хранить в проекте файлы данных.</p></li>
<li><p>Хранить в проекте скрипты, редактировать их и выполнять по частям или целиком</p></li>
<li><p>Сохранять в проекте свои выходные результаты (графики и очищенные данные)</p></li>
<li><p>использовать только относительные пути, а не абсолютные</p></li>
</ul>
<p>Всё необходимое будет собрано в одном месте и отделено от других проектов с которымт я буду работать.</p>
<p>Говоря словами Эрика Картмана — ЩЩЩЩикарна!</p>
<!--chapter:end:06_workflow_projects.Rmd-->
</div>
</div>
</div>
<div id="-" class="section level1">
<h1><span class="header-section-number">3</span> Подготовка данных</h1>
<p>В этой части я узнаю о подготовке данных — искусстве приведения исходных данных к виде, обеспечивающему возможность их визуализации и моделировании в среде R.</p>
<p>Без подготовки нельзя работать с данными. Это огромный пласт, который необходимо освоить</p>
<div id="-tibble-----tibble" class="section level2">
<h2><span class="header-section-number">3.1</span> Создание tibble-фреймов с помощью пакета <code>tibble</code></h2>
<div id="-4" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Введение</h3>
<p>На протяжении всей книги, мы будем работать не с традиционными фреймами данных R (<code>data.frame</code>), а с так называемыми tibble-фреймами.</p>
<p>Так как R старенький язык, в нём многое устарело, но чтобы революционно что-то менять нужно потрать много времени, поэтому большая часть полезных функций реализуется пакетами. Это касается и фреймов данных, встроенный стандартный <code>data.frame</code> как говорят, не всегда удобный. Поэто при помощи пакета <code>tibble</code> реализовали возможность работать с упрощённой формой фреймов данных.</p>
<p>Получить более подробную информацию можно по команде <code>vignette(&quot;tibble&quot;)</code></p>
<div id="--1" class="section level4">
<h4><span class="header-section-number">3.1.1.1</span> Необходимые ресурсы</h4>
<p>Пакет <code>tibble</code> является частью ядра библиотеки <code>tidyverse</code>.</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb435-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;viridis&quot;</span>)</a>
<a class="sourceLine" id="cb435-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</a>
<a class="sourceLine" id="cb435-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;nycflights13&quot;</span>)</a>
<a class="sourceLine" id="cb435-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;Lahman&quot;</span>)</a>
<a class="sourceLine" id="cb435-6" data-line-number="6"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="-tibble-" class="section level3">
<h3><span class="header-section-number">3.1.2</span> Создание tibble-фреймов</h3>
<p>Многие пакеты на выходе создают стандартный <code>data.frame</code>, частенько нужно будет приводить такие данные к виду тиббл. Это можно делать при помощи функции <code>as_tibble()</code></p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1"><span class="kw">as_tibble</span>(iris)</a></code></pre></div>
<pre><code>## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;  
##  1          5.1         3.5          1.4         0.2 setosa 
##  2          4.9         3            1.4         0.2 setosa 
##  3          4.7         3.2          1.3         0.2 setosa 
##  4          4.6         3.1          1.5         0.2 setosa 
##  5          5           3.6          1.4         0.2 setosa 
##  6          5.4         3.9          1.7         0.4 setosa 
##  7          4.6         3.4          1.4         0.3 setosa 
##  8          5           3.4          1.5         0.2 setosa 
##  9          4.4         2.9          1.4         0.2 setosa 
## 10          4.9         3.1          1.5         0.1 setosa 
## # … with 140 more rows</code></pre>
<p>Можно создавать тиббл формат самому при помощи функции <code>tibble()</code></p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb438-2" data-line-number="2">  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb438-3" data-line-number="3">  <span class="dt">y =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb438-4" data-line-number="4">  <span class="dt">z =</span> x <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb438-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##       x     y     z
##   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1     2
## 2     2     1     5
## 3     3     1    10
## 4     4     1    17
## 5     5     1    26</code></pre>
<p>Тиббл не изменяет тип входных данных, не преобразует строки в факторы, не изменяет имена переменных и не создаёт имена строк.</p>
<p>Можно создавать “несистемные” имена столбцов — начинать с символов, пробелов, знаков.</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">(tb &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb440-2" data-line-number="2">  <span class="st">`</span><span class="dt">:)</span><span class="st">`</span> =<span class="st"> &quot;smile&quot;</span>, </a>
<a class="sourceLine" id="cb440-3" data-line-number="3">  <span class="st">`</span><span class="dt"> </span><span class="st">`</span> =<span class="st"> &quot;space&quot;</span>,</a>
<a class="sourceLine" id="cb440-4" data-line-number="4">  <span class="st">`</span><span class="dt">2000</span><span class="st">`</span> =<span class="st"> &quot;number&quot;</span></a>
<a class="sourceLine" id="cb440-5" data-line-number="5">)) </a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   `:)`  ` `   `2000`
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 smile space number</code></pre>
<p>Чтобы задать непростое имя, следует, как видно выше, воспользоваться обратными апострофами. Точно такими же, которые открывают/закрывают чанк.</p>
<p>Еще один способ задавать тиббл-фреймы. Пока не понятно зачем, но можно задавать следующим образом</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1"><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb442-2" data-line-number="2">  <span class="op">~</span>x, <span class="op">~</span>y, <span class="op">~</span>z,</a>
<a class="sourceLine" id="cb442-3" data-line-number="3">  <span class="co">#--|--|----</span></a>
<a class="sourceLine" id="cb442-4" data-line-number="4">  <span class="st">&quot;a&quot;</span>, <span class="dv">2</span>, <span class="fl">3.6</span>,</a>
<a class="sourceLine" id="cb442-5" data-line-number="5">  <span class="st">&quot;b&quot;</span>, <span class="dv">1</span>, <span class="fl">8.5</span></a>
<a class="sourceLine" id="cb442-6" data-line-number="6">)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   x         y     z
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a         2   3.6
## 2 b         1   8.5</code></pre>
</div>
<div id="-tibble----data.frame" class="section level3">
<h3><span class="header-section-number">3.1.3</span> Сравнение tibble-фреймов с фреймами <code>data.frame</code></h3>
<p>Различия двух типов касаются двух, описанных ниже операций</p>
<div id="--" class="section level4">
<h4><span class="header-section-number">3.1.3.1</span> Вывод на печать</h4>
<p>Tibble-фреймы спроектированы таким образом, чтобы случайно не перезагрузить консоль выводом данных. Они выводят на экран первые десять строк таблицы и столько столбцов, сколько поместится на экран. Это великое благо.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb444-2" data-line-number="2">  <span class="dt">a =</span> lubridate<span class="op">::</span><span class="kw">now</span>() <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="fl">1e3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">86400</span>,</a>
<a class="sourceLine" id="cb444-3" data-line-number="3">  <span class="dt">b =</span> lubridate<span class="op">::</span><span class="kw">today</span>() <span class="op">+</span><span class="st"> </span><span class="kw">runif</span>(<span class="fl">1e3</span>) <span class="op">*</span><span class="st"> </span><span class="dv">30</span>,</a>
<a class="sourceLine" id="cb444-4" data-line-number="4">  <span class="dt">c =</span> <span class="dv">1</span><span class="op">:</span><span class="fl">1e3</span>,</a>
<a class="sourceLine" id="cb444-5" data-line-number="5">  <span class="dt">d =</span> <span class="kw">runif</span>(<span class="fl">1e3</span>),</a>
<a class="sourceLine" id="cb444-6" data-line-number="6">  <span class="dt">e =</span> <span class="kw">sample</span>(letters, <span class="fl">1e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb444-7" data-line-number="7">)</a></code></pre></div>
<pre><code>## # A tibble: 1,000 x 5
##    a                   b              c     d e    
##    &lt;dttm&gt;              &lt;date&gt;     &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;
##  1 2019-07-31 09:49:17 2019-08-08     1 0.293 d    
##  2 2019-07-31 21:16:19 2019-08-20     2 0.817 v    
##  3 2019-07-30 23:20:02 2019-08-10     3 0.358 t    
##  4 2019-07-31 01:00:42 2019-08-12     4 0.856 m    
##  5 2019-07-31 05:55:08 2019-08-16     5 0.951 g    
##  6 2019-07-31 03:38:21 2019-08-04     6 0.765 b    
##  7 2019-07-31 18:51:14 2019-08-19     7 0.548 d    
##  8 2019-07-31 13:57:33 2019-08-27     8 0.640 v    
##  9 2019-07-31 00:05:59 2019-08-06     9 0.322 q    
## 10 2019-07-31 12:08:33 2019-08-03    10 0.183 p    
## # … with 990 more rows</code></pre>
<p>Полезной фичей иногда бывает указать напрямую сколько нужно отображать строк.</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1">nycflights13<span class="op">::</span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb446-2" data-line-number="2"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">width =</span> <span class="ot">Inf</span>) <span class="co"># Параметр width = Inf указывает что выводить нужно все столбцы</span></a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
##    sched_arr_time arr_delay carrier flight tailnum origin dest  air_time
##             &lt;int&gt;     &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt;
##  1            819        11 UA        1545 N14228  EWR    IAH        227
##  2            830        20 UA        1714 N24211  LGA    IAH        227
##  3            850        33 AA        1141 N619AA  JFK    MIA        160
##  4           1022       -18 B6         725 N804JB  JFK    BQN        183
##  5            837       -25 DL         461 N668DN  LGA    ATL        116
##  6            728        12 UA        1696 N39463  EWR    ORD        150
##  7            854        19 B6         507 N516JB  EWR    FLL        158
##  8            723       -14 EV        5708 N829AS  LGA    IAD         53
##  9            846        -8 B6          79 N593JB  JFK    MCO        140
## 10            745         8 AA         301 N3ALAA  LGA    ORD        138
##    distance  hour minute time_hour          
##       &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;             
##  1     1400     5     15 2013-01-01 05:00:00
##  2     1416     5     29 2013-01-01 05:00:00
##  3     1089     5     40 2013-01-01 05:00:00
##  4     1576     5     45 2013-01-01 05:00:00
##  5      762     6      0 2013-01-01 06:00:00
##  6      719     5     58 2013-01-01 05:00:00
##  7     1065     6      0 2013-01-01 06:00:00
##  8      229     6      0 2013-01-01 06:00:00
##  9      944     6      0 2013-01-01 06:00:00
## 10      733     6      0 2013-01-01 06:00:00
## # … with 3.368e+05 more rows</code></pre>
<p>КРоме того можно управлять поведением при печати заданным по умолчанию, с помощью группы настроек <code>options</code></p>
<ul>
<li><p><code>options(tibble.print_max = n, tibble.print_min = m)</code>: если количество строк больше <code>m</code> вывести на печать лишь <code>n</code> строк. Чтобы всегда отображались все строки, используй вариант <code>ooptions(dplyr.print_min = Inf)</code></p></li>
<li><p>Чтобы всегда выводить на печать все столбцы, независимо от ширины экрана, используй <code>options(tibble.width = Inf)</code></p></li>
</ul>
<p>полный список возможных опций <code>packege?tibble</code>.</p>
<p>МОжно воспользоваться встроенным средством просмотра</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" data-line-number="1"><span class="co">#nycflights13::flights %&gt;% </span></a>
<a class="sourceLine" id="cb448-2" data-line-number="2"><span class="co">#  View()</span></a></code></pre></div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.1.3.2</span> Извлечение поднаборов</h4>
<p>Если требуется извлечь одну переменную необходимо использовать операторы <code>$</code> и <code>[[</code>. Последний обеспечивает доступ к элементам по имени и по индексу, <code>$</code> — только по имени, но требует ввода меньше символов.</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb449-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">5</span>),</a>
<a class="sourceLine" id="cb449-3" data-line-number="3">  <span class="dt">y =</span> <span class="kw">rnorm</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb449-4" data-line-number="4">)</a></code></pre></div>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1"><span class="co"># Извлечение элемента по имени</span></a>
<a class="sourceLine" id="cb450-2" data-line-number="2">df<span class="op">$</span>x</a></code></pre></div>
<pre><code>## [1] 0.1563221 0.2535057 0.7987104 0.9108223 0.8305887</code></pre>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1">df[[<span class="st">&quot;x&quot;</span>]]</a></code></pre></div>
<pre><code>## [1] 0.1563221 0.2535057 0.7987104 0.9108223 0.8305887</code></pre>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1"><span class="co"># Извлечение элемента по индексу</span></a>
<a class="sourceLine" id="cb454-2" data-line-number="2">df[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] 0.1563221 0.2535057 0.7987104 0.9108223 0.8305887</code></pre>
<p>Применение этих операций в канале требует специального заместитеоя (<code>.</code>)</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span>.<span class="op">$</span>x</a></code></pre></div>
<pre><code>## [1] 0.1563221 0.2535057 0.7987104 0.9108223 0.8305887</code></pre>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] 0.1563221 0.2535057 0.7987104 0.9108223 0.8305887</code></pre>
<p>По сравнению с <code>data.frame</code> tibble-фреймы обладают большей строгостью — они никогда не удовлетворяют частичным соответствиям и генерируют сообщение об ошибке, если столбец, к которому пробуют получить доступ не существует.</p>
</div>
</div>
<div id="----" class="section level3">
<h3><span class="header-section-number">3.1.4</span> Взаимодействие с разработанным ранее кодом</h3>
<p>Некоторые функции не работают с tibble-фреймами, для таких функций необходимо перевести tibble обратно в <code>data.frame</code> с помощью функции <code>as.data.frame()</code></p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1"><span class="kw">class</span>(<span class="kw">as.data.frame</span>(tb))</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div id="-10.6.1" class="section level4">
<h4><span class="header-section-number">3.1.4.1</span> Упражнение 10.6.1</h4>
<div class="question">
<p>How can you tell if an object is a tibble? (Hint: try printing mtcars, which is a regular data frame).</p>
</div>
<p>Для начала выведем привычный tibble-frame</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" data-line-number="1">diamonds</a></code></pre></div>
<pre><code>## # A tibble: 53,940 x 10
##    carat cut       color clarity depth table price     x     y     z
##    &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 0.23  Ideal     E     SI2      61.5    55   326  3.95  3.98  2.43
##  2 0.21  Premium   E     SI1      59.8    61   326  3.89  3.84  2.31
##  3 0.23  Good      E     VS1      56.9    65   327  4.05  4.07  2.31
##  4 0.290 Premium   I     VS2      62.4    58   334  4.2   4.23  2.63
##  5 0.31  Good      J     SI2      63.3    58   335  4.34  4.35  2.75
##  6 0.24  Very Good J     VVS2     62.8    57   336  3.94  3.96  2.48
##  7 0.24  Very Good I     VVS1     62.3    57   336  3.95  3.98  2.47
##  8 0.26  Very Good H     SI1      61.9    55   337  4.07  4.11  2.53
##  9 0.22  Fair      E     VS2      65.1    61   337  3.87  3.78  2.49
## 10 0.23  Very Good H     VS1      59.4    61   338  4     4.05  2.39
## # … with 53,930 more rows</code></pre>
<p>Каждый столбец подписан типом данных — это удобно.</p>
<p>Теперь выводим на печать объект <code>data.frame</code></p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" data-line-number="1">mtcars</a></code></pre></div>
<pre><code>##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</code></pre>
<p>Вторым отличием является наличие именованных строк</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" data-line-number="1"><span class="kw">as_tibble</span>(mtcars)</a></code></pre></div>
<pre><code>## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # … with 22 more rows</code></pre>
<p>Такой способ узнать тип объекта, но является трудоемким. Для быстрой проверки типа объекта существует функция <code>class()</code></p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" data-line-number="1"><span class="kw">class</span>(mtcars)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" data-line-number="1"><span class="kw">class</span>(diamonds)</a></code></pre></div>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>Если объект типа <code>data.frame</code>, то результатом запроса <code>class()</code> будет <code>&quot;data.frame&quot;</code>. Если объект класса tibble, то результатом будет <code>&quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></p>
<p>Больше информации в источнике <a href="http://adv-r.had.co.nz/S3.html">R для продвинутых</a></p>
</div>
<div id="-10.6.2" class="section level4">
<h4><span class="header-section-number">3.1.4.2</span> Упражнение 10.6.2</h4>
<div class="question">
<p>Compare and contrast the following operations on a data.frame and equivalent tibble. What is different? Why might the default data frame behaviors cause you frustration?</p>
</div>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">abc =</span> <span class="dv">1</span>, <span class="dt">xyz =</span> <span class="st">&quot;a&quot;</span>, <span class="dt">yxq =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb472-2" data-line-number="2">df<span class="op">$</span>x</a></code></pre></div>
<pre><code>## [1] a
## Levels: a</code></pre>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1">df[, <span class="st">&quot;xyz&quot;</span>]</a></code></pre></div>
<pre><code>## [1] a
## Levels: a</code></pre>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1">df[, <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>)]</a></code></pre></div>
<pre><code>##   abc xyz
## 1   1   a</code></pre>
<p>В первом примере, я его немного расширил — программа возвращает содержимое столбца, который первый соответствует заданному параметру поиска. Т.е. первый столбец который содержит в названии <code>x</code></p>
<p>Итак сопоставляем. Для начала меняем тип данных на тиббл</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1">tbl &lt;-<span class="st"> </span><span class="kw">as.tibble</span>(df)</a></code></pre></div>
<pre><code>## Warning: `as.tibble()` is deprecated, use `as_tibble()` (but mind the new semantics).
## This warning is displayed once per session.</code></pre>
<p>Пример 1. Так как tibble очень требователен и имеет строгую нотацию, то в ответ на поиск заданного вектора, он ответит что не знает такого. С одной стороны это помогает экономить несколько нажатий клавиш, но с другой стороны это может стать причиной ошибки — потому что могла иметься в виду другая переменная</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb480-1" data-line-number="1">tbl<span class="op">$</span>x</a></code></pre></div>
<pre><code>## Warning: Unknown or uninitialised column: &#39;x&#39;.</code></pre>
<pre><code>## NULL</code></pre>
<p>Пример 2. <code>data.frame</code>возвращает толькол значение указанношго аргумента. В то время как tibble возвращает полностью столбец.</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1">tbl[, <span class="st">&quot;xyz&quot;</span>]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   xyz  
##   &lt;fct&gt;
## 1 a</code></pre>
<p>Пример 3. С больше чем с одной колонкой при использовании <code>data.frame</code>, программа возвращает <code>data.frame</code>, но если колонка одна, то возвращается вектор. Вроде бы это прекрасно, но с другой стороны нужно предусматривать в случае чего такие ситуации в своём коде, а это чревато ошибкой.</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb485-1" data-line-number="1">tbl[, <span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;xyz&quot;</span>)]</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##     abc xyz  
##   &lt;dbl&gt; &lt;fct&gt;
## 1     1 a</code></pre>
</div>
<div id="-10.6.3" class="section level4">
<h4><span class="header-section-number">3.1.4.3</span> Упражнение 10.6.3</h4>
<div class="question">
<p>If you have the name of a variable stored in an object, e.g. <code>var &lt;- &quot;mpg&quot;</code>, how can you extract the reference variable from a tibble?</p>
</div>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb487-1" data-line-number="1">var &lt;-<span class="st"> &quot;mpg&quot;</span></a>
<a class="sourceLine" id="cb487-2" data-line-number="2"></a>
<a class="sourceLine" id="cb487-3" data-line-number="3"><span class="co"># Используем двойные скобки, чтобы вытащить содержимое переменной</span></a>
<a class="sourceLine" id="cb487-4" data-line-number="4">df[[var]]</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1"><span class="co"># Не используем знак доллара $, потому что он будет искать</span></a>
<a class="sourceLine" id="cb489-2" data-line-number="2">df<span class="op">$</span>var</a></code></pre></div>
<pre><code>## NULL</code></pre>
</div>
<div id="-10.6.4" class="section level4">
<h4><span class="header-section-number">3.1.4.4</span> Упражнение 10.6.4</h4>
<div class="question">
<p>Practice referring to non-syntactic names in the following data frame by:</p>
<ol style="list-style-type: decimal">
<li><p>Extracting the variable called 1.</p></li>
<li><p>Plotting a scatterplot of 1 vs 2.</p></li>
<li><p>Creating a new column called 3 which is 2 divided by 1.</p></li>
<li>Renaming the columns to one, two and three.</li>
</ol>
</div>
<p>Итак попрактикуемся с вытаскиванием</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1">annoying &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb491-2" data-line-number="2">  <span class="st">`</span><span class="dt">1</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb491-3" data-line-number="3">  <span class="st">`</span><span class="dt">2</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">1</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(<span class="st">`</span><span class="dt">1</span><span class="st">`</span>))</a>
<a class="sourceLine" id="cb491-4" data-line-number="4">)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Извлекаем переменную</li>
</ol>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" data-line-number="1"><span class="co"># Эта запись возвращает тиббл-столбец</span></a>
<a class="sourceLine" id="cb492-2" data-line-number="2">annoying[<span class="dv">1</span>]</a></code></pre></div>
<pre><code>## # A tibble: 10 x 1
##      `1`
##    &lt;int&gt;
##  1     1
##  2     2
##  3     3
##  4     4
##  5     5
##  6     6
##  7     7
##  8     8
##  9     9
## 10    10</code></pre>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1"><span class="co"># Извлекаем переменную 1 как вектор</span></a>
<a class="sourceLine" id="cb494-2" data-line-number="2">annoying<span class="op">$</span><span class="st">&quot;1&quot;</span></a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1"><span class="co"># Эта запись возвращает вектор</span></a>
<a class="sourceLine" id="cb496-2" data-line-number="2">annoying[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1"><span class="co"># И эта запись возвращает вектор</span></a>
<a class="sourceLine" id="cb498-2" data-line-number="2">annoying[[<span class="st">&quot;1&quot;</span>]]</a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb500"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb500-1" data-line-number="1"><span class="co"># И эта запись возвращает вектор</span></a>
<a class="sourceLine" id="cb500-2" data-line-number="2">annoying<span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span></a></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<ol style="list-style-type: decimal">
<li>Строим точечный график для переменных <code>1</code> и <code>2</code></li>
</ol>
<div class="sourceCode" id="cb502"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb502-1" data-line-number="1"><span class="co"># Создаём точечный график либо вот так</span></a>
<a class="sourceLine" id="cb502-2" data-line-number="2"><span class="kw">ggplot</span>(annoying, <span class="kw">aes</span>(<span class="dt">x =</span> annoying[[<span class="dv">1</span>]], <span class="dt">y =</span> annoying[[<span class="dv">2</span>]])) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb502-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-308-1.png" width="672" /></p>
<div class="sourceCode" id="cb503"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb503-1" data-line-number="1"><span class="co"># Либо вот так</span></a>
<a class="sourceLine" id="cb503-2" data-line-number="2"><span class="kw">ggplot</span>(annoying, <span class="kw">aes</span>(<span class="dt">x =</span> annoying<span class="op">$</span><span class="st">&quot;1&quot;</span>, <span class="dt">y =</span> annoying<span class="op">$</span><span class="st">&quot;2&quot;</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb503-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-308-2.png" width="672" /></p>
<div class="sourceCode" id="cb504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb504-1" data-line-number="1"><span class="co"># Но лучше всего вот так!</span></a>
<a class="sourceLine" id="cb504-2" data-line-number="2"><span class="kw">ggplot</span>(annoying, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">2</span><span class="st">`</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb504-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-308-3.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li>Создаём ещё один столбец</li>
</ol>
<div class="sourceCode" id="cb505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb505-1" data-line-number="1"><span class="co"># Можно старым знакомым методом</span></a>
<a class="sourceLine" id="cb505-2" data-line-number="2">annoying <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb505-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">3</span><span class="st">`</span> =<span class="st"> `</span><span class="dt">2</span><span class="st">`</span> <span class="op">/</span><span class="st"> `</span><span class="dt">1</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##      `1`   `2`   `3`
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2.54  2.54
##  2     2  5.92  2.96
##  3     3  5.41  1.80
##  4     4  8.22  2.05
##  5     5  7.35  1.47
##  6     6 11.3   1.89
##  7     7 15.4   2.20
##  8     8 14.4   1.80
##  9     9 19.6   2.18
## 10    10 21.6   2.16</code></pre>
<div class="sourceCode" id="cb507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb507-1" data-line-number="1"><span class="co"># Можно попроще</span></a>
<a class="sourceLine" id="cb507-2" data-line-number="2">annoying[[<span class="st">&quot;3&quot;</span>]] &lt;-<span class="st"> </span>annoying<span class="op">$</span><span class="st">`</span><span class="dt">2</span><span class="st">`</span> <span class="op">/</span><span class="st"> </span>annoying<span class="op">$</span><span class="st">`</span><span class="dt">1</span><span class="st">`</span></a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Изменяем названия столбцов</li>
</ol>
<div class="sourceCode" id="cb508"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb508-1" data-line-number="1">annoying &lt;-<span class="st"> </span><span class="kw">rename</span>(annoying, <span class="dt">one =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">two =</span> <span class="st">`</span><span class="dt">2</span><span class="st">`</span>, <span class="dt">three =</span> <span class="st">`</span><span class="dt">3</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb508-2" data-line-number="2"><span class="kw">print</span>(annoying)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##      one   two three
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     1  2.54  2.54
##  2     2  5.92  2.96
##  3     3  5.41  1.80
##  4     4  8.22  2.05
##  5     5  7.35  1.47
##  6     6 11.3   1.89
##  7     7 15.4   2.20
##  8     8 14.4   1.80
##  9     9 19.6   2.18
## 10    10 21.6   2.16</code></pre>
</div>
<div id="-10.6.5" class="section level4">
<h4><span class="header-section-number">3.1.4.5</span> Упражнение 10.6.5</h4>
<div class="question">
<p>What does <code>tibble::enframe()</code> do? When might you use it?</p>
</div>
<p><code>tibble::enframe()</code> преобразует атомные векторы или списки в двухколонные кадры данных. Для неназванных векторов естественная последовательность используется как столбец имен.</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb510-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="dv">6</span></a></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<div class="sourceCode" id="cb512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb512-1" data-line-number="1"><span class="kw">enframe</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##    name value
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     2
## 3     3     3
## 4     4     4
## 5     5     5
## 6     6     6</code></pre>
<div class="sourceCode" id="cb514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb514-1" data-line-number="1"><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">5</span>, <span class="dt">b =</span> <span class="dv">7</span>)</a></code></pre></div>
<pre><code>## a b 
## 5 7</code></pre>
<div class="sourceCode" id="cb516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb516-1" data-line-number="1"><span class="kw">enframe</span>(<span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">5</span>, <span class="dt">b =</span> <span class="dv">7</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   name  value
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         5
## 2 b         7</code></pre>
<p>Другими словами функция преобразует именованные векторы в data frame с именами и значениями</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb518-1" data-line-number="1"><span class="kw">enframe</span>(<span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  value
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a         1
## 2 b         2
## 3 c         3</code></pre>
</div>
<div id="-10.6.6" class="section level4">
<h4><span class="header-section-number">3.1.4.6</span> Упражнение 10.6.6</h4>
<div class="question">
<p>What option controls how many additional column names are printed at the footer of a tibble?</p>
</div>
<p>За возможность выводить столбцы отвечает функция <code>print()</code>. Количеством выводимых столбцов в колонтитуле управляет параметр <code>n_extra</code></p>
<div class="sourceCode" id="cb520"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb520-1" data-line-number="1"><span class="kw">print</span>(nycflights13<span class="op">::</span>flights)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<div class="sourceCode" id="cb522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb522-1" data-line-number="1"><span class="kw">print</span>(nycflights13<span class="op">::</span>flights, <span class="dt">n_extra =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, …</code></pre>
<!--chapter:end:07_tibbles.Rmd-->
</div>
</div>
</div>
<div id="-----reader" class="section level2">
<h2><span class="header-section-number">3.2</span> Импорт данных с помощью пакета <code>reader</code></h2>
<div id="-5" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Введение</h3>
<p>В этой главе я узнаю как нужно импортировать данные.</p>
<div id="--2" class="section level4">
<h4><span class="header-section-number">3.2.1.1</span> Необходимые ресурсы</h4>
<p>Загружать будем при помощи инструментов библиотеки <code>tidyverse</code></p>
<div class="sourceCode" id="cb524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb524-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Приступаем к работе</h3>
<p>Большинство функций пакета <code>reader</code> связано с перемезением данных из простых текстовых файлов во фреймы данных. Все эти функции имеют сходный синтаксис</p>
<ul>
<li><p>Функция <code>read_csv()</code> читает текстовые файлы с <em>запятой</em> в качестве разделителя</p></li>
<li><p>Функция <code>read_csv2()</code> читает текстовые файлы с <em>точку с запятой</em> в качестве разделителя</p></li>
<li><p>Функция <code>read_tsv()</code> читает текстовые файлы с <em>символом табуляции</em> в качестве разделителя</p></li>
<li><p>Функция <code>read_delim()</code> файлы с любым разделителем</p></li>
<li><p>Функция <code>read_fwf()</code> читает текстовые файлы с <em>фиксированной шириной</em> полей — либо по ширине поля с <code>fwf_widths()</code>, либо по их позиции с <code>fwf_positions()</code></p></li>
<li><p>Функция <code>read_table()</code> читает текстовые файлы с фиксированной шириной полей, в которых столбцы разделены <em>пробелом</em></p></li>
</ul>
<p>Работать в качестве примера будем с самым популярным форматом — <code>read_csv()</code>.</p>
<p>Первый аргумент играет наиболее важную роль — путь к файлу, который мы хотим прочитать.</p>
<p>В качестве примера возьмём простенький набор данных.</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb525-1" data-line-number="1">heights &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;weight-height.csv&quot;</span>)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   Gender = col_character(),
##   Height = col_double(),
##   Weight = col_double()
## )</code></pre>
<p>Примечательно, что при чтении файла функция выводит спецификацию столбцов, в которой указывает тип данных.</p>
<p>Кроме того, можно самому сгенерировать csv-file например таким образом:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb527-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a, b, c</span></a>
<a class="sourceLine" id="cb527-2" data-line-number="2"><span class="st">1, 2, 3</span></a>
<a class="sourceLine" id="cb527-3" data-line-number="3"><span class="st">4, 5, 6&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       a     b     c
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     3
## 2     4     5     6</code></pre>
<p>В качестве названий столбцов используется первая строка. Есть несколько ситуаций, когда может понадобится изменить это поведение.</p>
<ol style="list-style-type: decimal">
<li>Некоторые файлы начинаются с нескольких строк метаданных. Их можно скипнуть аргументом <code>skip = n</code>, чтобы пропустить <code>n</code> первых строк. Или использовать аргумент <code>comment = &quot;#&quot;</code> чтобы пропустить все строки начинующиеся на заданный символ <code>#</code></li>
</ol>
<div class="sourceCode" id="cb529"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb529-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;The first line of metadata</span></a>
<a class="sourceLine" id="cb529-2" data-line-number="2"><span class="st">  The second line of metadata</span></a>
<a class="sourceLine" id="cb529-3" data-line-number="3"><span class="st">  x,y,z</span></a>
<a class="sourceLine" id="cb529-4" data-line-number="4"><span class="st">  1,2,3&quot;</span>, <span class="dt">skip =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##       x     y     z
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     3</code></pre>
<div class="sourceCode" id="cb531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb531-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;# A comment I want to skip</span></a>
<a class="sourceLine" id="cb531-2" data-line-number="2"><span class="st">  x,y,z</span></a>
<a class="sourceLine" id="cb531-3" data-line-number="3"><span class="st">  1,2,3&quot;</span>, <span class="dt">comment =</span> <span class="st">&quot;#&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##       x     y     z
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     3</code></pre>
<ol style="list-style-type: decimal">
<li>Данные могут не иметь названий столбцов. ЧТобы не обрабатывать первую строку как строку заголовкой, необходимо использовать аргумент <code>col_names = FALSE</code>. В этом случае в заголовки столбцов будут автоматически помещены последовательные метки от <code>X1</code> до <code>Xn</code></li>
</ol>
<div class="sourceCode" id="cb533"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb533-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;1,2,3</span><span class="ch">\n</span><span class="st">4,5,6&quot;</span>, <span class="dt">col_names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##      X1    X2    X3
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     3
## 2     4     5     6</code></pre>
<p>Ещё один способ, когда необходимо обозвать переменные чтобы не запутаться, передать вместе с аргументом <code>col_names</code> символьный вектор с названиями столбцов.</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb535-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;1,2,3</span><span class="ch">\n</span><span class="st">4,5,6&quot;</span>, <span class="dt">col_names =</span> <span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       x     y     z
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     3
## 2     4     5     6</code></pre>
<p>Можно читать и более сложные форматы, но для этого необходимо погрузиться в дебри пакета <code>readr</code>.</p>
<div id="----r" class="section level4">
<h4><span class="header-section-number">3.2.2.1</span> Сравнение с базовыми возможностями R</h4>
<p>Я уже замечал при наборе функции что R предлагает мне функцию <code>read.csv()</code> вместо желаемой <code>read_csv()</code>. Оказывается функция с точкой это базовая функция. И предпочтительно её <em>не использовать</em>. По следующим веским причинам:</p>
<ul>
<li><p>Функция <code>read_csv()</code> из пакета <code>readr</code> работает быстрее</p></li>
<li><p>Функция создаёт tibble-формат со всеми вытекающими бонусами</p></li>
<li><p>Их поведение воспроизводимо и не зависит от используемой операционной системы</p></li>
</ul>
</div>
<div id="-11.2.2.1" class="section level4">
<h4><span class="header-section-number">3.2.2.2</span> Упражнение 11.2.2.1</h4>
<div class="question">
<p>What function would you use to read a file where fields were separated with “|”?</p>
</div>
<p>Функция <code>read_delim()</code> читает файлы с любым разделителем. Поэтому я бы использовал её</p>
<div class="sourceCode" id="cb537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb537-1" data-line-number="1"><span class="co"># read_delim(file, delim = &quot;|&quot;)</span></a></code></pre></div>
</div>
<div id="-11.2.2.2" class="section level4">
<h4><span class="header-section-number">3.2.2.3</span> Упражнение 11.2.2.2</h4>
<div class="question">
<p>Apart from <code>file</code>, <code>skip</code>, and <code>comment</code>, what other arguments do <code>read_csv()</code> and <code>read_tsv()</code> have in common?</p>
</div>
<p><code>read_csv()</code> и <code>read_tsv()</code> имеют следующие аргументы:</p>
<ul>
<li><p>file - Либо путь к файлу, либо соединение, либо литеральные данные (либо одна строка, либо необработанный вектор).</p></li>
<li><p>delim — Один символ используется для разделения полей в записи.</p></li>
<li><p>quote — Один символ используется для цитирования строк.</p></li>
<li><p>escape_backslash — Использует ли файл обратную косую черту, чтобы избежать специальных символов? Это более общий, чем escape_double, поскольку обратные слэши могут использоваться для исключения символа разделителя, символа кавычки или для добавления специальных символов, таких как  n.</p></li>
<li><p>escape_double — Сохраняет ли файл кавычки, удваивая их? т. е. если этот параметр имеет значение ИСТИНА, значение &quot;&quot; &quot;&quot; представляет собой одиночную кавычку  &quot;.</p></li>
<li><p>col_names — Или TRUE, FALSE или символьный вектор имен столбцов.
Если TRUE, первая строка ввода будет использоваться в качестве имен столбцов и не будет включена в фрейм данных. Если FALSE, имена столбцов будут сгенерированы автоматически: X1, X2, X3 и т. Д.
Если col_names является символьным вектором, значения будут использоваться в качестве имен столбцов, а первая строка ввода будет считана в первой строке кадра выходных данных.
Названия столбцов Missing (NA) генерируют предупреждение и заполняются фиктивными именами X1, X2 и т. Д. Дублирующие имена столбцов генерируют предупреждение и становятся уникальными с числовым префиксом.</p></li>
<li><p>col_types — тип данных в столбцу</p></li>
<li><p>locale — язык по умолчанию</p></li>
<li><p>na — Символьный вектор строк для использования для отсутствующих значений. Установите этот параметр для символа (), чтобы указать отсутствие пропущенных значений.</p></li>
<li><p>quoted_na — Если отсутствующие значения внутри кавычек должны рассматриваться как отсутствующие значения (по умолчанию) или строки.</p></li>
<li><p>comment — Строка, используемая для идентификации комментариев. Любой текст после символов комментария будет игнорироваться.</p></li>
<li><p>trim_ws — Следует ли обрезать передние и конечные пробелы из каждого поля перед его разбором?</p></li>
<li><p>skip — Количество строк для пропусков перед чтением данных.</p></li>
<li><p>n_max — Максимальное количество записей для чтения.</p></li>
<li><p>guess_max — Максимальное количество записей, используемых для угадывания типов столбцов.</p></li>
<li><p>progress — Отобразить индикатор выполнения? По умолчанию он будет отображаться только в интерактивном сеансе, а не во время вставки документа. Дисплей обновляется каждые 50 000 значений и будет отображаться только в том случае, если приблизительное время показа составляет 5 секунд или более. Автоматический индикатор выполнения можно отключить, установив параметр readr.show_progress в FALSE.</p></li>
</ul>
<p>можно посмотреть список общих аргументов формулой</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb538-1" data-line-number="1"><span class="kw">union</span>(<span class="kw">names</span>(<span class="kw">formals</span>(read_csv)), <span class="kw">names</span>(<span class="kw">formals</span>(read_tsv)))</a></code></pre></div>
<pre><code>##  [1] &quot;file&quot;            &quot;col_names&quot;       &quot;col_types&quot;      
##  [4] &quot;locale&quot;          &quot;na&quot;              &quot;quoted_na&quot;      
##  [7] &quot;quote&quot;           &quot;comment&quot;         &quot;trim_ws&quot;        
## [10] &quot;skip&quot;            &quot;n_max&quot;           &quot;guess_max&quot;      
## [13] &quot;progress&quot;        &quot;skip_empty_rows&quot;</code></pre>
<p>Разберём написанный код:</p>
<ul>
<li>функция <code>formals()</code> получает или устанавливает аргументы функции и показывает значения по умолчанию этих аргументов.</li>
</ul>
<div class="sourceCode" id="cb540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb540-1" data-line-number="1"><span class="kw">formals</span>(read_csv)</a></code></pre></div>
<pre><code>## $file
## 
## 
## $col_names
## [1] TRUE
## 
## $col_types
## NULL
## 
## $locale
## default_locale()
## 
## $na
## c(&quot;&quot;, &quot;NA&quot;)
## 
## $quoted_na
## [1] TRUE
## 
## $quote
## [1] &quot;\&quot;&quot;
## 
## $comment
## [1] &quot;&quot;
## 
## $trim_ws
## [1] TRUE
## 
## $skip
## [1] 0
## 
## $n_max
## [1] Inf
## 
## $guess_max
## min(1000, n_max)
## 
## $progress
## show_progress()
## 
## $skip_empty_rows
## [1] TRUE</code></pre>
<ul>
<li>функция <code>names()</code> задаёт или получает названия объекта</li>
</ul>
<div class="sourceCode" id="cb542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb542-1" data-line-number="1"><span class="kw">names</span>(<span class="kw">formals</span>(read_csv))</a></code></pre></div>
<pre><code>##  [1] &quot;file&quot;            &quot;col_names&quot;       &quot;col_types&quot;      
##  [4] &quot;locale&quot;          &quot;na&quot;              &quot;quoted_na&quot;      
##  [7] &quot;quote&quot;           &quot;comment&quot;         &quot;trim_ws&quot;        
## [10] &quot;skip&quot;            &quot;n_max&quot;           &quot;guess_max&quot;      
## [13] &quot;progress&quot;        &quot;skip_empty_rows&quot;</code></pre>
<ul>
<li>функция <code>union()</code> сравнивает по средствам оператора <code>И</code> и объединяет наборы данных</li>
</ul>
</div>
<div id="-11.2.2.3" class="section level4">
<h4><span class="header-section-number">3.2.2.4</span> Упражнение 11.2.2.3</h4>
<div class="question">
<p>What are the most important arguments to <code>read_fwf()</code>?</p>
</div>
<p>Так как функция <code>read_fwf()</code> читает форматы с фиксированной шириной, то наиболее важным аргументом <code>read_fwf()</code>, является <code>col_positions</code>, который сообщает функции, где столбцы данных начинаются и заканчиваются.</p>
</div>
<div id="-11.2.2.4" class="section level4">
<h4><span class="header-section-number">3.2.2.5</span> Упражнение 11.2.2.4</h4>
<div class="question">
<p>Sometimes strings in a CSV file contain commas. To prevent them from causing problems they need to be surrounded by a quoting character, like <code>&quot;</code> or <code>'</code>. By convention, <code>read_csv()</code> assumes that the quoting character will be <code>&quot;</code>, and if you want to change it you’ll need to use <code>read_delim()</code> instead. What arguments do you need to specify to read the following text into a data frame?</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb544-1" data-line-number="1"><span class="st">&quot;x,y</span><span class="ch">\n</span><span class="st">1,&#39;a,b&#39;&quot;</span></a></code></pre></div>
<pre><code>## [1] &quot;x,y\n1,&#39;a,b&#39;&quot;</code></pre>
</div>
<p>Привыкаем орудовать с именованием.</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb546-1" data-line-number="1"><span class="co"># Сначала присваиваем заданный набор символов в переменную</span></a>
<a class="sourceLine" id="cb546-2" data-line-number="2">x &lt;-<span class="st"> &quot;x,y</span><span class="ch">\n</span><span class="st">1,&#39;a,b&#39;&quot;</span></a>
<a class="sourceLine" id="cb546-3" data-line-number="3"><span class="co"># Для чтения этого набора символов как фрейм данных, используем функцию read_csv()</span></a>
<a class="sourceLine" id="cb546-4" data-line-number="4"><span class="co"># Нам нужно выделить элемент, не нарушая его целостности</span></a>
<a class="sourceLine" id="cb546-5" data-line-number="5"><span class="co"># Для этого нужно процитировать текст как есть. Это умеет аргумент quote</span></a>
<a class="sourceLine" id="cb546-6" data-line-number="6"><span class="co"># Объявим знаком начала-окончания цитаты одинарную ковычку</span></a>
<a class="sourceLine" id="cb546-7" data-line-number="7"><span class="kw">read_csv</span>(x, <span class="dt">quote =</span> <span class="st">&quot;&#39;&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x y    
##   &lt;dbl&gt; &lt;chr&gt;
## 1     1 a,b</code></pre>
</div>
<div id="-11.2.2.5" class="section level4">
<h4><span class="header-section-number">3.2.2.6</span> Упражнение 11.2.2.5</h4>
<div class="question">
<p>Identify what is wrong with each of the following inline CSV files. What happens when you run the code?</p>
</div>
<p>Разберём каждый пример</p>
<ol style="list-style-type: decimal">
<li>В этом примере в строке заголовка 2 объекта, а в строках значений по три.</li>
</ol>
<div class="sourceCode" id="cb548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb548-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">1,2,3</span><span class="ch">\n</span><span class="st">4,5,6&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: 2 parsing failures.
## row col  expected    actual         file
##   1  -- 2 columns 3 columns literal data
##   2  -- 2 columns 3 columns literal data</code></pre>
<pre><code>## # A tibble: 2 x 2
##       a     b
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2
## 2     4     5</code></pre>
<p>Программа “удаляет” или если угодно скрывает значения, для которых не объявлен заголовок. Чтобы прочитать всё как следует, необходимо добавить ещё одно название столбца:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb551-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a,b,c</span><span class="ch">\n</span><span class="st">1,2,3</span><span class="ch">\n</span><span class="st">4,5,6&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       a     b     c
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2     3
## 2     4     5     6</code></pre>
<ol style="list-style-type: decimal">
<li>Этот пример можно интерпретировать разными способами, но я буду придерживаться следующего.
Примем за данность, что перенос всегда строки ставится корректно. Я делаю такое предположение, чтобы не вносить значения данных вручную.</li>
</ol>
<div class="sourceCode" id="cb553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb553-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a,b,c</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">1,2,3,4&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: 2 parsing failures.
## row col  expected    actual         file
##   1  -- 3 columns 2 columns literal data
##   2  -- 3 columns 4 columns literal data</code></pre>
<pre><code>## # A tibble: 2 x 3
##       a     b     c
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2    NA
## 2     1     2     3</code></pre>
<p>Тогда в этом случае в примере пропущено название одного столбца, и пропущены значения в первой строке в двух последнийх столбцах. Добавим ещё один столбец.</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb556-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a,b,c,d</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">1,2,3,4&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: 1 parsing failure.
## row col  expected    actual         file
##   1  -- 4 columns 2 columns literal data</code></pre>
<pre><code>## # A tibble: 2 x 4
##       a     b     c     d
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2    NA    NA
## 2     1     2     3     4</code></pre>
<ol style="list-style-type: decimal">
<li>В этом примере не совсем ясно что должно происходить.</li>
</ol>
<div class="sourceCode" id="cb559"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb559-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a,b</span><span class="ch">\n\&quot;</span><span class="st">1&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: 2 parsing failures.
## row col                     expected    actual         file
##   1  a  closing quote at end of file           literal data
##   1  -- 2 columns                    1 columns literal data</code></pre>
<pre><code>## # A tibble: 1 x 2
##       a b    
##   &lt;dbl&gt; &lt;chr&gt;
## 1     1 &lt;NA&gt;</code></pre>
<p>НАчальная цитата &quot;1 не рассматривается, потому что она не закрыта. И значения для столбца <code>а</code> рассматривается как целое число 1.
Даже не стану исправлять.</p>
<ol style="list-style-type: decimal">
<li>Тоже не совсем ясно. Оба столбца выводятся хорошо, и являются символьными, потому что вы каждом содержатся буквы.</li>
</ol>
<div class="sourceCode" id="cb562"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb562-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a,b</span><span class="ch">\n</span><span class="st">1,2</span><span class="ch">\n</span><span class="st">a,b&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   a     b    
##   &lt;chr&gt; &lt;chr&gt;
## 1 1     2    
## 2 a     b</code></pre>
<p>Можно интерпретировать по разному, например вот так: что в столбец <code>а</code> автор хотел поместить значения <code>1,2</code>, а в столбец <code>b</code> — <code>a,b</code>.</p>
<ol style="list-style-type: decimal">
<li>В этом используется разделитель точка с запятой вместо просто запятой.</li>
</ol>
<div class="sourceCode" id="cb564"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb564-1" data-line-number="1"><span class="kw">read_csv</span>(<span class="st">&quot;a;b</span><span class="ch">\n</span><span class="st">1;3&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   `a;b`
##   &lt;chr&gt;
## 1 1;3</code></pre>
<p>Это легко исправить, если использовать функцию <code>read_csv2</code></p>
<div class="sourceCode" id="cb566"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb566-1" data-line-number="1"><span class="kw">read_csv2</span>(<span class="st">&quot;a;b</span><span class="ch">\n</span><span class="st">1;3&quot;</span>)</a></code></pre></div>
<pre><code>## Using &#39;,&#39; as decimal and &#39;.&#39; as grouping mark. Use read_delim() for more control.</code></pre>
<pre><code>## # A tibble: 1 x 2
##       a     b
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     3</code></pre>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Синтаксический анализ векторов</h3>
<p>Парсинг — это синтаксический анализ.
Функции семейства <code>parse_*()</code> принимают символьный вектор и возвращают вектор специализированного типа.</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb569-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">parse_logical</span>(<span class="kw">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>, <span class="st">&quot;NA&quot;</span>)))</a></code></pre></div>
<pre><code>##  logi [1:3] TRUE FALSE NA</code></pre>
<div class="sourceCode" id="cb571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb571-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">parse_integer</span>(<span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;3&quot;</span>)))</a></code></pre></div>
<pre><code>##  int [1:3] 1 2 3</code></pre>
<div class="sourceCode" id="cb573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb573-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">parse_date</span>(<span class="kw">c</span>(<span class="st">&quot;2010-01-01&quot;</span>, <span class="st">&quot;1979-10-14&quot;</span>)))</a></code></pre></div>
<pre><code>##  Date[1:2], format: &quot;2010-01-01&quot; &quot;1979-10-14&quot;</code></pre>
<p>Функция <code>str()</code> — Компактно отображает внутреннюю структуру объекта R, диагностическую функцию и альтернативу сводке (и в некоторой степени, dput). В идеале отображается только одна строка для каждой «базовой» структуры. Он особенно хорошо подходит для компактного отображения (сокращенного) содержимого (возможно, вложенных) списков. Идея состоит в том, чтобы дать разумный результат для любого объекта R. Он вызывает args для (не-примитивных) объектов функции.</p>
<p>Функции этого семейства унифицированны — их первый аргумент, это символьный вектор подлежащий анализу. Аргумент <code>na</code> указывает на то какие строки считать пропущенными значениями</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb575-1" data-line-number="1"><span class="kw">parse_integer</span>(<span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;231&quot;</span>, <span class="st">&quot;.&quot;</span>, <span class="st">&quot;456&quot;</span>), <span class="dt">na =</span> <span class="st">&quot;.&quot;</span>)</a></code></pre></div>
<pre><code>## [1]   1 231  NA 456</code></pre>
<p>В случае неуспешного парсинга элемента выводится соответствующее сообщение</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb577-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">parse_integer</span>(<span class="kw">c</span>(<span class="st">&quot;123&quot;</span>, <span class="st">&quot;345&quot;</span>, <span class="st">&quot;abc&quot;</span>, <span class="st">&quot;123.45&quot;</span>))</a></code></pre></div>
<pre><code>## Warning: 2 parsing failures.
## row col               expected actual
##   3  -- an integer                abc
##   4  -- no trailing characters    .45</code></pre>
<p>Такие элементы при выводе отмечаются как отсутсвующие элементы</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb579-1" data-line-number="1">x</a></code></pre></div>
<pre><code>## [1] 123 345  NA  NA
## attr(,&quot;problems&quot;)
## # A tibble: 2 x 4
##     row   col expected               actual
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                  &lt;chr&gt; 
## 1     3    NA an integer             abc   
## 2     4    NA no trailing characters .45</code></pre>
<p>Чтобы изучить полный набор ошибок парсинга можно воспользоваться функцией <code>problems()</code>. Он возвращает tibble-frame которым можно манипулировать с помощью пакета <code>dplyr</code></p>
<div class="sourceCode" id="cb581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb581-1" data-line-number="1"><span class="kw">problems</span>(x)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 4
##     row   col expected               actual
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                  &lt;chr&gt; 
## 1     3    NA an integer             abc   
## 2     4    NA no trailing characters .45</code></pre>
<p>Эффективное выполнение парсинга требует знания того , какие парсеры имеются в вашем располряжении и как они обрабатывают различные типы входных данных. Чаще всего используются девять парсеров:</p>
<ul>
<li><p><code>parse_logical()</code> и <code>parse_integer()</code> — парсинг логических и целочисленных значений соответственно. Никаких затруднений при работе с ними в основном не возникает.</p></li>
<li><p><code>parse_double()</code> строгий числовой парсер, тогда как <code>parse_number()</code> — гибкий числовой парсер. Работать с ними сложнее, по скольку в разных странах числа записываются по разному.</p></li>
<li><p><code>parse_character()</code> — символьный парсер, пригодится для того чтобы перекидывать символьные кодировки.</p></li>
<li><p><code>parse_factor()</code> — создает факторы, или структуры данных, которые R использует для предоставления категориальных переменных, т.е. переменных, имеющих известный фиксированный набор возможных значений.</p></li>
<li><p><code>parse_datetime()</code>, <code>parse_date()</code>, and <code>parse_time()</code> — позволяют анализировать значения даты и времени, заданные в соответствии с различными спецификащиями. Эти парсеры отличаются наибольшей сложностью ввиду существования множества различных форматов записи дат и времени.</p></li>
</ul>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.2.3.1</span> Парсинг чисел</h4>
<p>Парсинг чисел осложняется следующими обстоятельствами:</p>
<ol style="list-style-type: decimal">
<li><p>В разных странах числа записывают по-разному — разделение бывает точкой, а бывает запятой</p></li>
<li><p>Числа окружены другими символами, обеспечивающими определённый контекст <code>100%</code> <code>$1007</code></p></li>
<li><p>Числа часто содержат разделители групп разрядов <code>100,000,000</code>. При чём в разных странах для этих целей могут использоваться разные символы.</p></li>
</ol>
<p>Чтобы справиться с первой проблемой в введено понятие локали — объекта определяющего правила парсинга. Можно задавать при помощи локали символ разделяющий десятичного разделителя.</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb583-1" data-line-number="1"><span class="kw">parse_double</span>(<span class="st">&quot;1.23&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 1.23</code></pre>
<div class="sourceCode" id="cb585"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb585-1" data-line-number="1"><span class="kw">parse_double</span>(<span class="st">&quot;1,23&quot;</span>, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="dt">decimal_mark =</span> <span class="st">&quot;,&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 1.23</code></pre>
<p>По умолчанию используется локаль для США.</p>
<p>Чтобы справиться со второй проблемой нужно использовать <code>parse_number()</code> — она игнорирует символы которые располагаются непосредственно перед числом и после него.</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb587-1" data-line-number="1"><span class="kw">parse_number</span>(<span class="st">&quot;$100&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb589-1" data-line-number="1"><span class="kw">parse_number</span>(<span class="st">&quot;20%&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb591-1" data-line-number="1"><span class="kw">parse_number</span>(<span class="st">&quot;It cost $123.45&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 123.45</code></pre>
<p>Последняя проблема решается путём совместного использования фнкции <code>parse_number()</code> и локали, которая задает символ, группирующий цифры по разрядам.</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb593-1" data-line-number="1"><span class="co"># Используется в США</span></a>
<a class="sourceLine" id="cb593-2" data-line-number="2"><span class="kw">parse_number</span>(<span class="st">&quot;$123,456,789&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 123456789</code></pre>
<div class="sourceCode" id="cb595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb595-1" data-line-number="1"><span class="co"># Используется во многих европейских странах</span></a>
<a class="sourceLine" id="cb595-2" data-line-number="2"><span class="kw">parse_number</span>(</a>
<a class="sourceLine" id="cb595-3" data-line-number="3">  <span class="st">&quot;$123.456.789&quot;</span>,</a>
<a class="sourceLine" id="cb595-4" data-line-number="4">  <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="dt">grouping_mark =</span> <span class="st">&quot;.&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 123456789</code></pre>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb597-1" data-line-number="1"><span class="co"># Используется в Швейцарии</span></a>
<a class="sourceLine" id="cb597-2" data-line-number="2"><span class="kw">parse_number</span>(</a>
<a class="sourceLine" id="cb597-3" data-line-number="3">  <span class="st">&quot;$123&#39;456&#39;789&quot;</span>,</a>
<a class="sourceLine" id="cb597-4" data-line-number="4">  <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="dt">grouping_mark =</span> <span class="st">&quot;&#39;&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 123456789</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.2.3.2</span> Парсинг строк</h4>
<p>Разберёмся как строки представляются в компьютере. Чтобы в R получить строку в том виде, в каком она хранится в памяти компьютера, следует использовать функцию <code>charToRaw()</code>.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb599-1" data-line-number="1"><span class="kw">charToRaw</span>(<span class="st">&quot;Stanislav&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 53 74 61 6e 69 73 6c 61 76</code></pre>
<p>Выдача — это числа в шестнадцатиричном формате. Каждое число это байт информации.</p>
<p>КОдирование — это отображение шестнадцатиричного числа в символ. Используемый в данном случае код называется ASCII (American Standard Code for Information Interchange — американский стандартный код для обмена информацией).</p>
<p>В случае языков отличных от английского не всё так просто. Поэтому везде используется негласный стандарт — UTF8.
Но не во всех случаях используется нужная кодировка. Иногда помогает определить кодировку функция <code>parse_character()</code>:</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb601-1" data-line-number="1">x1 &lt;-<span class="st"> &quot;El Ni</span><span class="ch">\xf1</span><span class="st">o was particularly bad this year&quot;</span></a>
<a class="sourceLine" id="cb601-2" data-line-number="2">x2 &lt;-<span class="st"> &quot;</span><span class="ch">\x82\xb1\x82\xf1\x82\xc9\x82\xbf\x82\xcd</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb601-3" data-line-number="3"></a>
<a class="sourceLine" id="cb601-4" data-line-number="4"><span class="kw">parse_character</span>(x1, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="dt">encoding =</span> <span class="st">&quot;Latin1&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;El Niño was particularly bad this year&quot;</code></pre>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb603-1" data-line-number="1"><span class="kw">parse_character</span>(x2, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="dt">encoding =</span> <span class="st">&quot;Shift-JIS&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;こんにちは&quot;</code></pre>
<p>Вот более подробная информация по кодированию-декодированию
<a href="http://kunststube.net/encoding/">http://kunststube.net/encoding/</a></p>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.2.3.3</span> Факторы</h4>
<p>Факторы используются в R для представления <em>категориальных</em> значений, т.е. значений образующих известный набор.</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb605-1" data-line-number="1">fruit &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>)</a>
<a class="sourceLine" id="cb605-2" data-line-number="2"><span class="kw">parse_factor</span>(<span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;bananana&quot;</span>), <span class="dt">levels =</span> fruit)</a></code></pre></div>
<pre><code>## Warning: 1 parsing failure.
## row col           expected   actual
##   3  -- value in level set bananana</code></pre>
<pre><code>## [1] apple  banana &lt;NA&gt;  
## attr(,&quot;problems&quot;)
## # A tibble: 1 x 4
##     row   col expected           actual  
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;   
## 1     3    NA value in level set bananana
## Levels: apple banana</code></pre>
</div>
<div id="-------" class="section level4">
<h4><span class="header-section-number">3.2.3.4</span> Календарные даты, календарные дата и время, время суток</h4>
<p>Есть три вида парсинга даты-времени, который зависит от того, что необходимо в конкретной задаче</p>
<ul>
<li>Функция <code>parse_datetime()</code> ожидает значение определяющее дату и время в соответствии со стандартом ISO8601. ФОрмат такой — ГГГГ-ММ-ДД ЧЧ:ММ:СС</li>
</ul>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb608-1" data-line-number="1"><span class="kw">parse_datetime</span>(<span class="st">&quot;2010-10-01T2010&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2010-10-01 20:10:00 UTC&quot;</code></pre>
<ul>
<li>Функция <code>parse_date()</code> если нам надо вытащить дату, ожидает значение в одном из форматов ГГГГ-ММ-ДД или ГГГГ/ММ/ДД</li>
</ul>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb610-1" data-line-number="1"><span class="kw">parse_date</span>(<span class="st">&quot;2010-10-01&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2010-10-01&quot;</code></pre>
<ul>
<li>Функция <code>parse_time()</code> ожидает значение в формате ЧЧ:ММ:СС с необязательным спецификатором a.m./p.m (до полудня/после полудня). Так как в базовых пакетах отсутствует специальный класс, для работы со временем суток принято использовать для этого класс, предоставляемый пакетом <code>hms</code></li>
</ul>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb612-1" data-line-number="1"><span class="kw">library</span>(hms)</a>
<a class="sourceLine" id="cb612-2" data-line-number="2"><span class="kw">parse_time</span>(<span class="st">&quot;01:10 am&quot;</span>)</a></code></pre></div>
<pre><code>## 01:10:00</code></pre>
<p>Если эти форматы не подходят, можно задать свой.</p>
<dl>
<dt>Year</dt>
<dd><code>%Y</code> (4 цифры).
</dd>
<dd><code>%y</code> (2 цифры); 00-69 -&gt; 2000-2069, 70-99 -&gt; 1970-1999.
</dd>
<dt>Month</dt>
<dd><code>%m</code> (2 цифры).
</dd>
<dd><code>%b</code> (сокращенное название, например “Jan”).
</dd>
<dd><code>%B</code> (полное название, “January”).
</dd>
<dt>Day</dt>
<dd><code>%d</code> (2 цифры).
</dd>
<dd><code>%e</code> (необязательный ведущий пробел).
</dd>
<dt>Time</dt>
<dd><code>%H</code> 0-23 часовой формат.
</dd>
<dd><code>%I</code> 0-12, следует использовать вместе <code>%p</code>.
</dd>
<dd><code>%p</code> AM/PM indicator.
</dd>
<dd><code>%M</code> минуты.
</dd>
<dd><code>%S</code> целочисленные секунды.
</dd>
<dd><code>%OS</code> вещественные секунды.
</dd>
<dd><code>%Z</code> часовой пояс (as name, e.g. <code>America/Chicago</code>).
</dd>
<dd><code>%z</code> (смещение от UTC, e.g. <code>+0800</code>).
</dd>
<dt>Нецифровые символы</dt>
<dd><code>%.</code> пропуск одного нецифрового символа.
</dd>
<dd><code>%*</code> пропуск любого количества нецифровых символов.
</dd>
</dl>
<p>Лучший способ определить корректный формат — создать несколько примеров в символьном векторе и протестировать их с помощью одной из функций анализаторов</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb614-1" data-line-number="1"><span class="kw">parse_date</span>(<span class="st">&quot;01/02/15&quot;</span>, <span class="st">&quot;%m/%d/%y&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2015-01-02&quot;</code></pre>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb616-1" data-line-number="1"><span class="kw">parse_date</span>(<span class="st">&quot;01/02/15&quot;</span>, <span class="st">&quot;%d/%m/%y&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2015-02-01&quot;</code></pre>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb618-1" data-line-number="1"><span class="kw">parse_date</span>(<span class="st">&quot;01/02/15&quot;</span>, <span class="st">&quot;%y/%m/%d&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2001-02-15&quot;</code></pre>
<p>В случае использования элементов формата <code>%b</code> или <code>%B</code> с названием месяцев не на английском необходимо задать аргумент <code>lang</code> функции <code>locale</code></p>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb620-1" data-line-number="1"><span class="kw">parse_date</span>(<span class="st">&quot;3 сентября 2018&quot;</span>, <span class="st">&quot;%d %B %Y&quot;</span>, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="st">&quot;ru&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;2018-09-03&quot;</code></pre>
</div>
<div id="-11.3.5.1" class="section level4">
<h4><span class="header-section-number">3.2.3.5</span> Упражнение 11.3.5.1</h4>
<div class="question">
<p>What are the most important arguments to <code>locale()</code>?</p>
</div>
<p>Наиболее важными аргументами является</p>
<ul>
<li><p><code>date_format, time format</code> которые указывают формат даты и времени</p></li>
<li><p><code>encoding</code> кодировка</p></li>
<li><p><code>decimal_mark, grouping_mark</code> разделитель</p></li>
<li><p><code>tz</code> часовой пояс</p></li>
</ul>
</div>
<div id="-11.3.5.2" class="section level4">
<h4><span class="header-section-number">3.2.3.6</span> Упражнение 11.3.5.2</h4>
<div class="question">
<ol style="list-style-type: decimal">
<li><p>What happens if you try and set <code>decimal_mark</code> and <code>grouping_mark</code> to the same character?</p></li>
<li><p>What happens to the default value of <code>grouping_mark</code> when you set <code>decimal_mark</code> to <code>&quot;,&quot;</code>?</p></li>
<li>What happens to the default value of <code>decimal_mark</code> when you set the <code>grouping_mark</code> to <code>&quot;.&quot;</code>?</li>
</ol>
</div>
<ol style="list-style-type: decimal">
<li>Должна произойти ошибка, потому что интерпретатор попадёт в вилку, что считать десятичным разделитем а что группировкой (так и есть)</li>
</ol>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb622-1" data-line-number="1"><span class="co">#parse_number(</span></a>
<a class="sourceLine" id="cb622-2" data-line-number="2"><span class="co">#  &quot;$123.456.789&quot;,</span></a>
<a class="sourceLine" id="cb622-3" data-line-number="3"><span class="co">#  locale = locale(grouping_mark = &quot;.&quot;, decimal_mark = &quot;.&quot;))</span></a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Не знаю, вероятно <code>grouping_mark</code> изменит своё значение на точку (так и есть)</li>
</ol>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb623-1" data-line-number="1"><span class="kw">locale</span>(<span class="dt">decimal_mark =</span> <span class="st">&quot;,&quot;</span>)</a></code></pre></div>
<pre><code>## &lt;locale&gt;
## Numbers:  123.456,78
## Formats:  %AD / %AT
## Timezone: UTC
## Encoding: UTF-8
## &lt;date_names&gt;
## Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed),
##         Thursday (Thu), Friday (Fri), Saturday (Sat)
## Months: January (Jan), February (Feb), March (Mar), April (Apr), May
##         (May), June (Jun), July (Jul), August (Aug), September
##         (Sep), October (Oct), November (Nov), December (Dec)
## AM/PM:  AM/PM</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Вероятно так же как и в примере выше, <code>decimal_mark</code> изменит своё значение на запятую</li>
</ol>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb625-1" data-line-number="1"><span class="kw">locale</span>(<span class="dt">grouping_mark =</span> <span class="st">&quot;.&quot;</span>)</a></code></pre></div>
<pre><code>## &lt;locale&gt;
## Numbers:  123.456,78
## Formats:  %AD / %AT
## Timezone: UTC
## Encoding: UTF-8
## &lt;date_names&gt;
## Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed),
##         Thursday (Thu), Friday (Fri), Saturday (Sat)
## Months: January (Jan), February (Feb), March (Mar), April (Apr), May
##         (May), June (Jun), July (Jul), August (Aug), September
##         (Sep), October (Oct), November (Nov), December (Dec)
## AM/PM:  AM/PM</code></pre>
</div>
<div id="-11.3.5.3" class="section level4">
<h4><span class="header-section-number">3.2.3.7</span> Упражнение 11.3.5.3</h4>
<div class="question">
<p>I didn’t discuss the <code>date_format</code> and <code>time_format</code> options to <code>locale()</code>. What do they do? Construct an example that shows when they might be useful.</p>
</div>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb627-1" data-line-number="1"><span class="kw">locale</span>()</a></code></pre></div>
<pre><code>## &lt;locale&gt;
## Numbers:  123,456.78
## Formats:  %AD / %AT
## Timezone: UTC
## Encoding: UTF-8
## &lt;date_names&gt;
## Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed),
##         Thursday (Thu), Friday (Fri), Saturday (Sat)
## Months: January (Jan), February (Feb), March (Mar), April (Apr), May
##         (May), June (Jun), July (Jul), August (Aug), September
##         (Sep), October (Oct), November (Nov), December (Dec)
## AM/PM:  AM/PM</code></pre>
<p>По умолчанию заданы форматы <code>%AD</code> и <code>%AT</code> для соответственно даты и времени.</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb629-1" data-line-number="1"><span class="kw">parse_date</span>(<span class="st">&quot;1 января 2018&quot;</span>, <span class="st">&quot;%d %B %Y&quot;</span>, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="dt">date_names =</span> <span class="st">&quot;ru&quot;</span>, <span class="dt">date_format =</span> ))</a></code></pre></div>
<pre><code>## [1] &quot;2018-01-01&quot;</code></pre>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb631-1" data-line-number="1"><span class="kw">parse_date</span>(<span class="st">&quot;21 окт. 1991&quot;</span>, <span class="st">&quot;%d %b %Y&quot;</span>, <span class="dt">locale =</span> <span class="kw">locale</span>(<span class="st">&quot;ru&quot;</span>, <span class="dt">time_format =</span><span class="st">&quot;ioojdpijsdf&quot;</span> ))</a></code></pre></div>
<pre><code>## [1] &quot;1991-10-21&quot;</code></pre>
<p>Сложно придумать пример, если они на что-то и влияют, то мне не удалось придумать пример</p>
</div>
<div id="-11.3.5.4" class="section level4">
<h4><span class="header-section-number">3.2.3.8</span> Упражнение 11.3.5.4</h4>
<div class="question">
<p>If you live outside the US, create a new locale object that encapsulates the settings for the types of file you read most commonly.</p>
</div>
<p>Да я живу за пределами Штатов, но пожалуй менять настройки пока что не буду. При случае, если это понадобится надо будет почитать хэлп к локали <code>?locale</code></p>
</div>
<div id="-11.3.5.5" class="section level4">
<h4><span class="header-section-number">3.2.3.9</span> Упражнение 11.3.5.5</h4>
<div class="question">
<p>What’s the difference between <code>read_csv()</code> and <code>read_csv2()</code>?</p>
</div>
<ul>
<li><p>Функция <code>read_csv()</code> читает текстовые файлы с <em>запятой</em> в качестве разделителя</p></li>
<li><p>Функция <code>read_csv2()</code> читает текстовые файлы с <em>точку с запятой</em> в качестве разделителя</p></li>
</ul>
</div>
<div id="-11.3.5.6" class="section level4">
<h4><span class="header-section-number">3.2.3.10</span> Упражнение 11.3.5.6</h4>
<div class="question">
<p>What are the most common encodings used in Europe? What are the most common encodings used in Asia? Do some googling to find out.</p>
</div>
<p>UTF-8 стандарт. Еще уважаемый Скоморохов завещал в любой непонятной ситуации юзать ютф. Вот небольшой расклад по странам и регионам.</p>
<ul>
<li>Japanese: JIS X 0208, Shift JIS, ISO-2022-JP</li>
<li>Chinese: GB 2312, GBK, GB 18030</li>
<li>Korean: KS X 1001, EUC-KR, ISO-2022-KR</li>
<li>Western European Latin script languages: ISO-8859-1, Windows-1250 (also CP-1250 for code-point)</li>
<li>Eastern European Latin script languages: ISO-8859-2, Windows-1252</li>
<li>Greek: ISO-8859-7</li>
<li>Turkish: ISO-8859-9, Windows-1254</li>
<li>Hebrew: ISO-8859-8, IBM424, Windows 1255</li>
<li>Russian: Windows 1251</li>
<li>Japanese: Shift JIS, ISO-2022-JP, EUC-JP</li>
<li>Korean: ISO-2022-KR, EUC-KR</li>
<li>Chinese: GB18030, ISO-2022-CN (Simplified), Big5 (Traditional)</li>
<li>Arabic: ISO-8859-6, IBM420, Windows 1256</li>
</ul>
<p>почитать <a href="http://kunststube.net/encoding/">http://kunststube.net/encoding/</a></p>
</div>
<div id="-11.3.5.7" class="section level4">
<h4><span class="header-section-number">3.2.3.11</span> Упражнение 11.3.5.7</h4>
<div class="question">
<p>enerate the correct format string to parse each of the following dates and times:</p>
</div>
<div class="sourceCode" id="cb633"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb633-1" data-line-number="1">d1 &lt;-<span class="st"> &quot;January 1, 2010&quot;</span></a>
<a class="sourceLine" id="cb633-2" data-line-number="2">d2 &lt;-<span class="st"> &quot;2015-Mar-07&quot;</span></a>
<a class="sourceLine" id="cb633-3" data-line-number="3">d3 &lt;-<span class="st"> &quot;06-Jun-2017&quot;</span></a>
<a class="sourceLine" id="cb633-4" data-line-number="4">d4 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;August 19 (2015)&quot;</span>, <span class="st">&quot;July 1 (2015)&quot;</span>)</a>
<a class="sourceLine" id="cb633-5" data-line-number="5">d5 &lt;-<span class="st"> &quot;12/30/14&quot;</span> <span class="co"># Dec 30, 2014</span></a>
<a class="sourceLine" id="cb633-6" data-line-number="6">t1 &lt;-<span class="st"> &quot;1705&quot;</span></a>
<a class="sourceLine" id="cb633-7" data-line-number="7">t2 &lt;-<span class="st"> &quot;11:15:10.12 PM&quot;</span></a></code></pre></div>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb634-1" data-line-number="1"><span class="kw">parse_date</span>(d1, <span class="st">&quot;%B %d, %Y&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2010-01-01&quot;</code></pre>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb636-1" data-line-number="1"><span class="kw">parse_date</span>(d2, <span class="st">&quot;%Y-%b-%d&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2015-03-07&quot;</code></pre>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb638-1" data-line-number="1"><span class="kw">parse_date</span>(d3, <span class="st">&quot;%d-%b-%Y&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-06-06&quot;</code></pre>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb640-1" data-line-number="1"><span class="kw">parse_date</span>(d4, <span class="st">&quot;%B %d (%Y)&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2015-08-19&quot; &quot;2015-07-01&quot;</code></pre>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb642-1" data-line-number="1"><span class="kw">parse_date</span>(d5, <span class="st">&quot;%m/%d/%y&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2014-12-30&quot;</code></pre>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb644-1" data-line-number="1"><span class="kw">parse_time</span>(t1, <span class="st">&quot;%H%M&quot;</span>)</a></code></pre></div>
<pre><code>## 17:05:00</code></pre>
<div class="sourceCode" id="cb646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb646-1" data-line-number="1"><span class="kw">parse_time</span>(t2, <span class="st">&quot;%H:%M:%OS %p&quot;</span>)</a></code></pre></div>
<pre><code>## 23:15:10.12</code></pre>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.2.4</span> Синтаксический анализ файлов</h3>
<p>Разберём два момента</p>
<ul>
<li><p>как пакет <code>readr</code> автоматически определяет тип каждого столбца</p></li>
<li><p>как изменить параметры, заданные по умолчанию</p></li>
</ul>
<div class="section level4">
<h4><span class="header-section-number">3.2.4.1</span> Стратегия</h4>
<p>Для определения каждого типа столбца используется эвристический подход — берутся первые 1000 строк, и для определения типа столбцов используются эвристические алгоритмы. Это выглядит примерно так — функция <code>guess_parser</code> возвращает наилучшую догадку, <code>parse_guess</code> - использует эту догадку для анализа столбца.</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb648-1" data-line-number="1"><span class="kw">guess_parser</span>(<span class="st">&quot;2010-10-01&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;date&quot;</code></pre>
<div class="sourceCode" id="cb650"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb650-1" data-line-number="1"><span class="kw">guess_parser</span>(<span class="st">&quot;15:01&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;time&quot;</code></pre>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb652-1" data-line-number="1"><span class="kw">guess_parser</span>(<span class="kw">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;logical&quot;</code></pre>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb654-1" data-line-number="1"><span class="kw">guess_parser</span>(<span class="kw">c</span>(<span class="st">&quot;1&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;9&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb656-1" data-line-number="1"><span class="kw">guess_parser</span>(<span class="kw">c</span>(<span class="st">&quot;12,352,561&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;number&quot;</code></pre>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb658-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">parse_guess</span>(<span class="st">&quot;2010-10-10&quot;</span>))</a></code></pre></div>
<pre><code>##  Date[1:1], format: &quot;2010-10-10&quot;</code></pre>
<p>Эвристика подсчитывает каждый из перечисленных ниже типов, останавливая процесс в случае совпадения:</p>
<ul>
<li>logical: содержит только “F”, “T”, “FALSE”, or “TRUE”.</li>
<li>integer: содержит тольцо цифровые символы и ещё <code>-</code>.</li>
<li>double: содержит только допустимые вещественные числа (включая <code>4.5e-5</code>).</li>
<li>number: содержит вещественные числа с разделителями групп разрядов</li>
<li>time: соответствует формату <code>time_format</code>, заданному по умолчанию</li>
<li>date: соответствует формату <code>date_format</code>, заданному по умолчанию</li>
<li>date-time: любая дата в формате ISO8601</li>
</ul>
<p>Если ни одно из этих правил не применимо столбец остаётся в виде вектора строк.</p>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.2.4.2</span> Проблемы</h4>
<ul>
<li><p>Первая тысяча строк может быть не показательной, вследствие чего догадки пакета <code>readr</code> окажутся не достаточно общими. Например может быть столбец вещественных значений в первых 1000 строках которого содержатся только целые числа</p></li>
<li><p>СТолбец может содержать множество отсутствующих значений. Если первая тысяча строк содержит лишь значения <code>NA</code>, то пакет <code>readr</code> сочтет, что это символьный вектор, тогда как вероятно хотелось бы выбрать более специфический способ обработки</p></li>
</ul>
<p>Пакет <code>readr</code> содержит текстовый csv-файл который иллюстрирует обе проблемы</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb660-1" data-line-number="1">challenge &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>))</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   x = col_double(),
##   y = col_logical()
## )</code></pre>
<pre><code>## Warning: 1000 parsing failures.
##  row col           expected     actual                                                                                         file
## 1001   y 1/0/T/F/TRUE/FALSE 2015-01-16 &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1002   y 1/0/T/F/TRUE/FALSE 2018-05-18 &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1003   y 1/0/T/F/TRUE/FALSE 2015-09-05 &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1004   y 1/0/T/F/TRUE/FALSE 2012-11-28 &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1005   y 1/0/T/F/TRUE/FALSE 2020-01-13 &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## .... ... .................. .......... ............................................................................................
## See problems(...) for more details.</code></pre>
<div class="sourceCode" id="cb663"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb663-1" data-line-number="1"><span class="kw">problems</span>(challenge)</a></code></pre></div>
<pre><code>## # A tibble: 1,000 x 5
##      row col   expected      actual   file                                 
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt;                                
##  1  1001 y     1/0/T/F/TRUE… 2015-01… &#39;/Library/Frameworks/R.framework/Ver…
##  2  1002 y     1/0/T/F/TRUE… 2018-05… &#39;/Library/Frameworks/R.framework/Ver…
##  3  1003 y     1/0/T/F/TRUE… 2015-09… &#39;/Library/Frameworks/R.framework/Ver…
##  4  1004 y     1/0/T/F/TRUE… 2012-11… &#39;/Library/Frameworks/R.framework/Ver…
##  5  1005 y     1/0/T/F/TRUE… 2020-01… &#39;/Library/Frameworks/R.framework/Ver…
##  6  1006 y     1/0/T/F/TRUE… 2016-04… &#39;/Library/Frameworks/R.framework/Ver…
##  7  1007 y     1/0/T/F/TRUE… 2011-05… &#39;/Library/Frameworks/R.framework/Ver…
##  8  1008 y     1/0/T/F/TRUE… 2020-07… &#39;/Library/Frameworks/R.framework/Ver…
##  9  1009 y     1/0/T/F/TRUE… 2011-04… &#39;/Library/Frameworks/R.framework/Ver…
## 10  1010 y     1/0/T/F/TRUE… 2010-05… &#39;/Library/Frameworks/R.framework/Ver…
## # … with 990 more rows</code></pre>
<p><em>Неплохая стратегия обрабатывать столбец за столбцом пока проблемы не исчезнут.</em> В данном случае видно, что проблемы связаны со столбцом <code>x</code> — в нем за целочисленными значениями следуют хвостовые символы. Это наводит на мысль что надо использовать парсер вещественных чисел.</p>
<p>Начнем с того, что скопируем и вставим спецификаци столбца в первоначальный вызов</p>
<div class="sourceCode" id="cb665"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb665-1" data-line-number="1">challenge &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</a>
<a class="sourceLine" id="cb665-2" data-line-number="2">  <span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>),</a>
<a class="sourceLine" id="cb665-3" data-line-number="3">  <span class="dt">col_types =</span> <span class="kw">cols</span>(</a>
<a class="sourceLine" id="cb665-4" data-line-number="4">    <span class="dt">x =</span> <span class="kw">col_integer</span>(),</a>
<a class="sourceLine" id="cb665-5" data-line-number="5">    <span class="dt">y =</span> <span class="kw">col_character</span>()</a>
<a class="sourceLine" id="cb665-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb665-7" data-line-number="7">)</a></code></pre></div>
<pre><code>## Warning: 1000 parsing failures.
##  row col               expected             actual                                                                                         file
## 1001   x no trailing characters .23837975086644292 &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1002   x no trailing characters .41167997173033655 &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1003   x no trailing characters .7460716762579978  &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1004   x no trailing characters .723450553836301   &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## 1005   x no trailing characters .614524137461558   &#39;/Library/Frameworks/R.framework/Versions/3.5/Resources/library/readr/extdata/challenge.csv&#39;
## .... ... ...................... .................. ............................................................................................
## See problems(...) for more details.</code></pre>
<p>Попробуем, не получилось. Значит поправим тип столбца</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb667-1" data-line-number="1">challenge &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</a>
<a class="sourceLine" id="cb667-2" data-line-number="2">  <span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>),</a>
<a class="sourceLine" id="cb667-3" data-line-number="3">  <span class="dt">col_types =</span> <span class="kw">cols</span>(</a>
<a class="sourceLine" id="cb667-4" data-line-number="4">    <span class="dt">x =</span> <span class="kw">col_double</span>(),</a>
<a class="sourceLine" id="cb667-5" data-line-number="5">    <span class="dt">y =</span> <span class="kw">col_character</span>()</a>
<a class="sourceLine" id="cb667-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb667-7" data-line-number="7">)</a></code></pre></div>
<p>Это помогло устранить первую проблему, но если мы присмотримся к нескольким последним строкам, то заметим что они содержат даты, сохраненные в символьном векторе.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb668-1" data-line-number="1"><span class="kw">tail</span>(challenge)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##       x y         
##   &lt;dbl&gt; &lt;chr&gt;     
## 1 0.805 2019-11-21
## 2 0.164 2018-03-29
## 3 0.472 2014-08-04
## 4 0.718 2015-08-16
## 5 0.270 2020-02-04
## 6 0.608 2019-01-06</code></pre>
<p>Это можно исправить, указав что этот столбец является столбцом дат</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb670-1" data-line-number="1">challenge &lt;-<span class="st"> </span><span class="kw">read_csv</span>(</a>
<a class="sourceLine" id="cb670-2" data-line-number="2">  <span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>), </a>
<a class="sourceLine" id="cb670-3" data-line-number="3">  <span class="dt">col_types =</span> <span class="kw">cols</span>(</a>
<a class="sourceLine" id="cb670-4" data-line-number="4">    <span class="dt">x =</span> <span class="kw">col_double</span>(),</a>
<a class="sourceLine" id="cb670-5" data-line-number="5">    <span class="dt">y =</span> <span class="kw">col_date</span>()</a>
<a class="sourceLine" id="cb670-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb670-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb670-8" data-line-number="8"><span class="kw">tail</span>(challenge)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 2
##       x y         
##   &lt;dbl&gt; &lt;date&gt;    
## 1 0.805 2019-11-21
## 2 0.164 2018-03-29
## 3 0.472 2014-08-04
## 4 0.718 2015-08-16
## 5 0.270 2020-02-04
## 6 0.608 2019-01-06</code></pre>
<p>Для каждой функции <code>parse_xyz()</code> имеется соответствующая функция <code>col_xyz()</code>. Функция <code>parse_xyz()</code> используется в тех случаях, когда данные уже находятся в R в виде символьного вектора, а функция <code>col_xyz()</code> — когда нужно сообщить пакету <code>readr</code> как нужно загружать данные.</p>
<p>Нам рекомендуют всегда предоставлять типы столбцов, отталкиваясь от вывода, обеспечиваемого пакетом <code>readr</code>. Так наш сценарий импорта данных всегда будет согласованным и воспроизводимым.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.2.4.3</span> Другие страгтегии</h4>
<p>Существует несколько других общих стратегий</p>
<ul>
<li>В предыдущем примере нам просто не повезло, стоило просмтротреть файла всего на одну строку больше, и мы могли бы кооректно выпонлить анализз одним махом:</li>
</ul>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb672-1" data-line-number="1">(challenge2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>), <span class="dt">guess_max =</span> <span class="dv">1001</span>))</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   x = col_double(),
##   y = col_date(format = &quot;&quot;)
## )</code></pre>
<pre><code>## # A tibble: 2,000 x 2
##        x y         
##    &lt;dbl&gt; &lt;date&gt;    
##  1   404 NA        
##  2  4172 NA        
##  3  3004 NA        
##  4   787 NA        
##  5    37 NA        
##  6  2332 NA        
##  7  2489 NA        
##  8  1449 NA        
##  9  3665 NA        
## 10  3863 NA        
## # … with 1,990 more rows</code></pre>
<ul>
<li>Иногда проще всего диагностировать проблему, прочитав все столбцы как символьные векторы</li>
</ul>
<div class="sourceCode" id="cb675"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb675-1" data-line-number="1">challenge2 &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="kw">readr_example</span>(<span class="st">&quot;challenge.csv&quot;</span>),</a>
<a class="sourceLine" id="cb675-2" data-line-number="2">                       <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">.default =</span> <span class="kw">col_character</span>()))</a></code></pre></div>
<p>Такой подход особенно полезно использовать в сочетании с функцией <code>type_convert()</code>. Она применяет эти эвристики парсинга к символьным столбцам фрейма данных.</p>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb676-1" data-line-number="1">(df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb676-2" data-line-number="2">  <span class="op">~</span>x, <span class="op">~</span>y,</a>
<a class="sourceLine" id="cb676-3" data-line-number="3">  <span class="st">&quot;1&quot;</span>, <span class="st">&quot;1.21&quot;</span>,</a>
<a class="sourceLine" id="cb676-4" data-line-number="4">  <span class="st">&quot;2&quot;</span>, <span class="st">&quot;2.32&quot;</span>,</a>
<a class="sourceLine" id="cb676-5" data-line-number="5">  <span class="st">&quot;3&quot;</span>, <span class="st">&quot;4.56&quot;</span></a>
<a class="sourceLine" id="cb676-6" data-line-number="6">))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   x     y    
##   &lt;chr&gt; &lt;chr&gt;
## 1 1     1.21 
## 2 2     2.32 
## 3 3     4.56</code></pre>
<p>Были строковые значения</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb678-1" data-line-number="1"><span class="co"># обратите внимание на типы столбцов</span></a>
<a class="sourceLine" id="cb678-2" data-line-number="2"><span class="kw">type_convert</span>(df)</a></code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   x = col_double(),
##   y = col_double()
## )</code></pre>
<pre><code>## # A tibble: 3 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1  1.21
## 2     2  2.32
## 3     3  4.56</code></pre>
<p>Оп и теперь это числа, целые и натуральные</p>
<ul>
<li><p>При чтении очень больших файлов имеет смысл установить для параметра <code>n_max</code> меньшее значение например 100.000 или около того. Это ускорит итерации по странению распространенных проблем</p></li>
<li><p>В случае более сложных проблем иногда проще читать данные в символьный вектор строк с помощью функции <code>read_lines()</code> или даже в символьный вектор длинной 1 с помощью функции <code>read_file()</code>. После этого вы сможете применить методы синтаксического анализа строк, с которыми ознакомитесь позже</p></li>
</ul>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.2.5</span> Запись в файл</h3>
<p>В пакете <code>readr</code> есть две функции <code>write_csv()</code> и <code>write_tsv()</code>, которые практически гарантируют что данные будут считываться корректно, потому что</p>
<ul>
<li><p>функции всегда используеют кодировку UTF8</p></li>
<li><p>всегда сохраняют календарные даты и время в формате ISO8601, и поэтому их последующий парсинг на других компьютерах не будет вызывать проблем</p></li>
</ul>
<p>Можно экспортировать csv сразу в эксель при помощи функции <code>write_excel_csv()</code> вероятно тоже бывает полезно. <code>x</code> — сам файл, <code>path</code> — расположение, в котором должен быть сохранён файл, <code>na</code> — как должны записываться отсутствующие данные</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb681-1" data-line-number="1"><span class="kw">write_csv</span>(challenge, <span class="st">&quot;challenge.csv&quot;</span>)</a></code></pre></div>
<p>Заметим однако, что при сохранении информация о типах теряется.</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb682-1" data-line-number="1">challenge</a></code></pre></div>
<pre><code>## # A tibble: 2,000 x 2
##        x y         
##    &lt;dbl&gt; &lt;date&gt;    
##  1   404 NA        
##  2  4172 NA        
##  3  3004 NA        
##  4   787 NA        
##  5    37 NA        
##  6  2332 NA        
##  7  2489 NA        
##  8  1449 NA        
##  9  3665 NA        
## 10  3863 NA        
## # … with 1,990 more rows</code></pre>
<p>Для кэширования csv-файлы не надёжны. Но в подобных ситуациях можно действовать двумя способами</p>
<ul>
<li>Можно воспользоваться функциями <code>write_rds()</code> и <code>read_rds</code>, которые служат оболочками для базовых функций <code>saveRDS()</code> и <code>readRDS()</code>. Они сохраняют данные в настриваемом двоичном формате R, носящем название RDS</li>
</ul>
<div class="sourceCode" id="cb684"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb684-1" data-line-number="1"><span class="kw">write_rds</span>(challenge, <span class="st">&quot;challenge.rds&quot;</span>)</a>
<a class="sourceLine" id="cb684-2" data-line-number="2"><span class="kw">read_rds</span>(<span class="st">&quot;challenge.rds&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2,000 x 2
##        x y         
##    &lt;dbl&gt; &lt;date&gt;    
##  1   404 NA        
##  2  4172 NA        
##  3  3004 NA        
##  4   787 NA        
##  5    37 NA        
##  6  2332 NA        
##  7  2489 NA        
##  8  1449 NA        
##  9  3665 NA        
## 10  3863 NA        
## # … with 1,990 more rows</code></pre>
<ul>
<li>Пакет <code>feather</code> реализует быстрый двоичный формат файлов совместимый с другими языками программирования.</li>
</ul>
<div class="sourceCode" id="cb686"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb686-1" data-line-number="1"><span class="co">#install.packages(&quot;feather&quot;)</span></a>
<a class="sourceLine" id="cb686-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;feather&quot;</span>)</a>
<a class="sourceLine" id="cb686-3" data-line-number="3"><span class="kw">write_feather</span>(challenge, <span class="st">&quot;challenge.feather&quot;</span>)</a>
<a class="sourceLine" id="cb686-4" data-line-number="4"><span class="kw">read_feather</span>(<span class="st">&quot;challenge.feather&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2,000 x 2
##        x y         
##    &lt;dbl&gt; &lt;date&gt;    
##  1   404 NA        
##  2  4172 NA        
##  3  3004 NA        
##  4   787 NA        
##  5    37 NA        
##  6  2332 NA        
##  7  2489 NA        
##  8  1449 NA        
##  9  3665 NA        
## 10  3863 NA        
## # … with 1,990 more rows</code></pre>
<p>Обычно пакет работает быстрее RDS и преминим вне R.</p>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.2.6</span> Другие типы данных</h3>
<p>Для переменщения других типов в R рекомендуют:</p>
<ul>
<li><p>Пакет <code>haven</code> читает файлы приложений SPSS, Stata, SAS</p></li>
<li><p>Пакет <code>readxl</code> читает файлы Эксель</p></li>
<li><p>Пакет <code>DBI</code> совместно с серверами баз данных обеспечивает выполнение SQL-запросов к базам данных и возвращение фреймов данных.</p></li>
<li><p><code>jsonlite</code> для чтения JSON</p></li>
<li><p><code>xml2</code> для XML</p></li>
</ul>
<!--chapter:end:08_data_import.Rmd-->
</div>
</div>
<div id="-----tidyr" class="section level2">
<h2><span class="header-section-number">3.3</span> Аккуратизация данных с помощью пакета <code>tidyr</code></h2>
<div id="-6" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Введение</h3>
<p>В этой главе будем узнавать что такое аккуратные данные. Больше про это рассказал Хэдли Уикем в своей <a href="http://www.jstatsoft.org/v59/i10/paper">статье</a></p>
<div id="--3" class="section level4">
<h4><span class="header-section-number">3.3.1.1</span> Необходимые ресурсы</h4>
<p>Подключаем библиотеку</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb688-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Аккуратные данные</h3>
<p>Существует три правила, соблюдение которых делает набор данных аккуратным:</p>
<ul>
<li><p>каждая переменная должна иметь собственный столбец</p></li>
<li><p>каждое наблюдение должно иметь собственную строку</p></li>
<li><p>каждое значение должно иметь собственную ячейку</p></li>
</ul>
<p>Все они взаимосвязаны — без одного не может быть дву других. Всё это хорошо иллюстрирует изображение</p>
<div class="figure">
<img src="img/tidy-1.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Всё можно упростить до двух правил</p>
<ol style="list-style-type: decimal">
<li><p>Помещать каждый набор данных в tibble-фрейм</p></li>
<li><p>Помещеать каждую переменную в столбец</p></li>
</ol>
<p>В учебнике было не понятно почему на оси лет такое странное отображение годов.</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb689-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)</a>
<a class="sourceLine" id="cb689-2" data-line-number="2"><span class="kw">ggplot</span>(table1, <span class="kw">aes</span>(year, cases)) <span class="op">+</span></a>
<a class="sourceLine" id="cb689-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb689-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> country)) </a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-380-1.png" width="672" /></p>
<p>Но когда построил сам врубился — между точками построения двух годов программа просто добавила 4 промежутка по 0.25</p>
<div id="-12.2.1.1" class="section level4">
<h4><span class="header-section-number">3.3.2.1</span> Упражнения 12.2.1.1</h4>
<div class="question">
<p>Using prose, describe how the variables and observations are organised in each of the sample tables</p>
</div>
<div class="sourceCode" id="cb690"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb690-1" data-line-number="1">table1</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb692-1" data-line-number="1">table2</a></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb694-1" data-line-number="1">table3</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb696-1" data-line-number="1">table4a</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb698-1" data-line-number="1">table4b</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country         `1999`     `2000`
## * &lt;chr&gt;            &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan   19987071   20595360
## 2 Brazil       172006362  174504898
## 3 China       1272915272 1280428583</code></pre>
<ol style="list-style-type: decimal">
<li>Таблица 1</li>
</ol>
<p>Таблица состоит из четырех столбцов-переменных.
Первый столбец — категориальная переменная, в которую входят названия трёх стран.
Второй столбец — это тоже категориальная переменная, в которой содержатся года в которые происходили наблюдения их два.
Третий столбец — это непрерывная переменная “случаи”, которая показывает количество случаев происходящих в каждой стране в указанный год
Четвёртый столбец — тоже непрерывная переменная, которая показывает количество населения соотвтствующее комбинации страна-год-случай</p>
<p>Или если совсем просто:</p>
<ul>
<li>Одно наблюдение соответствует одной строке.</li>
<li>Одна переменная соответствует одному наблюдению.</li>
<li>Одна ячейка соответствует одному значению.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Таблица 2</li>
</ol>
<ul>
<li>Одно наблюдение разбито переменной (type) на две строки. В остальном, всё хорошо:</li>
<li>Одна переменная соответствует одному столбцу</li>
<li>Одна ячейка соответствует одному значению.</li>
</ul>
<ol style="list-style-type: decimal">
<li>Таблица 3</li>
</ol>
<ul>
<li>Одно наблюдение соответствует одной строке.</li>
<li>Одна переменная соответствует одному наблюдению.</li>
<li>Но в одной ячейке содержится два значения — (cases/population)</li>
</ul>
<ol style="list-style-type: decimal">
<li>Таблицы 4а, 4b</li>
</ol>
<p>В отдельности эти таблицы являются аккуратными. Но так как они описывают одно измерение, произведено неудобное разделение по переменным —- (cases) таблица <code>а</code> и (population) таблица <code>b</code></p>
</div>
<div id="-12.2.1.2" class="section level4">
<h4><span class="header-section-number">3.3.2.2</span> Упражнения 12.2.1.2</h4>
<div class="question">
<p>Compute the rate for table2, and table4a + table4b. You will need to perform four operations:</p>
<ol style="list-style-type: lower-alpha">
<li>Extract the number of TB cases per country per year.</li>
<li>Extract the matching population per country per year.</li>
<li>Divide cases by population, and multiply by 10000.</li>
<li>Store back in the appropriate place.</li>
<li>Which representation is easiest to work with? Which is hardest? Why?
</div></li>
</ol>
</div>
<ol style="list-style-type: lower-alpha">
<li>Не очень хорошо получилось. Потому что это просто один столбец значений, без указания года в котором произошло событие.</li>
</ol>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb700-1" data-line-number="1">t2_cases &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>)           <span class="co"># Извлекаем число случаев заболевания</span></a>
<a class="sourceLine" id="cb700-2" data-line-number="2">t2_population &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;population&quot;</span>) <span class="co"># Извлекаем число популяции</span></a>
<a class="sourceLine" id="cb700-3" data-line-number="3">t2_rate &lt;-<span class="st"> </span>t2_cases<span class="op">$</span>count <span class="op">/</span><span class="st"> </span>t2_population<span class="op">$</span>count <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>     <span class="co"># Находим отношение</span></a>
<a class="sourceLine" id="cb700-4" data-line-number="4">rate &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(t2_rate)                            <span class="co"># Сохраняем куда-то</span></a></code></pre></div>
<pre><code>## Warning: Calling `as_tibble()` on a vector is discouraged, because the behavior is likely to change in the future. Use `enframe(name = NULL)` instead.
## This warning is displayed once per session.</code></pre>
<p>Поэтому немного переделаем, чтобы было по красоте</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb702-1" data-line-number="1">t2_cases &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;cases&quot;</span>) <span class="op">%&gt;%</span><span class="st">            </span><span class="co"># Извлекаем число случаев заболевания</span></a>
<a class="sourceLine" id="cb702-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">cases =</span> count) <span class="op">%&gt;%</span><span class="st">                                </span><span class="co"># Переименовываем стобец</span></a>
<a class="sourceLine" id="cb702-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(country, year)                                   <span class="co"># Сортируем, чтобы избежать ошибок</span></a>
<a class="sourceLine" id="cb702-4" data-line-number="4">t2_population &lt;-<span class="st"> </span><span class="kw">filter</span>(table2, type <span class="op">==</span><span class="st"> &quot;population&quot;</span>) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># Действуем по аналогии и для популяции</span></a>
<a class="sourceLine" id="cb702-5" data-line-number="5"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">population =</span> count) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb702-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(country, year)</a>
<a class="sourceLine" id="cb702-7" data-line-number="7">t2_rate &lt;-<span class="st"> </span>t2_cases <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb702-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">population =</span> t2_population<span class="op">$</span>population,            <span class="co"># Добавляем переменную популяции</span></a>
<a class="sourceLine" id="cb702-9" data-line-number="9">         <span class="dt">cases_per_cap =</span> (cases <span class="op">/</span><span class="st"> </span>population) <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># Добавляем переменную с отношением</span></a>
<a class="sourceLine" id="cb702-10" data-line-number="10"><span class="st">  </span><span class="kw">select</span>(country, year, cases_per_cap)                     <span class="co"># Оставляем только нужное</span></a></code></pre></div>
<ol start="2" style="list-style-type: lower-alpha">
<li>Грязненько это вот так. Разделить отдельно каждый год, и объединить полученные вектора в одну матрицу, а её превратить в тиббл таблицу. Это решение в лоб.</li>
</ol>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb703-1" data-line-number="1">table4_<span class="dv">1999</span> &lt;-<span class="st"> </span>table4a<span class="op">$</span><span class="st">`</span><span class="dt">1999</span><span class="st">`</span> <span class="op">/</span><span class="st"> </span>table4b<span class="op">$</span><span class="st">`</span><span class="dt">1999</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb703-2" data-line-number="2">table4_<span class="dv">2000</span> &lt;-<span class="st"> </span>table4a<span class="op">$</span><span class="st">`</span><span class="dt">2000</span><span class="st">`</span> <span class="op">/</span><span class="st"> </span>table4b<span class="op">$</span><span class="st">`</span><span class="dt">2000</span><span class="st">`</span> <span class="op">*</span><span class="st"> </span><span class="dv">10000</span></a>
<a class="sourceLine" id="cb703-3" data-line-number="3">table4_rate &lt;-<span class="st"> </span><span class="kw">as.tibble</span>(<span class="kw">cbind</span>(table4_<span class="dv">1999</span>, table4_<span class="dv">2000</span>))</a></code></pre></div>
<p>Элегантнее вот так вот:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb704-1" data-line-number="1">table4c &lt;-</a>
<a class="sourceLine" id="cb704-2" data-line-number="2"><span class="st">  </span><span class="kw">tibble</span>(<span class="dt">country =</span> table4a<span class="op">$</span>country,</a>
<a class="sourceLine" id="cb704-3" data-line-number="3">         <span class="st">`</span><span class="dt">1999</span><span class="st">`</span> =<span class="st"> </span>table4a[[<span class="st">&quot;1999&quot;</span>]] <span class="op">/</span><span class="st"> </span>table4b[[<span class="st">&quot;1999&quot;</span>]] <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>,</a>
<a class="sourceLine" id="cb704-4" data-line-number="4">         <span class="st">`</span><span class="dt">2000</span><span class="st">`</span> =<span class="st"> </span>table4a[[<span class="st">&quot;2000&quot;</span>]] <span class="op">/</span><span class="st"> </span>table4b[[<span class="st">&quot;2000&quot;</span>]] <span class="op">*</span><span class="st"> </span><span class="dv">10000</span>)</a></code></pre></div>
<p>Я уже говорил выше, что таблицы 4а и 4b в отрыве друг от друга аккуратные tibble таблицы. Поэтому с ними проще и приятнее работать, чем с “грязной” таблицей номер 2.</p>
</div>
<div id="-12.2.1.3" class="section level4">
<h4><span class="header-section-number">3.3.2.3</span> Упражнения 12.2.1.3</h4>
<div class="question">
<p>Recreate the plot showing change in cases over time using table2 instead of table1. What do you need to do first?</p>
</div>
<p>Для того чтобы построить график, нужно для начала высчитать то, что мы проделали в упражнении 2: извлечь все значения для каждого года в отдельности.</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb705-1" data-line-number="1"><span class="kw">ggplot</span>(t2_rate, <span class="kw">aes</span>(year, cases_per_cap)) <span class="op">+</span></a>
<a class="sourceLine" id="cb705-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">color =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb705-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> country))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-386-1.png" width="672" /></p>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">3.3.3</span> Рассредоточение и сведение столбцов</h3>
<p>Чаще всего придётся иметь дело с неаккуратными данными, потому что</p>
<ul>
<li><p>Большинство людей не знакомы с принципами аккуратных данных</p></li>
<li><p>Чаще всего данные используют таким образом чтобы упростить ввод, а не анализ</p></li>
</ul>
<p>Для большинства видов практического анализа мне чаще всего предстоит приводить данные в аккуратный вид. Для это прежде всего предстоит выяснить какие переменные и наблюдения имеются — что у нас в столбцах и что в строках. Иногда это бывает просто, но в большинстве случаев необходимо интервьюировать тех людей, которые эти данные вносили. На этом этапе как правило предстоит реашть одну из некоторых задач:</p>
<ul>
<li><p>одна перменная может быть разнесена по нескольким столбцам</p></li>
<li><p>одно наблюдение может быть рассредоточено по нескольким строкам</p></li>
</ul>
<p>Типичные наборы данных страдают одним из этих недостатков. Столкнувшись сразу с двумя из них надо понимать, что мне крупно неповезло. Чтобы решать эти проблемы мне пригодятся две функции <code>gather()</code> и <code>spread()</code>.</p>
<div id="--gather" class="section level4">
<h4><span class="header-section-number">3.3.3.1</span> Сведение столбцов (gather)</h4>
<p>На примере набора данных <code>table4a</code> покажем что часто названия столбцов являются значениями переменных</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb706-1" data-line-number="1">table4a</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   country     `1999` `2000`
## * &lt;chr&gt;        &lt;int&gt;  &lt;int&gt;
## 1 Afghanistan    745   2666
## 2 Brazil       37737  80488
## 3 China       212258 213766</code></pre>
<p>Названия столбцов здесь <code>1999</code> и <code>2000</code> это значения перменной <code>year</code>, а каждая строка представляет два наблюдения, а не одно</p>
<p>ЧТобы привести набор данных, подобный этому к аккуратному виду, мы должны свести стобцы в новую пару переменных. Для описания этой операции нам понадобится следующие три параметра</p>
<ul>
<li><p>Набор столбцов, которые прдеставляют значения, а не переменные. В данном примере таковым являются стобцы <code>1999</code> и <code>2000</code>.</p></li>
<li><p>Имя переменной, значения которой образуют имена столбцов. Этот парамер <code>key</code>, а переменная в данном примере является <code>year</code>.</p></li>
<li><p>Имя переменной, значения которой рассредоточены по ячейкам. Это параметр <code>value</code>, а переменной в данном случае является количество случаев заболевания.</p></li>
</ul>
<p>Все эти параметры используются при вызове функции <code>gather()</code></p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb708-1" data-line-number="1">table4a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb708-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year   cases
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Brazil      1999   37737
## 3 China       1999  212258
## 4 Afghanistan 2000    2666
## 5 Brazil      2000   80488
## 6 China       2000  213766</code></pre>
<p>Наглядно это делается следующим образом:
<img src="img/tidy-9.png" alt="alt text" /></p>
<p>Столбцы, которые необходимо светсти, указываются с использованием нотации в стиле <code>dplyr::select()</code>. В данном случае таких столбцов только два, поэтому мы задаем их по отдельности.</p>
<p>ТО же самое проделывается по сути и для популяции</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb710-1" data-line-number="1">table4b <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb710-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;population&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year  population
##   &lt;chr&gt;       &lt;chr&gt;      &lt;int&gt;
## 1 Afghanistan 1999    19987071
## 2 Brazil      1999   172006362
## 3 China       1999  1272915272
## 4 Afghanistan 2000    20595360
## 5 Brazil      2000   174504898
## 6 China       2000  1280428583</code></pre>
<p>А теперь, чтобы их свести используется функция, о которой я узнаю чуть позже. Она чудесным образом (пока что)
объединяет фреймы данных</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb712-1" data-line-number="1">tidy4a &lt;-<span class="st"> </span>table4a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb712-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</a>
<a class="sourceLine" id="cb712-3" data-line-number="3">tidy4b &lt;-<span class="st"> </span>table4b <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb712-4" data-line-number="4"><span class="st">  </span><span class="kw">gather</span>(<span class="st">`</span><span class="dt">1999</span><span class="st">`</span>, <span class="st">`</span><span class="dt">2000</span><span class="st">`</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;population&quot;</span>)</a>
<a class="sourceLine" id="cb712-5" data-line-number="5"></a>
<a class="sourceLine" id="cb712-6" data-line-number="6"><span class="kw">left_join</span>(tidy4a, tidy4b)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;country&quot;, &quot;year&quot;)</code></pre>
<pre><code>## # A tibble: 6 x 4
##   country     year   cases population
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan 1999     745   19987071
## 2 Brazil      1999   37737  172006362
## 3 China       1999  212258 1272915272
## 4 Afghanistan 2000    2666   20595360
## 5 Brazil      2000   80488  174504898
## 6 China       2000  213766 1280428583</code></pre>
<p>Очень полезная функция для объединения столбцов.</p>
</div>
<div id="--spreading" class="section level4">
<h4><span class="header-section-number">3.3.3.2</span> Рассредоточение столбцов (spreading)</h4>
<p>Это, по сути обратная операция сбору столбцов. Эту операцию используют когда наблюдения разбиты по нескольким строкам. Как в случае, например <code>table2</code> — наблюдением является страна, в определённом году, но каждое наблюдение распределно по двум строкам</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb715-1" data-line-number="1">table2</a></code></pre></div>
<pre><code>## # A tibble: 12 x 4
##    country      year type            count
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 Afghanistan  1999 cases             745
##  2 Afghanistan  1999 population   19987071
##  3 Afghanistan  2000 cases            2666
##  4 Afghanistan  2000 population   20595360
##  5 Brazil       1999 cases           37737
##  6 Brazil       1999 population  172006362
##  7 Brazil       2000 cases           80488
##  8 Brazil       2000 population  174504898
##  9 China        1999 cases          212258
## 10 China        1999 population 1272915272
## 11 China        2000 cases          213766
## 12 China        2000 population 1280428583</code></pre>
<p>Чтобы привести эту таблицу к аккуратному виду, необъодимо определить ключевой столбец с названиями переменных. В данном примере это столбец <code>type</code>. И определить столбец со значениями переменных, это столбец <code>count</code>. Как только мы это определили можно использовать функцию <code>spread()</code>.</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb717-1" data-line-number="1"><span class="kw">spread</span>(table2, <span class="dt">key =</span> type, <span class="dt">value =</span> count)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Схематично это выглядит так, как показано на картинке:</p>
<div class="figure">
<img src="img/tidy-8.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Обе рассмотренные в этом параграфе функции <code>gather()</code> и <code>spread()</code> взаимодополняемые. Первая делает таблицы уже и длиннее, вторая длинные таблицы шире и короче</p>
</div>
<div id="-12.3.3.1" class="section level4">
<h4><span class="header-section-number">3.3.3.3</span> Упражнение 12.3.3.1</h4>
<div class="question">
<p>Why are <code>gather()</code> and <code>spread()</code> not perfectly symmetrical?
Carefully consider the following example:</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb719-1" data-line-number="1">stocks &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb719-2" data-line-number="2">  <span class="dt">year   =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2016</span>),</a>
<a class="sourceLine" id="cb719-3" data-line-number="3">  <span class="dt">half  =</span> <span class="kw">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,     <span class="dv">1</span>,    <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb719-4" data-line-number="4">  <span class="dt">return =</span> <span class="kw">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>)</a>
<a class="sourceLine" id="cb719-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb719-6" data-line-number="6">stocks <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb719-7" data-line-number="7"><span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb719-8" data-line-number="8"><span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;return&quot;</span>, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##    half year  return
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1     1 2015    1.88
## 2     2 2015    0.59
## 3     1 2016    0.92
## 4     2 2016    0.17</code></pre>
<p>(Hint: look at the variable types and think about column names.)</p>
<p>Both <code>spread()</code> and <code>gather()</code> have a <code>convert</code> argument. What does it do?</p>
</div>
<p>В объявленной переменной столбцы это численные значения с типом данных <code>&lt;dbl&gt;</code>. Функция <code>spread()</code> разбивает столбец <code>year</code> с числовыми значениями и делает из них названия столбцов. Затем функция <code>gather()</code> из названий столбцов делает значения для новой переменной. Новая переменная получается строковой с типом данных <code>&lt;chr&gt;</code>. Именно поэтому эти две функции <em>взаимодополняемые</em> а не <em>взаимообратные</em>!</p>
<p>Аргумент <code>convert()</code> позволяет конвертировать названия переменных при необходимости в числовой тип данных. По умолчанию у этого аргумента значение <code>FALSE</code>, поэтому не происходит конвертации при обычном вызове функции.</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb721-1" data-line-number="1">stocks <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb721-2" data-line-number="2"><span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb721-3" data-line-number="3"><span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;year&quot;</span>, <span class="st">&quot;return&quot;</span>, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="dt">convert =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##    half  year return
##   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;
## 1     1  2015   1.88
## 2     2  2015   0.59
## 3     1  2016   0.92
## 4     2  2016   0.17</code></pre>
<p>Забавно, однако и это не позволяет сделать эти функции идеально взаимообратными, по скольку даже в этом примере видно, что сконвертированная перменная имеет тип данных <code>&lt;int&gt;</code>, вместо изначального <code>&lt;dbl&gt;</code>.</p>
</div>
<div id="-12.3.3.2" class="section level4">
<h4><span class="header-section-number">3.3.3.4</span> Упражнение 12.3.3.2</h4>
<div class="question">
<p>Why does this code fail?</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb723-1" data-line-number="1"><span class="co"># table4a %&gt;% </span></a>
<a class="sourceLine" id="cb723-2" data-line-number="2"><span class="co">#  gather(1999, 2000, key = &quot;year&quot;, value = &quot;cases&quot;)</span></a></code></pre></div>
</div>
<p>Потому что названия столбцов здесь указаны числами в явном виде. Тогда как для того чтобы объявить числовые названия столбцов необходимо заключить их в апострофы</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb724-1" data-line-number="1">table4a <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb724-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(<span class="st">&#39;1999&#39;</span>, <span class="st">&#39;2000&#39;</span>, <span class="dt">key =</span> <span class="st">&quot;year&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     year   cases
##   &lt;chr&gt;       &lt;chr&gt;  &lt;int&gt;
## 1 Afghanistan 1999     745
## 2 Brazil      1999   37737
## 3 China       1999  212258
## 4 Afghanistan 2000    2666
## 5 Brazil      2000   80488
## 6 China       2000  213766</code></pre>
</div>
<div id="-12.3.3.3" class="section level4">
<h4><span class="header-section-number">3.3.3.5</span> Упражнение 12.3.3.3</h4>
<div class="question">
<p>Why does spreading this tibble fail? How could you add a new column to fix the problem?</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb726-1" data-line-number="1"><span class="co"># people &lt;- tribble(</span></a>
<a class="sourceLine" id="cb726-2" data-line-number="2"><span class="co">#  ~name,             ~key,    ~value,</span></a>
<a class="sourceLine" id="cb726-3" data-line-number="3"><span class="co">#  #-----------------|--------|------</span></a>
<a class="sourceLine" id="cb726-4" data-line-number="4"><span class="co">#  &quot;Phillip Woods&quot;,   &quot;age&quot;,       45,</span></a>
<a class="sourceLine" id="cb726-5" data-line-number="5"><span class="co">#  &quot;Phillip Woods&quot;,   &quot;height&quot;,   186,</span></a>
<a class="sourceLine" id="cb726-6" data-line-number="6"><span class="co">#  &quot;Phillip Woods&quot;,   &quot;age&quot;,       50,</span></a>
<a class="sourceLine" id="cb726-7" data-line-number="7"><span class="co">#  &quot;Jessica Cordero&quot;, &quot;age&quot;,       37,</span></a>
<a class="sourceLine" id="cb726-8" data-line-number="8"><span class="co">#  &quot;Jessica Cordero&quot;, &quot;height&quot;,   156</span></a>
<a class="sourceLine" id="cb726-9" data-line-number="9"><span class="co"># )</span></a></code></pre></div>
</div>
<p>Не получается выполнить разбиение по переменным, потому что не проставлен номер измерения.</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb727-1" data-line-number="1"><span class="co"># people %&gt;%</span></a>
<a class="sourceLine" id="cb727-2" data-line-number="2"><span class="co">#  mutate(observation = c(1, 1, 2, 1, 1)) %&gt;% # Проставил номер измерения</span></a>
<a class="sourceLine" id="cb727-3" data-line-number="3"><span class="co">#  spread(key, value)</span></a></code></pre></div>
</div>
<div id="-12.3.3.4" class="section level4">
<h4><span class="header-section-number">3.3.3.6</span> Упражнение 12.3.3.4</h4>
<div class="question">
<p>Tidy the simple tibble below. Do you need to spread or gather it? What are the variables?</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb728-1" data-line-number="1">preg &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb728-2" data-line-number="2">  <span class="op">~</span>pregnant, <span class="op">~</span>male, <span class="op">~</span>female,</a>
<a class="sourceLine" id="cb728-3" data-line-number="3">  <span class="st">&quot;yes&quot;</span>,     <span class="ot">NA</span>,    <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb728-4" data-line-number="4">  <span class="st">&quot;no&quot;</span>,      <span class="dv">20</span>,    <span class="dv">12</span></a>
<a class="sourceLine" id="cb728-5" data-line-number="5">)</a></code></pre></div>
</div>
<p>Для того чтобы в строках были наблюдения, а в столбца параметры, нам нужно сводить этот фрейм данных. Делать более длинную таблицу.</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb729-1" data-line-number="1">preg1 &lt;-<span class="st">  </span>preg <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb729-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(<span class="st">&quot;male&quot;</span>, <span class="st">&quot;female&quot;</span>, <span class="dt">key =</span> <span class="st">&quot;sex&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;count&quot;</span>)</a></code></pre></div>
<p>Тут можно пойти дальше и увидеть что два столбца принимают только два возможных знаения. Это значит, что их можно перевести в вектор логических значений</p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb730-1" data-line-number="1">(preg2 &lt;-<span class="st"> </span>preg1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb730-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">female =</span> sex <span class="op">==</span><span class="st"> &quot;female&quot;</span>,</a>
<a class="sourceLine" id="cb730-3" data-line-number="3">         <span class="dt">pregnant =</span> pregnant <span class="op">==</span><span class="st"> &quot;yes&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb730-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(pregnant, count, female))         <span class="co"># Для того чтобы отсечь ненужный столбец sex</span></a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   pregnant count female
##   &lt;lgl&gt;    &lt;dbl&gt; &lt;lgl&gt; 
## 1 TRUE        NA FALSE 
## 2 FALSE       20 FALSE 
## 3 TRUE        10 TRUE  
## 4 FALSE       12 TRUE</code></pre>
<p>Тут можно ещё подумать о необходимости отбросить наблюдение беременных мужчин, но об этом узнаем чуть позже.</p>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Разделение и объединение столбцов</h3>
<p>Взглянем ещё раз на фрейм данных</p>
<div class="sourceCode" id="cb732"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb732-1" data-line-number="1">table3</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country      year rate             
## * &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;            
## 1 Afghanistan  1999 745/19987071     
## 2 Afghanistan  2000 2666/20595360    
## 3 Brazil       1999 37737/172006362  
## 4 Brazil       2000 80488/174504898  
## 5 China        1999 212258/1272915272
## 6 China        2000 213766/1280428583</code></pre>
<p>В ней в одной переменной <code>rate</code> содержится два значения — <code>cases</code> и <code>population</code>, для того чтобы разделить эти переменные нам понадобится функция <code>separate()</code>.</p>
<div id="-----separate" class="section level4">
<h4><span class="header-section-number">3.3.4.1</span> Разделение столбцов при помощи функции <code>separate()</code></h4>
<p>Разделение производится всякий раз когда встречается символ разделитель. Это происходит автоматически:</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb734-1" data-line-number="1">table3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb734-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(rate, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Но можно задать разделитель в явном виде при помощи аргумента <code>sep</code></p>
<div class="sourceCode" id="cb736"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb736-1" data-line-number="1">table3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb736-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(rate, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year cases  population
##   &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;     
## 1 Afghanistan  1999 745    19987071  
## 2 Afghanistan  2000 2666   20595360  
## 3 Brazil       1999 37737  172006362 
## 4 Brazil       2000 80488  174504898 
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>Формально, <code>sep</code> это регулярное выражение, но об этом чуть позже.</p>
<p>При разделении столбцов полученные новые столбцы имеют символьный тип. Это поведение в функции <code>separate()</code> задано по умолчанию — для того чтобы оставлять тип столбца таким, какой он есть. В этой функции однако, предусмотрена возомжность конвертировать получаемые столбцы, как и у предыдущих функций этого семейства.</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb738-1" data-line-number="1">table3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb738-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(rate,</a>
<a class="sourceLine" id="cb738-3" data-line-number="3">           <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;cases&quot;</span>, <span class="st">&quot;population&quot;</span>),</a>
<a class="sourceLine" id="cb738-4" data-line-number="4">           <span class="dt">convert =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb738-5" data-line-number="5">           )</a></code></pre></div>
<pre><code>## # A tibble: 6 x 4
##   country      year  cases population
##   &lt;chr&gt;       &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
## 1 Afghanistan  1999    745   19987071
## 2 Afghanistan  2000   2666   20595360
## 3 Brazil       1999  37737  172006362
## 4 Brazil       2000  80488  174504898
## 5 China        1999 212258 1272915272
## 6 China        2000 213766 1280428583</code></pre>
<p>МОжно так же отделять столбцы по количеству символов. Это можно осуществить передавая в аргумент <code>sep</code> целочисленное значение. При этом необходимо придерживаться правил:</p>
<ul>
<li>При разбиение строк с использованием целых чисел, длина <code>sep</code> должна быть на единицу меньше количества имён в <code>into</code>.</li>
<li>Положительные значения начинаются с 1 и отсчитываются от крайней слева позиции в строках</li>
<li>Отрицательные значения начинается с -1 и отсчитываются от крайней правой позиции в строках</li>
</ul>
</div>
<div id="-----unite" class="section level4">
<h4><span class="header-section-number">3.3.4.2</span> Объединение столбцов при помощи функции <code>unite()</code></h4>
<p>Объединение используется реже, но тоже бывает полезно. Например, нам пригодится соединить два столбца, чтобы получить год</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb740-1" data-line-number="1">table5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb740-2" data-line-number="2"><span class="st">  </span><span class="kw">unite</span>(new, century, year)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     new   rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 19_99 745/19987071     
## 2 Afghanistan 20_00 2666/20595360    
## 3 Brazil      19_99 37737/172006362  
## 4 Brazil      20_00 80488/174504898  
## 5 China       19_99 212258/1272915272
## 6 China       20_00 213766/1280428583</code></pre>
<p>По умолчанию используется разделитель <code>_</code>. Нам он тут не нужен, поэтому зададим разделитель в явном виде</p>
<div class="sourceCode" id="cb742"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb742-1" data-line-number="1">table5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb742-2" data-line-number="2"><span class="st">  </span><span class="kw">unite</span>(new, century, year, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##   country     new   rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 1999  745/19987071     
## 2 Afghanistan 2000  2666/20595360    
## 3 Brazil      1999  37737/172006362  
## 4 Brazil      2000  80488/174504898  
## 5 China       1999  212258/1272915272
## 6 China       2000  213766/1280428583</code></pre>
</div>
<div id="-12.4.3.1" class="section level4">
<h4><span class="header-section-number">3.3.4.3</span> Упражнение 12.4.3.1</h4>
<div class="question">
<p>What do the extra and fill arguments do in separate()? Experiment with the various options for the following two toy datasets.</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb744-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>, <span class="st">&quot;h,i,j&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb744-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))</a></code></pre></div>
<pre><code>## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].</code></pre>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 d     e     f    
## 3 h     i     j</code></pre>
<div class="sourceCode" id="cb747"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb747-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e&quot;</span>, <span class="st">&quot;f,g,i&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb747-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>))</a></code></pre></div>
<pre><code>## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].</code></pre>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 d     e     &lt;NA&gt; 
## 3 f     g     i</code></pre>
</div>
<p>Параметр <code>extra</code> определяет что делать с переполняющими значениями. У <code>extra</code> есть три опции</p>
<div class="sourceCode" id="cb750"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb750-1" data-line-number="1">t1 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e,f,g&quot;</span>, <span class="st">&quot;h,i,j&quot;</span>))</a>
<a class="sourceLine" id="cb750-2" data-line-number="2"></a>
<a class="sourceLine" id="cb750-3" data-line-number="3"><span class="kw">separate</span>(t1, x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">extra =</span> <span class="st">&quot;warn&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Expected 3 pieces. Additional pieces discarded in 1 rows [2].</code></pre>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 d     e     f    
## 3 h     i     j</code></pre>
<div class="sourceCode" id="cb753"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb753-1" data-line-number="1"><span class="co"># «warn» (по умолчанию): выдаёт предупреждение и отбрасывает дополнительные значения.</span></a>
<a class="sourceLine" id="cb753-2" data-line-number="2"></a>
<a class="sourceLine" id="cb753-3" data-line-number="3"><span class="kw">separate</span>(t1, x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">extra =</span> <span class="st">&quot;drop&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 d     e     f    
## 3 h     i     j</code></pre>
<div class="sourceCode" id="cb755"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb755-1" data-line-number="1"><span class="co"># «drop»: отбрaсывает любые дополнительные значения без предупреждения.</span></a>
<a class="sourceLine" id="cb755-2" data-line-number="2"></a>
<a class="sourceLine" id="cb755-3" data-line-number="3"><span class="kw">separate</span>(t1, x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">extra =</span> <span class="st">&quot;merge&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 d     e     f,g  
## 3 h     i     j</code></pre>
<div class="sourceCode" id="cb757"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb757-1" data-line-number="1"><span class="co"># «merge»: добавляет переполняющие значения в месте где они есть</span></a></code></pre></div>
<p>Теперь посмотрим второй пример, и параметр <code>fill</code>. Этот параметр используется, когда не хватает значений, он определяет что делать, если значений не хватает,</p>
<div class="sourceCode" id="cb758"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb758-1" data-line-number="1">t2 &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;a,b,c&quot;</span>, <span class="st">&quot;d,e&quot;</span>, <span class="st">&quot;f,g,i&quot;</span>))</a>
<a class="sourceLine" id="cb758-2" data-line-number="2"></a>
<a class="sourceLine" id="cb758-3" data-line-number="3"><span class="kw">separate</span>(t2, x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">fill =</span> <span class="st">&quot;warn&quot;</span>)</a></code></pre></div>
<pre><code>## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1 rows [2].</code></pre>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 d     e     &lt;NA&gt; 
## 3 f     g     i</code></pre>
<div class="sourceCode" id="cb761"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb761-1" data-line-number="1"><span class="co"># «warn» (по умолчанию): выдаёт предупреждение и заполняет справа пропущенным значением NA</span></a>
<a class="sourceLine" id="cb761-2" data-line-number="2"></a>
<a class="sourceLine" id="cb761-3" data-line-number="3"><span class="kw">separate</span>(t2, x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">fill =</span> <span class="st">&quot;right&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 d     e     &lt;NA&gt; 
## 3 f     g     i</code></pre>
<div class="sourceCode" id="cb763"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb763-1" data-line-number="1"><span class="co"># заполняет справа пропущенным значение NA</span></a>
<a class="sourceLine" id="cb763-2" data-line-number="2"></a>
<a class="sourceLine" id="cb763-3" data-line-number="3"><span class="kw">separate</span>(t2, x, <span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>), <span class="dt">fill =</span> <span class="st">&quot;left&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   one   two   three
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 a     b     c    
## 2 &lt;NA&gt;  d     e    
## 3 f     g     i</code></pre>
<div class="sourceCode" id="cb765"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb765-1" data-line-number="1"><span class="co"># заполняет слева пропущенным значение NA</span></a></code></pre></div>
</div>
<div id="-12.4.3.2" class="section level4">
<h4><span class="header-section-number">3.3.4.4</span> Упражнение 12.4.3.2</h4>
<div class="question">
<p>Both <code>unite()</code> and <code>separate()</code> have a <code>remove</code> argument. What does it do? Why would you set it to FALSE?</p>
</div>
<p>Параметр <code>remove</code>, если <code>TRUE</code> удаляет входной стобец из выходных данных.</p>
<p>Входной столбец может понадобится например в случаях объединения. Когда нам важна информация во входном столбце, отдельно от объединяемого столбца. Например, в случае ниже, нам может пригодится век измерения для совокупной проверки по одному столетию</p>
<div class="sourceCode" id="cb766"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb766-1" data-line-number="1">table5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb766-2" data-line-number="2"><span class="st">  </span><span class="kw">unite</span>(new, century, year, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>, <span class="dt">remove =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 5
##   country     new   century year  rate             
##   &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;            
## 1 Afghanistan 1999  19      99    745/19987071     
## 2 Afghanistan 2000  20      00    2666/20595360    
## 3 Brazil      1999  19      99    37737/172006362  
## 4 Brazil      2000  20      00    80488/174504898  
## 5 China       1999  19      99    212258/1272915272
## 6 China       2000  20      00    213766/1280428583</code></pre>
</div>
<div id="-12.4.3.3" class="section level4">
<h4><span class="header-section-number">3.3.4.5</span> Упражнение 12.4.3.3</h4>
<div class="question">
<p>Compare and contrast <code>separate()</code> and <code>extract()</code>. Why are there three variations of separation (by position, by separator, and with groups), but only one unite?</p>
</div>
<p>Разделение при помощи <code>separate()</code> является частным и статичным, нужно знать либо разделяющий символ, либо позицию</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb768-1" data-line-number="1"><span class="co"># разделение с разделителем</span></a>
<a class="sourceLine" id="cb768-2" data-line-number="2"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;male-34&quot;</span>, <span class="st">&quot;female-12&quot;</span>, <span class="st">&quot;male-19&quot;</span>, <span class="st">&quot;female-42&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb768-3" data-line-number="3"><span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   sex    age  
##   &lt;chr&gt;  &lt;chr&gt;
## 1 male   34   
## 2 female 12   
## 3 male   19   
## 4 female 42</code></pre>
<div class="sourceCode" id="cb770"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb770-1" data-line-number="1"><span class="co"># разделение по позиции - второй с конца</span></a>
<a class="sourceLine" id="cb770-2" data-line-number="2"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;male34&quot;</span>, <span class="st">&quot;female12&quot;</span>, <span class="st">&quot;male19&quot;</span>, <span class="st">&quot;female42&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb770-3" data-line-number="3"><span class="st">  </span><span class="kw">separate</span>(x, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">2</span>))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   sex    age  
##   &lt;chr&gt;  &lt;chr&gt;
## 1 male   34   
## 2 female 12   
## 3 male   19   
## 4 female 42</code></pre>
<p>Разделение при помощи <code>extract()</code> является более гибким, поскольку для него не требуются общие разделители или конкретные позиции столбцов.</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb772-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;male-34&quot;</span>, <span class="st">&quot;female-12&quot;</span>, <span class="st">&quot;male-19&quot;</span>, <span class="st">&quot;female-42&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb772-2" data-line-number="2"><span class="st">  </span><span class="kw">extract</span>(<span class="dt">col =</span> x, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;([a-z]+)-([0-9]+)&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   sex    age  
##   &lt;chr&gt;  &lt;chr&gt;
## 1 male   34   
## 2 female 12   
## 3 male   19   
## 4 female 42</code></pre>
<p>Параметр группы задается при помощи аргумента <code>regex = &quot;([условие])-([условие])&quot;</code>. Опция <code>&quot;+&quot;</code> ставится в том случае, если необходимо взять все символы до разделителя которые соответствуют условию.</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb774-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="st">&quot;male-34&quot;</span>, <span class="st">&quot;female-12&quot;</span>, <span class="st">&quot;male-19&quot;</span>, <span class="st">&quot;female-42&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb774-2" data-line-number="2"><span class="st">  </span><span class="kw">extract</span>(<span class="dt">col =</span> x, <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">regex =</span> <span class="st">&quot;([a-z])-([0-9])&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   sex   age  
##   &lt;chr&gt; &lt;chr&gt;
## 1 e     3    
## 2 e     1    
## 3 e     1    
## 4 e     4</code></pre>
<p>Обе функции <code>separate ()</code> и <code>extract ()</code> преобразуют один столбец во многие столбцы. Однако <code>unite()</code> преобразует много столбцов в один, причем выбор разделителя включает значения столбцов.</p>
<p>Другими словами, с помощью <code>extract()</code> и <code>separate()</code> можно выбрать только один столбец, но есть много вариантов разделения этого столбца на разные столбцы. С <code>unite()</code>, есть много вариантов того, какие столбцы включать, но только один выбор, как объединить их содержимое в один вектор.</p>
</div>
</div>
<div id="--3" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Отсутствующие значения</h3>
<p>Есть два типа отсутствующих значений</p>
<ul>
<li><p>явное — имеющее маркер <code>NA</code></p></li>
<li><p>неявное — то есть буквальное отсутствие значения среди данных</p></li>
</ul>
<div class="sourceCode" id="cb776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb776-1" data-line-number="1">stocks &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb776-2" data-line-number="2">  <span class="dt">year   =</span> <span class="kw">c</span>(<span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2016</span>, <span class="dv">2016</span>),</a>
<a class="sourceLine" id="cb776-3" data-line-number="3">  <span class="dt">qtr    =</span> <span class="kw">c</span>(   <span class="dv">1</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>,    <span class="dv">2</span>,    <span class="dv">3</span>,    <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb776-4" data-line-number="4">  <span class="dt">return =</span> <span class="kw">c</span>(<span class="fl">1.88</span>, <span class="fl">0.59</span>, <span class="fl">0.35</span>,   <span class="ot">NA</span>, <span class="fl">0.92</span>, <span class="fl">0.17</span>, <span class="fl">2.66</span>)</a>
<a class="sourceLine" id="cb776-5" data-line-number="5">)</a></code></pre></div>
<ul>
<li><p>значение для 2015 года 4 квартала — явное отсутствие</p></li>
<li><p>значение для 2016 года 1 квартала — неявеное</p></li>
</ul>
<p>Можно сделать неявное отсутсвие явным:</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb777-1" data-line-number="1">stocks <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb777-2" data-line-number="2"><span class="st">  </span><span class="kw">spread</span>(year, return)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##     qtr `2015` `2016`
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1     1   1.88  NA   
## 2     2   0.59   0.92
## 3     3   0.35   0.17
## 4     4  NA      2.66</code></pre>
<p>Но по скольку эти пропущенные значения могут не играть важной роли от них можно избавиться, задав аргумент <code>na.rm = TRUE</code> и объединить столбцы.</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb779-1" data-line-number="1">stocks <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb779-2" data-line-number="2"><span class="st">  </span><span class="kw">spread</span>(year, return) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb779-3" data-line-number="3"><span class="st">  </span><span class="kw">gather</span>(year, return, <span class="st">`</span><span class="dt">2015</span><span class="st">`</span><span class="op">:</span><span class="st">`</span><span class="dt">2016</span><span class="st">`</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 6 x 3
##     qtr year  return
##   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
## 1     1 2015    1.88
## 2     2 2015    0.59
## 3     3 2015    0.35
## 4     2 2016    0.92
## 5     3 2016    0.17
## 6     4 2016    2.66</code></pre>
<p>Есть ещё функция <code>complete()</code></p>
<div class="sourceCode" id="cb781"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb781-1" data-line-number="1">stocks <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb781-2" data-line-number="2"><span class="st">  </span><span class="kw">complete</span>(year, qtr)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 3
##    year   qtr return
##   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1  2015     1   1.88
## 2  2015     2   0.59
## 3  2015     3   0.35
## 4  2015     4  NA   
## 5  2016     1  NA   
## 6  2016     2   0.92
## 7  2016     3   0.17
## 8  2016     4   2.66</code></pre>
<p>Это очень крутая функция. Она принимает набор столбцов и находит все уникальные комбинации. Далее она убеждается в том, что исходный набор данных содержит все эти значения, вставояя маркеры явного отсутствия значений (NA) там, где это необходимо.</p>
<p>Существует ещё один важный вид отсутсвующих значений. Иногда, когда источник данных используется главным образом для ввода данных, отсутствующее значение указывает на то, что предыдущее значение должно быть перенесено в следующую запись.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb783-1" data-line-number="1">treatment &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb783-2" data-line-number="2">  <span class="op">~</span><span class="st"> </span>person,           <span class="op">~</span><span class="st"> </span>treatment, <span class="op">~</span>response,</a>
<a class="sourceLine" id="cb783-3" data-line-number="3">  <span class="st">&quot;Derrick Whitmore&quot;</span>, <span class="dv">1</span>,           <span class="dv">7</span>,</a>
<a class="sourceLine" id="cb783-4" data-line-number="4">  <span class="ot">NA</span>,                 <span class="dv">2</span>,           <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb783-5" data-line-number="5">  <span class="ot">NA</span>,                 <span class="dv">3</span>,           <span class="dv">9</span>,</a>
<a class="sourceLine" id="cb783-6" data-line-number="6">  <span class="st">&quot;Katherine Burke&quot;</span>,  <span class="dv">1</span>,           <span class="dv">4</span></a>
<a class="sourceLine" id="cb783-7" data-line-number="7">)</a></code></pre></div>
<p>Как в этом случае — ячейки с именеме якобы объединены. Эти отсутствующиее значения можно заполнить с помощью функции <code>fill()</code>. Она принимает набор столбцов, отсутвующие значения в которых мы хотим заменить ближайшими предыдущими значениями, не являющиеся отсутвующими.</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb784-1" data-line-number="1">treatment <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb784-2" data-line-number="2"><span class="st">  </span><span class="kw">fill</span>(person)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   person           treatment response
##   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
## 1 Derrick Whitmore         1        7
## 2 Derrick Whitmore         2       10
## 3 Derrick Whitmore         3        9
## 4 Katherine Burke          1        4</code></pre>
<p>Это тоже очень крутая функция, которой я часто пользовался “ручками” в экселе.</p>
<div id="-12.5.1.1" class="section level4">
<h4><span class="header-section-number">3.3.5.1</span> Упражнение 12.5.1.1</h4>
<div class="question">
<p>Compare and contrast the <code>fill</code> arguments to <code>spread()</code> and <code>complete()</code>.</p>
</div>
<p>В <code>spread()</code> аргумент <code>fill</code> явно устанавливает значение для замены <code>NA</code>. В <code>complete()</code> аргумент <code>fill</code> также устанавливает значение для замены <code>NA</code>, но это именованный список, позволяющий использовать разные значения для разных переменных. Кроме того, оба случая заменяют как неявные, так и явно отсутствующие значения.</p>
<p>В <code>spread()</code> eсли установлено, отсутствующие значения будут заменены этим значением. Обратите внимание, что во входном файле есть два типа пропусков: явные пропущенные значения (т. Е. NA) и неявные пропуски, строки, которых просто нет. Оба типа недостающего значения будут заменены заполнением.</p>
<p>В <code>complete()</code> именованный список, который для каждой переменной предоставляет единственное значение для использования вместо NA для отсутствующих комбинаций.</p>
</div>
<div id="-12.5.1.2" class="section level4">
<h4><span class="header-section-number">3.3.5.2</span> Упражнение 12.5.1.2</h4>
<div class="question">
<p>What does the <code>direction</code> argument to <code>fill()</code> do?</p>
</div>
<p>Аргумент <code>direction</code> задаёт направление заполнения — по умолчанию, сверху вниз <code>&quot;down&quot;</code>, но можно поменять на снизу вверх <code>&quot;up&quot;</code></p>
<div class="sourceCode" id="cb786"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb786-1" data-line-number="1">treatment <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb786-2" data-line-number="2"><span class="st">  </span><span class="kw">fill</span>(person, <span class="dt">.direction =</span> <span class="st">&quot;up&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   person           treatment response
##   &lt;chr&gt;                &lt;dbl&gt;    &lt;dbl&gt;
## 1 Derrick Whitmore         1        7
## 2 Katherine Burke          2       10
## 3 Katherine Burke          3        9
## 4 Katherine Burke          1        4</code></pre>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Учебный пример</h3>
<p>Очень клёво — у нас типичный пример неряшливых данных. Мы будем использовать реальный пример данных о заболеваемости туберкулёзом</p>
<div class="sourceCode" id="cb788"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb788-1" data-line-number="1">who</a></code></pre></div>
<pre><code>## # A tibble: 7,240 x 60
##    country iso2  iso3   year new_sp_m014 new_sp_m1524 new_sp_m2534
##    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;int&gt;       &lt;int&gt;        &lt;int&gt;        &lt;int&gt;
##  1 Afghan… AF    AFG    1980          NA           NA           NA
##  2 Afghan… AF    AFG    1981          NA           NA           NA
##  3 Afghan… AF    AFG    1982          NA           NA           NA
##  4 Afghan… AF    AFG    1983          NA           NA           NA
##  5 Afghan… AF    AFG    1984          NA           NA           NA
##  6 Afghan… AF    AFG    1985          NA           NA           NA
##  7 Afghan… AF    AFG    1986          NA           NA           NA
##  8 Afghan… AF    AFG    1987          NA           NA           NA
##  9 Afghan… AF    AFG    1988          NA           NA           NA
## 10 Afghan… AF    AFG    1989          NA           NA           NA
## # … with 7,230 more rows, and 53 more variables: new_sp_m3544 &lt;int&gt;,
## #   new_sp_m4554 &lt;int&gt;, new_sp_m5564 &lt;int&gt;, new_sp_m65 &lt;int&gt;,
## #   new_sp_f014 &lt;int&gt;, new_sp_f1524 &lt;int&gt;, new_sp_f2534 &lt;int&gt;,
## #   new_sp_f3544 &lt;int&gt;, new_sp_f4554 &lt;int&gt;, new_sp_f5564 &lt;int&gt;,
## #   new_sp_f65 &lt;int&gt;, new_sn_m014 &lt;int&gt;, new_sn_m1524 &lt;int&gt;,
## #   new_sn_m2534 &lt;int&gt;, new_sn_m3544 &lt;int&gt;, new_sn_m4554 &lt;int&gt;,
## #   new_sn_m5564 &lt;int&gt;, new_sn_m65 &lt;int&gt;, new_sn_f014 &lt;int&gt;,
## #   new_sn_f1524 &lt;int&gt;, new_sn_f2534 &lt;int&gt;, new_sn_f3544 &lt;int&gt;,
## #   new_sn_f4554 &lt;int&gt;, new_sn_f5564 &lt;int&gt;, new_sn_f65 &lt;int&gt;,
## #   new_ep_m014 &lt;int&gt;, new_ep_m1524 &lt;int&gt;, new_ep_m2534 &lt;int&gt;,
## #   new_ep_m3544 &lt;int&gt;, new_ep_m4554 &lt;int&gt;, new_ep_m5564 &lt;int&gt;,
## #   new_ep_m65 &lt;int&gt;, new_ep_f014 &lt;int&gt;, new_ep_f1524 &lt;int&gt;,
## #   new_ep_f2534 &lt;int&gt;, new_ep_f3544 &lt;int&gt;, new_ep_f4554 &lt;int&gt;,
## #   new_ep_f5564 &lt;int&gt;, new_ep_f65 &lt;int&gt;, newrel_m014 &lt;int&gt;,
## #   newrel_m1524 &lt;int&gt;, newrel_m2534 &lt;int&gt;, newrel_m3544 &lt;int&gt;,
## #   newrel_m4554 &lt;int&gt;, newrel_m5564 &lt;int&gt;, newrel_m65 &lt;int&gt;,
## #   newrel_f014 &lt;int&gt;, newrel_f1524 &lt;int&gt;, newrel_f2534 &lt;int&gt;,
## #   newrel_f3544 &lt;int&gt;, newrel_f4554 &lt;int&gt;, newrel_f5564 &lt;int&gt;,
## #   newrel_f65 &lt;int&gt;</code></pre>
<p>По этому представлению, всё что пока что понятно это:</p>
<ul>
<li><p>Для определения страны используется избыточное количество переменных</p></li>
<li><p>Столбец <code>year</code> является переменной</p></li>
<li><p>Остальные столбцы, можно предположить, являются значениями а не переменными.</p></li>
</ul>
<p>Теперь перейдём к более аккуратному виду. Для этого объединим все столбцы с предполагаемыми значениям в одну переменную</p>
<div class="sourceCode" id="cb790"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb790-1" data-line-number="1">(who1 &lt;-<span class="st"> </span>who <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb790-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(</a>
<a class="sourceLine" id="cb790-3" data-line-number="3">    new_sp_m014<span class="op">:</span>newrel_f65, <span class="dt">key =</span> <span class="st">&quot;key&quot;</span>,</a>
<a class="sourceLine" id="cb790-4" data-line-number="4">    <span class="dt">value =</span> <span class="st">&quot;cases&quot;</span>,</a>
<a class="sourceLine" id="cb790-5" data-line-number="5">    <span class="dt">na.rm =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb790-6" data-line-number="6">  ))</a></code></pre></div>
<pre><code>## # A tibble: 76,046 x 6
##    country     iso2  iso3   year key         cases
##    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;       &lt;int&gt;
##  1 Afghanistan AF    AFG    1997 new_sp_m014     0
##  2 Afghanistan AF    AFG    1998 new_sp_m014    30
##  3 Afghanistan AF    AFG    1999 new_sp_m014     8
##  4 Afghanistan AF    AFG    2000 new_sp_m014    52
##  5 Afghanistan AF    AFG    2001 new_sp_m014   129
##  6 Afghanistan AF    AFG    2002 new_sp_m014    90
##  7 Afghanistan AF    AFG    2003 new_sp_m014   127
##  8 Afghanistan AF    AFG    2004 new_sp_m014   139
##  9 Afghanistan AF    AFG    2005 new_sp_m014   151
## 10 Afghanistan AF    AFG    2006 new_sp_m014   193
## # … with 76,036 more rows</code></pre>
<p>Мы можем получить некое представление о структуре значений в новой переменной <code>key</code> подсчитав их.</p>
<div class="sourceCode" id="cb792"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb792-1" data-line-number="1">who1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb792-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(key)</a></code></pre></div>
<pre><code>## # A tibble: 56 x 2
##    key              n
##    &lt;chr&gt;        &lt;int&gt;
##  1 new_ep_f014   1032
##  2 new_ep_f1524  1021
##  3 new_ep_f2534  1021
##  4 new_ep_f3544  1021
##  5 new_ep_f4554  1017
##  6 new_ep_f5564  1017
##  7 new_ep_f65    1014
##  8 new_ep_m014   1038
##  9 new_ep_m1524  1026
## 10 new_ep_m2534  1020
## # … with 46 more rows</code></pre>
<p>Что означает символьная кодировка в ключе (о возрасте и поле догодался сам)</p>
<ul>
<li><p>Первые три буквы — случай заболевания, <code>new</code> новый и <code>ul</code> старый</p></li>
<li>Следующие две буквы описывают тип туберкулёза
<ul>
<li><code>reel</code> — рецидивный</li>
<li><code>up</code> — внелёгочный</li>
<li><code>sun</code> — лёгочный, не диагностируемый с помощью мазка</li>
<li><code>spa</code> — лёгочный, диагностируемый с помощью мазка</li>
</ul></li>
<li><p>Шестая буква — Пол пациента</p></li>
<li><p>оставшиеся цифра — возрастная группа</p></li>
</ul>
<p>Есть особенность, которую я заметил, когда набирал названия столбцов в коде — есть столбцы которые именуются <code>new_rel</code>, а есть те что именуются <code>newrel</code>. Чтобы все дальнейшие действия над данными не были проблематичными, нужно привести все записи к одному виду. Для этого, просмотрев весь фрейм данных выбираем форму записи <code>new_rel</code> — их больше.</p>
<div class="sourceCode" id="cb794"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb794-1" data-line-number="1">(who2 &lt;-<span class="st"> </span>who1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb794-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(key, <span class="st">&quot;newrel&quot;</span>, <span class="st">&quot;new_rel&quot;</span>)))</a></code></pre></div>
<pre><code>## # A tibble: 76,046 x 6
##    country     iso2  iso3   year key         cases
##    &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;chr&gt;       &lt;int&gt;
##  1 Afghanistan AF    AFG    1997 new_sp_m014     0
##  2 Afghanistan AF    AFG    1998 new_sp_m014    30
##  3 Afghanistan AF    AFG    1999 new_sp_m014     8
##  4 Afghanistan AF    AFG    2000 new_sp_m014    52
##  5 Afghanistan AF    AFG    2001 new_sp_m014   129
##  6 Afghanistan AF    AFG    2002 new_sp_m014    90
##  7 Afghanistan AF    AFG    2003 new_sp_m014   127
##  8 Afghanistan AF    AFG    2004 new_sp_m014   139
##  9 Afghanistan AF    AFG    2005 new_sp_m014   151
## 10 Afghanistan AF    AFG    2006 new_sp_m014   193
## # … with 76,036 more rows</code></pre>
<p>Разделим столбцы в <code>key</code> на параметры при помощи <code>separete()</code>, знак разделитель <code>&quot;_&quot;</code></p>
<div class="sourceCode" id="cb796"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb796-1" data-line-number="1">who3 &lt;-<span class="st"> </span>who2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb796-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(key, <span class="kw">c</span>(<span class="st">&quot;new&quot;</span>, <span class="st">&quot;type&quot;</span>, <span class="st">&quot;sexage&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot;_&quot;</span>)</a></code></pre></div>
<p>Посмотрим что в новом столбцк “new”:</p>
<div class="sourceCode" id="cb797"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb797-1" data-line-number="1">who3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb797-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(new)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   new       n
##   &lt;chr&gt; &lt;int&gt;
## 1 new   76046</code></pre>
<p>В изначальном фрейме данных содержится информация только о новых заболеваниях, поэтому этот столбец избыточный, избавимся от него, вместе со столбцами <code>iso2</code>, <code>iso3</code> по той же причине.</p>
<div class="sourceCode" id="cb799"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb799-1" data-line-number="1">who4 &lt;-<span class="st"> </span>who3 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb799-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>new, <span class="op">-</span>iso2, <span class="op">-</span>iso3)</a></code></pre></div>
<p>Далее разделим столбец с возрастом и полом, разбиение делаем после первого символа</p>
<div class="sourceCode" id="cb800"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb800-1" data-line-number="1">who5 &lt;-<span class="st"> </span>who4 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb800-2" data-line-number="2"><span class="st">  </span><span class="kw">separate</span>(sexage, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Можно сказать что набор данных приведён к аккуратному виду. Я проделал это всё, назначая промежуточный результат переменной. Но как правило такая работа делается в канале.</p>
<div class="sourceCode" id="cb801"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb801-1" data-line-number="1">who <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb801-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(key, value, new_sp_m014<span class="op">:</span>newrel_f65, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb801-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(key, <span class="st">&quot;newrel&quot;</span>, <span class="st">&quot;new_rel&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb801-4" data-line-number="4"><span class="st">  </span><span class="kw">separate</span>(key, <span class="kw">c</span>(<span class="st">&quot;new&quot;</span>, <span class="st">&quot;var&quot;</span>, <span class="st">&quot;sexage&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb801-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>new, <span class="op">-</span>iso2, <span class="op">-</span>iso3) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb801-6" data-line-number="6"><span class="st">  </span><span class="kw">separate</span>(sexage, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 76,046 x 6
##    country      year var   sex   age   value
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1 Afghanistan  1997 sp    m     014       0
##  2 Afghanistan  1998 sp    m     014      30
##  3 Afghanistan  1999 sp    m     014       8
##  4 Afghanistan  2000 sp    m     014      52
##  5 Afghanistan  2001 sp    m     014     129
##  6 Afghanistan  2002 sp    m     014      90
##  7 Afghanistan  2003 sp    m     014     127
##  8 Afghanistan  2004 sp    m     014     139
##  9 Afghanistan  2005 sp    m     014     151
## 10 Afghanistan  2006 sp    m     014     193
## # … with 76,036 more rows</code></pre>
<div id="-12.6.1.1" class="section level4">
<h4><span class="header-section-number">3.3.6.1</span> Упражнение 12.6.1.1</h4>
<div class="question">
<p>In this case study I set <code>na.rm = TRUE</code> just to make it easier to check that we had the correct values. Is this reasonable? Think about how missing values are represented in this dataset. Are there implicit missing values? What’s the difference between an NA and zero?</p>
</div>
<div class="sourceCode" id="cb803"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb803-1" data-line-number="1">who1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb803-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(cases <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb803-3" data-line-number="3"><span class="st">  </span><span class="kw">nrow</span>()</a></code></pre></div>
<pre><code>## [1] 11080</code></pre>
<p>В этом наборе данных <code>NA</code> означает отсутствие измерения на конкретный тест, а наличие нуля означает что тест проводился, и его результат отрицательный. Поэтому в данной ситуации было уместно убрать отсутствующие значения, а не заменять их нулями, так как мы не теряем информации о проведённых исследованиях.</p>
<p>Чтобы продемоснтрировать разницу между нулём и отсутствующим значением я приведу картинку. Потому что лучше один раз увидеть, чем сто раз услышать.</p>
<div class="figure">
<img src="img/NA.jpg" alt="alt text" />
<p class="caption">alt text</p>
</div>
</div>
<div id="-12.6.1.2" class="section level4">
<h4><span class="header-section-number">3.3.6.2</span> Упражнение 12.6.1.2</h4>
<div class="question">
<p>What happens if you neglect the <code>mutate()</code> step? (<code>mutate(key = stringr::str_replace(key, &quot;newrel&quot;, &quot;new_rel&quot;))</code>)</p>
</div>
<p>Эта строчка кода приводит записи наблюдений к одинаковой форме. Без этой строчки один и тот же по своей природе параметр будет встречаться дважды в виде двух разных записей <code>&quot;newrel&quot;</code>и <code>&quot;new_rel&quot;</code>.</p>
<p>Нельзя простро пропустить этот шаг в этом коде:</p>
<div class="sourceCode" id="cb805"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb805-1" data-line-number="1">who <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb805-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(key, value, new_sp_m014<span class="op">:</span>newrel_f65, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb805-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(key, <span class="st">&quot;newrel&quot;</span>, <span class="st">&quot;new_rel&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb805-4" data-line-number="4"><span class="st">  </span><span class="kw">separate</span>(key, <span class="kw">c</span>(<span class="st">&quot;new&quot;</span>, <span class="st">&quot;var&quot;</span>, <span class="st">&quot;sexage&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb805-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>new, <span class="op">-</span>iso2, <span class="op">-</span>iso3) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb805-6" data-line-number="6"><span class="st">  </span><span class="kw">separate</span>(sexage, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 76,046 x 6
##    country      year var   sex   age   value
##    &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1 Afghanistan  1997 sp    m     014       0
##  2 Afghanistan  1998 sp    m     014      30
##  3 Afghanistan  1999 sp    m     014       8
##  4 Afghanistan  2000 sp    m     014      52
##  5 Afghanistan  2001 sp    m     014     129
##  6 Afghanistan  2002 sp    m     014      90
##  7 Afghanistan  2003 sp    m     014     127
##  8 Afghanistan  2004 sp    m     014     139
##  9 Afghanistan  2005 sp    m     014     151
## 10 Afghanistan  2006 sp    m     014     193
## # … with 76,036 more rows</code></pre>
<p>Потому что последующая логика разделения столбца <code>key</code> по параметрам, базируется на том, что группы разбивает разделитель <code>&quot;_&quot;</code>.</p>
</div>
<div id="-12.6.1.3" class="section level4">
<h4><span class="header-section-number">3.3.6.3</span> Упражнение 12.6.1.3</h4>
<div class="question">
<p>I claimed that <code>iso2</code> and <code>iso3</code> were redundant with country. Confirm this claim.</p>
</div>
<p>Для того чтобы установить, что столбцы <code>iso2</code> и <code>iso3</code> избыточны надо сгруппировать по <code>country</code> и столбцам <code>iso2-3</code>.
Если хотя бы в одном столбце есть отличие в регистрации страны, то при группировке по предыдущему уровню получится две уникальных записи.</p>
<div class="sourceCode" id="cb807"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb807-1" data-line-number="1"><span class="kw">select</span>(who3, country, iso2, iso3) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb807-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb807-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(country) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb807-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 3
## # Groups:   country [0]
## # … with 3 variables: country &lt;chr&gt;, iso2 &lt;chr&gt;, iso3 &lt;chr&gt;</code></pre>
<p>ЧТД — столбцы <code>iso2</code> и <code>iso3</code> дублируют полное название страны</p>
</div>
<div id="-12.6.1.4" class="section level4">
<h4><span class="header-section-number">3.3.6.4</span> Упражнение 12.6.1.4</h4>
<div class="question">
<p>For each country, year, and sex compute the total number of cases of TB. Make an informative visualization of the data.</p>
</div>
<p>Для удобства работы с набором данных, определим аккуратизированный фрейм в переменную</p>
<div class="sourceCode" id="cb809"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb809-1" data-line-number="1">who_visual &lt;-<span class="st"> </span>who <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb809-2" data-line-number="2"><span class="st">  </span><span class="kw">gather</span>(key, value, new_sp_m014<span class="op">:</span>newrel_f65, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb809-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">key =</span> stringr<span class="op">::</span><span class="kw">str_replace</span>(key, <span class="st">&quot;newrel&quot;</span>, <span class="st">&quot;new_rel&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb809-4" data-line-number="4"><span class="st">  </span><span class="kw">separate</span>(key, <span class="kw">c</span>(<span class="st">&quot;new&quot;</span>, <span class="st">&quot;var&quot;</span>, <span class="st">&quot;sexage&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb809-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>new, <span class="op">-</span>iso2, <span class="op">-</span>iso3) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb809-6" data-line-number="6"><span class="st">  </span><span class="kw">separate</span>(sexage, <span class="kw">c</span>(<span class="st">&quot;sex&quot;</span>, <span class="st">&quot;age&quot;</span>), <span class="dt">sep =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>Для первоначальной прикидки, посмотрим как распределено количество случаев зарегистрированных заболеваний с течением времени.</p>
<div class="sourceCode" id="cb810"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb810-1" data-line-number="1"><span class="kw">ggplot</span>(who_visual, <span class="kw">aes</span>(year, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb810-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-435-1.png" width="672" /></p>
<p>По этому представлению, можно предположить, что до 95 года, данные скорее всего не вносились. Или информация есть не по всем странам. Исходя из этого, отбросим все наблюдения до 95-го года.</p>
<p>Далее, так как в конкретной задаче, нам необходимо получить результаты зарегистрированных случаев заболевания среди всех возрастных групп, просуммируем только по полу, году и стране.</p>
<div class="sourceCode" id="cb811"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb811-1" data-line-number="1">who_visual <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb811-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, year, sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb811-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1995</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb811-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(value)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb811-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cases, <span class="dt">color =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb811-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-436-1.png" width="672" /></p>
<p>Этот график показывает некое превосходство количества регистрируемых случаев туберкулёза среди мужчин в разное время. Но не даёт понять тенденции.</p>
<p>Так как стран очень много, построенный без ограничений график на одной координатной плоскости будет не информативен.</p>
<div class="sourceCode" id="cb812"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb812-1" data-line-number="1">who5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, year, sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1995</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-5" data-line-number="5"><span class="st">  </span><span class="kw">unite</span>(country_sex, country, sex, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb812-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cases, <span class="dt">group =</span> country_sex, <span class="dt">colour =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb812-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-437-1.png" width="672" /></p>
<p>На построенном графике видна тенденция от года к году, но не понятно к какой стране относится какая линия. Для более детальной визуализации можно воспользоваться панелями и ограничить просматриваемый диапазон зарегистрированных случаев заболевания:</p>
<div class="sourceCode" id="cb813"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb813-1" data-line-number="1">who5 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb813-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, year, sex) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb813-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1995</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb813-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">cases =</span> <span class="kw">sum</span>(cases)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb813-5" data-line-number="5"><span class="st">  </span><span class="kw">unite</span>(country_sex, country, sex, <span class="dt">remove =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb813-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">between</span>(cases, <span class="dv">50000</span>, <span class="dv">800000</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb813-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> year, <span class="dt">y =</span> cases, <span class="dt">group =</span> country_sex, <span class="dt">colour =</span> sex)) <span class="op">+</span></a>
<a class="sourceLine" id="cb813-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb813-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_wrap</span>(.<span class="op">~</span>country)</a></code></pre></div>
<pre><code>## geom_path: Each group consists of only one observation. Do you need to
## adjust the group aesthetic?</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-438-1.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.3.7</span> Неаккуратные данные</h3>
<p>Неаккуратные данные не всегда плохи. Есть ситуации когда они могут быть хороши</p>
<ul>
<li><p>альтернативные представления могут обеспечаить существенный выигрыш в производительности и объёме используемой памяти.</p></li>
<li><p>для специализированных полей могут существовать собственные соглашения относительно хранения данных, которые могут заметно отличаться от соглашений, принятых для аккуратных данных</p></li>
</ul>
<p>Аккуратные данные не являются единственным возможным выбором</p>
<!--chapter:end:09_tidy_data.Rmd-->
</div>
</div>
<div id="-----tidyr-1" class="section level2">
<h2><span class="header-section-number">3.4</span> Аккуратизация данных с помощью пакета <code>tidyr</code></h2>
<div id="-7" class="section level3">
<h3><span class="header-section-number">3.4.1</span> Введение</h3>
<p>Есть три семейства глаголов, предназначенных для выполнениях следуюзщий операций над реляционными данными:</p>
<ul>
<li><p>видоизменение соединений</p></li>
<li><p>фильтрация соединений</p></li>
<li><p>операции над множествами</p></li>
</ul>
<div id="--4" class="section level4">
<h4><span class="header-section-number">3.4.1.1</span> Необходимые ресурсы</h4>
<div class="sourceCode" id="cb815"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb815-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb815-2" data-line-number="2"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb815-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;datamodelr&quot;</span>) <span class="co"># Пакет для моделирования схем баз данных</span></a>
<a class="sourceLine" id="cb815-4" data-line-number="4"><span class="kw">library</span>(viridis)</a></code></pre></div>
</div>
</div>
<div id="-nycflights13-1" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Пакет <code>nycflights13</code></h3>
<p>Этот пакет содержит четыре связанных tibble-frame их взаимосвязь хорошо продемонстрирована на рисунке</p>
<div class="figure">
<img src="img/relational.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<div id="-13.2.1.1" class="section level4">
<h4><span class="header-section-number">3.4.2.1</span> Упражнение 13.2.1.1</h4>
<div class="question">
<p>Imagine you wanted to draw (approximately) the route each plane flies from its origin to its destination. What variables would you need? What tables would you need to combine?</p>
</div>
<p>Для того чтобы построить маршрут перелёта, необходимо понимать точные данные о местах отправления и назначения. Информацию о перелётах из аэропорта в аэропорт можно получить из фрейма данных <code>flights</code> — переменны <code>origin</code> и <code>dest</code>, для определения точек отправления и назначения. А информацию о городе в котором расположен конкретный аэропорт можно получить из фрейма данных <code>airports</code> — переменные <code>lat</code> и <code>lon</code> для получения широты и долготы, т.е. координат аэропорта.</p>
</div>
<div id="-13.2.1.2" class="section level4">
<h4><span class="header-section-number">3.4.2.2</span> Упражнение 13.2.1.2</h4>
<div class="question">
<p>I forgot to draw the relationship between <code>weather</code> and <code>airports</code>. What is the relationship and how should it appear in the diagram?</p>
</div>
<p>На самом деле между ними косвенно указана связь через <code>flights</code>. Но если быть точным, то <code>airports$faa</code> это внешний ключ <code>weather$origin</code></p>
</div>
<div id="-13.2.1.3" class="section level4">
<h4><span class="header-section-number">3.4.2.3</span> Упражнение 13.2.1.3</h4>
<div class="question">
<p>Weather only contains information for the origin (NYC) airports. If it contained weather records for all airports in the USA, what additional relation would it define with <code>flights</code>?</p>
</div>
<p>Если бы в <code>weather</code> содержались данные о погодных условиях во всех аэропортах, то ’необходимо было бы установить это обеспечило бы погоду для <code>dest</code> каждого рейса. Соответственно необходимо было бы установить соответствие в таблицах между <code>dest</code>.</p>
</div>
<div id="-13.2.1.4" class="section level4">
<h4><span class="header-section-number">3.4.2.4</span> Упражнение 13.2.1.4</h4>
<div class="question">
<p>We know that some days of the year are “special”, and fewer people than usual fly on them. How might you represent that data as a data frame? What would be the primary keys of that table? How would it connect to the existing tables?</p>
</div>
<p>Можно добавить отдельную таблицу, например <code>special date</code>, в которой перечислить эти специальные даты. Первичным ключом была бы комбинация даты из <code>flights</code> вплоть до дня <code>year</code>, <code>month</code>, <code>day</code>.</p>
<div class="sourceCode" id="cb816"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb816-1" data-line-number="1">special_date &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb816-2" data-line-number="2">  <span class="op">~</span>year, <span class="op">~</span>month, <span class="op">~</span>day, <span class="op">~</span>holiday,</a>
<a class="sourceLine" id="cb816-3" data-line-number="3">  <span class="dv">2013</span>, <span class="dv">01</span>, <span class="dv">01</span>, <span class="st">&quot;New Years Day&quot;</span></a>
<a class="sourceLine" id="cb816-4" data-line-number="4">)</a></code></pre></div>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.4.2.5</span> Ключи</h4>
<p>Ключи бывают двух видов:</p>
<ul>
<li><p>Первичный ключ идентифицирует наблюдение в собственной таблице. Например <code>planes$tailnum</code> однозначно идентифицирует каждый самолет в таблице <code>planes</code></p></li>
<li><p>Внешний ключ однозначно идентифицирует наблюдение в другой таблице. Наприме, <code>flights$tailnum</code> — внешний ключ, поскольку он появляется в таблице <code>flights</code>, в которой он устанавливает для каждого авиарейса однозначно определяемый самолёт.</p></li>
</ul>
<p>Переменная может одновременно служить первичным и внешним ключом. Например переменная <code>origin</code> является частью первичного ключа для таблицы <code>weather</code> и одновременно внешним ключом для таблицы <code>airports</code></p>
<p>Чтобы убедится в том, что переменная которую мы определили как внешний ключ, действительно является таковой, можно проверить следующим способом:</p>
<div class="sourceCode" id="cb817"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb817-1" data-line-number="1">planes <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb817-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb817-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 2
## # … with 2 variables: tailnum &lt;chr&gt;, n &lt;int&gt;</code></pre>
<p>Так как первичный ключ устанавливает однозначной соответствие, то количество раз которое встречается эта переменная должно быть строго не больше одного раза.</p>
<p>Бывает, что таблица не имеет явного первичного ключа: каждая строка является наблюдением, но ниодна комбинация не обеспечивает её надежную идентификацию.</p>
<p>Например, что является первичным ключом во <code>flights</code>? Комбинация даты и номера вылета? Это было бы так, если бы в день самолёт совершал один полёт, но это не так:</p>
<div class="sourceCode" id="cb819"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb819-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb819-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(year, month, day, flight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb819-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 29,768 x 5
##     year month   day flight     n
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;  &lt;int&gt; &lt;int&gt;
##  1  2013     1     1      1     2
##  2  2013     1     1      3     2
##  3  2013     1     1      4     2
##  4  2013     1     1     11     3
##  5  2013     1     1     15     2
##  6  2013     1     1     21     2
##  7  2013     1     1     27     4
##  8  2013     1     1     31     2
##  9  2013     1     1     32     2
## 10  2013     1     1     35     2
## # … with 29,758 more rows</code></pre>
<p>Если в таблице отсутствует первичный ключ, иногда его бывает удобно добавить с помощью функций <code>mutate()</code> и <code>row_number()</code>. Такой улюч называют суррогатным.</p>
</div>
<div id="-13.3.1.1" class="section level4">
<h4><span class="header-section-number">3.4.2.6</span> Упражнение 13.3.1.1</h4>
<div class="question">
<p>Add a surrogate key to <code>flights</code>.</p>
</div>
<p>Однозначно описать строку может её порядковый номер:</p>
<div class="sourceCode" id="cb821"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb821-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb821-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">id =</span> <span class="kw">row_number</span>())</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # … with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, id &lt;int&gt;</code></pre>
<p>Ещё лучше сначала упорядочить текущий набор данных и только затем присваивать идентификационный номер:</p>
<div class="sourceCode" id="cb823"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb823-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb823-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(year, month, day, sched_dep_time, carrier, flight) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb823-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">flight_id =</span> <span class="kw">row_number</span>())</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            558        -4      740
##  6  2013     1     1      559            559         0      702
##  7  2013     1     1      558            600        -2      753
##  8  2013     1     1      559            600        -1      941
##  9  2013     1     1      558            600        -2      849
## 10  2013     1     1      558            600        -2      853
## # … with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, flight_id &lt;int&gt;</code></pre>
</div>
<div id="-13.3.1.2" class="section level4">
<h4><span class="header-section-number">3.4.2.7</span> Упражнение 13.3.1.2</h4>
<div class="question">
<p>Identify the keys in the following datasets</p>
<ol style="list-style-type: decimal">
<li><p><code>Lahman::Batting</code></p></li>
<li><p><code>babynames::babynames</code></p></li>
<li><p><code>nasaweather::atmos</code></p></li>
<li><p><code>fueleconomy::vehicles</code></p></li>
<li><p><code>ggplot2::diamonds</code></p></li>
</ol>
<p>(You might need to install some packages and read some documentation.)</p>
</div>
<ol style="list-style-type: decimal">
<li>Для меня совершенно не очевидный ответ, к которому я пришёл интуитивно:</li>
</ol>
<div class="sourceCode" id="cb825"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb825-1" data-line-number="1">Lahman<span class="op">::</span>Batting <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb825-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(playerID, yearID, stint) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb825-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 4
## # … with 4 variables: playerID &lt;chr&gt;, yearID &lt;int&gt;, stint &lt;int&gt;, n &lt;int&gt;</code></pre>
<p>Таким образом, первичным ключом в этих данных будет связка параметров <code>playerID</code>, <code>yearID</code>, <code>stint</code>.
Эти данные — статистика по игре в бейсбол. Первые два параметра это как не трудно догадаться ID игрока, и года в котором он играл. Сначала я проверил на однозначность описания совокупность этих двух параметров. Но так как в течении года у игрока может изменяться положение/роль (параметр <code>stint</code>), то первичным ключом будет комбинация трёх параметров.</p>
<p>Больше информации по этим данным содержится в оригинальном наборе данных <a href="http://www.seanlahman.com/files/database/readme2012.txt" class="uri">http://www.seanlahman.com/files/database/readme2012.txt</a></p>
<ol style="list-style-type: decimal">
<li>Для работы с эим набором данных необходимо скачать пакет <code>babynames</code>. В этом наборе данных содержится информация о количестве имён используемых в каждом году и их популярность.</li>
</ol>
<div class="sourceCode" id="cb827"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb827-1" data-line-number="1"><span class="co"># install.packages(&quot;babynames&quot;)</span></a>
<a class="sourceLine" id="cb827-2" data-line-number="2"><span class="kw">library</span>(babynames)</a>
<a class="sourceLine" id="cb827-3" data-line-number="3"></a>
<a class="sourceLine" id="cb827-4" data-line-number="4">babynames<span class="op">::</span>babynames <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb827-5" data-line-number="5"><span class="st">  </span><span class="co"># count(year, sex, name) %&gt;%</span></a>
<a class="sourceLine" id="cb827-6" data-line-number="6"><span class="st">   </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="co"># Обрати мнимание, что в исходном наборе данных уже есть параметр n, поэтому для подсчёта количества вхождений используеться переменная nn</span></a></code></pre></div>
<pre><code>## # A tibble: 1,924,665 x 5
##     year sex   name          n   prop
##    &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;int&gt;  &lt;dbl&gt;
##  1  1880 F     Mary       7065 0.0724
##  2  1880 F     Anna       2604 0.0267
##  3  1880 F     Emma       2003 0.0205
##  4  1880 F     Elizabeth  1939 0.0199
##  5  1880 F     Minnie     1746 0.0179
##  6  1880 F     Margaret   1578 0.0162
##  7  1880 F     Ida        1472 0.0151
##  8  1880 F     Alice      1414 0.0145
##  9  1880 F     Bertha     1320 0.0135
## 10  1880 F     Sarah      1288 0.0132
## # … with 1,924,655 more rows</code></pre>
<p>Первичным ключом будет комбинация из трёх параметров — имя, пол (потому что есть бисексуальные имена) и год в котором было использовано это имя.</p>
<p>Больше информации по этому набору данных <a href="https://github.com/hadley/babynames" class="uri">https://github.com/hadley/babynames</a></p>
<ol style="list-style-type: decimal">
<li>Для работы с этим набором данных необходимо установить пакет <code>nasaweather</code>. Данные представляют собой географические и атмосферные измерения на очень грубой сетке 24 на 24, охватывающей Центральную Америку. Переменными являются: высота, температура (поверхность и воздух), озон, давление воздуха и облачный покров (низкий, средний и высокий). За исключением повышения, все переменные являются среднемесячными с наблюдениями за январь 1995 года по декабрь 2000 года. Эти данные были получены из Центра данных атмосферных наук NASA Langley Research Center</li>
</ol>
<div class="sourceCode" id="cb829"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb829-1" data-line-number="1"><span class="co"># install.packages(&quot;nasaweather&quot;)</span></a>
<a class="sourceLine" id="cb829-2" data-line-number="2"><span class="kw">library</span>(nasaweather)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;nasaweather&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     storms</code></pre>
<p>Таким образом, первичным ключом будет комбинация параметров — ширина-долгота для идентификации местоположения, и месяц-год для идентификации события во времени. Другими словами:</p>
<div class="sourceCode" id="cb832"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb832-1" data-line-number="1">nasaweather<span class="op">::</span>atmos <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb832-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(lat, long, year, month) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb832-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 5
## # … with 5 variables: lat &lt;dbl&gt;, long &lt;dbl&gt;, year &lt;int&gt;, month &lt;int&gt;,
## #   n &lt;int&gt;</code></pre>
<p>Больше информации по этим данным содержится в оригинальном наборе данных <a href="http://stat-computing.org/dataexpo/2006/" class="uri">http://stat-computing.org/dataexpo/2006/</a></p>
<ol style="list-style-type: decimal">
<li>Для работы с этим набором данных необходимо установить пакет <code>fueleconomy</code>. Данные об экономии топлива являются результатом испытаний транспортных средств, проведенных в Национальной лаборатории Агентства по охране окружающей среды и выбросов топлива в Анн-Арборе, штат Мичиган, в 1985-2015. А также производителями транспортных средств под надзором EPA. Данные об экономии топлива из EPA, 1985-2015. Этот набор данных содержит выбранные переменные и удаляет транспортные средства с неполными данными (например, без данных трансмиссии)</li>
</ol>
<div class="sourceCode" id="cb834"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb834-1" data-line-number="1"><span class="co"># install.packages(&quot;fueleconomy&quot;)</span></a>
<a class="sourceLine" id="cb834-2" data-line-number="2"><span class="kw">library</span>(fueleconomy)</a>
<a class="sourceLine" id="cb834-3" data-line-number="3"></a>
<a class="sourceLine" id="cb834-4" data-line-number="4">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb834-5" data-line-number="5"><span class="st">  </span><span class="kw">count</span>(id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb834-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 2
## # … with 2 variables: id &lt;int&gt;, n &lt;int&gt;</code></pre>
<p>В изначальном наборе данных введён первичный ключ — переменная <code>id</code>.</p>
<p>Больше информации по этим данным содержится в оригинальном наборе данных <a href="https://www.fueleconomy.gov/feg/download.shtml" class="uri">https://www.fueleconomy.gov/feg/download.shtml</a></p>
<ol style="list-style-type: decimal">
<li>В наборе данных <code>ggplot2::diamonds</code> изначально нет первичного ключа. Его нельзя задать комбинацией параметров, потому что теоретически в природе может существовать два идентичных бриллианта как по размерам и физико-химическим свойствам, так и по цене, запращиваемой за эти бриллианты. Таким образом, для определения первичного ключа, нужно вводить новую переменную (суррогатный первичный ключ).</li>
</ol>
</div>
<div id="-13.3.1.3" class="section level4">
<h4><span class="header-section-number">3.4.2.8</span> Упражнение 13.3.1.3</h4>
<div class="question">
<p>Draw a diagram illustrating the connections between the <code>Batting</code>, <code>Master</code>, and <code>Salaries</code> tables in the <code>Lahman</code> package. Draw another diagram that shows the relationship between <code>Master</code>, <code>Managers</code>, <code>AwardsManagers</code>.</p>
<p>How would you characterise the relationship between the <code>Batting</code>, <code>Pitching</code>, and <code>Fielding</code> tables?</p>
</div>
<p>Чтобы фиксировать взаимоотношения данных в таблицах можно использовать множество разных ресурсов. Вероятно на специализированных ресурсах отношения и стрелочки будут выглядеть лучше, но мне помнравилась идея отображать отношения в той рабочей среде в которой проводится анализ.</p>
<p>Для этого необходимо установить два пакета:</p>
<div class="sourceCode" id="cb836"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb836-1" data-line-number="1"><span class="co">#install.packages(&quot;datamodelr&quot;)</span></a>
<a class="sourceLine" id="cb836-2" data-line-number="2"><span class="co">#install.packages(&quot;DiagrammeR&quot;)</span></a></code></pre></div>
<p>Второй пакет необходим для отображения работы первого.</p>
<p>Подробно работа с пакетом описана в репозитории разработчика <a href="https://github.com/bergant/datamodelr#model-diagram-of-interconnected-data-frames" class="uri">https://github.com/bergant/datamodelr#model-diagram-of-interconnected-data-frames</a></p>
<p>Общий подход такой — для начала определяем первичные ключи:</p>
<ul>
<li><p><code>Master</code></p>
<ul>
<li>Первичный: <code>playerID</code></li>
</ul></li>
<li><p><code>Batting</code></p>
<ul>
<li><p>Первичный: <code>playerID</code>, <code>yearID</code>, <code>stint</code></p></li>
<li><p>Внешний:</p>
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
</ul></li>
<li><p><code>Salaries</code></p>
<ul>
<li><p>Primary keys: <code>yearID</code>, <code>teamID</code>, <code>playerID</code></p></li>
<li><p>Foreign Keys</p>
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
</ul></li>
</ul>
<p>После этого задаём их связи <code>Batting$playerID == Master$playerID</code>, <code>Salaries$playerID == Master$playerID</code></p>
<p>И на третьем шаге можно строить отношения:</p>
<div class="sourceCode" id="cb837"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb837-1" data-line-number="1">dm1 &lt;-<span class="st"> </span><span class="kw">dm_from_data_frames</span>(<span class="kw">list</span>(<span class="dt">Batting =</span> Lahman<span class="op">::</span>Batting,</a>
<a class="sourceLine" id="cb837-2" data-line-number="2">                                <span class="dt">Master =</span> Lahman<span class="op">::</span>Master,</a>
<a class="sourceLine" id="cb837-3" data-line-number="3">                                <span class="dt">Salaries =</span> Lahman<span class="op">::</span>Salaries)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb837-4" data-line-number="4"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Batting&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;playerID&quot;</span>, <span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;stint&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb837-5" data-line-number="5"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Master&quot;</span>, <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb837-6" data-line-number="6"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Salaries&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;playerID&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb837-7" data-line-number="7"><span class="st">  </span><span class="kw">dm_add_references</span>(</a>
<a class="sourceLine" id="cb837-8" data-line-number="8">    Batting<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID,</a>
<a class="sourceLine" id="cb837-9" data-line-number="9">    Salaries<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID</a>
<a class="sourceLine" id="cb837-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb837-11" data-line-number="11"></a>
<a class="sourceLine" id="cb837-12" data-line-number="12"><span class="kw">dm_create_graph</span>(dm1, <span class="dt">rankdir =</span> <span class="st">&quot;LR&quot;</span>, <span class="dt">columnArrows =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Теперь проделаем эту же процедуру для <code>Master</code>, <code>Managers</code>, <code>AwardsManagers</code></p>
<ul>
<li><p><code>Master</code></p>
<ul>
<li>Первичный: <code>playerID</code></li>
</ul></li>
<li><p><code>Managers</code></p>
<ul>
<li><p>Первичный: <code>yearID</code>, <code>teamID</code>, <code>inseason</code></p></li>
<li><p>Внешний:</p>
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
</ul></li>
<li><p><code>AwardsManagers</code>:</p>
<ul>
<li><p>Первичный: <code>playerID</code>, <code>awardID</code>, <code>yearID</code></p></li>
<li><p>Внешний:</p>
<ul>
<li><code>playerID</code> = <code>Master$playerID</code> (many-to-1)</li>
</ul></li>
</ul></li>
</ul>
<div class="sourceCode" id="cb838"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb838-1" data-line-number="1">dm2 &lt;-<span class="st"> </span><span class="kw">dm_from_data_frames</span>(<span class="kw">list</span>(<span class="dt">Managers =</span> Lahman<span class="op">::</span>Managers,</a>
<a class="sourceLine" id="cb838-2" data-line-number="2">                                <span class="dt">Master =</span> Lahman<span class="op">::</span>Master,</a>
<a class="sourceLine" id="cb838-3" data-line-number="3">                                <span class="dt">AwardsManagers =</span> Lahman<span class="op">::</span>AwardsManagers)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb838-4" data-line-number="4"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Managers&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;teamID&quot;</span>, <span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;inseason&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb838-5" data-line-number="5"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;Master&quot;</span>, <span class="st">&quot;playerID&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb838-6" data-line-number="6"><span class="st">  </span><span class="kw">dm_set_key</span>(<span class="st">&quot;AwardsManagers&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;yearID&quot;</span>, <span class="st">&quot;awardID&quot;</span>, <span class="st">&quot;playerID&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb838-7" data-line-number="7"><span class="st">  </span><span class="kw">dm_add_references</span>(</a>
<a class="sourceLine" id="cb838-8" data-line-number="8">    AwardsManagers<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID,</a>
<a class="sourceLine" id="cb838-9" data-line-number="9">    Managers<span class="op">$</span>playerID <span class="op">==</span><span class="st"> </span>Master<span class="op">$</span>playerID</a>
<a class="sourceLine" id="cb838-10" data-line-number="10">  )</a>
<a class="sourceLine" id="cb838-11" data-line-number="11"></a>
<a class="sourceLine" id="cb838-12" data-line-number="12"><span class="kw">dm_create_graph</span>(dm2, <span class="dt">rankdir =</span> <span class="st">&quot;LR&quot;</span>, <span class="dt">columnArrows =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>Таблицы <code>Batting</code>, <code>Pitching</code> и <code>Fielding</code> имеют первичный ключ, состоящий из переменных <code>playerID</code>, <code>yearID</code> и <code>stint</code>. Все они имеют отношения 1-1 друг к другу, потому что <code>Batting</code>, <code>Pitching</code> и <code>Fielding</code> это названия игровых позиций.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Мутирующие соединения</h3>
<p>Мутирующее соединение позволяет объединять переменные из двух таблиц. Сначала оно находит соответсвующие наблюдения по их ключам, а затем копирует переменные из одной таблицы в другую.</p>
<p>Мутирующие соединения добавляют столбцы в правый конец таблицы.</p>
<p>Чтобы было проще понять происходящее с данными, возьмём тренировочный набор данных.</p>
<div class="sourceCode" id="cb839"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb839-1" data-line-number="1">(flights2 &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb839-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest, tailnum, carrier))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 8
##     year month   day  hour origin dest  tailnum carrier
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;  
##  1  2013     1     1     5 EWR    IAH   N14228  UA     
##  2  2013     1     1     5 LGA    IAH   N24211  UA     
##  3  2013     1     1     5 JFK    MIA   N619AA  AA     
##  4  2013     1     1     5 JFK    BQN   N804JB  B6     
##  5  2013     1     1     6 LGA    ATL   N668DN  DL     
##  6  2013     1     1     5 EWR    ORD   N39463  UA     
##  7  2013     1     1     6 EWR    FLL   N516JB  B6     
##  8  2013     1     1     6 LGA    IAD   N829AS  EV     
##  9  2013     1     1     6 JFK    MCO   N593JB  B6     
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA     
## # … with 336,766 more rows</code></pre>
<p>Предположим, мы хотим соединить два фрейма данных <code>flights2</code> и <code>airlines</code>. Напомню, что последний фрейм это:</p>
<div class="sourceCode" id="cb841"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb841-1" data-line-number="1">airlines</a></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    carrier name                       
##    &lt;chr&gt;   &lt;chr&gt;                      
##  1 9E      Endeavor Air Inc.          
##  2 AA      American Airlines Inc.     
##  3 AS      Alaska Airlines Inc.       
##  4 B6      JetBlue Airways            
##  5 DL      Delta Air Lines Inc.       
##  6 EV      ExpressJet Airlines Inc.   
##  7 F9      Frontier Airlines Inc.     
##  8 FL      AirTran Airways Corporation
##  9 HA      Hawaiian Airlines Inc.     
## 10 MQ      Envoy Air                  
## 11 OO      SkyWest Airlines Inc.      
## 12 UA      United Air Lines Inc.      
## 13 US      US Airways Inc.            
## 14 VX      Virgin America             
## 15 WN      Southwest Airlines Co.     
## 16 YV      Mesa Airlines Inc.</code></pre>
<p>Фреймы можно соединить при помощи <code>left_join()</code></p>
<div class="sourceCode" id="cb843"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb843-1" data-line-number="1">flights2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb843-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>origin, <span class="op">-</span>dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb843-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by =</span> <span class="st">&quot;carrier&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 7
##     year month   day  hour tailnum carrier name                    
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;                   
##  1  2013     1     1     5 N14228  UA      United Air Lines Inc.   
##  2  2013     1     1     5 N24211  UA      United Air Lines Inc.   
##  3  2013     1     1     5 N619AA  AA      American Airlines Inc.  
##  4  2013     1     1     5 N804JB  B6      JetBlue Airways         
##  5  2013     1     1     6 N668DN  DL      Delta Air Lines Inc.    
##  6  2013     1     1     5 N39463  UA      United Air Lines Inc.   
##  7  2013     1     1     6 N516JB  B6      JetBlue Airways         
##  8  2013     1     1     6 N829AS  EV      ExpressJet Airlines Inc.
##  9  2013     1     1     6 N593JB  B6      JetBlue Airways         
## 10  2013     1     1     6 N3ALAA  AA      American Airlines Inc.  
## # … with 336,766 more rows</code></pre>
<div id="---" class="section level4">
<h4><span class="header-section-number">3.4.3.1</span> Что представляют собой соединения</h4>
<p>Проще всего понять как работает соединение продемонстрировать это графически. Введём две переменные для демонстрации:</p>
<div class="sourceCode" id="cb845"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb845-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb845-2" data-line-number="2">  <span class="op">~</span>key, <span class="op">~</span>val_x,</a>
<a class="sourceLine" id="cb845-3" data-line-number="3">     <span class="dv">1</span>, <span class="st">&quot;x1&quot;</span>,</a>
<a class="sourceLine" id="cb845-4" data-line-number="4">     <span class="dv">2</span>, <span class="st">&quot;x2&quot;</span>,</a>
<a class="sourceLine" id="cb845-5" data-line-number="5">     <span class="dv">3</span>, <span class="st">&quot;x3&quot;</span></a>
<a class="sourceLine" id="cb845-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb845-7" data-line-number="7">y &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb845-8" data-line-number="8">  <span class="op">~</span>key, <span class="op">~</span>val_y,</a>
<a class="sourceLine" id="cb845-9" data-line-number="9">     <span class="dv">1</span>, <span class="st">&quot;y1&quot;</span>,</a>
<a class="sourceLine" id="cb845-10" data-line-number="10">     <span class="dv">2</span>, <span class="st">&quot;y2&quot;</span>,</a>
<a class="sourceLine" id="cb845-11" data-line-number="11">     <span class="dv">4</span>, <span class="st">&quot;y3&quot;</span></a>
<a class="sourceLine" id="cb845-12" data-line-number="12">)</a></code></pre></div>
<p>Их объединение будет происходить по ключу. Количество точек на диаграмме = количеству совпадений = количеству строк в результате
<img src="img/join-inner.png" alt="alt text" /></p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.4.3.2</span> Внутреннее соединение</h4>
<p>Это простейший тип соединения, которое устанавливает соответствие между парами наблюдений, если их ключи совпадают. Собственно оно и было указано в демонстрации выше</p>
<div class="figure">
<img src="img/join-inner.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Строго говоря, этот тип соединения является <strong>внутренним соединением по эквивалентности</strong>, так как для сопоставления ключей используется оператор равенства. Поскольку большинство ключей относится к этому типу, мы будем опускать это уточнение.</p>
<p>Результатом внутреннего соединения является новый фрейм данных, котороый содержит ключе, значения <code>x</code> и значения <code>y</code>. Для того чтобы сообщить пакету <code>dplyr</code> какая переменная является ключом, мы используем параметр <code>by</code></p>
<div class="sourceCode" id="cb846"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb846-1" data-line-number="1">x <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb846-2" data-line-number="2"><span class="st">  </span><span class="kw">inner_join</span>(y, <span class="dt">by =</span> <span class="st">&quot;key&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##     key val_x val_y
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1     1 x1    y1   
## 2     2 x2    y2</code></pre>
<p>Самым важным свойством внутреннего соединения является тот факт, что несовпадающие значения не включаются в новый фрейм данных. Это означает, что обычное внутреннее соединение, как правило нельзя использовать в анализе, так как можно очень легко потерять наблюдения.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.4.3.3</span> Внешние соединения</h4>
<p>Внутреннее соединение сохраняет наблюдения которые встречаются в обеих таблицах (логическое И)</p>
<p>Внешнее соединение сохраняет наблюдения встречающиеся хотя бы в одной из таблиц. Различают три вида внешних соединений:</p>
<ul>
<li><p>левое соединение, сохраняет все наблюдения в <code>x</code></p></li>
<li><p>правое соединение, сохраняет все наблюдения в <code>y</code></p></li>
<li><p>полное соединение, сохраняет все наблюдения в <code>x</code> и <code>y</code></p></li>
</ul>
<p>Эти соединения работают, добавляя дополнительное “виртуальное” наблюдение в каждую таблицу. Данное наблюдение имеет ключ, который совпадает с любым ключом (если никакой другой ключе не совпадает), и значение <code>NA</code></p>
<p><img src="img/join-outer.png" alt="alt text" />
Так как левое соединение оставляет исходную выборку нетронутой, то этот тип соединения используется практически по умолчанию всегда.</p>
<p>Для графического изображения различных типов соединений используется диаграмма Венна</p>
<div class="figure">
<img src="img/join-venn.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Однако она обладает одним существенным недостатком — она не сообщает что делать в тех случаях, когда ключи не обечспечивают однозначную идентификацию.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.4.3.4</span> Неуникальные ключи</h4>
<p>Есть две ситуации неуникальных ключей</p>
<ul>
<li>Неуникальные ключи есть в одной таблице. Это модет быть полезно, если необходимо добавить информацию в тех случаях, когда имеется типичное отношение “один ко многим”.</li>
</ul>
<div class="figure">
<img src="img/join-one-to-many.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<ul>
<li>Неуникальные ключи есть в обеих таблицах. При соединении таких таблиц получаются все возможные соединения</li>
</ul>
<div class="figure">
<img src="img/join-many-to-many.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">3.4.3.5</span> Определение ключевых столбцов</h4>
<p>До сих пор соединение происходило только по одной переменной, задаваемой параметром <code>by = &quot;key&quot;</code>. Есть другие способы:</p>
<ul>
<li>Заданному по умолчанию значению <code>by = NULL</code> соответствует использование всех переменных, встречающихся в обеих таблицах. Это естественное соединение. Например таблицы <code>flights</code> и <code>weather</code> согласуются по общим переменным: <code>year</code>, <code>month</code>, <code>day</code>, <code>hour</code> и <code>origin</code>.</li>
</ul>
<div class="sourceCode" id="cb848"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb848-1" data-line-number="1">flights2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb848-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(weather)</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;hour&quot;, &quot;origin&quot;)</code></pre>
<pre><code>## # A tibble: 336,776 x 18
##     year month   day  hour origin dest  tailnum carrier  temp  dewp humid
##    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1     5 EWR    IAH   N14228  UA       39.0  28.0  64.4
##  2  2013     1     1     5 LGA    IAH   N24211  UA       39.9  25.0  54.8
##  3  2013     1     1     5 JFK    MIA   N619AA  AA       39.0  27.0  61.6
##  4  2013     1     1     5 JFK    BQN   N804JB  B6       39.0  27.0  61.6
##  5  2013     1     1     6 LGA    ATL   N668DN  DL       39.9  25.0  54.8
##  6  2013     1     1     5 EWR    ORD   N39463  UA       39.0  28.0  64.4
##  7  2013     1     1     6 EWR    FLL   N516JB  B6       37.9  28.0  67.2
##  8  2013     1     1     6 LGA    IAD   N829AS  EV       39.9  25.0  54.8
##  9  2013     1     1     6 JFK    MCO   N593JB  B6       37.9  27.0  64.3
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA       39.9  25.0  54.8
## # … with 336,766 more rows, and 7 more variables: wind_dir &lt;dbl&gt;,
## #   wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;, pressure &lt;dbl&gt;,
## #   visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<ul>
<li>Символьный вектор, <code>by = &quot;x&quot;</code>. Можно соединять не по ключу, а по любой общей переменной. НАпример, переменная <code>year</code> содержится в обеих таблицах, <code>flights</code> и <code>planes</code>, но имеет в них разный смысл, и потому для соединения таблиц мы используем только переменную <code>tailnum</code></li>
</ul>
<div class="sourceCode" id="cb851"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb851-1" data-line-number="1">flights2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb851-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(planes, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 16
##    year.x month   day  hour origin dest  tailnum carrier year.y type 
##     &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;
##  1   2013     1     1     5 EWR    IAH   N14228  UA        1999 Fixe…
##  2   2013     1     1     5 LGA    IAH   N24211  UA        1998 Fixe…
##  3   2013     1     1     5 JFK    MIA   N619AA  AA        1990 Fixe…
##  4   2013     1     1     5 JFK    BQN   N804JB  B6        2012 Fixe…
##  5   2013     1     1     6 LGA    ATL   N668DN  DL        1991 Fixe…
##  6   2013     1     1     5 EWR    ORD   N39463  UA        2012 Fixe…
##  7   2013     1     1     6 EWR    FLL   N516JB  B6        2000 Fixe…
##  8   2013     1     1     6 LGA    IAD   N829AS  EV        1998 Fixe…
##  9   2013     1     1     6 JFK    MCO   N593JB  B6        2004 Fixe…
## 10   2013     1     1     6 LGA    ORD   N3ALAA  AA          NA &lt;NA&gt; 
## # … with 336,766 more rows, and 6 more variables: manufacturer &lt;chr&gt;,
## #   model &lt;chr&gt;, engines &lt;int&gt;, seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
<p>Неоднозначность переменных устранена при помощи суффиксов <code>year.x</code> и <code>year.y</code></p>
<ul>
<li>Именованный символьный вектор <code>by = c(&quot;a&quot; = &quot;b&quot;)</code>. Соединения этого типа сопоставляют переменную <code>a</code> в таблице <code>x</code> с перменной <code>b</code> в таблице <code>y</code>. В результате будут использованы перменные их <code>x</code>.</li>
</ul>
<p>Это сильный инструмент — этакий аналог этой функции в Excell это <code>ВПР()</code>. Но только по заданному ключу здесь, функция проводит поиск, устанавливает соответствие по всем доступным столбцам в таблице <code>y</code>.</p>
<p>Например, если мы хоти нарисовать карту, необходимо соединить данные таблицы <code>flights</code> с данными таблицы <code>airports</code>, которая содержит широту и долготу каждого аэропорта. Каждый авиарейс характеризуется аэропортом вылета и аэропортом назначения, поэтому мы должны конкретизировать, какой из вариантов соединения нам необходим.</p>
<div class="sourceCode" id="cb853"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb853-1" data-line-number="1">flights2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb853-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(airports, <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 15
##     year month   day  hour origin dest  tailnum carrier name    lat   lon
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1     5 EWR    IAH   N14228  UA      Geor…  30.0 -95.3
##  2  2013     1     1     5 LGA    IAH   N24211  UA      Geor…  30.0 -95.3
##  3  2013     1     1     5 JFK    MIA   N619AA  AA      Miam…  25.8 -80.3
##  4  2013     1     1     5 JFK    BQN   N804JB  B6      &lt;NA&gt;   NA    NA  
##  5  2013     1     1     6 LGA    ATL   N668DN  DL      Hart…  33.6 -84.4
##  6  2013     1     1     5 EWR    ORD   N39463  UA      Chic…  42.0 -87.9
##  7  2013     1     1     6 EWR    FLL   N516JB  B6      Fort…  26.1 -80.2
##  8  2013     1     1     6 LGA    IAD   N829AS  EV      Wash…  38.9 -77.5
##  9  2013     1     1     6 JFK    MCO   N593JB  B6      Orla…  28.4 -81.3
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      Chic…  42.0 -87.9
## # … with 336,766 more rows, and 4 more variables: alt &lt;int&gt;, tz &lt;dbl&gt;,
## #   dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb855"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb855-1" data-line-number="1">flights2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb855-2" data-line-number="2"><span class="st">  </span><span class="kw">left_join</span>(airports, <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 15
##     year month   day  hour origin dest  tailnum carrier name    lat   lon
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1     5 EWR    IAH   N14228  UA      Newa…  40.7 -74.2
##  2  2013     1     1     5 LGA    IAH   N24211  UA      La G…  40.8 -73.9
##  3  2013     1     1     5 JFK    MIA   N619AA  AA      John…  40.6 -73.8
##  4  2013     1     1     5 JFK    BQN   N804JB  B6      John…  40.6 -73.8
##  5  2013     1     1     6 LGA    ATL   N668DN  DL      La G…  40.8 -73.9
##  6  2013     1     1     5 EWR    ORD   N39463  UA      Newa…  40.7 -74.2
##  7  2013     1     1     6 EWR    FLL   N516JB  B6      Newa…  40.7 -74.2
##  8  2013     1     1     6 LGA    IAD   N829AS  EV      La G…  40.8 -73.9
##  9  2013     1     1     6 JFK    MCO   N593JB  B6      John…  40.6 -73.8
## 10  2013     1     1     6 LGA    ORD   N3ALAA  AA      La G…  40.8 -73.9
## # … with 336,766 more rows, and 4 more variables: alt &lt;int&gt;, tz &lt;dbl&gt;,
## #   dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
</div>
<div id="-13.4.6.1" class="section level4">
<h4><span class="header-section-number">3.4.3.6</span> Упражнение 13.4.6.1</h4>
<div class="question">
<p>Compute the average delay by destination, then join on the airports data frame so you can show the spatial distribution of delays. Here’s an easy way to draw a map of the United States:</p>
</div>
<div class="sourceCode" id="cb857"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb857-1" data-line-number="1">airports <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb857-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(flights, <span class="kw">c</span>(<span class="st">&quot;faa&quot;</span> =<span class="st"> &quot;dest&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb857-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb857-4" data-line-number="4"><span class="st">    </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb857-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb857-6" data-line-number="6"><span class="st">    </span><span class="kw">coord_quickmap</span>()</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;maps&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     map</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-462-1.png" width="672" /></p>
<p>Вычислим для начала среднее время задержки по пунктам назначения. Для этого необходимо сгруппировать по направлению вылета <code>group_by(dest)</code>. Затем вычислить среднее значение задержки <code>delay = mean(arr_delay, na.rm = TRUE)</code>. И наконец просуммировать по группе — summarise()</p>
<div class="sourceCode" id="cb860"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb860-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb860-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb860-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## # A tibble: 105 x 2
##    dest   delay
##    &lt;chr&gt;  &lt;dbl&gt;
##  1 ABQ     4.38
##  2 ACK     4.85
##  3 ALB    14.4 
##  4 ANC    -2.5 
##  5 ATL    11.3 
##  6 AUS     6.02
##  7 AVL     8.00
##  8 BDL     7.05
##  9 BGR     8.03
## 10 BHM    16.9 
## # … with 95 more rows</code></pre>
<p>Теперь выполним задачу по соединению для фрейма данных <code>airports</code></p>
<div class="sourceCode" id="cb862"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb862-1" data-line-number="1">avg_dest &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb862-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb862-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb862-4" data-line-number="4"><span class="st">  </span><span class="kw">inner_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">dest =</span> <span class="st">&quot;faa&quot;</span>))</a></code></pre></div>
<p>Теперь нанесём значения времени задержки на карту</p>
<div class="sourceCode" id="cb863"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb863-1" data-line-number="1">avg_dest <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb863-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lon, lat, <span class="dt">color =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb863-3" data-line-number="3"><span class="st">    </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb863-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb863-5" data-line-number="5"><span class="st">    </span><span class="kw">coord_quickmap</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-465-1.png" width="672" /></p>
</div>
<div id="-13.4.6.2" class="section level4">
<h4><span class="header-section-number">3.4.3.7</span> Упражнение 13.4.6.2</h4>
<div class="question">
<p>Add the location of the origin and destination (i.e. the <code>lat</code> and <code>lon</code>) to <code>flights</code>.</p>
</div>
<p>Чтобы не плодить сущностей, т.е. параметров сверх необходимых, мы изначально ограничим исходные наборы данных, требуемыми параметрами. В таблице аэропортов останется всего три параметра ключ <code>faa</code> и координата долготы и широты</p>
<div class="sourceCode" id="cb864"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb864-1" data-line-number="1">airports_locations &lt;-<span class="st"> </span>airports <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb864-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(faa, lat, lon)</a></code></pre></div>
<p>И далее в наборе данных с полётам возьмём только необходимые параметры даты вылета и направлений. Только после этого присоединим данные при помощи именнованного символьного вектора</p>
<div class="sourceCode" id="cb865"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb865-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb865-2" data-line-number="2"><span class="st">    </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb865-3" data-line-number="3"><span class="st">    </span><span class="kw">inner_join</span>(airports_locations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">origin =</span> <span class="st">&quot;faa&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb865-4" data-line-number="4"><span class="st">    </span><span class="kw">inner_join</span>(airports_locations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">dest =</span> <span class="st">&quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 329,174 x 10
##     year month   day  hour origin dest  lat.x lon.x lat.y lon.y
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  2013     1     1     5 EWR    IAH    40.7 -74.2  30.0 -95.3
##  2  2013     1     1     5 LGA    IAH    40.8 -73.9  30.0 -95.3
##  3  2013     1     1     5 JFK    MIA    40.6 -73.8  25.8 -80.3
##  4  2013     1     1     6 LGA    ATL    40.8 -73.9  33.6 -84.4
##  5  2013     1     1     5 EWR    ORD    40.7 -74.2  42.0 -87.9
##  6  2013     1     1     6 EWR    FLL    40.7 -74.2  26.1 -80.2
##  7  2013     1     1     6 LGA    IAD    40.8 -73.9  38.9 -77.5
##  8  2013     1     1     6 JFK    MCO    40.6 -73.8  28.4 -81.3
##  9  2013     1     1     6 LGA    ORD    40.8 -73.9  42.0 -87.9
## 10  2013     1     1     6 JFK    PBI    40.6 -73.8  26.7 -80.1
## # … with 329,164 more rows</code></pre>
<p>В очередной раз спасибо <a href="https://github.com/jrnold">Jeffrey Arnold</a> за отличный совет: всегда давать понятные названия переменным, а главное за подсказку способа реализации — добавление параметра <code>suffix</code></p>
<div class="sourceCode" id="cb867"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb867-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb867-2" data-line-number="2"><span class="st">    </span><span class="kw">select</span>(year<span class="op">:</span>day, hour, origin, dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb867-3" data-line-number="3"><span class="st">    </span><span class="kw">inner_join</span>(airports_locations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">origin =</span> <span class="st">&quot;faa&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb867-4" data-line-number="4"><span class="st">    </span><span class="kw">inner_join</span>(airports_locations, <span class="dt">by =</span> <span class="kw">c</span>(<span class="dt">dest =</span> <span class="st">&quot;faa&quot;</span>), <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_origin&quot;</span>, <span class="st">&quot;_dest&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 329,174 x 10
##     year month   day  hour origin dest  lat_origin lon_origin lat_dest
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1  2013     1     1     5 EWR    IAH         40.7      -74.2     30.0
##  2  2013     1     1     5 LGA    IAH         40.8      -73.9     30.0
##  3  2013     1     1     5 JFK    MIA         40.6      -73.8     25.8
##  4  2013     1     1     6 LGA    ATL         40.8      -73.9     33.6
##  5  2013     1     1     5 EWR    ORD         40.7      -74.2     42.0
##  6  2013     1     1     6 EWR    FLL         40.7      -74.2     26.1
##  7  2013     1     1     6 LGA    IAD         40.8      -73.9     38.9
##  8  2013     1     1     6 JFK    MCO         40.6      -73.8     28.4
##  9  2013     1     1     6 LGA    ORD         40.8      -73.9     42.0
## 10  2013     1     1     6 JFK    PBI         40.6      -73.8     26.7
## # … with 329,164 more rows, and 1 more variable: lon_dest &lt;dbl&gt;</code></pre>
</div>
<div id="-13.4.6.3" class="section level4">
<h4><span class="header-section-number">3.4.3.8</span> Упражнение 13.4.6.3</h4>
<div class="question">
<p>Is there a relationship between the age of a plane and its delays?</p>
</div>
<p>Для того чтобы вспомнить, как между собой связаны таблицы полётов и самолётов, вспомним схему:</p>
<div class="figure">
<img src="img/relational.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Чтобы не тащить все данные, ограничимся несколькими переменными в таблице самолётов — внешним ключом <code>tailnum</code>, и годом производства самолёта <code>year</code></p>
<div class="sourceCode" id="cb869"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb869-1" data-line-number="1">year_planes &lt;-<span class="st"> </span>planes <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb869-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year, tailnum)</a></code></pre></div>
<p>В исходной таблице полётов тоже много смежной информации, она избыточна для решения задачи. Возьмём информацию о дате полёта, времени задержки, и номере самолёта (внешний ключ).</p>
<p>Для того чтобы установить некую связь между сроком эксплуатации и задержками самолёта пойдём следующей логикой. Сджойним две таблицы по номеру самолёта, затем сгруппируем по дате производства. Посчитаем в группах средннее время задержки и построим график даты производства от средней времени задержки. Для того чтобы установить возраст самолёта возьмём разность между датой полёта и датой производства.</p>
<div class="sourceCode" id="cb870"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb870-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb870-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, dep_delay, arr_delay, tailnum) <span class="op">%&gt;%</span><span class="st">           </span><span class="co"># Убираем избыточные данные</span></a>
<a class="sourceLine" id="cb870-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(year_planes, </a>
<a class="sourceLine" id="cb870-4" data-line-number="4">            <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>,                                     <span class="co"># Присоединяем по внешнему ключу инфу о самолётах</span></a>
<a class="sourceLine" id="cb870-5" data-line-number="5">            <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb870-6" data-line-number="6">            <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_of_plane&quot;</span>, <span class="st">&quot;_of_manufactered&quot;</span>)) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># Переименовываем параметры `year`, чтобы не запутаться </span></a>
<a class="sourceLine" id="cb870-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age =</span> year_of_plane <span class="op">-</span><span class="st"> </span>year_of_manufactered) <span class="op">%&gt;%</span><span class="st">        </span><span class="co"># Вычисляем возраст самолёта</span></a>
<a class="sourceLine" id="cb870-8" data-line-number="8"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(age)) <span class="op">%&gt;%</span><span class="st">                                       </span><span class="co"># Чтобы нарисовать график, фильтруем отсутствующие значения</span></a>
<a class="sourceLine" id="cb870-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(age) <span class="op">%&gt;%</span><span class="st">                                             </span><span class="co"># Группируем самолёты по возрасту</span></a>
<a class="sourceLine" id="cb870-10" data-line-number="10"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay_mean =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># чтобы посчитать среднее время задержки в возрасте</span></a>
<a class="sourceLine" id="cb870-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(age, dep_delay_mean)) <span class="op">+</span><span class="st">                            </span><span class="co"># Строим диаграмму рассеяния и сглаженную прямую по ним</span></a>
<a class="sourceLine" id="cb870-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb870-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-470-1.png" width="672" /></p>
<p>На этой диаграмме рассеяния видно, что самолёты в возрасте до 10 лет, имеют восходящий тренд задержки. Самолёты в возрасте от 10 до 20 лет, имеют плавный нисходящий тренд. Далее, чем старше самолёты тем меньше задержка отправления.</p>
<p>Уменьшение задержки вылета может быть связано с тем, что старые самолеты со многими механическими неисправностями выведены из эксплуатации или потому, что воздушные линии планируют эти самолеты с достаточным временем, чтобы механические неисправности не задерживали их.</p>
<p>Этот график обладает рядом особенностей</p>
<ul>
<li><p>чтобы сказать сколько лет самолёту, нужно знать как минимум дату совершения полётов.</p></li>
<li><p>Примерно между 30 и 40 годами, существенный разброс средних.</p></li>
<li><p>Кроме того, график отображает только задержки отправления, возможно связь с задержками по прибытию носит другой характер.</p></li>
</ul>
<p>Учитывая указанные особенности строим график, на котором будут все точки попадающие в каждый год. Для проверки того, отличается ли характер распределения задержек по прибытию, объединим данные задержек и построим на одном графике две панели с задержками по прибытию и отправлению.</p>
<div class="sourceCode" id="cb872"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb872-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, dep_delay, arr_delay, tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(year_planes, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_of_plane&quot;</span>, <span class="st">&quot;_of_manufactered&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(tailnum, year_of_manufactered) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-5" data-line-number="5"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">departure =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb872-6" data-line-number="6">            <span class="dt">arrival =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-7" data-line-number="7"><span class="st">  </span><span class="kw">gather</span>(departure, arrival, <span class="dt">key =</span> <span class="st">&quot;delay&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb872-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year_of_manufactered, value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb872-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb872-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb872-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>delay) <span class="op">+</span></a>
<a class="sourceLine" id="cb872-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Year of manufactured&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb872-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Mean Delay, minutes&quot;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 1596 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1596 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-471-1.png" width="672" /></p>
<p>На графике выше видно, что на рейсы редко пускают самолёты младше 1980 года. Количество полётов на самолётах старше 1980 года существенно ниже, чем полётов на более современных самолётах. Посмотрим какое распределение полётов между 1980 и</p>
<div class="sourceCode" id="cb876"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb876-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb876-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year<span class="op">:</span>day, dep_delay, arr_delay, tailnum) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb876-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(year_planes, </a>
<a class="sourceLine" id="cb876-4" data-line-number="4">            <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>, </a>
<a class="sourceLine" id="cb876-5" data-line-number="5">            <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb876-6" data-line-number="6">            <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;_of_plane&quot;</span>, <span class="st">&quot;_of_manufactured&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb876-7" data-line-number="7"><span class="st">  </span><span class="kw">group_by</span>(tailnum, year_of_manufactured) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb876-8" data-line-number="8"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">departure =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb876-9" data-line-number="9">            <span class="dt">arrival =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb876-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year_of_manufactured, departure)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb876-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="kw">aes</span>(<span class="dt">group =</span> <span class="kw">cut_width</span>(year_of_manufactured, <span class="dv">1</span>))) <span class="op">+</span><span class="st">                 </span><span class="co"># Группируем по году</span></a>
<a class="sourceLine" id="cb876-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_smooth</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb876-13" data-line-number="13"><span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="st">&quot;Logorithmic mean departure delay&quot;</span>) <span class="op">+</span><span class="st">                             </span><span class="co"># Логарифмическая ось</span></a>
<a class="sourceLine" id="cb876-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_x_reverse</span>(<span class="st">&quot;Year of manufactured&quot;</span>, <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">1930</span>, <span class="dv">2013</span>, <span class="dt">by =</span> <span class="dv">4</span>)) <span class="op">+</span><span class="st">  </span><span class="co"># Указываем на сетке каждые 4 года</span></a>
<a class="sourceLine" id="cb876-15" data-line-number="15"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Dependence of flight delay on the plane manufactured year. 2013&quot;</span>)</a></code></pre></div>
<pre><code>## Warning in self$trans$transform(x): созданы NaN</code></pre>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning in self$trans$transform(x): созданы NaN</code></pre>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<pre><code>## Warning: Removed 792 rows containing missing values (stat_boxplot).</code></pre>
<pre><code>## Warning: Removed 239 rows containing non-finite values (stat_boxplot).</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 1031 rows containing non-finite values (stat_smooth).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-472-1.png" width="672" /></p>
<p>Я сконцентрировался на данных о задержках отправления, так как показал выше, что задержки по прилёту не имеют существенных различий в распределении.</p>
<p>Этот график представляет улучшенную версию первого графика. На нём показано распределение времени задержки вылета в зависимости от года производства самолёта. Как говорилось выше — в представленном наборе данных мало наблюдений о полётах самолётов старше 1986 года. Это может свидетельствовать о том, что компании обновляют лётный парк и старые аппараты реже выпускают в рейс. Судя по представленным графикам компании тщетельнее и щепитильнее отнсятся к старым самолётам отправляя их в рейс, так как чем старее самолёт тем меньше у него задержка перед вылетом.</p>
<p>Однако в возрасте до 10 лет, наблюдается увеличение год от года времени задержки, затем до 20 лет время задержки выравнивается.</p>
</div>
<div id="-13.4.6.4" class="section level4">
<h4><span class="header-section-number">3.4.3.9</span> Упражнение 13.4.6.4</h4>
<div class="question">
<p>What weather conditions make it more likely to see a delay?</p>
</div>
<p>Задаём ключевые столбцы, по которым будет происходить соединение</p>
<div class="sourceCode" id="cb885"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb885-1" data-line-number="1">flights_with_weather &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb885-2" data-line-number="2"><span class="st">    </span><span class="kw">inner_join</span>(weather, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span> =<span class="st"> &quot;origin&quot;</span>,</a>
<a class="sourceLine" id="cb885-3" data-line-number="3">                            <span class="st">&quot;year&quot;</span> =<span class="st"> &quot;year&quot;</span>,</a>
<a class="sourceLine" id="cb885-4" data-line-number="4">                            <span class="st">&quot;month&quot;</span> =<span class="st"> &quot;month&quot;</span>,</a>
<a class="sourceLine" id="cb885-5" data-line-number="5">                            <span class="st">&quot;day&quot;</span> =<span class="st"> &quot;day&quot;</span>,</a>
<a class="sourceLine" id="cb885-6" data-line-number="6">                            <span class="st">&quot;hour&quot;</span> =<span class="st"> &quot;hour&quot;</span>))</a></code></pre></div>
<p>Есть несколько параметров характеризующих погодные условия, разберём каждый. Для начала, возьмём температуру</p>
<div class="sourceCode" id="cb886"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb886-1" data-line-number="1">flights_with_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb886-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(temp) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb886-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb886-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(temp, delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb886-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb886-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-474-1.png" width="672" /></p>
<p>На диаграмме рассеяния не наблюдается зависимость температуры от времени. Рассмотрим влияение влажности на задержки вылетов.</p>
<div class="sourceCode" id="cb890"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb890-1" data-line-number="1">flights_with_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb890-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(humid) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb890-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb890-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(humid, delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb890-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb890-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<pre><code>## Warning: Removed 3 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-475-1.png" width="672" /></p>
<p>Есть небольшой рост времени задержки при относительно высокой влажности. Между 26 и 60 единицами влажности не наблюдается корреляции с временем задержки. Рассмотрим скорость ветра</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb894-1" data-line-number="1">flights_with_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb894-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(wind_speed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb894-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb894-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(wind_speed, delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb894-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb894-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-476-1.png" width="672" /></p>
<p>При увеличении скорости ветра от 0 до 20 миль в час, наблюдается увеличениее времени задержки. Однако характер зависимости при высоких значениях скорости ветра (от 20 до 35 миль в час) носит нелинейный характер и уменьшается практически до уровня задержки при отсутсвии ветра.</p>
<p>Рассмотрим порывы ветра</p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb898-1" data-line-number="1">flights_with_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb898-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(wind_gust) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb898-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb898-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(wind_gust, delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb898-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb898-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-477-1.png" width="672" /></p>
<p>Есть небольшой рост времени задержки при увеличинии скорости порывов, однако это рост не значительный. При больших порывах (50-60 мил в час) не всегда увеличивается время задержки. Рассмотрим как влияют осадки на время задержки</p>
<div class="sourceCode" id="cb902"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb902-1" data-line-number="1">flights_with_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb902-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(precip) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb902-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb902-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(precip, delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb902-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb902-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-478-1.png" width="672" /></p>
<p>Пожалуй, самая показательная зависимость, приближенная к линейной, с увеличением количества осадков, компании медлят с разрешением полёта. Рассмотрим как влияет атмосферное давление на задержки:</p>
<div class="sourceCode" id="cb904"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb904-1" data-line-number="1">flights_with_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb904-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(pressure) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb904-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb904-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(pressure, delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb904-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb904-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning: Removed 1 rows containing non-finite values (stat_smooth).</code></pre>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-479-1.png" width="672" /></p>
<p>Увеличение давления, наоборот — уменьшает время задержки вылета, хоть и не значительно.</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb908-1" data-line-number="1">flights_with_weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb908-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(visib) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb908-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb908-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(visib, delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb908-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb908-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-480-1.png" width="672" /></p>
<p>ВИдимость практически не влияет на время задержки.</p>
<p>Резюмируя: на время задержки вылета самолёта в большей степени влияют выпадаемые осадки (вероятно потому что необходимо расчищать взлётную полосу в зимнее время). Заметно на время задержки вылета влияет скорость и порывы ветра (вероятно потому что сложно взлетать при сильном ветре). Остальные представленные показатели погоды (температура, атмосферное давление, видимость) слабо увеличивают или вовсе уменьшают время задержки вылета.</p>
</div>
<div id="-13.4.6.5" class="section level4">
<h4><span class="header-section-number">3.4.3.10</span> Упражнение 13.4.6.5</h4>
<div class="question">
<p>What happened on June 13 2013? Display the spatial pattern of delays, and then use Google to cross-reference with the weather.</p>
</div>
<p>Гуглим. Оказывается в этот день, точнее в дни 12-13 июня произошла <a href="https://en.wikipedia.org/wiki/June_12–13,_2013_derecho_series">серия шторвом</a> на южном побережье. Вероятно это может вызвать задержки</p>
<p>Сравним к примеру два дня — день шторма и любой другой день</p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb910-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb910-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>, month <span class="op">==</span><span class="st"> </span><span class="dv">6</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">13</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb910-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb910-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb910-5" data-line-number="5"><span class="st">  </span><span class="kw">inner_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb910-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lat, <span class="dt">x =</span> lon, <span class="dt">size =</span> delay, <span class="dt">colour =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb910-7" data-line-number="7"><span class="st">  </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb910-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb910-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_quickmap</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb910-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_colour_viridis</span>()</a></code></pre></div>
<pre><code>## Warning: Removed 3 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-481-1.png" width="672" /></p>
<div class="sourceCode" id="cb912"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb912-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb912-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(year <span class="op">==</span><span class="st"> </span><span class="dv">2013</span>, month <span class="op">==</span><span class="st"> </span><span class="dv">1</span>, day <span class="op">==</span><span class="st"> </span><span class="dv">13</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb912-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(dest) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb912-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb912-5" data-line-number="5"><span class="st">  </span><span class="kw">inner_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb912-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> lat, <span class="dt">x =</span> lon, <span class="dt">size =</span> delay, <span class="dt">colour =</span> delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb912-7" data-line-number="7"><span class="st">  </span><span class="kw">borders</span>(<span class="st">&quot;state&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb912-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb912-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_quickmap</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb912-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_colour_viridis</span>()</a></code></pre></div>
<pre><code>## Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-482-1.png" width="672" /></p>
<p>Заметно существенное увеличение числа задержек прибытия самолётов в день штормов</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.4.3.11</span> Другие реализации</h4>
<p>Функция <code>base::merge()</code> способна выполнять все четыре типа мутации</p>
<table>
<thead>
<tr class="header">
<th>dplyr</th>
<th>merge</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inner_join(x, y)</code></td>
<td><code>merge(x, y)</code></td>
</tr>
<tr class="even">
<td><code>left_join(x, y)</code></td>
<td><code>merge(x, y, all.x = TRUE)</code></td>
</tr>
<tr class="odd">
<td><code>right_join(x, y)</code></td>
<td><code>merge(x, y, all.y = TRUE)</code>,</td>
</tr>
<tr class="even">
<td><code>full_join(x, y)</code></td>
<td><code>merge(x, y, all.x = TRUE, all.y = TRUE)</code></td>
</tr>
</tbody>
</table>
<p>Но нагляднее видится использование в коде глаголов <code>dplyr</code>, в силу того что тип соединения не спрятан в параметре а напрямую указан в самой функции.</p>
<p>SQL запросы выглядят следующим образом</p>
<table>
<thead>
<tr class="header">
<th>dplyr</th>
<th>SQL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>inner_join(x, y, by = &quot;z&quot;)</code></td>
<td><code>SELECT * FROM x INNER JOIN y USING (z)</code></td>
</tr>
<tr class="even">
<td><code>left_join(x, y, by = &quot;z&quot;)</code></td>
<td><code>SELECT * FROM x LEFT OUTER JOIN y USING (z)</code></td>
</tr>
<tr class="odd">
<td><code>right_join(x, y, by = &quot;z&quot;)</code></td>
<td><code>SELECT * FROM x RIGHT OUTER JOIN y USING (z)</code></td>
</tr>
<tr class="even">
<td><code>full_join(x, y, by = &quot;z&quot;)</code></td>
<td><code>SELECT * FROM x FULL OUTER JOIN y USING (z)</code></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Фильтрующие соединения</h3>
<p>Фильтрующие соединения (полусоединения) сопоставляют наблюдения но влияют не на переменные а на наблюдения. Есть два типа полусоединений:</p>
<ul>
<li><code>semi_join(x, y)</code> <strong>сохраняет</strong> все наблюдения в <code>x</code> для которых имеется совпадение в <code>y</code>.</li>
<li><code>anti_join(x, y)</code> <strong>опускает</strong> все наблюдения в <code>x</code> для которых имеется совпадение в <code>y</code>.</li>
</ul>
<p>Полусуоединения могут быть полезны при обратном сопоставлении отфильтрованных итоговых таблиц с исходными строками. Предположим, что мы нашли первую десятку наиболее популярных пунктов назначения</p>
<div class="sourceCode" id="cb914"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb914-1" data-line-number="1">top_dest &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb914-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(dest, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb914-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb914-4" data-line-number="4">top_dest</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    dest      n
##    &lt;chr&gt; &lt;int&gt;
##  1 ORD   17283
##  2 ATL   17215
##  3 LAX   16174
##  4 BOS   15508
##  5 MCO   14082
##  6 CLT   14064
##  7 SFO   13331
##  8 FLL   12055
##  9 MIA   11728
## 10 DCA    9705</code></pre>
<p>А теперь мы хотим найти все авиарейсы, совершенные в один из этих аэропортов назначения. Можно самостоятельно спроектировать фильтр:</p>
<div class="sourceCode" id="cb916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb916-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb916-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dest <span class="op">%in%</span><span class="st"> </span>top_dest<span class="op">$</span>dest)</a></code></pre></div>
<pre><code>## # A tibble: 141,145 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      542            540         2      923
##  2  2013     1     1      554            600        -6      812
##  3  2013     1     1      554            558        -4      740
##  4  2013     1     1      555            600        -5      913
##  5  2013     1     1      557            600        -3      838
##  6  2013     1     1      558            600        -2      753
##  7  2013     1     1      558            600        -2      924
##  8  2013     1     1      558            600        -2      923
##  9  2013     1     1      559            559         0      702
## 10  2013     1     1      600            600         0      851
## # … with 141,135 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>но есть определённые сложности, когда вернуть значения нужно по нескольким переменным. Чтобы упростить себе задачу, можно использовать фильтрующее соединение</p>
<div class="sourceCode" id="cb918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb918-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb918-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(top_dest)</a></code></pre></div>
<pre><code>## Joining, by = &quot;dest&quot;</code></pre>
<pre><code>## # A tibble: 141,145 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      542            540         2      923
##  2  2013     1     1      554            600        -6      812
##  3  2013     1     1      554            558        -4      740
##  4  2013     1     1      555            600        -5      913
##  5  2013     1     1      557            600        -3      838
##  6  2013     1     1      558            600        -2      753
##  7  2013     1     1      558            600        -2      924
##  8  2013     1     1      558            600        -2      923
##  9  2013     1     1      559            559         0      702
## 10  2013     1     1      600            600         0      851
## # … with 141,135 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>В графическом представлении это выглядит так:</p>
<div class="figure">
<img src="img/join-semi.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Важен сам факт наличие соответствия, не имеет значения, для какого элемента находится соответствуие. Это означает, что фильтрующее соединение никогда не дублирует строки, как это делают мутирующие соединения:</p>
<div class="figure">
<img src="img/join-semi-many.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Прямая противоположность полусоединению — антисоединение. Она созраняет строки, для которых отсутствует соответствие.</p>
<div class="figure">
<img src="img/join-anti.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Антисоединения полезны в качестве средства диагностики несоответствий соединения. Например, при соединении таблиц <code>flights</code> <code>planes</code> является интересным количество авиарейсов, для которых не находится соответствия по самолётам:</p>
<div class="sourceCode" id="cb921"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb921-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb921-2" data-line-number="2"><span class="st">  </span><span class="kw">anti_join</span>(planes, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb921-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(tailnum, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 722 x 2
##    tailnum     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 &lt;NA&gt;     2512
##  2 N725MQ    575
##  3 N722MQ    513
##  4 N723MQ    507
##  5 N713MQ    483
##  6 N735MQ    396
##  7 N0EGMQ    371
##  8 N534MQ    364
##  9 N542MQ    363
## 10 N531MQ    349
## # … with 712 more rows</code></pre>
<div id="-13.5.1.1" class="section level4">
<h4><span class="header-section-number">3.4.4.1</span> Упражнение 13.5.1.1</h4>
<div class="question">
<p>What does it mean for a flight to have a missing tailnum? What do the tail numbers that don’t have a matching record in planes have in common? (Hint: one variable explains ~90% of the problems.)</p>
</div>
<p>Используем антисоединение для диагностики несоответсвий соединения. Логично заключить, что нужно проверить самолёты каких авиакомпаний не имеют информации о номерах самолётов</p>
<div class="sourceCode" id="cb923"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb923-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb923-2" data-line-number="2"><span class="st">  </span><span class="kw">anti_join</span>(planes, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb923-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(carrier, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    carrier     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 MQ      25397
##  2 AA      22558
##  3 UA       1693
##  4 9E       1044
##  5 B6        830
##  6 US        699
##  7 FL        187
##  8 DL        110
##  9 F9         50
## 10 WN         38</code></pre>
<p>И действительно — компании Envoy Air и American Airlines Inc. не подали информации о номерах самолётов.</p>
</div>
<div id="-13.5.1.2" class="section level4">
<h4><span class="header-section-number">3.4.4.2</span> Упражнение 13.5.1.2</h4>
<div class="question">
<p>Filter flights to only show flights with planes that have flown at least 100 flights.</p>
</div>
<p>Для начала отберём самолёты, которые выполнили не менее 100 полётов</p>
<div class="sourceCode" id="cb925"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb925-1" data-line-number="1">top100_planes &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb925-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(tailnum, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb925-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;=</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb925-4" data-line-number="4">top100_planes</a></code></pre></div>
<pre><code>## # A tibble: 1,218 x 2
##    tailnum     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 &lt;NA&gt;     2512
##  2 N725MQ    575
##  3 N722MQ    513
##  4 N723MQ    507
##  5 N711MQ    486
##  6 N713MQ    483
##  7 N258JB    427
##  8 N298JB    407
##  9 N353JB    404
## 10 N351JB    402
## # … with 1,208 more rows</code></pre>
<p>Теперь отфильтруем исходную таблицу по полученным данным о количестве полётов</p>
<div class="sourceCode" id="cb927"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb927-1" data-line-number="1"><span class="kw">semi_join</span>(flights, top100_planes, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 230,902 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      544            545        -1     1004
##  4  2013     1     1      554            558        -4      740
##  5  2013     1     1      555            600        -5      913
##  6  2013     1     1      557            600        -3      709
##  7  2013     1     1      557            600        -3      838
##  8  2013     1     1      558            600        -2      849
##  9  2013     1     1      558            600        -2      853
## 10  2013     1     1      558            600        -2      923
## # … with 230,892 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Стоит помнить о необходимости явно указывать ключ, по которому происходит группировка.</p>
</div>
<div id="-13.5.1.3" class="section level4">
<h4><span class="header-section-number">3.4.4.3</span> Упражнение 13.5.1.3</h4>
<div class="question">
<p>Combine <code>fueleconomy::vehicles</code> and <code>fueleconomy::common</code> to find only the records for the most common models.</p>
</div>
<div class="sourceCode" id="cb929"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb929-1" data-line-number="1">fueleconomy<span class="op">::</span>vehicles <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">semi_join</span>(fueleconomy<span class="op">::</span>common, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;make&quot;</span>, <span class="st">&quot;model&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 14,531 x 12
##       id make  model   year class trans drive   cyl displ fuel    hwy   cty
##    &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;int&gt; &lt;int&gt;
##  1  1833 Acura Integ…  1986 Subc… Auto… Fron…     4   1.6 Regu…    28    22
##  2  1834 Acura Integ…  1986 Subc… Manu… Fron…     4   1.6 Regu…    28    23
##  3  3037 Acura Integ…  1987 Subc… Auto… Fron…     4   1.6 Regu…    28    22
##  4  3038 Acura Integ…  1987 Subc… Manu… Fron…     4   1.6 Regu…    28    23
##  5  4183 Acura Integ…  1988 Subc… Auto… Fron…     4   1.6 Regu…    27    22
##  6  4184 Acura Integ…  1988 Subc… Manu… Fron…     4   1.6 Regu…    28    23
##  7  5303 Acura Integ…  1989 Subc… Auto… Fron…     4   1.6 Regu…    27    22
##  8  5304 Acura Integ…  1989 Subc… Manu… Fron…     4   1.6 Regu…    28    23
##  9  6442 Acura Integ…  1990 Subc… Auto… Fron…     4   1.8 Regu…    24    20
## 10  6443 Acura Integ…  1990 Subc… Manu… Fron…     4   1.8 Regu…    26    21
## # … with 14,521 more rows</code></pre>
<p>Объединение обязательно должно происходить по производителю и названию модели. А не только по какому-то одному из параметров. Так вполне вероятно, что несколько производителей могут дать своим автомобилям одинаковые названия моделей.</p>
<div class="sourceCode" id="cb931"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb931-1" data-line-number="1">fueleconomy<span class="op">::</span>common <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb931-2" data-line-number="2"><span class="st">  </span><span class="kw">distinct</span>(model, make) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb931-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb931-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">n</span>() <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb931-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(model)</a></code></pre></div>
<pre><code>## Warning: Detecting old grouped_df format, replacing `vars` attribute by
## `groups`</code></pre>
<pre><code>## # A tibble: 8 x 2
## # Groups:   model [3]
##   model     make      
##   &lt;chr&gt;     &lt;chr&gt;     
## 1 Colt      Dodge     
## 2 Colt      Plymouth  
## 3 Truck 2WD Mitsubishi
## 4 Truck 2WD Nissan    
## 5 Truck 2WD Toyota    
## 6 Truck 4WD Mitsubishi
## 7 Truck 4WD Nissan    
## 8 Truck 4WD Toyota</code></pre>
</div>
<div id="-13.5.1.4" class="section level4">
<h4><span class="header-section-number">3.4.4.4</span> Упражнение 13.5.1.4</h4>
<div class="question">
<p>Find the 48 hours (over the course of the whole year) that have the worst delays. Cross-reference it with the weather data. Can you see any patterns?</p>
</div>
<p>Для начала сгруппируем все данные по месяцу и дню (без года, так как в исходных данных наблюдения только за 2013 год). Затем посчитаем суммарное время задержки за день</p>
<div class="sourceCode" id="cb934"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb934-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb934-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb934-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delays_24 =</span> <span class="kw">sum</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb934-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(delays_<span class="dv">24</span>))</a></code></pre></div>
<pre><code>## # A tibble: 365 x 3
## # Groups:   month [12]
##    month   day delays_24
##    &lt;int&gt; &lt;int&gt;     &lt;dbl&gt;
##  1     3     8    135264
##  2     7     1    100654
##  3     7    10     97120
##  4     6    13     97104
##  5     7    22     94778
##  6     8     8     92421
##  7     6    24     86215
##  8     5    23     86078
##  9     9    12     85035
## 10    12     5     84236
## # … with 355 more rows</code></pre>
<p>Но в условиях задачи, необходимо найти 48 часов, т.е. двое последующих суток. Для этого необходимо добавить суммирование с лагом</p>
<div class="sourceCode" id="cb936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb936-1" data-line-number="1">worst_delays &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb936-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb936-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">delays_24 =</span> <span class="kw">sum</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb936-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">delays_48 =</span> delays_<span class="dv">24</span> <span class="op">+</span><span class="st"> </span><span class="kw">lead</span>(delays_<span class="dv">24</span>))  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb936-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(delays_<span class="dv">48</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb936-6" data-line-number="6"><span class="st">  </span><span class="kw">head</span>(<span class="dv">1</span>)</a></code></pre></div>
<p>Наихудшими 48 часами были 22-23 июля</p>
<div class="sourceCode" id="cb937"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb937-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb937-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(worst_delays) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb937-3" data-line-number="3"><span class="st">  </span><span class="kw">left_join</span>(weather) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb937-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(dep_delay))</a></code></pre></div>
<pre><code>## Joining, by = c(&quot;month&quot;, &quot;day&quot;)</code></pre>
<pre><code>## Joining, by = c(&quot;year&quot;, &quot;month&quot;, &quot;day&quot;, &quot;origin&quot;, &quot;hour&quot;, &quot;time_hour&quot;)</code></pre>
<pre><code>## # A tibble: 1,000 x 28
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     7    22      845           1600      1005     1044
##  2  2013     7    22     2257            759       898      121
##  3  2013     7    22       41           1638       483      154
##  4  2013     7    22       50           1830       380      242
##  5  2013     7    22     2304           1655       369      133
##  6  2013     7    22      104           1859       365      305
##  7  2013     7    22     2216           1620       356      116
##  8  2013     7    22     2336           1745       351      159
##  9  2013     7    22     2050           1500       350     2204
## 10  2013     7    22     2037           1500       337     2206
## # … with 990 more rows, and 21 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, temp &lt;dbl&gt;, dewp &lt;dbl&gt;, humid &lt;dbl&gt;,
## #   wind_dir &lt;dbl&gt;, wind_speed &lt;dbl&gt;, wind_gust &lt;dbl&gt;, precip &lt;dbl&gt;,
## #   pressure &lt;dbl&gt;, visib &lt;dbl&gt;</code></pre>
<p>К сожалению, перепроверив все имеющиеся показатели погоды, мне не удалось найти явной зависимости погодных условий с задержками авиарейсов. Было не очень жарко, не очень много осадков, не самый сильный ветер, довольно хорошая видимость. <a href="https://www.timeanddate.com/weather/usa/new-york/historic?month=7&amp;year=2013">Данные</a></p>
<div class="sourceCode" id="cb941"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb941-1" data-line-number="1">weather <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb941-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(month, day) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb941-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">worst =</span> <span class="kw">mean</span>(wind_gust, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb941-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(worst))</a></code></pre></div>
<pre><code>## # A tibble: 364 x 3
## # Groups:   month [12]
##    month   day worst
##    &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
##  1     1    31  41.3
##  2     3     6  35.6
##  3     2    17  35.1
##  4    11    24  34.0
##  5     5    25  31.9
##  6     3    14  31.4
##  7    11    27  31.4
##  8     7    23  31.1
##  9     2    27  31.0
## 10     4    19  30.6
## # … with 354 more rows</code></pre>
</div>
<div id="-13.5.1.5" class="section level4">
<h4><span class="header-section-number">3.4.4.5</span> Упражнение 13.5.1.5</h4>
<div class="question">
<p>What does <code>anti_join(flights, airports, by = c(&quot;dest&quot; = &quot;faa&quot;))</code> tell you?
What does <code>anti_join(airports, flights, by = c(&quot;faa&quot; = &quot;dest&quot;))</code> tell you?</p>
</div>
<p>Антиджоин указывает на несоответствие соединений.</p>
<p>Поэтому ответ на первый вопрос — в выдаче программы будут полёты, у которых нет соответствия в таблице аэропортов по ключу “аэропорт направления”.</p>
<div class="sourceCode" id="cb943"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb943-1" data-line-number="1"><span class="kw">anti_join</span>(flights, airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 7,602 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      544            545        -1     1004
##  2  2013     1     1      615            615         0     1039
##  3  2013     1     1      628            630        -2     1137
##  4  2013     1     1      701            700         1     1123
##  5  2013     1     1      711            715        -4     1151
##  6  2013     1     1      820            820         0     1254
##  7  2013     1     1      820            820         0     1249
##  8  2013     1     1      840            845        -5     1311
##  9  2013     1     1      909            810        59     1331
## 10  2013     1     1      913            918        -5     1346
## # … with 7,592 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<p>Аэропорты, которые есть в таблице полётов, но которых нет в таблице <code>airports</code></p>
<div class="sourceCode" id="cb945"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb945-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb945-2" data-line-number="2"><span class="st">  </span><span class="kw">anti_join</span>(airports, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;dest&quot;</span> =<span class="st"> &quot;faa&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb945-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(dest, <span class="dt">sort =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   dest      n
##   &lt;chr&gt; &lt;int&gt;
## 1 SJU    5819
## 2 BQN     896
## 3 STT     522
## 4 PSE     365</code></pre>
<div class="sourceCode" id="cb947"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb947-1" data-line-number="1">airports <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb947-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(faa <span class="op">==</span><span class="st"> &quot;SJU&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 8
## # … with 8 variables: faa &lt;chr&gt;, name &lt;chr&gt;, lat &lt;dbl&gt;, lon &lt;dbl&gt;,
## #   alt &lt;int&gt;, tz &lt;dbl&gt;, dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
<p>Ответ на второй вопрос, соответсвенно обратный — в выдаче будут те аэропорты, которые есть в таблице <code>airports</code>, но которые не встречаются в таблице <code>flights</code></p>
<div class="sourceCode" id="cb949"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb949-1" data-line-number="1"><span class="kw">anti_join</span>(airports, flights, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;faa&quot;</span> =<span class="st"> &quot;dest&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 1,357 x 8
##    faa   name                    lat    lon   alt    tz dst   tzone        
##    &lt;chr&gt; &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;        
##  1 04G   Lansdowne Airport      41.1  -80.6  1044    -5 A     America/New_…
##  2 06A   Moton Field Municipa…  32.5  -85.7   264    -6 A     America/Chic…
##  3 06C   Schaumburg Regional    42.0  -88.1   801    -6 A     America/Chic…
##  4 06N   Randall Airport        41.4  -74.4   523    -5 A     America/New_…
##  5 09J   Jekyll Island Airport  31.1  -81.4    11    -5 A     America/New_…
##  6 0A9   Elizabethton Municip…  36.4  -82.2  1593    -5 A     America/New_…
##  7 0G6   Williams County Airp…  41.5  -84.5   730    -5 A     America/New_…
##  8 0G7   Finger Lakes Regiona…  42.9  -76.8   492    -5 A     America/New_…
##  9 0P2   Shoestring Aviation …  39.8  -76.6  1000    -5 U     America/New_…
## 10 0S9   Jefferson County Intl  48.1 -123.    108    -8 A     America/Los_…
## # … with 1,347 more rows</code></pre>
<div class="sourceCode" id="cb951"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb951-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb951-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dest <span class="op">==</span><span class="st"> &quot;04G&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 19
## # … with 19 variables: year &lt;int&gt;, month &lt;int&gt;, day &lt;int&gt;, dep_time &lt;int&gt;,
## #   sched_dep_time &lt;int&gt;, dep_delay &lt;dbl&gt;, arr_time &lt;int&gt;,
## #   sched_arr_time &lt;int&gt;, arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;,
## #   tailnum &lt;chr&gt;, origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;,
## #   distance &lt;dbl&gt;, hour &lt;dbl&gt;, minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
</div>
<div id="-13.5.1.6" class="section level4">
<h4><span class="header-section-number">3.4.4.6</span> Упражнение 13.5.1.6</h4>
<div class="question">
<p>You might expect that there’s an implicit relationship between plane and airline, because each plane is flown by a single airline. Confirm or reject this hypothesis using the tools you’ve learned above.</p>
</div>
<p>Для того чтобы проверить утверждение “между самолётами и компаниями существуют неявные отношения”, нужно проверить есть ли самолёты, которые принадлежат несколким компаниям</p>
<div class="sourceCode" id="cb953"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb953-1" data-line-number="1">(not_one_carrier &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb953-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(tailnum)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb953-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>(tailnum, carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb953-4" data-line-number="4"><span class="st">  </span><span class="kw">count</span>(tailnum, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb953-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(n <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>))</a></code></pre></div>
<pre><code>## # A tibble: 17 x 2
##    tailnum     n
##    &lt;chr&gt;   &lt;int&gt;
##  1 N146PQ      2
##  2 N153PQ      2
##  3 N176PQ      2
##  4 N181PQ      2
##  5 N197PQ      2
##  6 N200PQ      2
##  7 N228PQ      2
##  8 N232PQ      2
##  9 N933AT      2
## 10 N935AT      2
## 11 N977AT      2
## 12 N978AT      2
## 13 N979AT      2
## 14 N981AT      2
## 15 N989AT      2
## 16 N990AT      2
## 17 N994AT      2</code></pre>
<p>Аккуратным представлением данных будет следующее</p>
<div class="sourceCode" id="cb955"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb955-1" data-line-number="1">(not_one_carrier &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-2" data-line-number="2"><span class="kw">semi_join</span>(not_one_carrier, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(tailnum, carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-4" data-line-number="4"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(tailnum)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(tailnum, carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-7" data-line-number="7"><span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by =</span> <span class="st">&quot;carrier&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb955-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>carrier)</a></code></pre></div>
<pre><code>## # A tibble: 34 x 3
##    tailnum     n name                    
##    &lt;chr&gt;   &lt;int&gt; &lt;chr&gt;                   
##  1 N146PQ      1 Endeavor Air Inc.       
##  2 N146PQ      1 ExpressJet Airlines Inc.
##  3 N153PQ      1 Endeavor Air Inc.       
##  4 N153PQ      1 ExpressJet Airlines Inc.
##  5 N176PQ      1 Endeavor Air Inc.       
##  6 N176PQ      1 ExpressJet Airlines Inc.
##  7 N181PQ      1 Endeavor Air Inc.       
##  8 N181PQ      1 ExpressJet Airlines Inc.
##  9 N197PQ      1 Endeavor Air Inc.       
## 10 N197PQ      1 ExpressJet Airlines Inc.
## # … with 24 more rows</code></pre>
<p>Чуть более наглядным будет представление:</p>
<div class="sourceCode" id="cb957"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb957-1" data-line-number="1">(not_one_carrier &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-2" data-line-number="2"><span class="kw">semi_join</span>(not_one_carrier, <span class="dt">by =</span> <span class="st">&quot;tailnum&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(tailnum, carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-4" data-line-number="4"><span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-5" data-line-number="5"><span class="st">  </span><span class="kw">arrange</span>(tailnum)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(tailnum, carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-7" data-line-number="7"><span class="st">  </span><span class="kw">left_join</span>(airlines, <span class="dt">by =</span> <span class="st">&quot;carrier&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-8" data-line-number="8"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>carrier) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb957-9" data-line-number="9"><span class="st">  </span><span class="kw">spread</span>(name, n)</a></code></pre></div>
<pre><code>## # A tibble: 17 x 5
##    tailnum `AirTran Airway… `Delta Air Line… `Endeavor Air I…
##    &lt;chr&gt;              &lt;int&gt;            &lt;int&gt;            &lt;int&gt;
##  1 N146PQ                NA               NA                1
##  2 N153PQ                NA               NA                1
##  3 N176PQ                NA               NA                1
##  4 N181PQ                NA               NA                1
##  5 N197PQ                NA               NA                1
##  6 N200PQ                NA               NA                1
##  7 N228PQ                NA               NA                1
##  8 N232PQ                NA               NA                1
##  9 N933AT                 1                1               NA
## 10 N935AT                 1                1               NA
## 11 N977AT                 1                1               NA
## 12 N978AT                 1                1               NA
## 13 N979AT                 1                1               NA
## 14 N981AT                 1                1               NA
## 15 N989AT                 1                1               NA
## 16 N990AT                 1                1               NA
## 17 N994AT                 1                1               NA
## # … with 1 more variable: `ExpressJet Airlines Inc.` &lt;int&gt;</code></pre>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Проблемы соединений</h3>
<p>Данные в этой главе были специально подготовлены для того чтоб ы при работе с ними возникало как можно меньше проблем. Реальные данные не такие.</p>
<p>ЧТобы при работы с реальными данными возникало как можно меньше проблем, в отношении данных необходимо предпринимать следующие меры:</p>
<ol style="list-style-type: decimal">
<li><p>Начинать нужно с идентификации переменных, образующих первичный ключ в каждой таблице. Это нужно делать <em>ПОНИМАЯ</em> данные, а не подбирая эмпирически уникальную комбинацию</p></li>
<li><p>Необходимо убедиться что ни одна из переменных в первичном ключе не содержит пропущенных значений. Отсутствующие значения не могут однозначно определить наблюдение.</p></li>
<li><p>Необходимо убедиться, что внешним ключам соответствуют первичные ключи в присоединяемой таблице. Обычно это проще всего проверить при помощи <code>anti_join</code>.</p></li>
</ol>
<p>Конечно же важно помнимать, что простой проверки по количеству строк не достаточно при объединении.</p>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.4.6</span> Операции над множествами</h3>
<p>Последний тип двухтабличных глаголов предназначен для выполнения операция над множествами. Все эти операции работают с целыми строками, сравнивая значения каждой переменной.</p>
<p>ПРиведённые ниже функции ожидают, что входные таблицы <code>х</code> и <code>у</code> имеют одни и те же переменные и обрабатывают наблюдения как множества.</p>
<ul>
<li><p><code>intrsect(x, y)</code> — Возвращает только наблюдения, содержащие одновременно в <code>х</code> и <code>у</code></p></li>
<li><p><code>union(x, y)</code> — Возвращает уникальные наблюдения, содержащие в <code>х</code> и <code>у</code></p></li>
<li><p><code>setdiff(x, y)</code> — Возвращает наблюдения, содержащие только в <code>х</code>, но не в <code>у</code></p></li>
</ul>
<p>Пусть имеются следующие простые данные:</p>
<div class="sourceCode" id="cb959"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb959-1" data-line-number="1">df1 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb959-2" data-line-number="2">  <span class="op">~</span>x, <span class="op">~</span>y,</a>
<a class="sourceLine" id="cb959-3" data-line-number="3">   <span class="dv">1</span>, <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb959-4" data-line-number="4">   <span class="dv">2</span>, <span class="dv">1</span></a>
<a class="sourceLine" id="cb959-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb959-6" data-line-number="6"></a>
<a class="sourceLine" id="cb959-7" data-line-number="7">df2 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb959-8" data-line-number="8">  <span class="op">~</span>x, <span class="op">~</span>y,</a>
<a class="sourceLine" id="cb959-9" data-line-number="9">   <span class="dv">1</span>, <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb959-10" data-line-number="10">   <span class="dv">1</span>, <span class="dv">2</span></a>
<a class="sourceLine" id="cb959-11" data-line-number="11">)</a></code></pre></div>
<p>ТОгда возможны следующие четыре операции</p>
<div class="sourceCode" id="cb960"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb960-1" data-line-number="1"><span class="kw">intersect</span>(df1, df2)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1</code></pre>
<div class="sourceCode" id="cb962"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb962-1" data-line-number="1"><span class="kw">union</span>(df1, df2)     <span class="co"># Возваращает 3 наблюдения, а не 4</span></a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     1
## 2     2     1
## 3     1     2</code></pre>
<div class="sourceCode" id="cb964"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb964-1" data-line-number="1"><span class="kw">setdiff</span>(df1, df2)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     2     1</code></pre>
<div class="sourceCode" id="cb966"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb966-1" data-line-number="1"><span class="kw">setdiff</span>(df2, df1)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##       x     y
##   &lt;dbl&gt; &lt;dbl&gt;
## 1     1     2</code></pre>
<!--chapter:end:10_relation_data.Rmd-->
</div>
</div>
<div id="-----tidyr-2" class="section level2">
<h2><span class="header-section-number">3.5</span> Аккуратизация данных с помощью пакета <code>tidyr</code></h2>
<div id="-8" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Введение</h3>
<p>Основное внимание в этой главе будет уделено регулярным выражениям</p>
<div id="--5" class="section level4">
<h4><span class="header-section-number">3.5.1.1</span> Необходимые ресурсы</h4>
<div class="sourceCode" id="cb968"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb968-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb968-2" data-line-number="2"><span class="kw">library</span>(stringr)</a></code></pre></div>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Основы работы со строками</h3>
<p>Чтобы создать строку достаточно использовать кавычки</p>
<div class="sourceCode" id="cb969"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb969-1" data-line-number="1">string1 &lt;-<span class="st"> &quot;Это уже строка&quot;</span></a>
<a class="sourceLine" id="cb969-2" data-line-number="2">string2 &lt;-<span class="st"> &#39;Это тоже строка, но внутри неё есть &quot;кавычки&quot;&#39;</span></a></code></pre></div>
<p>Если в строке есть спецсимволы их нужно “экранировать” апострофом или кавычками:</p>
<div class="sourceCode" id="cb970"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb970-1" data-line-number="1">double_qoute &lt;-<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb970-2" data-line-number="2">single_qoute &lt;-<span class="st"> &#39;</span><span class="ch">\&#39;</span><span class="st">&#39;</span></a>
<a class="sourceLine" id="cb970-3" data-line-number="3">ap_qoute &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">&quot;</span></a></code></pre></div>
<p>Со строками всё очень похоже на маркдаун — печатное отображение строки, не то же самое что сама строка. Чтобы увидеть содержание строки можно использовать функцию <code>writeLines()</code></p>
<div class="sourceCode" id="cb971"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb971-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb971-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [1] &quot;\&quot;&quot; &quot;\\&quot;</code></pre>
<div class="sourceCode" id="cb973"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb973-1" data-line-number="1"><span class="kw">writeLines</span>(x)</a></code></pre></div>
<pre><code>## &quot;
## \</code></pre>
<p>Вот ещё частоиспользуемые спец.символы</p>
<ul>
<li><p><code>&quot;\n&quot;</code> перевод строки</p></li>
<li><p><code>&quot;\t&quot;</code> табуляция</p></li>
<li><p>остальные ищутся по справке <code>?'&quot;'</code></p></li>
</ul>
<p>Чтобы создать символьный вектор, достаточно использовать функцию <code>с()</code></p>
<div class="sourceCode" id="cb975"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb975-1" data-line-number="1"><span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;one&quot;   &quot;two&quot;   &quot;three&quot;</code></pre>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.2.1</span> Длина строки</h4>
<p>В пакете <code>stringr</code> интуитивно понятные названия функций, все они начинаются с префикса <code>str_</code>. Например для проверки длины строки используется функция <code>str_length()</code></p>
<div class="sourceCode" id="cb977"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb977-1" data-line-number="1"><span class="kw">str_length</span>(<span class="kw">c</span>(<span class="st">&quot;Я&quot;</span>, <span class="st">&quot;обожаю&quot;</span>, <span class="st">&quot;анализ&quot;</span>, <span class="st">&quot;данных&quot;</span>, <span class="ot">NA</span>))</a></code></pre></div>
<pre><code>## [1]  1  6  6  6 NA</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.2.2</span> Объединение строк</h4>
<p>Чтобы объединить две и больше строк используется <code>str_c()</code>, по аналогии с объединением символов в вектор</p>
<div class="sourceCode" id="cb979"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb979-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;xy&quot;</code></pre>
<p>Аргумент <code>sep</code> позволяет задать разделитель</p>
<div class="sourceCode" id="cb981"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb981-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;____,)))))&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;x____,)))))y&quot;</code></pre>
<p>Для вывода пропущенных значений использется функция <code>str_replace_na()</code></p>
<div class="sourceCode" id="cb983"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb983-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb983-2" data-line-number="2"><span class="kw">str_c</span>(<span class="st">&quot;|-&quot;</span>, x, <span class="st">&quot;-|&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;|-abc-|&quot; NA</code></pre>
<div class="sourceCode" id="cb985"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb985-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;|-&quot;</span>, <span class="kw">str_replace_na</span>(x), <span class="st">&quot;-|&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;|-abc-|&quot; &quot;|-NA-|&quot;</code></pre>
<p>Интересное свойство — зацикливание длинного вектора по длине короткого:</p>
<div class="sourceCode" id="cb987"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb987-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;prefix-&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>), <span class="st">&quot;-suffix&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;prefix-a-suffix&quot; &quot;prefix-b-suffix&quot; &quot;prefix-c-suffix&quot;</code></pre>
<p>Объекты длинной 0 опускаются. Этой возможностью особенно удобно пользоваться в сочетании с оператором <code>if</code></p>
<div class="sourceCode" id="cb989"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb989-1" data-line-number="1">name &lt;-<span class="st"> &quot;Hadley&quot;</span></a>
<a class="sourceLine" id="cb989-2" data-line-number="2">time_of_day &lt;-<span class="st"> &quot;morning&quot;</span></a>
<a class="sourceLine" id="cb989-3" data-line-number="3">birthday &lt;-<span class="st"> </span><span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb989-4" data-line-number="4"></a>
<a class="sourceLine" id="cb989-5" data-line-number="5"><span class="kw">str_c</span>(</a>
<a class="sourceLine" id="cb989-6" data-line-number="6">  <span class="st">&quot;Good &quot;</span>, time_of_day, <span class="st">&quot; &quot;</span>, name,</a>
<a class="sourceLine" id="cb989-7" data-line-number="7">  <span class="cf">if</span> (birthday) <span class="st">&quot; and HAPPY BIRTHDAY&quot;</span>,</a>
<a class="sourceLine" id="cb989-8" data-line-number="8">  <span class="st">&quot;.&quot;</span></a>
<a class="sourceLine" id="cb989-9" data-line-number="9">)</a></code></pre></div>
<pre><code>## [1] &quot;Good morning Hadley.&quot;</code></pre>
<p>Тут можно поиграться с выдачей, задавая значения дня. Для нуля и <code>NA</code> в выдаче не будет поздравления с днём рождения. Для всего остального соответственно будет</p>
<div class="sourceCode" id="cb991"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb991-1" data-line-number="1">name &lt;-<span class="st"> &quot;Hadley&quot;</span></a>
<a class="sourceLine" id="cb991-2" data-line-number="2">time_of_day &lt;-<span class="st"> &quot;morning&quot;</span></a>
<a class="sourceLine" id="cb991-3" data-line-number="3">birthday &lt;-<span class="st"> </span><span class="dv">8</span></a>
<a class="sourceLine" id="cb991-4" data-line-number="4"></a>
<a class="sourceLine" id="cb991-5" data-line-number="5"><span class="kw">str_c</span>(</a>
<a class="sourceLine" id="cb991-6" data-line-number="6">  <span class="st">&quot;Good &quot;</span>, time_of_day, <span class="st">&quot; &quot;</span>, name,</a>
<a class="sourceLine" id="cb991-7" data-line-number="7">  <span class="cf">if</span> (birthday) <span class="st">&quot; and HAPPY BIRTHDAY&quot;</span>,</a>
<a class="sourceLine" id="cb991-8" data-line-number="8">  <span class="st">&quot;.&quot;</span></a>
<a class="sourceLine" id="cb991-9" data-line-number="9">)</a></code></pre></div>
<pre><code>## [1] &quot;Good morning Hadley and HAPPY BIRTHDAY.&quot;</code></pre>
<p>Для свёртывания строк в одну используется <code>collapse()</code></p>
<div class="sourceCode" id="cb993"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb993-1" data-line-number="1"><span class="kw">str_c</span>(<span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>), <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;x, y, z&quot;</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.2.3</span> Извлечение подстрок</h4>
<p>Для этого используется <code>str_sub()</code>, у неё есть аргументы <code>start</code> и <code>end</code></p>
<div class="sourceCode" id="cb995"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb995-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Apple&quot;</span>, <span class="st">&quot;Banana&quot;</span>, <span class="st">&quot;Pear&quot;</span>)</a>
<a class="sourceLine" id="cb995-2" data-line-number="2"><span class="kw">str_sub</span>(x, <span class="dv">1</span>, <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;App&quot; &quot;Ban&quot; &quot;Pea&quot;</code></pre>
<div class="sourceCode" id="cb997"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb997-1" data-line-number="1"><span class="co"># отрицательным числам соответствует отсчет с конца строки</span></a>
<a class="sourceLine" id="cb997-2" data-line-number="2"><span class="kw">str_sub</span>(x, <span class="dv">-3</span>, <span class="dv">-1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;ple&quot; &quot;ana&quot; &quot;ear&quot;</code></pre>
<p>А <code>str_sub()</code> можно использовать в форме присваивания для изменения строк</p>
<div class="sourceCode" id="cb999"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb999-1" data-line-number="1"><span class="kw">str_sub</span>(x, <span class="dv">1</span>, <span class="dv">1</span>) &lt;-<span class="st"> </span><span class="kw">str_to_lower</span>(<span class="kw">str_sub</span>(x, <span class="dv">1</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb999-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [1] &quot;apple&quot;  &quot;banana&quot; &quot;pear&quot;</code></pre>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.5.2.4</span> Локали</h4>
<ul>
<li><p><code>str_to_lower()</code> — делает все буквы прописными.</p></li>
<li><p><code>str_to_upper()</code> — переводит все буквы в верхний регистр.</p></li>
<li><p><code>str_to_title()</code> — делает первую букву каждого слова прописной.</p></li>
</ul>
<p>Не всё так просто с изменением регистров. Для разных языков действуют разные правила. Будь осторожен работая с преобразованием строк в разных языках.</p>
</div>
<div id="-14.2.5.1" class="section level4">
<h4><span class="header-section-number">3.5.2.5</span> Упражнение 14.2.5.1</h4>
<div class="question">
<p>In code that doesn’t use stringr, you’ll often see <code>paste()</code> and <code>paste0()</code>. What’s the difference between the two functions? What stringr function are they equivalent to? How do the functions differ in their handling of <code>NA</code>?</p>
</div>
<p>Функция <code>paste()</code> по-умолчанию имеет разделитель пробел, а функция <code>paste0()</code> по умолчанию не имеет разделителя</p>
<div class="sourceCode" id="cb1001"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1001-1" data-line-number="1"><span class="kw">paste</span>(<span class="st">&quot;агф&quot;</span>, <span class="st">&quot;фыуr&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;агф фыуr&quot;</code></pre>
<div class="sourceCode" id="cb1003"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1003-1" data-line-number="1"><span class="kw">paste0</span>(<span class="st">&quot;fф34&quot;</span>, <span class="st">&quot;фыу&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;fф34фыу&quot;</code></pre>
<p>В пакете <code>stringr()</code> на базовые функции похожа <code>str_c()</code>, она соответствует функции <code>paste0()</code></p>
<div class="sourceCode" id="cb1005"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1005-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;fф34&quot;</span>, <span class="st">&quot;фыу&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;fф34фыу&quot;</code></pre>
<p>Однако <code>str_c()</code> и функции вставки обрабатывают NA по-разному. Функция <code>str_c()</code> распространяет NA, если какой-либо аргумент является пропущенным значением, он возвращает пропущенное значение. Это соответствует тому, как работает числовой R, например, <code>sum()</code>, <code>mean()</code>, обрабатывать пропущенные значения. Однако функции вставки преобразуют NA в строку «NA», а затем обрабатывают ее как любой другой символьный вектор — жутко неудобно.</p>
<div class="sourceCode" id="cb1007"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1007-1" data-line-number="1"><span class="kw">paste0</span>(<span class="st">&quot;fф34&quot;</span>, <span class="st">&quot;фыу&quot;</span>, <span class="ot">NA</span>)</a></code></pre></div>
<pre><code>## [1] &quot;fф34фыуNA&quot;</code></pre>
</div>
<div id="-14.2.5.2" class="section level4">
<h4><span class="header-section-number">3.5.2.6</span> Упражнение 14.2.5.2</h4>
<div class="question">
<p>In your own words, describe the difference between the sep and collapse arguments to str_c().</p>
</div>
<div class="sourceCode" id="cb1009"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1009-1" data-line-number="1">i &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>)</a>
<a class="sourceLine" id="cb1009-2" data-line-number="2"><span class="kw">str_c</span>(i, <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;x, y, z&quot;</code></pre>
<div class="sourceCode" id="cb1011"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1011-1" data-line-number="1"><span class="kw">str_c</span>(<span class="st">&quot;x&quot;</span>, <span class="st">&quot;y&quot;</span>, <span class="st">&quot;z&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;, &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;x, y, z&quot;</code></pre>
<ul>
<li><p><code>sep</code> — это строка, вставленная между аргументами функции <code>str_c()</code>. Не работает с векторами</p></li>
<li><p><code>collapse</code> — строка, используемая для разделения любых элементов символьного вектора на символьный вектор длины один. Работает с векторами</p></li>
</ul>
</div>
<div id="-14.2.5.3" class="section level4">
<h4><span class="header-section-number">3.5.2.7</span> Упражнение 14.2.5.3</h4>
<div class="question">
<p>Use <code>str_length()</code> and <code>str_sub()</code> to extract the middle character from a string. What will you do if the string has an even number of characters?</p>
</div>
<p>Если количество элементов нечётное, то чтобы найти средний элемент, нужно к максимальной длине строки прибавить единицу и разделить результат по полам — ответ индекс среднего элемента.</p>
<p>Для того чтобы изъять один элемент не с конца, нужно началом и концом изъятия сделать одно и тоже число</p>
<div class="sourceCode" id="cb1013"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1013-1" data-line-number="1">(x &lt;-<span class="st"> &quot;1234567&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;1234567&quot;</code></pre>
<div class="sourceCode" id="cb1015"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1015-1" data-line-number="1"><span class="kw">str_sub</span>(x, (<span class="kw">str_length</span>(x)<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>, (<span class="kw">str_length</span>(x)<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] &quot;4&quot;</code></pre>
<p>Если количество элементов чётное, то будем брать два значения, которые делят длину строки пополам.</p>
<div class="sourceCode" id="cb1017"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1017-1" data-line-number="1">(x &lt;-<span class="st"> &quot;1234567&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;1234567&quot;</code></pre>
<div class="sourceCode" id="cb1019"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1019-1" data-line-number="1"><span class="kw">str_sub</span>(x, (<span class="kw">str_length</span>(x)<span class="op">+</span><span class="dv">1</span>)<span class="op">/</span><span class="dv">2</span>, (<span class="kw">str_length</span>(x)<span class="op">+</span><span class="dv">2</span>)<span class="op">/</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] &quot;4&quot;</code></pre>
<p>Если такой вариант не подходит и нужно только одно значение, то в зависимости от задачи нужно выбрать либо большее либо меньшее значение</p>
</div>
<div id="-14.2.5.4" class="section level4">
<h4><span class="header-section-number">3.5.2.8</span> Упражнение 14.2.5.4</h4>
<div class="question">
<p>What does <code>str_wrap()</code> do? When might you want to use it?</p>
</div>
<p>Функция <code>str_wrap()</code> переносит текст так, чтобы он умещался в пределах определенной ширины. Это полезно для переноса длинных строк текста для набора текста.</p>
<div class="sourceCode" id="cb1021"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1021-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;one, two, tree&quot;</span>, <span class="st">&quot;foo, bar&quot;</span>)</a>
<a class="sourceLine" id="cb1021-2" data-line-number="2"><span class="kw">str_wrap</span>(x, <span class="dt">indent =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] &quot;     one, two, tree&quot; &quot;     foo, bar&quot;</code></pre>
</div>
<div id="-14.2.5.5" class="section level4">
<h4><span class="header-section-number">3.5.2.9</span> Упражнение 14.2.5.5</h4>
<div class="question">
<p>What does <code>str_trim()</code> do? What’s the opposite of <code>str_trim()</code>?</p>
</div>
<p>Функция<code>str_trim()</code> удаляет пробел из строки.</p>
<div class="sourceCode" id="cb1023"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1023-1" data-line-number="1"><span class="kw">str_trim</span>(<span class="st">&quot; abc &quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;abc&quot;</code></pre>
<div class="sourceCode" id="cb1025"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1025-1" data-line-number="1"><span class="kw">str_trim</span>(<span class="st">&quot; abc &quot;</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;abc &quot;</code></pre>
<div class="sourceCode" id="cb1027"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1027-1" data-line-number="1"><span class="kw">str_trim</span>(<span class="st">&quot; abc &quot;</span>, <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot; abc&quot;</code></pre>
<p>Противоположностью <code>str_trim()</code> является <code>str_pad()</code>, которая добавляет символы с каждой стороны.</p>
<div class="sourceCode" id="cb1029"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1029-1" data-line-number="1"><span class="kw">str_pad</span>(<span class="st">&quot;abc&quot;</span>, <span class="dv">5</span>, <span class="dt">side =</span> <span class="st">&quot;both&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot; abc &quot;</code></pre>
<div class="sourceCode" id="cb1031"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1031-1" data-line-number="1"><span class="kw">str_pad</span>(<span class="st">&quot;abc&quot;</span>, <span class="dv">4</span>, <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;abc &quot;</code></pre>
<div class="sourceCode" id="cb1033"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1033-1" data-line-number="1"><span class="kw">str_pad</span>(<span class="st">&quot;abc&quot;</span>, <span class="dv">4</span>, <span class="dt">side =</span> <span class="st">&quot;left&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot; abc&quot;</code></pre>
</div>
<div id="-14.2.5.6" class="section level4">
<h4><span class="header-section-number">3.5.2.10</span> Упражнение 14.2.5.6</h4>
<div class="question">
<p>Write a function that turns (e.g.) a vector <code>c(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</code> into the string <code>&quot;a, b, and c&quot;</code>.
Think carefully about what it should do if given a vector of length 0, 1, or 2.</p>
</div>
<p>На этом этапе я решаю задачу без знания функции — то есть я решу в лоб, это будет не функция.</p>
<p>Я вернусь сюда, когда научусь делать функции (привет Стас из будущего)</p>
<div class="sourceCode" id="cb1035"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1035-1" data-line-number="1">foo &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb1035-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1035-3" data-line-number="3"><span class="kw">str_c</span>(foo[[<span class="dv">1</span>]], <span class="st">&quot;, &quot;</span>, foo[[<span class="dv">2</span>]], <span class="st">&quot;, &quot;</span>, <span class="st">&quot;and&quot;</span>, <span class="st">&quot; &quot;</span>, foo[[<span class="dv">3</span>]])</a></code></pre></div>
<pre><code>## [1] &quot;a, b, and c&quot;</code></pre>
<p>Функция должна работать следующим образом</p>
<ul>
<li><p>Если функции будет передаваться нулевой вектор, она должна возвращать пустую строку</p></li>
<li><p>Если функции будет передаваться вектор длинной <code>1</code>, то функция должна возвращать строку с одни этим же элементом</p></li>
<li><p>Если функции будет передаваться вектор длинной <code>2</code>, то функция должна вставлять между этими двумя элементами <code>&quot; and &quot;</code></p></li>
<li><p>Если функции будет передаваться вектор длинной больше чем <code>2</code>, то функция должна перечислять все элементы вектора через запятую, и перед последним элементом вставить <code>&quot; and &quot;</code></p></li>
</ul>
</div>
</div>
<div id="------" class="section level3">
<h3><span class="header-section-number">3.5.3</span> Поиск соответствия шаблонам с помощью регулярных выражений</h3>
<p>Регулярные выражения это просто и лаконично, нужно только понять принцип. Итак начнём</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.3.1</span> Базовые соответствия</h4>
<p>Простейшие шаблоны в точности соответствуют строкам.</p>
<div class="sourceCode" id="cb1037"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1037-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>)</a>
<a class="sourceLine" id="cb1037-2" data-line-number="2"><span class="kw">str_view</span>(x, <span class="st">&quot;&quot;</span>)  <span class="co"># Покажет любой первый символ</span></a></code></pre></div>
<div id="htmlwidget-13a485eb03834e11a96f" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-13a485eb03834e11a96f">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span>pple<\/li>\n  <li><span class='match'>b<\/span>anana<\/li>\n  <li><span class='match'>p<\/span>ear<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1038"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1038-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;a&quot;</span>) <span class="co"># Покажет соответсвия</span></a></code></pre></div>
<div id="htmlwidget-d3660cb7889013cbac29" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d3660cb7889013cbac29">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span>pple<\/li>\n  <li>b<span class='match'>a<\/span>nana<\/li>\n  <li>pe<span class='match'>a<\/span>r<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1039"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1039-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;.a.&quot;</span>) <span class="co"># Покажет заданную букву в окружении любых символов</span></a></code></pre></div>
<div id="htmlwidget-a0ac5cf0ebcda778b157" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-a0ac5cf0ebcda778b157">{"x":{"html":"<ul>\n  <li>apple<\/li>\n  <li><span class='match'>ban<\/span>ana<\/li>\n  <li>p<span class='match'>ear<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Дальше по тексту будем следовать правилу</p>
<ul>
<li><p>регулярные выражения будут записываться <code>\.</code></p></li>
<li><p>Строки представляющие эти выражения будут записываться как <code>&quot;\\.&quot;</code></p></li>
</ul>
<p>Экранируем символ <code>\</code> вот так <code>\\\\</code></p>
<div class="sourceCode" id="cb1040"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1040-1" data-line-number="1">x &lt;-<span class="st"> &quot;a</span><span class="ch">\\</span><span class="st">b&quot;</span></a>
<a class="sourceLine" id="cb1040-2" data-line-number="2"><span class="kw">writeLines</span>(x)</a></code></pre></div>
<pre><code>## a\b</code></pre>
<div class="sourceCode" id="cb1042"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1042-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-1f5b3af19f4bd08bf952" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-1f5b3af19f4bd08bf952">{"x":{"html":"<ul>\n  <li>a<span class='match'>\\<\/span>b<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div id="-14.3.1.1.1" class="section level5">
<h5><span class="header-section-number">3.5.3.1.1</span> Упражнение 14.3.1.1.1</h5>
<div class="question">
<p>Explain why each of these strings don’t match a <code>\</code>: <code>&quot;\&quot;</code>, <code>&quot;\\&quot;</code>, <code>&quot;\\\&quot;</code>.</p>
</div>
<ul>
<li><p><code>&quot;\&quot;</code> — Это будет экранировать следующий символ в строке R.</p></li>
<li><p><code>&quot;\\&quot;</code> — Это разрешит  в регулярном выражении, что будет экранировать следующий символ в регулярном выражении.</p></li>
<li><p><code>&quot;\\\&quot;</code> — первые две обратные косые черты будут преобразованы в буквальную обратную косую черту в регулярном выражении, третья будет экранирована следующим символом. Таким образом, в регулярном выражении это будет экранированный символ</p></li>
</ul>
</div>
<div id="-14.3.1.1.2" class="section level5">
<h5><span class="header-section-number">3.5.3.1.2</span> Упражнение 14.3.1.1.2</h5>
<div class="question">
<p>How would you match the sequence <code>&quot;'\</code>?</p>
</div>
<div class="sourceCode" id="cb1043"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1043-1" data-line-number="1">x &lt;-<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">&#39;</span><span class="ch">\\</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1043-2" data-line-number="2"><span class="kw">writeLines</span>(x)</a></code></pre></div>
<pre><code>## &quot;&#39;\</code></pre>
<div class="sourceCode" id="cb1045"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1045-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;</span><span class="ch">\&quot;</span><span class="st">&#39;</span><span class="ch">\\\\</span><span class="st">&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-fc7918d1640f04f78d95" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-fc7918d1640f04f78d95">{"x":{"html":"<ul>\n  <li><span class='match'>\"'\\<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Экранируем символ двойной кавычки. Экранировать одинарную кавычку не нужно. Чтобы показать одинарный слэш, нужно ввести четыры.</p>
</div>
<div id="-14.3.1.1.2-1" class="section level5">
<h5><span class="header-section-number">3.5.3.1.3</span> Упражнение 14.3.1.1.2</h5>
<div class="question">
<p>What patterns will the regular expression <code>\..\..\..</code> match?
How would you represent it as a string?</p>
</div>
<div class="sourceCode" id="cb1046"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1046-1" data-line-number="1">x &lt;-<span class="st"> &quot;</span><span class="ch">\\</span><span class="st">..</span><span class="ch">\\</span><span class="st">..</span><span class="ch">\\</span><span class="st">..&quot;</span></a>
<a class="sourceLine" id="cb1046-2" data-line-number="2"><span class="kw">writeLines</span>(x)</a></code></pre></div>
<pre><code>## \..\..\..</code></pre>
<div class="sourceCode" id="cb1048"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1048-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;</span><span class="ch">\\\\\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\\\\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">.</span><span class="ch">\\\\\\</span><span class="st">.</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-8f26a88ce971cb9fd83c" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8f26a88ce971cb9fd83c">{"x":{"html":"<ul>\n  <li><span class='match'>\\..\\..\\..<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.5.3.2</span> Якоря</h4>
<p>Якорь — позиционная привязка</p>
<ul>
<li><p><code>^</code> — совпадает с началом строки</p></li>
<li><p><code>$</code> — совпадает с концом строки</p></li>
</ul>
<div class="sourceCode" id="cb1049"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1049-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>)</a>
<a class="sourceLine" id="cb1049-2" data-line-number="2"><span class="kw">str_view</span>(x, <span class="st">&quot;^a&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-2a8180e4bba76e9cec7b" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-2a8180e4bba76e9cec7b">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span>pple<\/li>\n  <li>banana<\/li>\n  <li>pear<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1050"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1050-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;a$&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-21016e560d1db5e096a8" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-21016e560d1db5e096a8">{"x":{"html":"<ul>\n  <li>apple<\/li>\n  <li>banan<span class='match'>a<\/span><\/li>\n  <li>pear<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Мнемоническое првавило: ВЫсокое положение <code>^</code> в иерархии всегда приводит к деньгам <code>$</code></p>
<p>Чтобы принудить регулярное выражение к совпадениям только с целой строкой необходимо использовать оба якоря</p>
<div class="sourceCode" id="cb1051"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1051-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple pie&quot;</span>, <span class="st">&quot;apple&quot;</span>, <span class="st">&quot;apple cake&quot;</span>)</a>
<a class="sourceLine" id="cb1051-2" data-line-number="2"><span class="kw">str_view</span>(x, <span class="st">&quot;apple&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-192dfe82dd5067c96d90" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-192dfe82dd5067c96d90">{"x":{"html":"<ul>\n  <li><span class='match'>apple<\/span> pie<\/li>\n  <li><span class='match'>apple<\/span><\/li>\n  <li><span class='match'>apple<\/span> cake<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1052"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1052-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;^apple$&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-8e8fb21350aa2828b29c" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8e8fb21350aa2828b29c">{"x":{"html":"<ul>\n  <li>apple pie<\/li>\n  <li><span class='match'>apple<\/span><\/li>\n  <li>apple cake<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Для нахождения совпадений на границе слов можно использовать <code>\b</code></p>
<div id="-14.3.2.1.1" class="section level5">
<h5><span class="header-section-number">3.5.3.2.1</span> Упражнение 14.3.2.1.1</h5>
<div class="question">
<p>How would you match the literal string <code>&quot;$^$&quot;</code>?</p>
</div>
<div class="sourceCode" id="cb1053"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1053-1" data-line-number="1">x &lt;-<span class="st"> &quot;</span><span class="ch">\&quot;</span><span class="st">$^$</span><span class="ch">\&quot;</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1053-2" data-line-number="2"><span class="kw">writeLines</span>(x)</a></code></pre></div>
<pre><code>## &quot;$^$&quot;</code></pre>
<div class="sourceCode" id="cb1055"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1055-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;</span><span class="ch">\&quot;\\</span><span class="st">$</span><span class="ch">\\</span><span class="st">^</span><span class="ch">\\</span><span class="st">$</span><span class="ch">\&quot;</span><span class="st">&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-174c38089a6210947d39" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-174c38089a6210947d39">{"x":{"html":"<ul>\n  <li><span class='match'>\"$^$\"<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-14.3.2.1.2" class="section level5">
<h5><span class="header-section-number">3.5.3.2.2</span> Упражнение 14.3.2.1.2</h5>
<div class="question">
<p>Given the corpus of common words in <code>stringr::words</code>, create regular expressions that find all words that:</p>
<ul>
<li><p>Start with “y”.</p></li>
<li><p>End with “x”</p></li>
<li><p>Are exactly three letters long. (Don’t cheat by using <code>str_length()</code>!)</p></li>
<li><p>Have seven letters or more.</p></li>
</ul>
<p>Since this list is long, you might want to use the match argument to <code>str_view()</code> to show only the matching or non-matching words.</p>
</div>
<ul>
<li>начинаются с <code>y</code></li>
</ul>
<div class="sourceCode" id="cb1056"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1056-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^y&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-c801eddaa24e192c4170" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-c801eddaa24e192c4170">{"x":{"html":"<ul>\n  <li><span class='match'>y<\/span>ear<\/li>\n  <li><span class='match'>y<\/span>es<\/li>\n  <li><span class='match'>y<\/span>esterday<\/li>\n  <li><span class='match'>y<\/span>et<\/li>\n  <li><span class='match'>y<\/span>ou<\/li>\n  <li><span class='match'>y<\/span>oung<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>оканчиваются на <code>x</code></li>
</ul>
<div class="sourceCode" id="cb1057"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1057-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;x$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-15589c671143a7bf97cf" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-15589c671143a7bf97cf">{"x":{"html":"<ul>\n  <li>bo<span class='match'>x<\/span><\/li>\n  <li>se<span class='match'>x<\/span><\/li>\n  <li>si<span class='match'>x<\/span><\/li>\n  <li>ta<span class='match'>x<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>состоят ровно из трёх букв</li>
</ul>
<div class="sourceCode" id="cb1058"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1058-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^...$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-06c711cf2836e33ce5a3" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-06c711cf2836e33ce5a3">{"x":{"html":"<ul>\n  <li><span class='match'>act<\/span><\/li>\n  <li><span class='match'>add<\/span><\/li>\n  <li><span class='match'>age<\/span><\/li>\n  <li><span class='match'>ago<\/span><\/li>\n  <li><span class='match'>air<\/span><\/li>\n  <li><span class='match'>all<\/span><\/li>\n  <li><span class='match'>and<\/span><\/li>\n  <li><span class='match'>any<\/span><\/li>\n  <li><span class='match'>arm<\/span><\/li>\n  <li><span class='match'>art<\/span><\/li>\n  <li><span class='match'>ask<\/span><\/li>\n  <li><span class='match'>bad<\/span><\/li>\n  <li><span class='match'>bag<\/span><\/li>\n  <li><span class='match'>bar<\/span><\/li>\n  <li><span class='match'>bed<\/span><\/li>\n  <li><span class='match'>bet<\/span><\/li>\n  <li><span class='match'>big<\/span><\/li>\n  <li><span class='match'>bit<\/span><\/li>\n  <li><span class='match'>box<\/span><\/li>\n  <li><span class='match'>boy<\/span><\/li>\n  <li><span class='match'>bus<\/span><\/li>\n  <li><span class='match'>but<\/span><\/li>\n  <li><span class='match'>buy<\/span><\/li>\n  <li><span class='match'>can<\/span><\/li>\n  <li><span class='match'>car<\/span><\/li>\n  <li><span class='match'>cat<\/span><\/li>\n  <li><span class='match'>cup<\/span><\/li>\n  <li><span class='match'>cut<\/span><\/li>\n  <li><span class='match'>dad<\/span><\/li>\n  <li><span class='match'>day<\/span><\/li>\n  <li><span class='match'>die<\/span><\/li>\n  <li><span class='match'>dog<\/span><\/li>\n  <li><span class='match'>dry<\/span><\/li>\n  <li><span class='match'>due<\/span><\/li>\n  <li><span class='match'>eat<\/span><\/li>\n  <li><span class='match'>egg<\/span><\/li>\n  <li><span class='match'>end<\/span><\/li>\n  <li><span class='match'>eye<\/span><\/li>\n  <li><span class='match'>far<\/span><\/li>\n  <li><span class='match'>few<\/span><\/li>\n  <li><span class='match'>fit<\/span><\/li>\n  <li><span class='match'>fly<\/span><\/li>\n  <li><span class='match'>for<\/span><\/li>\n  <li><span class='match'>fun<\/span><\/li>\n  <li><span class='match'>gas<\/span><\/li>\n  <li><span class='match'>get<\/span><\/li>\n  <li><span class='match'>god<\/span><\/li>\n  <li><span class='match'>guy<\/span><\/li>\n  <li><span class='match'>hit<\/span><\/li>\n  <li><span class='match'>hot<\/span><\/li>\n  <li><span class='match'>how<\/span><\/li>\n  <li><span class='match'>job<\/span><\/li>\n  <li><span class='match'>key<\/span><\/li>\n  <li><span class='match'>kid<\/span><\/li>\n  <li><span class='match'>lad<\/span><\/li>\n  <li><span class='match'>law<\/span><\/li>\n  <li><span class='match'>lay<\/span><\/li>\n  <li><span class='match'>leg<\/span><\/li>\n  <li><span class='match'>let<\/span><\/li>\n  <li><span class='match'>lie<\/span><\/li>\n  <li><span class='match'>lot<\/span><\/li>\n  <li><span class='match'>low<\/span><\/li>\n  <li><span class='match'>man<\/span><\/li>\n  <li><span class='match'>may<\/span><\/li>\n  <li><span class='match'>mrs<\/span><\/li>\n  <li><span class='match'>new<\/span><\/li>\n  <li><span class='match'>non<\/span><\/li>\n  <li><span class='match'>not<\/span><\/li>\n  <li><span class='match'>now<\/span><\/li>\n  <li><span class='match'>odd<\/span><\/li>\n  <li><span class='match'>off<\/span><\/li>\n  <li><span class='match'>old<\/span><\/li>\n  <li><span class='match'>one<\/span><\/li>\n  <li><span class='match'>out<\/span><\/li>\n  <li><span class='match'>own<\/span><\/li>\n  <li><span class='match'>pay<\/span><\/li>\n  <li><span class='match'>per<\/span><\/li>\n  <li><span class='match'>put<\/span><\/li>\n  <li><span class='match'>red<\/span><\/li>\n  <li><span class='match'>rid<\/span><\/li>\n  <li><span class='match'>run<\/span><\/li>\n  <li><span class='match'>say<\/span><\/li>\n  <li><span class='match'>see<\/span><\/li>\n  <li><span class='match'>set<\/span><\/li>\n  <li><span class='match'>sex<\/span><\/li>\n  <li><span class='match'>she<\/span><\/li>\n  <li><span class='match'>sir<\/span><\/li>\n  <li><span class='match'>sit<\/span><\/li>\n  <li><span class='match'>six<\/span><\/li>\n  <li><span class='match'>son<\/span><\/li>\n  <li><span class='match'>sun<\/span><\/li>\n  <li><span class='match'>tax<\/span><\/li>\n  <li><span class='match'>tea<\/span><\/li>\n  <li><span class='match'>ten<\/span><\/li>\n  <li><span class='match'>the<\/span><\/li>\n  <li><span class='match'>tie<\/span><\/li>\n  <li><span class='match'>too<\/span><\/li>\n  <li><span class='match'>top<\/span><\/li>\n  <li><span class='match'>try<\/span><\/li>\n  <li><span class='match'>two<\/span><\/li>\n  <li><span class='match'>use<\/span><\/li>\n  <li><span class='match'>war<\/span><\/li>\n  <li><span class='match'>way<\/span><\/li>\n  <li><span class='match'>wee<\/span><\/li>\n  <li><span class='match'>who<\/span><\/li>\n  <li><span class='match'>why<\/span><\/li>\n  <li><span class='match'>win<\/span><\/li>\n  <li><span class='match'>yes<\/span><\/li>\n  <li><span class='match'>yet<\/span><\/li>\n  <li><span class='match'>you<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>состоят из семи или более букв</li>
</ul>
<div class="sourceCode" id="cb1059"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1059-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^.......&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-db6d5f29449c72ac7460" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-db6d5f29449c72ac7460">{"x":{"html":"<ul>\n  <li><span class='match'>absolut<\/span>e<\/li>\n  <li><span class='match'>account<\/span><\/li>\n  <li><span class='match'>achieve<\/span><\/li>\n  <li><span class='match'>address<\/span><\/li>\n  <li><span class='match'>adverti<\/span>se<\/li>\n  <li><span class='match'>afterno<\/span>on<\/li>\n  <li><span class='match'>against<\/span><\/li>\n  <li><span class='match'>already<\/span><\/li>\n  <li><span class='match'>alright<\/span><\/li>\n  <li><span class='match'>althoug<\/span>h<\/li>\n  <li><span class='match'>america<\/span><\/li>\n  <li><span class='match'>another<\/span><\/li>\n  <li><span class='match'>apparen<\/span>t<\/li>\n  <li><span class='match'>appoint<\/span><\/li>\n  <li><span class='match'>approac<\/span>h<\/li>\n  <li><span class='match'>appropr<\/span>iate<\/li>\n  <li><span class='match'>arrange<\/span><\/li>\n  <li><span class='match'>associa<\/span>te<\/li>\n  <li><span class='match'>authori<\/span>ty<\/li>\n  <li><span class='match'>availab<\/span>le<\/li>\n  <li><span class='match'>balance<\/span><\/li>\n  <li><span class='match'>because<\/span><\/li>\n  <li><span class='match'>believe<\/span><\/li>\n  <li><span class='match'>benefit<\/span><\/li>\n  <li><span class='match'>between<\/span><\/li>\n  <li><span class='match'>brillia<\/span>nt<\/li>\n  <li><span class='match'>britain<\/span><\/li>\n  <li><span class='match'>brother<\/span><\/li>\n  <li><span class='match'>busines<\/span>s<\/li>\n  <li><span class='match'>certain<\/span><\/li>\n  <li><span class='match'>chairma<\/span>n<\/li>\n  <li><span class='match'>charact<\/span>er<\/li>\n  <li><span class='match'>Christm<\/span>as<\/li>\n  <li><span class='match'>colleag<\/span>ue<\/li>\n  <li><span class='match'>collect<\/span><\/li>\n  <li><span class='match'>college<\/span><\/li>\n  <li><span class='match'>comment<\/span><\/li>\n  <li><span class='match'>committ<\/span>ee<\/li>\n  <li><span class='match'>communi<\/span>ty<\/li>\n  <li><span class='match'>company<\/span><\/li>\n  <li><span class='match'>compare<\/span><\/li>\n  <li><span class='match'>complet<\/span>e<\/li>\n  <li><span class='match'>compute<\/span><\/li>\n  <li><span class='match'>concern<\/span><\/li>\n  <li><span class='match'>conditi<\/span>on<\/li>\n  <li><span class='match'>conside<\/span>r<\/li>\n  <li><span class='match'>consult<\/span><\/li>\n  <li><span class='match'>contact<\/span><\/li>\n  <li><span class='match'>continu<\/span>e<\/li>\n  <li><span class='match'>contrac<\/span>t<\/li>\n  <li><span class='match'>control<\/span><\/li>\n  <li><span class='match'>convers<\/span>e<\/li>\n  <li><span class='match'>correct<\/span><\/li>\n  <li><span class='match'>council<\/span><\/li>\n  <li><span class='match'>country<\/span><\/li>\n  <li><span class='match'>current<\/span><\/li>\n  <li><span class='match'>decisio<\/span>n<\/li>\n  <li><span class='match'>definit<\/span>e<\/li>\n  <li><span class='match'>departm<\/span>ent<\/li>\n  <li><span class='match'>describ<\/span>e<\/li>\n  <li><span class='match'>develop<\/span><\/li>\n  <li><span class='match'>differe<\/span>nce<\/li>\n  <li><span class='match'>difficu<\/span>lt<\/li>\n  <li><span class='match'>discuss<\/span><\/li>\n  <li><span class='match'>distric<\/span>t<\/li>\n  <li><span class='match'>documen<\/span>t<\/li>\n  <li><span class='match'>economy<\/span><\/li>\n  <li><span class='match'>educate<\/span><\/li>\n  <li><span class='match'>electri<\/span>c<\/li>\n  <li><span class='match'>encoura<\/span>ge<\/li>\n  <li><span class='match'>english<\/span><\/li>\n  <li><span class='match'>environ<\/span>ment<\/li>\n  <li><span class='match'>especia<\/span>l<\/li>\n  <li><span class='match'>evening<\/span><\/li>\n  <li><span class='match'>evidenc<\/span>e<\/li>\n  <li><span class='match'>example<\/span><\/li>\n  <li><span class='match'>exercis<\/span>e<\/li>\n  <li><span class='match'>expense<\/span><\/li>\n  <li><span class='match'>experie<\/span>nce<\/li>\n  <li><span class='match'>explain<\/span><\/li>\n  <li><span class='match'>express<\/span><\/li>\n  <li><span class='match'>finance<\/span><\/li>\n  <li><span class='match'>fortune<\/span><\/li>\n  <li><span class='match'>forward<\/span><\/li>\n  <li><span class='match'>functio<\/span>n<\/li>\n  <li><span class='match'>further<\/span><\/li>\n  <li><span class='match'>general<\/span><\/li>\n  <li><span class='match'>germany<\/span><\/li>\n  <li><span class='match'>goodbye<\/span><\/li>\n  <li><span class='match'>history<\/span><\/li>\n  <li><span class='match'>holiday<\/span><\/li>\n  <li><span class='match'>hospita<\/span>l<\/li>\n  <li><span class='match'>however<\/span><\/li>\n  <li><span class='match'>hundred<\/span><\/li>\n  <li><span class='match'>husband<\/span><\/li>\n  <li><span class='match'>identif<\/span>y<\/li>\n  <li><span class='match'>imagine<\/span><\/li>\n  <li><span class='match'>importa<\/span>nt<\/li>\n  <li><span class='match'>improve<\/span><\/li>\n  <li><span class='match'>include<\/span><\/li>\n  <li><span class='match'>increas<\/span>e<\/li>\n  <li><span class='match'>individ<\/span>ual<\/li>\n  <li><span class='match'>industr<\/span>y<\/li>\n  <li><span class='match'>instead<\/span><\/li>\n  <li><span class='match'>interes<\/span>t<\/li>\n  <li><span class='match'>introdu<\/span>ce<\/li>\n  <li><span class='match'>involve<\/span><\/li>\n  <li><span class='match'>kitchen<\/span><\/li>\n  <li><span class='match'>languag<\/span>e<\/li>\n  <li><span class='match'>machine<\/span><\/li>\n  <li><span class='match'>meaning<\/span><\/li>\n  <li><span class='match'>measure<\/span><\/li>\n  <li><span class='match'>mention<\/span><\/li>\n  <li><span class='match'>million<\/span><\/li>\n  <li><span class='match'>ministe<\/span>r<\/li>\n  <li><span class='match'>morning<\/span><\/li>\n  <li><span class='match'>necessa<\/span>ry<\/li>\n  <li><span class='match'>obvious<\/span><\/li>\n  <li><span class='match'>occasio<\/span>n<\/li>\n  <li><span class='match'>operate<\/span><\/li>\n  <li><span class='match'>opportu<\/span>nity<\/li>\n  <li><span class='match'>organiz<\/span>e<\/li>\n  <li><span class='match'>origina<\/span>l<\/li>\n  <li><span class='match'>otherwi<\/span>se<\/li>\n  <li><span class='match'>paragra<\/span>ph<\/li>\n  <li><span class='match'>particu<\/span>lar<\/li>\n  <li><span class='match'>pension<\/span><\/li>\n  <li><span class='match'>percent<\/span><\/li>\n  <li><span class='match'>perfect<\/span><\/li>\n  <li><span class='match'>perhaps<\/span><\/li>\n  <li><span class='match'>photogr<\/span>aph<\/li>\n  <li><span class='match'>picture<\/span><\/li>\n  <li><span class='match'>politic<\/span><\/li>\n  <li><span class='match'>positio<\/span>n<\/li>\n  <li><span class='match'>positiv<\/span>e<\/li>\n  <li><span class='match'>possibl<\/span>e<\/li>\n  <li><span class='match'>practis<\/span>e<\/li>\n  <li><span class='match'>prepare<\/span><\/li>\n  <li><span class='match'>present<\/span><\/li>\n  <li><span class='match'>pressur<\/span>e<\/li>\n  <li><span class='match'>presume<\/span><\/li>\n  <li><span class='match'>previou<\/span>s<\/li>\n  <li><span class='match'>private<\/span><\/li>\n  <li><span class='match'>probabl<\/span>e<\/li>\n  <li><span class='match'>problem<\/span><\/li>\n  <li><span class='match'>proceed<\/span><\/li>\n  <li><span class='match'>process<\/span><\/li>\n  <li><span class='match'>produce<\/span><\/li>\n  <li><span class='match'>product<\/span><\/li>\n  <li><span class='match'>program<\/span>me<\/li>\n  <li><span class='match'>project<\/span><\/li>\n  <li><span class='match'>propose<\/span><\/li>\n  <li><span class='match'>protect<\/span><\/li>\n  <li><span class='match'>provide<\/span><\/li>\n  <li><span class='match'>purpose<\/span><\/li>\n  <li><span class='match'>quality<\/span><\/li>\n  <li><span class='match'>quarter<\/span><\/li>\n  <li><span class='match'>questio<\/span>n<\/li>\n  <li><span class='match'>realise<\/span><\/li>\n  <li><span class='match'>receive<\/span><\/li>\n  <li><span class='match'>recogni<\/span>ze<\/li>\n  <li><span class='match'>recomme<\/span>nd<\/li>\n  <li><span class='match'>relatio<\/span>n<\/li>\n  <li><span class='match'>remembe<\/span>r<\/li>\n  <li><span class='match'>represe<\/span>nt<\/li>\n  <li><span class='match'>require<\/span><\/li>\n  <li><span class='match'>researc<\/span>h<\/li>\n  <li><span class='match'>resourc<\/span>e<\/li>\n  <li><span class='match'>respect<\/span><\/li>\n  <li><span class='match'>respons<\/span>ible<\/li>\n  <li><span class='match'>saturda<\/span>y<\/li>\n  <li><span class='match'>science<\/span><\/li>\n  <li><span class='match'>scotlan<\/span>d<\/li>\n  <li><span class='match'>secreta<\/span>ry<\/li>\n  <li><span class='match'>section<\/span><\/li>\n  <li><span class='match'>separat<\/span>e<\/li>\n  <li><span class='match'>serious<\/span><\/li>\n  <li><span class='match'>service<\/span><\/li>\n  <li><span class='match'>similar<\/span><\/li>\n  <li><span class='match'>situate<\/span><\/li>\n  <li><span class='match'>society<\/span><\/li>\n  <li><span class='match'>special<\/span><\/li>\n  <li><span class='match'>specifi<\/span>c<\/li>\n  <li><span class='match'>standar<\/span>d<\/li>\n  <li><span class='match'>station<\/span><\/li>\n  <li><span class='match'>straigh<\/span>t<\/li>\n  <li><span class='match'>strateg<\/span>y<\/li>\n  <li><span class='match'>structu<\/span>re<\/li>\n  <li><span class='match'>student<\/span><\/li>\n  <li><span class='match'>subject<\/span><\/li>\n  <li><span class='match'>succeed<\/span><\/li>\n  <li><span class='match'>suggest<\/span><\/li>\n  <li><span class='match'>support<\/span><\/li>\n  <li><span class='match'>suppose<\/span><\/li>\n  <li><span class='match'>surpris<\/span>e<\/li>\n  <li><span class='match'>telepho<\/span>ne<\/li>\n  <li><span class='match'>televis<\/span>ion<\/li>\n  <li><span class='match'>terribl<\/span>e<\/li>\n  <li><span class='match'>therefo<\/span>re<\/li>\n  <li><span class='match'>thirtee<\/span>n<\/li>\n  <li><span class='match'>thousan<\/span>d<\/li>\n  <li><span class='match'>through<\/span><\/li>\n  <li><span class='match'>thursda<\/span>y<\/li>\n  <li><span class='match'>togethe<\/span>r<\/li>\n  <li><span class='match'>tomorro<\/span>w<\/li>\n  <li><span class='match'>tonight<\/span><\/li>\n  <li><span class='match'>traffic<\/span><\/li>\n  <li><span class='match'>transpo<\/span>rt<\/li>\n  <li><span class='match'>trouble<\/span><\/li>\n  <li><span class='match'>tuesday<\/span><\/li>\n  <li><span class='match'>underst<\/span>and<\/li>\n  <li><span class='match'>univers<\/span>ity<\/li>\n  <li><span class='match'>various<\/span><\/li>\n  <li><span class='match'>village<\/span><\/li>\n  <li><span class='match'>wednesd<\/span>ay<\/li>\n  <li><span class='match'>welcome<\/span><\/li>\n  <li><span class='match'>whether<\/span><\/li>\n  <li><span class='match'>without<\/span><\/li>\n  <li><span class='match'>yesterd<\/span>ay<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">3.5.3.3</span> Символьные классы и чередования</h4>
<ul>
<li><p><code>.</code> — совпадает с любым символом</p></li>
<li><p><code>\d</code> — совпадает с любой цифрой. ЧТобы экранировать нужно использовать двойной слэш <code>\\d</code></p></li>
<li><p><code>\s</code> — совпадает с любым пробельным символом (пробел, табуляция, перевод строки) <code>\\s</code></p></li>
<li><p><code>[abc]</code> — совпадает с <code>a</code>, <code>b</code> или <code>c</code></p></li>
<li><p><code>[^abc]</code> — совпадает с любыми символами кроме <code>a</code>, <code>b</code> или <code>c</code></p></li>
</ul>
<p>Чередование обеспечивает возможность выбора альтернативов шаблона.</p>
<div class="sourceCode" id="cb1060"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1060-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;grey&quot;</span>, <span class="st">&quot;gray&quot;</span>), <span class="st">&quot;gr(e|a)y&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-0956d93576b847c03f5b" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-0956d93576b847c03f5b">{"x":{"html":"<ul>\n  <li><span class='match'>grey<\/span><\/li>\n  <li><span class='match'>gray<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div id="-14.3.3.1.1" class="section level5">
<h5><span class="header-section-number">3.5.3.3.1</span> Упражнение 14.3.3.1.1</h5>
<div class="question">
<p>Create regular expressions to find all words that:</p>
<ul>
<li><p>Start with a vowel.</p></li>
<li><p>That only contain consonants. (Hint: thinking about matching “not”-vowels.)</p></li>
<li><p>End with ed, but not with eed.</p></li>
<li>End with ing or ise.</li>
</ul>
</div>
<ul>
<li>Начинается с гласной</li>
</ul>
<div class="sourceCode" id="cb1061"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1061-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^[aeiou]&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-2cc09a9cce3e739de79d" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-2cc09a9cce3e739de79d">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span><\/li>\n  <li><span class='match'>a<\/span>ble<\/li>\n  <li><span class='match'>a<\/span>bout<\/li>\n  <li><span class='match'>a<\/span>bsolute<\/li>\n  <li><span class='match'>a<\/span>ccept<\/li>\n  <li><span class='match'>a<\/span>ccount<\/li>\n  <li><span class='match'>a<\/span>chieve<\/li>\n  <li><span class='match'>a<\/span>cross<\/li>\n  <li><span class='match'>a<\/span>ct<\/li>\n  <li><span class='match'>a<\/span>ctive<\/li>\n  <li><span class='match'>a<\/span>ctual<\/li>\n  <li><span class='match'>a<\/span>dd<\/li>\n  <li><span class='match'>a<\/span>ddress<\/li>\n  <li><span class='match'>a<\/span>dmit<\/li>\n  <li><span class='match'>a<\/span>dvertise<\/li>\n  <li><span class='match'>a<\/span>ffect<\/li>\n  <li><span class='match'>a<\/span>fford<\/li>\n  <li><span class='match'>a<\/span>fter<\/li>\n  <li><span class='match'>a<\/span>fternoon<\/li>\n  <li><span class='match'>a<\/span>gain<\/li>\n  <li><span class='match'>a<\/span>gainst<\/li>\n  <li><span class='match'>a<\/span>ge<\/li>\n  <li><span class='match'>a<\/span>gent<\/li>\n  <li><span class='match'>a<\/span>go<\/li>\n  <li><span class='match'>a<\/span>gree<\/li>\n  <li><span class='match'>a<\/span>ir<\/li>\n  <li><span class='match'>a<\/span>ll<\/li>\n  <li><span class='match'>a<\/span>llow<\/li>\n  <li><span class='match'>a<\/span>lmost<\/li>\n  <li><span class='match'>a<\/span>long<\/li>\n  <li><span class='match'>a<\/span>lready<\/li>\n  <li><span class='match'>a<\/span>lright<\/li>\n  <li><span class='match'>a<\/span>lso<\/li>\n  <li><span class='match'>a<\/span>lthough<\/li>\n  <li><span class='match'>a<\/span>lways<\/li>\n  <li><span class='match'>a<\/span>merica<\/li>\n  <li><span class='match'>a<\/span>mount<\/li>\n  <li><span class='match'>a<\/span>nd<\/li>\n  <li><span class='match'>a<\/span>nother<\/li>\n  <li><span class='match'>a<\/span>nswer<\/li>\n  <li><span class='match'>a<\/span>ny<\/li>\n  <li><span class='match'>a<\/span>part<\/li>\n  <li><span class='match'>a<\/span>pparent<\/li>\n  <li><span class='match'>a<\/span>ppear<\/li>\n  <li><span class='match'>a<\/span>pply<\/li>\n  <li><span class='match'>a<\/span>ppoint<\/li>\n  <li><span class='match'>a<\/span>pproach<\/li>\n  <li><span class='match'>a<\/span>ppropriate<\/li>\n  <li><span class='match'>a<\/span>rea<\/li>\n  <li><span class='match'>a<\/span>rgue<\/li>\n  <li><span class='match'>a<\/span>rm<\/li>\n  <li><span class='match'>a<\/span>round<\/li>\n  <li><span class='match'>a<\/span>rrange<\/li>\n  <li><span class='match'>a<\/span>rt<\/li>\n  <li><span class='match'>a<\/span>s<\/li>\n  <li><span class='match'>a<\/span>sk<\/li>\n  <li><span class='match'>a<\/span>ssociate<\/li>\n  <li><span class='match'>a<\/span>ssume<\/li>\n  <li><span class='match'>a<\/span>t<\/li>\n  <li><span class='match'>a<\/span>ttend<\/li>\n  <li><span class='match'>a<\/span>uthority<\/li>\n  <li><span class='match'>a<\/span>vailable<\/li>\n  <li><span class='match'>a<\/span>ware<\/li>\n  <li><span class='match'>a<\/span>way<\/li>\n  <li><span class='match'>a<\/span>wful<\/li>\n  <li><span class='match'>e<\/span>ach<\/li>\n  <li><span class='match'>e<\/span>arly<\/li>\n  <li><span class='match'>e<\/span>ast<\/li>\n  <li><span class='match'>e<\/span>asy<\/li>\n  <li><span class='match'>e<\/span>at<\/li>\n  <li><span class='match'>e<\/span>conomy<\/li>\n  <li><span class='match'>e<\/span>ducate<\/li>\n  <li><span class='match'>e<\/span>ffect<\/li>\n  <li><span class='match'>e<\/span>gg<\/li>\n  <li><span class='match'>e<\/span>ight<\/li>\n  <li><span class='match'>e<\/span>ither<\/li>\n  <li><span class='match'>e<\/span>lect<\/li>\n  <li><span class='match'>e<\/span>lectric<\/li>\n  <li><span class='match'>e<\/span>leven<\/li>\n  <li><span class='match'>e<\/span>lse<\/li>\n  <li><span class='match'>e<\/span>mploy<\/li>\n  <li><span class='match'>e<\/span>ncourage<\/li>\n  <li><span class='match'>e<\/span>nd<\/li>\n  <li><span class='match'>e<\/span>ngine<\/li>\n  <li><span class='match'>e<\/span>nglish<\/li>\n  <li><span class='match'>e<\/span>njoy<\/li>\n  <li><span class='match'>e<\/span>nough<\/li>\n  <li><span class='match'>e<\/span>nter<\/li>\n  <li><span class='match'>e<\/span>nvironment<\/li>\n  <li><span class='match'>e<\/span>qual<\/li>\n  <li><span class='match'>e<\/span>special<\/li>\n  <li><span class='match'>e<\/span>urope<\/li>\n  <li><span class='match'>e<\/span>ven<\/li>\n  <li><span class='match'>e<\/span>vening<\/li>\n  <li><span class='match'>e<\/span>ver<\/li>\n  <li><span class='match'>e<\/span>very<\/li>\n  <li><span class='match'>e<\/span>vidence<\/li>\n  <li><span class='match'>e<\/span>xact<\/li>\n  <li><span class='match'>e<\/span>xample<\/li>\n  <li><span class='match'>e<\/span>xcept<\/li>\n  <li><span class='match'>e<\/span>xcuse<\/li>\n  <li><span class='match'>e<\/span>xercise<\/li>\n  <li><span class='match'>e<\/span>xist<\/li>\n  <li><span class='match'>e<\/span>xpect<\/li>\n  <li><span class='match'>e<\/span>xpense<\/li>\n  <li><span class='match'>e<\/span>xperience<\/li>\n  <li><span class='match'>e<\/span>xplain<\/li>\n  <li><span class='match'>e<\/span>xpress<\/li>\n  <li><span class='match'>e<\/span>xtra<\/li>\n  <li><span class='match'>e<\/span>ye<\/li>\n  <li><span class='match'>i<\/span>dea<\/li>\n  <li><span class='match'>i<\/span>dentify<\/li>\n  <li><span class='match'>i<\/span>f<\/li>\n  <li><span class='match'>i<\/span>magine<\/li>\n  <li><span class='match'>i<\/span>mportant<\/li>\n  <li><span class='match'>i<\/span>mprove<\/li>\n  <li><span class='match'>i<\/span>n<\/li>\n  <li><span class='match'>i<\/span>nclude<\/li>\n  <li><span class='match'>i<\/span>ncome<\/li>\n  <li><span class='match'>i<\/span>ncrease<\/li>\n  <li><span class='match'>i<\/span>ndeed<\/li>\n  <li><span class='match'>i<\/span>ndividual<\/li>\n  <li><span class='match'>i<\/span>ndustry<\/li>\n  <li><span class='match'>i<\/span>nform<\/li>\n  <li><span class='match'>i<\/span>nside<\/li>\n  <li><span class='match'>i<\/span>nstead<\/li>\n  <li><span class='match'>i<\/span>nsure<\/li>\n  <li><span class='match'>i<\/span>nterest<\/li>\n  <li><span class='match'>i<\/span>nto<\/li>\n  <li><span class='match'>i<\/span>ntroduce<\/li>\n  <li><span class='match'>i<\/span>nvest<\/li>\n  <li><span class='match'>i<\/span>nvolve<\/li>\n  <li><span class='match'>i<\/span>ssue<\/li>\n  <li><span class='match'>i<\/span>t<\/li>\n  <li><span class='match'>i<\/span>tem<\/li>\n  <li><span class='match'>o<\/span>bvious<\/li>\n  <li><span class='match'>o<\/span>ccasion<\/li>\n  <li><span class='match'>o<\/span>dd<\/li>\n  <li><span class='match'>o<\/span>f<\/li>\n  <li><span class='match'>o<\/span>ff<\/li>\n  <li><span class='match'>o<\/span>ffer<\/li>\n  <li><span class='match'>o<\/span>ffice<\/li>\n  <li><span class='match'>o<\/span>ften<\/li>\n  <li><span class='match'>o<\/span>kay<\/li>\n  <li><span class='match'>o<\/span>ld<\/li>\n  <li><span class='match'>o<\/span>n<\/li>\n  <li><span class='match'>o<\/span>nce<\/li>\n  <li><span class='match'>o<\/span>ne<\/li>\n  <li><span class='match'>o<\/span>nly<\/li>\n  <li><span class='match'>o<\/span>pen<\/li>\n  <li><span class='match'>o<\/span>perate<\/li>\n  <li><span class='match'>o<\/span>pportunity<\/li>\n  <li><span class='match'>o<\/span>ppose<\/li>\n  <li><span class='match'>o<\/span>r<\/li>\n  <li><span class='match'>o<\/span>rder<\/li>\n  <li><span class='match'>o<\/span>rganize<\/li>\n  <li><span class='match'>o<\/span>riginal<\/li>\n  <li><span class='match'>o<\/span>ther<\/li>\n  <li><span class='match'>o<\/span>therwise<\/li>\n  <li><span class='match'>o<\/span>ught<\/li>\n  <li><span class='match'>o<\/span>ut<\/li>\n  <li><span class='match'>o<\/span>ver<\/li>\n  <li><span class='match'>o<\/span>wn<\/li>\n  <li><span class='match'>u<\/span>nder<\/li>\n  <li><span class='match'>u<\/span>nderstand<\/li>\n  <li><span class='match'>u<\/span>nion<\/li>\n  <li><span class='match'>u<\/span>nit<\/li>\n  <li><span class='match'>u<\/span>nite<\/li>\n  <li><span class='match'>u<\/span>niversity<\/li>\n  <li><span class='match'>u<\/span>nless<\/li>\n  <li><span class='match'>u<\/span>ntil<\/li>\n  <li><span class='match'>u<\/span>p<\/li>\n  <li><span class='match'>u<\/span>pon<\/li>\n  <li><span class='match'>u<\/span>se<\/li>\n  <li><span class='match'>u<\/span>sual<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>Сoдержат только согласные</li>
</ul>
<div class="sourceCode" id="cb1062"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1062-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;^[^aeiou]+$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-abbffc072ce9490547e5" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-abbffc072ce9490547e5">{"x":{"html":"<ul>\n  <li><span class='match'>by<\/span><\/li>\n  <li><span class='match'>dry<\/span><\/li>\n  <li><span class='match'>fly<\/span><\/li>\n  <li><span class='match'>mrs<\/span><\/li>\n  <li><span class='match'>try<\/span><\/li>\n  <li><span class='match'>why<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>Оканчивается на <code>ed</code>, но не на <code>eed</code>.</li>
</ul>
<div class="sourceCode" id="cb1063"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1063-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;[^e]ed$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-6ca76c45dd079561bbd9" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-6ca76c45dd079561bbd9">{"x":{"html":"<ul>\n  <li><span class='match'>bed<\/span><\/li>\n  <li>hund<span class='match'>red<\/span><\/li>\n  <li><span class='match'>red<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>Оканчивается на <code>ing</code> или <code>ize</code>.</li>
</ul>
<div class="sourceCode" id="cb1064"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1064-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;i(ng|ze)$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-a4c4aa33d13996000696" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-a4c4aa33d13996000696">{"x":{"html":"<ul>\n  <li>br<span class='match'>ing<\/span><\/li>\n  <li>dur<span class='match'>ing<\/span><\/li>\n  <li>even<span class='match'>ing<\/span><\/li>\n  <li>k<span class='match'>ing<\/span><\/li>\n  <li>mean<span class='match'>ing<\/span><\/li>\n  <li>morn<span class='match'>ing<\/span><\/li>\n  <li>organ<span class='match'>ize<\/span><\/li>\n  <li>recogn<span class='match'>ize<\/span><\/li>\n  <li>r<span class='match'>ing<\/span><\/li>\n  <li>s<span class='match'>ing<\/span><\/li>\n  <li>s<span class='match'>ize<\/span><\/li>\n  <li>th<span class='match'>ing<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-14.3.3.1.2" class="section level5">
<h5><span class="header-section-number">3.5.3.3.2</span> Упражнение 14.3.3.1.2</h5>
<div class="question">
<p>Empirically verify the rule “i before e except after c”.</p>
</div>
<p>Правило гласит — “i” пишется перед “e” (исключение — после “c”). Сначала проверяем слова, которые удовлетворяют правилу:</p>
<div class="sourceCode" id="cb1065"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1065-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;(cei|[^c]ie)&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-6a2ce7e22f48fe5b4cdc" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-6a2ce7e22f48fe5b4cdc">{"x":{"html":"<ul>\n  <li>ac<span class='match'>hie<\/span>ve<\/li>\n  <li>be<span class='match'>lie<\/span>ve<\/li>\n  <li>b<span class='match'>rie<\/span>f<\/li>\n  <li>c<span class='match'>lie<\/span>nt<\/li>\n  <li><span class='match'>die<\/span><\/li>\n  <li>expe<span class='match'>rie<\/span>nce<\/li>\n  <li><span class='match'>fie<\/span>ld<\/li>\n  <li>f<span class='match'>rie<\/span>nd<\/li>\n  <li><span class='match'>lie<\/span><\/li>\n  <li><span class='match'>pie<\/span>ce<\/li>\n  <li>q<span class='match'>uie<\/span>t<\/li>\n  <li>re<span class='match'>cei<\/span>ve<\/li>\n  <li><span class='match'>tie<\/span><\/li>\n  <li><span class='match'>vie<\/span>w<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Теперь поищем слова, которые не соответствуют правилу:</p>
<div class="sourceCode" id="cb1066"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1066-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;(cie|[^c]ei)&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-cd05f04737a4edf1b11b" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-cd05f04737a4edf1b11b">{"x":{"html":"<ul>\n  <li>s<span class='match'>cie<\/span>nce<\/li>\n  <li>so<span class='match'>cie<\/span>ty<\/li>\n  <li><span class='match'>wei<\/span>gh<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-14.3.3.1.3" class="section level5">
<h5><span class="header-section-number">3.5.3.3.3</span> Упражнение 14.3.3.1.3</h5>
<div class="question">
<p>Is “q” always followed by a “u”?</p>
</div>
<p>В представленных словах других комбинаций не найдено</p>
<div class="sourceCode" id="cb1067"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1067-1" data-line-number="1"><span class="kw">str_view</span>(stringr<span class="op">::</span>words, <span class="st">&quot;q[^u]&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-c806c6262308a97bbe55" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-c806c6262308a97bbe55">{"x":{"html":"<ul>\n  <li><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-14.3.3.1.4" class="section level5">
<h5><span class="header-section-number">3.5.3.3.4</span> Упражнение 14.3.3.1.4</h5>
<div class="question">
<p>Write a regular expression that matches a word if it’s probably written in British English, not American English.</p>
</div>
<p>С такими упраджнениями заодно и английский подтянешь.
В общем случае сложно выполнить это упражнение, и может потребоваться словарь.
Немного погуглив, появилось несколько эвристических соображений, которые должны учитывать некоторые распространенные случаи.</p>
<p>Британский английский имеет тенденцию использовать следующее:</p>
<ul>
<li><p>“ou” в отличае от американского “o”</p></li>
<li><p>“ae” и “oe” в отличае от американского “a” и “o”</p></li>
<li><p>слова заканчиваются на <code>ise</code> в отличае от американского <code>ize</code></p></li>
<li><p>слова заканчиваются на <code>yse</code></p></li>
</ul>
<p>Учитывая это, можно получить следующее регулярное выражение <code>ou|ise$|ae|oe|yse$</code> (или или или или)</p>
</div>
<div id="-14.3.3.1.5" class="section level5">
<h5><span class="header-section-number">3.5.3.3.5</span> Упражнение 14.3.3.1.5</h5>
<div class="question">
<p>Create a regular expression that will match telephone numbers as commonly written in your country.</p>
</div>
<p>В России нет четко регламентированного стандарта, но есть общие правила, которых придерживаюсь и я. Подробно о рекомендуемых правилах записи телефонных номеров рассказал дизайнер Василий Никоноров в <a href="http://steinebel.ru/?go=all/phone-numbers/">своей статье</a></p>
<div class="figure">
<img src="img/phone-nums-rule.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Для записи телефонного номера, подойдёт следующее регулярное выражение: <code>+</code></p>
<p>В представленных словах других комбинаций не найдено</p>
<div class="sourceCode" id="cb1068"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1068-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;+7 987 654-32-10&quot;</span>, <span class="st">&quot;+7(987)654-32-10&quot;</span>, <span class="st">&quot;8 (987) 654-32-10&quot;</span>)</a>
<a class="sourceLine" id="cb1068-2" data-line-number="2"><span class="kw">str_view</span>(x, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">+</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d-</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d-</span><span class="ch">\\</span><span class="st">d</span><span class="ch">\\</span><span class="st">d&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-db5e66fb4f432e9fec8a" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-db5e66fb4f432e9fec8a">{"x":{"html":"<ul>\n  <li><span class='match'>+7 987 654-32-10<\/span><\/li>\n  <li>+7(987)654-32-10<\/li>\n  <li>8 (987) 654-32-10<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.5.3.4</span> Повторения</h4>
<p>Сколько раз может встречаться <em>предшествующий</em> символ или выражение, чтобы совпадение считалось достигнутым</p>
<ul>
<li><p><code>?</code>: 0 или 1</p></li>
<li><p><code>+</code>: 1 или больше</p></li>
<li><p><code>*</code>: 0 или больше</p></li>
</ul>
<div class="sourceCode" id="cb1069"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1069-1" data-line-number="1">x &lt;-<span class="st"> &quot;1888 is the longest year in Roman numerals: MDCCCLXXXVIII&quot;</span></a>
<a class="sourceLine" id="cb1069-2" data-line-number="2"><span class="kw">str_view</span>(x, <span class="st">&quot;CC?&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-06da032a455590a08eba" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-06da032a455590a08eba">{"x":{"html":"<ul>\n  <li>1888 is the longest year in Roman numerals: MD<span class='match'>CC<\/span>CLXXXVIII<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1070"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1070-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;CC+&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-8a1b5c360f5276d79b13" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8a1b5c360f5276d79b13">{"x":{"html":"<ul>\n  <li>1888 is the longest year in Roman numerals: MD<span class='match'>CCC<\/span>LXXXVIII<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1071"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1071-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&#39;C[LX]+&#39;</span>)</a></code></pre></div>
<div id="htmlwidget-d98b5f480952bec3c41a" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d98b5f480952bec3c41a">{"x":{"html":"<ul>\n  <li>1888 is the longest year in Roman numerals: MDCC<span class='match'>CLXXX<\/span>VIII<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Кроме того можно определить точное количество совпадений</p>
<ul>
<li><p><code>{n}</code>: точно n раз</p></li>
<li><p><code>{n,}</code>: n или больше раз</p></li>
<li><p><code>{,m}</code>: самое большее m раз</p></li>
<li><p><code>{n,m}</code>: между n и m раз</p></li>
</ul>
<div class="sourceCode" id="cb1072"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1072-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;C{2}&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-f86400c8b12cf7620b17" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f86400c8b12cf7620b17">{"x":{"html":"<ul>\n  <li>1888 is the longest year in Roman numerals: MD<span class='match'>CC<\/span>CLXXXVIII<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1073"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1073-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;C{2,}&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-94588d5378d956de9f89" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-94588d5378d956de9f89">{"x":{"html":"<ul>\n  <li>1888 is the longest year in Roman numerals: MD<span class='match'>CCC<\/span>LXXXVIII<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1074"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1074-1" data-line-number="1"><span class="kw">str_view</span>(x, <span class="st">&quot;C{2,3}&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-1332e6719d0fc464d49a" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-1332e6719d0fc464d49a">{"x":{"html":"<ul>\n  <li>1888 is the longest year in Roman numerals: MD<span class='match'>CCC<\/span>LXXXVIII<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Полезно знать, что алгоритм поиска жадный, чтобы сделать его ленивым нужно добавить в конец выражения символ <code>?</code></p>
<div id="-14.3.3.1.1-1" class="section level5">
<h5><span class="header-section-number">3.5.3.4.1</span> Упражнение 14.3.3.1.1</h5>
<div class="question">
<p>Describe the equivalents of <code>?</code>, <code>+</code>, <code>*</code> in <code>{m,n}</code> form.</p>
</div>
<ul>
<li><p><code>?</code>: 0 или 1 <code>{0,1}</code></p></li>
<li><p><code>+</code>: 1 или больше <code>{1,}</code></p></li>
<li><p><code>*</code>: 0 или больше <code>{0,}</code></p></li>
</ul>
</div>
<div id="-14.3.3.1.2-1" class="section level5">
<h5><span class="header-section-number">3.5.3.4.2</span> Упражнение 14.3.3.1.2</h5>
<div class="question">
<p>Describe in words what these regular expressions match: (read carefully to see if I’m using a regular expression or a string that defines a regular expression.)</p>
<ul>
<li><p><code>^.*$</code></p></li>
<li><p><code>&quot;\\{.+\\}&quot;</code></p></li>
<li><p><code>\d{4}-\d{2}-\d{2}</code></p></li>
<li><code>&quot;\\\\{4}&quot;</code></li>
</ul>
</div>
<ul>
<li><code>^.*$</code> Любой символ встречается ноль или более раз, другими словами — это регулярное выражение ищет строку любой длины. Это регулярное выражение, его нужно экранировать</li>
</ul>
<div class="sourceCode" id="cb1075"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1075-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;cat&quot;</span>, <span class="st">&quot;$3.21&quot;</span>, <span class="st">&quot;data science&quot;</span>), <span class="st">&quot;^.*$&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-0b5dcac2078b1de13555" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-0b5dcac2078b1de13555">{"x":{"html":"<ul>\n  <li><span class='match'>cat<\/span><\/li>\n  <li><span class='match'>$3.21<\/span><\/li>\n  <li><span class='match'>data science<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>&quot;\\{.+\\}&quot;</code> Любой символ в курвах который встречается один или больше раз. Это строка описывающая регулярное выражение, не нужно экранировать</li>
</ul>
<div class="sourceCode" id="cb1076"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1076-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;{cat}&quot;</span>, <span class="st">&quot;${3.21}&quot;</span>, <span class="st">&quot;data science&quot;</span>, <span class="st">&quot;{}&quot;</span>), <span class="st">&quot;</span><span class="ch">\\</span><span class="st">{.+</span><span class="ch">\\</span><span class="st">}&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-50ecf87ee667d7cba4d1" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-50ecf87ee667d7cba4d1">{"x":{"html":"<ul>\n  <li><span class='match'>{cat}<\/span><\/li>\n  <li>$<span class='match'>{3.21}<\/span><\/li>\n  <li>data science<\/li>\n  <li>{}<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>\d{4}-\d{2}-\d{2}</code> Любое 4 значное число минус двузначное минус двузначное. Это регулярное выражение, его нужно экранировать</li>
</ul>
<div class="sourceCode" id="cb1077"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1077-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;2352-34-12&quot;</span>, <span class="st">&quot;232-34-12&quot;</span>, <span class="st">&quot;2352 34 12&quot;</span>, <span class="st">&quot;22-33-1239&quot;</span>), <span class="st">&quot;</span><span class="ch">\\</span><span class="st">d{4}-</span><span class="ch">\\</span><span class="st">d{2}-</span><span class="ch">\\</span><span class="st">d{2}&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-74c6c3e7bd3aef9dba37" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-74c6c3e7bd3aef9dba37">{"x":{"html":"<ul>\n  <li><span class='match'>2352-34-12<\/span><\/li>\n  <li>232-34-12<\/li>\n  <li>2352 34 12<\/li>\n  <li>22-33-1239<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>&quot;\\\\{4}&quot;</code> Бэкслэш который встречается 4 раза. Это строка описывающая регулярное выражение, не нужно экранировать</li>
</ul>
<div class="sourceCode" id="cb1078"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1078-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;2352-34-12&quot;</span>, <span class="st">&quot;</span><span class="ch">\\\\\\\\</span><span class="st">&quot;</span>, <span class="st">&quot;2352 34 12&quot;</span>, <span class="st">&quot; &quot;</span>), <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">{4}&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-e44372cc160ea1a19775" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-e44372cc160ea1a19775">{"x":{"html":"<ul>\n  <li>2352-34-12<\/li>\n  <li><span class='match'>\\\\\\\\<\/span><\/li>\n  <li>2352 34 12<\/li>\n  <li> <\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-14.3.3.1.3-1" class="section level5">
<h5><span class="header-section-number">3.5.3.4.3</span> Упражнение 14.3.3.1.3</h5>
<div class="question">
<p>Create regular expressions to find all words that:</p>
<ul>
<li><p>Start with three consonants.</p></li>
<li><p>Have three or more vowels in a row.</p></li>
<li>Have two or more vowel-consonant pairs in a row.</li>
</ul>
</div>
</div>
<div id="-14.3.3.1.4-1" class="section level5">
<h5><span class="header-section-number">3.5.3.4.4</span> Упражнение 14.3.3.1.4</h5>
<div class="question">
<p>Solve the beginner regexp crosswords at <a href="https://regexcrossword.com/challenges/beginner" class="uri">https://regexcrossword.com/challenges/beginner</a></p>
</div>
<p>Продолжаем постигать науку регулярных выражений. Идет со скрипом.</p>
<p>Решения я выкладываю в <a href="https://github.com/driapitek/regex-crossword-solver">репозиторий</a> на гитхабе</p>
</div>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">3.5.3.5</span> Группирование и обратные ссылки</h4>
<p>Круглые скобки определяют группы, на которые можно ссылаться с помощью обратных ссылок. Это регулярное выражение находит все фрукты, которые содержат повторяющиеся пары букв.</p>
<div class="sourceCode" id="cb1079"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1079-1" data-line-number="1"><span class="kw">str_view</span>(fruit, <span class="st">&quot;(..)</span><span class="ch">\\</span><span class="st">1&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-f7cdb4575df619f945bf" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f7cdb4575df619f945bf">{"x":{"html":"<ul>\n  <li>b<span class='match'>anan<\/span>a<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div id="-14.3.5.1.1" class="section level5">
<h5><span class="header-section-number">3.5.3.5.1</span> Упражнение 14.3.5.1.1</h5>
<div class="question">
<p>Describe, in words, what these expressions will match:</p>
<ul>
<li><p><code>(.)\1\1</code></p></li>
<li><p><code>&quot;(.)(.)\\2\\1&quot;</code></p></li>
<li><p><code>(..)\1</code></p></li>
<li><p><code>&quot;(.).\\1.\\1&quot;</code></p></li>
<li><code>&quot;(.)(.)(.).*\\3\\2\\1&quot;</code></li>
</ul>
</div>
<p>Регулярные выражения — это целое искусство. Чтобы их освоить нужно время. Больше информации о регулярных выражениях можно найти <a href="https://habr.com/post/115825/">на хабре</a></p>
<ul>
<li><code>(.)\1\1</code> — один и тот же символ появляется три раза подряд. Только нужно экранировать запись</li>
</ul>
<div class="sourceCode" id="cb1080"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1080-1" data-line-number="1"><span class="kw">str_view</span>(<span class="st">&quot;fffff&quot;</span>, <span class="st">&quot;(.)</span><span class="ch">\\</span><span class="st">1</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-8be413c43698361024b3" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8be413c43698361024b3">{"x":{"html":"<ul>\n  <li><span class='match'>fff<\/span>ff<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>&quot;(.)(.)\\2\\1&quot;</code> — За парой символов следует одна и та же пара символов в обратном порядке.</li>
</ul>
<div class="sourceCode" id="cb1081"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1081-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;fffff&quot;</span>, <span class="st">&quot;oihoiahsodh&quot;</span>, <span class="st">&quot;arra&quot;</span>), <span class="st">&quot;(.)(.)</span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-f46974853ba251a8aafb" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-f46974853ba251a8aafb">{"x":{"html":"<ul>\n  <li><span class='match'>ffff<\/span>f<\/li>\n  <li>oihoiahsodh<\/li>\n  <li><span class='match'>arra<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>(..)\1</code> — Два символа повторяются. Нужно экранировать</li>
</ul>
<div class="sourceCode" id="cb1082"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1082-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;fffff&quot;</span>, <span class="st">&quot;1212&quot;</span>, <span class="st">&quot;arra&quot;</span>), <span class="st">&quot;(..)</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-7b9cd20299f5c2061cd6" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-7b9cd20299f5c2061cd6">{"x":{"html":"<ul>\n  <li><span class='match'>ffff<\/span>f<\/li>\n  <li><span class='match'>1212<\/span><\/li>\n  <li>arra<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>&quot;(.).\\1.\\1&quot;</code> — Пять символов, повторяется нечётный</li>
</ul>
<div class="sourceCode" id="cb1083"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1083-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;fffff&quot;</span>, <span class="st">&quot;2f2f2&quot;</span>, <span class="st">&quot;arra&quot;</span>), <span class="st">&quot;(.).</span><span class="ch">\\</span><span class="st">1.</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-8e616577996af6a9613d" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8e616577996af6a9613d">{"x":{"html":"<ul>\n  <li><span class='match'>fffff<\/span><\/li>\n  <li><span class='match'>2f2f2<\/span><\/li>\n  <li>arra<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>&quot;(.)(.)(.).*\\3\\2\\1&quot;</code> — Три символа, за которыми следуют ноль или более символов любого вида, за которыми следуют те же три символа, но в обратном порядке.</li>
</ul>
<div class="sourceCode" id="cb1084"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1084-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;adssda&quot;</span>, <span class="st">&quot;123 321&quot;</span>, <span class="st">&quot;are2222era&quot;</span>), <span class="st">&quot;(.)(.)(.).*</span><span class="ch">\\</span><span class="st">3</span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-8c14bb16c1c38825e8c0" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-8c14bb16c1c38825e8c0">{"x":{"html":"<ul>\n  <li><span class='match'>adssda<\/span><\/li>\n  <li><span class='match'>123 321<\/span><\/li>\n  <li><span class='match'>are2222era<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-14.3.5.1.2" class="section level5">
<h5><span class="header-section-number">3.5.3.5.2</span> Упражнение 14.3.5.1.2</h5>
<div class="question">
<p>Construct regular expressions to match words that:</p>
<ul>
<li><p>Start and end with the same character.</p></li>
<li><p>Contain a repeated pair of letters (e.g. church’’ containsch’’ repeated twice.)</p></li>
<li>Contain one letter repeated in at least three places (e.g. eleven’’ contains threee’’s.)</li>
</ul>
</div>
<ul>
<li>Начинается и заканчивается с одного и того же символа.</li>
</ul>
<div class="sourceCode" id="cb1085"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1085-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;ii;ji&quot;</span>, <span class="st">&quot;are2222era&quot;</span>), <span class="st">&quot;^(.)((.*</span><span class="ch">\\</span><span class="st">1$)|</span><span class="ch">\\</span><span class="st">1?$)&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-0173d3acdee6358542fe" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-0173d3acdee6358542fe">{"x":{"html":"<ul>\n  <li><span class='match'>a<\/span><\/li>\n  <li><span class='match'>ii;ji<\/span><\/li>\n  <li><span class='match'>are2222era<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>СОдержит повторяющуюся пару букв</li>
</ul>
<div class="sourceCode" id="cb1086"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1086-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;ii;ji&quot;</span>, <span class="st">&quot;afre2222ereaa&quot;</span>), <span class="st">&quot;([A-Za-z][A-Za-z]).*</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-909d349967d4e0474e34" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-909d349967d4e0474e34">{"x":{"html":"<ul>\n  <li>a<\/li>\n  <li>ii;ji<\/li>\n  <li>af<span class='match'>re2222ere<\/span>aa<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li>СОдержит одну букву повторяющуюся по крайне мере в трёх местах</li>
</ul>
<div class="sourceCode" id="cb1087"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1087-1" data-line-number="1"><span class="kw">str_view</span>(<span class="kw">c</span>(<span class="st">&quot;eleven&quot;</span>, <span class="st">&quot;ii;j&quot;</span>, <span class="st">&quot;afre2222ereaa&quot;</span>), <span class="st">&quot;([a-z]).*</span><span class="ch">\\</span><span class="st">1.*</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-b369472d11a62876e154" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b369472d11a62876e154">{"x":{"html":"<ul>\n  <li><span class='match'>eleve<\/span>n<\/li>\n  <li>ii;j<\/li>\n  <li><span class='match'>afre2222ereaa<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</div>
<div class="section level3">
<h3><span class="header-section-number">3.5.4</span> Инструментарий</h3>
<p>Разбивай сложное выражение на несколько простых</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.4.1</span> Обнаружение совпадений</h4>
<p>Для обнаружения совпадений используется функция <code>str_detect()</code></p>
<div class="sourceCode" id="cb1088"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1088-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>)</a>
<a class="sourceLine" id="cb1088-2" data-line-number="2"><span class="kw">str_detect</span>(x, <span class="st">&quot;e&quot;</span>)</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE</code></pre>
<p>Она возвращает логический вектор, благодаря этому её удобно использовать для нахождения некоторых полезных вещей. Например, количество вхождений</p>
<div class="sourceCode" id="cb1090"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1090-1" data-line-number="1"><span class="co"># Сколько слов начинаются с буквы t?</span></a>
<a class="sourceLine" id="cb1090-2" data-line-number="2"><span class="kw">sum</span>(<span class="kw">str_detect</span>(words, <span class="st">&quot;^t&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 65</code></pre>
<p>Или среднее количество слов содержащих определённую комбинацию</p>
<div class="sourceCode" id="cb1092"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1092-1" data-line-number="1"><span class="co"># Какова доля слов, оканчивающихся на гласную?</span></a>
<a class="sourceLine" id="cb1092-2" data-line-number="2"><span class="kw">mean</span>(<span class="kw">str_detect</span>(words, <span class="st">&quot;[aeiou]$&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 0.2765306</code></pre>
<p>Когда у вас сложные логические условия (например, соответствуют <code>a</code> или <code>b</code>, но не <code>c</code>, если не <code>d</code>), часто проще объединить несколько вызовов <code>str_detect()</code> с логическими операторами, чем пытаться создать одно регулярное выражение. Например, вот два способа найти все слова, которые не содержат гласных:</p>
<div class="sourceCode" id="cb1094"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1094-1" data-line-number="1"><span class="co"># Найти все слова, содержащие хотя бы одну гласную и инвертировать эту операцию &quot;!&quot;</span></a>
<a class="sourceLine" id="cb1094-2" data-line-number="2">no_vowels_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="op">!</span><span class="kw">str_detect</span>(words, <span class="st">&quot;[aeiou]&quot;</span>)</a>
<a class="sourceLine" id="cb1094-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1094-4" data-line-number="4"><span class="co"># Найти все солова, состоящие только из согласных символов не являющихся гласными</span></a>
<a class="sourceLine" id="cb1094-5" data-line-number="5">no_vowels_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;^[^aeiou]+$&quot;</span>)</a>
<a class="sourceLine" id="cb1094-6" data-line-number="6"><span class="kw">identical</span>(no_vowels_<span class="dv">1</span>, no_vowels_<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Как говорилось ранее — если регулярное выражение усложняется простым и логичным шагом будет такой подход: разбить на простые части, объединить простые части логическим оператором.</p>
<p>Есть удобная функция оболочка <code>str_subset()</code>, она используется для выбора элементов соответствующзих шаблону.</p>
<div class="sourceCode" id="cb1096"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1096-1" data-line-number="1">words[<span class="kw">str_detect</span>(words, <span class="st">&quot;x$&quot;</span>)]</a></code></pre></div>
<pre><code>## [1] &quot;box&quot; &quot;sex&quot; &quot;six&quot; &quot;tax&quot;</code></pre>
<div class="sourceCode" id="cb1098"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1098-1" data-line-number="1"><span class="kw">str_subset</span>(words, <span class="st">&quot;x$&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;box&quot; &quot;sex&quot; &quot;six&quot; &quot;tax&quot;</code></pre>
<p>Однако обычно строкой будет один из столбцов фрейма данных, и вместо этого будет использоваться фильтр.</p>
<div class="sourceCode" id="cb1100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1100-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1100-2" data-line-number="2">  <span class="dt">word =</span> words, </a>
<a class="sourceLine" id="cb1100-3" data-line-number="3">  <span class="dt">i =</span> <span class="kw">seq_along</span>(word) <span class="co"># используется для генерации регулярных последовательностей</span></a>
<a class="sourceLine" id="cb1100-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb1100-5" data-line-number="5">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1100-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(word, <span class="st">&quot;x$&quot;</span>)) <span class="co"># фильтрует заданный набор данных, оставляя только те слова, в которых на конце х</span></a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   word      i
##   &lt;chr&gt; &lt;int&gt;
## 1 box     108
## 2 sex     747
## 3 six     772
## 4 tax     841</code></pre>
<p><code>str_count()</code> сообщает сколько совпадений обнаружено в строке</p>
<div class="sourceCode" id="cb1102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1102-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;banana&quot;</span>, <span class="st">&quot;pear&quot;</span>)</a>
<a class="sourceLine" id="cb1102-2" data-line-number="2"><span class="kw">str_count</span>(x, <span class="st">&quot;a&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 1 3 1</code></pre>
<div class="sourceCode" id="cb1104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1104-1" data-line-number="1"><span class="co"># сколько гласных в среднем приходится на одно слово</span></a>
<a class="sourceLine" id="cb1104-2" data-line-number="2"><span class="kw">mean</span>(<span class="kw">str_count</span>(words, <span class="st">&quot;[aeiou]&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 1.991837</code></pre>
<p><code>str_count()</code> естественно использовать с <code>mutate()</code></p>
<div class="sourceCode" id="cb1106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1106-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1106-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1106-3" data-line-number="3">    <span class="dt">vowels =</span> <span class="kw">str_count</span>(word, <span class="st">&quot;[aeiou]&quot;</span>),</a>
<a class="sourceLine" id="cb1106-4" data-line-number="4">    <span class="dt">consonants =</span> <span class="kw">str_count</span>(word, <span class="st">&quot;[^aeiou]&quot;</span>)</a>
<a class="sourceLine" id="cb1106-5" data-line-number="5">  )</a></code></pre></div>
<pre><code>## # A tibble: 980 x 4
##    word         i vowels consonants
##    &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;      &lt;int&gt;
##  1 a            1      1          0
##  2 able         2      2          2
##  3 about        3      3          2
##  4 absolute     4      4          4
##  5 accept       5      2          4
##  6 account      6      3          4
##  7 achieve      7      4          3
##  8 across       8      2          4
##  9 act          9      1          2
## 10 active      10      3          3
## # … with 970 more rows</code></pre>
<p>Интересная особенность — совпадения никогда не перекрываются. Сколько раз в строке <code>&quot;abababa&quot;</code> встречается шаблон <code>&quot;aba&quot;</code>? Регулярное выражение скажет что он встречается два раза, а не три</p>
<div class="sourceCode" id="cb1108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1108-1" data-line-number="1"><span class="kw">str_count</span>(<span class="st">&quot;abababa&quot;</span>, <span class="st">&quot;aba&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb1110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1110-1" data-line-number="1"><span class="kw">str_view_all</span>(<span class="st">&quot;abababa&quot;</span>, <span class="st">&quot;aba&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-2caf77ebcad0be65b060" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-2caf77ebcad0be65b060">{"x":{"html":"<ul>\n  <li><span class='match'>aba<\/span>b<span class='match'>aba<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Обратим внимание на последнюю функцию. В пакете <code>string</code> многие функции идут парами — одна работает с одиночными совпадениями, другая со всеми.</p>
<div id="-14.4.1.1.1" class="section level5">
<h5><span class="header-section-number">3.5.4.1.1</span> Упражнение 14.4.1.1.1</h5>
<div class="question">
<p>For each of the following challenges, try solving it by using both a single regular expression, and a combination of multiple <code>str_detect()</code> calls.</p>
<ul>
<li><p>Find all words that start or end with x.</p></li>
<li><p>Find all words that start with a vowel and end with a consonant.</p></li>
<li><p>Are there any words that contain at least one of each different vowel?</p></li>
<li>What word has the highest number of vowels? What word has the highest proportion of vowels? (Hint: what is the denominator?)</li>
</ul>
</div>
<ul>
<li>В общем случае</li>
</ul>
<div class="sourceCode" id="cb1111"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1111-1" data-line-number="1"><span class="co"># все слова начинающиеся или заканчивающиеся на X</span></a>
<a class="sourceLine" id="cb1111-2" data-line-number="2"><span class="kw">str_view_all</span>(words, <span class="st">&quot;^x|x$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-11b36dd624f181053755" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-11b36dd624f181053755">{"x":{"html":"<ul>\n  <li>bo<span class='match'>x<\/span><\/li>\n  <li>se<span class='match'>x<\/span><\/li>\n  <li>si<span class='match'>x<\/span><\/li>\n  <li>ta<span class='match'>x<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1112-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1112-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(words, <span class="st">&quot;^x|x$&quot;</span>)) <span class="co">#  Указан порядковый номер слова</span></a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   word      i
##   &lt;chr&gt; &lt;int&gt;
## 1 box     108
## 2 sex     747
## 3 six     772
## 4 tax     841</code></pre>
<p>А теперь разберём</p>
<div class="sourceCode" id="cb1114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1114-1" data-line-number="1"><span class="co"># Одним регулярным выражением</span></a>
<a class="sourceLine" id="cb1114-2" data-line-number="2">words[<span class="kw">str_detect</span>(words, <span class="st">&quot;^x|x$&quot;</span>)]</a></code></pre></div>
<pre><code>## [1] &quot;box&quot; &quot;sex&quot; &quot;six&quot; &quot;tax&quot;</code></pre>
<div class="sourceCode" id="cb1116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1116-1" data-line-number="1"><span class="co"># Двумя отдельными выражениями</span></a>
<a class="sourceLine" id="cb1116-2" data-line-number="2">start_with_x &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;^x&quot;</span>)</a>
<a class="sourceLine" id="cb1116-3" data-line-number="3">end_with_x &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;x$&quot;</span>)</a>
<a class="sourceLine" id="cb1116-4" data-line-number="4">words[start_with_x <span class="op">|</span><span class="st"> </span>end_with_x]</a></code></pre></div>
<pre><code>## [1] &quot;box&quot; &quot;sex&quot; &quot;six&quot; &quot;tax&quot;</code></pre>
<ul>
<li>В общем случае. Ругелярное выражение такое — ищи первым символом любую гласную, после этого может быть любой символ один или больше раз, а оканчиваться слово должно на любую негласную букву.</li>
</ul>
<div class="sourceCode" id="cb1118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1118-1" data-line-number="1"><span class="co"># все слова начинающиеся на гласную, а заканчивающиеся на согласную</span></a>
<a class="sourceLine" id="cb1118-2" data-line-number="2"><span class="kw">str_view_all</span>(words, <span class="st">&quot;^[aeiou].*[^aeiou]$&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<div id="htmlwidget-99a1eb08982695a80400" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-99a1eb08982695a80400">{"x":{"html":"<ul>\n  <li><span class='match'>about<\/span><\/li>\n  <li><span class='match'>accept<\/span><\/li>\n  <li><span class='match'>account<\/span><\/li>\n  <li><span class='match'>across<\/span><\/li>\n  <li><span class='match'>act<\/span><\/li>\n  <li><span class='match'>actual<\/span><\/li>\n  <li><span class='match'>add<\/span><\/li>\n  <li><span class='match'>address<\/span><\/li>\n  <li><span class='match'>admit<\/span><\/li>\n  <li><span class='match'>affect<\/span><\/li>\n  <li><span class='match'>afford<\/span><\/li>\n  <li><span class='match'>after<\/span><\/li>\n  <li><span class='match'>afternoon<\/span><\/li>\n  <li><span class='match'>again<\/span><\/li>\n  <li><span class='match'>against<\/span><\/li>\n  <li><span class='match'>agent<\/span><\/li>\n  <li><span class='match'>air<\/span><\/li>\n  <li><span class='match'>all<\/span><\/li>\n  <li><span class='match'>allow<\/span><\/li>\n  <li><span class='match'>almost<\/span><\/li>\n  <li><span class='match'>along<\/span><\/li>\n  <li><span class='match'>already<\/span><\/li>\n  <li><span class='match'>alright<\/span><\/li>\n  <li><span class='match'>although<\/span><\/li>\n  <li><span class='match'>always<\/span><\/li>\n  <li><span class='match'>amount<\/span><\/li>\n  <li><span class='match'>and<\/span><\/li>\n  <li><span class='match'>another<\/span><\/li>\n  <li><span class='match'>answer<\/span><\/li>\n  <li><span class='match'>any<\/span><\/li>\n  <li><span class='match'>apart<\/span><\/li>\n  <li><span class='match'>apparent<\/span><\/li>\n  <li><span class='match'>appear<\/span><\/li>\n  <li><span class='match'>apply<\/span><\/li>\n  <li><span class='match'>appoint<\/span><\/li>\n  <li><span class='match'>approach<\/span><\/li>\n  <li><span class='match'>arm<\/span><\/li>\n  <li><span class='match'>around<\/span><\/li>\n  <li><span class='match'>art<\/span><\/li>\n  <li><span class='match'>as<\/span><\/li>\n  <li><span class='match'>ask<\/span><\/li>\n  <li><span class='match'>at<\/span><\/li>\n  <li><span class='match'>attend<\/span><\/li>\n  <li><span class='match'>authority<\/span><\/li>\n  <li><span class='match'>away<\/span><\/li>\n  <li><span class='match'>awful<\/span><\/li>\n  <li><span class='match'>each<\/span><\/li>\n  <li><span class='match'>early<\/span><\/li>\n  <li><span class='match'>east<\/span><\/li>\n  <li><span class='match'>easy<\/span><\/li>\n  <li><span class='match'>eat<\/span><\/li>\n  <li><span class='match'>economy<\/span><\/li>\n  <li><span class='match'>effect<\/span><\/li>\n  <li><span class='match'>egg<\/span><\/li>\n  <li><span class='match'>eight<\/span><\/li>\n  <li><span class='match'>either<\/span><\/li>\n  <li><span class='match'>elect<\/span><\/li>\n  <li><span class='match'>electric<\/span><\/li>\n  <li><span class='match'>eleven<\/span><\/li>\n  <li><span class='match'>employ<\/span><\/li>\n  <li><span class='match'>end<\/span><\/li>\n  <li><span class='match'>english<\/span><\/li>\n  <li><span class='match'>enjoy<\/span><\/li>\n  <li><span class='match'>enough<\/span><\/li>\n  <li><span class='match'>enter<\/span><\/li>\n  <li><span class='match'>environment<\/span><\/li>\n  <li><span class='match'>equal<\/span><\/li>\n  <li><span class='match'>especial<\/span><\/li>\n  <li><span class='match'>even<\/span><\/li>\n  <li><span class='match'>evening<\/span><\/li>\n  <li><span class='match'>ever<\/span><\/li>\n  <li><span class='match'>every<\/span><\/li>\n  <li><span class='match'>exact<\/span><\/li>\n  <li><span class='match'>except<\/span><\/li>\n  <li><span class='match'>exist<\/span><\/li>\n  <li><span class='match'>expect<\/span><\/li>\n  <li><span class='match'>explain<\/span><\/li>\n  <li><span class='match'>express<\/span><\/li>\n  <li><span class='match'>identify<\/span><\/li>\n  <li><span class='match'>if<\/span><\/li>\n  <li><span class='match'>important<\/span><\/li>\n  <li><span class='match'>in<\/span><\/li>\n  <li><span class='match'>indeed<\/span><\/li>\n  <li><span class='match'>individual<\/span><\/li>\n  <li><span class='match'>industry<\/span><\/li>\n  <li><span class='match'>inform<\/span><\/li>\n  <li><span class='match'>instead<\/span><\/li>\n  <li><span class='match'>interest<\/span><\/li>\n  <li><span class='match'>invest<\/span><\/li>\n  <li><span class='match'>it<\/span><\/li>\n  <li><span class='match'>item<\/span><\/li>\n  <li><span class='match'>obvious<\/span><\/li>\n  <li><span class='match'>occasion<\/span><\/li>\n  <li><span class='match'>odd<\/span><\/li>\n  <li><span class='match'>of<\/span><\/li>\n  <li><span class='match'>off<\/span><\/li>\n  <li><span class='match'>offer<\/span><\/li>\n  <li><span class='match'>often<\/span><\/li>\n  <li><span class='match'>okay<\/span><\/li>\n  <li><span class='match'>old<\/span><\/li>\n  <li><span class='match'>on<\/span><\/li>\n  <li><span class='match'>only<\/span><\/li>\n  <li><span class='match'>open<\/span><\/li>\n  <li><span class='match'>opportunity<\/span><\/li>\n  <li><span class='match'>or<\/span><\/li>\n  <li><span class='match'>order<\/span><\/li>\n  <li><span class='match'>original<\/span><\/li>\n  <li><span class='match'>other<\/span><\/li>\n  <li><span class='match'>ought<\/span><\/li>\n  <li><span class='match'>out<\/span><\/li>\n  <li><span class='match'>over<\/span><\/li>\n  <li><span class='match'>own<\/span><\/li>\n  <li><span class='match'>under<\/span><\/li>\n  <li><span class='match'>understand<\/span><\/li>\n  <li><span class='match'>union<\/span><\/li>\n  <li><span class='match'>unit<\/span><\/li>\n  <li><span class='match'>university<\/span><\/li>\n  <li><span class='match'>unless<\/span><\/li>\n  <li><span class='match'>until<\/span><\/li>\n  <li><span class='match'>up<\/span><\/li>\n  <li><span class='match'>upon<\/span><\/li>\n  <li><span class='match'>usual<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1119-1" data-line-number="1">df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1119-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(words, <span class="st">&quot;^[aeiou].*[^aeiou]$&quot;</span>)) <span class="co">#  Указан порядковый номер слова</span></a></code></pre></div>
<pre><code>## # A tibble: 122 x 2
##    word        i
##    &lt;chr&gt;   &lt;int&gt;
##  1 about       3
##  2 accept      5
##  3 account     6
##  4 across      8
##  5 act         9
##  6 actual     11
##  7 add        12
##  8 address    13
##  9 admit      14
## 10 affect     16
## # … with 112 more rows</code></pre>
<p>А теперь разобьём</p>
<div class="sourceCode" id="cb1121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1121-1" data-line-number="1"><span class="co"># Одним регулярным выражением</span></a>
<a class="sourceLine" id="cb1121-2" data-line-number="2">words[<span class="kw">str_detect</span>(words, <span class="st">&quot;^[aeiou].*[^aeiou]$&quot;</span>)]</a></code></pre></div>
<pre><code>##   [1] &quot;about&quot;       &quot;accept&quot;      &quot;account&quot;     &quot;across&quot;      &quot;act&quot;        
##   [6] &quot;actual&quot;      &quot;add&quot;         &quot;address&quot;     &quot;admit&quot;       &quot;affect&quot;     
##  [11] &quot;afford&quot;      &quot;after&quot;       &quot;afternoon&quot;   &quot;again&quot;       &quot;against&quot;    
##  [16] &quot;agent&quot;       &quot;air&quot;         &quot;all&quot;         &quot;allow&quot;       &quot;almost&quot;     
##  [21] &quot;along&quot;       &quot;already&quot;     &quot;alright&quot;     &quot;although&quot;    &quot;always&quot;     
##  [26] &quot;amount&quot;      &quot;and&quot;         &quot;another&quot;     &quot;answer&quot;      &quot;any&quot;        
##  [31] &quot;apart&quot;       &quot;apparent&quot;    &quot;appear&quot;      &quot;apply&quot;       &quot;appoint&quot;    
##  [36] &quot;approach&quot;    &quot;arm&quot;         &quot;around&quot;      &quot;art&quot;         &quot;as&quot;         
##  [41] &quot;ask&quot;         &quot;at&quot;          &quot;attend&quot;      &quot;authority&quot;   &quot;away&quot;       
##  [46] &quot;awful&quot;       &quot;each&quot;        &quot;early&quot;       &quot;east&quot;        &quot;easy&quot;       
##  [51] &quot;eat&quot;         &quot;economy&quot;     &quot;effect&quot;      &quot;egg&quot;         &quot;eight&quot;      
##  [56] &quot;either&quot;      &quot;elect&quot;       &quot;electric&quot;    &quot;eleven&quot;      &quot;employ&quot;     
##  [61] &quot;end&quot;         &quot;english&quot;     &quot;enjoy&quot;       &quot;enough&quot;      &quot;enter&quot;      
##  [66] &quot;environment&quot; &quot;equal&quot;       &quot;especial&quot;    &quot;even&quot;        &quot;evening&quot;    
##  [71] &quot;ever&quot;        &quot;every&quot;       &quot;exact&quot;       &quot;except&quot;      &quot;exist&quot;      
##  [76] &quot;expect&quot;      &quot;explain&quot;     &quot;express&quot;     &quot;identify&quot;    &quot;if&quot;         
##  [81] &quot;important&quot;   &quot;in&quot;          &quot;indeed&quot;      &quot;individual&quot;  &quot;industry&quot;   
##  [86] &quot;inform&quot;      &quot;instead&quot;     &quot;interest&quot;    &quot;invest&quot;      &quot;it&quot;         
##  [91] &quot;item&quot;        &quot;obvious&quot;     &quot;occasion&quot;    &quot;odd&quot;         &quot;of&quot;         
##  [96] &quot;off&quot;         &quot;offer&quot;       &quot;often&quot;       &quot;okay&quot;        &quot;old&quot;        
## [101] &quot;on&quot;          &quot;only&quot;        &quot;open&quot;        &quot;opportunity&quot; &quot;or&quot;         
## [106] &quot;order&quot;       &quot;original&quot;    &quot;other&quot;       &quot;ought&quot;       &quot;out&quot;        
## [111] &quot;over&quot;        &quot;own&quot;         &quot;under&quot;       &quot;understand&quot;  &quot;union&quot;      
## [116] &quot;unit&quot;        &quot;university&quot;  &quot;unless&quot;      &quot;until&quot;       &quot;up&quot;         
## [121] &quot;upon&quot;        &quot;usual&quot;</code></pre>
<div class="sourceCode" id="cb1123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1123-1" data-line-number="1"><span class="co"># Двумя отдельными выражениями</span></a>
<a class="sourceLine" id="cb1123-2" data-line-number="2">start_with_x &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;^[aeiou]&quot;</span>)</a>
<a class="sourceLine" id="cb1123-3" data-line-number="3">end_with_x &lt;-<span class="st"> </span><span class="kw">str_detect</span>(words, <span class="st">&quot;[^aeiou]$&quot;</span>)</a>
<a class="sourceLine" id="cb1123-4" data-line-number="4">words[start_with_x <span class="op">&amp;</span><span class="st"> </span>end_with_x]</a></code></pre></div>
<pre><code>##   [1] &quot;about&quot;       &quot;accept&quot;      &quot;account&quot;     &quot;across&quot;      &quot;act&quot;        
##   [6] &quot;actual&quot;      &quot;add&quot;         &quot;address&quot;     &quot;admit&quot;       &quot;affect&quot;     
##  [11] &quot;afford&quot;      &quot;after&quot;       &quot;afternoon&quot;   &quot;again&quot;       &quot;against&quot;    
##  [16] &quot;agent&quot;       &quot;air&quot;         &quot;all&quot;         &quot;allow&quot;       &quot;almost&quot;     
##  [21] &quot;along&quot;       &quot;already&quot;     &quot;alright&quot;     &quot;although&quot;    &quot;always&quot;     
##  [26] &quot;amount&quot;      &quot;and&quot;         &quot;another&quot;     &quot;answer&quot;      &quot;any&quot;        
##  [31] &quot;apart&quot;       &quot;apparent&quot;    &quot;appear&quot;      &quot;apply&quot;       &quot;appoint&quot;    
##  [36] &quot;approach&quot;    &quot;arm&quot;         &quot;around&quot;      &quot;art&quot;         &quot;as&quot;         
##  [41] &quot;ask&quot;         &quot;at&quot;          &quot;attend&quot;      &quot;authority&quot;   &quot;away&quot;       
##  [46] &quot;awful&quot;       &quot;each&quot;        &quot;early&quot;       &quot;east&quot;        &quot;easy&quot;       
##  [51] &quot;eat&quot;         &quot;economy&quot;     &quot;effect&quot;      &quot;egg&quot;         &quot;eight&quot;      
##  [56] &quot;either&quot;      &quot;elect&quot;       &quot;electric&quot;    &quot;eleven&quot;      &quot;employ&quot;     
##  [61] &quot;end&quot;         &quot;english&quot;     &quot;enjoy&quot;       &quot;enough&quot;      &quot;enter&quot;      
##  [66] &quot;environment&quot; &quot;equal&quot;       &quot;especial&quot;    &quot;even&quot;        &quot;evening&quot;    
##  [71] &quot;ever&quot;        &quot;every&quot;       &quot;exact&quot;       &quot;except&quot;      &quot;exist&quot;      
##  [76] &quot;expect&quot;      &quot;explain&quot;     &quot;express&quot;     &quot;identify&quot;    &quot;if&quot;         
##  [81] &quot;important&quot;   &quot;in&quot;          &quot;indeed&quot;      &quot;individual&quot;  &quot;industry&quot;   
##  [86] &quot;inform&quot;      &quot;instead&quot;     &quot;interest&quot;    &quot;invest&quot;      &quot;it&quot;         
##  [91] &quot;item&quot;        &quot;obvious&quot;     &quot;occasion&quot;    &quot;odd&quot;         &quot;of&quot;         
##  [96] &quot;off&quot;         &quot;offer&quot;       &quot;often&quot;       &quot;okay&quot;        &quot;old&quot;        
## [101] &quot;on&quot;          &quot;only&quot;        &quot;open&quot;        &quot;opportunity&quot; &quot;or&quot;         
## [106] &quot;order&quot;       &quot;original&quot;    &quot;other&quot;       &quot;ought&quot;       &quot;out&quot;        
## [111] &quot;over&quot;        &quot;own&quot;         &quot;under&quot;       &quot;understand&quot;  &quot;union&quot;      
## [116] &quot;unit&quot;        &quot;university&quot;  &quot;unless&quot;      &quot;until&quot;       &quot;up&quot;         
## [121] &quot;upon&quot;        &quot;usual&quot;</code></pre>
<ul>
<li>В общем случае, cлова, в которых гласная содержится хотя бы один раз – не придумал способ реализации.</li>
</ul>
<div class="sourceCode" id="cb1125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1125-1" data-line-number="1"><span class="co"># Сочетание нескольких регулярных выражений</span></a>
<a class="sourceLine" id="cb1125-2" data-line-number="2">words[<span class="kw">str_detect</span>(words, <span class="st">&quot;a&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1125-3" data-line-number="3"><span class="st">      </span><span class="kw">str_detect</span>(words, <span class="st">&quot;e&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1125-4" data-line-number="4"><span class="st">      </span><span class="kw">str_detect</span>(words, <span class="st">&quot;i&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1125-5" data-line-number="5"><span class="st">      </span><span class="kw">str_detect</span>(words, <span class="st">&quot;o&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb1125-6" data-line-number="6"><span class="st">      </span><span class="kw">str_detect</span>(words, <span class="st">&quot;u&quot;</span>)]</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<ul>
<li>Доля гласных это отношение количества гласных букв в слове, к длине всего слова. Я предполагаю, что самым длинным будет какое-то особое слово, в котором кол-во букв, совпадает с кол-вом гласных.</li>
</ul>
<div class="sourceCode" id="cb1127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1127-1" data-line-number="1">(vowels &lt;-<span class="st"> </span><span class="kw">str_count</span>(words, <span class="st">&quot;[aeiou]&quot;</span>)) <span class="co"># Считаем кол-во гласных в слове</span></a></code></pre></div>
<pre><code>##   [1] 1 2 3 4 2 3 4 2 1 3 3 1 2 2 4 2 2 2 4 3 3 2 2 2 3 2 1 2 2 2 3 2 2 3 2
##  [36] 4 3 1 3 2 1 2 3 3 1 3 3 5 3 3 1 3 3 1 1 1 5 3 1 2 4 5 3 2 2 1 1 1 1 3
##  [71] 1 1 1 2 2 1 2 2 3 4 3 1 3 2 2 4 3 1 1 3 1 1 1 1 1 2 2 1 2 2 2 1 2 1 2
## [106] 2 2 1 1 2 2 3 1 3 2 2 2 1 3 1 1 1 0 2 1 1 1 1 2 1 2 1 1 3 1 2 3 2 3 2
## [141] 2 1 3 2 2 1 1 3 3 1 2 1 1 2 1 2 2 2 1 2 2 2 1 3 1 5 2 3 3 2 2 2 4 2 3
## [176] 2 3 3 3 2 4 2 3 2 2 4 2 2 3 2 1 2 2 1 2 3 2 2 2 3 3 2 2 3 1 1 2 1 1 2
## [211] 2 1 2 2 2 3 3 4 2 4 3 3 2 3 2 3 3 2 4 3 2 2 2 2 3 1 2 3 1 2 3 2 1 1 1
## [246] 1 2 1 0 2 2 2 2 2 2 2 3 4 2 1 2 3 2 3 3 2 2 5 1 3 2 2 3 2 4 3 4 4 2 3
## [281] 2 2 4 2 3 2 3 4 2 2 3 5 3 2 2 2 2 1 2 1 2 1 1 1 2 3 2 2 1 2 1 3 2 1 1
## [316] 2 3 1 2 2 2 1 1 1 2 1 2 0 2 2 2 1 2 2 1 3 2 2 2 2 2 2 1 1 1 1 3 1 2 3
## [351] 2 2 1 3 2 1 1 2 1 1 1 2 3 2 1 1 2 2 2 2 1 2 1 2 1 1 1 1 2 1 1 2 2 1 2
## [386] 2 2 2 2 2 1 1 2 1 2 1 1 3 2 2 2 2 3 1 2 3 1 3 2 2 2 3 3 1 4 3 3 1 3 3
## [421] 4 3 5 2 2 3 3 3 3 2 4 2 3 3 1 2 2 1 2 2 1 1 2 1 1 1 1 1 2 1 1 3 1 1 1
## [456] 4 2 1 2 2 1 1 2 2 3 1 1 1 1 2 2 2 2 1 2 2 2 2 1 1 2 2 2 2 2 1 2 1 2 1
## [491] 2 1 2 1 1 1 3 2 2 2 1 3 1 1 2 1 1 2 1 2 2 3 4 2 2 3 2 1 2 1 3 1 3 2 3
## [526] 1 2 2 2 2 1 2 2 1 2 3 2 0 1 2 1 2 3 3 2 3 2 2 1 1 1 2 1 2 1 1 2 2 1 1
## [561] 2 3 1 2 4 4 1 1 1 2 3 2 2 1 1 2 2 1 2 4 4 3 1 2 4 4 2 4 2 2 2 1 1 2 2
## [596] 2 2 3 2 2 1 1 4 1 1 1 1 2 3 3 1 2 2 2 3 2 3 1 3 3 2 1 1 3 1 2 3 2 3 2
## [631] 4 4 3 1 2 2 3 3 2 1 3 3 1 4 2 1 3 3 2 3 2 3 2 3 2 2 3 2 3 2 1 3 1 1 3
## [666] 3 4 2 2 3 3 3 2 3 2 2 2 2 2 2 4 2 3 4 2 2 4 3 2 1 3 2 2 3 4 3 2 3 4 3
## [701] 4 2 4 1 2 2 1 1 1 2 2 2 1 2 2 2 1 2 2 2 3 2 1 2 2 3 2 2 2 2 3 3 3 2 2
## [736] 1 1 1 2 4 4 2 3 1 2 2 1 1 2 1 2 2 2 1 1 2 1 1 1 2 1 3 2 2 1 2 1 2 1 2
## [771] 4 1 2 2 1 1 1 2 1 3 3 2 1 2 1 1 2 2 2 2 3 3 2 1 1 3 1 2 2 1 2 1 2 3 1
## [806] 1 1 1 1 1 2 2 2 2 1 3 2 1 1 2 2 3 1 2 2 2 2 1 2 1 2 3 2 3 1 1 2 2 1 2
## [841] 1 2 2 2 4 5 1 1 1 1 3 1 1 1 1 1 2 4 1 1 1 3 1 1 2 2 3 2 2 1 2 2 2 1 2
## [876] 3 3 2 2 1 2 2 2 1 2 2 2 2 2 2 2 3 2 1 0 3 1 2 1 1 1 2 3 3 2 3 4 2 2 1
## [911] 2 2 3 3 4 1 3 2 3 2 2 2 2 1 1 1 1 1 1 2 1 2 1 1 2 3 2 2 2 3 1 1 1 1 2
## [946] 2 1 2 2 1 2 0 2 2 1 1 1 2 1 1 2 3 2 2 2 1 1 1 1 2 1 2 2 1 2 1 3 1 2 2</code></pre>
<div class="sourceCode" id="cb1129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1129-1" data-line-number="1"><span class="kw">max</span>(vowels) <span class="co"># Максимальное кол-во гласных в слове 5 штук</span></a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb1131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1131-1" data-line-number="1">words[<span class="kw">which</span>(vowels <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(vowels))] <span class="co"># Берём слова, с максимальным количеством гласных</span></a></code></pre></div>
<pre><code>## [1] &quot;appropriate&quot; &quot;associate&quot;   &quot;available&quot;   &quot;colleague&quot;   &quot;encourage&quot;  
## [6] &quot;experience&quot;  &quot;individual&quot;  &quot;television&quot;</code></pre>
<div class="sourceCode" id="cb1133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1133-1" data-line-number="1">prop_vowels &lt;-<span class="st"> </span><span class="kw">str_count</span>(words, <span class="st">&quot;[aeiou]&quot;</span>) <span class="op">/</span><span class="st"> </span><span class="kw">str_length</span>(words) <span class="co"># Считаем долю гласных букв от всего слова.</span></a>
<a class="sourceLine" id="cb1133-2" data-line-number="2">words[<span class="kw">which</span>(prop_vowels <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(prop_vowels))] <span class="co"># Берём словам, с максимальной долей гласных</span></a></code></pre></div>
<pre><code>## [1] &quot;a&quot;</code></pre>
</div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.4.2</span> Извлечение совпадений</h4>
<p>Для извлечение фактического текста совпадегния используется функция <code>str_extract()</code>. Для демонстрации воспользуемся текстом <a href="https://en.wikipedia.org/wiki/Harvard_sentences">Harvard senteces</a>.</p>
<p>Предложения, составляющие этот текст предоставляются пакетом <code>stringr::sentences</code></p>
<div class="sourceCode" id="cb1135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1135-1" data-line-number="1"><span class="kw">length</span>(sentences)</a></code></pre></div>
<pre><code>## [1] 720</code></pre>
<div class="sourceCode" id="cb1137"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1137-1" data-line-number="1"><span class="kw">head</span>(sentences)</a></code></pre></div>
<pre><code>## [1] &quot;The birch canoe slid on the smooth planks.&quot; 
## [2] &quot;Glue the sheet to the dark blue background.&quot;
## [3] &quot;It&#39;s easy to tell the depth of a well.&quot;     
## [4] &quot;These days a chicken leg is a rare dish.&quot;   
## [5] &quot;Rice is often served in round bowls.&quot;       
## [6] &quot;The juice of lemons makes fine punch.&quot;</code></pre>
<p>Предположим мы хотим найти все предложения, в которых упоминается цвет. Сначала мы создаем вектор названий цветов:</p>
<div class="sourceCode" id="cb1139"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1139-1" data-line-number="1">colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>)</a></code></pre></div>
<p>А затем превращаем его в одиночное регулярное выражение:</p>
<div class="sourceCode" id="cb1140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1140-1" data-line-number="1">(color_match &lt;-<span class="st"> </span><span class="kw">str_c</span>(colors, <span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;red|orange|yellow|green|blue|purple&quot;</code></pre>
<p>После этого можно выбрать все предложения, в которых упоминается какой-либо цвет:</p>
<div class="sourceCode" id="cb1142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1142-1" data-line-number="1">has_color &lt;-<span class="st"> </span><span class="kw">str_subset</span>(sentences, color_match)</a></code></pre></div>
<p>А затем извлечь каждый цвет, чтобы увидеть, что это за цвета:</p>
<div class="sourceCode" id="cb1143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1143-1" data-line-number="1">(matches &lt;-<span class="st"> </span><span class="kw">str_extract</span>(has_color, color_match))</a></code></pre></div>
<pre><code>##  [1] &quot;blue&quot;   &quot;blue&quot;   &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;blue&quot;   &quot;yellow&quot;
##  [8] &quot;red&quot;    &quot;red&quot;    &quot;green&quot;  &quot;red&quot;    &quot;red&quot;    &quot;blue&quot;   &quot;red&quot;   
## [15] &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;blue&quot;   &quot;red&quot;    &quot;blue&quot;   &quot;red&quot;   
## [22] &quot;green&quot;  &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;red&quot;   
## [29] &quot;green&quot;  &quot;red&quot;    &quot;green&quot;  &quot;red&quot;    &quot;purple&quot; &quot;green&quot;  &quot;red&quot;   
## [36] &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;blue&quot;   &quot;red&quot;    &quot;blue&quot;  
## [43] &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;red&quot;    &quot;green&quot;  &quot;green&quot;  &quot;green&quot; 
## [50] &quot;red&quot;    &quot;red&quot;    &quot;yellow&quot; &quot;red&quot;    &quot;orange&quot; &quot;red&quot;    &quot;red&quot;   
## [57] &quot;red&quot;</code></pre>
<p><em>Функция <code>sub_extract()</code> извлекает лишь первое совпадение</em>. Это легче всего увидеть, если выбрать сначала все предложения, в которых имеется более одного совпадения</p>
<div class="sourceCode" id="cb1145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1145-1" data-line-number="1">more &lt;-<span class="st"> </span>sentences[<span class="kw">str_count</span>(sentences, color_match) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1145-2" data-line-number="2"><span class="kw">str_view_all</span>(more, color_match)</a></code></pre></div>
<div id="htmlwidget-c2577de3d386564cbd5a" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-c2577de3d386564cbd5a">{"x":{"html":"<ul>\n  <li>It is hard to erase <span class='match'>blue<\/span> or <span class='match'>red<\/span> ink.<\/li>\n  <li>The <span class='match'>green<\/span> light in the brown box flicke<span class='match'>red<\/span>.<\/li>\n  <li>The sky in the west is tinged with <span class='match'>orange<\/span> <span class='match'>red<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1146-1" data-line-number="1"><span class="kw">str_extract</span>(more, color_match)</a></code></pre></div>
<pre><code>## [1] &quot;blue&quot;   &quot;green&quot;  &quot;orange&quot;</code></pre>
<p>Это обычная схема при работе с пакетом <code>stringr</code>, поскольку одиночные структуры проще. Для получения всех совпадений используем функцию <code>str_extract_all()</code>. Но она уже возвращает список, с которым несколько затруднительнее работать.</p>
<div class="sourceCode" id="cb1148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1148-1" data-line-number="1"><span class="kw">str_extract_all</span>(more, color_match)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;blue&quot; &quot;red&quot; 
## 
## [[2]]
## [1] &quot;green&quot; &quot;red&quot;  
## 
## [[3]]
## [1] &quot;orange&quot; &quot;red&quot;</code></pre>
<p>Если передать функции <code>str_extract_all()</code> аргумент <code>simplify = TRUE</code>, она вернёт матрицу, в которой короткие совпадения расширены до той же длины, что и самое длинное.</p>
<p>В разобранном выше примере это сложно понять, посколько в каждом предложение указанный цвет встречается по два раза:</p>
<div class="sourceCode" id="cb1150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1150-1" data-line-number="1"><span class="kw">str_extract_all</span>(more, color_match, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##      [,1]     [,2] 
## [1,] &quot;blue&quot;   &quot;red&quot;
## [2,] &quot;green&quot;  &quot;red&quot;
## [3,] &quot;orange&quot; &quot;red&quot;</code></pre>
<p>Легче понять по искусственному примеру:</p>
<div class="sourceCode" id="cb1152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1152-1" data-line-number="1"><span class="co"># Вводим переменную, с кол-вом букв в каждом векторе 1,2,3 соответственно</span></a>
<a class="sourceLine" id="cb1152-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;a b&quot;</span>, <span class="st">&quot;a b c&quot;</span>)</a>
<a class="sourceLine" id="cb1152-3" data-line-number="3"><span class="co"># Ищем совпадение любой буквы в переменной x, с расширением недостающих совпадений</span></a>
<a class="sourceLine" id="cb1152-4" data-line-number="4"><span class="kw">str_extract_all</span>(x, <span class="st">&quot;[a-z]&quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,] &quot;a&quot;  &quot;&quot;   &quot;&quot;  
## [2,] &quot;a&quot;  &quot;b&quot;  &quot;&quot;  
## [3,] &quot;a&quot;  &quot;b&quot;  &quot;c&quot;</code></pre>
<div id="-14.4.3.1.1" class="section level5">
<h5><span class="header-section-number">3.5.4.2.1</span> Упражнение 14.4.3.1.1</h5>
<div class="question">
<p>In the previous example, you might have noticed that the regular expression matched “flickered”, which is not a color. Modify the regex to fix the problem.</p>
</div>
<p>Выдача результата проводится при любом найденном совпадении. Для того чтобы искать только слова обозначающие цвет, а не любое найденное совпадение символов, достаточно чтобы искалось слово целиком.</p>
<div class="sourceCode" id="cb1154"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1154-1" data-line-number="1">colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>)</a>
<a class="sourceLine" id="cb1154-2" data-line-number="2">color_match &lt;-<span class="st"> </span><span class="kw">str_c</span>(colors, <span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>)</a>
<a class="sourceLine" id="cb1154-3" data-line-number="3">more &lt;-<span class="st"> </span>sentences[<span class="kw">str_count</span>(sentences, color_match) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1154-4" data-line-number="4"><span class="kw">str_view_all</span>(more, color_match)</a></code></pre></div>
<div id="htmlwidget-d66b2dd70cd814209d78" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d66b2dd70cd814209d78">{"x":{"html":"<ul>\n  <li>It is hard to erase <span class='match'>blue<\/span> or <span class='match'>red<\/span> ink.<\/li>\n  <li>The <span class='match'>green<\/span> light in the brown box flicke<span class='match'>red<\/span>.<\/li>\n  <li>The sky in the west is tinged with <span class='match'>orange<\/span> <span class='match'>red<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Для этого удобно использовать оператор: <code>\b</code> — он ищет совпадение в начале или конце. Нам нужно чтобы найденные символы были началом и концом слова, иными словами чтобы это было слово целиком</p>
<div class="sourceCode" id="cb1155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1155-1" data-line-number="1">colors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;purple&quot;</span>)</a>
<a class="sourceLine" id="cb1155-2" data-line-number="2">color_match2 &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">b(&quot;</span>, <span class="kw">str_c</span>(colors, <span class="dt">collapse =</span> <span class="st">&quot;|&quot;</span>), <span class="st">&quot;)</span><span class="ch">\\</span><span class="st">b&quot;</span>)</a>
<a class="sourceLine" id="cb1155-3" data-line-number="3">more &lt;-<span class="st"> </span>sentences[<span class="kw">str_count</span>(sentences, color_match) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb1155-4" data-line-number="4"><span class="kw">str_view_all</span>(more, color_match2)</a></code></pre></div>
<div id="htmlwidget-e725ae3d6b58403876a9" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-e725ae3d6b58403876a9">{"x":{"html":"<ul>\n  <li>It is hard to erase <span class='match'>blue<\/span> or <span class='match'>red<\/span> ink.<\/li>\n  <li>The <span class='match'>green<\/span> light in the brown box flickered.<\/li>\n  <li>The sky in the west is tinged with <span class='match'>orange<\/span> <span class='match'>red<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div id="-14.4.3.1.2" class="section level5">
<h5><span class="header-section-number">3.5.4.2.2</span> Упражнение 14.4.3.1.2</h5>
<div class="question">
<p>From the Harvard sentences data, extract:</p>
<ul>
<li><p>The first word from each sentence.</p></li>
<li><p>All words ending in ing.</p></li>
<li>All plurals.</li>
</ul>
</div>
<ul>
<li>Я сразу буду пытаться упрощать и стараться не лепить огромные регулярные выражения.
Поэтому я буду часто использовать некоторые сокращенные записи для классов символов.
Вот их неполный перечень</li>
</ul>
<table>
<thead>
<tr class="header">
<th>Обозначение</th>
<th align="center">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\w</code></td>
<td align="center">Word (a-z, A-Z, 0-9, including _ (underscore))</td>
</tr>
<tr class="even">
<td><code>\W</code></td>
<td align="center">Non-word</td>
</tr>
<tr class="odd">
<td><code>\d</code></td>
<td align="center">Digit (0-9)</td>
</tr>
<tr class="even">
<td><code>\D</code></td>
<td align="center">Non-digit</td>
</tr>
<tr class="odd">
<td><code>\s</code></td>
<td align="center">Whitespace</td>
</tr>
<tr class="even">
<td><code>\S</code></td>
<td align="center">Not whitespace</td>
</tr>
<tr class="odd">
<td><code>\b</code></td>
<td align="center">Match at beginning or end</td>
</tr>
<tr class="even">
<td><code>\B</code></td>
<td align="center">Do not match at beginning or end</td>
</tr>
<tr class="odd">
<td><code>\0</code></td>
<td align="center">NULL character</td>
</tr>
<tr class="even">
<td><code>\n</code></td>
<td align="center">New line</td>
</tr>
</tbody>
</table>
<p>Сначала я подумал, что идеально для цели “извлечь первое слово” подходит оператор <code>\w</code> — любое слово:</p>
<div class="sourceCode" id="cb1156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1156-1" data-line-number="1"><span class="kw">str_view</span>(sentences, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">w+&quot;</span>) <span class="co"># найти один или более буквенный символ</span></a></code></pre></div>
<div id="htmlwidget-d4efbfd9cd50c4c81242" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d4efbfd9cd50c4c81242">{"x":{"html":"<ul>\n  <li><span class='match'>The<\/span> birch canoe slid on the smooth planks.<\/li>\n  <li><span class='match'>Glue<\/span> the sheet to the dark blue background.<\/li>\n  <li><span class='match'>It<\/span>'s easy to tell the depth of a well.<\/li>\n  <li><span class='match'>These<\/span> days a chicken leg is a rare dish.<\/li>\n  <li><span class='match'>Rice<\/span> is often served in round bowls.<\/li>\n  <li><span class='match'>The<\/span> juice of lemons makes fine punch.<\/li>\n  <li><span class='match'>The<\/span> box was thrown beside the parked truck.<\/li>\n  <li><span class='match'>The<\/span> hogs were fed chopped corn and garbage.<\/li>\n  <li><span class='match'>Four<\/span> hours of steady work faced us.<\/li>\n  <li><span class='match'>Large<\/span> size in stockings is hard to sell.<\/li>\n  <li><span class='match'>The<\/span> boy was there when the sun rose.<\/li>\n  <li><span class='match'>A<\/span> rod is used to catch pink salmon.<\/li>\n  <li><span class='match'>The<\/span> source of the huge river is the clear spring.<\/li>\n  <li><span class='match'>Kick<\/span> the ball straight and follow through.<\/li>\n  <li><span class='match'>Help<\/span> the woman get back to her feet.<\/li>\n  <li><span class='match'>A<\/span> pot of tea helps to pass the evening.<\/li>\n  <li><span class='match'>Smoky<\/span> fires lack flame and heat.<\/li>\n  <li><span class='match'>The<\/span> soft cushion broke the man's fall.<\/li>\n  <li><span class='match'>The<\/span> salt breeze came across from the sea.<\/li>\n  <li><span class='match'>The<\/span> girl at the booth sold fifty bonds.<\/li>\n  <li><span class='match'>The<\/span> small pup gnawed a hole in the sock.<\/li>\n  <li><span class='match'>The<\/span> fish twisted and turned on the bent hook.<\/li>\n  <li><span class='match'>Press<\/span> the pants and sew a button on the vest.<\/li>\n  <li><span class='match'>The<\/span> swan dive was far short of perfect.<\/li>\n  <li><span class='match'>The<\/span> beauty of the view stunned the young boy.<\/li>\n  <li><span class='match'>Two<\/span> blue fish swam in the tank.<\/li>\n  <li><span class='match'>Her<\/span> purse was full of useless trash.<\/li>\n  <li><span class='match'>The<\/span> colt reared and threw the tall rider.<\/li>\n  <li><span class='match'>It<\/span> snowed, rained, and hailed the same morning.<\/li>\n  <li><span class='match'>Read<\/span> verse out loud for pleasure.<\/li>\n  <li><span class='match'>Hoist<\/span> the load to your left shoulder.<\/li>\n  <li><span class='match'>Take<\/span> the winding path to reach the lake.<\/li>\n  <li><span class='match'>Note<\/span> closely the size of the gas tank.<\/li>\n  <li><span class='match'>Wipe<\/span> the grease off his dirty face.<\/li>\n  <li><span class='match'>Mend<\/span> the coat before you go out.<\/li>\n  <li><span class='match'>The<\/span> wrist was badly strained and hung limp.<\/li>\n  <li><span class='match'>The<\/span> stray cat gave birth to kittens.<\/li>\n  <li><span class='match'>The<\/span> young girl gave no clear response.<\/li>\n  <li><span class='match'>The<\/span> meal was cooked before the bell rang.<\/li>\n  <li><span class='match'>What<\/span> joy there is in living.<\/li>\n  <li><span class='match'>A<\/span> king ruled the state in the early days.<\/li>\n  <li><span class='match'>The<\/span> ship was torn apart on the sharp reef.<\/li>\n  <li><span class='match'>Sickness<\/span> kept him home the third week.<\/li>\n  <li><span class='match'>The<\/span> wide road shimmered in the hot sun.<\/li>\n  <li><span class='match'>The<\/span> lazy cow lay in the cool grass.<\/li>\n  <li><span class='match'>Lift<\/span> the square stone over the fence.<\/li>\n  <li><span class='match'>The<\/span> rope will bind the seven books at once.<\/li>\n  <li><span class='match'>Hop<\/span> over the fence and plunge in.<\/li>\n  <li><span class='match'>The<\/span> friendly gang left the drug store.<\/li>\n  <li><span class='match'>Mesh<\/span> mire keeps chicks inside.<\/li>\n  <li><span class='match'>The<\/span> frosty air passed through the coat.<\/li>\n  <li><span class='match'>The<\/span> crooked maze failed to fool the mouse.<\/li>\n  <li><span class='match'>Adding<\/span> fast leads to wrong sums.<\/li>\n  <li><span class='match'>The<\/span> show was a flop from the very start.<\/li>\n  <li><span class='match'>A<\/span> saw is a tool used for making boards.<\/li>\n  <li><span class='match'>The<\/span> wagon moved on well oiled wheels.<\/li>\n  <li><span class='match'>March<\/span> the soldiers past the next hill.<\/li>\n  <li><span class='match'>A<\/span> cup of sugar makes sweet fudge.<\/li>\n  <li><span class='match'>Place<\/span> a rosebush near the porch steps.<\/li>\n  <li><span class='match'>Both<\/span> lost their lives in the raging storm.<\/li>\n  <li><span class='match'>We<\/span> talked of the slide show in the circus.<\/li>\n  <li><span class='match'>Use<\/span> a pencil to write the first draft.<\/li>\n  <li><span class='match'>He<\/span> ran half way to the hardware store.<\/li>\n  <li><span class='match'>The<\/span> clock struck to mark the third period.<\/li>\n  <li><span class='match'>A<\/span> small creek cut across the field.<\/li>\n  <li><span class='match'>Cars<\/span> and busses stalled in snow drifts.<\/li>\n  <li><span class='match'>The<\/span> set of china hit, the floor with a crash.<\/li>\n  <li><span class='match'>This<\/span> is a grand season for hikes on the road.<\/li>\n  <li><span class='match'>The<\/span> dune rose from the edge of the water.<\/li>\n  <li><span class='match'>Those<\/span> words were the cue for the actor to leave.<\/li>\n  <li><span class='match'>A<\/span> yacht slid around the point into the bay.<\/li>\n  <li><span class='match'>The<\/span> two met while playing on the sand.<\/li>\n  <li><span class='match'>The<\/span> ink stain dried on the finished page.<\/li>\n  <li><span class='match'>The<\/span> walled town was seized without a fight.<\/li>\n  <li><span class='match'>The<\/span> lease ran out in sixteen weeks.<\/li>\n  <li><span class='match'>A<\/span> tame squirrel makes a nice pet.<\/li>\n  <li><span class='match'>The<\/span> horn of the car woke the sleeping cop.<\/li>\n  <li><span class='match'>The<\/span> heart beat strongly and with firm strokes.<\/li>\n  <li><span class='match'>The<\/span> pearl was worn in a thin silver ring.<\/li>\n  <li><span class='match'>The<\/span> fruit peel was cut in thick slices.<\/li>\n  <li><span class='match'>The<\/span> Navy attacked the big task force.<\/li>\n  <li><span class='match'>See<\/span> the cat glaring at the scared mouse.<\/li>\n  <li><span class='match'>There<\/span> are more than two factors here.<\/li>\n  <li><span class='match'>The<\/span> hat brim was wide and too droopy.<\/li>\n  <li><span class='match'>The<\/span> lawyer tried to lose his case.<\/li>\n  <li><span class='match'>The<\/span> grass curled around the fence post.<\/li>\n  <li><span class='match'>Cut<\/span> the pie into large parts.<\/li>\n  <li><span class='match'>Men<\/span> strive but seldom get rich.<\/li>\n  <li><span class='match'>Always<\/span> close the barn door tight.<\/li>\n  <li><span class='match'>He<\/span> lay prone and hardly moved a limb.<\/li>\n  <li><span class='match'>The<\/span> slush lay deep along the street.<\/li>\n  <li><span class='match'>A<\/span> wisp of cloud hung in the blue air.<\/li>\n  <li><span class='match'>A<\/span> pound of sugar costs more than eggs.<\/li>\n  <li><span class='match'>The<\/span> fin was sharp and cut the clear water.<\/li>\n  <li><span class='match'>The<\/span> play seems dull and quite stupid.<\/li>\n  <li><span class='match'>Bail<\/span> the boat, to stop it from sinking.<\/li>\n  <li><span class='match'>The<\/span> term ended in late June that year.<\/li>\n  <li><span class='match'>A<\/span> tusk is used to make costly gifts.<\/li>\n  <li><span class='match'>Ten<\/span> pins were set in order.<\/li>\n  <li><span class='match'>The<\/span> bill as paid every third week.<\/li>\n  <li><span class='match'>Oak<\/span> is strong and also gives shade.<\/li>\n  <li><span class='match'>Cats<\/span> and dogs each hate the other.<\/li>\n  <li><span class='match'>The<\/span> pipe began to rust while new.<\/li>\n  <li><span class='match'>Open<\/span> the crate but don't break the glass.<\/li>\n  <li><span class='match'>Add<\/span> the sum to the product of these three.<\/li>\n  <li><span class='match'>Thieves<\/span> who rob friends deserve jail.<\/li>\n  <li><span class='match'>The<\/span> ripe taste of cheese improves with age.<\/li>\n  <li><span class='match'>Act<\/span> on these orders with great speed.<\/li>\n  <li><span class='match'>The<\/span> hog crawled under the high fence.<\/li>\n  <li><span class='match'>Move<\/span> the vat over the hot fire.<\/li>\n  <li><span class='match'>The<\/span> bark of the pine tree was shiny and dark.<\/li>\n  <li><span class='match'>Leaves<\/span> turn brown and yellow in the fall.<\/li>\n  <li><span class='match'>The<\/span> pennant waved when the wind blew.<\/li>\n  <li><span class='match'>Split<\/span> the log with a quick, sharp blow.<\/li>\n  <li><span class='match'>Burn<\/span> peat after the logs give out.<\/li>\n  <li><span class='match'>He<\/span> ordered peach pie with ice cream.<\/li>\n  <li><span class='match'>Weave<\/span> the carpet on the right hand side.<\/li>\n  <li><span class='match'>Hemp<\/span> is a weed found in parts of the tropics.<\/li>\n  <li><span class='match'>A<\/span> lame back kept his score low.<\/li>\n  <li><span class='match'>We<\/span> find joy in the simplest things.<\/li>\n  <li><span class='match'>Type<\/span> out three lists of orders.<\/li>\n  <li><span class='match'>The<\/span> harder he tried the less he got done.<\/li>\n  <li><span class='match'>The<\/span> boss ran the show with a watchful eye.<\/li>\n  <li><span class='match'>The<\/span> cup cracked and spilled its contents.<\/li>\n  <li><span class='match'>Paste<\/span> can cleanse the most dirty brass.<\/li>\n  <li><span class='match'>The<\/span> slang word for raw whiskey is booze.<\/li>\n  <li><span class='match'>It<\/span> caught its hind paw in a rusty trap.<\/li>\n  <li><span class='match'>The<\/span> wharf could be seen at the farther shore.<\/li>\n  <li><span class='match'>Feel<\/span> the heat of the weak dying flame.<\/li>\n  <li><span class='match'>The<\/span> tiny girl took off her hat.<\/li>\n  <li><span class='match'>A<\/span> cramp is no small danger on a swim.<\/li>\n  <li><span class='match'>He<\/span> said the same phrase thirty times.<\/li>\n  <li><span class='match'>Pluck<\/span> the bright rose without leaves.<\/li>\n  <li><span class='match'>Two<\/span> plus seven is less than ten.<\/li>\n  <li><span class='match'>The<\/span> glow deepened in the eyes of the sweet girl.<\/li>\n  <li><span class='match'>Bring<\/span> your problems to the wise chief.<\/li>\n  <li><span class='match'>Write<\/span> a fond note to the friend you cherish.<\/li>\n  <li><span class='match'>Clothes<\/span> and lodging are free to new men.<\/li>\n  <li><span class='match'>We<\/span> frown when events take a bad turn.<\/li>\n  <li><span class='match'>Port<\/span> is a strong wine with s smoky taste.<\/li>\n  <li><span class='match'>The<\/span> young kid jumped the rusty gate.<\/li>\n  <li><span class='match'>Guess<\/span> the results from the first scores.<\/li>\n  <li><span class='match'>A<\/span> salt pickle tastes fine with ham.<\/li>\n  <li><span class='match'>The<\/span> just claim got the right verdict.<\/li>\n  <li><span class='match'>These<\/span> thistles bend in a high wind.<\/li>\n  <li><span class='match'>Pure<\/span> bred poodles have curls.<\/li>\n  <li><span class='match'>The<\/span> tree top waved in a graceful way.<\/li>\n  <li><span class='match'>The<\/span> spot on the blotter was made by green ink.<\/li>\n  <li><span class='match'>Mud<\/span> was spattered on the front of his white shirt.<\/li>\n  <li><span class='match'>The<\/span> cigar burned a hole in the desk top.<\/li>\n  <li><span class='match'>The<\/span> empty flask stood on the tin tray.<\/li>\n  <li><span class='match'>A<\/span> speedy man can beat this track mark.<\/li>\n  <li><span class='match'>He<\/span> broke a new shoelace that day.<\/li>\n  <li><span class='match'>The<\/span> coffee stand is too high for the couch.<\/li>\n  <li><span class='match'>The<\/span> urge to write short stories is rare.<\/li>\n  <li><span class='match'>The<\/span> pencils have all been used.<\/li>\n  <li><span class='match'>The<\/span> pirates seized the crew of the lost ship.<\/li>\n  <li><span class='match'>We<\/span> tried to replace the coin but failed.<\/li>\n  <li><span class='match'>She<\/span> sewed the torn coat quite neatly.<\/li>\n  <li><span class='match'>The<\/span> sofa cushion is red and of light weight.<\/li>\n  <li><span class='match'>The<\/span> jacket hung on the back of the wide chair.<\/li>\n  <li><span class='match'>At<\/span> that high level the air is pure.<\/li>\n  <li><span class='match'>Drop<\/span> the two when you add the figures.<\/li>\n  <li><span class='match'>A<\/span> filing case is now hard to buy.<\/li>\n  <li><span class='match'>An<\/span> abrupt start does not win the prize.<\/li>\n  <li><span class='match'>Wood<\/span> is best for making toys and blocks.<\/li>\n  <li><span class='match'>The<\/span> office paint was a dull sad tan.<\/li>\n  <li><span class='match'>He<\/span> knew the skill of the great young actress.<\/li>\n  <li><span class='match'>A<\/span> rag will soak up spilled water.<\/li>\n  <li><span class='match'>A<\/span> shower of dirt fell from the hot pipes.<\/li>\n  <li><span class='match'>Steam<\/span> hissed from the broken valve.<\/li>\n  <li><span class='match'>The<\/span> child almost hurt the small dog.<\/li>\n  <li><span class='match'>There<\/span> was a sound of dry leaves outside.<\/li>\n  <li><span class='match'>The<\/span> sky that morning was clear and bright blue.<\/li>\n  <li><span class='match'>Torn<\/span> scraps littered the stone floor.<\/li>\n  <li><span class='match'>Sunday<\/span> is the best part of the week.<\/li>\n  <li><span class='match'>The<\/span> doctor cured him with these pills.<\/li>\n  <li><span class='match'>The<\/span> new girl was fired today at noon.<\/li>\n  <li><span class='match'>They<\/span> felt gay when the ship arrived in port.<\/li>\n  <li><span class='match'>Add<\/span> the store's account to the last cent.<\/li>\n  <li><span class='match'>Acid<\/span> burns holes in wool cloth.<\/li>\n  <li><span class='match'>Fairy<\/span> tales should be fun to write.<\/li>\n  <li><span class='match'>Eight<\/span> miles of woodland burned to waste.<\/li>\n  <li><span class='match'>The<\/span> third act was dull and tired the players.<\/li>\n  <li><span class='match'>A<\/span> young child should not suffer fright.<\/li>\n  <li><span class='match'>Add<\/span> the column and put the sum here.<\/li>\n  <li><span class='match'>We<\/span> admire and love a good cook.<\/li>\n  <li><span class='match'>There<\/span> the flood mark is ten inches.<\/li>\n  <li><span class='match'>He<\/span> carved a head from the round block of marble.<\/li>\n  <li><span class='match'>She<\/span> has st smart way of wearing clothes.<\/li>\n  <li><span class='match'>The<\/span> fruit of a fig tree is apple-shaped.<\/li>\n  <li><span class='match'>Corn<\/span> cobs can be used to kindle a fire.<\/li>\n  <li><span class='match'>Where<\/span> were they when the noise started.<\/li>\n  <li><span class='match'>The<\/span> paper box is full of thumb tacks.<\/li>\n  <li><span class='match'>Sell<\/span> your gift to a buyer at a good gain.<\/li>\n  <li><span class='match'>The<\/span> tongs lay beside the ice pail.<\/li>\n  <li><span class='match'>The<\/span> petals fall with the next puff of wind.<\/li>\n  <li><span class='match'>Bring<\/span> your best compass to the third class.<\/li>\n  <li><span class='match'>They<\/span> could laugh although they were sad.<\/li>\n  <li><span class='match'>Farmers<\/span> came in to thresh the oat crop.<\/li>\n  <li><span class='match'>The<\/span> brown house was on fire to the attic.<\/li>\n  <li><span class='match'>The<\/span> lure is used to catch trout and flounder.<\/li>\n  <li><span class='match'>Float<\/span> the soap on top of the bath water.<\/li>\n  <li><span class='match'>A<\/span> blue crane is a tall wading bird.<\/li>\n  <li><span class='match'>A<\/span> fresh start will work such wonders.<\/li>\n  <li><span class='match'>The<\/span> club rented the rink for the fifth night.<\/li>\n  <li><span class='match'>After<\/span> the dance they went straight home.<\/li>\n  <li><span class='match'>The<\/span> hostess taught the new maid to serve.<\/li>\n  <li><span class='match'>He<\/span> wrote his last novel there at the inn.<\/li>\n  <li><span class='match'>Even<\/span> the worst will beat his low score.<\/li>\n  <li><span class='match'>The<\/span> cement had dried when he moved it.<\/li>\n  <li><span class='match'>The<\/span> loss of the second ship was hard to take.<\/li>\n  <li><span class='match'>The<\/span> fly made its way along the wall.<\/li>\n  <li><span class='match'>Do<\/span> that with a wooden stick.<\/li>\n  <li><span class='match'>Lire<\/span> wires should be kept covered.<\/li>\n  <li><span class='match'>The<\/span> large house had hot water taps.<\/li>\n  <li><span class='match'>It<\/span> is hard to erase blue or red ink.<\/li>\n  <li><span class='match'>Write<\/span> at once or you may forget it.<\/li>\n  <li><span class='match'>The<\/span> doorknob was made of bright clean brass.<\/li>\n  <li><span class='match'>The<\/span> wreck occurred by the bank on Main Street.<\/li>\n  <li><span class='match'>A<\/span> pencil with black lead writes best.<\/li>\n  <li><span class='match'>Coax<\/span> a young calf to drink from a bucket.<\/li>\n  <li><span class='match'>Schools<\/span> for ladies teach charm and grace.<\/li>\n  <li><span class='match'>The<\/span> lamp shone with a steady green flame.<\/li>\n  <li><span class='match'>They<\/span> took the axe and the saw to the forest.<\/li>\n  <li><span class='match'>The<\/span> ancient coin was quite dull and worn.<\/li>\n  <li><span class='match'>The<\/span> shaky barn fell with a loud crash.<\/li>\n  <li><span class='match'>Jazz<\/span> and swing fans like fast music.<\/li>\n  <li><span class='match'>Rake<\/span> the rubbish up and then burn it.<\/li>\n  <li><span class='match'>Slash<\/span> the gold cloth into fine ribbons.<\/li>\n  <li><span class='match'>Try<\/span> to have the court decide the case.<\/li>\n  <li><span class='match'>They<\/span> are pushed back each time they attack.<\/li>\n  <li><span class='match'>He<\/span> broke his ties with groups of former friends.<\/li>\n  <li><span class='match'>They<\/span> floated on the raft to sun their white backs.<\/li>\n  <li><span class='match'>The<\/span> map had an X that meant nothing.<\/li>\n  <li><span class='match'>Whitings<\/span> are small fish caught in nets.<\/li>\n  <li><span class='match'>Some<\/span> ads serve to cheat buyers.<\/li>\n  <li><span class='match'>Jerk<\/span> the rope and the bell rings weakly.<\/li>\n  <li><span class='match'>A<\/span> waxed floor makes us lose balance.<\/li>\n  <li><span class='match'>Madam<\/span>, this is the best brand of corn.<\/li>\n  <li><span class='match'>On<\/span> the islands the sea breeze is soft and mild.<\/li>\n  <li><span class='match'>The<\/span> play began as soon as we sat down.<\/li>\n  <li><span class='match'>This<\/span> will lead the world to more sound and fury<\/li>\n  <li><span class='match'>Add<\/span> salt before you fry the egg.<\/li>\n  <li><span class='match'>The<\/span> rush for funds reached its peak Tuesday.<\/li>\n  <li><span class='match'>The<\/span> birch looked stark white and lonesome.<\/li>\n  <li><span class='match'>The<\/span> box is held by a bright red snapper.<\/li>\n  <li><span class='match'>To<\/span> make pure ice, you freeze water.<\/li>\n  <li><span class='match'>The<\/span> first worm gets snapped early.<\/li>\n  <li><span class='match'>Jump<\/span> the fence and hurry up the bank.<\/li>\n  <li><span class='match'>Yell<\/span> and clap as the curtain slides back.<\/li>\n  <li><span class='match'>They<\/span> are men nho walk the middle of the road.<\/li>\n  <li><span class='match'>Both<\/span> brothers wear the same size.<\/li>\n  <li><span class='match'>In<\/span> some forin or other we need fun.<\/li>\n  <li><span class='match'>The<\/span> prince ordered his head chopped off.<\/li>\n  <li><span class='match'>The<\/span> houses are built of red clay bricks.<\/li>\n  <li><span class='match'>Ducks<\/span> fly north but lack a compass.<\/li>\n  <li><span class='match'>Fruit<\/span> flavors are used in fizz drinks.<\/li>\n  <li><span class='match'>These<\/span> pills do less good than others.<\/li>\n  <li><span class='match'>Canned<\/span> pears lack full flavor.<\/li>\n  <li><span class='match'>The<\/span> dark pot hung in the front closet.<\/li>\n  <li><span class='match'>Carry<\/span> the pail to the wall and spill it there.<\/li>\n  <li><span class='match'>The<\/span> train brought our hero to the big town.<\/li>\n  <li><span class='match'>We<\/span> are sure that one war is enough.<\/li>\n  <li><span class='match'>Gray<\/span> paint stretched for miles around.<\/li>\n  <li><span class='match'>The<\/span> rude laugh filled the empty room.<\/li>\n  <li><span class='match'>High<\/span> seats are best for football fans.<\/li>\n  <li><span class='match'>Tea<\/span> served from the brown jug is tasty.<\/li>\n  <li><span class='match'>A<\/span> dash of pepper spoils beef stew.<\/li>\n  <li><span class='match'>A<\/span> zestful food is the hot-cross bun.<\/li>\n  <li><span class='match'>The<\/span> horse trotted around the field at a brisk pace.<\/li>\n  <li><span class='match'>Find<\/span> the twin who stole the pearl necklace.<\/li>\n  <li><span class='match'>Cut<\/span> the cord that binds the box tightly.<\/li>\n  <li><span class='match'>The<\/span> red tape bound the smuggled food.<\/li>\n  <li><span class='match'>Look<\/span> in the corner to find the tan shirt.<\/li>\n  <li><span class='match'>The<\/span> cold drizzle will halt the bond drive.<\/li>\n  <li><span class='match'>Nine<\/span> men were hired to dig the ruins.<\/li>\n  <li><span class='match'>The<\/span> junk yard had a mouldy smell.<\/li>\n  <li><span class='match'>The<\/span> flint sputtered and lit a pine torch.<\/li>\n  <li><span class='match'>Soak<\/span> the cloth and drown the sharp odor.<\/li>\n  <li><span class='match'>The<\/span> shelves were bare of both jam or crackers.<\/li>\n  <li><span class='match'>A<\/span> joy to every child is the swan boat.<\/li>\n  <li><span class='match'>All<\/span> sat frozen and watched the screen.<\/li>\n  <li><span class='match'>ii<\/span> cloud of dust stung his tender eyes.<\/li>\n  <li><span class='match'>To<\/span> reach the end he needs much courage.<\/li>\n  <li><span class='match'>Shape<\/span> the clay gently into block form.<\/li>\n  <li><span class='match'>The<\/span> ridge on a smooth surface is a bump or flaw.<\/li>\n  <li><span class='match'>Hedge<\/span> apples may stain your hands green.<\/li>\n  <li><span class='match'>Quench<\/span> your thirst, then eat the crackers.<\/li>\n  <li><span class='match'>Tight<\/span> curls get limp on rainy days.<\/li>\n  <li><span class='match'>The<\/span> mute muffled the high tones of the horn.<\/li>\n  <li><span class='match'>The<\/span> gold ring fits only a pierced ear.<\/li>\n  <li><span class='match'>The<\/span> old pan was covered with hard fudge.<\/li>\n  <li><span class='match'>Watch<\/span> the log float in the wide river.<\/li>\n  <li><span class='match'>The<\/span> node on the stalk of wheat grew daily.<\/li>\n  <li><span class='match'>The<\/span> heap of fallen leaves was set on fire.<\/li>\n  <li><span class='match'>Write<\/span> fast, if you want to finish early.<\/li>\n  <li><span class='match'>His<\/span> shirt was clean but one button was gone.<\/li>\n  <li><span class='match'>The<\/span> barrel of beer was a brew of malt and hops.<\/li>\n  <li><span class='match'>Tin<\/span> cans are absent from store shelves.<\/li>\n  <li><span class='match'>Slide<\/span> the box into that empty space.<\/li>\n  <li><span class='match'>The<\/span> plant grew large and green in the window.<\/li>\n  <li><span class='match'>The<\/span> beam dropped down on the workmen's head.<\/li>\n  <li><span class='match'>Pink<\/span> clouds floated JTith the breeze.<\/li>\n  <li><span class='match'>She<\/span> danced like a swan, tall and graceful.<\/li>\n  <li><span class='match'>The<\/span> tube was blown and the tire flat and useless.<\/li>\n  <li><span class='match'>It<\/span> is late morning on the old wall clock.<\/li>\n  <li><span class='match'>Let<\/span>'s all join as we sing the last chorus.<\/li>\n  <li><span class='match'>The<\/span> last switch cannot be turned off.<\/li>\n  <li><span class='match'>The<\/span> fight will end in just six minutes.<\/li>\n  <li><span class='match'>The<\/span> store walls were lined with colored frocks.<\/li>\n  <li><span class='match'>The<\/span> peace league met to discuss their plans.<\/li>\n  <li><span class='match'>The<\/span> rise to fame of a person takes luck.<\/li>\n  <li><span class='match'>Paper<\/span> is scarce, so write with much care.<\/li>\n  <li><span class='match'>The<\/span> quick fox jumped on the sleeping cat.<\/li>\n  <li><span class='match'>The<\/span> nozzle of the fire hose was bright brass.<\/li>\n  <li><span class='match'>Screw<\/span> the round cap on as tight as needed.<\/li>\n  <li><span class='match'>Time<\/span> brings us many changes.<\/li>\n  <li><span class='match'>The<\/span> purple tie was ten years old.<\/li>\n  <li><span class='match'>Men<\/span> think and plan and sometimes act.<\/li>\n  <li><span class='match'>Fill<\/span> the ink jar with sticky glue.<\/li>\n  <li><span class='match'>He<\/span> smoke a big pipe with strong contents.<\/li>\n  <li><span class='match'>We<\/span> need grain to keep our mules healthy.<\/li>\n  <li><span class='match'>Pack<\/span> the records in a neat thin case.<\/li>\n  <li><span class='match'>The<\/span> crunch of feet in the snow was the only sound.<\/li>\n  <li><span class='match'>The<\/span> copper bowl shone in the sun's rays.<\/li>\n  <li><span class='match'>Boards<\/span> will warp unless kept dry.<\/li>\n  <li><span class='match'>The<\/span> plush chair leaned against the wall.<\/li>\n  <li><span class='match'>Glass<\/span> will clink when struck by metal.<\/li>\n  <li><span class='match'>Bathe<\/span> and relax in the cool green grass.<\/li>\n  <li><span class='match'>Nine<\/span> rows of soldiers stood in line.<\/li>\n  <li><span class='match'>The<\/span> beach is dry and shallow at low tide.<\/li>\n  <li><span class='match'>The<\/span> idea is to sew both edges straight.<\/li>\n  <li><span class='match'>The<\/span> kitten chased the dog down the street.<\/li>\n  <li><span class='match'>Pages<\/span> bound in cloth make a book.<\/li>\n  <li><span class='match'>Try<\/span> to trace the fine lines of the painting.<\/li>\n  <li><span class='match'>Women<\/span> form less than half of the group.<\/li>\n  <li><span class='match'>The<\/span> zones merge in the central part of town.<\/li>\n  <li><span class='match'>A<\/span> gem in the rough needs work to polish.<\/li>\n  <li><span class='match'>Code<\/span> is used when secrets are sent.<\/li>\n  <li><span class='match'>Most<\/span> of the new is easy for us to hear.<\/li>\n  <li><span class='match'>He<\/span> used the lathe to make brass objects.<\/li>\n  <li><span class='match'>The<\/span> vane on top of the pole revolved in the wind.<\/li>\n  <li><span class='match'>Mince<\/span> pie is a dish served to children.<\/li>\n  <li><span class='match'>The<\/span> clan gathered on each dull night.<\/li>\n  <li><span class='match'>Let<\/span> it burn, it gives us warmth and comfort.<\/li>\n  <li><span class='match'>A<\/span> castle built from sand fails to endure.<\/li>\n  <li><span class='match'>A<\/span> child's wit saved the day for us.<\/li>\n  <li><span class='match'>Tack<\/span> the strip of carpet to the worn floor.<\/li>\n  <li><span class='match'>Next<\/span> Tuesday we must vote.<\/li>\n  <li><span class='match'>Pour<\/span> the stew from the pot into the plate.<\/li>\n  <li><span class='match'>Each<\/span> penny shone like new.<\/li>\n  <li><span class='match'>The<\/span> man went to the woods to gather sticks.<\/li>\n  <li><span class='match'>The<\/span> dirt piles were lines along the road.<\/li>\n  <li><span class='match'>The<\/span> logs fell and tumbled into the clear stream.<\/li>\n  <li><span class='match'>Just<\/span> hoist it up and take it away,<\/li>\n  <li><span class='match'>A<\/span> ripe plum is fit for a king's palate.<\/li>\n  <li><span class='match'>Our<\/span> plans right now are hazy.<\/li>\n  <li><span class='match'>Brass<\/span> rings are sold by these natives.<\/li>\n  <li><span class='match'>It<\/span> takes a good trap to capture a bear.<\/li>\n  <li><span class='match'>Feed<\/span> the white mouse some flower seeds.<\/li>\n  <li><span class='match'>The<\/span> thaw came early and freed the stream.<\/li>\n  <li><span class='match'>He<\/span> took the lead and kept it the whole distance.<\/li>\n  <li><span class='match'>The<\/span> key you designed will fit the lock.<\/li>\n  <li><span class='match'>Plead<\/span> to the council to free the poor thief.<\/li>\n  <li><span class='match'>Better<\/span> hash is made of rare beef.<\/li>\n  <li><span class='match'>This<\/span> plank was made for walking on.<\/li>\n  <li><span class='match'>The<\/span> lake sparkled in the red hot sun.<\/li>\n  <li><span class='match'>He<\/span> crawled with care along the ledge.<\/li>\n  <li><span class='match'>Tend<\/span> the sheep while the dog wanders.<\/li>\n  <li><span class='match'>It<\/span> takes a lot of help to finish these.<\/li>\n  <li><span class='match'>Mark<\/span> the spot with a sign painted red.<\/li>\n  <li><span class='match'>Take<\/span> two shares as a fair profit.<\/li>\n  <li><span class='match'>The<\/span> fur of cats goes by many names.<\/li>\n  <li><span class='match'>North<\/span> winds bring colds and fevers.<\/li>\n  <li><span class='match'>He<\/span> asks no person to vouch for him.<\/li>\n  <li><span class='match'>Go<\/span> now and come here later.<\/li>\n  <li><span class='match'>A<\/span> sash of gold silk will trim her dress.<\/li>\n  <li><span class='match'>Soap<\/span> can wash most dirt away.<\/li>\n  <li><span class='match'>That<\/span> move means the game is over.<\/li>\n  <li><span class='match'>He<\/span> wrote down a long list of items.<\/li>\n  <li><span class='match'>A<\/span> siege will crack the strong defense.<\/li>\n  <li><span class='match'>Grape<\/span> juice and water mix well.<\/li>\n  <li><span class='match'>Roads<\/span> are paved with sticky tar.<\/li>\n  <li><span class='match'>Fake<\/span> &ones shine but cost little.<\/li>\n  <li><span class='match'>The<\/span> drip of the rain made a pleasant sound.<\/li>\n  <li><span class='match'>Smoke<\/span> poured out of every crack.<\/li>\n  <li><span class='match'>Serve<\/span> the hot rum to the tired heroes.<\/li>\n  <li><span class='match'>Much<\/span> of the story makes good sense.<\/li>\n  <li><span class='match'>The<\/span> sun came up to light the eastern sky.<\/li>\n  <li><span class='match'>Heave<\/span> the line over the port side.<\/li>\n  <li><span class='match'>A<\/span> lathe cuts and trims any wood.<\/li>\n  <li><span class='match'>It<\/span>'s a dense crowd in two distinct ways.<\/li>\n  <li><span class='match'>His<\/span> hip struck the knee of the next player.<\/li>\n  <li><span class='match'>The<\/span> stale smell of old beer lingers.<\/li>\n  <li><span class='match'>The<\/span> desk was firm on the shaky floor.<\/li>\n  <li><span class='match'>It<\/span> takes heat to bring out the odor.<\/li>\n  <li><span class='match'>Beef<\/span> is scarcer than some lamb.<\/li>\n  <li><span class='match'>Raise<\/span> the sail and steer the ship northward.<\/li>\n  <li><span class='match'>The<\/span> cone costs five cents on Mondays.<\/li>\n  <li><span class='match'>A<\/span> pod is what peas always grow in.<\/li>\n  <li><span class='match'>Jerk<\/span> the dart from the cork target.<\/li>\n  <li><span class='match'>No<\/span> cement will hold hard wood.<\/li>\n  <li><span class='match'>We<\/span> now have a new base for shipping.<\/li>\n  <li><span class='match'>The<\/span> list of names is carved around the base.<\/li>\n  <li><span class='match'>The<\/span> sheep were led home by a dog.<\/li>\n  <li><span class='match'>Three<\/span> for a dime, the young peddler cried.<\/li>\n  <li><span class='match'>The<\/span> sense of smell is better than that of touch.<\/li>\n  <li><span class='match'>No<\/span> hardship seemed to keep him sad.<\/li>\n  <li><span class='match'>Grace<\/span> makes up for lack of beauty.<\/li>\n  <li><span class='match'>Nudge<\/span> gently but wake her now.<\/li>\n  <li><span class='match'>The<\/span> news struck doubt into restless minds.<\/li>\n  <li><span class='match'>Once<\/span> we stood beside the shore.<\/li>\n  <li><span class='match'>A<\/span> chink in the wall allowed a draft to blow.<\/li>\n  <li><span class='match'>Fasten<\/span> two pins on each side.<\/li>\n  <li><span class='match'>A<\/span> cold dip restores health and zest.<\/li>\n  <li><span class='match'>He<\/span> takes the oath of office each March.<\/li>\n  <li><span class='match'>The<\/span> sand drifts over the sill of the old house.<\/li>\n  <li><span class='match'>The<\/span> point of the steel pen was bent and twisted.<\/li>\n  <li><span class='match'>There<\/span> is a lag between thought and act.<\/li>\n  <li><span class='match'>Seed<\/span> is needed to plant the spring corn.<\/li>\n  <li><span class='match'>Draw<\/span> the chart with heavy black lines.<\/li>\n  <li><span class='match'>The<\/span> boy owed his pal thirty cents.<\/li>\n  <li><span class='match'>The<\/span> chap slipped into the crowd and was lost.<\/li>\n  <li><span class='match'>Hats<\/span> are worn to tea and not to dinner.<\/li>\n  <li><span class='match'>The<\/span> ramp led up to the wide highway.<\/li>\n  <li><span class='match'>Beat<\/span> the dust from the rug onto the lawn.<\/li>\n  <li><span class='match'>Say<\/span> it slow!y but make it ring clear.<\/li>\n  <li><span class='match'>The<\/span> straw nest housed five robins.<\/li>\n  <li><span class='match'>Screen<\/span> the porch with woven straw mats.<\/li>\n  <li><span class='match'>This<\/span> horse will nose his way to the finish.<\/li>\n  <li><span class='match'>The<\/span> dry wax protects the deep scratch.<\/li>\n  <li><span class='match'>He<\/span> picked up the dice for a second roll.<\/li>\n  <li><span class='match'>These<\/span> coins will be needed to pay his debt.<\/li>\n  <li><span class='match'>The<\/span> nag pulled the frail cart along.<\/li>\n  <li><span class='match'>Twist<\/span> the valve and release hot steam.<\/li>\n  <li><span class='match'>The<\/span> vamp of the shoe had a gold buckle.<\/li>\n  <li><span class='match'>The<\/span> smell of burned rags itches my nose.<\/li>\n  <li><span class='match'>Xew<\/span> pants lack cuffs and pockets.<\/li>\n  <li><span class='match'>The<\/span> marsh will freeze when cold enough.<\/li>\n  <li><span class='match'>They<\/span> slice the sausage thin with a knife.<\/li>\n  <li><span class='match'>The<\/span> bloom of the rose lasts a few days.<\/li>\n  <li><span class='match'>A<\/span> gray mare walked before the colt.<\/li>\n  <li><span class='match'>Breakfast<\/span> buns are fine with a hot drink.<\/li>\n  <li><span class='match'>Bottles<\/span> hold four kinds of rum.<\/li>\n  <li><span class='match'>The<\/span> man wore a feather in his felt hat.<\/li>\n  <li><span class='match'>He<\/span> wheeled the bike past. the winding road.<\/li>\n  <li><span class='match'>Drop<\/span> the ashes on the worn old rug.<\/li>\n  <li><span class='match'>The<\/span> desk and both chairs were painted tan.<\/li>\n  <li><span class='match'>Throw<\/span> out the used paper cup and plate.<\/li>\n  <li><span class='match'>A<\/span> clean neck means a neat collar.<\/li>\n  <li><span class='match'>The<\/span> couch cover and hall drapes were blue.<\/li>\n  <li><span class='match'>The<\/span> stems of the tall glasses cracked and broke.<\/li>\n  <li><span class='match'>The<\/span> wall phone rang loud and often.<\/li>\n  <li><span class='match'>The<\/span> clothes dried on a thin wooden rack.<\/li>\n  <li><span class='match'>Turn<\/span> on the lantern which gives us light.<\/li>\n  <li><span class='match'>The<\/span> cleat sank deeply into the soft turf.<\/li>\n  <li><span class='match'>The<\/span> bills were mailed promptly on the tenth of the month.<\/li>\n  <li><span class='match'>To<\/span> have is better than to wait and hope.<\/li>\n  <li><span class='match'>The<\/span> price is fair for a good antique clock.<\/li>\n  <li><span class='match'>The<\/span> music played on while they talked.<\/li>\n  <li><span class='match'>Dispense<\/span> with a vest on a day like this.<\/li>\n  <li><span class='match'>The<\/span> bunch of grapes was pressed into wine.<\/li>\n  <li><span class='match'>He<\/span> sent the figs, but kept the ripe cherries.<\/li>\n  <li><span class='match'>The<\/span> hinge on the door creaked with old age.<\/li>\n  <li><span class='match'>The<\/span> screen before the fire kept in the sparks.<\/li>\n  <li><span class='match'>Fly<\/span> by night, and you waste little time.<\/li>\n  <li><span class='match'>Thick<\/span> glasses helped him read the print.<\/li>\n  <li><span class='match'>Birth<\/span> and death mark the limits of life.<\/li>\n  <li><span class='match'>The<\/span> chair looked strong but had no bottom.<\/li>\n  <li><span class='match'>The<\/span> kite flew wildly in the high wind.<\/li>\n  <li><span class='match'>A<\/span> fur muff is stylish once more.<\/li>\n  <li><span class='match'>The<\/span> tin box held priceless stones.<\/li>\n  <li><span class='match'>We<\/span> need an end of all such matter.<\/li>\n  <li><span class='match'>The<\/span> case was puzzling to the old and wise.<\/li>\n  <li><span class='match'>The<\/span> bright lanterns were gay on the dark lawn.<\/li>\n  <li><span class='match'>We<\/span> don't get much money but we have fun.<\/li>\n  <li><span class='match'>The<\/span> youth drove with zest, but little skill.<\/li>\n  <li><span class='match'>Five<\/span> years he lived with a shaggy dog.<\/li>\n  <li><span class='match'>A<\/span> fence cuts through the corner lot.<\/li>\n  <li><span class='match'>The<\/span> way to save money is not to spend much.<\/li>\n  <li><span class='match'>Shut<\/span> the hatch before the waves push it in.<\/li>\n  <li><span class='match'>The<\/span> odor of spring makes young hearts jump.<\/li>\n  <li><span class='match'>Crack<\/span> the walnut with your sharp side teeth.<\/li>\n  <li><span class='match'>He<\/span> offered proof in the form of a lsrge chart.<\/li>\n  <li><span class='match'>Send<\/span> the stuff in a thick paper bag.<\/li>\n  <li><span class='match'>A<\/span> quart of milk is water for the most part.<\/li>\n  <li><span class='match'>They<\/span> told wild tales to frighten him.<\/li>\n  <li><span class='match'>The<\/span> three story house was built of stone.<\/li>\n  <li><span class='match'>In<\/span> the rear of the ground floor was a large passage.<\/li>\n  <li><span class='match'>A<\/span> man in a blue sweater sat at the desk.<\/li>\n  <li><span class='match'>Oats<\/span> are a food eaten by horse and man.<\/li>\n  <li><span class='match'>Their<\/span> eyelids droop for want. of sleep.<\/li>\n  <li><span class='match'>The<\/span> sip of tea revives his tired friend.<\/li>\n  <li><span class='match'>There<\/span> are many ways to do these things.<\/li>\n  <li><span class='match'>Tuck<\/span> the sheet under the edge of the mat.<\/li>\n  <li><span class='match'>A<\/span> force equal to that would move the earth.<\/li>\n  <li><span class='match'>We<\/span> like to see clear weather.<\/li>\n  <li><span class='match'>The<\/span> work of the tailor is seen on each side.<\/li>\n  <li><span class='match'>Take<\/span> a chance and win a china doll.<\/li>\n  <li><span class='match'>Shake<\/span> the dust from your shoes, stranger.<\/li>\n  <li><span class='match'>She<\/span> was kind to sick old people.<\/li>\n  <li><span class='match'>The<\/span> dusty bench stood by the stone wall.<\/li>\n  <li><span class='match'>The<\/span> square wooden crate was packed to be shipped.<\/li>\n  <li><span class='match'>We<\/span> dress to suit the weather of most days.<\/li>\n  <li><span class='match'>Smile<\/span> when you say nasty words.<\/li>\n  <li><span class='match'>A<\/span> bowl of rice is free with chicken stew.<\/li>\n  <li><span class='match'>The<\/span> water in this well is a source of good health.<\/li>\n  <li><span class='match'>Take<\/span> shelter in this tent, but keep still.<\/li>\n  <li><span class='match'>That<\/span> guy is the writer of a few banned books.<\/li>\n  <li><span class='match'>The<\/span> little tales they tell are false.<\/li>\n  <li><span class='match'>The<\/span> door was barred, locked, and bolted as well.<\/li>\n  <li><span class='match'>Ripe<\/span> pears are fit for a queen's table.<\/li>\n  <li><span class='match'>A<\/span> big wet stain was on the round carpet.<\/li>\n  <li><span class='match'>The<\/span> kite dipped and swayed, but stayed aloft.<\/li>\n  <li><span class='match'>The<\/span> pleasant hours fly by much too soon.<\/li>\n  <li><span class='match'>The<\/span> room was crowded with a wild mob.<\/li>\n  <li><span class='match'>This<\/span> strong arm shall shield your honor.<\/li>\n  <li><span class='match'>She<\/span> blushed when he gave her a white orchid.<\/li>\n  <li><span class='match'>The<\/span> beetle droned in the hot June sun.<\/li>\n  <li><span class='match'>Press<\/span> the pedal with your left foot.<\/li>\n  <li><span class='match'>Neat<\/span> plans fail without luck.<\/li>\n  <li><span class='match'>The<\/span> black trunk fell from the landing.<\/li>\n  <li><span class='match'>The<\/span> bank pressed for payment of the debt.<\/li>\n  <li><span class='match'>The<\/span> theft of the pearl pin was kept secret.<\/li>\n  <li><span class='match'>Shake<\/span> hands with this friendly child.<\/li>\n  <li><span class='match'>The<\/span> vast space stretched into the far distance.<\/li>\n  <li><span class='match'>A<\/span> rich farm is rare in this sandy waste.<\/li>\n  <li><span class='match'>His<\/span> wide grin earned many friends.<\/li>\n  <li><span class='match'>Flax<\/span> makes a fine brand of paper.<\/li>\n  <li><span class='match'>Hurdle<\/span> the pit with the aid of a long pole.<\/li>\n  <li><span class='match'>A<\/span> strong bid may scare your partner stiff.<\/li>\n  <li><span class='match'>Even<\/span> a just cause needs power to win.<\/li>\n  <li><span class='match'>Peep<\/span> under the tent and see the clowns.<\/li>\n  <li><span class='match'>The<\/span> leaf drifts along with a slow spin.<\/li>\n  <li><span class='match'>Cheap<\/span> clothes are flashy but don??????t last.<\/li>\n  <li><span class='match'>A<\/span> thing of small note can cause despair.<\/li>\n  <li><span class='match'>Flood<\/span> the mails with requests for this book.<\/li>\n  <li><span class='match'>A<\/span> thick coat of black paint covered all.<\/li>\n  <li><span class='match'>The<\/span> pencil was cut to be sharp at both ends.<\/li>\n  <li><span class='match'>Those<\/span> last words were a strong statement.<\/li>\n  <li><span class='match'>He<\/span> wrote his name boldly at the top of tile sheet.<\/li>\n  <li><span class='match'>Dill<\/span> pickles are sour but taste fine.<\/li>\n  <li><span class='match'>Down<\/span> that road is the way to the grain farmer.<\/li>\n  <li><span class='match'>Either<\/span> mud or dust are found at all times.<\/li>\n  <li><span class='match'>The<\/span> best method is to fix it in place with clips.<\/li>\n  <li><span class='match'>If<\/span> you mumble your speech will be lost.<\/li>\n  <li><span class='match'>At<\/span> night the alarm roused him from a deep sleep.<\/li>\n  <li><span class='match'>Read<\/span> just what the meter says.<\/li>\n  <li><span class='match'>Fill<\/span> your pack with bright trinkets for the poor.<\/li>\n  <li><span class='match'>The<\/span> small red neon lamp went out.<\/li>\n  <li><span class='match'>Clams<\/span> are small, round, soft, and tasty.<\/li>\n  <li><span class='match'>The<\/span> fan whirled its round blades softly.<\/li>\n  <li><span class='match'>The<\/span> line where the edges join was clean.<\/li>\n  <li><span class='match'>Breathe<\/span> deep and smell the piny air.<\/li>\n  <li><span class='match'>It<\/span> matters not if he reads these words or those.<\/li>\n  <li><span class='match'>A<\/span> brown leather bag hung from its strap.<\/li>\n  <li><span class='match'>A<\/span> toad and a frog are hard to tell apart.<\/li>\n  <li><span class='match'>A<\/span> white silk jacket goes with any shoes.<\/li>\n  <li><span class='match'>A<\/span> break in the dam almost caused a flood.<\/li>\n  <li><span class='match'>Paint<\/span> the sockets in the wall dull green.<\/li>\n  <li><span class='match'>The<\/span> child crawled into the dense grass.<\/li>\n  <li><span class='match'>Bribes<\/span> fail where honest men work.<\/li>\n  <li><span class='match'>Trample<\/span> the spark, else the flames will spread.<\/li>\n  <li><span class='match'>The<\/span> hilt. of the sword was carved with fine designs.<\/li>\n  <li><span class='match'>A<\/span> round hole was drilled through the thin board.<\/li>\n  <li><span class='match'>Footprints<\/span> showed the path he took up the beach.<\/li>\n  <li><span class='match'>She<\/span> was waiting at my front lawn.<\/li>\n  <li><span class='match'>A<\/span> vent near the edge brought in fresh air.<\/li>\n  <li><span class='match'>Prod<\/span> the old mule with a crooked stick.<\/li>\n  <li><span class='match'>It<\/span> is a band of steel three inches wide.<\/li>\n  <li><span class='match'>The<\/span> pipe ran almost the length of the ditch.<\/li>\n  <li><span class='match'>It<\/span> was hidden from sight by a mass of leaves and shrubs.<\/li>\n  <li><span class='match'>The<\/span> weight. of the package was seen on the high scale.<\/li>\n  <li><span class='match'>Wake<\/span> and rise, and step into the green outdoors.<\/li>\n  <li><span class='match'>The<\/span> green light in the brown box flickered.<\/li>\n  <li><span class='match'>The<\/span> brass tube circled the high wall.<\/li>\n  <li><span class='match'>The<\/span> lobes of her ears were pierced to hold rings.<\/li>\n  <li><span class='match'>Hold<\/span> the hammer near the end to drive the nail.<\/li>\n  <li><span class='match'>Next<\/span> Sunday is the twelfth of the month.<\/li>\n  <li><span class='match'>Every<\/span> word and phrase he speaks is true.<\/li>\n  <li><span class='match'>He<\/span> put his last cartridge into the gun and fired.<\/li>\n  <li><span class='match'>They<\/span> took their kids from the public school.<\/li>\n  <li><span class='match'>Drive<\/span> the screw straight into the wood.<\/li>\n  <li><span class='match'>Keep<\/span> the hatch tight and the watch constant.<\/li>\n  <li><span class='match'>Sever<\/span> the twine with a quick snip of the knife.<\/li>\n  <li><span class='match'>Paper<\/span> will dry out when wet.<\/li>\n  <li><span class='match'>Slide<\/span> the catch back and open the desk.<\/li>\n  <li><span class='match'>Help<\/span> the weak to preserve their strength.<\/li>\n  <li><span class='match'>A<\/span> sullen smile gets few friends.<\/li>\n  <li><span class='match'>Stop<\/span> whistling and watch the boys march.<\/li>\n  <li><span class='match'>Jerk<\/span> the cord, and out tumbles the gold.<\/li>\n  <li><span class='match'>Slidc<\/span> the tray across the glass top.<\/li>\n  <li><span class='match'>The<\/span> cloud moved in a stately way and was gone.<\/li>\n  <li><span class='match'>Light<\/span> maple makes for a swell room.<\/li>\n  <li><span class='match'>Set<\/span> the piece here and say nothing.<\/li>\n  <li><span class='match'>Dull<\/span> stories make her laugh.<\/li>\n  <li><span class='match'>A<\/span> stiff cord will do to fasten your shoe.<\/li>\n  <li><span class='match'>Get<\/span> the trust fund to the bank early.<\/li>\n  <li><span class='match'>Choose<\/span> between the high road and the low.<\/li>\n  <li><span class='match'>A<\/span> plea for funds seems to come again.<\/li>\n  <li><span class='match'>He<\/span> lent his coat to the tall gaunt stranger.<\/li>\n  <li><span class='match'>There<\/span> is a strong chance it will happen once more.<\/li>\n  <li><span class='match'>The<\/span> duke left the park in a silver coach.<\/li>\n  <li><span class='match'>Greet<\/span> the new guests and leave quickly.<\/li>\n  <li><span class='match'>When<\/span> the frost has come it is time for turkey.<\/li>\n  <li><span class='match'>Sweet<\/span> words work better than fierce.<\/li>\n  <li><span class='match'>A<\/span> thin stripe runs down the middle.<\/li>\n  <li><span class='match'>A<\/span> six comes up more often than a ten.<\/li>\n  <li><span class='match'>Lush<\/span> fern grow on the lofty rocks.<\/li>\n  <li><span class='match'>The<\/span> ram scared the school children off.<\/li>\n  <li><span class='match'>The<\/span> team with the best timing looks good.<\/li>\n  <li><span class='match'>The<\/span> farmer swapped his horse for a brown ox.<\/li>\n  <li><span class='match'>Sit<\/span> on the perch and tell the others what to do.<\/li>\n  <li><span class='match'>A<\/span> steep trail is painful for our feet.<\/li>\n  <li><span class='match'>The<\/span> early phase of life moves fast.<\/li>\n  <li><span class='match'>Green<\/span> moss grows on the northern side.<\/li>\n  <li><span class='match'>Tea<\/span> in thin china has a sweet taste.<\/li>\n  <li><span class='match'>Pitch<\/span> the straw through the door of the stable.<\/li>\n  <li><span class='match'>The<\/span> latch on the beck gate needed a nail.<\/li>\n  <li><span class='match'>The<\/span> goose was brought straight from the old market.<\/li>\n  <li><span class='match'>The<\/span> sink is the thing in which we pile dishes.<\/li>\n  <li><span class='match'>A<\/span> whiff of it will cure the most stubborn cold.<\/li>\n  <li><span class='match'>The<\/span> facts dont always show who is right.<\/li>\n  <li><span class='match'>She<\/span> flaps her cape as she parades the street.<\/li>\n  <li><span class='match'>The<\/span> loss of the cruiser was a blow to the fleet.<\/li>\n  <li><span class='match'>Loop<\/span> the braid to the left and then over.<\/li>\n  <li><span class='match'>Plead<\/span> with the lawyer to drop the lost cause.<\/li>\n  <li><span class='match'>Calves<\/span> thrive on tender spring grass.<\/li>\n  <li><span class='match'>Post<\/span> no bills on this office wall.<\/li>\n  <li><span class='match'>Tear<\/span> a thin sheet from the yellow pad.<\/li>\n  <li><span class='match'>A<\/span> cruise in warm waters in a sleek yacht is fun.<\/li>\n  <li><span class='match'>A<\/span> streak of color ran down the left edge.<\/li>\n  <li><span class='match'>It<\/span> was done before the boy could see it.<\/li>\n  <li><span class='match'>Crouch<\/span> before you jump or miss the mark.<\/li>\n  <li><span class='match'>Pack<\/span> the kits and dont forget the salt.<\/li>\n  <li><span class='match'>The<\/span> square peg will settle in the round hole.<\/li>\n  <li><span class='match'>Fine<\/span> soap saves tender skin.<\/li>\n  <li><span class='match'>Poached<\/span> eggs and tea must suffice.<\/li>\n  <li><span class='match'>Bad<\/span> nerves are jangled by a door slam.<\/li>\n  <li><span class='match'>Ship<\/span> maps are different from those for planes.<\/li>\n  <li><span class='match'>Dimes<\/span> showered down from all sides.<\/li>\n  <li><span class='match'>They<\/span> sang the same tunes at each party.<\/li>\n  <li><span class='match'>The<\/span> sky in the west is tinged with orange red.<\/li>\n  <li><span class='match'>The<\/span> pods of peas ferment in bare fields.<\/li>\n  <li><span class='match'>The<\/span> horse balked and threw the tall rider.<\/li>\n  <li><span class='match'>The<\/span> hitch between the horse and cart broke.<\/li>\n  <li><span class='match'>Pile<\/span> the coal high in the shed corner.<\/li>\n  <li><span class='match'>The<\/span> gold vase is both rare and costly.<\/li>\n  <li><span class='match'>The<\/span> knife was hung inside its bright sheath.<\/li>\n  <li><span class='match'>The<\/span> rarest spice comes from the far East.<\/li>\n  <li><span class='match'>The<\/span> roof should be tilted at a sharp slant.<\/li>\n  <li><span class='match'>A<\/span> smatter of French is worse than none.<\/li>\n  <li><span class='match'>The<\/span> mule trod the treadmill day and night.<\/li>\n  <li><span class='match'>The<\/span> aim of the contest is to raise a great fund.<\/li>\n  <li><span class='match'>To<\/span> send it. now in large amounts is bad.<\/li>\n  <li><span class='match'>There<\/span> is a fine hard tang in salty air.<\/li>\n  <li><span class='match'>Cod<\/span> is the main business of the north shore.<\/li>\n  <li><span class='match'>The<\/span> slab was hewn from heavy blocks of slate.<\/li>\n  <li><span class='match'>Dunk<\/span> the stale biscuits into strong drink.<\/li>\n  <li><span class='match'>Hang<\/span> tinsel from both branches.<\/li>\n  <li><span class='match'>Cap<\/span> the jar with a tight brass cover.<\/li>\n  <li><span class='match'>The<\/span> poor boy missed the boat again.<\/li>\n  <li><span class='match'>Be<\/span> sure to set the lamp firmly in the hole.<\/li>\n  <li><span class='match'>Pick<\/span> a card and slip it. under the pack.<\/li>\n  <li><span class='match'>A<\/span> round mat will cover the dull spot.<\/li>\n  <li><span class='match'>The<\/span> first part of the plan needs changing.<\/li>\n  <li><span class='match'>The<\/span> good book informs of what we ought to know.<\/li>\n  <li><span class='match'>The<\/span> mail comes in three batches per day.<\/li>\n  <li><span class='match'>You<\/span> cannot brew tea in a cold pot.<\/li>\n  <li><span class='match'>Dots<\/span> of light betrayed the black cat.<\/li>\n  <li><span class='match'>Put<\/span> the chart on the mantel and tack it down.<\/li>\n  <li><span class='match'>The<\/span> night shift men rate extra pay.<\/li>\n  <li><span class='match'>The<\/span> red paper brightened the dim stage.<\/li>\n  <li><span class='match'>See<\/span> the player scoot to third base.<\/li>\n  <li><span class='match'>Slide<\/span> the bill between the two leaves.<\/li>\n  <li><span class='match'>Many<\/span> hands help get the job done.<\/li>\n  <li><span class='match'>We<\/span> don't like to admit our small faults.<\/li>\n  <li><span class='match'>No<\/span> doubt about the way the wind blows.<\/li>\n  <li><span class='match'>Dig<\/span> deep in the earth for pirate's gold.<\/li>\n  <li><span class='match'>The<\/span> steady drip is worse than a drenching rain.<\/li>\n  <li><span class='match'>A<\/span> flat pack takes less luggage space.<\/li>\n  <li><span class='match'>Green<\/span> ice frosted the punch bowl.<\/li>\n  <li><span class='match'>A<\/span> stuffed chair slipped from the moving van.<\/li>\n  <li><span class='match'>The<\/span> stitch will serve but needs to be shortened.<\/li>\n  <li><span class='match'>A<\/span> thin book fits in the side pocket.<\/li>\n  <li><span class='match'>The<\/span> gloss on top made it unfit to read.<\/li>\n  <li><span class='match'>The<\/span> hail pattered on the burnt brown grass.<\/li>\n  <li><span class='match'>Seven<\/span> seals were stamped on great sheets.<\/li>\n  <li><span class='match'>Our<\/span> troops are set to strike heavy blows.<\/li>\n  <li><span class='match'>The<\/span> store was jammed before the sale could start.<\/li>\n  <li><span class='match'>It<\/span> was a bad error on the part of the new judge.<\/li>\n  <li><span class='match'>One<\/span> step more and the board will collapse.<\/li>\n  <li><span class='match'>Take<\/span> the match and strike it against your shoe.<\/li>\n  <li><span class='match'>The<\/span> pot boiled, but the contents failed to jell.<\/li>\n  <li><span class='match'>The<\/span> baby puts his right foot in his mouth.<\/li>\n  <li><span class='match'>The<\/span> bombs left most of the town in ruins.<\/li>\n  <li><span class='match'>Stop<\/span> and stare at the hard working man.<\/li>\n  <li><span class='match'>The<\/span> streets are narrow and full of sharp turns.<\/li>\n  <li><span class='match'>The<\/span> pup jerked the leash as he saw a feline shape.<\/li>\n  <li><span class='match'>Open<\/span> your book to the first page.<\/li>\n  <li><span class='match'>Fish<\/span> evade the net, and swim off.<\/li>\n  <li><span class='match'>Dip<\/span> the pail once and let it settle.<\/li>\n  <li><span class='match'>Will<\/span> you please answer that phone.<\/li>\n  <li><span class='match'>The<\/span> big red apple fell to the ground.<\/li>\n  <li><span class='match'>The<\/span> curtain rose and the show was on.<\/li>\n  <li><span class='match'>The<\/span> young prince became heir to the throne.<\/li>\n  <li><span class='match'>He<\/span> sent the boy on a short errand.<\/li>\n  <li><span class='match'>Leave<\/span> now and you will arrive on time.<\/li>\n  <li><span class='match'>The<\/span> corner store was robbed last night.<\/li>\n  <li><span class='match'>A<\/span> gold ring will please most any girl.<\/li>\n  <li><span class='match'>The<\/span> long journey home took a year.<\/li>\n  <li><span class='match'>She<\/span> saw a cat in the neighbor's house.<\/li>\n  <li><span class='match'>A<\/span> pink shell was found on the sandy beach.<\/li>\n  <li><span class='match'>Small<\/span> children came to see him.<\/li>\n  <li><span class='match'>The<\/span> grass and bushes were wet with dew.<\/li>\n  <li><span class='match'>The<\/span> blind man counted his old coins.<\/li>\n  <li><span class='match'>A<\/span> severe storm tore down the barn.<\/li>\n  <li><span class='match'>She<\/span> called his name many times.<\/li>\n  <li><span class='match'>When<\/span> you hear the bell, come quickly.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Но у меня возникли сомнения по поводу конструкции <code>It's</code> — это одно слово или два? Кроме того бывают слова написанные через дефис, например название города <code>Baden-Baden</code>. Поэтому я решил действовать навярняка — я буду брать конструкцию целиком до первого пробела.</p>
<div class="sourceCode" id="cb1157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1157-1" data-line-number="1"><span class="kw">str_view</span>(sentences, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">S+&quot;</span>) <span class="co"># найти один или более не пробельных символов</span></a></code></pre></div>
<div id="htmlwidget-14b8b6c52a790fdf5c82" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-14b8b6c52a790fdf5c82">{"x":{"html":"<ul>\n  <li><span class='match'>The<\/span> birch canoe slid on the smooth planks.<\/li>\n  <li><span class='match'>Glue<\/span> the sheet to the dark blue background.<\/li>\n  <li><span class='match'>It's<\/span> easy to tell the depth of a well.<\/li>\n  <li><span class='match'>These<\/span> days a chicken leg is a rare dish.<\/li>\n  <li><span class='match'>Rice<\/span> is often served in round bowls.<\/li>\n  <li><span class='match'>The<\/span> juice of lemons makes fine punch.<\/li>\n  <li><span class='match'>The<\/span> box was thrown beside the parked truck.<\/li>\n  <li><span class='match'>The<\/span> hogs were fed chopped corn and garbage.<\/li>\n  <li><span class='match'>Four<\/span> hours of steady work faced us.<\/li>\n  <li><span class='match'>Large<\/span> size in stockings is hard to sell.<\/li>\n  <li><span class='match'>The<\/span> boy was there when the sun rose.<\/li>\n  <li><span class='match'>A<\/span> rod is used to catch pink salmon.<\/li>\n  <li><span class='match'>The<\/span> source of the huge river is the clear spring.<\/li>\n  <li><span class='match'>Kick<\/span> the ball straight and follow through.<\/li>\n  <li><span class='match'>Help<\/span> the woman get back to her feet.<\/li>\n  <li><span class='match'>A<\/span> pot of tea helps to pass the evening.<\/li>\n  <li><span class='match'>Smoky<\/span> fires lack flame and heat.<\/li>\n  <li><span class='match'>The<\/span> soft cushion broke the man's fall.<\/li>\n  <li><span class='match'>The<\/span> salt breeze came across from the sea.<\/li>\n  <li><span class='match'>The<\/span> girl at the booth sold fifty bonds.<\/li>\n  <li><span class='match'>The<\/span> small pup gnawed a hole in the sock.<\/li>\n  <li><span class='match'>The<\/span> fish twisted and turned on the bent hook.<\/li>\n  <li><span class='match'>Press<\/span> the pants and sew a button on the vest.<\/li>\n  <li><span class='match'>The<\/span> swan dive was far short of perfect.<\/li>\n  <li><span class='match'>The<\/span> beauty of the view stunned the young boy.<\/li>\n  <li><span class='match'>Two<\/span> blue fish swam in the tank.<\/li>\n  <li><span class='match'>Her<\/span> purse was full of useless trash.<\/li>\n  <li><span class='match'>The<\/span> colt reared and threw the tall rider.<\/li>\n  <li><span class='match'>It<\/span> snowed, rained, and hailed the same morning.<\/li>\n  <li><span class='match'>Read<\/span> verse out loud for pleasure.<\/li>\n  <li><span class='match'>Hoist<\/span> the load to your left shoulder.<\/li>\n  <li><span class='match'>Take<\/span> the winding path to reach the lake.<\/li>\n  <li><span class='match'>Note<\/span> closely the size of the gas tank.<\/li>\n  <li><span class='match'>Wipe<\/span> the grease off his dirty face.<\/li>\n  <li><span class='match'>Mend<\/span> the coat before you go out.<\/li>\n  <li><span class='match'>The<\/span> wrist was badly strained and hung limp.<\/li>\n  <li><span class='match'>The<\/span> stray cat gave birth to kittens.<\/li>\n  <li><span class='match'>The<\/span> young girl gave no clear response.<\/li>\n  <li><span class='match'>The<\/span> meal was cooked before the bell rang.<\/li>\n  <li><span class='match'>What<\/span> joy there is in living.<\/li>\n  <li><span class='match'>A<\/span> king ruled the state in the early days.<\/li>\n  <li><span class='match'>The<\/span> ship was torn apart on the sharp reef.<\/li>\n  <li><span class='match'>Sickness<\/span> kept him home the third week.<\/li>\n  <li><span class='match'>The<\/span> wide road shimmered in the hot sun.<\/li>\n  <li><span class='match'>The<\/span> lazy cow lay in the cool grass.<\/li>\n  <li><span class='match'>Lift<\/span> the square stone over the fence.<\/li>\n  <li><span class='match'>The<\/span> rope will bind the seven books at once.<\/li>\n  <li><span class='match'>Hop<\/span> over the fence and plunge in.<\/li>\n  <li><span class='match'>The<\/span> friendly gang left the drug store.<\/li>\n  <li><span class='match'>Mesh<\/span> mire keeps chicks inside.<\/li>\n  <li><span class='match'>The<\/span> frosty air passed through the coat.<\/li>\n  <li><span class='match'>The<\/span> crooked maze failed to fool the mouse.<\/li>\n  <li><span class='match'>Adding<\/span> fast leads to wrong sums.<\/li>\n  <li><span class='match'>The<\/span> show was a flop from the very start.<\/li>\n  <li><span class='match'>A<\/span> saw is a tool used for making boards.<\/li>\n  <li><span class='match'>The<\/span> wagon moved on well oiled wheels.<\/li>\n  <li><span class='match'>March<\/span> the soldiers past the next hill.<\/li>\n  <li><span class='match'>A<\/span> cup of sugar makes sweet fudge.<\/li>\n  <li><span class='match'>Place<\/span> a rosebush near the porch steps.<\/li>\n  <li><span class='match'>Both<\/span> lost their lives in the raging storm.<\/li>\n  <li><span class='match'>We<\/span> talked of the slide show in the circus.<\/li>\n  <li><span class='match'>Use<\/span> a pencil to write the first draft.<\/li>\n  <li><span class='match'>He<\/span> ran half way to the hardware store.<\/li>\n  <li><span class='match'>The<\/span> clock struck to mark the third period.<\/li>\n  <li><span class='match'>A<\/span> small creek cut across the field.<\/li>\n  <li><span class='match'>Cars<\/span> and busses stalled in snow drifts.<\/li>\n  <li><span class='match'>The<\/span> set of china hit, the floor with a crash.<\/li>\n  <li><span class='match'>This<\/span> is a grand season for hikes on the road.<\/li>\n  <li><span class='match'>The<\/span> dune rose from the edge of the water.<\/li>\n  <li><span class='match'>Those<\/span> words were the cue for the actor to leave.<\/li>\n  <li><span class='match'>A<\/span> yacht slid around the point into the bay.<\/li>\n  <li><span class='match'>The<\/span> two met while playing on the sand.<\/li>\n  <li><span class='match'>The<\/span> ink stain dried on the finished page.<\/li>\n  <li><span class='match'>The<\/span> walled town was seized without a fight.<\/li>\n  <li><span class='match'>The<\/span> lease ran out in sixteen weeks.<\/li>\n  <li><span class='match'>A<\/span> tame squirrel makes a nice pet.<\/li>\n  <li><span class='match'>The<\/span> horn of the car woke the sleeping cop.<\/li>\n  <li><span class='match'>The<\/span> heart beat strongly and with firm strokes.<\/li>\n  <li><span class='match'>The<\/span> pearl was worn in a thin silver ring.<\/li>\n  <li><span class='match'>The<\/span> fruit peel was cut in thick slices.<\/li>\n  <li><span class='match'>The<\/span> Navy attacked the big task force.<\/li>\n  <li><span class='match'>See<\/span> the cat glaring at the scared mouse.<\/li>\n  <li><span class='match'>There<\/span> are more than two factors here.<\/li>\n  <li><span class='match'>The<\/span> hat brim was wide and too droopy.<\/li>\n  <li><span class='match'>The<\/span> lawyer tried to lose his case.<\/li>\n  <li><span class='match'>The<\/span> grass curled around the fence post.<\/li>\n  <li><span class='match'>Cut<\/span> the pie into large parts.<\/li>\n  <li><span class='match'>Men<\/span> strive but seldom get rich.<\/li>\n  <li><span class='match'>Always<\/span> close the barn door tight.<\/li>\n  <li><span class='match'>He<\/span> lay prone and hardly moved a limb.<\/li>\n  <li><span class='match'>The<\/span> slush lay deep along the street.<\/li>\n  <li><span class='match'>A<\/span> wisp of cloud hung in the blue air.<\/li>\n  <li><span class='match'>A<\/span> pound of sugar costs more than eggs.<\/li>\n  <li><span class='match'>The<\/span> fin was sharp and cut the clear water.<\/li>\n  <li><span class='match'>The<\/span> play seems dull and quite stupid.<\/li>\n  <li><span class='match'>Bail<\/span> the boat, to stop it from sinking.<\/li>\n  <li><span class='match'>The<\/span> term ended in late June that year.<\/li>\n  <li><span class='match'>A<\/span> tusk is used to make costly gifts.<\/li>\n  <li><span class='match'>Ten<\/span> pins were set in order.<\/li>\n  <li><span class='match'>The<\/span> bill as paid every third week.<\/li>\n  <li><span class='match'>Oak<\/span> is strong and also gives shade.<\/li>\n  <li><span class='match'>Cats<\/span> and dogs each hate the other.<\/li>\n  <li><span class='match'>The<\/span> pipe began to rust while new.<\/li>\n  <li><span class='match'>Open<\/span> the crate but don't break the glass.<\/li>\n  <li><span class='match'>Add<\/span> the sum to the product of these three.<\/li>\n  <li><span class='match'>Thieves<\/span> who rob friends deserve jail.<\/li>\n  <li><span class='match'>The<\/span> ripe taste of cheese improves with age.<\/li>\n  <li><span class='match'>Act<\/span> on these orders with great speed.<\/li>\n  <li><span class='match'>The<\/span> hog crawled under the high fence.<\/li>\n  <li><span class='match'>Move<\/span> the vat over the hot fire.<\/li>\n  <li><span class='match'>The<\/span> bark of the pine tree was shiny and dark.<\/li>\n  <li><span class='match'>Leaves<\/span> turn brown and yellow in the fall.<\/li>\n  <li><span class='match'>The<\/span> pennant waved when the wind blew.<\/li>\n  <li><span class='match'>Split<\/span> the log with a quick, sharp blow.<\/li>\n  <li><span class='match'>Burn<\/span> peat after the logs give out.<\/li>\n  <li><span class='match'>He<\/span> ordered peach pie with ice cream.<\/li>\n  <li><span class='match'>Weave<\/span> the carpet on the right hand side.<\/li>\n  <li><span class='match'>Hemp<\/span> is a weed found in parts of the tropics.<\/li>\n  <li><span class='match'>A<\/span> lame back kept his score low.<\/li>\n  <li><span class='match'>We<\/span> find joy in the simplest things.<\/li>\n  <li><span class='match'>Type<\/span> out three lists of orders.<\/li>\n  <li><span class='match'>The<\/span> harder he tried the less he got done.<\/li>\n  <li><span class='match'>The<\/span> boss ran the show with a watchful eye.<\/li>\n  <li><span class='match'>The<\/span> cup cracked and spilled its contents.<\/li>\n  <li><span class='match'>Paste<\/span> can cleanse the most dirty brass.<\/li>\n  <li><span class='match'>The<\/span> slang word for raw whiskey is booze.<\/li>\n  <li><span class='match'>It<\/span> caught its hind paw in a rusty trap.<\/li>\n  <li><span class='match'>The<\/span> wharf could be seen at the farther shore.<\/li>\n  <li><span class='match'>Feel<\/span> the heat of the weak dying flame.<\/li>\n  <li><span class='match'>The<\/span> tiny girl took off her hat.<\/li>\n  <li><span class='match'>A<\/span> cramp is no small danger on a swim.<\/li>\n  <li><span class='match'>He<\/span> said the same phrase thirty times.<\/li>\n  <li><span class='match'>Pluck<\/span> the bright rose without leaves.<\/li>\n  <li><span class='match'>Two<\/span> plus seven is less than ten.<\/li>\n  <li><span class='match'>The<\/span> glow deepened in the eyes of the sweet girl.<\/li>\n  <li><span class='match'>Bring<\/span> your problems to the wise chief.<\/li>\n  <li><span class='match'>Write<\/span> a fond note to the friend you cherish.<\/li>\n  <li><span class='match'>Clothes<\/span> and lodging are free to new men.<\/li>\n  <li><span class='match'>We<\/span> frown when events take a bad turn.<\/li>\n  <li><span class='match'>Port<\/span> is a strong wine with s smoky taste.<\/li>\n  <li><span class='match'>The<\/span> young kid jumped the rusty gate.<\/li>\n  <li><span class='match'>Guess<\/span> the results from the first scores.<\/li>\n  <li><span class='match'>A<\/span> salt pickle tastes fine with ham.<\/li>\n  <li><span class='match'>The<\/span> just claim got the right verdict.<\/li>\n  <li><span class='match'>These<\/span> thistles bend in a high wind.<\/li>\n  <li><span class='match'>Pure<\/span> bred poodles have curls.<\/li>\n  <li><span class='match'>The<\/span> tree top waved in a graceful way.<\/li>\n  <li><span class='match'>The<\/span> spot on the blotter was made by green ink.<\/li>\n  <li><span class='match'>Mud<\/span> was spattered on the front of his white shirt.<\/li>\n  <li><span class='match'>The<\/span> cigar burned a hole in the desk top.<\/li>\n  <li><span class='match'>The<\/span> empty flask stood on the tin tray.<\/li>\n  <li><span class='match'>A<\/span> speedy man can beat this track mark.<\/li>\n  <li><span class='match'>He<\/span> broke a new shoelace that day.<\/li>\n  <li><span class='match'>The<\/span> coffee stand is too high for the couch.<\/li>\n  <li><span class='match'>The<\/span> urge to write short stories is rare.<\/li>\n  <li><span class='match'>The<\/span> pencils have all been used.<\/li>\n  <li><span class='match'>The<\/span> pirates seized the crew of the lost ship.<\/li>\n  <li><span class='match'>We<\/span> tried to replace the coin but failed.<\/li>\n  <li><span class='match'>She<\/span> sewed the torn coat quite neatly.<\/li>\n  <li><span class='match'>The<\/span> sofa cushion is red and of light weight.<\/li>\n  <li><span class='match'>The<\/span> jacket hung on the back of the wide chair.<\/li>\n  <li><span class='match'>At<\/span> that high level the air is pure.<\/li>\n  <li><span class='match'>Drop<\/span> the two when you add the figures.<\/li>\n  <li><span class='match'>A<\/span> filing case is now hard to buy.<\/li>\n  <li><span class='match'>An<\/span> abrupt start does not win the prize.<\/li>\n  <li><span class='match'>Wood<\/span> is best for making toys and blocks.<\/li>\n  <li><span class='match'>The<\/span> office paint was a dull sad tan.<\/li>\n  <li><span class='match'>He<\/span> knew the skill of the great young actress.<\/li>\n  <li><span class='match'>A<\/span> rag will soak up spilled water.<\/li>\n  <li><span class='match'>A<\/span> shower of dirt fell from the hot pipes.<\/li>\n  <li><span class='match'>Steam<\/span> hissed from the broken valve.<\/li>\n  <li><span class='match'>The<\/span> child almost hurt the small dog.<\/li>\n  <li><span class='match'>There<\/span> was a sound of dry leaves outside.<\/li>\n  <li><span class='match'>The<\/span> sky that morning was clear and bright blue.<\/li>\n  <li><span class='match'>Torn<\/span> scraps littered the stone floor.<\/li>\n  <li><span class='match'>Sunday<\/span> is the best part of the week.<\/li>\n  <li><span class='match'>The<\/span> doctor cured him with these pills.<\/li>\n  <li><span class='match'>The<\/span> new girl was fired today at noon.<\/li>\n  <li><span class='match'>They<\/span> felt gay when the ship arrived in port.<\/li>\n  <li><span class='match'>Add<\/span> the store's account to the last cent.<\/li>\n  <li><span class='match'>Acid<\/span> burns holes in wool cloth.<\/li>\n  <li><span class='match'>Fairy<\/span> tales should be fun to write.<\/li>\n  <li><span class='match'>Eight<\/span> miles of woodland burned to waste.<\/li>\n  <li><span class='match'>The<\/span> third act was dull and tired the players.<\/li>\n  <li><span class='match'>A<\/span> young child should not suffer fright.<\/li>\n  <li><span class='match'>Add<\/span> the column and put the sum here.<\/li>\n  <li><span class='match'>We<\/span> admire and love a good cook.<\/li>\n  <li><span class='match'>There<\/span> the flood mark is ten inches.<\/li>\n  <li><span class='match'>He<\/span> carved a head from the round block of marble.<\/li>\n  <li><span class='match'>She<\/span> has st smart way of wearing clothes.<\/li>\n  <li><span class='match'>The<\/span> fruit of a fig tree is apple-shaped.<\/li>\n  <li><span class='match'>Corn<\/span> cobs can be used to kindle a fire.<\/li>\n  <li><span class='match'>Where<\/span> were they when the noise started.<\/li>\n  <li><span class='match'>The<\/span> paper box is full of thumb tacks.<\/li>\n  <li><span class='match'>Sell<\/span> your gift to a buyer at a good gain.<\/li>\n  <li><span class='match'>The<\/span> tongs lay beside the ice pail.<\/li>\n  <li><span class='match'>The<\/span> petals fall with the next puff of wind.<\/li>\n  <li><span class='match'>Bring<\/span> your best compass to the third class.<\/li>\n  <li><span class='match'>They<\/span> could laugh although they were sad.<\/li>\n  <li><span class='match'>Farmers<\/span> came in to thresh the oat crop.<\/li>\n  <li><span class='match'>The<\/span> brown house was on fire to the attic.<\/li>\n  <li><span class='match'>The<\/span> lure is used to catch trout and flounder.<\/li>\n  <li><span class='match'>Float<\/span> the soap on top of the bath water.<\/li>\n  <li><span class='match'>A<\/span> blue crane is a tall wading bird.<\/li>\n  <li><span class='match'>A<\/span> fresh start will work such wonders.<\/li>\n  <li><span class='match'>The<\/span> club rented the rink for the fifth night.<\/li>\n  <li><span class='match'>After<\/span> the dance they went straight home.<\/li>\n  <li><span class='match'>The<\/span> hostess taught the new maid to serve.<\/li>\n  <li><span class='match'>He<\/span> wrote his last novel there at the inn.<\/li>\n  <li><span class='match'>Even<\/span> the worst will beat his low score.<\/li>\n  <li><span class='match'>The<\/span> cement had dried when he moved it.<\/li>\n  <li><span class='match'>The<\/span> loss of the second ship was hard to take.<\/li>\n  <li><span class='match'>The<\/span> fly made its way along the wall.<\/li>\n  <li><span class='match'>Do<\/span> that with a wooden stick.<\/li>\n  <li><span class='match'>Lire<\/span> wires should be kept covered.<\/li>\n  <li><span class='match'>The<\/span> large house had hot water taps.<\/li>\n  <li><span class='match'>It<\/span> is hard to erase blue or red ink.<\/li>\n  <li><span class='match'>Write<\/span> at once or you may forget it.<\/li>\n  <li><span class='match'>The<\/span> doorknob was made of bright clean brass.<\/li>\n  <li><span class='match'>The<\/span> wreck occurred by the bank on Main Street.<\/li>\n  <li><span class='match'>A<\/span> pencil with black lead writes best.<\/li>\n  <li><span class='match'>Coax<\/span> a young calf to drink from a bucket.<\/li>\n  <li><span class='match'>Schools<\/span> for ladies teach charm and grace.<\/li>\n  <li><span class='match'>The<\/span> lamp shone with a steady green flame.<\/li>\n  <li><span class='match'>They<\/span> took the axe and the saw to the forest.<\/li>\n  <li><span class='match'>The<\/span> ancient coin was quite dull and worn.<\/li>\n  <li><span class='match'>The<\/span> shaky barn fell with a loud crash.<\/li>\n  <li><span class='match'>Jazz<\/span> and swing fans like fast music.<\/li>\n  <li><span class='match'>Rake<\/span> the rubbish up and then burn it.<\/li>\n  <li><span class='match'>Slash<\/span> the gold cloth into fine ribbons.<\/li>\n  <li><span class='match'>Try<\/span> to have the court decide the case.<\/li>\n  <li><span class='match'>They<\/span> are pushed back each time they attack.<\/li>\n  <li><span class='match'>He<\/span> broke his ties with groups of former friends.<\/li>\n  <li><span class='match'>They<\/span> floated on the raft to sun their white backs.<\/li>\n  <li><span class='match'>The<\/span> map had an X that meant nothing.<\/li>\n  <li><span class='match'>Whitings<\/span> are small fish caught in nets.<\/li>\n  <li><span class='match'>Some<\/span> ads serve to cheat buyers.<\/li>\n  <li><span class='match'>Jerk<\/span> the rope and the bell rings weakly.<\/li>\n  <li><span class='match'>A<\/span> waxed floor makes us lose balance.<\/li>\n  <li><span class='match'>Madam,<\/span> this is the best brand of corn.<\/li>\n  <li><span class='match'>On<\/span> the islands the sea breeze is soft and mild.<\/li>\n  <li><span class='match'>The<\/span> play began as soon as we sat down.<\/li>\n  <li><span class='match'>This<\/span> will lead the world to more sound and fury<\/li>\n  <li><span class='match'>Add<\/span> salt before you fry the egg.<\/li>\n  <li><span class='match'>The<\/span> rush for funds reached its peak Tuesday.<\/li>\n  <li><span class='match'>The<\/span> birch looked stark white and lonesome.<\/li>\n  <li><span class='match'>The<\/span> box is held by a bright red snapper.<\/li>\n  <li><span class='match'>To<\/span> make pure ice, you freeze water.<\/li>\n  <li><span class='match'>The<\/span> first worm gets snapped early.<\/li>\n  <li><span class='match'>Jump<\/span> the fence and hurry up the bank.<\/li>\n  <li><span class='match'>Yell<\/span> and clap as the curtain slides back.<\/li>\n  <li><span class='match'>They<\/span> are men nho walk the middle of the road.<\/li>\n  <li><span class='match'>Both<\/span> brothers wear the same size.<\/li>\n  <li><span class='match'>In<\/span> some forin or other we need fun.<\/li>\n  <li><span class='match'>The<\/span> prince ordered his head chopped off.<\/li>\n  <li><span class='match'>The<\/span> houses are built of red clay bricks.<\/li>\n  <li><span class='match'>Ducks<\/span> fly north but lack a compass.<\/li>\n  <li><span class='match'>Fruit<\/span> flavors are used in fizz drinks.<\/li>\n  <li><span class='match'>These<\/span> pills do less good than others.<\/li>\n  <li><span class='match'>Canned<\/span> pears lack full flavor.<\/li>\n  <li><span class='match'>The<\/span> dark pot hung in the front closet.<\/li>\n  <li><span class='match'>Carry<\/span> the pail to the wall and spill it there.<\/li>\n  <li><span class='match'>The<\/span> train brought our hero to the big town.<\/li>\n  <li><span class='match'>We<\/span> are sure that one war is enough.<\/li>\n  <li><span class='match'>Gray<\/span> paint stretched for miles around.<\/li>\n  <li><span class='match'>The<\/span> rude laugh filled the empty room.<\/li>\n  <li><span class='match'>High<\/span> seats are best for football fans.<\/li>\n  <li><span class='match'>Tea<\/span> served from the brown jug is tasty.<\/li>\n  <li><span class='match'>A<\/span> dash of pepper spoils beef stew.<\/li>\n  <li><span class='match'>A<\/span> zestful food is the hot-cross bun.<\/li>\n  <li><span class='match'>The<\/span> horse trotted around the field at a brisk pace.<\/li>\n  <li><span class='match'>Find<\/span> the twin who stole the pearl necklace.<\/li>\n  <li><span class='match'>Cut<\/span> the cord that binds the box tightly.<\/li>\n  <li><span class='match'>The<\/span> red tape bound the smuggled food.<\/li>\n  <li><span class='match'>Look<\/span> in the corner to find the tan shirt.<\/li>\n  <li><span class='match'>The<\/span> cold drizzle will halt the bond drive.<\/li>\n  <li><span class='match'>Nine<\/span> men were hired to dig the ruins.<\/li>\n  <li><span class='match'>The<\/span> junk yard had a mouldy smell.<\/li>\n  <li><span class='match'>The<\/span> flint sputtered and lit a pine torch.<\/li>\n  <li><span class='match'>Soak<\/span> the cloth and drown the sharp odor.<\/li>\n  <li><span class='match'>The<\/span> shelves were bare of both jam or crackers.<\/li>\n  <li><span class='match'>A<\/span> joy to every child is the swan boat.<\/li>\n  <li><span class='match'>All<\/span> sat frozen and watched the screen.<\/li>\n  <li><span class='match'>ii<\/span> cloud of dust stung his tender eyes.<\/li>\n  <li><span class='match'>To<\/span> reach the end he needs much courage.<\/li>\n  <li><span class='match'>Shape<\/span> the clay gently into block form.<\/li>\n  <li><span class='match'>The<\/span> ridge on a smooth surface is a bump or flaw.<\/li>\n  <li><span class='match'>Hedge<\/span> apples may stain your hands green.<\/li>\n  <li><span class='match'>Quench<\/span> your thirst, then eat the crackers.<\/li>\n  <li><span class='match'>Tight<\/span> curls get limp on rainy days.<\/li>\n  <li><span class='match'>The<\/span> mute muffled the high tones of the horn.<\/li>\n  <li><span class='match'>The<\/span> gold ring fits only a pierced ear.<\/li>\n  <li><span class='match'>The<\/span> old pan was covered with hard fudge.<\/li>\n  <li><span class='match'>Watch<\/span> the log float in the wide river.<\/li>\n  <li><span class='match'>The<\/span> node on the stalk of wheat grew daily.<\/li>\n  <li><span class='match'>The<\/span> heap of fallen leaves was set on fire.<\/li>\n  <li><span class='match'>Write<\/span> fast, if you want to finish early.<\/li>\n  <li><span class='match'>His<\/span> shirt was clean but one button was gone.<\/li>\n  <li><span class='match'>The<\/span> barrel of beer was a brew of malt and hops.<\/li>\n  <li><span class='match'>Tin<\/span> cans are absent from store shelves.<\/li>\n  <li><span class='match'>Slide<\/span> the box into that empty space.<\/li>\n  <li><span class='match'>The<\/span> plant grew large and green in the window.<\/li>\n  <li><span class='match'>The<\/span> beam dropped down on the workmen's head.<\/li>\n  <li><span class='match'>Pink<\/span> clouds floated JTith the breeze.<\/li>\n  <li><span class='match'>She<\/span> danced like a swan, tall and graceful.<\/li>\n  <li><span class='match'>The<\/span> tube was blown and the tire flat and useless.<\/li>\n  <li><span class='match'>It<\/span> is late morning on the old wall clock.<\/li>\n  <li><span class='match'>Let's<\/span> all join as we sing the last chorus.<\/li>\n  <li><span class='match'>The<\/span> last switch cannot be turned off.<\/li>\n  <li><span class='match'>The<\/span> fight will end in just six minutes.<\/li>\n  <li><span class='match'>The<\/span> store walls were lined with colored frocks.<\/li>\n  <li><span class='match'>The<\/span> peace league met to discuss their plans.<\/li>\n  <li><span class='match'>The<\/span> rise to fame of a person takes luck.<\/li>\n  <li><span class='match'>Paper<\/span> is scarce, so write with much care.<\/li>\n  <li><span class='match'>The<\/span> quick fox jumped on the sleeping cat.<\/li>\n  <li><span class='match'>The<\/span> nozzle of the fire hose was bright brass.<\/li>\n  <li><span class='match'>Screw<\/span> the round cap on as tight as needed.<\/li>\n  <li><span class='match'>Time<\/span> brings us many changes.<\/li>\n  <li><span class='match'>The<\/span> purple tie was ten years old.<\/li>\n  <li><span class='match'>Men<\/span> think and plan and sometimes act.<\/li>\n  <li><span class='match'>Fill<\/span> the ink jar with sticky glue.<\/li>\n  <li><span class='match'>He<\/span> smoke a big pipe with strong contents.<\/li>\n  <li><span class='match'>We<\/span> need grain to keep our mules healthy.<\/li>\n  <li><span class='match'>Pack<\/span> the records in a neat thin case.<\/li>\n  <li><span class='match'>The<\/span> crunch of feet in the snow was the only sound.<\/li>\n  <li><span class='match'>The<\/span> copper bowl shone in the sun's rays.<\/li>\n  <li><span class='match'>Boards<\/span> will warp unless kept dry.<\/li>\n  <li><span class='match'>The<\/span> plush chair leaned against the wall.<\/li>\n  <li><span class='match'>Glass<\/span> will clink when struck by metal.<\/li>\n  <li><span class='match'>Bathe<\/span> and relax in the cool green grass.<\/li>\n  <li><span class='match'>Nine<\/span> rows of soldiers stood in line.<\/li>\n  <li><span class='match'>The<\/span> beach is dry and shallow at low tide.<\/li>\n  <li><span class='match'>The<\/span> idea is to sew both edges straight.<\/li>\n  <li><span class='match'>The<\/span> kitten chased the dog down the street.<\/li>\n  <li><span class='match'>Pages<\/span> bound in cloth make a book.<\/li>\n  <li><span class='match'>Try<\/span> to trace the fine lines of the painting.<\/li>\n  <li><span class='match'>Women<\/span> form less than half of the group.<\/li>\n  <li><span class='match'>The<\/span> zones merge in the central part of town.<\/li>\n  <li><span class='match'>A<\/span> gem in the rough needs work to polish.<\/li>\n  <li><span class='match'>Code<\/span> is used when secrets are sent.<\/li>\n  <li><span class='match'>Most<\/span> of the new is easy for us to hear.<\/li>\n  <li><span class='match'>He<\/span> used the lathe to make brass objects.<\/li>\n  <li><span class='match'>The<\/span> vane on top of the pole revolved in the wind.<\/li>\n  <li><span class='match'>Mince<\/span> pie is a dish served to children.<\/li>\n  <li><span class='match'>The<\/span> clan gathered on each dull night.<\/li>\n  <li><span class='match'>Let<\/span> it burn, it gives us warmth and comfort.<\/li>\n  <li><span class='match'>A<\/span> castle built from sand fails to endure.<\/li>\n  <li><span class='match'>A<\/span> child's wit saved the day for us.<\/li>\n  <li><span class='match'>Tack<\/span> the strip of carpet to the worn floor.<\/li>\n  <li><span class='match'>Next<\/span> Tuesday we must vote.<\/li>\n  <li><span class='match'>Pour<\/span> the stew from the pot into the plate.<\/li>\n  <li><span class='match'>Each<\/span> penny shone like new.<\/li>\n  <li><span class='match'>The<\/span> man went to the woods to gather sticks.<\/li>\n  <li><span class='match'>The<\/span> dirt piles were lines along the road.<\/li>\n  <li><span class='match'>The<\/span> logs fell and tumbled into the clear stream.<\/li>\n  <li><span class='match'>Just<\/span> hoist it up and take it away,<\/li>\n  <li><span class='match'>A<\/span> ripe plum is fit for a king's palate.<\/li>\n  <li><span class='match'>Our<\/span> plans right now are hazy.<\/li>\n  <li><span class='match'>Brass<\/span> rings are sold by these natives.<\/li>\n  <li><span class='match'>It<\/span> takes a good trap to capture a bear.<\/li>\n  <li><span class='match'>Feed<\/span> the white mouse some flower seeds.<\/li>\n  <li><span class='match'>The<\/span> thaw came early and freed the stream.<\/li>\n  <li><span class='match'>He<\/span> took the lead and kept it the whole distance.<\/li>\n  <li><span class='match'>The<\/span> key you designed will fit the lock.<\/li>\n  <li><span class='match'>Plead<\/span> to the council to free the poor thief.<\/li>\n  <li><span class='match'>Better<\/span> hash is made of rare beef.<\/li>\n  <li><span class='match'>This<\/span> plank was made for walking on.<\/li>\n  <li><span class='match'>The<\/span> lake sparkled in the red hot sun.<\/li>\n  <li><span class='match'>He<\/span> crawled with care along the ledge.<\/li>\n  <li><span class='match'>Tend<\/span> the sheep while the dog wanders.<\/li>\n  <li><span class='match'>It<\/span> takes a lot of help to finish these.<\/li>\n  <li><span class='match'>Mark<\/span> the spot with a sign painted red.<\/li>\n  <li><span class='match'>Take<\/span> two shares as a fair profit.<\/li>\n  <li><span class='match'>The<\/span> fur of cats goes by many names.<\/li>\n  <li><span class='match'>North<\/span> winds bring colds and fevers.<\/li>\n  <li><span class='match'>He<\/span> asks no person to vouch for him.<\/li>\n  <li><span class='match'>Go<\/span> now and come here later.<\/li>\n  <li><span class='match'>A<\/span> sash of gold silk will trim her dress.<\/li>\n  <li><span class='match'>Soap<\/span> can wash most dirt away.<\/li>\n  <li><span class='match'>That<\/span> move means the game is over.<\/li>\n  <li><span class='match'>He<\/span> wrote down a long list of items.<\/li>\n  <li><span class='match'>A<\/span> siege will crack the strong defense.<\/li>\n  <li><span class='match'>Grape<\/span> juice and water mix well.<\/li>\n  <li><span class='match'>Roads<\/span> are paved with sticky tar.<\/li>\n  <li><span class='match'>Fake<\/span> &ones shine but cost little.<\/li>\n  <li><span class='match'>The<\/span> drip of the rain made a pleasant sound.<\/li>\n  <li><span class='match'>Smoke<\/span> poured out of every crack.<\/li>\n  <li><span class='match'>Serve<\/span> the hot rum to the tired heroes.<\/li>\n  <li><span class='match'>Much<\/span> of the story makes good sense.<\/li>\n  <li><span class='match'>The<\/span> sun came up to light the eastern sky.<\/li>\n  <li><span class='match'>Heave<\/span> the line over the port side.<\/li>\n  <li><span class='match'>A<\/span> lathe cuts and trims any wood.<\/li>\n  <li><span class='match'>It's<\/span> a dense crowd in two distinct ways.<\/li>\n  <li><span class='match'>His<\/span> hip struck the knee of the next player.<\/li>\n  <li><span class='match'>The<\/span> stale smell of old beer lingers.<\/li>\n  <li><span class='match'>The<\/span> desk was firm on the shaky floor.<\/li>\n  <li><span class='match'>It<\/span> takes heat to bring out the odor.<\/li>\n  <li><span class='match'>Beef<\/span> is scarcer than some lamb.<\/li>\n  <li><span class='match'>Raise<\/span> the sail and steer the ship northward.<\/li>\n  <li><span class='match'>The<\/span> cone costs five cents on Mondays.<\/li>\n  <li><span class='match'>A<\/span> pod is what peas always grow in.<\/li>\n  <li><span class='match'>Jerk<\/span> the dart from the cork target.<\/li>\n  <li><span class='match'>No<\/span> cement will hold hard wood.<\/li>\n  <li><span class='match'>We<\/span> now have a new base for shipping.<\/li>\n  <li><span class='match'>The<\/span> list of names is carved around the base.<\/li>\n  <li><span class='match'>The<\/span> sheep were led home by a dog.<\/li>\n  <li><span class='match'>Three<\/span> for a dime, the young peddler cried.<\/li>\n  <li><span class='match'>The<\/span> sense of smell is better than that of touch.<\/li>\n  <li><span class='match'>No<\/span> hardship seemed to keep him sad.<\/li>\n  <li><span class='match'>Grace<\/span> makes up for lack of beauty.<\/li>\n  <li><span class='match'>Nudge<\/span> gently but wake her now.<\/li>\n  <li><span class='match'>The<\/span> news struck doubt into restless minds.<\/li>\n  <li><span class='match'>Once<\/span> we stood beside the shore.<\/li>\n  <li><span class='match'>A<\/span> chink in the wall allowed a draft to blow.<\/li>\n  <li><span class='match'>Fasten<\/span> two pins on each side.<\/li>\n  <li><span class='match'>A<\/span> cold dip restores health and zest.<\/li>\n  <li><span class='match'>He<\/span> takes the oath of office each March.<\/li>\n  <li><span class='match'>The<\/span> sand drifts over the sill of the old house.<\/li>\n  <li><span class='match'>The<\/span> point of the steel pen was bent and twisted.<\/li>\n  <li><span class='match'>There<\/span> is a lag between thought and act.<\/li>\n  <li><span class='match'>Seed<\/span> is needed to plant the spring corn.<\/li>\n  <li><span class='match'>Draw<\/span> the chart with heavy black lines.<\/li>\n  <li><span class='match'>The<\/span> boy owed his pal thirty cents.<\/li>\n  <li><span class='match'>The<\/span> chap slipped into the crowd and was lost.<\/li>\n  <li><span class='match'>Hats<\/span> are worn to tea and not to dinner.<\/li>\n  <li><span class='match'>The<\/span> ramp led up to the wide highway.<\/li>\n  <li><span class='match'>Beat<\/span> the dust from the rug onto the lawn.<\/li>\n  <li><span class='match'>Say<\/span> it slow!y but make it ring clear.<\/li>\n  <li><span class='match'>The<\/span> straw nest housed five robins.<\/li>\n  <li><span class='match'>Screen<\/span> the porch with woven straw mats.<\/li>\n  <li><span class='match'>This<\/span> horse will nose his way to the finish.<\/li>\n  <li><span class='match'>The<\/span> dry wax protects the deep scratch.<\/li>\n  <li><span class='match'>He<\/span> picked up the dice for a second roll.<\/li>\n  <li><span class='match'>These<\/span> coins will be needed to pay his debt.<\/li>\n  <li><span class='match'>The<\/span> nag pulled the frail cart along.<\/li>\n  <li><span class='match'>Twist<\/span> the valve and release hot steam.<\/li>\n  <li><span class='match'>The<\/span> vamp of the shoe had a gold buckle.<\/li>\n  <li><span class='match'>The<\/span> smell of burned rags itches my nose.<\/li>\n  <li><span class='match'>Xew<\/span> pants lack cuffs and pockets.<\/li>\n  <li><span class='match'>The<\/span> marsh will freeze when cold enough.<\/li>\n  <li><span class='match'>They<\/span> slice the sausage thin with a knife.<\/li>\n  <li><span class='match'>The<\/span> bloom of the rose lasts a few days.<\/li>\n  <li><span class='match'>A<\/span> gray mare walked before the colt.<\/li>\n  <li><span class='match'>Breakfast<\/span> buns are fine with a hot drink.<\/li>\n  <li><span class='match'>Bottles<\/span> hold four kinds of rum.<\/li>\n  <li><span class='match'>The<\/span> man wore a feather in his felt hat.<\/li>\n  <li><span class='match'>He<\/span> wheeled the bike past. the winding road.<\/li>\n  <li><span class='match'>Drop<\/span> the ashes on the worn old rug.<\/li>\n  <li><span class='match'>The<\/span> desk and both chairs were painted tan.<\/li>\n  <li><span class='match'>Throw<\/span> out the used paper cup and plate.<\/li>\n  <li><span class='match'>A<\/span> clean neck means a neat collar.<\/li>\n  <li><span class='match'>The<\/span> couch cover and hall drapes were blue.<\/li>\n  <li><span class='match'>The<\/span> stems of the tall glasses cracked and broke.<\/li>\n  <li><span class='match'>The<\/span> wall phone rang loud and often.<\/li>\n  <li><span class='match'>The<\/span> clothes dried on a thin wooden rack.<\/li>\n  <li><span class='match'>Turn<\/span> on the lantern which gives us light.<\/li>\n  <li><span class='match'>The<\/span> cleat sank deeply into the soft turf.<\/li>\n  <li><span class='match'>The<\/span> bills were mailed promptly on the tenth of the month.<\/li>\n  <li><span class='match'>To<\/span> have is better than to wait and hope.<\/li>\n  <li><span class='match'>The<\/span> price is fair for a good antique clock.<\/li>\n  <li><span class='match'>The<\/span> music played on while they talked.<\/li>\n  <li><span class='match'>Dispense<\/span> with a vest on a day like this.<\/li>\n  <li><span class='match'>The<\/span> bunch of grapes was pressed into wine.<\/li>\n  <li><span class='match'>He<\/span> sent the figs, but kept the ripe cherries.<\/li>\n  <li><span class='match'>The<\/span> hinge on the door creaked with old age.<\/li>\n  <li><span class='match'>The<\/span> screen before the fire kept in the sparks.<\/li>\n  <li><span class='match'>Fly<\/span> by night, and you waste little time.<\/li>\n  <li><span class='match'>Thick<\/span> glasses helped him read the print.<\/li>\n  <li><span class='match'>Birth<\/span> and death mark the limits of life.<\/li>\n  <li><span class='match'>The<\/span> chair looked strong but had no bottom.<\/li>\n  <li><span class='match'>The<\/span> kite flew wildly in the high wind.<\/li>\n  <li><span class='match'>A<\/span> fur muff is stylish once more.<\/li>\n  <li><span class='match'>The<\/span> tin box held priceless stones.<\/li>\n  <li><span class='match'>We<\/span> need an end of all such matter.<\/li>\n  <li><span class='match'>The<\/span> case was puzzling to the old and wise.<\/li>\n  <li><span class='match'>The<\/span> bright lanterns were gay on the dark lawn.<\/li>\n  <li><span class='match'>We<\/span> don't get much money but we have fun.<\/li>\n  <li><span class='match'>The<\/span> youth drove with zest, but little skill.<\/li>\n  <li><span class='match'>Five<\/span> years he lived with a shaggy dog.<\/li>\n  <li><span class='match'>A<\/span> fence cuts through the corner lot.<\/li>\n  <li><span class='match'>The<\/span> way to save money is not to spend much.<\/li>\n  <li><span class='match'>Shut<\/span> the hatch before the waves push it in.<\/li>\n  <li><span class='match'>The<\/span> odor of spring makes young hearts jump.<\/li>\n  <li><span class='match'>Crack<\/span> the walnut with your sharp side teeth.<\/li>\n  <li><span class='match'>He<\/span> offered proof in the form of a lsrge chart.<\/li>\n  <li><span class='match'>Send<\/span> the stuff in a thick paper bag.<\/li>\n  <li><span class='match'>A<\/span> quart of milk is water for the most part.<\/li>\n  <li><span class='match'>They<\/span> told wild tales to frighten him.<\/li>\n  <li><span class='match'>The<\/span> three story house was built of stone.<\/li>\n  <li><span class='match'>In<\/span> the rear of the ground floor was a large passage.<\/li>\n  <li><span class='match'>A<\/span> man in a blue sweater sat at the desk.<\/li>\n  <li><span class='match'>Oats<\/span> are a food eaten by horse and man.<\/li>\n  <li><span class='match'>Their<\/span> eyelids droop for want. of sleep.<\/li>\n  <li><span class='match'>The<\/span> sip of tea revives his tired friend.<\/li>\n  <li><span class='match'>There<\/span> are many ways to do these things.<\/li>\n  <li><span class='match'>Tuck<\/span> the sheet under the edge of the mat.<\/li>\n  <li><span class='match'>A<\/span> force equal to that would move the earth.<\/li>\n  <li><span class='match'>We<\/span> like to see clear weather.<\/li>\n  <li><span class='match'>The<\/span> work of the tailor is seen on each side.<\/li>\n  <li><span class='match'>Take<\/span> a chance and win a china doll.<\/li>\n  <li><span class='match'>Shake<\/span> the dust from your shoes, stranger.<\/li>\n  <li><span class='match'>She<\/span> was kind to sick old people.<\/li>\n  <li><span class='match'>The<\/span> dusty bench stood by the stone wall.<\/li>\n  <li><span class='match'>The<\/span> square wooden crate was packed to be shipped.<\/li>\n  <li><span class='match'>We<\/span> dress to suit the weather of most days.<\/li>\n  <li><span class='match'>Smile<\/span> when you say nasty words.<\/li>\n  <li><span class='match'>A<\/span> bowl of rice is free with chicken stew.<\/li>\n  <li><span class='match'>The<\/span> water in this well is a source of good health.<\/li>\n  <li><span class='match'>Take<\/span> shelter in this tent, but keep still.<\/li>\n  <li><span class='match'>That<\/span> guy is the writer of a few banned books.<\/li>\n  <li><span class='match'>The<\/span> little tales they tell are false.<\/li>\n  <li><span class='match'>The<\/span> door was barred, locked, and bolted as well.<\/li>\n  <li><span class='match'>Ripe<\/span> pears are fit for a queen's table.<\/li>\n  <li><span class='match'>A<\/span> big wet stain was on the round carpet.<\/li>\n  <li><span class='match'>The<\/span> kite dipped and swayed, but stayed aloft.<\/li>\n  <li><span class='match'>The<\/span> pleasant hours fly by much too soon.<\/li>\n  <li><span class='match'>The<\/span> room was crowded with a wild mob.<\/li>\n  <li><span class='match'>This<\/span> strong arm shall shield your honor.<\/li>\n  <li><span class='match'>She<\/span> blushed when he gave her a white orchid.<\/li>\n  <li><span class='match'>The<\/span> beetle droned in the hot June sun.<\/li>\n  <li><span class='match'>Press<\/span> the pedal with your left foot.<\/li>\n  <li><span class='match'>Neat<\/span> plans fail without luck.<\/li>\n  <li><span class='match'>The<\/span> black trunk fell from the landing.<\/li>\n  <li><span class='match'>The<\/span> bank pressed for payment of the debt.<\/li>\n  <li><span class='match'>The<\/span> theft of the pearl pin was kept secret.<\/li>\n  <li><span class='match'>Shake<\/span> hands with this friendly child.<\/li>\n  <li><span class='match'>The<\/span> vast space stretched into the far distance.<\/li>\n  <li><span class='match'>A<\/span> rich farm is rare in this sandy waste.<\/li>\n  <li><span class='match'>His<\/span> wide grin earned many friends.<\/li>\n  <li><span class='match'>Flax<\/span> makes a fine brand of paper.<\/li>\n  <li><span class='match'>Hurdle<\/span> the pit with the aid of a long pole.<\/li>\n  <li><span class='match'>A<\/span> strong bid may scare your partner stiff.<\/li>\n  <li><span class='match'>Even<\/span> a just cause needs power to win.<\/li>\n  <li><span class='match'>Peep<\/span> under the tent and see the clowns.<\/li>\n  <li><span class='match'>The<\/span> leaf drifts along with a slow spin.<\/li>\n  <li><span class='match'>Cheap<\/span> clothes are flashy but don??????t last.<\/li>\n  <li><span class='match'>A<\/span> thing of small note can cause despair.<\/li>\n  <li><span class='match'>Flood<\/span> the mails with requests for this book.<\/li>\n  <li><span class='match'>A<\/span> thick coat of black paint covered all.<\/li>\n  <li><span class='match'>The<\/span> pencil was cut to be sharp at both ends.<\/li>\n  <li><span class='match'>Those<\/span> last words were a strong statement.<\/li>\n  <li><span class='match'>He<\/span> wrote his name boldly at the top of tile sheet.<\/li>\n  <li><span class='match'>Dill<\/span> pickles are sour but taste fine.<\/li>\n  <li><span class='match'>Down<\/span> that road is the way to the grain farmer.<\/li>\n  <li><span class='match'>Either<\/span> mud or dust are found at all times.<\/li>\n  <li><span class='match'>The<\/span> best method is to fix it in place with clips.<\/li>\n  <li><span class='match'>If<\/span> you mumble your speech will be lost.<\/li>\n  <li><span class='match'>At<\/span> night the alarm roused him from a deep sleep.<\/li>\n  <li><span class='match'>Read<\/span> just what the meter says.<\/li>\n  <li><span class='match'>Fill<\/span> your pack with bright trinkets for the poor.<\/li>\n  <li><span class='match'>The<\/span> small red neon lamp went out.<\/li>\n  <li><span class='match'>Clams<\/span> are small, round, soft, and tasty.<\/li>\n  <li><span class='match'>The<\/span> fan whirled its round blades softly.<\/li>\n  <li><span class='match'>The<\/span> line where the edges join was clean.<\/li>\n  <li><span class='match'>Breathe<\/span> deep and smell the piny air.<\/li>\n  <li><span class='match'>It<\/span> matters not if he reads these words or those.<\/li>\n  <li><span class='match'>A<\/span> brown leather bag hung from its strap.<\/li>\n  <li><span class='match'>A<\/span> toad and a frog are hard to tell apart.<\/li>\n  <li><span class='match'>A<\/span> white silk jacket goes with any shoes.<\/li>\n  <li><span class='match'>A<\/span> break in the dam almost caused a flood.<\/li>\n  <li><span class='match'>Paint<\/span> the sockets in the wall dull green.<\/li>\n  <li><span class='match'>The<\/span> child crawled into the dense grass.<\/li>\n  <li><span class='match'>Bribes<\/span> fail where honest men work.<\/li>\n  <li><span class='match'>Trample<\/span> the spark, else the flames will spread.<\/li>\n  <li><span class='match'>The<\/span> hilt. of the sword was carved with fine designs.<\/li>\n  <li><span class='match'>A<\/span> round hole was drilled through the thin board.<\/li>\n  <li><span class='match'>Footprints<\/span> showed the path he took up the beach.<\/li>\n  <li><span class='match'>She<\/span> was waiting at my front lawn.<\/li>\n  <li><span class='match'>A<\/span> vent near the edge brought in fresh air.<\/li>\n  <li><span class='match'>Prod<\/span> the old mule with a crooked stick.<\/li>\n  <li><span class='match'>It<\/span> is a band of steel three inches wide.<\/li>\n  <li><span class='match'>The<\/span> pipe ran almost the length of the ditch.<\/li>\n  <li><span class='match'>It<\/span> was hidden from sight by a mass of leaves and shrubs.<\/li>\n  <li><span class='match'>The<\/span> weight. of the package was seen on the high scale.<\/li>\n  <li><span class='match'>Wake<\/span> and rise, and step into the green outdoors.<\/li>\n  <li><span class='match'>The<\/span> green light in the brown box flickered.<\/li>\n  <li><span class='match'>The<\/span> brass tube circled the high wall.<\/li>\n  <li><span class='match'>The<\/span> lobes of her ears were pierced to hold rings.<\/li>\n  <li><span class='match'>Hold<\/span> the hammer near the end to drive the nail.<\/li>\n  <li><span class='match'>Next<\/span> Sunday is the twelfth of the month.<\/li>\n  <li><span class='match'>Every<\/span> word and phrase he speaks is true.<\/li>\n  <li><span class='match'>He<\/span> put his last cartridge into the gun and fired.<\/li>\n  <li><span class='match'>They<\/span> took their kids from the public school.<\/li>\n  <li><span class='match'>Drive<\/span> the screw straight into the wood.<\/li>\n  <li><span class='match'>Keep<\/span> the hatch tight and the watch constant.<\/li>\n  <li><span class='match'>Sever<\/span> the twine with a quick snip of the knife.<\/li>\n  <li><span class='match'>Paper<\/span> will dry out when wet.<\/li>\n  <li><span class='match'>Slide<\/span> the catch back and open the desk.<\/li>\n  <li><span class='match'>Help<\/span> the weak to preserve their strength.<\/li>\n  <li><span class='match'>A<\/span> sullen smile gets few friends.<\/li>\n  <li><span class='match'>Stop<\/span> whistling and watch the boys march.<\/li>\n  <li><span class='match'>Jerk<\/span> the cord, and out tumbles the gold.<\/li>\n  <li><span class='match'>Slidc<\/span> the tray across the glass top.<\/li>\n  <li><span class='match'>The<\/span> cloud moved in a stately way and was gone.<\/li>\n  <li><span class='match'>Light<\/span> maple makes for a swell room.<\/li>\n  <li><span class='match'>Set<\/span> the piece here and say nothing.<\/li>\n  <li><span class='match'>Dull<\/span> stories make her laugh.<\/li>\n  <li><span class='match'>A<\/span> stiff cord will do to fasten your shoe.<\/li>\n  <li><span class='match'>Get<\/span> the trust fund to the bank early.<\/li>\n  <li><span class='match'>Choose<\/span> between the high road and the low.<\/li>\n  <li><span class='match'>A<\/span> plea for funds seems to come again.<\/li>\n  <li><span class='match'>He<\/span> lent his coat to the tall gaunt stranger.<\/li>\n  <li><span class='match'>There<\/span> is a strong chance it will happen once more.<\/li>\n  <li><span class='match'>The<\/span> duke left the park in a silver coach.<\/li>\n  <li><span class='match'>Greet<\/span> the new guests and leave quickly.<\/li>\n  <li><span class='match'>When<\/span> the frost has come it is time for turkey.<\/li>\n  <li><span class='match'>Sweet<\/span> words work better than fierce.<\/li>\n  <li><span class='match'>A<\/span> thin stripe runs down the middle.<\/li>\n  <li><span class='match'>A<\/span> six comes up more often than a ten.<\/li>\n  <li><span class='match'>Lush<\/span> fern grow on the lofty rocks.<\/li>\n  <li><span class='match'>The<\/span> ram scared the school children off.<\/li>\n  <li><span class='match'>The<\/span> team with the best timing looks good.<\/li>\n  <li><span class='match'>The<\/span> farmer swapped his horse for a brown ox.<\/li>\n  <li><span class='match'>Sit<\/span> on the perch and tell the others what to do.<\/li>\n  <li><span class='match'>A<\/span> steep trail is painful for our feet.<\/li>\n  <li><span class='match'>The<\/span> early phase of life moves fast.<\/li>\n  <li><span class='match'>Green<\/span> moss grows on the northern side.<\/li>\n  <li><span class='match'>Tea<\/span> in thin china has a sweet taste.<\/li>\n  <li><span class='match'>Pitch<\/span> the straw through the door of the stable.<\/li>\n  <li><span class='match'>The<\/span> latch on the beck gate needed a nail.<\/li>\n  <li><span class='match'>The<\/span> goose was brought straight from the old market.<\/li>\n  <li><span class='match'>The<\/span> sink is the thing in which we pile dishes.<\/li>\n  <li><span class='match'>A<\/span> whiff of it will cure the most stubborn cold.<\/li>\n  <li><span class='match'>The<\/span> facts dont always show who is right.<\/li>\n  <li><span class='match'>She<\/span> flaps her cape as she parades the street.<\/li>\n  <li><span class='match'>The<\/span> loss of the cruiser was a blow to the fleet.<\/li>\n  <li><span class='match'>Loop<\/span> the braid to the left and then over.<\/li>\n  <li><span class='match'>Plead<\/span> with the lawyer to drop the lost cause.<\/li>\n  <li><span class='match'>Calves<\/span> thrive on tender spring grass.<\/li>\n  <li><span class='match'>Post<\/span> no bills on this office wall.<\/li>\n  <li><span class='match'>Tear<\/span> a thin sheet from the yellow pad.<\/li>\n  <li><span class='match'>A<\/span> cruise in warm waters in a sleek yacht is fun.<\/li>\n  <li><span class='match'>A<\/span> streak of color ran down the left edge.<\/li>\n  <li><span class='match'>It<\/span> was done before the boy could see it.<\/li>\n  <li><span class='match'>Crouch<\/span> before you jump or miss the mark.<\/li>\n  <li><span class='match'>Pack<\/span> the kits and dont forget the salt.<\/li>\n  <li><span class='match'>The<\/span> square peg will settle in the round hole.<\/li>\n  <li><span class='match'>Fine<\/span> soap saves tender skin.<\/li>\n  <li><span class='match'>Poached<\/span> eggs and tea must suffice.<\/li>\n  <li><span class='match'>Bad<\/span> nerves are jangled by a door slam.<\/li>\n  <li><span class='match'>Ship<\/span> maps are different from those for planes.<\/li>\n  <li><span class='match'>Dimes<\/span> showered down from all sides.<\/li>\n  <li><span class='match'>They<\/span> sang the same tunes at each party.<\/li>\n  <li><span class='match'>The<\/span> sky in the west is tinged with orange red.<\/li>\n  <li><span class='match'>The<\/span> pods of peas ferment in bare fields.<\/li>\n  <li><span class='match'>The<\/span> horse balked and threw the tall rider.<\/li>\n  <li><span class='match'>The<\/span> hitch between the horse and cart broke.<\/li>\n  <li><span class='match'>Pile<\/span> the coal high in the shed corner.<\/li>\n  <li><span class='match'>The<\/span> gold vase is both rare and costly.<\/li>\n  <li><span class='match'>The<\/span> knife was hung inside its bright sheath.<\/li>\n  <li><span class='match'>The<\/span> rarest spice comes from the far East.<\/li>\n  <li><span class='match'>The<\/span> roof should be tilted at a sharp slant.<\/li>\n  <li><span class='match'>A<\/span> smatter of French is worse than none.<\/li>\n  <li><span class='match'>The<\/span> mule trod the treadmill day and night.<\/li>\n  <li><span class='match'>The<\/span> aim of the contest is to raise a great fund.<\/li>\n  <li><span class='match'>To<\/span> send it. now in large amounts is bad.<\/li>\n  <li><span class='match'>There<\/span> is a fine hard tang in salty air.<\/li>\n  <li><span class='match'>Cod<\/span> is the main business of the north shore.<\/li>\n  <li><span class='match'>The<\/span> slab was hewn from heavy blocks of slate.<\/li>\n  <li><span class='match'>Dunk<\/span> the stale biscuits into strong drink.<\/li>\n  <li><span class='match'>Hang<\/span> tinsel from both branches.<\/li>\n  <li><span class='match'>Cap<\/span> the jar with a tight brass cover.<\/li>\n  <li><span class='match'>The<\/span> poor boy missed the boat again.<\/li>\n  <li><span class='match'>Be<\/span> sure to set the lamp firmly in the hole.<\/li>\n  <li><span class='match'>Pick<\/span> a card and slip it. under the pack.<\/li>\n  <li><span class='match'>A<\/span> round mat will cover the dull spot.<\/li>\n  <li><span class='match'>The<\/span> first part of the plan needs changing.<\/li>\n  <li><span class='match'>The<\/span> good book informs of what we ought to know.<\/li>\n  <li><span class='match'>The<\/span> mail comes in three batches per day.<\/li>\n  <li><span class='match'>You<\/span> cannot brew tea in a cold pot.<\/li>\n  <li><span class='match'>Dots<\/span> of light betrayed the black cat.<\/li>\n  <li><span class='match'>Put<\/span> the chart on the mantel and tack it down.<\/li>\n  <li><span class='match'>The<\/span> night shift men rate extra pay.<\/li>\n  <li><span class='match'>The<\/span> red paper brightened the dim stage.<\/li>\n  <li><span class='match'>See<\/span> the player scoot to third base.<\/li>\n  <li><span class='match'>Slide<\/span> the bill between the two leaves.<\/li>\n  <li><span class='match'>Many<\/span> hands help get the job done.<\/li>\n  <li><span class='match'>We<\/span> don't like to admit our small faults.<\/li>\n  <li><span class='match'>No<\/span> doubt about the way the wind blows.<\/li>\n  <li><span class='match'>Dig<\/span> deep in the earth for pirate's gold.<\/li>\n  <li><span class='match'>The<\/span> steady drip is worse than a drenching rain.<\/li>\n  <li><span class='match'>A<\/span> flat pack takes less luggage space.<\/li>\n  <li><span class='match'>Green<\/span> ice frosted the punch bowl.<\/li>\n  <li><span class='match'>A<\/span> stuffed chair slipped from the moving van.<\/li>\n  <li><span class='match'>The<\/span> stitch will serve but needs to be shortened.<\/li>\n  <li><span class='match'>A<\/span> thin book fits in the side pocket.<\/li>\n  <li><span class='match'>The<\/span> gloss on top made it unfit to read.<\/li>\n  <li><span class='match'>The<\/span> hail pattered on the burnt brown grass.<\/li>\n  <li><span class='match'>Seven<\/span> seals were stamped on great sheets.<\/li>\n  <li><span class='match'>Our<\/span> troops are set to strike heavy blows.<\/li>\n  <li><span class='match'>The<\/span> store was jammed before the sale could start.<\/li>\n  <li><span class='match'>It<\/span> was a bad error on the part of the new judge.<\/li>\n  <li><span class='match'>One<\/span> step more and the board will collapse.<\/li>\n  <li><span class='match'>Take<\/span> the match and strike it against your shoe.<\/li>\n  <li><span class='match'>The<\/span> pot boiled, but the contents failed to jell.<\/li>\n  <li><span class='match'>The<\/span> baby puts his right foot in his mouth.<\/li>\n  <li><span class='match'>The<\/span> bombs left most of the town in ruins.<\/li>\n  <li><span class='match'>Stop<\/span> and stare at the hard working man.<\/li>\n  <li><span class='match'>The<\/span> streets are narrow and full of sharp turns.<\/li>\n  <li><span class='match'>The<\/span> pup jerked the leash as he saw a feline shape.<\/li>\n  <li><span class='match'>Open<\/span> your book to the first page.<\/li>\n  <li><span class='match'>Fish<\/span> evade the net, and swim off.<\/li>\n  <li><span class='match'>Dip<\/span> the pail once and let it settle.<\/li>\n  <li><span class='match'>Will<\/span> you please answer that phone.<\/li>\n  <li><span class='match'>The<\/span> big red apple fell to the ground.<\/li>\n  <li><span class='match'>The<\/span> curtain rose and the show was on.<\/li>\n  <li><span class='match'>The<\/span> young prince became heir to the throne.<\/li>\n  <li><span class='match'>He<\/span> sent the boy on a short errand.<\/li>\n  <li><span class='match'>Leave<\/span> now and you will arrive on time.<\/li>\n  <li><span class='match'>The<\/span> corner store was robbed last night.<\/li>\n  <li><span class='match'>A<\/span> gold ring will please most any girl.<\/li>\n  <li><span class='match'>The<\/span> long journey home took a year.<\/li>\n  <li><span class='match'>She<\/span> saw a cat in the neighbor's house.<\/li>\n  <li><span class='match'>A<\/span> pink shell was found on the sandy beach.<\/li>\n  <li><span class='match'>Small<\/span> children came to see him.<\/li>\n  <li><span class='match'>The<\/span> grass and bushes were wet with dew.<\/li>\n  <li><span class='match'>The<\/span> blind man counted his old coins.<\/li>\n  <li><span class='match'>A<\/span> severe storm tore down the barn.<\/li>\n  <li><span class='match'>She<\/span> called his name many times.<\/li>\n  <li><span class='match'>When<\/span> you hear the bell, come quickly.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>тогда итоговое решение будет выглядеть следующим образом:</p>
<div class="sourceCode" id="cb1158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1158-1" data-line-number="1"><span class="kw">str_extract</span>(sentences, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">S+&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1158-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>## [1] &quot;The&quot;   &quot;Glue&quot;  &quot;It&#39;s&quot;  &quot;These&quot; &quot;Rice&quot;  &quot;The&quot;</code></pre>
<p>Мне показалось ошибочным моё решение, поскольку я нашёл предложение, которое начинается со слова <code>ii</code>.</p>
<div class="sourceCode" id="cb1160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1160-1" data-line-number="1">sentences[<span class="dv">284</span>]</a></code></pre></div>
<pre><code>## [1] &quot;ii cloud of dust stung his tender eyes.&quot;</code></pre>
<p>Однако, действительно, это предложение начинается с двух гласных, первая из которых строчная.</p>
<ul>
<li>Как и в первом упражнении, нужно найти слово целиком, для этого нужно использовать оператор <code>\b</code>.</li>
</ul>
<div class="sourceCode" id="cb1162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1162-1" data-line-number="1"><span class="kw">str_view_all</span>(sentences, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]+ing</span><span class="ch">\\</span><span class="st">b&quot;</span>, <span class="dt">match =</span> <span class="ot">TRUE</span>) <span class="co"># Найти слова первые один или более буквенных символов и оканчивающиеся на `ing`</span></a></code></pre></div>
<div id="htmlwidget-b55b84f835082d37651e" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-b55b84f835082d37651e">{"x":{"html":"<ul>\n  <li>The source of the huge river is the clear <span class='match'>spring<\/span>.<\/li>\n  <li>A pot of tea helps to pass the <span class='match'>evening<\/span>.<\/li>\n  <li>It snowed, rained, and hailed the same <span class='match'>morning<\/span>.<\/li>\n  <li>Take the <span class='match'>winding<\/span> path to reach the lake.<\/li>\n  <li>What joy there is in <span class='match'>living<\/span>.<\/li>\n  <li>A <span class='match'>king<\/span> ruled the state in the early days.<\/li>\n  <li><span class='match'>Adding<\/span> fast leads to wrong sums.<\/li>\n  <li>A saw is a tool used for <span class='match'>making<\/span> boards.<\/li>\n  <li>Both lost their lives in the <span class='match'>raging<\/span> storm.<\/li>\n  <li>The two met while <span class='match'>playing<\/span> on the sand.<\/li>\n  <li>The horn of the car woke the <span class='match'>sleeping<\/span> cop.<\/li>\n  <li>The pearl was worn in a thin silver <span class='match'>ring<\/span>.<\/li>\n  <li>See the cat <span class='match'>glaring<\/span> at the scared mouse.<\/li>\n  <li>Bail the boat, to stop it from <span class='match'>sinking<\/span>.<\/li>\n  <li>Feel the heat of the weak <span class='match'>dying<\/span> flame.<\/li>\n  <li><span class='match'>Bring<\/span> your problems to the wise chief.<\/li>\n  <li>Clothes and <span class='match'>lodging<\/span> are free to new men.<\/li>\n  <li>A <span class='match'>filing<\/span> case is now hard to buy.<\/li>\n  <li>Wood is best for <span class='match'>making<\/span> toys and blocks.<\/li>\n  <li>The sky that <span class='match'>morning<\/span> was clear and bright blue.<\/li>\n  <li>She has st smart way of <span class='match'>wearing<\/span> clothes.<\/li>\n  <li><span class='match'>Bring<\/span> your best compass to the third class.<\/li>\n  <li>A blue crane is a tall <span class='match'>wading<\/span> bird.<\/li>\n  <li>Jazz and <span class='match'>swing<\/span> fans like fast music.<\/li>\n  <li>The map had an X that meant <span class='match'>nothing<\/span>.<\/li>\n  <li>The gold <span class='match'>ring<\/span> fits only a pierced ear.<\/li>\n  <li>It is late <span class='match'>morning<\/span> on the old wall clock.<\/li>\n  <li>Let's all join as we <span class='match'>sing<\/span> the last chorus.<\/li>\n  <li>The quick fox jumped on the <span class='match'>sleeping<\/span> cat.<\/li>\n  <li>Try to trace the fine lines of the <span class='match'>painting<\/span>.<\/li>\n  <li>A ripe plum is fit for a <span class='match'>king<\/span>'s palate.<\/li>\n  <li>This plank was made for <span class='match'>walking<\/span> on.<\/li>\n  <li>North winds <span class='match'>bring<\/span> colds and fevers.<\/li>\n  <li>It takes heat to <span class='match'>bring<\/span> out the odor.<\/li>\n  <li>We now have a new base for <span class='match'>shipping<\/span>.<\/li>\n  <li>Seed is needed to plant the <span class='match'>spring<\/span> corn.<\/li>\n  <li>Say it slow!y but make it <span class='match'>ring<\/span> clear.<\/li>\n  <li>He wheeled the bike past. the <span class='match'>winding<\/span> road.<\/li>\n  <li>The case was <span class='match'>puzzling<\/span> to the old and wise.<\/li>\n  <li>The odor of <span class='match'>spring<\/span> makes young hearts jump.<\/li>\n  <li>The black trunk fell from the <span class='match'>landing<\/span>.<\/li>\n  <li>A <span class='match'>thing<\/span> of small note can cause despair.<\/li>\n  <li>She was <span class='match'>waiting<\/span> at my front lawn.<\/li>\n  <li>Stop <span class='match'>whistling<\/span> and watch the boys march.<\/li>\n  <li>Set the piece here and say <span class='match'>nothing<\/span>.<\/li>\n  <li>The team with the best <span class='match'>timing<\/span> looks good.<\/li>\n  <li>The sink is the <span class='match'>thing<\/span> in which we pile dishes.<\/li>\n  <li>Calves thrive on tender <span class='match'>spring<\/span> grass.<\/li>\n  <li>The first part of the plan needs <span class='match'>changing<\/span>.<\/li>\n  <li>The steady drip is worse than a <span class='match'>drenching<\/span> rain.<\/li>\n  <li>A stuffed chair slipped from the <span class='match'>moving<\/span> van.<\/li>\n  <li>Stop and stare at the hard <span class='match'>working<\/span> man.<\/li>\n  <li>A gold <span class='match'>ring<\/span> will please most any girl.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1163-1" data-line-number="1">(ing &lt;-<span class="st"> </span><span class="kw">str_detect</span>(sentences, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]+ing</span><span class="ch">\\</span><span class="st">b&quot;</span>))  <span class="co"># Содержит ли предложение слово с инг-овым окончанием</span></a></code></pre></div>
<pre><code>##   [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [12] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
##  [23] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE  TRUE FALSE
##  [34] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE
##  [45] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE  TRUE
##  [56] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
##  [67] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE
##  [78] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
##  [89] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE
## [100] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [111] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [122] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE
## [133] FALSE FALSE FALSE  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [144] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [155] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
## [166]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [177] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [188] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE
## [199] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [210] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [221] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE
## [232] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [243] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [254] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [265] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [276] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [287] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [298] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE
## [309] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [320] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [331] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [342] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [353] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [364] FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [375]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [386] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [397]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE
## [408] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [419] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
## [430] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [441] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [452] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [463] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [474] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
## [485] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [496] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [507] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [518] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [529] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [540] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [551] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [562] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [573] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [584] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE
## [595] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [606] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [617] FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE
## [628] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [639] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [650] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [661] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [672] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
## [683] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [694] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [705] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [716] FALSE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1165-1" data-line-number="1">sentences[ing]                                        <span class="co"># предложения с инговым окончанием</span></a></code></pre></div>
<pre><code>##  [1] &quot;The source of the huge river is the clear spring.&quot;
##  [2] &quot;A pot of tea helps to pass the evening.&quot;          
##  [3] &quot;It snowed, rained, and hailed the same morning.&quot;  
##  [4] &quot;Take the winding path to reach the lake.&quot;         
##  [5] &quot;What joy there is in living.&quot;                     
##  [6] &quot;A king ruled the state in the early days.&quot;        
##  [7] &quot;Adding fast leads to wrong sums.&quot;                 
##  [8] &quot;A saw is a tool used for making boards.&quot;          
##  [9] &quot;Both lost their lives in the raging storm.&quot;       
## [10] &quot;The two met while playing on the sand.&quot;           
## [11] &quot;The horn of the car woke the sleeping cop.&quot;       
## [12] &quot;The pearl was worn in a thin silver ring.&quot;        
## [13] &quot;See the cat glaring at the scared mouse.&quot;         
## [14] &quot;Bail the boat, to stop it from sinking.&quot;          
## [15] &quot;Feel the heat of the weak dying flame.&quot;           
## [16] &quot;Bring your problems to the wise chief.&quot;           
## [17] &quot;Clothes and lodging are free to new men.&quot;         
## [18] &quot;A filing case is now hard to buy.&quot;                
## [19] &quot;Wood is best for making toys and blocks.&quot;         
## [20] &quot;The sky that morning was clear and bright blue.&quot;  
## [21] &quot;She has st smart way of wearing clothes.&quot;         
## [22] &quot;Bring your best compass to the third class.&quot;      
## [23] &quot;A blue crane is a tall wading bird.&quot;              
## [24] &quot;Jazz and swing fans like fast music.&quot;             
## [25] &quot;The map had an X that meant nothing.&quot;             
## [26] &quot;The gold ring fits only a pierced ear.&quot;           
## [27] &quot;It is late morning on the old wall clock.&quot;        
## [28] &quot;Let&#39;s all join as we sing the last chorus.&quot;       
## [29] &quot;The quick fox jumped on the sleeping cat.&quot;        
## [30] &quot;Try to trace the fine lines of the painting.&quot;     
## [31] &quot;A ripe plum is fit for a king&#39;s palate.&quot;          
## [32] &quot;This plank was made for walking on.&quot;              
## [33] &quot;North winds bring colds and fevers.&quot;              
## [34] &quot;It takes heat to bring out the odor.&quot;             
## [35] &quot;We now have a new base for shipping.&quot;             
## [36] &quot;Seed is needed to plant the spring corn.&quot;         
## [37] &quot;Say it slow!y but make it ring clear.&quot;            
## [38] &quot;He wheeled the bike past. the winding road.&quot;      
## [39] &quot;The case was puzzling to the old and wise.&quot;       
## [40] &quot;The odor of spring makes young hearts jump.&quot;      
## [41] &quot;The black trunk fell from the landing.&quot;           
## [42] &quot;A thing of small note can cause despair.&quot;         
## [43] &quot;She was waiting at my front lawn.&quot;                
## [44] &quot;Stop whistling and watch the boys march.&quot;         
## [45] &quot;Set the piece here and say nothing.&quot;              
## [46] &quot;The team with the best timing looks good.&quot;        
## [47] &quot;The sink is the thing in which we pile dishes.&quot;   
## [48] &quot;Calves thrive on tender spring grass.&quot;            
## [49] &quot;The first part of the plan needs changing.&quot;       
## [50] &quot;The steady drip is worse than a drenching rain.&quot;  
## [51] &quot;A stuffed chair slipped from the moving van.&quot;     
## [52] &quot;Stop and stare at the hard working man.&quot;          
## [53] &quot;A gold ring will please most any girl.&quot;</code></pre>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1167-1" data-line-number="1"><span class="kw">str_extract_all</span>(sentences[ing], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]+ing</span><span class="ch">\\</span><span class="st">b&quot;</span>) <span class="co"># Используем extract_all, потому что в предложении может быть несколько инг-овых слов.</span></a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;spring&quot;
## 
## [[2]]
## [1] &quot;evening&quot;
## 
## [[3]]
## [1] &quot;morning&quot;
## 
## [[4]]
## [1] &quot;winding&quot;
## 
## [[5]]
## [1] &quot;living&quot;
## 
## [[6]]
## [1] &quot;king&quot;
## 
## [[7]]
## [1] &quot;Adding&quot;
## 
## [[8]]
## [1] &quot;making&quot;
## 
## [[9]]
## [1] &quot;raging&quot;
## 
## [[10]]
## [1] &quot;playing&quot;
## 
## [[11]]
## [1] &quot;sleeping&quot;
## 
## [[12]]
## [1] &quot;ring&quot;
## 
## [[13]]
## [1] &quot;glaring&quot;
## 
## [[14]]
## [1] &quot;sinking&quot;
## 
## [[15]]
## [1] &quot;dying&quot;
## 
## [[16]]
## [1] &quot;Bring&quot;
## 
## [[17]]
## [1] &quot;lodging&quot;
## 
## [[18]]
## [1] &quot;filing&quot;
## 
## [[19]]
## [1] &quot;making&quot;
## 
## [[20]]
## [1] &quot;morning&quot;
## 
## [[21]]
## [1] &quot;wearing&quot;
## 
## [[22]]
## [1] &quot;Bring&quot;
## 
## [[23]]
## [1] &quot;wading&quot;
## 
## [[24]]
## [1] &quot;swing&quot;
## 
## [[25]]
## [1] &quot;nothing&quot;
## 
## [[26]]
## [1] &quot;ring&quot;
## 
## [[27]]
## [1] &quot;morning&quot;
## 
## [[28]]
## [1] &quot;sing&quot;
## 
## [[29]]
## [1] &quot;sleeping&quot;
## 
## [[30]]
## [1] &quot;painting&quot;
## 
## [[31]]
## [1] &quot;king&quot;
## 
## [[32]]
## [1] &quot;walking&quot;
## 
## [[33]]
## [1] &quot;bring&quot;
## 
## [[34]]
## [1] &quot;bring&quot;
## 
## [[35]]
## [1] &quot;shipping&quot;
## 
## [[36]]
## [1] &quot;spring&quot;
## 
## [[37]]
## [1] &quot;ring&quot;
## 
## [[38]]
## [1] &quot;winding&quot;
## 
## [[39]]
## [1] &quot;puzzling&quot;
## 
## [[40]]
## [1] &quot;spring&quot;
## 
## [[41]]
## [1] &quot;landing&quot;
## 
## [[42]]
## [1] &quot;thing&quot;
## 
## [[43]]
## [1] &quot;waiting&quot;
## 
## [[44]]
## [1] &quot;whistling&quot;
## 
## [[45]]
## [1] &quot;nothing&quot;
## 
## [[46]]
## [1] &quot;timing&quot;
## 
## [[47]]
## [1] &quot;thing&quot;
## 
## [[48]]
## [1] &quot;spring&quot;
## 
## [[49]]
## [1] &quot;changing&quot;
## 
## [[50]]
## [1] &quot;drenching&quot;
## 
## [[51]]
## [1] &quot;moving&quot;
## 
## [[52]]
## [1] &quot;working&quot;
## 
## [[53]]
## [1] &quot;ring&quot;</code></pre>
<p>С такой структурой полученного набора неудобно работать. Для того чтобы упростить полученный набор до вектора используем функцию <code>unlist()</code>. Учитывая структуру списка на входе, <code>unlist()</code> упрощает его для создания вектора, который содержит все атомарные компоненты, которые встречаются во входном списке.</p>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1169-1" data-line-number="1"><span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(sentences[ing], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]+ing</span><span class="ch">\\</span><span class="st">b&quot;</span>))</a></code></pre></div>
<pre><code>##  [1] &quot;spring&quot;    &quot;evening&quot;   &quot;morning&quot;   &quot;winding&quot;   &quot;living&quot;   
##  [6] &quot;king&quot;      &quot;Adding&quot;    &quot;making&quot;    &quot;raging&quot;    &quot;playing&quot;  
## [11] &quot;sleeping&quot;  &quot;ring&quot;      &quot;glaring&quot;   &quot;sinking&quot;   &quot;dying&quot;    
## [16] &quot;Bring&quot;     &quot;lodging&quot;   &quot;filing&quot;    &quot;making&quot;    &quot;morning&quot;  
## [21] &quot;wearing&quot;   &quot;Bring&quot;     &quot;wading&quot;    &quot;swing&quot;     &quot;nothing&quot;  
## [26] &quot;ring&quot;      &quot;morning&quot;   &quot;sing&quot;      &quot;sleeping&quot;  &quot;painting&quot; 
## [31] &quot;king&quot;      &quot;walking&quot;   &quot;bring&quot;     &quot;bring&quot;     &quot;shipping&quot; 
## [36] &quot;spring&quot;    &quot;ring&quot;      &quot;winding&quot;   &quot;puzzling&quot;  &quot;spring&quot;   
## [41] &quot;landing&quot;   &quot;thing&quot;     &quot;waiting&quot;   &quot;whistling&quot; &quot;nothing&quot;  
## [46] &quot;timing&quot;    &quot;thing&quot;     &quot;spring&quot;    &quot;changing&quot;  &quot;drenching&quot;
## [51] &quot;moving&quot;    &quot;working&quot;   &quot;ring&quot;</code></pre>
<p>С полученным вектором уже удобнее работать, к примеру можно извлечь уникальные слова оканчивающиеся на -ing, встречающиеся в исходном наборе:</p>
<div class="sourceCode" id="cb1171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1171-1" data-line-number="1"><span class="kw">unique</span>(</a>
<a class="sourceLine" id="cb1171-2" data-line-number="2">  <span class="kw">unlist</span>(</a>
<a class="sourceLine" id="cb1171-3" data-line-number="3">    <span class="kw">str_extract_all</span>(</a>
<a class="sourceLine" id="cb1171-4" data-line-number="4">      sentences[ing], <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]+ing</span><span class="ch">\\</span><span class="st">b&quot;</span>)</a>
<a class="sourceLine" id="cb1171-5" data-line-number="5">    )</a>
<a class="sourceLine" id="cb1171-6" data-line-number="6">  )</a></code></pre></div>
<pre><code>##  [1] &quot;spring&quot;    &quot;evening&quot;   &quot;morning&quot;   &quot;winding&quot;   &quot;living&quot;   
##  [6] &quot;king&quot;      &quot;Adding&quot;    &quot;making&quot;    &quot;raging&quot;    &quot;playing&quot;  
## [11] &quot;sleeping&quot;  &quot;ring&quot;      &quot;glaring&quot;   &quot;sinking&quot;   &quot;dying&quot;    
## [16] &quot;Bring&quot;     &quot;lodging&quot;   &quot;filing&quot;    &quot;wearing&quot;   &quot;wading&quot;   
## [21] &quot;swing&quot;     &quot;nothing&quot;   &quot;sing&quot;      &quot;painting&quot;  &quot;walking&quot;  
## [26] &quot;bring&quot;     &quot;shipping&quot;  &quot;puzzling&quot;  &quot;landing&quot;   &quot;thing&quot;    
## [31] &quot;waiting&quot;   &quot;whistling&quot; &quot;timing&quot;    &quot;changing&quot;  &quot;drenching&quot;
## [36] &quot;moving&quot;    &quot;working&quot;</code></pre>
<ul>
<li><p>Поиск всех слов во множественном числе только регулярными выражениями будет трудной задачей, если соблюдать все правила языка. Потому что помимо добавления к слову окончания <code>s</code> есть ещё ряд условий такие как:</p>
<ul>
<li><p>если существительное заканчивается на: -o, -ch, -sh, -ss или -x, множественное число образуется путем добавления окончания <code>-es</code>.</p></li>
<li><p>если существительное оканчивается на -y и перед -y стоит согласная буква, мы “y” меняем на “i” и добавляем <code>-es</code>.</p></li>
<li><p>12 существительных оканчивающихся на - f или - fe, при образовании множественно числа “теряют” - f или - fe, но приобретают - ves.
Вот они: calf (теленок), half (половина), knife (нож), leaf (лист дерева), life (жизнь), loaf (буханка, каравай), self (сам, себя), sheaf (сноп, вязанка), shelf (полка), thief (вор), wife (жена), wolf (волк).</p></li>
<li><p>ряд существительных, у которых множественное число образуется за счет изменения гласной (а в некоторых случаях, за счет добавления окончания - en / - ren). foot (нога, ступня) - feet, tooth (зуб) - teeth, man (мужчина, человек) - men, woman (женщина) - women, mouse (мышь) - mice, goose (гусь) - geese, louse (вошь) - lice, child (ребенок) - children, ox (бык, вол) - oxen.</p></li>
<li><p>Существительные deer (олень) и sheep (овца) имеют одинаковую форму, как для единственного, так и для множественно числа. sheep - sheep, deer - deer.</p></li>
</ul></li>
</ul>
<p>Мне кажется, проще на данном этапе решить задачу в общей форме — искать все слова у которых не менее трёх букв перед <code>s</code>. Три для того чтобы отсечь слова наподобие <code>as, is, gas</code>. Итого имеем:</p>
<div class="sourceCode" id="cb1173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1173-1" data-line-number="1"><span class="kw">unique</span>(</a>
<a class="sourceLine" id="cb1173-2" data-line-number="2">  <span class="kw">unlist</span>(</a>
<a class="sourceLine" id="cb1173-3" data-line-number="3">    <span class="kw">str_extract_all</span>(sentences, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">b[A-Za-z]{3,}s</span><span class="ch">\\</span><span class="st">b&quot;</span>)</a>
<a class="sourceLine" id="cb1173-4" data-line-number="4">    )</a>
<a class="sourceLine" id="cb1173-5" data-line-number="5">  )</a></code></pre></div>
<pre><code>##   [1] &quot;planks&quot;     &quot;days&quot;       &quot;bowls&quot;      &quot;lemons&quot;     &quot;makes&quot;     
##   [6] &quot;hogs&quot;       &quot;hours&quot;      &quot;stockings&quot;  &quot;helps&quot;      &quot;pass&quot;      
##  [11] &quot;fires&quot;      &quot;across&quot;     &quot;bonds&quot;      &quot;Press&quot;      &quot;pants&quot;     
##  [16] &quot;useless&quot;    &quot;kittens&quot;    &quot;Sickness&quot;   &quot;grass&quot;      &quot;books&quot;     
##  [21] &quot;keeps&quot;      &quot;chicks&quot;     &quot;leads&quot;      &quot;sums&quot;       &quot;boards&quot;    
##  [26] &quot;wheels&quot;     &quot;soldiers&quot;   &quot;steps&quot;      &quot;lives&quot;      &quot;circus&quot;    
##  [31] &quot;Cars&quot;       &quot;busses&quot;     &quot;drifts&quot;     &quot;This&quot;       &quot;hikes&quot;     
##  [36] &quot;words&quot;      &quot;weeks&quot;      &quot;strokes&quot;    &quot;slices&quot;     &quot;factors&quot;   
##  [41] &quot;parts&quot;      &quot;Always&quot;     &quot;costs&quot;      &quot;eggs&quot;       &quot;seems&quot;     
##  [46] &quot;gifts&quot;      &quot;pins&quot;       &quot;gives&quot;      &quot;Cats&quot;       &quot;dogs&quot;      
##  [51] &quot;glass&quot;      &quot;Thieves&quot;    &quot;friends&quot;    &quot;improves&quot;   &quot;orders&quot;    
##  [56] &quot;Leaves&quot;     &quot;logs&quot;       &quot;tropics&quot;    &quot;things&quot;     &quot;lists&quot;     
##  [61] &quot;less&quot;       &quot;boss&quot;       &quot;contents&quot;   &quot;brass&quot;      &quot;times&quot;     
##  [66] &quot;leaves&quot;     &quot;plus&quot;       &quot;eyes&quot;       &quot;problems&quot;   &quot;Clothes&quot;   
##  [71] &quot;events&quot;     &quot;Guess&quot;      &quot;results&quot;    &quot;scores&quot;     &quot;tastes&quot;    
##  [76] &quot;thistles&quot;   &quot;poodles&quot;    &quot;curls&quot;      &quot;this&quot;       &quot;stories&quot;   
##  [81] &quot;pencils&quot;    &quot;pirates&quot;    &quot;figures&quot;    &quot;does&quot;       &quot;toys&quot;      
##  [86] &quot;blocks&quot;     &quot;actress&quot;    &quot;pipes&quot;      &quot;scraps&quot;     &quot;pills&quot;     
##  [91] &quot;burns&quot;      &quot;holes&quot;      &quot;tales&quot;      &quot;miles&quot;      &quot;players&quot;   
##  [96] &quot;inches&quot;     &quot;clothes&quot;    &quot;cobs&quot;       &quot;tacks&quot;      &quot;tongs&quot;     
## [101] &quot;petals&quot;     &quot;compass&quot;    &quot;class&quot;      &quot;Farmers&quot;    &quot;wonders&quot;   
## [106] &quot;hostess&quot;    &quot;loss&quot;       &quot;wires&quot;      &quot;taps&quot;       &quot;writes&quot;    
## [111] &quot;Schools&quot;    &quot;ladies&quot;     &quot;fans&quot;       &quot;ribbons&quot;    &quot;ties&quot;      
## [116] &quot;groups&quot;     &quot;backs&quot;      &quot;Whitings&quot;   &quot;nets&quot;       &quot;buyers&quot;    
## [121] &quot;rings&quot;      &quot;islands&quot;    &quot;funds&quot;      &quot;gets&quot;       &quot;slides&quot;    
## [126] &quot;brothers&quot;   &quot;houses&quot;     &quot;bricks&quot;     &quot;Ducks&quot;      &quot;flavors&quot;   
## [131] &quot;drinks&quot;     &quot;others&quot;     &quot;pears&quot;      &quot;seats&quot;      &quot;spoils&quot;    
## [136] &quot;cross&quot;      &quot;binds&quot;      &quot;ruins&quot;      &quot;shelves&quot;    &quot;crackers&quot;  
## [141] &quot;needs&quot;      &quot;apples&quot;     &quot;hands&quot;      &quot;tones&quot;      &quot;fits&quot;      
## [146] &quot;hops&quot;       &quot;cans&quot;       &quot;clouds&quot;     &quot;chorus&quot;     &quot;minutes&quot;   
## [151] &quot;walls&quot;      &quot;frocks&quot;     &quot;discuss&quot;    &quot;plans&quot;      &quot;takes&quot;     
## [156] &quot;brings&quot;     &quot;changes&quot;    &quot;years&quot;      &quot;sometimes&quot;  &quot;mules&quot;     
## [161] &quot;records&quot;    &quot;rays&quot;       &quot;Boards&quot;     &quot;unless&quot;     &quot;Glass&quot;     
## [166] &quot;rows&quot;       &quot;edges&quot;      &quot;Pages&quot;      &quot;lines&quot;      &quot;zones&quot;     
## [171] &quot;secrets&quot;    &quot;objects&quot;    &quot;fails&quot;      &quot;woods&quot;      &quot;sticks&quot;    
## [176] &quot;piles&quot;      &quot;Brass&quot;      &quot;natives&quot;    &quot;seeds&quot;      &quot;wanders&quot;   
## [181] &quot;shares&quot;     &quot;cats&quot;       &quot;goes&quot;       &quot;names&quot;      &quot;winds&quot;     
## [186] &quot;colds&quot;      &quot;fevers&quot;     &quot;asks&quot;       &quot;dress&quot;      &quot;means&quot;     
## [191] &quot;items&quot;      &quot;Roads&quot;      &quot;ones&quot;       &quot;heroes&quot;     &quot;cuts&quot;      
## [196] &quot;trims&quot;      &quot;ways&quot;       &quot;lingers&quot;    &quot;cents&quot;      &quot;Mondays&quot;   
## [201] &quot;peas&quot;       &quot;always&quot;     &quot;news&quot;       &quot;restless&quot;   &quot;minds&quot;     
## [206] &quot;restores&quot;   &quot;Hats&quot;       &quot;robins&quot;     &quot;mats&quot;       &quot;protects&quot;  
## [211] &quot;coins&quot;      &quot;rags&quot;       &quot;itches&quot;     &quot;cuffs&quot;      &quot;pockets&quot;   
## [216] &quot;lasts&quot;      &quot;buns&quot;       &quot;Bottles&quot;    &quot;kinds&quot;      &quot;ashes&quot;     
## [221] &quot;chairs&quot;     &quot;drapes&quot;     &quot;stems&quot;      &quot;glasses&quot;    &quot;bills&quot;     
## [226] &quot;grapes&quot;     &quot;figs&quot;       &quot;cherries&quot;   &quot;sparks&quot;     &quot;limits&quot;    
## [231] &quot;priceless&quot;  &quot;stones&quot;     &quot;lanterns&quot;   &quot;waves&quot;      &quot;hearts&quot;    
## [236] &quot;Oats&quot;       &quot;eyelids&quot;    &quot;revives&quot;    &quot;shoes&quot;      &quot;clowns&quot;    
## [241] &quot;mails&quot;      &quot;requests&quot;   &quot;ends&quot;       &quot;pickles&quot;    &quot;clips&quot;     
## [246] &quot;says&quot;       &quot;trinkets&quot;   &quot;Clams&quot;      &quot;blades&quot;     &quot;matters&quot;   
## [251] &quot;reads&quot;      &quot;sockets&quot;    &quot;Bribes&quot;     &quot;flames&quot;     &quot;designs&quot;   
## [256] &quot;Footprints&quot; &quot;mass&quot;       &quot;shrubs&quot;     &quot;outdoors&quot;   &quot;lobes&quot;     
## [261] &quot;ears&quot;       &quot;speaks&quot;     &quot;kids&quot;       &quot;boys&quot;       &quot;tumbles&quot;   
## [266] &quot;guests&quot;     &quot;runs&quot;       &quot;comes&quot;      &quot;rocks&quot;      &quot;looks&quot;     
## [271] &quot;moves&quot;      &quot;moss&quot;       &quot;grows&quot;      &quot;dishes&quot;     &quot;facts&quot;     
## [276] &quot;flaps&quot;      &quot;parades&quot;    &quot;Calves&quot;     &quot;waters&quot;     &quot;miss&quot;      
## [281] &quot;kits&quot;       &quot;saves&quot;      &quot;nerves&quot;     &quot;maps&quot;       &quot;planes&quot;    
## [286] &quot;Dimes&quot;      &quot;sides&quot;      &quot;tunes&quot;      &quot;pods&quot;       &quot;fields&quot;    
## [291] &quot;amounts&quot;    &quot;business&quot;   &quot;biscuits&quot;   &quot;branches&quot;   &quot;informs&quot;   
## [296] &quot;batches&quot;    &quot;Dots&quot;       &quot;faults&quot;     &quot;blows&quot;      &quot;gloss&quot;     
## [301] &quot;seals&quot;      &quot;sheets&quot;     &quot;troops&quot;     &quot;puts&quot;       &quot;bombs&quot;     
## [306] &quot;streets&quot;    &quot;turns&quot;      &quot;bushes&quot;</code></pre>
</div>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">3.5.4.3</span> Разбиение совпадений на группы</h4>
<p>Круглые скобки можно использовать</p>
<ul>
<li><p>для расстановки приоритетов,</p></li>
<li><p>для обеспечения возможности обратных ссылокв процессе обнаружения совпадений,</p></li>
<li><p>для извлечения частей сложных совпадений</p></li>
</ul>
<p>Предположим, есть необходимость извлечь существительное из предлдожений. Приближением приближенным к реальности (или эвристикой) будет поиск любого слова следующего за артиклем <code>a</code> или <code>the</code>. Определение “слова” в регулярном выражение не совсем простая штука, поэтому мы воспользуемся приближением — слово это последовательность, состоящая по крайне мере из одного символа, не являющегося пробелом.</p>
<div class="sourceCode" id="cb1175"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1175-1" data-line-number="1">noun &lt;-<span class="st"> &quot;(a|the) ([^ ]+)&quot;</span></a>
<a class="sourceLine" id="cb1175-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1175-3" data-line-number="3">has_noun &lt;-<span class="st"> </span>sentences <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1175-4" data-line-number="4"><span class="st">  </span><span class="kw">str_subset</span>(noun) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1175-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1175-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1175-7" data-line-number="7">has_noun <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1175-8" data-line-number="8"><span class="st">  </span><span class="kw">str_extract</span>(noun)</a></code></pre></div>
<pre><code>##  [1] &quot;the smooth&quot; &quot;the sheet&quot;  &quot;the depth&quot;  &quot;a chicken&quot;  &quot;the parked&quot;
##  [6] &quot;the sun&quot;    &quot;the huge&quot;   &quot;the ball&quot;   &quot;the woman&quot;  &quot;a helps&quot;</code></pre>
<p>Функция <code>str_extract</code> даёт нам полное совпадение, функция <code>str_match</code> — каждый отдельный его компонент. Вместо символьного вектора она возвразает матрицу с одним столбцом для полного совпадения, за которым следуют столбцы, по одному для каждой группы.</p>
<div class="sourceCode" id="cb1177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1177-1" data-line-number="1">has_noun <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1177-2" data-line-number="2"><span class="st">  </span><span class="kw">str_match</span>(noun)</a></code></pre></div>
<pre><code>##       [,1]         [,2]  [,3]     
##  [1,] &quot;the smooth&quot; &quot;the&quot; &quot;smooth&quot; 
##  [2,] &quot;the sheet&quot;  &quot;the&quot; &quot;sheet&quot;  
##  [3,] &quot;the depth&quot;  &quot;the&quot; &quot;depth&quot;  
##  [4,] &quot;a chicken&quot;  &quot;a&quot;   &quot;chicken&quot;
##  [5,] &quot;the parked&quot; &quot;the&quot; &quot;parked&quot; 
##  [6,] &quot;the sun&quot;    &quot;the&quot; &quot;sun&quot;    
##  [7,] &quot;the huge&quot;   &quot;the&quot; &quot;huge&quot;   
##  [8,] &quot;the ball&quot;   &quot;the&quot; &quot;ball&quot;   
##  [9,] &quot;the woman&quot;  &quot;the&quot; &quot;woman&quot;  
## [10,] &quot;a helps&quot;    &quot;a&quot;   &quot;helps&quot;</code></pre>
<p><em>Важно!</em></p>
<p>Если данные содержатся в tibble-фрейме, зачастую проще использовать функцию <code>tidyr::extract()</code>. Она работает подобно <code>str_match()</code>, но требует чтобы мы именовали совпадения, которые затем помещаются в новые столбцы</p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1179-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">sentence =</span> sentences) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1179-2" data-line-number="2"><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">extract</span>(</a>
<a class="sourceLine" id="cb1179-3" data-line-number="3">    sentence, <span class="kw">c</span>(<span class="st">&quot;article&quot;</span>, <span class="st">&quot;noun&quot;</span>), <span class="st">&quot;(a|the) ([^ ]+)&quot;</span>, </a>
<a class="sourceLine" id="cb1179-4" data-line-number="4">    <span class="dt">remove =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb1179-5" data-line-number="5">  )</a></code></pre></div>
<pre><code>## # A tibble: 720 x 3
##    sentence                                    article noun   
##    &lt;chr&gt;                                       &lt;chr&gt;   &lt;chr&gt;  
##  1 The birch canoe slid on the smooth planks.  the     smooth 
##  2 Glue the sheet to the dark blue background. the     sheet  
##  3 It&#39;s easy to tell the depth of a well.      the     depth  
##  4 These days a chicken leg is a rare dish.    a       chicken
##  5 Rice is often served in round bowls.        &lt;NA&gt;    &lt;NA&gt;   
##  6 The juice of lemons makes fine punch.       &lt;NA&gt;    &lt;NA&gt;   
##  7 The box was thrown beside the parked truck. the     parked 
##  8 The hogs were fed chopped corn and garbage. &lt;NA&gt;    &lt;NA&gt;   
##  9 Four hours of steady work faced us.         &lt;NA&gt;    &lt;NA&gt;   
## 10 Large size in stockings is hard to sell.    &lt;NA&gt;    &lt;NA&gt;   
## # … with 710 more rows</code></pre>
<div id="-14.4.3.1.1-1" class="section level5">
<h5><span class="header-section-number">3.5.4.3.1</span> Упражнение 14.4.3.1.1</h5>
<div class="question">
<p>Find all words that come after a “number” like “one”, “two”, “three” etc. Pull out both the number and the word.</p>
</div>
<p>Это задание очень похоже на пример разобранный в книге, с той лишь разницей, что в задаче необходимо перечислить все числительные.</p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1181-1" data-line-number="1">numbers &lt;-<span class="st"> &quot;(one|two|three|four|five|six|seven|eight|nine|ten) +(</span><span class="ch">\\</span><span class="st">S+)&quot;</span></a>
<a class="sourceLine" id="cb1181-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1181-3" data-line-number="3">has_numbers &lt;-<span class="st"> </span>sentences <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1181-4" data-line-number="4"><span class="st">  </span><span class="kw">str_subset</span>(numbers) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># str_subset() используется для выбора элементов, соответствующих шаблону</span></a>
<a class="sourceLine" id="cb1181-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1181-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1181-7" data-line-number="7">has_numbers <span class="op">%&gt;%</span><span class="st">              </span><span class="co"># Выводим все совпадения в красивую матрицу</span></a>
<a class="sourceLine" id="cb1181-8" data-line-number="8"><span class="st">  </span><span class="kw">str_match</span>(numbers)</a></code></pre></div>
<pre><code>##       [,1]          [,2]    [,3]     
##  [1,] &quot;ten served&quot;  &quot;ten&quot;   &quot;served&quot; 
##  [2,] &quot;one over&quot;    &quot;one&quot;   &quot;over&quot;   
##  [3,] &quot;seven books&quot; &quot;seven&quot; &quot;books&quot;  
##  [4,] &quot;two met&quot;     &quot;two&quot;   &quot;met&quot;    
##  [5,] &quot;two factors&quot; &quot;two&quot;   &quot;factors&quot;
##  [6,] &quot;one and&quot;     &quot;one&quot;   &quot;and&quot;    
##  [7,] &quot;three lists&quot; &quot;three&quot; &quot;lists&quot;  
##  [8,] &quot;seven is&quot;    &quot;seven&quot; &quot;is&quot;     
##  [9,] &quot;two when&quot;    &quot;two&quot;   &quot;when&quot;   
## [10,] &quot;one floor.&quot;  &quot;one&quot;   &quot;floor.&quot;</code></pre>
</div>
<div id="-14.4.3.1.2-1" class="section level5">
<h5><span class="header-section-number">3.5.4.3.2</span> Упражнение 14.4.3.1.2</h5>
<div class="question">
<p>Find all contractions. Separate out the pieces before and after the apostrophe.</p>
</div>
<p>Необходимо найти все сокращения.
Напомню, что в английском языке можно сокращать некоторые слова. В таких случаях ставится апостроф <code>'</code> на место пропуска букв.</p>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1183-1" data-line-number="1">contractions &lt;-<span class="st"> </span>sentences <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1183-2" data-line-number="2"><span class="st">  </span><span class="kw">str_subset</span>(<span class="st">&quot;(</span><span class="ch">\\</span><span class="st">S+)&#39;(</span><span class="ch">\\</span><span class="st">S+)&quot;</span>)</a>
<a class="sourceLine" id="cb1183-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1183-4" data-line-number="4">contractions <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1183-5" data-line-number="5"><span class="st">  </span><span class="kw">str_match</span>(<span class="st">&quot;(</span><span class="ch">\\</span><span class="st">S+)&#39;(</span><span class="ch">\\</span><span class="st">S+)&quot;</span>)</a></code></pre></div>
<pre><code>##       [,1]         [,2]       [,3]
##  [1,] &quot;It&#39;s&quot;       &quot;It&quot;       &quot;s&quot; 
##  [2,] &quot;man&#39;s&quot;      &quot;man&quot;      &quot;s&quot; 
##  [3,] &quot;don&#39;t&quot;      &quot;don&quot;      &quot;t&quot; 
##  [4,] &quot;store&#39;s&quot;    &quot;store&quot;    &quot;s&quot; 
##  [5,] &quot;workmen&#39;s&quot;  &quot;workmen&quot;  &quot;s&quot; 
##  [6,] &quot;Let&#39;s&quot;      &quot;Let&quot;      &quot;s&quot; 
##  [7,] &quot;sun&#39;s&quot;      &quot;sun&quot;      &quot;s&quot; 
##  [8,] &quot;child&#39;s&quot;    &quot;child&quot;    &quot;s&quot; 
##  [9,] &quot;king&#39;s&quot;     &quot;king&quot;     &quot;s&quot; 
## [10,] &quot;It&#39;s&quot;       &quot;It&quot;       &quot;s&quot; 
## [11,] &quot;don&#39;t&quot;      &quot;don&quot;      &quot;t&quot; 
## [12,] &quot;queen&#39;s&quot;    &quot;queen&quot;    &quot;s&quot; 
## [13,] &quot;don&#39;t&quot;      &quot;don&quot;      &quot;t&quot; 
## [14,] &quot;pirate&#39;s&quot;   &quot;pirate&quot;   &quot;s&quot; 
## [15,] &quot;neighbor&#39;s&quot; &quot;neighbor&quot; &quot;s&quot;</code></pre>
</div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.4.4</span> Замена совпадений</h4>
<p>Функции <code>str_replace()</code> и <code>str_replace_all()</code> позволяют заменять совпадения новыми строками. Проще всего заменить шаблон фиксированной строкой.</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1185-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;pear&quot;</span>, <span class="st">&quot;banana&quot;</span>)</a>
<a class="sourceLine" id="cb1185-2" data-line-number="2"><span class="kw">str_replace</span>(x, <span class="st">&quot;[aeiou]&quot;</span>, <span class="st">&quot;-&quot;</span>)     <span class="co"># Заменяет первое совпадение</span></a></code></pre></div>
<pre><code>## [1] &quot;-pple&quot;  &quot;p-ar&quot;   &quot;b-nana&quot;</code></pre>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1187-1" data-line-number="1"><span class="kw">str_replace_all</span>(x, <span class="st">&quot;[aeiou]&quot;</span>, <span class="st">&quot;-&quot;</span>) <span class="co"># Заменяет все совпадения</span></a></code></pre></div>
<pre><code>## [1] &quot;-ppl-&quot;  &quot;p--r&quot;   &quot;b-n-n-&quot;</code></pre>
<p>С помощью последней функции можно выполнять множественную замену, предоставляя именованный вектор.</p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1189-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;1 house&quot;</span>, <span class="st">&quot;2 cars&quot;</span>, <span class="st">&quot;3 people&quot;</span>)</a>
<a class="sourceLine" id="cb1189-2" data-line-number="2"><span class="kw">str_replace_all</span>(x, <span class="kw">c</span>(<span class="st">&quot;1&quot;</span> =<span class="st"> &quot;one&quot;</span>, <span class="st">&quot;2&quot;</span> =<span class="st"> &quot;two&quot;</span>, <span class="st">&quot;3&quot;</span> =<span class="st"> &quot;three&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;one house&quot;    &quot;two cars&quot;     &quot;three people&quot;</code></pre>
<p>Вместо замены совпадений фиксированной строкой можно использовать обратные ссылки для вставки компонентов совпадений. В следующем коде мы меняем порядок следования второго и третьего слов.</p>
<div class="sourceCode" id="cb1191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1191-1" data-line-number="1">sentences <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-2" data-line-number="2"><span class="st">  </span><span class="kw">str_replace</span>(<span class="st">&quot;([^ ]+) ([^ ]+) ([^ ]+)&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">1 </span><span class="ch">\\</span><span class="st">3 </span><span class="ch">\\</span><span class="st">2&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1191-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] &quot;The canoe birch slid on the smooth planks.&quot; 
## [2] &quot;Glue sheet the to the dark blue background.&quot;
## [3] &quot;It&#39;s to easy tell the depth of a well.&quot;     
## [4] &quot;These a days chicken leg is a rare dish.&quot;   
## [5] &quot;Rice often is served in round bowls.&quot;</code></pre>
<div id="-14.4.4.1.1" class="section level5">
<h5><span class="header-section-number">3.5.4.4.1</span> Упражнение 14.4.4.1.1</h5>
<div class="question">
<p>Replace all forward slashes in a string with backslashes.</p>
</div>
<p>Напоминаю, чтобы вывести обратную косую черту, необходиму её трижды экранировать.</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1193-1" data-line-number="1"><span class="kw">str_replace_all</span>(<span class="st">&quot;C:/user/no_porn&quot;</span>, <span class="st">&quot;/&quot;</span>, <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;C:\\user\\no_porn&quot;</code></pre>
</div>
<div id="-14.4.4.1.2" class="section level5">
<h5><span class="header-section-number">3.5.4.4.2</span> Упражнение 14.4.4.1.2</h5>
<div class="question">
<p>Implement a simple version of <code>str_to_lower()</code> using <code>replace_all()</code>.</p>
</div>
<p>Функция <code>str_to_lower()</code> делает все буквы высшего регистра в малом регистре. Т.е. фактически необходимо заменить заглавные на маленькие буквы. Я использую короткую версию, но принцип масштабируется на весь алфавит</p>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1195-1" data-line-number="1"><span class="co"># Я пока что наиндусил в коде:</span></a>
<a class="sourceLine" id="cb1195-2" data-line-number="2">(lower &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(words, <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>=<span class="st">&quot;a&quot;</span>, <span class="st">&quot;B&quot;</span>=<span class="st">&quot;b&quot;</span>, <span class="st">&quot;C&quot;</span>=<span class="st">&quot;c&quot;</span>, <span class="st">&quot;D&quot;</span>=<span class="st">&quot;d&quot;</span>, <span class="st">&quot;E&quot;</span>=<span class="st">&quot;e&quot;</span>, <span class="st">&quot;F&quot;</span>=<span class="st">&quot;f&quot;</span>, <span class="st">&quot;G&quot;</span>=<span class="st">&quot;g&quot;</span>, <span class="st">&quot;H&quot;</span>=<span class="st">&quot;h&quot;</span>, <span class="st">&quot;I&quot;</span>=<span class="st">&quot;i&quot;</span>, <span class="st">&quot;J&quot;</span>=<span class="st">&quot;j&quot;</span>, <span class="st">&quot;K&quot;</span>=<span class="st">&quot;k&quot;</span>, <span class="st">&quot;L&quot;</span>=<span class="st">&quot;l&quot;</span>, <span class="st">&quot;M&quot;</span>=<span class="st">&quot;m&quot;</span>, <span class="st">&quot;N&quot;</span>=<span class="st">&quot;n&quot;</span>, <span class="st">&quot;O&quot;</span>=<span class="st">&quot;o&quot;</span>, <span class="st">&quot;P&quot;</span>=<span class="st">&quot;p&quot;</span>, <span class="st">&quot;Q&quot;</span>=<span class="st">&quot;q&quot;</span>, <span class="st">&quot;R&quot;</span>=<span class="st">&quot;r&quot;</span>, <span class="st">&quot;S&quot;</span>=<span class="st">&quot;s&quot;</span>, <span class="st">&quot;T&quot;</span>=<span class="st">&quot;t&quot;</span>, <span class="st">&quot;U&quot;</span>=<span class="st">&quot;u&quot;</span>, <span class="st">&quot;V&quot;</span>=<span class="st">&quot;v&quot;</span>, <span class="st">&quot;W&quot;</span>=<span class="st">&quot;w&quot;</span>, <span class="st">&quot;X&quot;</span>=<span class="st">&quot;x&quot;</span>, <span class="st">&quot;Y&quot;</span>=<span class="st">&quot;y&quot;</span>, <span class="st">&quot;Z&quot;</span>=<span class="st">&quot;z&quot;</span>)))</a></code></pre></div>
<pre><code>##   [1] &quot;a&quot;           &quot;able&quot;        &quot;about&quot;       &quot;absolute&quot;    &quot;accept&quot;     
##   [6] &quot;account&quot;     &quot;achieve&quot;     &quot;across&quot;      &quot;act&quot;         &quot;active&quot;     
##  [11] &quot;actual&quot;      &quot;add&quot;         &quot;address&quot;     &quot;admit&quot;       &quot;advertise&quot;  
##  [16] &quot;affect&quot;      &quot;afford&quot;      &quot;after&quot;       &quot;afternoon&quot;   &quot;again&quot;      
##  [21] &quot;against&quot;     &quot;age&quot;         &quot;agent&quot;       &quot;ago&quot;         &quot;agree&quot;      
##  [26] &quot;air&quot;         &quot;all&quot;         &quot;allow&quot;       &quot;almost&quot;      &quot;along&quot;      
##  [31] &quot;already&quot;     &quot;alright&quot;     &quot;also&quot;        &quot;although&quot;    &quot;always&quot;     
##  [36] &quot;america&quot;     &quot;amount&quot;      &quot;and&quot;         &quot;another&quot;     &quot;answer&quot;     
##  [41] &quot;any&quot;         &quot;apart&quot;       &quot;apparent&quot;    &quot;appear&quot;      &quot;apply&quot;      
##  [46] &quot;appoint&quot;     &quot;approach&quot;    &quot;appropriate&quot; &quot;area&quot;        &quot;argue&quot;      
##  [51] &quot;arm&quot;         &quot;around&quot;      &quot;arrange&quot;     &quot;art&quot;         &quot;as&quot;         
##  [56] &quot;ask&quot;         &quot;associate&quot;   &quot;assume&quot;      &quot;at&quot;          &quot;attend&quot;     
##  [61] &quot;authority&quot;   &quot;available&quot;   &quot;aware&quot;       &quot;away&quot;        &quot;awful&quot;      
##  [66] &quot;baby&quot;        &quot;back&quot;        &quot;bad&quot;         &quot;bag&quot;         &quot;balance&quot;    
##  [71] &quot;ball&quot;        &quot;bank&quot;        &quot;bar&quot;         &quot;base&quot;        &quot;basis&quot;      
##  [76] &quot;be&quot;          &quot;bear&quot;        &quot;beat&quot;        &quot;beauty&quot;      &quot;because&quot;    
##  [81] &quot;become&quot;      &quot;bed&quot;         &quot;before&quot;      &quot;begin&quot;       &quot;behind&quot;     
##  [86] &quot;believe&quot;     &quot;benefit&quot;     &quot;best&quot;        &quot;bet&quot;         &quot;between&quot;    
##  [91] &quot;big&quot;         &quot;bill&quot;        &quot;birth&quot;       &quot;bit&quot;         &quot;black&quot;      
##  [96] &quot;bloke&quot;       &quot;blood&quot;       &quot;blow&quot;        &quot;blue&quot;        &quot;board&quot;      
## [101] &quot;boat&quot;        &quot;body&quot;        &quot;book&quot;        &quot;both&quot;        &quot;bother&quot;     
## [106] &quot;bottle&quot;      &quot;bottom&quot;      &quot;box&quot;         &quot;boy&quot;         &quot;break&quot;      
## [111] &quot;brief&quot;       &quot;brilliant&quot;   &quot;bring&quot;       &quot;britain&quot;     &quot;brother&quot;    
## [116] &quot;budget&quot;      &quot;build&quot;       &quot;bus&quot;         &quot;business&quot;    &quot;busy&quot;       
## [121] &quot;but&quot;         &quot;buy&quot;         &quot;by&quot;          &quot;cake&quot;        &quot;call&quot;       
## [126] &quot;can&quot;         &quot;car&quot;         &quot;card&quot;        &quot;care&quot;        &quot;carry&quot;      
## [131] &quot;case&quot;        &quot;cat&quot;         &quot;catch&quot;       &quot;cause&quot;       &quot;cent&quot;       
## [136] &quot;centre&quot;      &quot;certain&quot;     &quot;chair&quot;       &quot;chairman&quot;    &quot;chance&quot;     
## [141] &quot;change&quot;      &quot;chap&quot;        &quot;character&quot;   &quot;charge&quot;      &quot;cheap&quot;      
## [146] &quot;check&quot;       &quot;child&quot;       &quot;choice&quot;      &quot;choose&quot;      &quot;christ&quot;     
## [151] &quot;christmas&quot;   &quot;church&quot;      &quot;city&quot;        &quot;claim&quot;       &quot;class&quot;      
## [156] &quot;clean&quot;       &quot;clear&quot;       &quot;client&quot;      &quot;clock&quot;       &quot;close&quot;      
## [161] &quot;closes&quot;      &quot;clothe&quot;      &quot;club&quot;        &quot;coffee&quot;      &quot;cold&quot;       
## [166] &quot;colleague&quot;   &quot;collect&quot;     &quot;college&quot;     &quot;colour&quot;      &quot;come&quot;       
## [171] &quot;comment&quot;     &quot;commit&quot;      &quot;committee&quot;   &quot;common&quot;      &quot;community&quot;  
## [176] &quot;company&quot;     &quot;compare&quot;     &quot;complete&quot;    &quot;compute&quot;     &quot;concern&quot;    
## [181] &quot;condition&quot;   &quot;confer&quot;      &quot;consider&quot;    &quot;consult&quot;     &quot;contact&quot;    
## [186] &quot;continue&quot;    &quot;contract&quot;    &quot;control&quot;     &quot;converse&quot;    &quot;cook&quot;       
## [191] &quot;copy&quot;        &quot;corner&quot;      &quot;correct&quot;     &quot;cost&quot;        &quot;could&quot;      
## [196] &quot;council&quot;     &quot;count&quot;       &quot;country&quot;     &quot;county&quot;      &quot;couple&quot;     
## [201] &quot;course&quot;      &quot;court&quot;       &quot;cover&quot;       &quot;create&quot;      &quot;cross&quot;      
## [206] &quot;cup&quot;         &quot;current&quot;     &quot;cut&quot;         &quot;dad&quot;         &quot;danger&quot;     
## [211] &quot;date&quot;        &quot;day&quot;         &quot;dead&quot;        &quot;deal&quot;        &quot;dear&quot;       
## [216] &quot;debate&quot;      &quot;decide&quot;      &quot;decision&quot;    &quot;deep&quot;        &quot;definite&quot;   
## [221] &quot;degree&quot;      &quot;department&quot;  &quot;depend&quot;      &quot;describe&quot;    &quot;design&quot;     
## [226] &quot;detail&quot;      &quot;develop&quot;     &quot;die&quot;         &quot;difference&quot;  &quot;difficult&quot;  
## [231] &quot;dinner&quot;      &quot;direct&quot;      &quot;discuss&quot;     &quot;district&quot;    &quot;divide&quot;     
## [236] &quot;do&quot;          &quot;doctor&quot;      &quot;document&quot;    &quot;dog&quot;         &quot;door&quot;       
## [241] &quot;double&quot;      &quot;doubt&quot;       &quot;down&quot;        &quot;draw&quot;        &quot;dress&quot;      
## [246] &quot;drink&quot;       &quot;drive&quot;       &quot;drop&quot;        &quot;dry&quot;         &quot;due&quot;        
## [251] &quot;during&quot;      &quot;each&quot;        &quot;early&quot;       &quot;east&quot;        &quot;easy&quot;       
## [256] &quot;eat&quot;         &quot;economy&quot;     &quot;educate&quot;     &quot;effect&quot;      &quot;egg&quot;        
## [261] &quot;eight&quot;       &quot;either&quot;      &quot;elect&quot;       &quot;electric&quot;    &quot;eleven&quot;     
## [266] &quot;else&quot;        &quot;employ&quot;      &quot;encourage&quot;   &quot;end&quot;         &quot;engine&quot;     
## [271] &quot;english&quot;     &quot;enjoy&quot;       &quot;enough&quot;      &quot;enter&quot;       &quot;environment&quot;
## [276] &quot;equal&quot;       &quot;especial&quot;    &quot;europe&quot;      &quot;even&quot;        &quot;evening&quot;    
## [281] &quot;ever&quot;        &quot;every&quot;       &quot;evidence&quot;    &quot;exact&quot;       &quot;example&quot;    
## [286] &quot;except&quot;      &quot;excuse&quot;      &quot;exercise&quot;    &quot;exist&quot;       &quot;expect&quot;     
## [291] &quot;expense&quot;     &quot;experience&quot;  &quot;explain&quot;     &quot;express&quot;     &quot;extra&quot;      
## [296] &quot;eye&quot;         &quot;face&quot;        &quot;fact&quot;        &quot;fair&quot;        &quot;fall&quot;       
## [301] &quot;family&quot;      &quot;far&quot;         &quot;farm&quot;        &quot;fast&quot;        &quot;father&quot;     
## [306] &quot;favour&quot;      &quot;feed&quot;        &quot;feel&quot;        &quot;few&quot;         &quot;field&quot;      
## [311] &quot;fight&quot;       &quot;figure&quot;      &quot;file&quot;        &quot;fill&quot;        &quot;film&quot;       
## [316] &quot;final&quot;       &quot;finance&quot;     &quot;find&quot;        &quot;fine&quot;        &quot;finish&quot;     
## [321] &quot;fire&quot;        &quot;first&quot;       &quot;fish&quot;        &quot;fit&quot;         &quot;five&quot;       
## [326] &quot;flat&quot;        &quot;floor&quot;       &quot;fly&quot;         &quot;follow&quot;      &quot;food&quot;       
## [331] &quot;foot&quot;        &quot;for&quot;         &quot;force&quot;       &quot;forget&quot;      &quot;form&quot;       
## [336] &quot;fortune&quot;     &quot;forward&quot;     &quot;four&quot;        &quot;france&quot;      &quot;free&quot;       
## [341] &quot;friday&quot;      &quot;friend&quot;      &quot;from&quot;        &quot;front&quot;       &quot;full&quot;       
## [346] &quot;fun&quot;         &quot;function&quot;    &quot;fund&quot;        &quot;further&quot;     &quot;future&quot;     
## [351] &quot;game&quot;        &quot;garden&quot;      &quot;gas&quot;         &quot;general&quot;     &quot;germany&quot;    
## [356] &quot;get&quot;         &quot;girl&quot;        &quot;give&quot;        &quot;glass&quot;       &quot;go&quot;         
## [361] &quot;god&quot;         &quot;good&quot;        &quot;goodbye&quot;     &quot;govern&quot;      &quot;grand&quot;      
## [366] &quot;grant&quot;       &quot;great&quot;       &quot;green&quot;       &quot;ground&quot;      &quot;group&quot;      
## [371] &quot;grow&quot;        &quot;guess&quot;       &quot;guy&quot;         &quot;hair&quot;        &quot;half&quot;       
## [376] &quot;hall&quot;        &quot;hand&quot;        &quot;hang&quot;        &quot;happen&quot;      &quot;happy&quot;      
## [381] &quot;hard&quot;        &quot;hate&quot;        &quot;have&quot;        &quot;he&quot;          &quot;head&quot;       
## [386] &quot;health&quot;      &quot;hear&quot;        &quot;heart&quot;       &quot;heat&quot;        &quot;heavy&quot;      
## [391] &quot;hell&quot;        &quot;help&quot;        &quot;here&quot;        &quot;high&quot;        &quot;history&quot;    
## [396] &quot;hit&quot;         &quot;hold&quot;        &quot;holiday&quot;     &quot;home&quot;        &quot;honest&quot;     
## [401] &quot;hope&quot;        &quot;horse&quot;       &quot;hospital&quot;    &quot;hot&quot;         &quot;hour&quot;       
## [406] &quot;house&quot;       &quot;how&quot;         &quot;however&quot;     &quot;hullo&quot;       &quot;hundred&quot;    
## [411] &quot;husband&quot;     &quot;idea&quot;        &quot;identify&quot;    &quot;if&quot;          &quot;imagine&quot;    
## [416] &quot;important&quot;   &quot;improve&quot;     &quot;in&quot;          &quot;include&quot;     &quot;income&quot;     
## [421] &quot;increase&quot;    &quot;indeed&quot;      &quot;individual&quot;  &quot;industry&quot;    &quot;inform&quot;     
## [426] &quot;inside&quot;      &quot;instead&quot;     &quot;insure&quot;      &quot;interest&quot;    &quot;into&quot;       
## [431] &quot;introduce&quot;   &quot;invest&quot;      &quot;involve&quot;     &quot;issue&quot;       &quot;it&quot;         
## [436] &quot;item&quot;        &quot;jesus&quot;       &quot;job&quot;         &quot;join&quot;        &quot;judge&quot;      
## [441] &quot;jump&quot;        &quot;just&quot;        &quot;keep&quot;        &quot;key&quot;         &quot;kid&quot;        
## [446] &quot;kill&quot;        &quot;kind&quot;        &quot;king&quot;        &quot;kitchen&quot;     &quot;knock&quot;      
## [451] &quot;know&quot;        &quot;labour&quot;      &quot;lad&quot;         &quot;lady&quot;        &quot;land&quot;       
## [456] &quot;language&quot;    &quot;large&quot;       &quot;last&quot;        &quot;late&quot;        &quot;laugh&quot;      
## [461] &quot;law&quot;         &quot;lay&quot;         &quot;lead&quot;        &quot;learn&quot;       &quot;leave&quot;      
## [466] &quot;left&quot;        &quot;leg&quot;         &quot;less&quot;        &quot;let&quot;         &quot;letter&quot;     
## [471] &quot;level&quot;       &quot;lie&quot;         &quot;life&quot;        &quot;light&quot;       &quot;like&quot;       
## [476] &quot;likely&quot;      &quot;limit&quot;       &quot;line&quot;        &quot;link&quot;        &quot;list&quot;       
## [481] &quot;listen&quot;      &quot;little&quot;      &quot;live&quot;        &quot;load&quot;        &quot;local&quot;      
## [486] &quot;lock&quot;        &quot;london&quot;      &quot;long&quot;        &quot;look&quot;        &quot;lord&quot;       
## [491] &quot;lose&quot;        &quot;lot&quot;         &quot;love&quot;        &quot;low&quot;         &quot;luck&quot;       
## [496] &quot;lunch&quot;       &quot;machine&quot;     &quot;main&quot;        &quot;major&quot;       &quot;make&quot;       
## [501] &quot;man&quot;         &quot;manage&quot;      &quot;many&quot;        &quot;mark&quot;        &quot;market&quot;     
## [506] &quot;marry&quot;       &quot;match&quot;       &quot;matter&quot;      &quot;may&quot;         &quot;maybe&quot;      
## [511] &quot;mean&quot;        &quot;meaning&quot;     &quot;measure&quot;     &quot;meet&quot;        &quot;member&quot;     
## [516] &quot;mention&quot;     &quot;middle&quot;      &quot;might&quot;       &quot;mile&quot;        &quot;milk&quot;       
## [521] &quot;million&quot;     &quot;mind&quot;        &quot;minister&quot;    &quot;minus&quot;       &quot;minute&quot;     
## [526] &quot;miss&quot;        &quot;mister&quot;      &quot;moment&quot;      &quot;monday&quot;      &quot;money&quot;      
## [531] &quot;month&quot;       &quot;more&quot;        &quot;morning&quot;     &quot;most&quot;        &quot;mother&quot;     
## [536] &quot;motion&quot;      &quot;move&quot;        &quot;mrs&quot;         &quot;much&quot;        &quot;music&quot;      
## [541] &quot;must&quot;        &quot;name&quot;        &quot;nation&quot;      &quot;nature&quot;      &quot;near&quot;       
## [546] &quot;necessary&quot;   &quot;need&quot;        &quot;never&quot;       &quot;new&quot;         &quot;news&quot;       
## [551] &quot;next&quot;        &quot;nice&quot;        &quot;night&quot;       &quot;nine&quot;        &quot;no&quot;         
## [556] &quot;non&quot;         &quot;none&quot;        &quot;normal&quot;      &quot;north&quot;       &quot;not&quot;        
## [561] &quot;note&quot;        &quot;notice&quot;      &quot;now&quot;         &quot;number&quot;      &quot;obvious&quot;    
## [566] &quot;occasion&quot;    &quot;odd&quot;         &quot;of&quot;          &quot;off&quot;         &quot;offer&quot;      
## [571] &quot;office&quot;      &quot;often&quot;       &quot;okay&quot;        &quot;old&quot;         &quot;on&quot;         
## [576] &quot;once&quot;        &quot;one&quot;         &quot;only&quot;        &quot;open&quot;        &quot;operate&quot;    
## [581] &quot;opportunity&quot; &quot;oppose&quot;      &quot;or&quot;          &quot;order&quot;       &quot;organize&quot;   
## [586] &quot;original&quot;    &quot;other&quot;       &quot;otherwise&quot;   &quot;ought&quot;       &quot;out&quot;        
## [591] &quot;over&quot;        &quot;own&quot;         &quot;pack&quot;        &quot;page&quot;        &quot;paint&quot;      
## [596] &quot;pair&quot;        &quot;paper&quot;       &quot;paragraph&quot;   &quot;pardon&quot;      &quot;parent&quot;     
## [601] &quot;park&quot;        &quot;part&quot;        &quot;particular&quot;  &quot;party&quot;       &quot;pass&quot;       
## [606] &quot;past&quot;        &quot;pay&quot;         &quot;pence&quot;       &quot;pension&quot;     &quot;people&quot;     
## [611] &quot;per&quot;         &quot;percent&quot;     &quot;perfect&quot;     &quot;perhaps&quot;     &quot;period&quot;     
## [616] &quot;person&quot;      &quot;photograph&quot;  &quot;pick&quot;        &quot;picture&quot;     &quot;piece&quot;      
## [621] &quot;place&quot;       &quot;plan&quot;        &quot;play&quot;        &quot;please&quot;      &quot;plus&quot;       
## [626] &quot;point&quot;       &quot;police&quot;      &quot;policy&quot;      &quot;politic&quot;     &quot;poor&quot;       
## [631] &quot;position&quot;    &quot;positive&quot;    &quot;possible&quot;    &quot;post&quot;        &quot;pound&quot;      
## [636] &quot;power&quot;       &quot;practise&quot;    &quot;prepare&quot;     &quot;present&quot;     &quot;press&quot;      
## [641] &quot;pressure&quot;    &quot;presume&quot;     &quot;pretty&quot;      &quot;previous&quot;    &quot;price&quot;      
## [646] &quot;print&quot;       &quot;private&quot;     &quot;probable&quot;    &quot;problem&quot;     &quot;proceed&quot;    
## [651] &quot;process&quot;     &quot;produce&quot;     &quot;product&quot;     &quot;programme&quot;   &quot;project&quot;    
## [656] &quot;proper&quot;      &quot;propose&quot;     &quot;protect&quot;     &quot;provide&quot;     &quot;public&quot;     
## [661] &quot;pull&quot;        &quot;purpose&quot;     &quot;push&quot;        &quot;put&quot;         &quot;quality&quot;    
## [666] &quot;quarter&quot;     &quot;question&quot;    &quot;quick&quot;       &quot;quid&quot;        &quot;quiet&quot;      
## [671] &quot;quite&quot;       &quot;radio&quot;       &quot;rail&quot;        &quot;raise&quot;       &quot;range&quot;      
## [676] &quot;rate&quot;        &quot;rather&quot;      &quot;read&quot;        &quot;ready&quot;       &quot;real&quot;       
## [681] &quot;realise&quot;     &quot;really&quot;      &quot;reason&quot;      &quot;receive&quot;     &quot;recent&quot;     
## [686] &quot;reckon&quot;      &quot;recognize&quot;   &quot;recommend&quot;   &quot;record&quot;      &quot;red&quot;        
## [691] &quot;reduce&quot;      &quot;refer&quot;       &quot;regard&quot;      &quot;region&quot;      &quot;relation&quot;   
## [696] &quot;remember&quot;    &quot;report&quot;      &quot;represent&quot;   &quot;require&quot;     &quot;research&quot;   
## [701] &quot;resource&quot;    &quot;respect&quot;     &quot;responsible&quot; &quot;rest&quot;        &quot;result&quot;     
## [706] &quot;return&quot;      &quot;rid&quot;         &quot;right&quot;       &quot;ring&quot;        &quot;rise&quot;       
## [711] &quot;road&quot;        &quot;role&quot;        &quot;roll&quot;        &quot;room&quot;        &quot;round&quot;      
## [716] &quot;rule&quot;        &quot;run&quot;         &quot;safe&quot;        &quot;sale&quot;        &quot;same&quot;       
## [721] &quot;saturday&quot;    &quot;save&quot;        &quot;say&quot;         &quot;scheme&quot;      &quot;school&quot;     
## [726] &quot;science&quot;     &quot;score&quot;       &quot;scotland&quot;    &quot;seat&quot;        &quot;second&quot;     
## [731] &quot;secretary&quot;   &quot;section&quot;     &quot;secure&quot;      &quot;see&quot;         &quot;seem&quot;       
## [736] &quot;self&quot;        &quot;sell&quot;        &quot;send&quot;        &quot;sense&quot;       &quot;separate&quot;   
## [741] &quot;serious&quot;     &quot;serve&quot;       &quot;service&quot;     &quot;set&quot;         &quot;settle&quot;     
## [746] &quot;seven&quot;       &quot;sex&quot;         &quot;shall&quot;       &quot;share&quot;       &quot;she&quot;        
## [751] &quot;sheet&quot;       &quot;shoe&quot;        &quot;shoot&quot;       &quot;shop&quot;        &quot;short&quot;      
## [756] &quot;should&quot;      &quot;show&quot;        &quot;shut&quot;        &quot;sick&quot;        &quot;side&quot;       
## [761] &quot;sign&quot;        &quot;similar&quot;     &quot;simple&quot;      &quot;since&quot;       &quot;sing&quot;       
## [766] &quot;single&quot;      &quot;sir&quot;         &quot;sister&quot;      &quot;sit&quot;         &quot;site&quot;       
## [771] &quot;situate&quot;     &quot;six&quot;         &quot;size&quot;        &quot;sleep&quot;       &quot;slight&quot;     
## [776] &quot;slow&quot;        &quot;small&quot;       &quot;smoke&quot;       &quot;so&quot;          &quot;social&quot;     
## [781] &quot;society&quot;     &quot;some&quot;        &quot;son&quot;         &quot;soon&quot;        &quot;sorry&quot;      
## [786] &quot;sort&quot;        &quot;sound&quot;       &quot;south&quot;       &quot;space&quot;       &quot;speak&quot;      
## [791] &quot;special&quot;     &quot;specific&quot;    &quot;speed&quot;       &quot;spell&quot;       &quot;spend&quot;      
## [796] &quot;square&quot;      &quot;staff&quot;       &quot;stage&quot;       &quot;stairs&quot;      &quot;stand&quot;      
## [801] &quot;standard&quot;    &quot;start&quot;       &quot;state&quot;       &quot;station&quot;     &quot;stay&quot;       
## [806] &quot;step&quot;        &quot;stick&quot;       &quot;still&quot;       &quot;stop&quot;        &quot;story&quot;      
## [811] &quot;straight&quot;    &quot;strategy&quot;    &quot;street&quot;      &quot;strike&quot;      &quot;strong&quot;     
## [816] &quot;structure&quot;   &quot;student&quot;     &quot;study&quot;       &quot;stuff&quot;       &quot;stupid&quot;     
## [821] &quot;subject&quot;     &quot;succeed&quot;     &quot;such&quot;        &quot;sudden&quot;      &quot;suggest&quot;    
## [826] &quot;suit&quot;        &quot;summer&quot;      &quot;sun&quot;         &quot;sunday&quot;      &quot;supply&quot;     
## [831] &quot;support&quot;     &quot;suppose&quot;     &quot;sure&quot;        &quot;surprise&quot;    &quot;switch&quot;     
## [836] &quot;system&quot;      &quot;table&quot;       &quot;take&quot;        &quot;talk&quot;        &quot;tape&quot;       
## [841] &quot;tax&quot;         &quot;tea&quot;         &quot;teach&quot;       &quot;team&quot;        &quot;telephone&quot;  
## [846] &quot;television&quot;  &quot;tell&quot;        &quot;ten&quot;         &quot;tend&quot;        &quot;term&quot;       
## [851] &quot;terrible&quot;    &quot;test&quot;        &quot;than&quot;        &quot;thank&quot;       &quot;the&quot;        
## [856] &quot;then&quot;        &quot;there&quot;       &quot;therefore&quot;   &quot;they&quot;        &quot;thing&quot;      
## [861] &quot;think&quot;       &quot;thirteen&quot;    &quot;thirty&quot;      &quot;this&quot;        &quot;thou&quot;       
## [866] &quot;though&quot;      &quot;thousand&quot;    &quot;three&quot;       &quot;through&quot;     &quot;throw&quot;      
## [871] &quot;thursday&quot;    &quot;tie&quot;         &quot;time&quot;        &quot;to&quot;          &quot;today&quot;      
## [876] &quot;together&quot;    &quot;tomorrow&quot;    &quot;tonight&quot;     &quot;too&quot;         &quot;top&quot;        
## [881] &quot;total&quot;       &quot;touch&quot;       &quot;toward&quot;      &quot;town&quot;        &quot;trade&quot;      
## [886] &quot;traffic&quot;     &quot;train&quot;       &quot;transport&quot;   &quot;travel&quot;      &quot;treat&quot;      
## [891] &quot;tree&quot;        &quot;trouble&quot;     &quot;true&quot;        &quot;trust&quot;       &quot;try&quot;        
## [896] &quot;tuesday&quot;     &quot;turn&quot;        &quot;twelve&quot;      &quot;twenty&quot;      &quot;two&quot;        
## [901] &quot;type&quot;        &quot;under&quot;       &quot;understand&quot;  &quot;union&quot;       &quot;unit&quot;       
## [906] &quot;unite&quot;       &quot;university&quot;  &quot;unless&quot;      &quot;until&quot;       &quot;up&quot;         
## [911] &quot;upon&quot;        &quot;use&quot;         &quot;usual&quot;       &quot;value&quot;       &quot;various&quot;    
## [916] &quot;very&quot;        &quot;video&quot;       &quot;view&quot;        &quot;village&quot;     &quot;visit&quot;      
## [921] &quot;vote&quot;        &quot;wage&quot;        &quot;wait&quot;        &quot;walk&quot;        &quot;wall&quot;       
## [926] &quot;want&quot;        &quot;war&quot;         &quot;warm&quot;        &quot;wash&quot;        &quot;waste&quot;      
## [931] &quot;watch&quot;       &quot;water&quot;       &quot;way&quot;         &quot;we&quot;          &quot;wear&quot;       
## [936] &quot;wednesday&quot;   &quot;wee&quot;         &quot;week&quot;        &quot;weigh&quot;       &quot;welcome&quot;    
## [941] &quot;well&quot;        &quot;west&quot;        &quot;what&quot;        &quot;when&quot;        &quot;where&quot;      
## [946] &quot;whether&quot;     &quot;which&quot;       &quot;while&quot;       &quot;white&quot;       &quot;who&quot;        
## [951] &quot;whole&quot;       &quot;why&quot;         &quot;wide&quot;        &quot;wife&quot;        &quot;will&quot;       
## [956] &quot;win&quot;         &quot;wind&quot;        &quot;window&quot;      &quot;wish&quot;        &quot;with&quot;       
## [961] &quot;within&quot;      &quot;without&quot;     &quot;woman&quot;       &quot;wonder&quot;      &quot;wood&quot;       
## [966] &quot;word&quot;        &quot;work&quot;        &quot;world&quot;       &quot;worry&quot;       &quot;worse&quot;      
## [971] &quot;worth&quot;       &quot;would&quot;       &quot;write&quot;       &quot;wrong&quot;       &quot;year&quot;       
## [976] &quot;yes&quot;         &quot;yesterday&quot;   &quot;yet&quot;         &quot;you&quot;         &quot;young&quot;</code></pre>
</div>
<div id="-14.4.4.1.3" class="section level5">
<h5><span class="header-section-number">3.5.4.4.3</span> Упражнение 14.4.4.1.3</h5>
<div class="question">
<p>Switch the first and last letters in words. Which of those strings are still words?</p>
</div>
<p>Будем действовать как в примере, разобранном в книге, когда мы меняли порядок групп. В этой задаче тоже будет три группы.</p>
<ul>
<li><p>Первая группа — это первый буквенный символ в слове</p></li>
<li><p>Вторая группа — это любой символ, встречающийся ноль или более раз</p></li>
<li><p>Третья группа — это последний буквенный символ в слове</p></li>
</ul>
<div class="sourceCode" id="cb1197"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1197-1" data-line-number="1">swap &lt;-<span class="st"> </span><span class="kw">str_replace_all</span>(words, <span class="st">&quot;^([A-Za-z])(.*)([a-z])$&quot;</span>, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">3</span><span class="ch">\\</span><span class="st">2</span><span class="ch">\\</span><span class="st">1&quot;</span>)</a>
<a class="sourceLine" id="cb1197-2" data-line-number="2">swap</a></code></pre></div>
<pre><code>##   [1] &quot;a&quot;           &quot;ebla&quot;        &quot;tboua&quot;       &quot;ebsoluta&quot;    &quot;tccepa&quot;     
##   [6] &quot;tccouna&quot;     &quot;echieva&quot;     &quot;scrosa&quot;      &quot;tca&quot;         &quot;ectiva&quot;     
##  [11] &quot;lctuaa&quot;      &quot;dda&quot;         &quot;sddresa&quot;     &quot;tdmia&quot;       &quot;edvertisa&quot;  
##  [16] &quot;tffeca&quot;      &quot;dffora&quot;      &quot;rftea&quot;       &quot;nfternooa&quot;   &quot;ngaia&quot;      
##  [21] &quot;tgainsa&quot;     &quot;ega&quot;         &quot;tgena&quot;       &quot;oga&quot;         &quot;egrea&quot;      
##  [26] &quot;ria&quot;         &quot;lla&quot;         &quot;wlloa&quot;       &quot;tlmosa&quot;      &quot;glona&quot;      
##  [31] &quot;ylreada&quot;     &quot;tlrigha&quot;     &quot;olsa&quot;        &quot;hlthouga&quot;    &quot;slwaya&quot;     
##  [36] &quot;america&quot;     &quot;tmouna&quot;      &quot;dna&quot;         &quot;rnothea&quot;     &quot;rnswea&quot;     
##  [41] &quot;yna&quot;         &quot;tpara&quot;       &quot;tpparena&quot;    &quot;rppeaa&quot;      &quot;yppla&quot;      
##  [46] &quot;tppoina&quot;     &quot;hpproaca&quot;    &quot;eppropriata&quot; &quot;area&quot;        &quot;ergua&quot;      
##  [51] &quot;mra&quot;         &quot;drouna&quot;      &quot;erranga&quot;     &quot;tra&quot;         &quot;sa&quot;         
##  [56] &quot;ksa&quot;         &quot;essociata&quot;   &quot;essuma&quot;      &quot;ta&quot;          &quot;dttena&quot;     
##  [61] &quot;yuthorita&quot;   &quot;evailabla&quot;   &quot;ewara&quot;       &quot;ywaa&quot;        &quot;lwfua&quot;      
##  [66] &quot;yabb&quot;        &quot;kacb&quot;        &quot;dab&quot;         &quot;gab&quot;         &quot;ealancb&quot;    
##  [71] &quot;lalb&quot;        &quot;kanb&quot;        &quot;rab&quot;         &quot;easb&quot;        &quot;sasib&quot;      
##  [76] &quot;eb&quot;          &quot;reab&quot;        &quot;teab&quot;        &quot;yeautb&quot;      &quot;eecausb&quot;    
##  [81] &quot;eecomb&quot;      &quot;deb&quot;         &quot;eeforb&quot;      &quot;negib&quot;       &quot;dehinb&quot;     
##  [86] &quot;eelievb&quot;     &quot;tenefib&quot;     &quot;tesb&quot;        &quot;teb&quot;         &quot;netweeb&quot;    
##  [91] &quot;gib&quot;         &quot;lilb&quot;        &quot;hirtb&quot;       &quot;tib&quot;         &quot;klacb&quot;      
##  [96] &quot;elokb&quot;       &quot;dloob&quot;       &quot;wlob&quot;        &quot;elub&quot;        &quot;doarb&quot;      
## [101] &quot;toab&quot;        &quot;yodb&quot;        &quot;koob&quot;        &quot;hotb&quot;        &quot;rotheb&quot;     
## [106] &quot;eottlb&quot;      &quot;mottob&quot;      &quot;xob&quot;         &quot;yob&quot;         &quot;kreab&quot;      
## [111] &quot;frieb&quot;       &quot;trillianb&quot;   &quot;grinb&quot;       &quot;nritaib&quot;     &quot;rrotheb&quot;    
## [116] &quot;tudgeb&quot;      &quot;duilb&quot;       &quot;sub&quot;         &quot;susinesb&quot;    &quot;yusb&quot;       
## [121] &quot;tub&quot;         &quot;yub&quot;         &quot;yb&quot;          &quot;eakc&quot;        &quot;lalc&quot;       
## [126] &quot;nac&quot;         &quot;rac&quot;         &quot;darc&quot;        &quot;earc&quot;        &quot;yarrc&quot;      
## [131] &quot;easc&quot;        &quot;tac&quot;         &quot;hatcc&quot;       &quot;eausc&quot;       &quot;tenc&quot;       
## [136] &quot;eentrc&quot;      &quot;nertaic&quot;     &quot;rhaic&quot;       &quot;nhairmac&quot;    &quot;ehancc&quot;     
## [141] &quot;ehangc&quot;      &quot;phac&quot;        &quot;rharactec&quot;   &quot;ehargc&quot;      &quot;pheac&quot;      
## [146] &quot;khecc&quot;       &quot;dhilc&quot;       &quot;ehoicc&quot;      &quot;ehoosc&quot;      &quot;thrisC&quot;     
## [151] &quot;shristmaC&quot;   &quot;hhurcc&quot;      &quot;yitc&quot;        &quot;mlaic&quot;       &quot;slasc&quot;      
## [156] &quot;nleac&quot;       &quot;rleac&quot;       &quot;tlienc&quot;      &quot;klocc&quot;       &quot;elosc&quot;      
## [161] &quot;slosec&quot;      &quot;elothc&quot;      &quot;bluc&quot;        &quot;eoffec&quot;      &quot;dolc&quot;       
## [166] &quot;eolleaguc&quot;   &quot;tollecc&quot;     &quot;eollegc&quot;     &quot;rolouc&quot;      &quot;eomc&quot;       
## [171] &quot;tommenc&quot;     &quot;tommic&quot;      &quot;eommittec&quot;   &quot;nommoc&quot;      &quot;yommunitc&quot;  
## [176] &quot;yompanc&quot;     &quot;eomparc&quot;     &quot;eompletc&quot;    &quot;eomputc&quot;     &quot;noncerc&quot;    
## [181] &quot;nonditioc&quot;   &quot;ronfec&quot;      &quot;ronsidec&quot;    &quot;tonsulc&quot;     &quot;tontacc&quot;    
## [186] &quot;eontinuc&quot;    &quot;tontracc&quot;    &quot;lontroc&quot;     &quot;eonversc&quot;    &quot;kooc&quot;       
## [191] &quot;yopc&quot;        &quot;rornec&quot;      &quot;torrecc&quot;     &quot;tosc&quot;        &quot;doulc&quot;      
## [196] &quot;louncic&quot;     &quot;tounc&quot;       &quot;yountrc&quot;     &quot;yountc&quot;      &quot;eouplc&quot;     
## [201] &quot;eoursc&quot;      &quot;tourc&quot;       &quot;rovec&quot;       &quot;ereatc&quot;      &quot;srosc&quot;      
## [206] &quot;puc&quot;         &quot;turrenc&quot;     &quot;tuc&quot;         &quot;dad&quot;         &quot;ranged&quot;     
## [211] &quot;eatd&quot;        &quot;yad&quot;         &quot;dead&quot;        &quot;lead&quot;        &quot;read&quot;       
## [216] &quot;eebatd&quot;      &quot;eecidd&quot;      &quot;necisiod&quot;    &quot;peed&quot;        &quot;eefinitd&quot;   
## [221] &quot;eegred&quot;      &quot;tepartmend&quot;  &quot;depend&quot;      &quot;eescribd&quot;    &quot;nesigd&quot;     
## [226] &quot;letaid&quot;      &quot;pevelod&quot;     &quot;eid&quot;         &quot;eifferencd&quot;  &quot;tifficuld&quot;  
## [231] &quot;rinned&quot;      &quot;tirecd&quot;      &quot;siscusd&quot;     &quot;tistricd&quot;    &quot;eividd&quot;     
## [236] &quot;od&quot;          &quot;roctod&quot;      &quot;tocumend&quot;    &quot;god&quot;         &quot;rood&quot;       
## [241] &quot;eoubld&quot;      &quot;toubd&quot;       &quot;nowd&quot;        &quot;wrad&quot;        &quot;sresd&quot;      
## [246] &quot;krind&quot;       &quot;erivd&quot;       &quot;prod&quot;        &quot;yrd&quot;         &quot;eud&quot;        
## [251] &quot;gurind&quot;      &quot;hace&quot;        &quot;yarle&quot;       &quot;tase&quot;        &quot;yase&quot;       
## [256] &quot;tae&quot;         &quot;yconome&quot;     &quot;educate&quot;     &quot;tffece&quot;      &quot;gge&quot;        
## [261] &quot;tighe&quot;       &quot;rithee&quot;      &quot;tlece&quot;       &quot;clectrie&quot;    &quot;nlevee&quot;     
## [266] &quot;else&quot;        &quot;ymploe&quot;      &quot;encourage&quot;   &quot;dne&quot;         &quot;engine&quot;     
## [271] &quot;hnglise&quot;     &quot;ynjoe&quot;       &quot;hnouge&quot;      &quot;rntee&quot;       &quot;tnvironmene&quot;
## [276] &quot;lquae&quot;       &quot;lspeciae&quot;    &quot;europe&quot;      &quot;nvee&quot;        &quot;gvenine&quot;    
## [281] &quot;rvee&quot;        &quot;yvere&quot;       &quot;evidence&quot;    &quot;txace&quot;       &quot;example&quot;    
## [286] &quot;txcepe&quot;      &quot;excuse&quot;      &quot;exercise&quot;    &quot;txise&quot;       &quot;txpece&quot;     
## [291] &quot;expense&quot;     &quot;experience&quot;  &quot;nxplaie&quot;     &quot;sxprese&quot;     &quot;axtre&quot;      
## [296] &quot;eye&quot;         &quot;eacf&quot;        &quot;tacf&quot;        &quot;raif&quot;        &quot;lalf&quot;       
## [301] &quot;yamilf&quot;      &quot;raf&quot;         &quot;marf&quot;        &quot;tasf&quot;        &quot;rathef&quot;     
## [306] &quot;ravouf&quot;      &quot;deef&quot;        &quot;leef&quot;        &quot;wef&quot;         &quot;dielf&quot;      
## [311] &quot;tighf&quot;       &quot;eigurf&quot;      &quot;eilf&quot;        &quot;lilf&quot;        &quot;milf&quot;       
## [316] &quot;linaf&quot;       &quot;einancf&quot;     &quot;dinf&quot;        &quot;einf&quot;        &quot;hinisf&quot;     
## [321] &quot;eirf&quot;        &quot;tirsf&quot;       &quot;hisf&quot;        &quot;tif&quot;         &quot;eivf&quot;       
## [326] &quot;tlaf&quot;        &quot;rloof&quot;       &quot;ylf&quot;         &quot;wollof&quot;      &quot;doof&quot;       
## [331] &quot;toof&quot;        &quot;rof&quot;         &quot;eorcf&quot;       &quot;torgef&quot;      &quot;morf&quot;       
## [336] &quot;eortunf&quot;     &quot;dorwarf&quot;     &quot;rouf&quot;        &quot;erancf&quot;      &quot;eref&quot;       
## [341] &quot;yridaf&quot;      &quot;drienf&quot;      &quot;mrof&quot;        &quot;tronf&quot;       &quot;lulf&quot;       
## [346] &quot;nuf&quot;         &quot;nunctiof&quot;    &quot;dunf&quot;        &quot;rurthef&quot;     &quot;euturf&quot;     
## [351] &quot;eamg&quot;        &quot;nardeg&quot;      &quot;sag&quot;         &quot;lenerag&quot;     &quot;yermang&quot;    
## [356] &quot;teg&quot;         &quot;lirg&quot;        &quot;eivg&quot;        &quot;slasg&quot;       &quot;og&quot;         
## [361] &quot;dog&quot;         &quot;doog&quot;        &quot;eoodbyg&quot;     &quot;noverg&quot;      &quot;drang&quot;      
## [366] &quot;trang&quot;       &quot;treag&quot;       &quot;nreeg&quot;       &quot;droung&quot;      &quot;proug&quot;      
## [371] &quot;wrog&quot;        &quot;suesg&quot;       &quot;yug&quot;         &quot;raih&quot;        &quot;falh&quot;       
## [376] &quot;lalh&quot;        &quot;danh&quot;        &quot;ganh&quot;        &quot;nappeh&quot;      &quot;yapph&quot;      
## [381] &quot;darh&quot;        &quot;eath&quot;        &quot;eavh&quot;        &quot;eh&quot;          &quot;deah&quot;       
## [386] &quot;health&quot;      &quot;reah&quot;        &quot;tearh&quot;       &quot;teah&quot;        &quot;yeavh&quot;      
## [391] &quot;lelh&quot;        &quot;pelh&quot;        &quot;eerh&quot;        &quot;high&quot;        &quot;yistorh&quot;    
## [396] &quot;tih&quot;         &quot;dolh&quot;        &quot;yolidah&quot;     &quot;eomh&quot;        &quot;tonesh&quot;     
## [401] &quot;eoph&quot;        &quot;eorsh&quot;       &quot;lospitah&quot;    &quot;toh&quot;         &quot;rouh&quot;       
## [406] &quot;eoush&quot;       &quot;woh&quot;         &quot;roweveh&quot;     &quot;oullh&quot;       &quot;dundreh&quot;    
## [411] &quot;dusbanh&quot;     &quot;adei&quot;        &quot;ydentifi&quot;    &quot;fi&quot;          &quot;emagini&quot;    
## [416] &quot;tmportani&quot;   &quot;emprovi&quot;     &quot;ni&quot;          &quot;encludi&quot;     &quot;encomi&quot;     
## [421] &quot;encreasi&quot;    &quot;dndeei&quot;      &quot;lndividuai&quot;  &quot;yndustri&quot;    &quot;mnfori&quot;     
## [426] &quot;ensidi&quot;      &quot;dnsteai&quot;     &quot;ensuri&quot;      &quot;tnteresi&quot;    &quot;onti&quot;       
## [431] &quot;entroduci&quot;   &quot;tnvesi&quot;      &quot;envolvi&quot;     &quot;essui&quot;       &quot;ti&quot;         
## [436] &quot;mtei&quot;        &quot;sesuj&quot;       &quot;boj&quot;         &quot;noij&quot;        &quot;eudgj&quot;      
## [441] &quot;pumj&quot;        &quot;tusj&quot;        &quot;peek&quot;        &quot;yek&quot;         &quot;dik&quot;        
## [446] &quot;lilk&quot;        &quot;dink&quot;        &quot;gink&quot;        &quot;nitchek&quot;     &quot;knock&quot;      
## [451] &quot;wnok&quot;        &quot;raboul&quot;      &quot;dal&quot;         &quot;yadl&quot;        &quot;danl&quot;       
## [456] &quot;eanguagl&quot;    &quot;eargl&quot;       &quot;tasl&quot;        &quot;eatl&quot;        &quot;haugl&quot;      
## [461] &quot;wal&quot;         &quot;yal&quot;         &quot;deal&quot;        &quot;nearl&quot;       &quot;eeavl&quot;      
## [466] &quot;tefl&quot;        &quot;gel&quot;         &quot;sesl&quot;        &quot;tel&quot;         &quot;rettel&quot;     
## [471] &quot;level&quot;       &quot;eil&quot;         &quot;eifl&quot;        &quot;tighl&quot;       &quot;eikl&quot;       
## [476] &quot;yikell&quot;      &quot;timil&quot;       &quot;einl&quot;        &quot;kinl&quot;        &quot;tisl&quot;       
## [481] &quot;nistel&quot;      &quot;eittll&quot;      &quot;eivl&quot;        &quot;doal&quot;        &quot;local&quot;      
## [486] &quot;kocl&quot;        &quot;nondol&quot;      &quot;gonl&quot;        &quot;kool&quot;        &quot;dorl&quot;       
## [491] &quot;eosl&quot;        &quot;tol&quot;         &quot;eovl&quot;        &quot;wol&quot;         &quot;kucl&quot;       
## [496] &quot;huncl&quot;       &quot;eachinm&quot;     &quot;naim&quot;        &quot;rajom&quot;       &quot;eakm&quot;       
## [501] &quot;nam&quot;         &quot;eanagm&quot;      &quot;yanm&quot;        &quot;karm&quot;        &quot;tarkem&quot;     
## [506] &quot;yarrm&quot;       &quot;hatcm&quot;       &quot;rattem&quot;      &quot;yam&quot;         &quot;eaybm&quot;      
## [511] &quot;neam&quot;        &quot;geaninm&quot;     &quot;eeasurm&quot;     &quot;teem&quot;        &quot;rembem&quot;     
## [516] &quot;nentiom&quot;     &quot;eiddlm&quot;      &quot;tighm&quot;       &quot;eilm&quot;        &quot;kilm&quot;       
## [521] &quot;nilliom&quot;     &quot;dinm&quot;        &quot;rinistem&quot;    &quot;sinum&quot;       &quot;einutm&quot;     
## [526] &quot;sism&quot;        &quot;ristem&quot;      &quot;tomenm&quot;      &quot;yondam&quot;      &quot;yonem&quot;      
## [531] &quot;hontm&quot;       &quot;eorm&quot;        &quot;gorninm&quot;     &quot;tosm&quot;        &quot;rothem&quot;     
## [536] &quot;notiom&quot;      &quot;eovm&quot;        &quot;srm&quot;         &quot;hucm&quot;        &quot;cusim&quot;      
## [541] &quot;tusm&quot;        &quot;eamn&quot;        &quot;nation&quot;      &quot;eaturn&quot;      &quot;rean&quot;       
## [546] &quot;yecessarn&quot;   &quot;deen&quot;        &quot;reven&quot;       &quot;wen&quot;         &quot;sewn&quot;       
## [551] &quot;texn&quot;        &quot;eicn&quot;        &quot;tighn&quot;       &quot;einn&quot;        &quot;on&quot;         
## [556] &quot;non&quot;         &quot;eonn&quot;        &quot;lorman&quot;      &quot;hortn&quot;       &quot;ton&quot;        
## [561] &quot;eotn&quot;        &quot;eoticn&quot;      &quot;won&quot;         &quot;rumben&quot;      &quot;sbviouo&quot;    
## [566] &quot;nccasioo&quot;    &quot;ddo&quot;         &quot;fo&quot;          &quot;ffo&quot;         &quot;rffeo&quot;      
## [571] &quot;effico&quot;      &quot;nfteo&quot;       &quot;ykao&quot;        &quot;dlo&quot;         &quot;no&quot;         
## [576] &quot;enco&quot;        &quot;eno&quot;         &quot;ynlo&quot;        &quot;npeo&quot;        &quot;eperato&quot;    
## [581] &quot;ypportunito&quot; &quot;epposo&quot;      &quot;ro&quot;          &quot;rrdeo&quot;       &quot;erganizo&quot;   
## [586] &quot;lriginao&quot;    &quot;rtheo&quot;       &quot;etherwiso&quot;   &quot;tugho&quot;       &quot;tuo&quot;        
## [591] &quot;rveo&quot;        &quot;nwo&quot;         &quot;kacp&quot;        &quot;eagp&quot;        &quot;tainp&quot;      
## [596] &quot;raip&quot;        &quot;rapep&quot;       &quot;haragrapp&quot;   &quot;nardop&quot;      &quot;tarenp&quot;     
## [601] &quot;karp&quot;        &quot;tarp&quot;        &quot;rarticulap&quot;  &quot;yartp&quot;       &quot;sasp&quot;       
## [606] &quot;tasp&quot;        &quot;yap&quot;         &quot;eencp&quot;       &quot;nensiop&quot;     &quot;eeoplp&quot;     
## [611] &quot;rep&quot;         &quot;tercenp&quot;     &quot;terfecp&quot;     &quot;serhapp&quot;     &quot;deriop&quot;     
## [616] &quot;nersop&quot;      &quot;hhotograpp&quot;  &quot;kicp&quot;        &quot;eicturp&quot;     &quot;eiecp&quot;      
## [621] &quot;elacp&quot;       &quot;nlap&quot;        &quot;ylap&quot;        &quot;eleasp&quot;      &quot;slup&quot;       
## [626] &quot;toinp&quot;       &quot;eolicp&quot;      &quot;yolicp&quot;      &quot;colitip&quot;     &quot;roop&quot;       
## [631] &quot;nositiop&quot;    &quot;eositivp&quot;    &quot;eossiblp&quot;    &quot;tosp&quot;        &quot;dounp&quot;      
## [636] &quot;rowep&quot;       &quot;eractisp&quot;    &quot;ereparp&quot;     &quot;tresenp&quot;     &quot;sresp&quot;      
## [641] &quot;eressurp&quot;    &quot;eresump&quot;     &quot;yrettp&quot;      &quot;srevioup&quot;    &quot;ericp&quot;      
## [646] &quot;trinp&quot;       &quot;erivatp&quot;     &quot;erobablp&quot;    &quot;mroblep&quot;     &quot;droceep&quot;    
## [651] &quot;srocesp&quot;     &quot;eroducp&quot;     &quot;troducp&quot;     &quot;erogrammp&quot;   &quot;trojecp&quot;    
## [656] &quot;rropep&quot;      &quot;eroposp&quot;     &quot;trotecp&quot;     &quot;erovidp&quot;     &quot;cublip&quot;     
## [661] &quot;lulp&quot;        &quot;eurposp&quot;     &quot;husp&quot;        &quot;tup&quot;         &quot;yualitq&quot;    
## [666] &quot;ruarteq&quot;     &quot;nuestioq&quot;    &quot;kuicq&quot;       &quot;duiq&quot;        &quot;tuieq&quot;      
## [671] &quot;euitq&quot;       &quot;oadir&quot;       &quot;lair&quot;        &quot;eaisr&quot;       &quot;eangr&quot;      
## [676] &quot;eatr&quot;        &quot;rather&quot;      &quot;dear&quot;        &quot;yeadr&quot;       &quot;lear&quot;       
## [681] &quot;eealisr&quot;     &quot;yeallr&quot;      &quot;neasor&quot;      &quot;eeceivr&quot;     &quot;tecenr&quot;     
## [686] &quot;neckor&quot;      &quot;eecognizr&quot;   &quot;decommenr&quot;   &quot;decorr&quot;      &quot;der&quot;        
## [691] &quot;eeducr&quot;      &quot;refer&quot;       &quot;degarr&quot;      &quot;negior&quot;      &quot;nelatior&quot;   
## [696] &quot;remember&quot;    &quot;teporr&quot;      &quot;tepresenr&quot;   &quot;eequirr&quot;     &quot;hesearcr&quot;   
## [701] &quot;eesourcr&quot;    &quot;tespecr&quot;     &quot;eesponsiblr&quot; &quot;tesr&quot;        &quot;tesulr&quot;     
## [706] &quot;neturr&quot;      &quot;dir&quot;         &quot;tighr&quot;       &quot;ginr&quot;        &quot;eisr&quot;       
## [711] &quot;doar&quot;        &quot;eolr&quot;        &quot;lolr&quot;        &quot;moor&quot;        &quot;dounr&quot;      
## [716] &quot;eulr&quot;        &quot;nur&quot;         &quot;eafs&quot;        &quot;eals&quot;        &quot;eams&quot;       
## [721] &quot;yaturdas&quot;    &quot;eavs&quot;        &quot;yas&quot;         &quot;echems&quot;      &quot;lchoos&quot;     
## [726] &quot;eciencs&quot;     &quot;ecors&quot;       &quot;dcotlans&quot;    &quot;teas&quot;        &quot;decons&quot;     
## [731] &quot;yecretars&quot;   &quot;nectios&quot;     &quot;eecurs&quot;      &quot;ees&quot;         &quot;mees&quot;       
## [736] &quot;fels&quot;        &quot;lels&quot;        &quot;dens&quot;        &quot;eenss&quot;       &quot;eeparats&quot;   
## [741] &quot;serious&quot;     &quot;eervs&quot;       &quot;eervics&quot;     &quot;tes&quot;         &quot;eettls&quot;     
## [746] &quot;neves&quot;       &quot;xes&quot;         &quot;lhals&quot;       &quot;ehars&quot;       &quot;ehs&quot;        
## [751] &quot;thees&quot;       &quot;ehos&quot;        &quot;thoos&quot;       &quot;phos&quot;        &quot;thors&quot;      
## [756] &quot;dhouls&quot;      &quot;whos&quot;        &quot;thus&quot;        &quot;kics&quot;        &quot;eids&quot;       
## [761] &quot;nigs&quot;        &quot;rimilas&quot;     &quot;eimpls&quot;      &quot;eincs&quot;       &quot;gins&quot;       
## [766] &quot;eingls&quot;      &quot;ris&quot;         &quot;ristes&quot;      &quot;tis&quot;         &quot;eits&quot;       
## [771] &quot;eituats&quot;     &quot;xis&quot;         &quot;eizs&quot;        &quot;plees&quot;       &quot;tlighs&quot;     
## [776] &quot;wlos&quot;        &quot;lmals&quot;       &quot;emoks&quot;       &quot;os&quot;          &quot;locias&quot;     
## [781] &quot;yociets&quot;     &quot;eoms&quot;        &quot;nos&quot;         &quot;noos&quot;        &quot;yorrs&quot;      
## [786] &quot;tors&quot;        &quot;douns&quot;       &quot;houts&quot;       &quot;epacs&quot;       &quot;kpeas&quot;      
## [791] &quot;lpecias&quot;     &quot;cpecifis&quot;    &quot;dpees&quot;       &quot;lpels&quot;       &quot;dpens&quot;      
## [796] &quot;equars&quot;      &quot;ftafs&quot;       &quot;etags&quot;       &quot;stairs&quot;      &quot;dtans&quot;      
## [801] &quot;dtandars&quot;    &quot;ttars&quot;       &quot;etats&quot;       &quot;ntatios&quot;     &quot;ytas&quot;       
## [806] &quot;ptes&quot;        &quot;ktics&quot;       &quot;ltils&quot;       &quot;ptos&quot;        &quot;ytors&quot;      
## [811] &quot;ttraighs&quot;    &quot;ytrategs&quot;    &quot;ttrees&quot;      &quot;etriks&quot;      &quot;gtrons&quot;     
## [816] &quot;etructurs&quot;   &quot;ttudens&quot;     &quot;ytuds&quot;       &quot;ftufs&quot;       &quot;dtupis&quot;     
## [821] &quot;tubjecs&quot;     &quot;duccees&quot;     &quot;hucs&quot;        &quot;nuddes&quot;      &quot;tuggess&quot;    
## [826] &quot;tuis&quot;        &quot;rummes&quot;      &quot;nus&quot;         &quot;yundas&quot;      &quot;yuppls&quot;     
## [831] &quot;tuppors&quot;     &quot;eupposs&quot;     &quot;eurs&quot;        &quot;eurpriss&quot;    &quot;hwitcs&quot;     
## [836] &quot;mystes&quot;      &quot;eablt&quot;       &quot;eakt&quot;        &quot;kalt&quot;        &quot;eapt&quot;       
## [841] &quot;xat&quot;         &quot;aet&quot;         &quot;heact&quot;       &quot;meat&quot;        &quot;eelephont&quot;  
## [846] &quot;nelevisiot&quot;  &quot;lelt&quot;        &quot;net&quot;         &quot;dent&quot;        &quot;mert&quot;       
## [851] &quot;eerriblt&quot;    &quot;test&quot;        &quot;nhat&quot;        &quot;khant&quot;       &quot;eht&quot;        
## [856] &quot;nhet&quot;        &quot;ehert&quot;       &quot;eherefort&quot;   &quot;yhet&quot;        &quot;ghint&quot;      
## [861] &quot;khint&quot;       &quot;nhirteet&quot;    &quot;yhirtt&quot;      &quot;shit&quot;        &quot;uhot&quot;       
## [866] &quot;hhougt&quot;      &quot;dhousant&quot;    &quot;ehret&quot;       &quot;hhrougt&quot;     &quot;whrot&quot;      
## [871] &quot;yhursdat&quot;    &quot;eit&quot;         &quot;eimt&quot;        &quot;ot&quot;          &quot;yodat&quot;      
## [876] &quot;rogethet&quot;    &quot;womorrot&quot;    &quot;tonight&quot;     &quot;oot&quot;         &quot;pot&quot;        
## [881] &quot;lotat&quot;       &quot;houct&quot;       &quot;dowart&quot;      &quot;nowt&quot;        &quot;eradt&quot;      
## [886] &quot;craffit&quot;     &quot;nrait&quot;       &quot;transport&quot;   &quot;lravet&quot;      &quot;treat&quot;      
## [891] &quot;eret&quot;        &quot;eroublt&quot;     &quot;erut&quot;        &quot;trust&quot;       &quot;yrt&quot;        
## [896] &quot;yuesdat&quot;     &quot;nurt&quot;        &quot;ewelvt&quot;      &quot;ywentt&quot;      &quot;owt&quot;        
## [901] &quot;eypt&quot;        &quot;rndeu&quot;       &quot;dnderstanu&quot;  &quot;nniou&quot;       &quot;tniu&quot;       
## [906] &quot;enitu&quot;       &quot;yniversitu&quot;  &quot;snlesu&quot;      &quot;lntiu&quot;       &quot;pu&quot;         
## [911] &quot;npou&quot;        &quot;esu&quot;         &quot;lsuau&quot;       &quot;ealuv&quot;       &quot;sariouv&quot;    
## [916] &quot;yerv&quot;        &quot;oidev&quot;       &quot;wiev&quot;        &quot;eillagv&quot;     &quot;tisiv&quot;      
## [921] &quot;eotv&quot;        &quot;eagw&quot;        &quot;taiw&quot;        &quot;kalw&quot;        &quot;lalw&quot;       
## [926] &quot;tanw&quot;        &quot;raw&quot;         &quot;marw&quot;        &quot;hasw&quot;        &quot;eastw&quot;      
## [931] &quot;hatcw&quot;       &quot;ratew&quot;       &quot;yaw&quot;         &quot;ew&quot;          &quot;reaw&quot;       
## [936] &quot;yednesdaw&quot;   &quot;eew&quot;         &quot;keew&quot;        &quot;heigw&quot;       &quot;eelcomw&quot;    
## [941] &quot;lelw&quot;        &quot;tesw&quot;        &quot;thaw&quot;        &quot;nhew&quot;        &quot;eherw&quot;      
## [946] &quot;rhethew&quot;     &quot;hhicw&quot;       &quot;ehilw&quot;       &quot;ehitw&quot;       &quot;ohw&quot;        
## [951] &quot;eholw&quot;       &quot;yhw&quot;         &quot;eidw&quot;        &quot;eifw&quot;        &quot;lilw&quot;       
## [956] &quot;niw&quot;         &quot;dinw&quot;        &quot;window&quot;      &quot;hisw&quot;        &quot;hitw&quot;       
## [961] &quot;nithiw&quot;      &quot;tithouw&quot;     &quot;nomaw&quot;       &quot;rondew&quot;      &quot;doow&quot;       
## [966] &quot;dorw&quot;        &quot;korw&quot;        &quot;dorlw&quot;       &quot;yorrw&quot;       &quot;eorsw&quot;      
## [971] &quot;hortw&quot;       &quot;doulw&quot;       &quot;eritw&quot;       &quot;gronw&quot;       &quot;reay&quot;       
## [976] &quot;sey&quot;         &quot;yesterday&quot;   &quot;tey&quot;         &quot;uoy&quot;         &quot;gouny&quot;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>После замены символов, словами останутся:</li>
</ol>
<ul>
<li><p>слова, оканчивающиеся на одну и ту же букву (слова из одной буквы частный случай), например — “dad”</p></li>
<li><p>слова, которые начинающиеся и оканчивающиеся на взаимозаменяемые буквы (палиндром частный случай), например “lead” — “deal”</p></li>
</ul>
<p>Чтобы найти такие слова, будем искать полученные в результате замены букв слова в исходной выборке. Для этого воспользуемся функцией, которую мы изучили в прошлой теме. Функция <code>intrsect(x, y)</code> возвращает только наблюдения, содержащие одновременно в <code>х</code> и <code>у</code></p>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1199-1" data-line-number="1"><span class="kw">intersect</span>(swap, words)</a></code></pre></div>
<pre><code>##  [1] &quot;a&quot;          &quot;america&quot;    &quot;area&quot;       &quot;dad&quot;        &quot;dead&quot;      
##  [6] &quot;lead&quot;       &quot;read&quot;       &quot;depend&quot;     &quot;god&quot;        &quot;educate&quot;   
## [11] &quot;else&quot;       &quot;encourage&quot;  &quot;engine&quot;     &quot;europe&quot;     &quot;evidence&quot;  
## [16] &quot;example&quot;    &quot;excuse&quot;     &quot;exercise&quot;   &quot;expense&quot;    &quot;experience&quot;
## [21] &quot;eye&quot;        &quot;dog&quot;        &quot;health&quot;     &quot;high&quot;       &quot;knock&quot;     
## [26] &quot;deal&quot;       &quot;level&quot;      &quot;local&quot;      &quot;nation&quot;     &quot;on&quot;        
## [31] &quot;non&quot;        &quot;no&quot;         &quot;rather&quot;     &quot;dear&quot;       &quot;refer&quot;     
## [36] &quot;remember&quot;   &quot;serious&quot;    &quot;stairs&quot;     &quot;test&quot;       &quot;tonight&quot;   
## [41] &quot;transport&quot;  &quot;treat&quot;      &quot;trust&quot;      &quot;window&quot;     &quot;yesterday&quot;</code></pre>
</div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.4.5</span> Разбиение строк</h4>
<p>Функции <code>str_split</code> позволяeт разбивать строки на части. Например, можно разбить предложения на слова.</p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1201-1" data-line-number="1">sentences <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1201-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1201-3" data-line-number="3"><span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;The&quot;     &quot;birch&quot;   &quot;canoe&quot;   &quot;slid&quot;    &quot;on&quot;      &quot;the&quot;     &quot;smooth&quot; 
## [8] &quot;planks.&quot;
## 
## [[2]]
## [1] &quot;Glue&quot;        &quot;the&quot;         &quot;sheet&quot;       &quot;to&quot;          &quot;the&quot;        
## [6] &quot;dark&quot;        &quot;blue&quot;        &quot;background.&quot;
## 
## [[3]]
## [1] &quot;It&#39;s&quot;  &quot;easy&quot;  &quot;to&quot;    &quot;tell&quot;  &quot;the&quot;   &quot;depth&quot; &quot;of&quot;    &quot;a&quot;     &quot;well.&quot;
## 
## [[4]]
## [1] &quot;These&quot;   &quot;days&quot;    &quot;a&quot;       &quot;chicken&quot; &quot;leg&quot;     &quot;is&quot;      &quot;a&quot;      
## [8] &quot;rare&quot;    &quot;dish.&quot;  
## 
## [[5]]
## [1] &quot;Rice&quot;   &quot;is&quot;     &quot;often&quot;  &quot;served&quot; &quot;in&quot;     &quot;round&quot;  &quot;bowls.&quot;</code></pre>
<p>По скольку каждый компонент может состоять из разного количества частей, функция возвращает список. Если работаем со списком длинной один, то проще всего извлечь первый элемент списка.</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1203-1" data-line-number="1"><span class="st">&quot;a|b|c|d&quot;</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1203-2" data-line-number="2"><span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">|&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1203-3" data-line-number="3"><span class="st">  </span>.[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<p>В противном случае, как и про работе с другими функциями, возвращающими список, можно использовать параметр <code>simplify = TRUE</code> который вернёт матрицу.</p>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1205-1" data-line-number="1">sentences <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1205-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1205-3" data-line-number="3"><span class="st">  </span><span class="kw">str_split</span>(<span class="st">&quot; &quot;</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##      [,1]    [,2]    [,3]    [,4]      [,5]  [,6]    [,7]    
## [1,] &quot;The&quot;   &quot;birch&quot; &quot;canoe&quot; &quot;slid&quot;    &quot;on&quot;  &quot;the&quot;   &quot;smooth&quot;
## [2,] &quot;Glue&quot;  &quot;the&quot;   &quot;sheet&quot; &quot;to&quot;      &quot;the&quot; &quot;dark&quot;  &quot;blue&quot;  
## [3,] &quot;It&#39;s&quot;  &quot;easy&quot;  &quot;to&quot;    &quot;tell&quot;    &quot;the&quot; &quot;depth&quot; &quot;of&quot;    
## [4,] &quot;These&quot; &quot;days&quot;  &quot;a&quot;     &quot;chicken&quot; &quot;leg&quot; &quot;is&quot;    &quot;a&quot;     
## [5,] &quot;Rice&quot;  &quot;is&quot;    &quot;often&quot; &quot;served&quot;  &quot;in&quot;  &quot;round&quot; &quot;bowls.&quot;
##      [,8]          [,9]   
## [1,] &quot;planks.&quot;     &quot;&quot;     
## [2,] &quot;background.&quot; &quot;&quot;     
## [3,] &quot;a&quot;           &quot;well.&quot;
## [4,] &quot;rare&quot;        &quot;dish.&quot;
## [5,] &quot;&quot;            &quot;&quot;</code></pre>
<p>Можно запросить максимальное количество частей, котооре</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1207-1" data-line-number="1">fields &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Name: Hadley&quot;</span>, <span class="st">&quot;Country: NZ&quot;</span>, <span class="st">&quot;Age: 35&quot;</span>)</a>
<a class="sourceLine" id="cb1207-2" data-line-number="2">fields <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str_split</span>(<span class="st">&quot;: &quot;</span>, <span class="dt">n =</span> <span class="dv">2</span>, <span class="dt">simplify =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##      [,1]      [,2]    
## [1,] &quot;Name&quot;    &quot;Hadley&quot;
## [2,] &quot;Country&quot; &quot;NZ&quot;    
## [3,] &quot;Age&quot;     &quot;35&quot;</code></pre>
<p>Вместо разбивки слов по шаблонам, можно разбивать по границам символов, строк, предложений или слов</p>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1209-1" data-line-number="1">x &lt;-<span class="st"> &quot;This is a sentence.  This is another sentence.&quot;</span></a>
<a class="sourceLine" id="cb1209-2" data-line-number="2"><span class="kw">str_view_all</span>(x, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))</a></code></pre></div>
<div id="htmlwidget-420bf58522271b43a0b3" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-420bf58522271b43a0b3">{"x":{"html":"<ul>\n  <li><span class='match'>This<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>sentence<\/span>.  <span class='match'>This<\/span> <span class='match'>is<\/span> <span class='match'>another<\/span> <span class='match'>sentence<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1210-1" data-line-number="1"><span class="kw">str_split</span>(x, <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;This&quot;      &quot;is&quot;        &quot;a&quot;         &quot;sentence.&quot; &quot;&quot;          &quot;This&quot;     
## [7] &quot;is&quot;        &quot;another&quot;   &quot;sentence.&quot;</code></pre>
<div class="sourceCode" id="cb1212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1212-1" data-line-number="1"><span class="kw">str_split</span>(x, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;This&quot;     &quot;is&quot;       &quot;a&quot;        &quot;sentence&quot; &quot;This&quot;     &quot;is&quot;      
## [7] &quot;another&quot;  &quot;sentence&quot;</code></pre>
<p>Функция <code>boundary()</code> сопоставляет границы между вещами</p>
<div id="-14.4.5.1.1" class="section level5">
<h5><span class="header-section-number">3.5.4.5.1</span> Упражнение 14.4.5.1.1</h5>
<div class="question">
<p>Split up a string like <code>&quot;apples, pears, and bananas&quot;</code> into individual components.</p>
</div>
<p>Разбивать строку будем по границам слов, сопоставляя со списком слов.
И так как мы работаем с списком длинной один, возьмём первый элемент.</p>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1214-1" data-line-number="1">x &lt;-<span class="st"> &quot;apples, pears, and bananas&quot;</span></a>
<a class="sourceLine" id="cb1214-2" data-line-number="2"><span class="kw">str_split</span>(x,  <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;apples&quot;  &quot;pears&quot;   &quot;and&quot;     &quot;bananas&quot;</code></pre>
</div>
<div id="-14.4.5.1.2" class="section level5">
<h5><span class="header-section-number">3.5.4.5.2</span> Упражнение 14.4.5.1.2</h5>
<div class="question">
<p>Why is it better to split up by boundary(“word”) than &quot; &quot;?</p>
</div>
<p>Лучше разделять предложение по границам слов, потому что при разбиении по пробелам в слово цепляются символы, в примере выше это запятые.</p>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1216-1" data-line-number="1">x &lt;-<span class="st"> &quot;apples, pears, and bananas&quot;</span></a>
<a class="sourceLine" id="cb1216-2" data-line-number="2"><span class="kw">str_split</span>(x,  <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;apples,&quot; &quot;pears,&quot;  &quot;and&quot;     &quot;bananas&quot;</code></pre>
<p>Рассмотрим пример из <a href="http://www.unicode.org/reports/tr29/#Word_Boundaries">Unicode Report on word boundaries</a></p>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1218-1" data-line-number="1">sentence &lt;-<span class="st"> &quot;The quick (“brown”) fox can’t jump 32.3 feet, right?&quot;</span></a>
<a class="sourceLine" id="cb1218-2" data-line-number="2"><span class="kw">str_split</span>(sentence,  <span class="st">&quot; &quot;</span>)[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;The&quot;       &quot;quick&quot;     &quot;(“brown”)&quot; &quot;fox&quot;       &quot;can’t&quot;     &quot;jump&quot;     
## [7] &quot;32.3&quot;      &quot;feet,&quot;     &quot;right?&quot;</code></pre>
<p>В разбиение попали слова с символами, что не совсем корректно — показателен пример <code>(“brown”)</code>.</p>
<div class="sourceCode" id="cb1220"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1220-1" data-line-number="1"><span class="kw">str_split</span>(sentence, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;The&quot;   &quot;quick&quot; &quot;brown&quot; &quot;fox&quot;   &quot;can’t&quot; &quot;jump&quot;  &quot;32.3&quot;  &quot;feet&quot;  &quot;right&quot;</code></pre>
<p>Так гораздо лучше.</p>
</div>
<div id="-14.4.5.1.3" class="section level5">
<h5><span class="header-section-number">3.5.4.5.3</span> Упражнение 14.4.5.1.3</h5>
<div class="question">
<p>What does splitting with an empty string <code>(&quot;&quot;)</code> do? Experiment, and then read the documentation.</p>
</div>
<p>Она разобьет строку на одтельные символы</p>
<div class="sourceCode" id="cb1222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1222-1" data-line-number="1">x &lt;-<span class="st"> &quot;apples, pears, and bananas&quot;</span></a>
<a class="sourceLine" id="cb1222-2" data-line-number="2"><span class="kw">str_split</span>(x,  <span class="st">&quot;&quot;</span>)[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;p&quot; &quot;p&quot; &quot;l&quot; &quot;e&quot; &quot;s&quot; &quot;,&quot; &quot; &quot; &quot;p&quot; &quot;e&quot; &quot;a&quot; &quot;r&quot; &quot;s&quot; &quot;,&quot; &quot; &quot; &quot;a&quot; &quot;n&quot;
## [18] &quot;d&quot; &quot; &quot; &quot;b&quot; &quot;a&quot; &quot;n&quot; &quot;a&quot; &quot;n&quot; &quot;a&quot; &quot;s&quot;</code></pre>
<p>Документация говорит, что пустой паттерн <code>&quot;&quot;</code> эквивалентен границе символа. An empty pattern, &quot;“, is equivalent to boundary(”character&quot;).</p>
</div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.5.4.6</span> Поиск совпадений</h4>
<p>Функции <code>str_locate()</code> и <code>str_locate_all()</code> дают начальную и конечную позиции каждого совпадения. Они особенно полезны, когда ни одна из других функций не делает именно то, что нужно. МОжно использовать <code>str_locate()</code>, чтобы найти соответствующий шаблон, а затем <code>str_sub()</code>, чтобы извлечь и/или изменить их.</p>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.5.5</span> Другие типы шаблонов</h3>
<p>Когда используется шаблон, являющийся строкой, она автоматически помещается в вызов функции <code>regex()</code></p>
<div class="sourceCode" id="cb1224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1224-1" data-line-number="1"><span class="co"># Обычный вызов</span></a>
<a class="sourceLine" id="cb1224-2" data-line-number="2"><span class="kw">str_view</span>(fruit, <span class="st">&quot;nana&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-1e94330ff74ba1cef65e" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-1e94330ff74ba1cef65e">{"x":{"html":"<ul>\n  <li>apple<\/li>\n  <li>ba<span class='match'>nana<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1225"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1225-1" data-line-number="1"><span class="co"># Является сокращенной записью вызова</span></a>
<a class="sourceLine" id="cb1225-2" data-line-number="2"><span class="kw">str_view</span>(fruit, <span class="kw">regex</span>(<span class="st">&quot;nana&quot;</span>))</a></code></pre></div>
<div id="htmlwidget-29d143396478da7165be" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-29d143396478da7165be">{"x":{"html":"<ul>\n  <li>apple<\/li>\n  <li>ba<span class='match'>nana<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<p>Передавая функции <code>regex()</code> дополнительные аргументы, можно управлять деталями сопоставления строк с шаблоном.</p>
<ul>
<li><code>ignore_case = TRUE</code> — позволяет игнорировать регистр символов при сопоставлении с шаблоном. В первом из приведенных ниже вызовов функции <code>str_view()</code> используется текущая локаль</li>
</ul>
<div class="sourceCode" id="cb1226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1226-1" data-line-number="1">bananas &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;banana&quot;</span>, <span class="st">&quot;Banana&quot;</span>, <span class="st">&quot;BANANA&quot;</span>)</a>
<a class="sourceLine" id="cb1226-2" data-line-number="2"><span class="kw">str_view</span>(bananas, <span class="st">&quot;banana&quot;</span>)</a></code></pre></div>
<div id="htmlwidget-d21057249c626b674463" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-d21057249c626b674463">{"x":{"html":"<ul>\n  <li><span class='match'>banana<\/span><\/li>\n  <li>Banana<\/li>\n  <li>BANANA<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1227"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1227-1" data-line-number="1"><span class="kw">str_view</span>(bananas, <span class="kw">regex</span>(<span class="st">&quot;banana&quot;</span>, <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<div id="htmlwidget-86c37c4397f89103df60" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-86c37c4397f89103df60">{"x":{"html":"<ul>\n  <li><span class='match'>banana<\/span><\/li>\n  <li><span class='match'>Banana<\/span><\/li>\n  <li><span class='match'>BANANA<\/span><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<ul>
<li><code>multiline = TRUE</code> — разрешает специальным символам <code>^</code> и <code>$</code> совпадать с началом и концом каждой логической строки, а не полной строки</li>
</ul>
<div class="sourceCode" id="cb1228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1228-1" data-line-number="1">x &lt;-<span class="st"> &quot;Line 1</span><span class="ch">\n</span><span class="st">Line 2</span><span class="ch">\n</span><span class="st">Line 3&quot;</span></a>
<a class="sourceLine" id="cb1228-2" data-line-number="2"><span class="kw">str_extract_all</span>(x, <span class="st">&quot;^Line&quot;</span>)[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;Line&quot;</code></pre>
<div class="sourceCode" id="cb1230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1230-1" data-line-number="1"><span class="kw">str_extract_all</span>(x, <span class="kw">regex</span>(<span class="st">&quot;^Line&quot;</span>, <span class="dt">multiline =</span> <span class="ot">TRUE</span>))[[<span class="dv">1</span>]]</a></code></pre></div>
<pre><code>## [1] &quot;Line&quot; &quot;Line&quot; &quot;Line&quot;</code></pre>
<ul>
<li><code>comments = TRUE</code> — разрешает использование комментариев и пробельных символов для повышения удобочитаемости сложных регулярных выражений. Пробелы, как и весь остальной текст после символа <code>#</code>, игнорируются. Чтобы литеральный символ пробела учитывался при сопоставлении, его необходимо экранировать <code>&quot;\\&quot;</code></li>
</ul>
<div class="sourceCode" id="cb1232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1232-1" data-line-number="1">phone &lt;-<span class="st"> </span><span class="kw">regex</span>(<span class="st">&quot;</span></a>
<a class="sourceLine" id="cb1232-2" data-line-number="2"><span class="st">  </span><span class="ch">\\</span><span class="st">(?     # optional opening parens</span></a>
<a class="sourceLine" id="cb1232-3" data-line-number="3"><span class="st">  (</span><span class="ch">\\</span><span class="st">d{3}) # area code</span></a>
<a class="sourceLine" id="cb1232-4" data-line-number="4"><span class="st">  [) -]?   # optional closing parens, space, or dash</span></a>
<a class="sourceLine" id="cb1232-5" data-line-number="5"><span class="st">  (</span><span class="ch">\\</span><span class="st">d{3}) # another three numbers</span></a>
<a class="sourceLine" id="cb1232-6" data-line-number="6"><span class="st">  [ -]?    # optional space or dash</span></a>
<a class="sourceLine" id="cb1232-7" data-line-number="7"><span class="st">  (</span><span class="ch">\\</span><span class="st">d{3}) # three more numbers</span></a>
<a class="sourceLine" id="cb1232-8" data-line-number="8"><span class="st">  &quot;</span>, <span class="dt">comments =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1232-9" data-line-number="9"></a>
<a class="sourceLine" id="cb1232-10" data-line-number="10"><span class="kw">str_match</span>(<span class="st">&quot;514-791-8141&quot;</span>, phone)</a></code></pre></div>
<pre><code>##      [,1]          [,2]  [,3]  [,4] 
## [1,] &quot;514-791-814&quot; &quot;514&quot; &quot;791&quot; &quot;814&quot;</code></pre>
<ul>
<li><code>dotall = TRUE</code> разрешает символу “точка” <code>.</code> совпадать с любым символом, включая <code>\n</code></li>
</ul>
<p>Существуют три другие функции, которые можно использовать вместо функции <code>regex()</code></p>
<ul>
<li><code>fixed()</code> — ищет точные совпадения с указанной последовательностью байтов. Эта функция игнорирует все специальные регулярные выражения и работает на очень низком уровне, что позволяет избежать сложного экранирования символов и значительно повысить быстродействие. В соответствии с результатами приведённого ниже теста быстродействие в этом простом примере увеличилось в три раза.</li>
</ul>
<div class="sourceCode" id="cb1234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1234-1" data-line-number="1">microbenchmark<span class="op">::</span><span class="kw">microbenchmark</span>(</a>
<a class="sourceLine" id="cb1234-2" data-line-number="2">  <span class="dt">fixed =</span> <span class="kw">str_detect</span>(sentences, <span class="kw">fixed</span>(<span class="st">&quot;the&quot;</span>)),</a>
<a class="sourceLine" id="cb1234-3" data-line-number="3">  <span class="dt">regex =</span> <span class="kw">str_detect</span>(sentences, <span class="st">&quot;the&quot;</span>),</a>
<a class="sourceLine" id="cb1234-4" data-line-number="4">  <span class="dt">times =</span> <span class="dv">20</span></a>
<a class="sourceLine" id="cb1234-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## Unit: microseconds
##   expr     min       lq     mean  median       uq     max neval
##  fixed 100.131 104.2985 123.8538 108.513 120.2570 363.258    20
##  regex 345.211 357.5870 375.0987 368.560 384.5505 469.258    20</code></pre>
<p>Нужно проявлять осторожно, использую <code>fixed()</code> для работы с данными, подготовленными не на английском. Это весьма проблематично, поскольку для представления одного и того же символа существует несколько способов. Пример из книги:</p>
<p>символ <code>á</code> можно представить как одиночный символ или как символ <code>а</code> плюс акцент</p>
<div class="sourceCode" id="cb1236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1236-1" data-line-number="1">a1 &lt;-<span class="st"> &quot;\u00e1&quot;</span></a>
<a class="sourceLine" id="cb1236-2" data-line-number="2">a2 &lt;-<span class="st"> &quot;a\u0301&quot;</span></a>
<a class="sourceLine" id="cb1236-3" data-line-number="3"><span class="kw">c</span>(a1, a2)</a></code></pre></div>
<pre><code>## [1] &quot;á&quot; &quot;á&quot;</code></pre>
<div class="sourceCode" id="cb1238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1238-1" data-line-number="1">a1 <span class="op">==</span><span class="st"> </span>a2</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Визуализированные символы выглядят одинаковыми, но таковыми не являются, и функция <code>fixed()</code> не обнаруживает совпадения. Вместо этого можно использовать функцию <code>coll()</code>, которая уважает принятые среди людей правила сравнения символов.</p>
<div class="sourceCode" id="cb1240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1240-1" data-line-number="1"><span class="kw">str_detect</span>(a1, <span class="kw">fixed</span>(a2))</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1242-1" data-line-number="1"><span class="kw">str_detect</span>(a1, <span class="kw">coll</span>(a2))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<ul>
<li><code>coll()</code> — сравнивает строки, используя стандартные правила сравнения. Это полезно при выполнении поиска без учета регистра букв. Этой функции можно задать параметр <code>locale</code>.</li>
</ul>
<div class="sourceCode" id="cb1244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1244-1" data-line-number="1"><span class="co"># Это означает, что при выполнении поиска, не зависящего от</span></a>
<a class="sourceLine" id="cb1244-2" data-line-number="2"><span class="co"># регистра букв, нужно учитывать все отличия</span></a>
<a class="sourceLine" id="cb1244-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1244-4" data-line-number="4">i &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;I&quot;</span>, <span class="st">&quot;İ&quot;</span>, <span class="st">&quot;i&quot;</span>, <span class="st">&quot;ı&quot;</span>)</a>
<a class="sourceLine" id="cb1244-5" data-line-number="5">i</a></code></pre></div>
<pre><code>## [1] &quot;I&quot; &quot;İ&quot; &quot;i&quot; &quot;ı&quot;</code></pre>
<div class="sourceCode" id="cb1246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1246-1" data-line-number="1"><span class="kw">str_subset</span>(i, <span class="kw">coll</span>(<span class="st">&quot;i&quot;</span>, <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>## [1] &quot;I&quot; &quot;i&quot;</code></pre>
<div class="sourceCode" id="cb1248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1248-1" data-line-number="1"><span class="kw">str_subset</span>(i, <span class="kw">coll</span>(<span class="st">&quot;i&quot;</span>, <span class="dt">ignore_case =</span> <span class="ot">TRUE</span>, <span class="dt">locale =</span> <span class="st">&quot;tr&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;İ&quot; &quot;i&quot;</code></pre>
<p>Функции <code>fixed()</code> и <code>regex()</code> имеют аргумент <code>ignore_case = TRUE</code>, но оги не дают возможность выбирать локаль: они всегда используют локаль, заданную по умолчанию. Можно убедится на примере следующего кода:</p>
<div class="sourceCode" id="cb1250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1250-1" data-line-number="1">stringi<span class="op">::</span><span class="kw">stri_locale_info</span>()</a></code></pre></div>
<pre><code>## $Language
## [1] &quot;ru&quot;
## 
## $Country
## [1] &quot;RU&quot;
## 
## $Variant
## [1] &quot;&quot;
## 
## $Name
## [1] &quot;ru_RU&quot;</code></pre>
<p>Слабым местом функции <code>coll()</code> является скорость работы. Поскольку правила определения эквивалентности символов чрезвычайно сложны, функция <code>coll()</code> работает медленнее по сравнению с функциями <code>fixed()</code> и <code>regex()</code>.</p>
<ul>
<li>В примере с функцией <code>str_split()</code> уже знаем применение функции <code>boundary()</code> для сопоставления с границами. То же самое можно сделать и с другими функциями.</li>
</ul>
<div class="sourceCode" id="cb1252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1252-1" data-line-number="1">x &lt;-<span class="st"> &quot;This is a sentence.&quot;</span></a>
<a class="sourceLine" id="cb1252-2" data-line-number="2"><span class="kw">str_view_all</span>(x, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))</a></code></pre></div>
<div id="htmlwidget-aaa219e0d5df67abab67" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-aaa219e0d5df67abab67">{"x":{"html":"<ul>\n  <li><span class='match'>This<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>sentence<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1253-1" data-line-number="1"><span class="kw">str_extract_all</span>(x, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;This&quot;     &quot;is&quot;       &quot;a&quot;        &quot;sentence&quot;</code></pre>
<div id="-14.5.1.1" class="section level4">
<h4><span class="header-section-number">3.5.5.1</span> Упражнение 14.5.1.1</h4>
<div class="question">
<p>How would you find all strings containing <code>\</code> with regex() vs. with fixed()?</p>
</div>
<div class="sourceCode" id="cb1255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1255-1" data-line-number="1">string &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;a</span><span class="ch">\\</span><span class="st">b&quot;</span>, <span class="st">&quot;ab&quot;</span>)</a></code></pre></div>
<ul>
<li>При помощи функции <code>regex()</code></li>
</ul>
<div class="sourceCode" id="cb1256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1256-1" data-line-number="1"><span class="kw">str_subset</span>(string, <span class="st">&quot;</span><span class="ch">\\\\</span><span class="st">&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;a\\b&quot;</code></pre>
<ul>
<li>При помощи функции <code>fixed()</code></li>
</ul>
<div class="sourceCode" id="cb1258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1258-1" data-line-number="1"><span class="kw">str_subset</span>(<span class="kw">c</span>(<span class="st">&quot;a</span><span class="ch">\\</span><span class="st">b&quot;</span>, <span class="st">&quot;ab&quot;</span>), <span class="kw">fixed</span>(<span class="st">&quot;</span><span class="ch">\\</span><span class="st">&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;a\\b&quot;</code></pre>
</div>
<div id="-14.5.1.2" class="section level4">
<h4><span class="header-section-number">3.5.5.2</span> Упражнение 14.5.1.2</h4>
<div class="question">
<p>What are the five most common words in sentences?</p>
</div>
<p>Я предположу, что чаще всего используются артикли и предлоги. Проверим это.
Для того чтобы определить какие слова используются чаще других, нужно их посчитать. Но перед этим все слова в предложении нужно разбить на слова, без использования символов. Для этого воспользуемся разбиением при помощи функции <code>boundary()</code></p>
<div class="sourceCode" id="cb1260"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1260-1" data-line-number="1"><span class="kw">str_view_all</span>(sentences, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))</a></code></pre></div>
<div id="htmlwidget-e080b6953f14d18b1edb" style="width:960px;height:100%;" class="str_view html-widget"></div>
<script type="application/json" data-for="htmlwidget-e080b6953f14d18b1edb">{"x":{"html":"<ul>\n  <li><span class='match'>The<\/span> <span class='match'>birch<\/span> <span class='match'>canoe<\/span> <span class='match'>slid<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>smooth<\/span> <span class='match'>planks<\/span>.<\/li>\n  <li><span class='match'>Glue<\/span> <span class='match'>the<\/span> <span class='match'>sheet<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>dark<\/span> <span class='match'>blue<\/span> <span class='match'>background<\/span>.<\/li>\n  <li><span class='match'>It's<\/span> <span class='match'>easy<\/span> <span class='match'>to<\/span> <span class='match'>tell<\/span> <span class='match'>the<\/span> <span class='match'>depth<\/span> <span class='match'>of<\/span> <span class='match'>a<\/span> <span class='match'>well<\/span>.<\/li>\n  <li><span class='match'>These<\/span> <span class='match'>days<\/span> <span class='match'>a<\/span> <span class='match'>chicken<\/span> <span class='match'>leg<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>rare<\/span> <span class='match'>dish<\/span>.<\/li>\n  <li><span class='match'>Rice<\/span> <span class='match'>is<\/span> <span class='match'>often<\/span> <span class='match'>served<\/span> <span class='match'>in<\/span> <span class='match'>round<\/span> <span class='match'>bowls<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>juice<\/span> <span class='match'>of<\/span> <span class='match'>lemons<\/span> <span class='match'>makes<\/span> <span class='match'>fine<\/span> <span class='match'>punch<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>box<\/span> <span class='match'>was<\/span> <span class='match'>thrown<\/span> <span class='match'>beside<\/span> <span class='match'>the<\/span> <span class='match'>parked<\/span> <span class='match'>truck<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hogs<\/span> <span class='match'>were<\/span> <span class='match'>fed<\/span> <span class='match'>chopped<\/span> <span class='match'>corn<\/span> <span class='match'>and<\/span> <span class='match'>garbage<\/span>.<\/li>\n  <li><span class='match'>Four<\/span> <span class='match'>hours<\/span> <span class='match'>of<\/span> <span class='match'>steady<\/span> <span class='match'>work<\/span> <span class='match'>faced<\/span> <span class='match'>us<\/span>.<\/li>\n  <li><span class='match'>Large<\/span> <span class='match'>size<\/span> <span class='match'>in<\/span> <span class='match'>stockings<\/span> <span class='match'>is<\/span> <span class='match'>hard<\/span> <span class='match'>to<\/span> <span class='match'>sell<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>boy<\/span> <span class='match'>was<\/span> <span class='match'>there<\/span> <span class='match'>when<\/span> <span class='match'>the<\/span> <span class='match'>sun<\/span> <span class='match'>rose<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>rod<\/span> <span class='match'>is<\/span> <span class='match'>used<\/span> <span class='match'>to<\/span> <span class='match'>catch<\/span> <span class='match'>pink<\/span> <span class='match'>salmon<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>source<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>huge<\/span> <span class='match'>river<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>clear<\/span> <span class='match'>spring<\/span>.<\/li>\n  <li><span class='match'>Kick<\/span> <span class='match'>the<\/span> <span class='match'>ball<\/span> <span class='match'>straight<\/span> <span class='match'>and<\/span> <span class='match'>follow<\/span> <span class='match'>through<\/span>.<\/li>\n  <li><span class='match'>Help<\/span> <span class='match'>the<\/span> <span class='match'>woman<\/span> <span class='match'>get<\/span> <span class='match'>back<\/span> <span class='match'>to<\/span> <span class='match'>her<\/span> <span class='match'>feet<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>pot<\/span> <span class='match'>of<\/span> <span class='match'>tea<\/span> <span class='match'>helps<\/span> <span class='match'>to<\/span> <span class='match'>pass<\/span> <span class='match'>the<\/span> <span class='match'>evening<\/span>.<\/li>\n  <li><span class='match'>Smoky<\/span> <span class='match'>fires<\/span> <span class='match'>lack<\/span> <span class='match'>flame<\/span> <span class='match'>and<\/span> <span class='match'>heat<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>soft<\/span> <span class='match'>cushion<\/span> <span class='match'>broke<\/span> <span class='match'>the<\/span> <span class='match'>man's<\/span> <span class='match'>fall<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>salt<\/span> <span class='match'>breeze<\/span> <span class='match'>came<\/span> <span class='match'>across<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>sea<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>girl<\/span> <span class='match'>at<\/span> <span class='match'>the<\/span> <span class='match'>booth<\/span> <span class='match'>sold<\/span> <span class='match'>fifty<\/span> <span class='match'>bonds<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>small<\/span> <span class='match'>pup<\/span> <span class='match'>gnawed<\/span> <span class='match'>a<\/span> <span class='match'>hole<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>sock<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fish<\/span> <span class='match'>twisted<\/span> <span class='match'>and<\/span> <span class='match'>turned<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>bent<\/span> <span class='match'>hook<\/span>.<\/li>\n  <li><span class='match'>Press<\/span> <span class='match'>the<\/span> <span class='match'>pants<\/span> <span class='match'>and<\/span> <span class='match'>sew<\/span> <span class='match'>a<\/span> <span class='match'>button<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>vest<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>swan<\/span> <span class='match'>dive<\/span> <span class='match'>was<\/span> <span class='match'>far<\/span> <span class='match'>short<\/span> <span class='match'>of<\/span> <span class='match'>perfect<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>beauty<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>view<\/span> <span class='match'>stunned<\/span> <span class='match'>the<\/span> <span class='match'>young<\/span> <span class='match'>boy<\/span>.<\/li>\n  <li><span class='match'>Two<\/span> <span class='match'>blue<\/span> <span class='match'>fish<\/span> <span class='match'>swam<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>tank<\/span>.<\/li>\n  <li><span class='match'>Her<\/span> <span class='match'>purse<\/span> <span class='match'>was<\/span> <span class='match'>full<\/span> <span class='match'>of<\/span> <span class='match'>useless<\/span> <span class='match'>trash<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>colt<\/span> <span class='match'>reared<\/span> <span class='match'>and<\/span> <span class='match'>threw<\/span> <span class='match'>the<\/span> <span class='match'>tall<\/span> <span class='match'>rider<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>snowed<\/span>, <span class='match'>rained<\/span>, <span class='match'>and<\/span> <span class='match'>hailed<\/span> <span class='match'>the<\/span> <span class='match'>same<\/span> <span class='match'>morning<\/span>.<\/li>\n  <li><span class='match'>Read<\/span> <span class='match'>verse<\/span> <span class='match'>out<\/span> <span class='match'>loud<\/span> <span class='match'>for<\/span> <span class='match'>pleasure<\/span>.<\/li>\n  <li><span class='match'>Hoist<\/span> <span class='match'>the<\/span> <span class='match'>load<\/span> <span class='match'>to<\/span> <span class='match'>your<\/span> <span class='match'>left<\/span> <span class='match'>shoulder<\/span>.<\/li>\n  <li><span class='match'>Take<\/span> <span class='match'>the<\/span> <span class='match'>winding<\/span> <span class='match'>path<\/span> <span class='match'>to<\/span> <span class='match'>reach<\/span> <span class='match'>the<\/span> <span class='match'>lake<\/span>.<\/li>\n  <li><span class='match'>Note<\/span> <span class='match'>closely<\/span> <span class='match'>the<\/span> <span class='match'>size<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>gas<\/span> <span class='match'>tank<\/span>.<\/li>\n  <li><span class='match'>Wipe<\/span> <span class='match'>the<\/span> <span class='match'>grease<\/span> <span class='match'>off<\/span> <span class='match'>his<\/span> <span class='match'>dirty<\/span> <span class='match'>face<\/span>.<\/li>\n  <li><span class='match'>Mend<\/span> <span class='match'>the<\/span> <span class='match'>coat<\/span> <span class='match'>before<\/span> <span class='match'>you<\/span> <span class='match'>go<\/span> <span class='match'>out<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>wrist<\/span> <span class='match'>was<\/span> <span class='match'>badly<\/span> <span class='match'>strained<\/span> <span class='match'>and<\/span> <span class='match'>hung<\/span> <span class='match'>limp<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>stray<\/span> <span class='match'>cat<\/span> <span class='match'>gave<\/span> <span class='match'>birth<\/span> <span class='match'>to<\/span> <span class='match'>kittens<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>young<\/span> <span class='match'>girl<\/span> <span class='match'>gave<\/span> <span class='match'>no<\/span> <span class='match'>clear<\/span> <span class='match'>response<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>meal<\/span> <span class='match'>was<\/span> <span class='match'>cooked<\/span> <span class='match'>before<\/span> <span class='match'>the<\/span> <span class='match'>bell<\/span> <span class='match'>rang<\/span>.<\/li>\n  <li><span class='match'>What<\/span> <span class='match'>joy<\/span> <span class='match'>there<\/span> <span class='match'>is<\/span> <span class='match'>in<\/span> <span class='match'>living<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>king<\/span> <span class='match'>ruled<\/span> <span class='match'>the<\/span> <span class='match'>state<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>early<\/span> <span class='match'>days<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>ship<\/span> <span class='match'>was<\/span> <span class='match'>torn<\/span> <span class='match'>apart<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>sharp<\/span> <span class='match'>reef<\/span>.<\/li>\n  <li><span class='match'>Sickness<\/span> <span class='match'>kept<\/span> <span class='match'>him<\/span> <span class='match'>home<\/span> <span class='match'>the<\/span> <span class='match'>third<\/span> <span class='match'>week<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>wide<\/span> <span class='match'>road<\/span> <span class='match'>shimmered<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>hot<\/span> <span class='match'>sun<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>lazy<\/span> <span class='match'>cow<\/span> <span class='match'>lay<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>cool<\/span> <span class='match'>grass<\/span>.<\/li>\n  <li><span class='match'>Lift<\/span> <span class='match'>the<\/span> <span class='match'>square<\/span> <span class='match'>stone<\/span> <span class='match'>over<\/span> <span class='match'>the<\/span> <span class='match'>fence<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>rope<\/span> <span class='match'>will<\/span> <span class='match'>bind<\/span> <span class='match'>the<\/span> <span class='match'>seven<\/span> <span class='match'>books<\/span> <span class='match'>at<\/span> <span class='match'>once<\/span>.<\/li>\n  <li><span class='match'>Hop<\/span> <span class='match'>over<\/span> <span class='match'>the<\/span> <span class='match'>fence<\/span> <span class='match'>and<\/span> <span class='match'>plunge<\/span> <span class='match'>in<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>friendly<\/span> <span class='match'>gang<\/span> <span class='match'>left<\/span> <span class='match'>the<\/span> <span class='match'>drug<\/span> <span class='match'>store<\/span>.<\/li>\n  <li><span class='match'>Mesh<\/span> <span class='match'>mire<\/span> <span class='match'>keeps<\/span> <span class='match'>chicks<\/span> <span class='match'>inside<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>frosty<\/span> <span class='match'>air<\/span> <span class='match'>passed<\/span> <span class='match'>through<\/span> <span class='match'>the<\/span> <span class='match'>coat<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>crooked<\/span> <span class='match'>maze<\/span> <span class='match'>failed<\/span> <span class='match'>to<\/span> <span class='match'>fool<\/span> <span class='match'>the<\/span> <span class='match'>mouse<\/span>.<\/li>\n  <li><span class='match'>Adding<\/span> <span class='match'>fast<\/span> <span class='match'>leads<\/span> <span class='match'>to<\/span> <span class='match'>wrong<\/span> <span class='match'>sums<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>show<\/span> <span class='match'>was<\/span> <span class='match'>a<\/span> <span class='match'>flop<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>very<\/span> <span class='match'>start<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>saw<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>tool<\/span> <span class='match'>used<\/span> <span class='match'>for<\/span> <span class='match'>making<\/span> <span class='match'>boards<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>wagon<\/span> <span class='match'>moved<\/span> <span class='match'>on<\/span> <span class='match'>well<\/span> <span class='match'>oiled<\/span> <span class='match'>wheels<\/span>.<\/li>\n  <li><span class='match'>March<\/span> <span class='match'>the<\/span> <span class='match'>soldiers<\/span> <span class='match'>past<\/span> <span class='match'>the<\/span> <span class='match'>next<\/span> <span class='match'>hill<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>cup<\/span> <span class='match'>of<\/span> <span class='match'>sugar<\/span> <span class='match'>makes<\/span> <span class='match'>sweet<\/span> <span class='match'>fudge<\/span>.<\/li>\n  <li><span class='match'>Place<\/span> <span class='match'>a<\/span> <span class='match'>rosebush<\/span> <span class='match'>near<\/span> <span class='match'>the<\/span> <span class='match'>porch<\/span> <span class='match'>steps<\/span>.<\/li>\n  <li><span class='match'>Both<\/span> <span class='match'>lost<\/span> <span class='match'>their<\/span> <span class='match'>lives<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>raging<\/span> <span class='match'>storm<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>talked<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>slide<\/span> <span class='match'>show<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>circus<\/span>.<\/li>\n  <li><span class='match'>Use<\/span> <span class='match'>a<\/span> <span class='match'>pencil<\/span> <span class='match'>to<\/span> <span class='match'>write<\/span> <span class='match'>the<\/span> <span class='match'>first<\/span> <span class='match'>draft<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>ran<\/span> <span class='match'>half<\/span> <span class='match'>way<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>hardware<\/span> <span class='match'>store<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>clock<\/span> <span class='match'>struck<\/span> <span class='match'>to<\/span> <span class='match'>mark<\/span> <span class='match'>the<\/span> <span class='match'>third<\/span> <span class='match'>period<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>small<\/span> <span class='match'>creek<\/span> <span class='match'>cut<\/span> <span class='match'>across<\/span> <span class='match'>the<\/span> <span class='match'>field<\/span>.<\/li>\n  <li><span class='match'>Cars<\/span> <span class='match'>and<\/span> <span class='match'>busses<\/span> <span class='match'>stalled<\/span> <span class='match'>in<\/span> <span class='match'>snow<\/span> <span class='match'>drifts<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>set<\/span> <span class='match'>of<\/span> <span class='match'>china<\/span> <span class='match'>hit<\/span>, <span class='match'>the<\/span> <span class='match'>floor<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>crash<\/span>.<\/li>\n  <li><span class='match'>This<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>grand<\/span> <span class='match'>season<\/span> <span class='match'>for<\/span> <span class='match'>hikes<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>road<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>dune<\/span> <span class='match'>rose<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>edge<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>water<\/span>.<\/li>\n  <li><span class='match'>Those<\/span> <span class='match'>words<\/span> <span class='match'>were<\/span> <span class='match'>the<\/span> <span class='match'>cue<\/span> <span class='match'>for<\/span> <span class='match'>the<\/span> <span class='match'>actor<\/span> <span class='match'>to<\/span> <span class='match'>leave<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>yacht<\/span> <span class='match'>slid<\/span> <span class='match'>around<\/span> <span class='match'>the<\/span> <span class='match'>point<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>bay<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>two<\/span> <span class='match'>met<\/span> <span class='match'>while<\/span> <span class='match'>playing<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>sand<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>ink<\/span> <span class='match'>stain<\/span> <span class='match'>dried<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>finished<\/span> <span class='match'>page<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>walled<\/span> <span class='match'>town<\/span> <span class='match'>was<\/span> <span class='match'>seized<\/span> <span class='match'>without<\/span> <span class='match'>a<\/span> <span class='match'>fight<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>lease<\/span> <span class='match'>ran<\/span> <span class='match'>out<\/span> <span class='match'>in<\/span> <span class='match'>sixteen<\/span> <span class='match'>weeks<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>tame<\/span> <span class='match'>squirrel<\/span> <span class='match'>makes<\/span> <span class='match'>a<\/span> <span class='match'>nice<\/span> <span class='match'>pet<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>horn<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>car<\/span> <span class='match'>woke<\/span> <span class='match'>the<\/span> <span class='match'>sleeping<\/span> <span class='match'>cop<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>heart<\/span> <span class='match'>beat<\/span> <span class='match'>strongly<\/span> <span class='match'>and<\/span> <span class='match'>with<\/span> <span class='match'>firm<\/span> <span class='match'>strokes<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pearl<\/span> <span class='match'>was<\/span> <span class='match'>worn<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>thin<\/span> <span class='match'>silver<\/span> <span class='match'>ring<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fruit<\/span> <span class='match'>peel<\/span> <span class='match'>was<\/span> <span class='match'>cut<\/span> <span class='match'>in<\/span> <span class='match'>thick<\/span> <span class='match'>slices<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>Navy<\/span> <span class='match'>attacked<\/span> <span class='match'>the<\/span> <span class='match'>big<\/span> <span class='match'>task<\/span> <span class='match'>force<\/span>.<\/li>\n  <li><span class='match'>See<\/span> <span class='match'>the<\/span> <span class='match'>cat<\/span> <span class='match'>glaring<\/span> <span class='match'>at<\/span> <span class='match'>the<\/span> <span class='match'>scared<\/span> <span class='match'>mouse<\/span>.<\/li>\n  <li><span class='match'>There<\/span> <span class='match'>are<\/span> <span class='match'>more<\/span> <span class='match'>than<\/span> <span class='match'>two<\/span> <span class='match'>factors<\/span> <span class='match'>here<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hat<\/span> <span class='match'>brim<\/span> <span class='match'>was<\/span> <span class='match'>wide<\/span> <span class='match'>and<\/span> <span class='match'>too<\/span> <span class='match'>droopy<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>lawyer<\/span> <span class='match'>tried<\/span> <span class='match'>to<\/span> <span class='match'>lose<\/span> <span class='match'>his<\/span> <span class='match'>case<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>grass<\/span> <span class='match'>curled<\/span> <span class='match'>around<\/span> <span class='match'>the<\/span> <span class='match'>fence<\/span> <span class='match'>post<\/span>.<\/li>\n  <li><span class='match'>Cut<\/span> <span class='match'>the<\/span> <span class='match'>pie<\/span> <span class='match'>into<\/span> <span class='match'>large<\/span> <span class='match'>parts<\/span>.<\/li>\n  <li><span class='match'>Men<\/span> <span class='match'>strive<\/span> <span class='match'>but<\/span> <span class='match'>seldom<\/span> <span class='match'>get<\/span> <span class='match'>rich<\/span>.<\/li>\n  <li><span class='match'>Always<\/span> <span class='match'>close<\/span> <span class='match'>the<\/span> <span class='match'>barn<\/span> <span class='match'>door<\/span> <span class='match'>tight<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>lay<\/span> <span class='match'>prone<\/span> <span class='match'>and<\/span> <span class='match'>hardly<\/span> <span class='match'>moved<\/span> <span class='match'>a<\/span> <span class='match'>limb<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>slush<\/span> <span class='match'>lay<\/span> <span class='match'>deep<\/span> <span class='match'>along<\/span> <span class='match'>the<\/span> <span class='match'>street<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>wisp<\/span> <span class='match'>of<\/span> <span class='match'>cloud<\/span> <span class='match'>hung<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>blue<\/span> <span class='match'>air<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>pound<\/span> <span class='match'>of<\/span> <span class='match'>sugar<\/span> <span class='match'>costs<\/span> <span class='match'>more<\/span> <span class='match'>than<\/span> <span class='match'>eggs<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fin<\/span> <span class='match'>was<\/span> <span class='match'>sharp<\/span> <span class='match'>and<\/span> <span class='match'>cut<\/span> <span class='match'>the<\/span> <span class='match'>clear<\/span> <span class='match'>water<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>play<\/span> <span class='match'>seems<\/span> <span class='match'>dull<\/span> <span class='match'>and<\/span> <span class='match'>quite<\/span> <span class='match'>stupid<\/span>.<\/li>\n  <li><span class='match'>Bail<\/span> <span class='match'>the<\/span> <span class='match'>boat<\/span>, <span class='match'>to<\/span> <span class='match'>stop<\/span> <span class='match'>it<\/span> <span class='match'>from<\/span> <span class='match'>sinking<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>term<\/span> <span class='match'>ended<\/span> <span class='match'>in<\/span> <span class='match'>late<\/span> <span class='match'>June<\/span> <span class='match'>that<\/span> <span class='match'>year<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>tusk<\/span> <span class='match'>is<\/span> <span class='match'>used<\/span> <span class='match'>to<\/span> <span class='match'>make<\/span> <span class='match'>costly<\/span> <span class='match'>gifts<\/span>.<\/li>\n  <li><span class='match'>Ten<\/span> <span class='match'>pins<\/span> <span class='match'>were<\/span> <span class='match'>set<\/span> <span class='match'>in<\/span> <span class='match'>order<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bill<\/span> <span class='match'>as<\/span> <span class='match'>paid<\/span> <span class='match'>every<\/span> <span class='match'>third<\/span> <span class='match'>week<\/span>.<\/li>\n  <li><span class='match'>Oak<\/span> <span class='match'>is<\/span> <span class='match'>strong<\/span> <span class='match'>and<\/span> <span class='match'>also<\/span> <span class='match'>gives<\/span> <span class='match'>shade<\/span>.<\/li>\n  <li><span class='match'>Cats<\/span> <span class='match'>and<\/span> <span class='match'>dogs<\/span> <span class='match'>each<\/span> <span class='match'>hate<\/span> <span class='match'>the<\/span> <span class='match'>other<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pipe<\/span> <span class='match'>began<\/span> <span class='match'>to<\/span> <span class='match'>rust<\/span> <span class='match'>while<\/span> <span class='match'>new<\/span>.<\/li>\n  <li><span class='match'>Open<\/span> <span class='match'>the<\/span> <span class='match'>crate<\/span> <span class='match'>but<\/span> <span class='match'>don't<\/span> <span class='match'>break<\/span> <span class='match'>the<\/span> <span class='match'>glass<\/span>.<\/li>\n  <li><span class='match'>Add<\/span> <span class='match'>the<\/span> <span class='match'>sum<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>product<\/span> <span class='match'>of<\/span> <span class='match'>these<\/span> <span class='match'>three<\/span>.<\/li>\n  <li><span class='match'>Thieves<\/span> <span class='match'>who<\/span> <span class='match'>rob<\/span> <span class='match'>friends<\/span> <span class='match'>deserve<\/span> <span class='match'>jail<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>ripe<\/span> <span class='match'>taste<\/span> <span class='match'>of<\/span> <span class='match'>cheese<\/span> <span class='match'>improves<\/span> <span class='match'>with<\/span> <span class='match'>age<\/span>.<\/li>\n  <li><span class='match'>Act<\/span> <span class='match'>on<\/span> <span class='match'>these<\/span> <span class='match'>orders<\/span> <span class='match'>with<\/span> <span class='match'>great<\/span> <span class='match'>speed<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hog<\/span> <span class='match'>crawled<\/span> <span class='match'>under<\/span> <span class='match'>the<\/span> <span class='match'>high<\/span> <span class='match'>fence<\/span>.<\/li>\n  <li><span class='match'>Move<\/span> <span class='match'>the<\/span> <span class='match'>vat<\/span> <span class='match'>over<\/span> <span class='match'>the<\/span> <span class='match'>hot<\/span> <span class='match'>fire<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bark<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>pine<\/span> <span class='match'>tree<\/span> <span class='match'>was<\/span> <span class='match'>shiny<\/span> <span class='match'>and<\/span> <span class='match'>dark<\/span>.<\/li>\n  <li><span class='match'>Leaves<\/span> <span class='match'>turn<\/span> <span class='match'>brown<\/span> <span class='match'>and<\/span> <span class='match'>yellow<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>fall<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pennant<\/span> <span class='match'>waved<\/span> <span class='match'>when<\/span> <span class='match'>the<\/span> <span class='match'>wind<\/span> <span class='match'>blew<\/span>.<\/li>\n  <li><span class='match'>Split<\/span> <span class='match'>the<\/span> <span class='match'>log<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>quick<\/span>, <span class='match'>sharp<\/span> <span class='match'>blow<\/span>.<\/li>\n  <li><span class='match'>Burn<\/span> <span class='match'>peat<\/span> <span class='match'>after<\/span> <span class='match'>the<\/span> <span class='match'>logs<\/span> <span class='match'>give<\/span> <span class='match'>out<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>ordered<\/span> <span class='match'>peach<\/span> <span class='match'>pie<\/span> <span class='match'>with<\/span> <span class='match'>ice<\/span> <span class='match'>cream<\/span>.<\/li>\n  <li><span class='match'>Weave<\/span> <span class='match'>the<\/span> <span class='match'>carpet<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>right<\/span> <span class='match'>hand<\/span> <span class='match'>side<\/span>.<\/li>\n  <li><span class='match'>Hemp<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>weed<\/span> <span class='match'>found<\/span> <span class='match'>in<\/span> <span class='match'>parts<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>tropics<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>lame<\/span> <span class='match'>back<\/span> <span class='match'>kept<\/span> <span class='match'>his<\/span> <span class='match'>score<\/span> <span class='match'>low<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>find<\/span> <span class='match'>joy<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>simplest<\/span> <span class='match'>things<\/span>.<\/li>\n  <li><span class='match'>Type<\/span> <span class='match'>out<\/span> <span class='match'>three<\/span> <span class='match'>lists<\/span> <span class='match'>of<\/span> <span class='match'>orders<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>harder<\/span> <span class='match'>he<\/span> <span class='match'>tried<\/span> <span class='match'>the<\/span> <span class='match'>less<\/span> <span class='match'>he<\/span> <span class='match'>got<\/span> <span class='match'>done<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>boss<\/span> <span class='match'>ran<\/span> <span class='match'>the<\/span> <span class='match'>show<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>watchful<\/span> <span class='match'>eye<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>cup<\/span> <span class='match'>cracked<\/span> <span class='match'>and<\/span> <span class='match'>spilled<\/span> <span class='match'>its<\/span> <span class='match'>contents<\/span>.<\/li>\n  <li><span class='match'>Paste<\/span> <span class='match'>can<\/span> <span class='match'>cleanse<\/span> <span class='match'>the<\/span> <span class='match'>most<\/span> <span class='match'>dirty<\/span> <span class='match'>brass<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>slang<\/span> <span class='match'>word<\/span> <span class='match'>for<\/span> <span class='match'>raw<\/span> <span class='match'>whiskey<\/span> <span class='match'>is<\/span> <span class='match'>booze<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>caught<\/span> <span class='match'>its<\/span> <span class='match'>hind<\/span> <span class='match'>paw<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>rusty<\/span> <span class='match'>trap<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>wharf<\/span> <span class='match'>could<\/span> <span class='match'>be<\/span> <span class='match'>seen<\/span> <span class='match'>at<\/span> <span class='match'>the<\/span> <span class='match'>farther<\/span> <span class='match'>shore<\/span>.<\/li>\n  <li><span class='match'>Feel<\/span> <span class='match'>the<\/span> <span class='match'>heat<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>weak<\/span> <span class='match'>dying<\/span> <span class='match'>flame<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>tiny<\/span> <span class='match'>girl<\/span> <span class='match'>took<\/span> <span class='match'>off<\/span> <span class='match'>her<\/span> <span class='match'>hat<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>cramp<\/span> <span class='match'>is<\/span> <span class='match'>no<\/span> <span class='match'>small<\/span> <span class='match'>danger<\/span> <span class='match'>on<\/span> <span class='match'>a<\/span> <span class='match'>swim<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>said<\/span> <span class='match'>the<\/span> <span class='match'>same<\/span> <span class='match'>phrase<\/span> <span class='match'>thirty<\/span> <span class='match'>times<\/span>.<\/li>\n  <li><span class='match'>Pluck<\/span> <span class='match'>the<\/span> <span class='match'>bright<\/span> <span class='match'>rose<\/span> <span class='match'>without<\/span> <span class='match'>leaves<\/span>.<\/li>\n  <li><span class='match'>Two<\/span> <span class='match'>plus<\/span> <span class='match'>seven<\/span> <span class='match'>is<\/span> <span class='match'>less<\/span> <span class='match'>than<\/span> <span class='match'>ten<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>glow<\/span> <span class='match'>deepened<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>eyes<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>sweet<\/span> <span class='match'>girl<\/span>.<\/li>\n  <li><span class='match'>Bring<\/span> <span class='match'>your<\/span> <span class='match'>problems<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>wise<\/span> <span class='match'>chief<\/span>.<\/li>\n  <li><span class='match'>Write<\/span> <span class='match'>a<\/span> <span class='match'>fond<\/span> <span class='match'>note<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>friend<\/span> <span class='match'>you<\/span> <span class='match'>cherish<\/span>.<\/li>\n  <li><span class='match'>Clothes<\/span> <span class='match'>and<\/span> <span class='match'>lodging<\/span> <span class='match'>are<\/span> <span class='match'>free<\/span> <span class='match'>to<\/span> <span class='match'>new<\/span> <span class='match'>men<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>frown<\/span> <span class='match'>when<\/span> <span class='match'>events<\/span> <span class='match'>take<\/span> <span class='match'>a<\/span> <span class='match'>bad<\/span> <span class='match'>turn<\/span>.<\/li>\n  <li><span class='match'>Port<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>strong<\/span> <span class='match'>wine<\/span> <span class='match'>with<\/span> <span class='match'>s<\/span> <span class='match'>smoky<\/span> <span class='match'>taste<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>young<\/span> <span class='match'>kid<\/span> <span class='match'>jumped<\/span> <span class='match'>the<\/span> <span class='match'>rusty<\/span> <span class='match'>gate<\/span>.<\/li>\n  <li><span class='match'>Guess<\/span> <span class='match'>the<\/span> <span class='match'>results<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>first<\/span> <span class='match'>scores<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>salt<\/span> <span class='match'>pickle<\/span> <span class='match'>tastes<\/span> <span class='match'>fine<\/span> <span class='match'>with<\/span> <span class='match'>ham<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>just<\/span> <span class='match'>claim<\/span> <span class='match'>got<\/span> <span class='match'>the<\/span> <span class='match'>right<\/span> <span class='match'>verdict<\/span>.<\/li>\n  <li><span class='match'>These<\/span> <span class='match'>thistles<\/span> <span class='match'>bend<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>high<\/span> <span class='match'>wind<\/span>.<\/li>\n  <li><span class='match'>Pure<\/span> <span class='match'>bred<\/span> <span class='match'>poodles<\/span> <span class='match'>have<\/span> <span class='match'>curls<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>tree<\/span> <span class='match'>top<\/span> <span class='match'>waved<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>graceful<\/span> <span class='match'>way<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>spot<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>blotter<\/span> <span class='match'>was<\/span> <span class='match'>made<\/span> <span class='match'>by<\/span> <span class='match'>green<\/span> <span class='match'>ink<\/span>.<\/li>\n  <li><span class='match'>Mud<\/span> <span class='match'>was<\/span> <span class='match'>spattered<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>front<\/span> <span class='match'>of<\/span> <span class='match'>his<\/span> <span class='match'>white<\/span> <span class='match'>shirt<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>cigar<\/span> <span class='match'>burned<\/span> <span class='match'>a<\/span> <span class='match'>hole<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>desk<\/span> <span class='match'>top<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>empty<\/span> <span class='match'>flask<\/span> <span class='match'>stood<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>tin<\/span> <span class='match'>tray<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>speedy<\/span> <span class='match'>man<\/span> <span class='match'>can<\/span> <span class='match'>beat<\/span> <span class='match'>this<\/span> <span class='match'>track<\/span> <span class='match'>mark<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>broke<\/span> <span class='match'>a<\/span> <span class='match'>new<\/span> <span class='match'>shoelace<\/span> <span class='match'>that<\/span> <span class='match'>day<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>coffee<\/span> <span class='match'>stand<\/span> <span class='match'>is<\/span> <span class='match'>too<\/span> <span class='match'>high<\/span> <span class='match'>for<\/span> <span class='match'>the<\/span> <span class='match'>couch<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>urge<\/span> <span class='match'>to<\/span> <span class='match'>write<\/span> <span class='match'>short<\/span> <span class='match'>stories<\/span> <span class='match'>is<\/span> <span class='match'>rare<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pencils<\/span> <span class='match'>have<\/span> <span class='match'>all<\/span> <span class='match'>been<\/span> <span class='match'>used<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pirates<\/span> <span class='match'>seized<\/span> <span class='match'>the<\/span> <span class='match'>crew<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>lost<\/span> <span class='match'>ship<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>tried<\/span> <span class='match'>to<\/span> <span class='match'>replace<\/span> <span class='match'>the<\/span> <span class='match'>coin<\/span> <span class='match'>but<\/span> <span class='match'>failed<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>sewed<\/span> <span class='match'>the<\/span> <span class='match'>torn<\/span> <span class='match'>coat<\/span> <span class='match'>quite<\/span> <span class='match'>neatly<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sofa<\/span> <span class='match'>cushion<\/span> <span class='match'>is<\/span> <span class='match'>red<\/span> <span class='match'>and<\/span> <span class='match'>of<\/span> <span class='match'>light<\/span> <span class='match'>weight<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>jacket<\/span> <span class='match'>hung<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>back<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>wide<\/span> <span class='match'>chair<\/span>.<\/li>\n  <li><span class='match'>At<\/span> <span class='match'>that<\/span> <span class='match'>high<\/span> <span class='match'>level<\/span> <span class='match'>the<\/span> <span class='match'>air<\/span> <span class='match'>is<\/span> <span class='match'>pure<\/span>.<\/li>\n  <li><span class='match'>Drop<\/span> <span class='match'>the<\/span> <span class='match'>two<\/span> <span class='match'>when<\/span> <span class='match'>you<\/span> <span class='match'>add<\/span> <span class='match'>the<\/span> <span class='match'>figures<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>filing<\/span> <span class='match'>case<\/span> <span class='match'>is<\/span> <span class='match'>now<\/span> <span class='match'>hard<\/span> <span class='match'>to<\/span> <span class='match'>buy<\/span>.<\/li>\n  <li><span class='match'>An<\/span> <span class='match'>abrupt<\/span> <span class='match'>start<\/span> <span class='match'>does<\/span> <span class='match'>not<\/span> <span class='match'>win<\/span> <span class='match'>the<\/span> <span class='match'>prize<\/span>.<\/li>\n  <li><span class='match'>Wood<\/span> <span class='match'>is<\/span> <span class='match'>best<\/span> <span class='match'>for<\/span> <span class='match'>making<\/span> <span class='match'>toys<\/span> <span class='match'>and<\/span> <span class='match'>blocks<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>office<\/span> <span class='match'>paint<\/span> <span class='match'>was<\/span> <span class='match'>a<\/span> <span class='match'>dull<\/span> <span class='match'>sad<\/span> <span class='match'>tan<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>knew<\/span> <span class='match'>the<\/span> <span class='match'>skill<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>great<\/span> <span class='match'>young<\/span> <span class='match'>actress<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>rag<\/span> <span class='match'>will<\/span> <span class='match'>soak<\/span> <span class='match'>up<\/span> <span class='match'>spilled<\/span> <span class='match'>water<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>shower<\/span> <span class='match'>of<\/span> <span class='match'>dirt<\/span> <span class='match'>fell<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>hot<\/span> <span class='match'>pipes<\/span>.<\/li>\n  <li><span class='match'>Steam<\/span> <span class='match'>hissed<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>broken<\/span> <span class='match'>valve<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>child<\/span> <span class='match'>almost<\/span> <span class='match'>hurt<\/span> <span class='match'>the<\/span> <span class='match'>small<\/span> <span class='match'>dog<\/span>.<\/li>\n  <li><span class='match'>There<\/span> <span class='match'>was<\/span> <span class='match'>a<\/span> <span class='match'>sound<\/span> <span class='match'>of<\/span> <span class='match'>dry<\/span> <span class='match'>leaves<\/span> <span class='match'>outside<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sky<\/span> <span class='match'>that<\/span> <span class='match'>morning<\/span> <span class='match'>was<\/span> <span class='match'>clear<\/span> <span class='match'>and<\/span> <span class='match'>bright<\/span> <span class='match'>blue<\/span>.<\/li>\n  <li><span class='match'>Torn<\/span> <span class='match'>scraps<\/span> <span class='match'>littered<\/span> <span class='match'>the<\/span> <span class='match'>stone<\/span> <span class='match'>floor<\/span>.<\/li>\n  <li><span class='match'>Sunday<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>best<\/span> <span class='match'>part<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>week<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>doctor<\/span> <span class='match'>cured<\/span> <span class='match'>him<\/span> <span class='match'>with<\/span> <span class='match'>these<\/span> <span class='match'>pills<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>new<\/span> <span class='match'>girl<\/span> <span class='match'>was<\/span> <span class='match'>fired<\/span> <span class='match'>today<\/span> <span class='match'>at<\/span> <span class='match'>noon<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>felt<\/span> <span class='match'>gay<\/span> <span class='match'>when<\/span> <span class='match'>the<\/span> <span class='match'>ship<\/span> <span class='match'>arrived<\/span> <span class='match'>in<\/span> <span class='match'>port<\/span>.<\/li>\n  <li><span class='match'>Add<\/span> <span class='match'>the<\/span> <span class='match'>store's<\/span> <span class='match'>account<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>last<\/span> <span class='match'>cent<\/span>.<\/li>\n  <li><span class='match'>Acid<\/span> <span class='match'>burns<\/span> <span class='match'>holes<\/span> <span class='match'>in<\/span> <span class='match'>wool<\/span> <span class='match'>cloth<\/span>.<\/li>\n  <li><span class='match'>Fairy<\/span> <span class='match'>tales<\/span> <span class='match'>should<\/span> <span class='match'>be<\/span> <span class='match'>fun<\/span> <span class='match'>to<\/span> <span class='match'>write<\/span>.<\/li>\n  <li><span class='match'>Eight<\/span> <span class='match'>miles<\/span> <span class='match'>of<\/span> <span class='match'>woodland<\/span> <span class='match'>burned<\/span> <span class='match'>to<\/span> <span class='match'>waste<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>third<\/span> <span class='match'>act<\/span> <span class='match'>was<\/span> <span class='match'>dull<\/span> <span class='match'>and<\/span> <span class='match'>tired<\/span> <span class='match'>the<\/span> <span class='match'>players<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>young<\/span> <span class='match'>child<\/span> <span class='match'>should<\/span> <span class='match'>not<\/span> <span class='match'>suffer<\/span> <span class='match'>fright<\/span>.<\/li>\n  <li><span class='match'>Add<\/span> <span class='match'>the<\/span> <span class='match'>column<\/span> <span class='match'>and<\/span> <span class='match'>put<\/span> <span class='match'>the<\/span> <span class='match'>sum<\/span> <span class='match'>here<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>admire<\/span> <span class='match'>and<\/span> <span class='match'>love<\/span> <span class='match'>a<\/span> <span class='match'>good<\/span> <span class='match'>cook<\/span>.<\/li>\n  <li><span class='match'>There<\/span> <span class='match'>the<\/span> <span class='match'>flood<\/span> <span class='match'>mark<\/span> <span class='match'>is<\/span> <span class='match'>ten<\/span> <span class='match'>inches<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>carved<\/span> <span class='match'>a<\/span> <span class='match'>head<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>round<\/span> <span class='match'>block<\/span> <span class='match'>of<\/span> <span class='match'>marble<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>has<\/span> <span class='match'>st<\/span> <span class='match'>smart<\/span> <span class='match'>way<\/span> <span class='match'>of<\/span> <span class='match'>wearing<\/span> <span class='match'>clothes<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fruit<\/span> <span class='match'>of<\/span> <span class='match'>a<\/span> <span class='match'>fig<\/span> <span class='match'>tree<\/span> <span class='match'>is<\/span> <span class='match'>apple<\/span>-<span class='match'>shaped<\/span>.<\/li>\n  <li><span class='match'>Corn<\/span> <span class='match'>cobs<\/span> <span class='match'>can<\/span> <span class='match'>be<\/span> <span class='match'>used<\/span> <span class='match'>to<\/span> <span class='match'>kindle<\/span> <span class='match'>a<\/span> <span class='match'>fire<\/span>.<\/li>\n  <li><span class='match'>Where<\/span> <span class='match'>were<\/span> <span class='match'>they<\/span> <span class='match'>when<\/span> <span class='match'>the<\/span> <span class='match'>noise<\/span> <span class='match'>started<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>paper<\/span> <span class='match'>box<\/span> <span class='match'>is<\/span> <span class='match'>full<\/span> <span class='match'>of<\/span> <span class='match'>thumb<\/span> <span class='match'>tacks<\/span>.<\/li>\n  <li><span class='match'>Sell<\/span> <span class='match'>your<\/span> <span class='match'>gift<\/span> <span class='match'>to<\/span> <span class='match'>a<\/span> <span class='match'>buyer<\/span> <span class='match'>at<\/span> <span class='match'>a<\/span> <span class='match'>good<\/span> <span class='match'>gain<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>tongs<\/span> <span class='match'>lay<\/span> <span class='match'>beside<\/span> <span class='match'>the<\/span> <span class='match'>ice<\/span> <span class='match'>pail<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>petals<\/span> <span class='match'>fall<\/span> <span class='match'>with<\/span> <span class='match'>the<\/span> <span class='match'>next<\/span> <span class='match'>puff<\/span> <span class='match'>of<\/span> <span class='match'>wind<\/span>.<\/li>\n  <li><span class='match'>Bring<\/span> <span class='match'>your<\/span> <span class='match'>best<\/span> <span class='match'>compass<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>third<\/span> <span class='match'>class<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>could<\/span> <span class='match'>laugh<\/span> <span class='match'>although<\/span> <span class='match'>they<\/span> <span class='match'>were<\/span> <span class='match'>sad<\/span>.<\/li>\n  <li><span class='match'>Farmers<\/span> <span class='match'>came<\/span> <span class='match'>in<\/span> <span class='match'>to<\/span> <span class='match'>thresh<\/span> <span class='match'>the<\/span> <span class='match'>oat<\/span> <span class='match'>crop<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>brown<\/span> <span class='match'>house<\/span> <span class='match'>was<\/span> <span class='match'>on<\/span> <span class='match'>fire<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>attic<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>lure<\/span> <span class='match'>is<\/span> <span class='match'>used<\/span> <span class='match'>to<\/span> <span class='match'>catch<\/span> <span class='match'>trout<\/span> <span class='match'>and<\/span> <span class='match'>flounder<\/span>.<\/li>\n  <li><span class='match'>Float<\/span> <span class='match'>the<\/span> <span class='match'>soap<\/span> <span class='match'>on<\/span> <span class='match'>top<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>bath<\/span> <span class='match'>water<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>blue<\/span> <span class='match'>crane<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>tall<\/span> <span class='match'>wading<\/span> <span class='match'>bird<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>fresh<\/span> <span class='match'>start<\/span> <span class='match'>will<\/span> <span class='match'>work<\/span> <span class='match'>such<\/span> <span class='match'>wonders<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>club<\/span> <span class='match'>rented<\/span> <span class='match'>the<\/span> <span class='match'>rink<\/span> <span class='match'>for<\/span> <span class='match'>the<\/span> <span class='match'>fifth<\/span> <span class='match'>night<\/span>.<\/li>\n  <li><span class='match'>After<\/span> <span class='match'>the<\/span> <span class='match'>dance<\/span> <span class='match'>they<\/span> <span class='match'>went<\/span> <span class='match'>straight<\/span> <span class='match'>home<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hostess<\/span> <span class='match'>taught<\/span> <span class='match'>the<\/span> <span class='match'>new<\/span> <span class='match'>maid<\/span> <span class='match'>to<\/span> <span class='match'>serve<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>wrote<\/span> <span class='match'>his<\/span> <span class='match'>last<\/span> <span class='match'>novel<\/span> <span class='match'>there<\/span> <span class='match'>at<\/span> <span class='match'>the<\/span> <span class='match'>inn<\/span>.<\/li>\n  <li><span class='match'>Even<\/span> <span class='match'>the<\/span> <span class='match'>worst<\/span> <span class='match'>will<\/span> <span class='match'>beat<\/span> <span class='match'>his<\/span> <span class='match'>low<\/span> <span class='match'>score<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>cement<\/span> <span class='match'>had<\/span> <span class='match'>dried<\/span> <span class='match'>when<\/span> <span class='match'>he<\/span> <span class='match'>moved<\/span> <span class='match'>it<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>loss<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>second<\/span> <span class='match'>ship<\/span> <span class='match'>was<\/span> <span class='match'>hard<\/span> <span class='match'>to<\/span> <span class='match'>take<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fly<\/span> <span class='match'>made<\/span> <span class='match'>its<\/span> <span class='match'>way<\/span> <span class='match'>along<\/span> <span class='match'>the<\/span> <span class='match'>wall<\/span>.<\/li>\n  <li><span class='match'>Do<\/span> <span class='match'>that<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>wooden<\/span> <span class='match'>stick<\/span>.<\/li>\n  <li><span class='match'>Lire<\/span> <span class='match'>wires<\/span> <span class='match'>should<\/span> <span class='match'>be<\/span> <span class='match'>kept<\/span> <span class='match'>covered<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>large<\/span> <span class='match'>house<\/span> <span class='match'>had<\/span> <span class='match'>hot<\/span> <span class='match'>water<\/span> <span class='match'>taps<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>is<\/span> <span class='match'>hard<\/span> <span class='match'>to<\/span> <span class='match'>erase<\/span> <span class='match'>blue<\/span> <span class='match'>or<\/span> <span class='match'>red<\/span> <span class='match'>ink<\/span>.<\/li>\n  <li><span class='match'>Write<\/span> <span class='match'>at<\/span> <span class='match'>once<\/span> <span class='match'>or<\/span> <span class='match'>you<\/span> <span class='match'>may<\/span> <span class='match'>forget<\/span> <span class='match'>it<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>doorknob<\/span> <span class='match'>was<\/span> <span class='match'>made<\/span> <span class='match'>of<\/span> <span class='match'>bright<\/span> <span class='match'>clean<\/span> <span class='match'>brass<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>wreck<\/span> <span class='match'>occurred<\/span> <span class='match'>by<\/span> <span class='match'>the<\/span> <span class='match'>bank<\/span> <span class='match'>on<\/span> <span class='match'>Main<\/span> <span class='match'>Street<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>pencil<\/span> <span class='match'>with<\/span> <span class='match'>black<\/span> <span class='match'>lead<\/span> <span class='match'>writes<\/span> <span class='match'>best<\/span>.<\/li>\n  <li><span class='match'>Coax<\/span> <span class='match'>a<\/span> <span class='match'>young<\/span> <span class='match'>calf<\/span> <span class='match'>to<\/span> <span class='match'>drink<\/span> <span class='match'>from<\/span> <span class='match'>a<\/span> <span class='match'>bucket<\/span>.<\/li>\n  <li><span class='match'>Schools<\/span> <span class='match'>for<\/span> <span class='match'>ladies<\/span> <span class='match'>teach<\/span> <span class='match'>charm<\/span> <span class='match'>and<\/span> <span class='match'>grace<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>lamp<\/span> <span class='match'>shone<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>steady<\/span> <span class='match'>green<\/span> <span class='match'>flame<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>took<\/span> <span class='match'>the<\/span> <span class='match'>axe<\/span> <span class='match'>and<\/span> <span class='match'>the<\/span> <span class='match'>saw<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>forest<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>ancient<\/span> <span class='match'>coin<\/span> <span class='match'>was<\/span> <span class='match'>quite<\/span> <span class='match'>dull<\/span> <span class='match'>and<\/span> <span class='match'>worn<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>shaky<\/span> <span class='match'>barn<\/span> <span class='match'>fell<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>loud<\/span> <span class='match'>crash<\/span>.<\/li>\n  <li><span class='match'>Jazz<\/span> <span class='match'>and<\/span> <span class='match'>swing<\/span> <span class='match'>fans<\/span> <span class='match'>like<\/span> <span class='match'>fast<\/span> <span class='match'>music<\/span>.<\/li>\n  <li><span class='match'>Rake<\/span> <span class='match'>the<\/span> <span class='match'>rubbish<\/span> <span class='match'>up<\/span> <span class='match'>and<\/span> <span class='match'>then<\/span> <span class='match'>burn<\/span> <span class='match'>it<\/span>.<\/li>\n  <li><span class='match'>Slash<\/span> <span class='match'>the<\/span> <span class='match'>gold<\/span> <span class='match'>cloth<\/span> <span class='match'>into<\/span> <span class='match'>fine<\/span> <span class='match'>ribbons<\/span>.<\/li>\n  <li><span class='match'>Try<\/span> <span class='match'>to<\/span> <span class='match'>have<\/span> <span class='match'>the<\/span> <span class='match'>court<\/span> <span class='match'>decide<\/span> <span class='match'>the<\/span> <span class='match'>case<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>are<\/span> <span class='match'>pushed<\/span> <span class='match'>back<\/span> <span class='match'>each<\/span> <span class='match'>time<\/span> <span class='match'>they<\/span> <span class='match'>attack<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>broke<\/span> <span class='match'>his<\/span> <span class='match'>ties<\/span> <span class='match'>with<\/span> <span class='match'>groups<\/span> <span class='match'>of<\/span> <span class='match'>former<\/span> <span class='match'>friends<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>floated<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>raft<\/span> <span class='match'>to<\/span> <span class='match'>sun<\/span> <span class='match'>their<\/span> <span class='match'>white<\/span> <span class='match'>backs<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>map<\/span> <span class='match'>had<\/span> <span class='match'>an<\/span> <span class='match'>X<\/span> <span class='match'>that<\/span> <span class='match'>meant<\/span> <span class='match'>nothing<\/span>.<\/li>\n  <li><span class='match'>Whitings<\/span> <span class='match'>are<\/span> <span class='match'>small<\/span> <span class='match'>fish<\/span> <span class='match'>caught<\/span> <span class='match'>in<\/span> <span class='match'>nets<\/span>.<\/li>\n  <li><span class='match'>Some<\/span> <span class='match'>ads<\/span> <span class='match'>serve<\/span> <span class='match'>to<\/span> <span class='match'>cheat<\/span> <span class='match'>buyers<\/span>.<\/li>\n  <li><span class='match'>Jerk<\/span> <span class='match'>the<\/span> <span class='match'>rope<\/span> <span class='match'>and<\/span> <span class='match'>the<\/span> <span class='match'>bell<\/span> <span class='match'>rings<\/span> <span class='match'>weakly<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>waxed<\/span> <span class='match'>floor<\/span> <span class='match'>makes<\/span> <span class='match'>us<\/span> <span class='match'>lose<\/span> <span class='match'>balance<\/span>.<\/li>\n  <li><span class='match'>Madam<\/span>, <span class='match'>this<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>best<\/span> <span class='match'>brand<\/span> <span class='match'>of<\/span> <span class='match'>corn<\/span>.<\/li>\n  <li><span class='match'>On<\/span> <span class='match'>the<\/span> <span class='match'>islands<\/span> <span class='match'>the<\/span> <span class='match'>sea<\/span> <span class='match'>breeze<\/span> <span class='match'>is<\/span> <span class='match'>soft<\/span> <span class='match'>and<\/span> <span class='match'>mild<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>play<\/span> <span class='match'>began<\/span> <span class='match'>as<\/span> <span class='match'>soon<\/span> <span class='match'>as<\/span> <span class='match'>we<\/span> <span class='match'>sat<\/span> <span class='match'>down<\/span>.<\/li>\n  <li><span class='match'>This<\/span> <span class='match'>will<\/span> <span class='match'>lead<\/span> <span class='match'>the<\/span> <span class='match'>world<\/span> <span class='match'>to<\/span> <span class='match'>more<\/span> <span class='match'>sound<\/span> <span class='match'>and<\/span> <span class='match'>fury<\/span><\/li>\n  <li><span class='match'>Add<\/span> <span class='match'>salt<\/span> <span class='match'>before<\/span> <span class='match'>you<\/span> <span class='match'>fry<\/span> <span class='match'>the<\/span> <span class='match'>egg<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>rush<\/span> <span class='match'>for<\/span> <span class='match'>funds<\/span> <span class='match'>reached<\/span> <span class='match'>its<\/span> <span class='match'>peak<\/span> <span class='match'>Tuesday<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>birch<\/span> <span class='match'>looked<\/span> <span class='match'>stark<\/span> <span class='match'>white<\/span> <span class='match'>and<\/span> <span class='match'>lonesome<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>box<\/span> <span class='match'>is<\/span> <span class='match'>held<\/span> <span class='match'>by<\/span> <span class='match'>a<\/span> <span class='match'>bright<\/span> <span class='match'>red<\/span> <span class='match'>snapper<\/span>.<\/li>\n  <li><span class='match'>To<\/span> <span class='match'>make<\/span> <span class='match'>pure<\/span> <span class='match'>ice<\/span>, <span class='match'>you<\/span> <span class='match'>freeze<\/span> <span class='match'>water<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>first<\/span> <span class='match'>worm<\/span> <span class='match'>gets<\/span> <span class='match'>snapped<\/span> <span class='match'>early<\/span>.<\/li>\n  <li><span class='match'>Jump<\/span> <span class='match'>the<\/span> <span class='match'>fence<\/span> <span class='match'>and<\/span> <span class='match'>hurry<\/span> <span class='match'>up<\/span> <span class='match'>the<\/span> <span class='match'>bank<\/span>.<\/li>\n  <li><span class='match'>Yell<\/span> <span class='match'>and<\/span> <span class='match'>clap<\/span> <span class='match'>as<\/span> <span class='match'>the<\/span> <span class='match'>curtain<\/span> <span class='match'>slides<\/span> <span class='match'>back<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>are<\/span> <span class='match'>men<\/span> <span class='match'>nho<\/span> <span class='match'>walk<\/span> <span class='match'>the<\/span> <span class='match'>middle<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>road<\/span>.<\/li>\n  <li><span class='match'>Both<\/span> <span class='match'>brothers<\/span> <span class='match'>wear<\/span> <span class='match'>the<\/span> <span class='match'>same<\/span> <span class='match'>size<\/span>.<\/li>\n  <li><span class='match'>In<\/span> <span class='match'>some<\/span> <span class='match'>forin<\/span> <span class='match'>or<\/span> <span class='match'>other<\/span> <span class='match'>we<\/span> <span class='match'>need<\/span> <span class='match'>fun<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>prince<\/span> <span class='match'>ordered<\/span> <span class='match'>his<\/span> <span class='match'>head<\/span> <span class='match'>chopped<\/span> <span class='match'>off<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>houses<\/span> <span class='match'>are<\/span> <span class='match'>built<\/span> <span class='match'>of<\/span> <span class='match'>red<\/span> <span class='match'>clay<\/span> <span class='match'>bricks<\/span>.<\/li>\n  <li><span class='match'>Ducks<\/span> <span class='match'>fly<\/span> <span class='match'>north<\/span> <span class='match'>but<\/span> <span class='match'>lack<\/span> <span class='match'>a<\/span> <span class='match'>compass<\/span>.<\/li>\n  <li><span class='match'>Fruit<\/span> <span class='match'>flavors<\/span> <span class='match'>are<\/span> <span class='match'>used<\/span> <span class='match'>in<\/span> <span class='match'>fizz<\/span> <span class='match'>drinks<\/span>.<\/li>\n  <li><span class='match'>These<\/span> <span class='match'>pills<\/span> <span class='match'>do<\/span> <span class='match'>less<\/span> <span class='match'>good<\/span> <span class='match'>than<\/span> <span class='match'>others<\/span>.<\/li>\n  <li><span class='match'>Canned<\/span> <span class='match'>pears<\/span> <span class='match'>lack<\/span> <span class='match'>full<\/span> <span class='match'>flavor<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>dark<\/span> <span class='match'>pot<\/span> <span class='match'>hung<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>front<\/span> <span class='match'>closet<\/span>.<\/li>\n  <li><span class='match'>Carry<\/span> <span class='match'>the<\/span> <span class='match'>pail<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>wall<\/span> <span class='match'>and<\/span> <span class='match'>spill<\/span> <span class='match'>it<\/span> <span class='match'>there<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>train<\/span> <span class='match'>brought<\/span> <span class='match'>our<\/span> <span class='match'>hero<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>big<\/span> <span class='match'>town<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>are<\/span> <span class='match'>sure<\/span> <span class='match'>that<\/span> <span class='match'>one<\/span> <span class='match'>war<\/span> <span class='match'>is<\/span> <span class='match'>enough<\/span>.<\/li>\n  <li><span class='match'>Gray<\/span> <span class='match'>paint<\/span> <span class='match'>stretched<\/span> <span class='match'>for<\/span> <span class='match'>miles<\/span> <span class='match'>around<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>rude<\/span> <span class='match'>laugh<\/span> <span class='match'>filled<\/span> <span class='match'>the<\/span> <span class='match'>empty<\/span> <span class='match'>room<\/span>.<\/li>\n  <li><span class='match'>High<\/span> <span class='match'>seats<\/span> <span class='match'>are<\/span> <span class='match'>best<\/span> <span class='match'>for<\/span> <span class='match'>football<\/span> <span class='match'>fans<\/span>.<\/li>\n  <li><span class='match'>Tea<\/span> <span class='match'>served<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>brown<\/span> <span class='match'>jug<\/span> <span class='match'>is<\/span> <span class='match'>tasty<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>dash<\/span> <span class='match'>of<\/span> <span class='match'>pepper<\/span> <span class='match'>spoils<\/span> <span class='match'>beef<\/span> <span class='match'>stew<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>zestful<\/span> <span class='match'>food<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>hot<\/span>-<span class='match'>cross<\/span> <span class='match'>bun<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>horse<\/span> <span class='match'>trotted<\/span> <span class='match'>around<\/span> <span class='match'>the<\/span> <span class='match'>field<\/span> <span class='match'>at<\/span> <span class='match'>a<\/span> <span class='match'>brisk<\/span> <span class='match'>pace<\/span>.<\/li>\n  <li><span class='match'>Find<\/span> <span class='match'>the<\/span> <span class='match'>twin<\/span> <span class='match'>who<\/span> <span class='match'>stole<\/span> <span class='match'>the<\/span> <span class='match'>pearl<\/span> <span class='match'>necklace<\/span>.<\/li>\n  <li><span class='match'>Cut<\/span> <span class='match'>the<\/span> <span class='match'>cord<\/span> <span class='match'>that<\/span> <span class='match'>binds<\/span> <span class='match'>the<\/span> <span class='match'>box<\/span> <span class='match'>tightly<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>red<\/span> <span class='match'>tape<\/span> <span class='match'>bound<\/span> <span class='match'>the<\/span> <span class='match'>smuggled<\/span> <span class='match'>food<\/span>.<\/li>\n  <li><span class='match'>Look<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>corner<\/span> <span class='match'>to<\/span> <span class='match'>find<\/span> <span class='match'>the<\/span> <span class='match'>tan<\/span> <span class='match'>shirt<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>cold<\/span> <span class='match'>drizzle<\/span> <span class='match'>will<\/span> <span class='match'>halt<\/span> <span class='match'>the<\/span> <span class='match'>bond<\/span> <span class='match'>drive<\/span>.<\/li>\n  <li><span class='match'>Nine<\/span> <span class='match'>men<\/span> <span class='match'>were<\/span> <span class='match'>hired<\/span> <span class='match'>to<\/span> <span class='match'>dig<\/span> <span class='match'>the<\/span> <span class='match'>ruins<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>junk<\/span> <span class='match'>yard<\/span> <span class='match'>had<\/span> <span class='match'>a<\/span> <span class='match'>mouldy<\/span> <span class='match'>smell<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>flint<\/span> <span class='match'>sputtered<\/span> <span class='match'>and<\/span> <span class='match'>lit<\/span> <span class='match'>a<\/span> <span class='match'>pine<\/span> <span class='match'>torch<\/span>.<\/li>\n  <li><span class='match'>Soak<\/span> <span class='match'>the<\/span> <span class='match'>cloth<\/span> <span class='match'>and<\/span> <span class='match'>drown<\/span> <span class='match'>the<\/span> <span class='match'>sharp<\/span> <span class='match'>odor<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>shelves<\/span> <span class='match'>were<\/span> <span class='match'>bare<\/span> <span class='match'>of<\/span> <span class='match'>both<\/span> <span class='match'>jam<\/span> <span class='match'>or<\/span> <span class='match'>crackers<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>joy<\/span> <span class='match'>to<\/span> <span class='match'>every<\/span> <span class='match'>child<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>swan<\/span> <span class='match'>boat<\/span>.<\/li>\n  <li><span class='match'>All<\/span> <span class='match'>sat<\/span> <span class='match'>frozen<\/span> <span class='match'>and<\/span> <span class='match'>watched<\/span> <span class='match'>the<\/span> <span class='match'>screen<\/span>.<\/li>\n  <li><span class='match'>ii<\/span> <span class='match'>cloud<\/span> <span class='match'>of<\/span> <span class='match'>dust<\/span> <span class='match'>stung<\/span> <span class='match'>his<\/span> <span class='match'>tender<\/span> <span class='match'>eyes<\/span>.<\/li>\n  <li><span class='match'>To<\/span> <span class='match'>reach<\/span> <span class='match'>the<\/span> <span class='match'>end<\/span> <span class='match'>he<\/span> <span class='match'>needs<\/span> <span class='match'>much<\/span> <span class='match'>courage<\/span>.<\/li>\n  <li><span class='match'>Shape<\/span> <span class='match'>the<\/span> <span class='match'>clay<\/span> <span class='match'>gently<\/span> <span class='match'>into<\/span> <span class='match'>block<\/span> <span class='match'>form<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>ridge<\/span> <span class='match'>on<\/span> <span class='match'>a<\/span> <span class='match'>smooth<\/span> <span class='match'>surface<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>bump<\/span> <span class='match'>or<\/span> <span class='match'>flaw<\/span>.<\/li>\n  <li><span class='match'>Hedge<\/span> <span class='match'>apples<\/span> <span class='match'>may<\/span> <span class='match'>stain<\/span> <span class='match'>your<\/span> <span class='match'>hands<\/span> <span class='match'>green<\/span>.<\/li>\n  <li><span class='match'>Quench<\/span> <span class='match'>your<\/span> <span class='match'>thirst<\/span>, <span class='match'>then<\/span> <span class='match'>eat<\/span> <span class='match'>the<\/span> <span class='match'>crackers<\/span>.<\/li>\n  <li><span class='match'>Tight<\/span> <span class='match'>curls<\/span> <span class='match'>get<\/span> <span class='match'>limp<\/span> <span class='match'>on<\/span> <span class='match'>rainy<\/span> <span class='match'>days<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>mute<\/span> <span class='match'>muffled<\/span> <span class='match'>the<\/span> <span class='match'>high<\/span> <span class='match'>tones<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>horn<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>gold<\/span> <span class='match'>ring<\/span> <span class='match'>fits<\/span> <span class='match'>only<\/span> <span class='match'>a<\/span> <span class='match'>pierced<\/span> <span class='match'>ear<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>old<\/span> <span class='match'>pan<\/span> <span class='match'>was<\/span> <span class='match'>covered<\/span> <span class='match'>with<\/span> <span class='match'>hard<\/span> <span class='match'>fudge<\/span>.<\/li>\n  <li><span class='match'>Watch<\/span> <span class='match'>the<\/span> <span class='match'>log<\/span> <span class='match'>float<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>wide<\/span> <span class='match'>river<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>node<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>stalk<\/span> <span class='match'>of<\/span> <span class='match'>wheat<\/span> <span class='match'>grew<\/span> <span class='match'>daily<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>heap<\/span> <span class='match'>of<\/span> <span class='match'>fallen<\/span> <span class='match'>leaves<\/span> <span class='match'>was<\/span> <span class='match'>set<\/span> <span class='match'>on<\/span> <span class='match'>fire<\/span>.<\/li>\n  <li><span class='match'>Write<\/span> <span class='match'>fast<\/span>, <span class='match'>if<\/span> <span class='match'>you<\/span> <span class='match'>want<\/span> <span class='match'>to<\/span> <span class='match'>finish<\/span> <span class='match'>early<\/span>.<\/li>\n  <li><span class='match'>His<\/span> <span class='match'>shirt<\/span> <span class='match'>was<\/span> <span class='match'>clean<\/span> <span class='match'>but<\/span> <span class='match'>one<\/span> <span class='match'>button<\/span> <span class='match'>was<\/span> <span class='match'>gone<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>barrel<\/span> <span class='match'>of<\/span> <span class='match'>beer<\/span> <span class='match'>was<\/span> <span class='match'>a<\/span> <span class='match'>brew<\/span> <span class='match'>of<\/span> <span class='match'>malt<\/span> <span class='match'>and<\/span> <span class='match'>hops<\/span>.<\/li>\n  <li><span class='match'>Tin<\/span> <span class='match'>cans<\/span> <span class='match'>are<\/span> <span class='match'>absent<\/span> <span class='match'>from<\/span> <span class='match'>store<\/span> <span class='match'>shelves<\/span>.<\/li>\n  <li><span class='match'>Slide<\/span> <span class='match'>the<\/span> <span class='match'>box<\/span> <span class='match'>into<\/span> <span class='match'>that<\/span> <span class='match'>empty<\/span> <span class='match'>space<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>plant<\/span> <span class='match'>grew<\/span> <span class='match'>large<\/span> <span class='match'>and<\/span> <span class='match'>green<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>window<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>beam<\/span> <span class='match'>dropped<\/span> <span class='match'>down<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>workmen's<\/span> <span class='match'>head<\/span>.<\/li>\n  <li><span class='match'>Pink<\/span> <span class='match'>clouds<\/span> <span class='match'>floated<\/span> <span class='match'>JTith<\/span> <span class='match'>the<\/span> <span class='match'>breeze<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>danced<\/span> <span class='match'>like<\/span> <span class='match'>a<\/span> <span class='match'>swan<\/span>, <span class='match'>tall<\/span> <span class='match'>and<\/span> <span class='match'>graceful<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>tube<\/span> <span class='match'>was<\/span> <span class='match'>blown<\/span> <span class='match'>and<\/span> <span class='match'>the<\/span> <span class='match'>tire<\/span> <span class='match'>flat<\/span> <span class='match'>and<\/span> <span class='match'>useless<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>is<\/span> <span class='match'>late<\/span> <span class='match'>morning<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>old<\/span> <span class='match'>wall<\/span> <span class='match'>clock<\/span>.<\/li>\n  <li><span class='match'>Let's<\/span> <span class='match'>all<\/span> <span class='match'>join<\/span> <span class='match'>as<\/span> <span class='match'>we<\/span> <span class='match'>sing<\/span> <span class='match'>the<\/span> <span class='match'>last<\/span> <span class='match'>chorus<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>last<\/span> <span class='match'>switch<\/span> <span class='match'>cannot<\/span> <span class='match'>be<\/span> <span class='match'>turned<\/span> <span class='match'>off<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fight<\/span> <span class='match'>will<\/span> <span class='match'>end<\/span> <span class='match'>in<\/span> <span class='match'>just<\/span> <span class='match'>six<\/span> <span class='match'>minutes<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>store<\/span> <span class='match'>walls<\/span> <span class='match'>were<\/span> <span class='match'>lined<\/span> <span class='match'>with<\/span> <span class='match'>colored<\/span> <span class='match'>frocks<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>peace<\/span> <span class='match'>league<\/span> <span class='match'>met<\/span> <span class='match'>to<\/span> <span class='match'>discuss<\/span> <span class='match'>their<\/span> <span class='match'>plans<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>rise<\/span> <span class='match'>to<\/span> <span class='match'>fame<\/span> <span class='match'>of<\/span> <span class='match'>a<\/span> <span class='match'>person<\/span> <span class='match'>takes<\/span> <span class='match'>luck<\/span>.<\/li>\n  <li><span class='match'>Paper<\/span> <span class='match'>is<\/span> <span class='match'>scarce<\/span>, <span class='match'>so<\/span> <span class='match'>write<\/span> <span class='match'>with<\/span> <span class='match'>much<\/span> <span class='match'>care<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>quick<\/span> <span class='match'>fox<\/span> <span class='match'>jumped<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>sleeping<\/span> <span class='match'>cat<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>nozzle<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>fire<\/span> <span class='match'>hose<\/span> <span class='match'>was<\/span> <span class='match'>bright<\/span> <span class='match'>brass<\/span>.<\/li>\n  <li><span class='match'>Screw<\/span> <span class='match'>the<\/span> <span class='match'>round<\/span> <span class='match'>cap<\/span> <span class='match'>on<\/span> <span class='match'>as<\/span> <span class='match'>tight<\/span> <span class='match'>as<\/span> <span class='match'>needed<\/span>.<\/li>\n  <li><span class='match'>Time<\/span> <span class='match'>brings<\/span> <span class='match'>us<\/span> <span class='match'>many<\/span> <span class='match'>changes<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>purple<\/span> <span class='match'>tie<\/span> <span class='match'>was<\/span> <span class='match'>ten<\/span> <span class='match'>years<\/span> <span class='match'>old<\/span>.<\/li>\n  <li><span class='match'>Men<\/span> <span class='match'>think<\/span> <span class='match'>and<\/span> <span class='match'>plan<\/span> <span class='match'>and<\/span> <span class='match'>sometimes<\/span> <span class='match'>act<\/span>.<\/li>\n  <li><span class='match'>Fill<\/span> <span class='match'>the<\/span> <span class='match'>ink<\/span> <span class='match'>jar<\/span> <span class='match'>with<\/span> <span class='match'>sticky<\/span> <span class='match'>glue<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>smoke<\/span> <span class='match'>a<\/span> <span class='match'>big<\/span> <span class='match'>pipe<\/span> <span class='match'>with<\/span> <span class='match'>strong<\/span> <span class='match'>contents<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>need<\/span> <span class='match'>grain<\/span> <span class='match'>to<\/span> <span class='match'>keep<\/span> <span class='match'>our<\/span> <span class='match'>mules<\/span> <span class='match'>healthy<\/span>.<\/li>\n  <li><span class='match'>Pack<\/span> <span class='match'>the<\/span> <span class='match'>records<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>neat<\/span> <span class='match'>thin<\/span> <span class='match'>case<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>crunch<\/span> <span class='match'>of<\/span> <span class='match'>feet<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>snow<\/span> <span class='match'>was<\/span> <span class='match'>the<\/span> <span class='match'>only<\/span> <span class='match'>sound<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>copper<\/span> <span class='match'>bowl<\/span> <span class='match'>shone<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>sun's<\/span> <span class='match'>rays<\/span>.<\/li>\n  <li><span class='match'>Boards<\/span> <span class='match'>will<\/span> <span class='match'>warp<\/span> <span class='match'>unless<\/span> <span class='match'>kept<\/span> <span class='match'>dry<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>plush<\/span> <span class='match'>chair<\/span> <span class='match'>leaned<\/span> <span class='match'>against<\/span> <span class='match'>the<\/span> <span class='match'>wall<\/span>.<\/li>\n  <li><span class='match'>Glass<\/span> <span class='match'>will<\/span> <span class='match'>clink<\/span> <span class='match'>when<\/span> <span class='match'>struck<\/span> <span class='match'>by<\/span> <span class='match'>metal<\/span>.<\/li>\n  <li><span class='match'>Bathe<\/span> <span class='match'>and<\/span> <span class='match'>relax<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>cool<\/span> <span class='match'>green<\/span> <span class='match'>grass<\/span>.<\/li>\n  <li><span class='match'>Nine<\/span> <span class='match'>rows<\/span> <span class='match'>of<\/span> <span class='match'>soldiers<\/span> <span class='match'>stood<\/span> <span class='match'>in<\/span> <span class='match'>line<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>beach<\/span> <span class='match'>is<\/span> <span class='match'>dry<\/span> <span class='match'>and<\/span> <span class='match'>shallow<\/span> <span class='match'>at<\/span> <span class='match'>low<\/span> <span class='match'>tide<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>idea<\/span> <span class='match'>is<\/span> <span class='match'>to<\/span> <span class='match'>sew<\/span> <span class='match'>both<\/span> <span class='match'>edges<\/span> <span class='match'>straight<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>kitten<\/span> <span class='match'>chased<\/span> <span class='match'>the<\/span> <span class='match'>dog<\/span> <span class='match'>down<\/span> <span class='match'>the<\/span> <span class='match'>street<\/span>.<\/li>\n  <li><span class='match'>Pages<\/span> <span class='match'>bound<\/span> <span class='match'>in<\/span> <span class='match'>cloth<\/span> <span class='match'>make<\/span> <span class='match'>a<\/span> <span class='match'>book<\/span>.<\/li>\n  <li><span class='match'>Try<\/span> <span class='match'>to<\/span> <span class='match'>trace<\/span> <span class='match'>the<\/span> <span class='match'>fine<\/span> <span class='match'>lines<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>painting<\/span>.<\/li>\n  <li><span class='match'>Women<\/span> <span class='match'>form<\/span> <span class='match'>less<\/span> <span class='match'>than<\/span> <span class='match'>half<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>group<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>zones<\/span> <span class='match'>merge<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>central<\/span> <span class='match'>part<\/span> <span class='match'>of<\/span> <span class='match'>town<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>gem<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>rough<\/span> <span class='match'>needs<\/span> <span class='match'>work<\/span> <span class='match'>to<\/span> <span class='match'>polish<\/span>.<\/li>\n  <li><span class='match'>Code<\/span> <span class='match'>is<\/span> <span class='match'>used<\/span> <span class='match'>when<\/span> <span class='match'>secrets<\/span> <span class='match'>are<\/span> <span class='match'>sent<\/span>.<\/li>\n  <li><span class='match'>Most<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>new<\/span> <span class='match'>is<\/span> <span class='match'>easy<\/span> <span class='match'>for<\/span> <span class='match'>us<\/span> <span class='match'>to<\/span> <span class='match'>hear<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>used<\/span> <span class='match'>the<\/span> <span class='match'>lathe<\/span> <span class='match'>to<\/span> <span class='match'>make<\/span> <span class='match'>brass<\/span> <span class='match'>objects<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>vane<\/span> <span class='match'>on<\/span> <span class='match'>top<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>pole<\/span> <span class='match'>revolved<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>wind<\/span>.<\/li>\n  <li><span class='match'>Mince<\/span> <span class='match'>pie<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>dish<\/span> <span class='match'>served<\/span> <span class='match'>to<\/span> <span class='match'>children<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>clan<\/span> <span class='match'>gathered<\/span> <span class='match'>on<\/span> <span class='match'>each<\/span> <span class='match'>dull<\/span> <span class='match'>night<\/span>.<\/li>\n  <li><span class='match'>Let<\/span> <span class='match'>it<\/span> <span class='match'>burn<\/span>, <span class='match'>it<\/span> <span class='match'>gives<\/span> <span class='match'>us<\/span> <span class='match'>warmth<\/span> <span class='match'>and<\/span> <span class='match'>comfort<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>castle<\/span> <span class='match'>built<\/span> <span class='match'>from<\/span> <span class='match'>sand<\/span> <span class='match'>fails<\/span> <span class='match'>to<\/span> <span class='match'>endure<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>child's<\/span> <span class='match'>wit<\/span> <span class='match'>saved<\/span> <span class='match'>the<\/span> <span class='match'>day<\/span> <span class='match'>for<\/span> <span class='match'>us<\/span>.<\/li>\n  <li><span class='match'>Tack<\/span> <span class='match'>the<\/span> <span class='match'>strip<\/span> <span class='match'>of<\/span> <span class='match'>carpet<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>worn<\/span> <span class='match'>floor<\/span>.<\/li>\n  <li><span class='match'>Next<\/span> <span class='match'>Tuesday<\/span> <span class='match'>we<\/span> <span class='match'>must<\/span> <span class='match'>vote<\/span>.<\/li>\n  <li><span class='match'>Pour<\/span> <span class='match'>the<\/span> <span class='match'>stew<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>pot<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>plate<\/span>.<\/li>\n  <li><span class='match'>Each<\/span> <span class='match'>penny<\/span> <span class='match'>shone<\/span> <span class='match'>like<\/span> <span class='match'>new<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>man<\/span> <span class='match'>went<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>woods<\/span> <span class='match'>to<\/span> <span class='match'>gather<\/span> <span class='match'>sticks<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>dirt<\/span> <span class='match'>piles<\/span> <span class='match'>were<\/span> <span class='match'>lines<\/span> <span class='match'>along<\/span> <span class='match'>the<\/span> <span class='match'>road<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>logs<\/span> <span class='match'>fell<\/span> <span class='match'>and<\/span> <span class='match'>tumbled<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>clear<\/span> <span class='match'>stream<\/span>.<\/li>\n  <li><span class='match'>Just<\/span> <span class='match'>hoist<\/span> <span class='match'>it<\/span> <span class='match'>up<\/span> <span class='match'>and<\/span> <span class='match'>take<\/span> <span class='match'>it<\/span> <span class='match'>away<\/span>,<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>ripe<\/span> <span class='match'>plum<\/span> <span class='match'>is<\/span> <span class='match'>fit<\/span> <span class='match'>for<\/span> <span class='match'>a<\/span> <span class='match'>king's<\/span> <span class='match'>palate<\/span>.<\/li>\n  <li><span class='match'>Our<\/span> <span class='match'>plans<\/span> <span class='match'>right<\/span> <span class='match'>now<\/span> <span class='match'>are<\/span> <span class='match'>hazy<\/span>.<\/li>\n  <li><span class='match'>Brass<\/span> <span class='match'>rings<\/span> <span class='match'>are<\/span> <span class='match'>sold<\/span> <span class='match'>by<\/span> <span class='match'>these<\/span> <span class='match'>natives<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>takes<\/span> <span class='match'>a<\/span> <span class='match'>good<\/span> <span class='match'>trap<\/span> <span class='match'>to<\/span> <span class='match'>capture<\/span> <span class='match'>a<\/span> <span class='match'>bear<\/span>.<\/li>\n  <li><span class='match'>Feed<\/span> <span class='match'>the<\/span> <span class='match'>white<\/span> <span class='match'>mouse<\/span> <span class='match'>some<\/span> <span class='match'>flower<\/span> <span class='match'>seeds<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>thaw<\/span> <span class='match'>came<\/span> <span class='match'>early<\/span> <span class='match'>and<\/span> <span class='match'>freed<\/span> <span class='match'>the<\/span> <span class='match'>stream<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>took<\/span> <span class='match'>the<\/span> <span class='match'>lead<\/span> <span class='match'>and<\/span> <span class='match'>kept<\/span> <span class='match'>it<\/span> <span class='match'>the<\/span> <span class='match'>whole<\/span> <span class='match'>distance<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>key<\/span> <span class='match'>you<\/span> <span class='match'>designed<\/span> <span class='match'>will<\/span> <span class='match'>fit<\/span> <span class='match'>the<\/span> <span class='match'>lock<\/span>.<\/li>\n  <li><span class='match'>Plead<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>council<\/span> <span class='match'>to<\/span> <span class='match'>free<\/span> <span class='match'>the<\/span> <span class='match'>poor<\/span> <span class='match'>thief<\/span>.<\/li>\n  <li><span class='match'>Better<\/span> <span class='match'>hash<\/span> <span class='match'>is<\/span> <span class='match'>made<\/span> <span class='match'>of<\/span> <span class='match'>rare<\/span> <span class='match'>beef<\/span>.<\/li>\n  <li><span class='match'>This<\/span> <span class='match'>plank<\/span> <span class='match'>was<\/span> <span class='match'>made<\/span> <span class='match'>for<\/span> <span class='match'>walking<\/span> <span class='match'>on<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>lake<\/span> <span class='match'>sparkled<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>red<\/span> <span class='match'>hot<\/span> <span class='match'>sun<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>crawled<\/span> <span class='match'>with<\/span> <span class='match'>care<\/span> <span class='match'>along<\/span> <span class='match'>the<\/span> <span class='match'>ledge<\/span>.<\/li>\n  <li><span class='match'>Tend<\/span> <span class='match'>the<\/span> <span class='match'>sheep<\/span> <span class='match'>while<\/span> <span class='match'>the<\/span> <span class='match'>dog<\/span> <span class='match'>wanders<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>takes<\/span> <span class='match'>a<\/span> <span class='match'>lot<\/span> <span class='match'>of<\/span> <span class='match'>help<\/span> <span class='match'>to<\/span> <span class='match'>finish<\/span> <span class='match'>these<\/span>.<\/li>\n  <li><span class='match'>Mark<\/span> <span class='match'>the<\/span> <span class='match'>spot<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>sign<\/span> <span class='match'>painted<\/span> <span class='match'>red<\/span>.<\/li>\n  <li><span class='match'>Take<\/span> <span class='match'>two<\/span> <span class='match'>shares<\/span> <span class='match'>as<\/span> <span class='match'>a<\/span> <span class='match'>fair<\/span> <span class='match'>profit<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fur<\/span> <span class='match'>of<\/span> <span class='match'>cats<\/span> <span class='match'>goes<\/span> <span class='match'>by<\/span> <span class='match'>many<\/span> <span class='match'>names<\/span>.<\/li>\n  <li><span class='match'>North<\/span> <span class='match'>winds<\/span> <span class='match'>bring<\/span> <span class='match'>colds<\/span> <span class='match'>and<\/span> <span class='match'>fevers<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>asks<\/span> <span class='match'>no<\/span> <span class='match'>person<\/span> <span class='match'>to<\/span> <span class='match'>vouch<\/span> <span class='match'>for<\/span> <span class='match'>him<\/span>.<\/li>\n  <li><span class='match'>Go<\/span> <span class='match'>now<\/span> <span class='match'>and<\/span> <span class='match'>come<\/span> <span class='match'>here<\/span> <span class='match'>later<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>sash<\/span> <span class='match'>of<\/span> <span class='match'>gold<\/span> <span class='match'>silk<\/span> <span class='match'>will<\/span> <span class='match'>trim<\/span> <span class='match'>her<\/span> <span class='match'>dress<\/span>.<\/li>\n  <li><span class='match'>Soap<\/span> <span class='match'>can<\/span> <span class='match'>wash<\/span> <span class='match'>most<\/span> <span class='match'>dirt<\/span> <span class='match'>away<\/span>.<\/li>\n  <li><span class='match'>That<\/span> <span class='match'>move<\/span> <span class='match'>means<\/span> <span class='match'>the<\/span> <span class='match'>game<\/span> <span class='match'>is<\/span> <span class='match'>over<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>wrote<\/span> <span class='match'>down<\/span> <span class='match'>a<\/span> <span class='match'>long<\/span> <span class='match'>list<\/span> <span class='match'>of<\/span> <span class='match'>items<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>siege<\/span> <span class='match'>will<\/span> <span class='match'>crack<\/span> <span class='match'>the<\/span> <span class='match'>strong<\/span> <span class='match'>defense<\/span>.<\/li>\n  <li><span class='match'>Grape<\/span> <span class='match'>juice<\/span> <span class='match'>and<\/span> <span class='match'>water<\/span> <span class='match'>mix<\/span> <span class='match'>well<\/span>.<\/li>\n  <li><span class='match'>Roads<\/span> <span class='match'>are<\/span> <span class='match'>paved<\/span> <span class='match'>with<\/span> <span class='match'>sticky<\/span> <span class='match'>tar<\/span>.<\/li>\n  <li><span class='match'>Fake<\/span> &<span class='match'>ones<\/span> <span class='match'>shine<\/span> <span class='match'>but<\/span> <span class='match'>cost<\/span> <span class='match'>little<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>drip<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>rain<\/span> <span class='match'>made<\/span> <span class='match'>a<\/span> <span class='match'>pleasant<\/span> <span class='match'>sound<\/span>.<\/li>\n  <li><span class='match'>Smoke<\/span> <span class='match'>poured<\/span> <span class='match'>out<\/span> <span class='match'>of<\/span> <span class='match'>every<\/span> <span class='match'>crack<\/span>.<\/li>\n  <li><span class='match'>Serve<\/span> <span class='match'>the<\/span> <span class='match'>hot<\/span> <span class='match'>rum<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>tired<\/span> <span class='match'>heroes<\/span>.<\/li>\n  <li><span class='match'>Much<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>story<\/span> <span class='match'>makes<\/span> <span class='match'>good<\/span> <span class='match'>sense<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sun<\/span> <span class='match'>came<\/span> <span class='match'>up<\/span> <span class='match'>to<\/span> <span class='match'>light<\/span> <span class='match'>the<\/span> <span class='match'>eastern<\/span> <span class='match'>sky<\/span>.<\/li>\n  <li><span class='match'>Heave<\/span> <span class='match'>the<\/span> <span class='match'>line<\/span> <span class='match'>over<\/span> <span class='match'>the<\/span> <span class='match'>port<\/span> <span class='match'>side<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>lathe<\/span> <span class='match'>cuts<\/span> <span class='match'>and<\/span> <span class='match'>trims<\/span> <span class='match'>any<\/span> <span class='match'>wood<\/span>.<\/li>\n  <li><span class='match'>It's<\/span> <span class='match'>a<\/span> <span class='match'>dense<\/span> <span class='match'>crowd<\/span> <span class='match'>in<\/span> <span class='match'>two<\/span> <span class='match'>distinct<\/span> <span class='match'>ways<\/span>.<\/li>\n  <li><span class='match'>His<\/span> <span class='match'>hip<\/span> <span class='match'>struck<\/span> <span class='match'>the<\/span> <span class='match'>knee<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>next<\/span> <span class='match'>player<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>stale<\/span> <span class='match'>smell<\/span> <span class='match'>of<\/span> <span class='match'>old<\/span> <span class='match'>beer<\/span> <span class='match'>lingers<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>desk<\/span> <span class='match'>was<\/span> <span class='match'>firm<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>shaky<\/span> <span class='match'>floor<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>takes<\/span> <span class='match'>heat<\/span> <span class='match'>to<\/span> <span class='match'>bring<\/span> <span class='match'>out<\/span> <span class='match'>the<\/span> <span class='match'>odor<\/span>.<\/li>\n  <li><span class='match'>Beef<\/span> <span class='match'>is<\/span> <span class='match'>scarcer<\/span> <span class='match'>than<\/span> <span class='match'>some<\/span> <span class='match'>lamb<\/span>.<\/li>\n  <li><span class='match'>Raise<\/span> <span class='match'>the<\/span> <span class='match'>sail<\/span> <span class='match'>and<\/span> <span class='match'>steer<\/span> <span class='match'>the<\/span> <span class='match'>ship<\/span> <span class='match'>northward<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>cone<\/span> <span class='match'>costs<\/span> <span class='match'>five<\/span> <span class='match'>cents<\/span> <span class='match'>on<\/span> <span class='match'>Mondays<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>pod<\/span> <span class='match'>is<\/span> <span class='match'>what<\/span> <span class='match'>peas<\/span> <span class='match'>always<\/span> <span class='match'>grow<\/span> <span class='match'>in<\/span>.<\/li>\n  <li><span class='match'>Jerk<\/span> <span class='match'>the<\/span> <span class='match'>dart<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>cork<\/span> <span class='match'>target<\/span>.<\/li>\n  <li><span class='match'>No<\/span> <span class='match'>cement<\/span> <span class='match'>will<\/span> <span class='match'>hold<\/span> <span class='match'>hard<\/span> <span class='match'>wood<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>now<\/span> <span class='match'>have<\/span> <span class='match'>a<\/span> <span class='match'>new<\/span> <span class='match'>base<\/span> <span class='match'>for<\/span> <span class='match'>shipping<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>list<\/span> <span class='match'>of<\/span> <span class='match'>names<\/span> <span class='match'>is<\/span> <span class='match'>carved<\/span> <span class='match'>around<\/span> <span class='match'>the<\/span> <span class='match'>base<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sheep<\/span> <span class='match'>were<\/span> <span class='match'>led<\/span> <span class='match'>home<\/span> <span class='match'>by<\/span> <span class='match'>a<\/span> <span class='match'>dog<\/span>.<\/li>\n  <li><span class='match'>Three<\/span> <span class='match'>for<\/span> <span class='match'>a<\/span> <span class='match'>dime<\/span>, <span class='match'>the<\/span> <span class='match'>young<\/span> <span class='match'>peddler<\/span> <span class='match'>cried<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sense<\/span> <span class='match'>of<\/span> <span class='match'>smell<\/span> <span class='match'>is<\/span> <span class='match'>better<\/span> <span class='match'>than<\/span> <span class='match'>that<\/span> <span class='match'>of<\/span> <span class='match'>touch<\/span>.<\/li>\n  <li><span class='match'>No<\/span> <span class='match'>hardship<\/span> <span class='match'>seemed<\/span> <span class='match'>to<\/span> <span class='match'>keep<\/span> <span class='match'>him<\/span> <span class='match'>sad<\/span>.<\/li>\n  <li><span class='match'>Grace<\/span> <span class='match'>makes<\/span> <span class='match'>up<\/span> <span class='match'>for<\/span> <span class='match'>lack<\/span> <span class='match'>of<\/span> <span class='match'>beauty<\/span>.<\/li>\n  <li><span class='match'>Nudge<\/span> <span class='match'>gently<\/span> <span class='match'>but<\/span> <span class='match'>wake<\/span> <span class='match'>her<\/span> <span class='match'>now<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>news<\/span> <span class='match'>struck<\/span> <span class='match'>doubt<\/span> <span class='match'>into<\/span> <span class='match'>restless<\/span> <span class='match'>minds<\/span>.<\/li>\n  <li><span class='match'>Once<\/span> <span class='match'>we<\/span> <span class='match'>stood<\/span> <span class='match'>beside<\/span> <span class='match'>the<\/span> <span class='match'>shore<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>chink<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>wall<\/span> <span class='match'>allowed<\/span> <span class='match'>a<\/span> <span class='match'>draft<\/span> <span class='match'>to<\/span> <span class='match'>blow<\/span>.<\/li>\n  <li><span class='match'>Fasten<\/span> <span class='match'>two<\/span> <span class='match'>pins<\/span> <span class='match'>on<\/span> <span class='match'>each<\/span> <span class='match'>side<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>cold<\/span> <span class='match'>dip<\/span> <span class='match'>restores<\/span> <span class='match'>health<\/span> <span class='match'>and<\/span> <span class='match'>zest<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>takes<\/span> <span class='match'>the<\/span> <span class='match'>oath<\/span> <span class='match'>of<\/span> <span class='match'>office<\/span> <span class='match'>each<\/span> <span class='match'>March<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sand<\/span> <span class='match'>drifts<\/span> <span class='match'>over<\/span> <span class='match'>the<\/span> <span class='match'>sill<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>old<\/span> <span class='match'>house<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>point<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>steel<\/span> <span class='match'>pen<\/span> <span class='match'>was<\/span> <span class='match'>bent<\/span> <span class='match'>and<\/span> <span class='match'>twisted<\/span>.<\/li>\n  <li><span class='match'>There<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>lag<\/span> <span class='match'>between<\/span> <span class='match'>thought<\/span> <span class='match'>and<\/span> <span class='match'>act<\/span>.<\/li>\n  <li><span class='match'>Seed<\/span> <span class='match'>is<\/span> <span class='match'>needed<\/span> <span class='match'>to<\/span> <span class='match'>plant<\/span> <span class='match'>the<\/span> <span class='match'>spring<\/span> <span class='match'>corn<\/span>.<\/li>\n  <li><span class='match'>Draw<\/span> <span class='match'>the<\/span> <span class='match'>chart<\/span> <span class='match'>with<\/span> <span class='match'>heavy<\/span> <span class='match'>black<\/span> <span class='match'>lines<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>boy<\/span> <span class='match'>owed<\/span> <span class='match'>his<\/span> <span class='match'>pal<\/span> <span class='match'>thirty<\/span> <span class='match'>cents<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>chap<\/span> <span class='match'>slipped<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>crowd<\/span> <span class='match'>and<\/span> <span class='match'>was<\/span> <span class='match'>lost<\/span>.<\/li>\n  <li><span class='match'>Hats<\/span> <span class='match'>are<\/span> <span class='match'>worn<\/span> <span class='match'>to<\/span> <span class='match'>tea<\/span> <span class='match'>and<\/span> <span class='match'>not<\/span> <span class='match'>to<\/span> <span class='match'>dinner<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>ramp<\/span> <span class='match'>led<\/span> <span class='match'>up<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>wide<\/span> <span class='match'>highway<\/span>.<\/li>\n  <li><span class='match'>Beat<\/span> <span class='match'>the<\/span> <span class='match'>dust<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>rug<\/span> <span class='match'>onto<\/span> <span class='match'>the<\/span> <span class='match'>lawn<\/span>.<\/li>\n  <li><span class='match'>Say<\/span> <span class='match'>it<\/span> <span class='match'>slow<\/span>!<span class='match'>y<\/span> <span class='match'>but<\/span> <span class='match'>make<\/span> <span class='match'>it<\/span> <span class='match'>ring<\/span> <span class='match'>clear<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>straw<\/span> <span class='match'>nest<\/span> <span class='match'>housed<\/span> <span class='match'>five<\/span> <span class='match'>robins<\/span>.<\/li>\n  <li><span class='match'>Screen<\/span> <span class='match'>the<\/span> <span class='match'>porch<\/span> <span class='match'>with<\/span> <span class='match'>woven<\/span> <span class='match'>straw<\/span> <span class='match'>mats<\/span>.<\/li>\n  <li><span class='match'>This<\/span> <span class='match'>horse<\/span> <span class='match'>will<\/span> <span class='match'>nose<\/span> <span class='match'>his<\/span> <span class='match'>way<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>finish<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>dry<\/span> <span class='match'>wax<\/span> <span class='match'>protects<\/span> <span class='match'>the<\/span> <span class='match'>deep<\/span> <span class='match'>scratch<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>picked<\/span> <span class='match'>up<\/span> <span class='match'>the<\/span> <span class='match'>dice<\/span> <span class='match'>for<\/span> <span class='match'>a<\/span> <span class='match'>second<\/span> <span class='match'>roll<\/span>.<\/li>\n  <li><span class='match'>These<\/span> <span class='match'>coins<\/span> <span class='match'>will<\/span> <span class='match'>be<\/span> <span class='match'>needed<\/span> <span class='match'>to<\/span> <span class='match'>pay<\/span> <span class='match'>his<\/span> <span class='match'>debt<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>nag<\/span> <span class='match'>pulled<\/span> <span class='match'>the<\/span> <span class='match'>frail<\/span> <span class='match'>cart<\/span> <span class='match'>along<\/span>.<\/li>\n  <li><span class='match'>Twist<\/span> <span class='match'>the<\/span> <span class='match'>valve<\/span> <span class='match'>and<\/span> <span class='match'>release<\/span> <span class='match'>hot<\/span> <span class='match'>steam<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>vamp<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>shoe<\/span> <span class='match'>had<\/span> <span class='match'>a<\/span> <span class='match'>gold<\/span> <span class='match'>buckle<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>smell<\/span> <span class='match'>of<\/span> <span class='match'>burned<\/span> <span class='match'>rags<\/span> <span class='match'>itches<\/span> <span class='match'>my<\/span> <span class='match'>nose<\/span>.<\/li>\n  <li><span class='match'>Xew<\/span> <span class='match'>pants<\/span> <span class='match'>lack<\/span> <span class='match'>cuffs<\/span> <span class='match'>and<\/span> <span class='match'>pockets<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>marsh<\/span> <span class='match'>will<\/span> <span class='match'>freeze<\/span> <span class='match'>when<\/span> <span class='match'>cold<\/span> <span class='match'>enough<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>slice<\/span> <span class='match'>the<\/span> <span class='match'>sausage<\/span> <span class='match'>thin<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>knife<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bloom<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>rose<\/span> <span class='match'>lasts<\/span> <span class='match'>a<\/span> <span class='match'>few<\/span> <span class='match'>days<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>gray<\/span> <span class='match'>mare<\/span> <span class='match'>walked<\/span> <span class='match'>before<\/span> <span class='match'>the<\/span> <span class='match'>colt<\/span>.<\/li>\n  <li><span class='match'>Breakfast<\/span> <span class='match'>buns<\/span> <span class='match'>are<\/span> <span class='match'>fine<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>hot<\/span> <span class='match'>drink<\/span>.<\/li>\n  <li><span class='match'>Bottles<\/span> <span class='match'>hold<\/span> <span class='match'>four<\/span> <span class='match'>kinds<\/span> <span class='match'>of<\/span> <span class='match'>rum<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>man<\/span> <span class='match'>wore<\/span> <span class='match'>a<\/span> <span class='match'>feather<\/span> <span class='match'>in<\/span> <span class='match'>his<\/span> <span class='match'>felt<\/span> <span class='match'>hat<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>wheeled<\/span> <span class='match'>the<\/span> <span class='match'>bike<\/span> <span class='match'>past<\/span>. <span class='match'>the<\/span> <span class='match'>winding<\/span> <span class='match'>road<\/span>.<\/li>\n  <li><span class='match'>Drop<\/span> <span class='match'>the<\/span> <span class='match'>ashes<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>worn<\/span> <span class='match'>old<\/span> <span class='match'>rug<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>desk<\/span> <span class='match'>and<\/span> <span class='match'>both<\/span> <span class='match'>chairs<\/span> <span class='match'>were<\/span> <span class='match'>painted<\/span> <span class='match'>tan<\/span>.<\/li>\n  <li><span class='match'>Throw<\/span> <span class='match'>out<\/span> <span class='match'>the<\/span> <span class='match'>used<\/span> <span class='match'>paper<\/span> <span class='match'>cup<\/span> <span class='match'>and<\/span> <span class='match'>plate<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>clean<\/span> <span class='match'>neck<\/span> <span class='match'>means<\/span> <span class='match'>a<\/span> <span class='match'>neat<\/span> <span class='match'>collar<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>couch<\/span> <span class='match'>cover<\/span> <span class='match'>and<\/span> <span class='match'>hall<\/span> <span class='match'>drapes<\/span> <span class='match'>were<\/span> <span class='match'>blue<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>stems<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>tall<\/span> <span class='match'>glasses<\/span> <span class='match'>cracked<\/span> <span class='match'>and<\/span> <span class='match'>broke<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>wall<\/span> <span class='match'>phone<\/span> <span class='match'>rang<\/span> <span class='match'>loud<\/span> <span class='match'>and<\/span> <span class='match'>often<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>clothes<\/span> <span class='match'>dried<\/span> <span class='match'>on<\/span> <span class='match'>a<\/span> <span class='match'>thin<\/span> <span class='match'>wooden<\/span> <span class='match'>rack<\/span>.<\/li>\n  <li><span class='match'>Turn<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>lantern<\/span> <span class='match'>which<\/span> <span class='match'>gives<\/span> <span class='match'>us<\/span> <span class='match'>light<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>cleat<\/span> <span class='match'>sank<\/span> <span class='match'>deeply<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>soft<\/span> <span class='match'>turf<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bills<\/span> <span class='match'>were<\/span> <span class='match'>mailed<\/span> <span class='match'>promptly<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>tenth<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>month<\/span>.<\/li>\n  <li><span class='match'>To<\/span> <span class='match'>have<\/span> <span class='match'>is<\/span> <span class='match'>better<\/span> <span class='match'>than<\/span> <span class='match'>to<\/span> <span class='match'>wait<\/span> <span class='match'>and<\/span> <span class='match'>hope<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>price<\/span> <span class='match'>is<\/span> <span class='match'>fair<\/span> <span class='match'>for<\/span> <span class='match'>a<\/span> <span class='match'>good<\/span> <span class='match'>antique<\/span> <span class='match'>clock<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>music<\/span> <span class='match'>played<\/span> <span class='match'>on<\/span> <span class='match'>while<\/span> <span class='match'>they<\/span> <span class='match'>talked<\/span>.<\/li>\n  <li><span class='match'>Dispense<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>vest<\/span> <span class='match'>on<\/span> <span class='match'>a<\/span> <span class='match'>day<\/span> <span class='match'>like<\/span> <span class='match'>this<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bunch<\/span> <span class='match'>of<\/span> <span class='match'>grapes<\/span> <span class='match'>was<\/span> <span class='match'>pressed<\/span> <span class='match'>into<\/span> <span class='match'>wine<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>sent<\/span> <span class='match'>the<\/span> <span class='match'>figs<\/span>, <span class='match'>but<\/span> <span class='match'>kept<\/span> <span class='match'>the<\/span> <span class='match'>ripe<\/span> <span class='match'>cherries<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hinge<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>door<\/span> <span class='match'>creaked<\/span> <span class='match'>with<\/span> <span class='match'>old<\/span> <span class='match'>age<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>screen<\/span> <span class='match'>before<\/span> <span class='match'>the<\/span> <span class='match'>fire<\/span> <span class='match'>kept<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>sparks<\/span>.<\/li>\n  <li><span class='match'>Fly<\/span> <span class='match'>by<\/span> <span class='match'>night<\/span>, <span class='match'>and<\/span> <span class='match'>you<\/span> <span class='match'>waste<\/span> <span class='match'>little<\/span> <span class='match'>time<\/span>.<\/li>\n  <li><span class='match'>Thick<\/span> <span class='match'>glasses<\/span> <span class='match'>helped<\/span> <span class='match'>him<\/span> <span class='match'>read<\/span> <span class='match'>the<\/span> <span class='match'>print<\/span>.<\/li>\n  <li><span class='match'>Birth<\/span> <span class='match'>and<\/span> <span class='match'>death<\/span> <span class='match'>mark<\/span> <span class='match'>the<\/span> <span class='match'>limits<\/span> <span class='match'>of<\/span> <span class='match'>life<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>chair<\/span> <span class='match'>looked<\/span> <span class='match'>strong<\/span> <span class='match'>but<\/span> <span class='match'>had<\/span> <span class='match'>no<\/span> <span class='match'>bottom<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>kite<\/span> <span class='match'>flew<\/span> <span class='match'>wildly<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>high<\/span> <span class='match'>wind<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>fur<\/span> <span class='match'>muff<\/span> <span class='match'>is<\/span> <span class='match'>stylish<\/span> <span class='match'>once<\/span> <span class='match'>more<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>tin<\/span> <span class='match'>box<\/span> <span class='match'>held<\/span> <span class='match'>priceless<\/span> <span class='match'>stones<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>need<\/span> <span class='match'>an<\/span> <span class='match'>end<\/span> <span class='match'>of<\/span> <span class='match'>all<\/span> <span class='match'>such<\/span> <span class='match'>matter<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>case<\/span> <span class='match'>was<\/span> <span class='match'>puzzling<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>old<\/span> <span class='match'>and<\/span> <span class='match'>wise<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bright<\/span> <span class='match'>lanterns<\/span> <span class='match'>were<\/span> <span class='match'>gay<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>dark<\/span> <span class='match'>lawn<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>don't<\/span> <span class='match'>get<\/span> <span class='match'>much<\/span> <span class='match'>money<\/span> <span class='match'>but<\/span> <span class='match'>we<\/span> <span class='match'>have<\/span> <span class='match'>fun<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>youth<\/span> <span class='match'>drove<\/span> <span class='match'>with<\/span> <span class='match'>zest<\/span>, <span class='match'>but<\/span> <span class='match'>little<\/span> <span class='match'>skill<\/span>.<\/li>\n  <li><span class='match'>Five<\/span> <span class='match'>years<\/span> <span class='match'>he<\/span> <span class='match'>lived<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>shaggy<\/span> <span class='match'>dog<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>fence<\/span> <span class='match'>cuts<\/span> <span class='match'>through<\/span> <span class='match'>the<\/span> <span class='match'>corner<\/span> <span class='match'>lot<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>way<\/span> <span class='match'>to<\/span> <span class='match'>save<\/span> <span class='match'>money<\/span> <span class='match'>is<\/span> <span class='match'>not<\/span> <span class='match'>to<\/span> <span class='match'>spend<\/span> <span class='match'>much<\/span>.<\/li>\n  <li><span class='match'>Shut<\/span> <span class='match'>the<\/span> <span class='match'>hatch<\/span> <span class='match'>before<\/span> <span class='match'>the<\/span> <span class='match'>waves<\/span> <span class='match'>push<\/span> <span class='match'>it<\/span> <span class='match'>in<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>odor<\/span> <span class='match'>of<\/span> <span class='match'>spring<\/span> <span class='match'>makes<\/span> <span class='match'>young<\/span> <span class='match'>hearts<\/span> <span class='match'>jump<\/span>.<\/li>\n  <li><span class='match'>Crack<\/span> <span class='match'>the<\/span> <span class='match'>walnut<\/span> <span class='match'>with<\/span> <span class='match'>your<\/span> <span class='match'>sharp<\/span> <span class='match'>side<\/span> <span class='match'>teeth<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>offered<\/span> <span class='match'>proof<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>form<\/span> <span class='match'>of<\/span> <span class='match'>a<\/span> <span class='match'>lsrge<\/span> <span class='match'>chart<\/span>.<\/li>\n  <li><span class='match'>Send<\/span> <span class='match'>the<\/span> <span class='match'>stuff<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>thick<\/span> <span class='match'>paper<\/span> <span class='match'>bag<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>quart<\/span> <span class='match'>of<\/span> <span class='match'>milk<\/span> <span class='match'>is<\/span> <span class='match'>water<\/span> <span class='match'>for<\/span> <span class='match'>the<\/span> <span class='match'>most<\/span> <span class='match'>part<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>told<\/span> <span class='match'>wild<\/span> <span class='match'>tales<\/span> <span class='match'>to<\/span> <span class='match'>frighten<\/span> <span class='match'>him<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>three<\/span> <span class='match'>story<\/span> <span class='match'>house<\/span> <span class='match'>was<\/span> <span class='match'>built<\/span> <span class='match'>of<\/span> <span class='match'>stone<\/span>.<\/li>\n  <li><span class='match'>In<\/span> <span class='match'>the<\/span> <span class='match'>rear<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>ground<\/span> <span class='match'>floor<\/span> <span class='match'>was<\/span> <span class='match'>a<\/span> <span class='match'>large<\/span> <span class='match'>passage<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>man<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>blue<\/span> <span class='match'>sweater<\/span> <span class='match'>sat<\/span> <span class='match'>at<\/span> <span class='match'>the<\/span> <span class='match'>desk<\/span>.<\/li>\n  <li><span class='match'>Oats<\/span> <span class='match'>are<\/span> <span class='match'>a<\/span> <span class='match'>food<\/span> <span class='match'>eaten<\/span> <span class='match'>by<\/span> <span class='match'>horse<\/span> <span class='match'>and<\/span> <span class='match'>man<\/span>.<\/li>\n  <li><span class='match'>Their<\/span> <span class='match'>eyelids<\/span> <span class='match'>droop<\/span> <span class='match'>for<\/span> <span class='match'>want<\/span>. <span class='match'>of<\/span> <span class='match'>sleep<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sip<\/span> <span class='match'>of<\/span> <span class='match'>tea<\/span> <span class='match'>revives<\/span> <span class='match'>his<\/span> <span class='match'>tired<\/span> <span class='match'>friend<\/span>.<\/li>\n  <li><span class='match'>There<\/span> <span class='match'>are<\/span> <span class='match'>many<\/span> <span class='match'>ways<\/span> <span class='match'>to<\/span> <span class='match'>do<\/span> <span class='match'>these<\/span> <span class='match'>things<\/span>.<\/li>\n  <li><span class='match'>Tuck<\/span> <span class='match'>the<\/span> <span class='match'>sheet<\/span> <span class='match'>under<\/span> <span class='match'>the<\/span> <span class='match'>edge<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>mat<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>force<\/span> <span class='match'>equal<\/span> <span class='match'>to<\/span> <span class='match'>that<\/span> <span class='match'>would<\/span> <span class='match'>move<\/span> <span class='match'>the<\/span> <span class='match'>earth<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>like<\/span> <span class='match'>to<\/span> <span class='match'>see<\/span> <span class='match'>clear<\/span> <span class='match'>weather<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>work<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>tailor<\/span> <span class='match'>is<\/span> <span class='match'>seen<\/span> <span class='match'>on<\/span> <span class='match'>each<\/span> <span class='match'>side<\/span>.<\/li>\n  <li><span class='match'>Take<\/span> <span class='match'>a<\/span> <span class='match'>chance<\/span> <span class='match'>and<\/span> <span class='match'>win<\/span> <span class='match'>a<\/span> <span class='match'>china<\/span> <span class='match'>doll<\/span>.<\/li>\n  <li><span class='match'>Shake<\/span> <span class='match'>the<\/span> <span class='match'>dust<\/span> <span class='match'>from<\/span> <span class='match'>your<\/span> <span class='match'>shoes<\/span>, <span class='match'>stranger<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>was<\/span> <span class='match'>kind<\/span> <span class='match'>to<\/span> <span class='match'>sick<\/span> <span class='match'>old<\/span> <span class='match'>people<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>dusty<\/span> <span class='match'>bench<\/span> <span class='match'>stood<\/span> <span class='match'>by<\/span> <span class='match'>the<\/span> <span class='match'>stone<\/span> <span class='match'>wall<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>square<\/span> <span class='match'>wooden<\/span> <span class='match'>crate<\/span> <span class='match'>was<\/span> <span class='match'>packed<\/span> <span class='match'>to<\/span> <span class='match'>be<\/span> <span class='match'>shipped<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>dress<\/span> <span class='match'>to<\/span> <span class='match'>suit<\/span> <span class='match'>the<\/span> <span class='match'>weather<\/span> <span class='match'>of<\/span> <span class='match'>most<\/span> <span class='match'>days<\/span>.<\/li>\n  <li><span class='match'>Smile<\/span> <span class='match'>when<\/span> <span class='match'>you<\/span> <span class='match'>say<\/span> <span class='match'>nasty<\/span> <span class='match'>words<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>bowl<\/span> <span class='match'>of<\/span> <span class='match'>rice<\/span> <span class='match'>is<\/span> <span class='match'>free<\/span> <span class='match'>with<\/span> <span class='match'>chicken<\/span> <span class='match'>stew<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>water<\/span> <span class='match'>in<\/span> <span class='match'>this<\/span> <span class='match'>well<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>source<\/span> <span class='match'>of<\/span> <span class='match'>good<\/span> <span class='match'>health<\/span>.<\/li>\n  <li><span class='match'>Take<\/span> <span class='match'>shelter<\/span> <span class='match'>in<\/span> <span class='match'>this<\/span> <span class='match'>tent<\/span>, <span class='match'>but<\/span> <span class='match'>keep<\/span> <span class='match'>still<\/span>.<\/li>\n  <li><span class='match'>That<\/span> <span class='match'>guy<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>writer<\/span> <span class='match'>of<\/span> <span class='match'>a<\/span> <span class='match'>few<\/span> <span class='match'>banned<\/span> <span class='match'>books<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>little<\/span> <span class='match'>tales<\/span> <span class='match'>they<\/span> <span class='match'>tell<\/span> <span class='match'>are<\/span> <span class='match'>false<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>door<\/span> <span class='match'>was<\/span> <span class='match'>barred<\/span>, <span class='match'>locked<\/span>, <span class='match'>and<\/span> <span class='match'>bolted<\/span> <span class='match'>as<\/span> <span class='match'>well<\/span>.<\/li>\n  <li><span class='match'>Ripe<\/span> <span class='match'>pears<\/span> <span class='match'>are<\/span> <span class='match'>fit<\/span> <span class='match'>for<\/span> <span class='match'>a<\/span> <span class='match'>queen's<\/span> <span class='match'>table<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>big<\/span> <span class='match'>wet<\/span> <span class='match'>stain<\/span> <span class='match'>was<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>round<\/span> <span class='match'>carpet<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>kite<\/span> <span class='match'>dipped<\/span> <span class='match'>and<\/span> <span class='match'>swayed<\/span>, <span class='match'>but<\/span> <span class='match'>stayed<\/span> <span class='match'>aloft<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pleasant<\/span> <span class='match'>hours<\/span> <span class='match'>fly<\/span> <span class='match'>by<\/span> <span class='match'>much<\/span> <span class='match'>too<\/span> <span class='match'>soon<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>room<\/span> <span class='match'>was<\/span> <span class='match'>crowded<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>wild<\/span> <span class='match'>mob<\/span>.<\/li>\n  <li><span class='match'>This<\/span> <span class='match'>strong<\/span> <span class='match'>arm<\/span> <span class='match'>shall<\/span> <span class='match'>shield<\/span> <span class='match'>your<\/span> <span class='match'>honor<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>blushed<\/span> <span class='match'>when<\/span> <span class='match'>he<\/span> <span class='match'>gave<\/span> <span class='match'>her<\/span> <span class='match'>a<\/span> <span class='match'>white<\/span> <span class='match'>orchid<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>beetle<\/span> <span class='match'>droned<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>hot<\/span> <span class='match'>June<\/span> <span class='match'>sun<\/span>.<\/li>\n  <li><span class='match'>Press<\/span> <span class='match'>the<\/span> <span class='match'>pedal<\/span> <span class='match'>with<\/span> <span class='match'>your<\/span> <span class='match'>left<\/span> <span class='match'>foot<\/span>.<\/li>\n  <li><span class='match'>Neat<\/span> <span class='match'>plans<\/span> <span class='match'>fail<\/span> <span class='match'>without<\/span> <span class='match'>luck<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>black<\/span> <span class='match'>trunk<\/span> <span class='match'>fell<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>landing<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bank<\/span> <span class='match'>pressed<\/span> <span class='match'>for<\/span> <span class='match'>payment<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>debt<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>theft<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>pearl<\/span> <span class='match'>pin<\/span> <span class='match'>was<\/span> <span class='match'>kept<\/span> <span class='match'>secret<\/span>.<\/li>\n  <li><span class='match'>Shake<\/span> <span class='match'>hands<\/span> <span class='match'>with<\/span> <span class='match'>this<\/span> <span class='match'>friendly<\/span> <span class='match'>child<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>vast<\/span> <span class='match'>space<\/span> <span class='match'>stretched<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>far<\/span> <span class='match'>distance<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>rich<\/span> <span class='match'>farm<\/span> <span class='match'>is<\/span> <span class='match'>rare<\/span> <span class='match'>in<\/span> <span class='match'>this<\/span> <span class='match'>sandy<\/span> <span class='match'>waste<\/span>.<\/li>\n  <li><span class='match'>His<\/span> <span class='match'>wide<\/span> <span class='match'>grin<\/span> <span class='match'>earned<\/span> <span class='match'>many<\/span> <span class='match'>friends<\/span>.<\/li>\n  <li><span class='match'>Flax<\/span> <span class='match'>makes<\/span> <span class='match'>a<\/span> <span class='match'>fine<\/span> <span class='match'>brand<\/span> <span class='match'>of<\/span> <span class='match'>paper<\/span>.<\/li>\n  <li><span class='match'>Hurdle<\/span> <span class='match'>the<\/span> <span class='match'>pit<\/span> <span class='match'>with<\/span> <span class='match'>the<\/span> <span class='match'>aid<\/span> <span class='match'>of<\/span> <span class='match'>a<\/span> <span class='match'>long<\/span> <span class='match'>pole<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>strong<\/span> <span class='match'>bid<\/span> <span class='match'>may<\/span> <span class='match'>scare<\/span> <span class='match'>your<\/span> <span class='match'>partner<\/span> <span class='match'>stiff<\/span>.<\/li>\n  <li><span class='match'>Even<\/span> <span class='match'>a<\/span> <span class='match'>just<\/span> <span class='match'>cause<\/span> <span class='match'>needs<\/span> <span class='match'>power<\/span> <span class='match'>to<\/span> <span class='match'>win<\/span>.<\/li>\n  <li><span class='match'>Peep<\/span> <span class='match'>under<\/span> <span class='match'>the<\/span> <span class='match'>tent<\/span> <span class='match'>and<\/span> <span class='match'>see<\/span> <span class='match'>the<\/span> <span class='match'>clowns<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>leaf<\/span> <span class='match'>drifts<\/span> <span class='match'>along<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>slow<\/span> <span class='match'>spin<\/span>.<\/li>\n  <li><span class='match'>Cheap<\/span> <span class='match'>clothes<\/span> <span class='match'>are<\/span> <span class='match'>flashy<\/span> <span class='match'>but<\/span> <span class='match'>don<\/span>??????<span class='match'>t<\/span> <span class='match'>last<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>thing<\/span> <span class='match'>of<\/span> <span class='match'>small<\/span> <span class='match'>note<\/span> <span class='match'>can<\/span> <span class='match'>cause<\/span> <span class='match'>despair<\/span>.<\/li>\n  <li><span class='match'>Flood<\/span> <span class='match'>the<\/span> <span class='match'>mails<\/span> <span class='match'>with<\/span> <span class='match'>requests<\/span> <span class='match'>for<\/span> <span class='match'>this<\/span> <span class='match'>book<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>thick<\/span> <span class='match'>coat<\/span> <span class='match'>of<\/span> <span class='match'>black<\/span> <span class='match'>paint<\/span> <span class='match'>covered<\/span> <span class='match'>all<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pencil<\/span> <span class='match'>was<\/span> <span class='match'>cut<\/span> <span class='match'>to<\/span> <span class='match'>be<\/span> <span class='match'>sharp<\/span> <span class='match'>at<\/span> <span class='match'>both<\/span> <span class='match'>ends<\/span>.<\/li>\n  <li><span class='match'>Those<\/span> <span class='match'>last<\/span> <span class='match'>words<\/span> <span class='match'>were<\/span> <span class='match'>a<\/span> <span class='match'>strong<\/span> <span class='match'>statement<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>wrote<\/span> <span class='match'>his<\/span> <span class='match'>name<\/span> <span class='match'>boldly<\/span> <span class='match'>at<\/span> <span class='match'>the<\/span> <span class='match'>top<\/span> <span class='match'>of<\/span> <span class='match'>tile<\/span> <span class='match'>sheet<\/span>.<\/li>\n  <li><span class='match'>Dill<\/span> <span class='match'>pickles<\/span> <span class='match'>are<\/span> <span class='match'>sour<\/span> <span class='match'>but<\/span> <span class='match'>taste<\/span> <span class='match'>fine<\/span>.<\/li>\n  <li><span class='match'>Down<\/span> <span class='match'>that<\/span> <span class='match'>road<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>way<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>grain<\/span> <span class='match'>farmer<\/span>.<\/li>\n  <li><span class='match'>Either<\/span> <span class='match'>mud<\/span> <span class='match'>or<\/span> <span class='match'>dust<\/span> <span class='match'>are<\/span> <span class='match'>found<\/span> <span class='match'>at<\/span> <span class='match'>all<\/span> <span class='match'>times<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>best<\/span> <span class='match'>method<\/span> <span class='match'>is<\/span> <span class='match'>to<\/span> <span class='match'>fix<\/span> <span class='match'>it<\/span> <span class='match'>in<\/span> <span class='match'>place<\/span> <span class='match'>with<\/span> <span class='match'>clips<\/span>.<\/li>\n  <li><span class='match'>If<\/span> <span class='match'>you<\/span> <span class='match'>mumble<\/span> <span class='match'>your<\/span> <span class='match'>speech<\/span> <span class='match'>will<\/span> <span class='match'>be<\/span> <span class='match'>lost<\/span>.<\/li>\n  <li><span class='match'>At<\/span> <span class='match'>night<\/span> <span class='match'>the<\/span> <span class='match'>alarm<\/span> <span class='match'>roused<\/span> <span class='match'>him<\/span> <span class='match'>from<\/span> <span class='match'>a<\/span> <span class='match'>deep<\/span> <span class='match'>sleep<\/span>.<\/li>\n  <li><span class='match'>Read<\/span> <span class='match'>just<\/span> <span class='match'>what<\/span> <span class='match'>the<\/span> <span class='match'>meter<\/span> <span class='match'>says<\/span>.<\/li>\n  <li><span class='match'>Fill<\/span> <span class='match'>your<\/span> <span class='match'>pack<\/span> <span class='match'>with<\/span> <span class='match'>bright<\/span> <span class='match'>trinkets<\/span> <span class='match'>for<\/span> <span class='match'>the<\/span> <span class='match'>poor<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>small<\/span> <span class='match'>red<\/span> <span class='match'>neon<\/span> <span class='match'>lamp<\/span> <span class='match'>went<\/span> <span class='match'>out<\/span>.<\/li>\n  <li><span class='match'>Clams<\/span> <span class='match'>are<\/span> <span class='match'>small<\/span>, <span class='match'>round<\/span>, <span class='match'>soft<\/span>, <span class='match'>and<\/span> <span class='match'>tasty<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>fan<\/span> <span class='match'>whirled<\/span> <span class='match'>its<\/span> <span class='match'>round<\/span> <span class='match'>blades<\/span> <span class='match'>softly<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>line<\/span> <span class='match'>where<\/span> <span class='match'>the<\/span> <span class='match'>edges<\/span> <span class='match'>join<\/span> <span class='match'>was<\/span> <span class='match'>clean<\/span>.<\/li>\n  <li><span class='match'>Breathe<\/span> <span class='match'>deep<\/span> <span class='match'>and<\/span> <span class='match'>smell<\/span> <span class='match'>the<\/span> <span class='match'>piny<\/span> <span class='match'>air<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>matters<\/span> <span class='match'>not<\/span> <span class='match'>if<\/span> <span class='match'>he<\/span> <span class='match'>reads<\/span> <span class='match'>these<\/span> <span class='match'>words<\/span> <span class='match'>or<\/span> <span class='match'>those<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>brown<\/span> <span class='match'>leather<\/span> <span class='match'>bag<\/span> <span class='match'>hung<\/span> <span class='match'>from<\/span> <span class='match'>its<\/span> <span class='match'>strap<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>toad<\/span> <span class='match'>and<\/span> <span class='match'>a<\/span> <span class='match'>frog<\/span> <span class='match'>are<\/span> <span class='match'>hard<\/span> <span class='match'>to<\/span> <span class='match'>tell<\/span> <span class='match'>apart<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>white<\/span> <span class='match'>silk<\/span> <span class='match'>jacket<\/span> <span class='match'>goes<\/span> <span class='match'>with<\/span> <span class='match'>any<\/span> <span class='match'>shoes<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>break<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>dam<\/span> <span class='match'>almost<\/span> <span class='match'>caused<\/span> <span class='match'>a<\/span> <span class='match'>flood<\/span>.<\/li>\n  <li><span class='match'>Paint<\/span> <span class='match'>the<\/span> <span class='match'>sockets<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>wall<\/span> <span class='match'>dull<\/span> <span class='match'>green<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>child<\/span> <span class='match'>crawled<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>dense<\/span> <span class='match'>grass<\/span>.<\/li>\n  <li><span class='match'>Bribes<\/span> <span class='match'>fail<\/span> <span class='match'>where<\/span> <span class='match'>honest<\/span> <span class='match'>men<\/span> <span class='match'>work<\/span>.<\/li>\n  <li><span class='match'>Trample<\/span> <span class='match'>the<\/span> <span class='match'>spark<\/span>, <span class='match'>else<\/span> <span class='match'>the<\/span> <span class='match'>flames<\/span> <span class='match'>will<\/span> <span class='match'>spread<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hilt<\/span>. <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>sword<\/span> <span class='match'>was<\/span> <span class='match'>carved<\/span> <span class='match'>with<\/span> <span class='match'>fine<\/span> <span class='match'>designs<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>round<\/span> <span class='match'>hole<\/span> <span class='match'>was<\/span> <span class='match'>drilled<\/span> <span class='match'>through<\/span> <span class='match'>the<\/span> <span class='match'>thin<\/span> <span class='match'>board<\/span>.<\/li>\n  <li><span class='match'>Footprints<\/span> <span class='match'>showed<\/span> <span class='match'>the<\/span> <span class='match'>path<\/span> <span class='match'>he<\/span> <span class='match'>took<\/span> <span class='match'>up<\/span> <span class='match'>the<\/span> <span class='match'>beach<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>was<\/span> <span class='match'>waiting<\/span> <span class='match'>at<\/span> <span class='match'>my<\/span> <span class='match'>front<\/span> <span class='match'>lawn<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>vent<\/span> <span class='match'>near<\/span> <span class='match'>the<\/span> <span class='match'>edge<\/span> <span class='match'>brought<\/span> <span class='match'>in<\/span> <span class='match'>fresh<\/span> <span class='match'>air<\/span>.<\/li>\n  <li><span class='match'>Prod<\/span> <span class='match'>the<\/span> <span class='match'>old<\/span> <span class='match'>mule<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>crooked<\/span> <span class='match'>stick<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>band<\/span> <span class='match'>of<\/span> <span class='match'>steel<\/span> <span class='match'>three<\/span> <span class='match'>inches<\/span> <span class='match'>wide<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pipe<\/span> <span class='match'>ran<\/span> <span class='match'>almost<\/span> <span class='match'>the<\/span> <span class='match'>length<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>ditch<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>was<\/span> <span class='match'>hidden<\/span> <span class='match'>from<\/span> <span class='match'>sight<\/span> <span class='match'>by<\/span> <span class='match'>a<\/span> <span class='match'>mass<\/span> <span class='match'>of<\/span> <span class='match'>leaves<\/span> <span class='match'>and<\/span> <span class='match'>shrubs<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>weight<\/span>. <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>package<\/span> <span class='match'>was<\/span> <span class='match'>seen<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>high<\/span> <span class='match'>scale<\/span>.<\/li>\n  <li><span class='match'>Wake<\/span> <span class='match'>and<\/span> <span class='match'>rise<\/span>, <span class='match'>and<\/span> <span class='match'>step<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>green<\/span> <span class='match'>outdoors<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>green<\/span> <span class='match'>light<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>brown<\/span> <span class='match'>box<\/span> <span class='match'>flickered<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>brass<\/span> <span class='match'>tube<\/span> <span class='match'>circled<\/span> <span class='match'>the<\/span> <span class='match'>high<\/span> <span class='match'>wall<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>lobes<\/span> <span class='match'>of<\/span> <span class='match'>her<\/span> <span class='match'>ears<\/span> <span class='match'>were<\/span> <span class='match'>pierced<\/span> <span class='match'>to<\/span> <span class='match'>hold<\/span> <span class='match'>rings<\/span>.<\/li>\n  <li><span class='match'>Hold<\/span> <span class='match'>the<\/span> <span class='match'>hammer<\/span> <span class='match'>near<\/span> <span class='match'>the<\/span> <span class='match'>end<\/span> <span class='match'>to<\/span> <span class='match'>drive<\/span> <span class='match'>the<\/span> <span class='match'>nail<\/span>.<\/li>\n  <li><span class='match'>Next<\/span> <span class='match'>Sunday<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>twelfth<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>month<\/span>.<\/li>\n  <li><span class='match'>Every<\/span> <span class='match'>word<\/span> <span class='match'>and<\/span> <span class='match'>phrase<\/span> <span class='match'>he<\/span> <span class='match'>speaks<\/span> <span class='match'>is<\/span> <span class='match'>true<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>put<\/span> <span class='match'>his<\/span> <span class='match'>last<\/span> <span class='match'>cartridge<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>gun<\/span> <span class='match'>and<\/span> <span class='match'>fired<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>took<\/span> <span class='match'>their<\/span> <span class='match'>kids<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>public<\/span> <span class='match'>school<\/span>.<\/li>\n  <li><span class='match'>Drive<\/span> <span class='match'>the<\/span> <span class='match'>screw<\/span> <span class='match'>straight<\/span> <span class='match'>into<\/span> <span class='match'>the<\/span> <span class='match'>wood<\/span>.<\/li>\n  <li><span class='match'>Keep<\/span> <span class='match'>the<\/span> <span class='match'>hatch<\/span> <span class='match'>tight<\/span> <span class='match'>and<\/span> <span class='match'>the<\/span> <span class='match'>watch<\/span> <span class='match'>constant<\/span>.<\/li>\n  <li><span class='match'>Sever<\/span> <span class='match'>the<\/span> <span class='match'>twine<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>quick<\/span> <span class='match'>snip<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>knife<\/span>.<\/li>\n  <li><span class='match'>Paper<\/span> <span class='match'>will<\/span> <span class='match'>dry<\/span> <span class='match'>out<\/span> <span class='match'>when<\/span> <span class='match'>wet<\/span>.<\/li>\n  <li><span class='match'>Slide<\/span> <span class='match'>the<\/span> <span class='match'>catch<\/span> <span class='match'>back<\/span> <span class='match'>and<\/span> <span class='match'>open<\/span> <span class='match'>the<\/span> <span class='match'>desk<\/span>.<\/li>\n  <li><span class='match'>Help<\/span> <span class='match'>the<\/span> <span class='match'>weak<\/span> <span class='match'>to<\/span> <span class='match'>preserve<\/span> <span class='match'>their<\/span> <span class='match'>strength<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>sullen<\/span> <span class='match'>smile<\/span> <span class='match'>gets<\/span> <span class='match'>few<\/span> <span class='match'>friends<\/span>.<\/li>\n  <li><span class='match'>Stop<\/span> <span class='match'>whistling<\/span> <span class='match'>and<\/span> <span class='match'>watch<\/span> <span class='match'>the<\/span> <span class='match'>boys<\/span> <span class='match'>march<\/span>.<\/li>\n  <li><span class='match'>Jerk<\/span> <span class='match'>the<\/span> <span class='match'>cord<\/span>, <span class='match'>and<\/span> <span class='match'>out<\/span> <span class='match'>tumbles<\/span> <span class='match'>the<\/span> <span class='match'>gold<\/span>.<\/li>\n  <li><span class='match'>Slidc<\/span> <span class='match'>the<\/span> <span class='match'>tray<\/span> <span class='match'>across<\/span> <span class='match'>the<\/span> <span class='match'>glass<\/span> <span class='match'>top<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>cloud<\/span> <span class='match'>moved<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>stately<\/span> <span class='match'>way<\/span> <span class='match'>and<\/span> <span class='match'>was<\/span> <span class='match'>gone<\/span>.<\/li>\n  <li><span class='match'>Light<\/span> <span class='match'>maple<\/span> <span class='match'>makes<\/span> <span class='match'>for<\/span> <span class='match'>a<\/span> <span class='match'>swell<\/span> <span class='match'>room<\/span>.<\/li>\n  <li><span class='match'>Set<\/span> <span class='match'>the<\/span> <span class='match'>piece<\/span> <span class='match'>here<\/span> <span class='match'>and<\/span> <span class='match'>say<\/span> <span class='match'>nothing<\/span>.<\/li>\n  <li><span class='match'>Dull<\/span> <span class='match'>stories<\/span> <span class='match'>make<\/span> <span class='match'>her<\/span> <span class='match'>laugh<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>stiff<\/span> <span class='match'>cord<\/span> <span class='match'>will<\/span> <span class='match'>do<\/span> <span class='match'>to<\/span> <span class='match'>fasten<\/span> <span class='match'>your<\/span> <span class='match'>shoe<\/span>.<\/li>\n  <li><span class='match'>Get<\/span> <span class='match'>the<\/span> <span class='match'>trust<\/span> <span class='match'>fund<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>bank<\/span> <span class='match'>early<\/span>.<\/li>\n  <li><span class='match'>Choose<\/span> <span class='match'>between<\/span> <span class='match'>the<\/span> <span class='match'>high<\/span> <span class='match'>road<\/span> <span class='match'>and<\/span> <span class='match'>the<\/span> <span class='match'>low<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>plea<\/span> <span class='match'>for<\/span> <span class='match'>funds<\/span> <span class='match'>seems<\/span> <span class='match'>to<\/span> <span class='match'>come<\/span> <span class='match'>again<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>lent<\/span> <span class='match'>his<\/span> <span class='match'>coat<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>tall<\/span> <span class='match'>gaunt<\/span> <span class='match'>stranger<\/span>.<\/li>\n  <li><span class='match'>There<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>strong<\/span> <span class='match'>chance<\/span> <span class='match'>it<\/span> <span class='match'>will<\/span> <span class='match'>happen<\/span> <span class='match'>once<\/span> <span class='match'>more<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>duke<\/span> <span class='match'>left<\/span> <span class='match'>the<\/span> <span class='match'>park<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>silver<\/span> <span class='match'>coach<\/span>.<\/li>\n  <li><span class='match'>Greet<\/span> <span class='match'>the<\/span> <span class='match'>new<\/span> <span class='match'>guests<\/span> <span class='match'>and<\/span> <span class='match'>leave<\/span> <span class='match'>quickly<\/span>.<\/li>\n  <li><span class='match'>When<\/span> <span class='match'>the<\/span> <span class='match'>frost<\/span> <span class='match'>has<\/span> <span class='match'>come<\/span> <span class='match'>it<\/span> <span class='match'>is<\/span> <span class='match'>time<\/span> <span class='match'>for<\/span> <span class='match'>turkey<\/span>.<\/li>\n  <li><span class='match'>Sweet<\/span> <span class='match'>words<\/span> <span class='match'>work<\/span> <span class='match'>better<\/span> <span class='match'>than<\/span> <span class='match'>fierce<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>thin<\/span> <span class='match'>stripe<\/span> <span class='match'>runs<\/span> <span class='match'>down<\/span> <span class='match'>the<\/span> <span class='match'>middle<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>six<\/span> <span class='match'>comes<\/span> <span class='match'>up<\/span> <span class='match'>more<\/span> <span class='match'>often<\/span> <span class='match'>than<\/span> <span class='match'>a<\/span> <span class='match'>ten<\/span>.<\/li>\n  <li><span class='match'>Lush<\/span> <span class='match'>fern<\/span> <span class='match'>grow<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>lofty<\/span> <span class='match'>rocks<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>ram<\/span> <span class='match'>scared<\/span> <span class='match'>the<\/span> <span class='match'>school<\/span> <span class='match'>children<\/span> <span class='match'>off<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>team<\/span> <span class='match'>with<\/span> <span class='match'>the<\/span> <span class='match'>best<\/span> <span class='match'>timing<\/span> <span class='match'>looks<\/span> <span class='match'>good<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>farmer<\/span> <span class='match'>swapped<\/span> <span class='match'>his<\/span> <span class='match'>horse<\/span> <span class='match'>for<\/span> <span class='match'>a<\/span> <span class='match'>brown<\/span> <span class='match'>ox<\/span>.<\/li>\n  <li><span class='match'>Sit<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>perch<\/span> <span class='match'>and<\/span> <span class='match'>tell<\/span> <span class='match'>the<\/span> <span class='match'>others<\/span> <span class='match'>what<\/span> <span class='match'>to<\/span> <span class='match'>do<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>steep<\/span> <span class='match'>trail<\/span> <span class='match'>is<\/span> <span class='match'>painful<\/span> <span class='match'>for<\/span> <span class='match'>our<\/span> <span class='match'>feet<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>early<\/span> <span class='match'>phase<\/span> <span class='match'>of<\/span> <span class='match'>life<\/span> <span class='match'>moves<\/span> <span class='match'>fast<\/span>.<\/li>\n  <li><span class='match'>Green<\/span> <span class='match'>moss<\/span> <span class='match'>grows<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>northern<\/span> <span class='match'>side<\/span>.<\/li>\n  <li><span class='match'>Tea<\/span> <span class='match'>in<\/span> <span class='match'>thin<\/span> <span class='match'>china<\/span> <span class='match'>has<\/span> <span class='match'>a<\/span> <span class='match'>sweet<\/span> <span class='match'>taste<\/span>.<\/li>\n  <li><span class='match'>Pitch<\/span> <span class='match'>the<\/span> <span class='match'>straw<\/span> <span class='match'>through<\/span> <span class='match'>the<\/span> <span class='match'>door<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>stable<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>latch<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>beck<\/span> <span class='match'>gate<\/span> <span class='match'>needed<\/span> <span class='match'>a<\/span> <span class='match'>nail<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>goose<\/span> <span class='match'>was<\/span> <span class='match'>brought<\/span> <span class='match'>straight<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>old<\/span> <span class='match'>market<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sink<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>thing<\/span> <span class='match'>in<\/span> <span class='match'>which<\/span> <span class='match'>we<\/span> <span class='match'>pile<\/span> <span class='match'>dishes<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>whiff<\/span> <span class='match'>of<\/span> <span class='match'>it<\/span> <span class='match'>will<\/span> <span class='match'>cure<\/span> <span class='match'>the<\/span> <span class='match'>most<\/span> <span class='match'>stubborn<\/span> <span class='match'>cold<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>facts<\/span> <span class='match'>don<\/span><span class='match'>t<\/span> <span class='match'>always<\/span> <span class='match'>show<\/span> <span class='match'>who<\/span> <span class='match'>is<\/span> <span class='match'>right<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>flaps<\/span> <span class='match'>her<\/span> <span class='match'>cape<\/span> <span class='match'>as<\/span> <span class='match'>she<\/span> <span class='match'>parades<\/span> <span class='match'>the<\/span> <span class='match'>street<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>loss<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>cruiser<\/span> <span class='match'>was<\/span> <span class='match'>a<\/span> <span class='match'>blow<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>fleet<\/span>.<\/li>\n  <li><span class='match'>Loop<\/span> <span class='match'>the<\/span> <span class='match'>braid<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>left<\/span> <span class='match'>and<\/span> <span class='match'>then<\/span> <span class='match'>over<\/span>.<\/li>\n  <li><span class='match'>Plead<\/span> <span class='match'>with<\/span> <span class='match'>the<\/span> <span class='match'>lawyer<\/span> <span class='match'>to<\/span> <span class='match'>drop<\/span> <span class='match'>the<\/span> <span class='match'>lost<\/span> <span class='match'>cause<\/span>.<\/li>\n  <li><span class='match'>Calves<\/span> <span class='match'>thrive<\/span> <span class='match'>on<\/span> <span class='match'>tender<\/span> <span class='match'>spring<\/span> <span class='match'>grass<\/span>.<\/li>\n  <li><span class='match'>Post<\/span> <span class='match'>no<\/span> <span class='match'>bills<\/span> <span class='match'>on<\/span> <span class='match'>this<\/span> <span class='match'>office<\/span> <span class='match'>wall<\/span>.<\/li>\n  <li><span class='match'>Tear<\/span> <span class='match'>a<\/span> <span class='match'>thin<\/span> <span class='match'>sheet<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>yellow<\/span> <span class='match'>pad<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>cruise<\/span> <span class='match'>in<\/span> <span class='match'>warm<\/span> <span class='match'>waters<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>sleek<\/span> <span class='match'>yacht<\/span> <span class='match'>is<\/span> <span class='match'>fun<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>streak<\/span> <span class='match'>of<\/span> <span class='match'>color<\/span> <span class='match'>ran<\/span> <span class='match'>down<\/span> <span class='match'>the<\/span> <span class='match'>left<\/span> <span class='match'>edge<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>was<\/span> <span class='match'>done<\/span> <span class='match'>before<\/span> <span class='match'>the<\/span> <span class='match'>boy<\/span> <span class='match'>could<\/span> <span class='match'>see<\/span> <span class='match'>it<\/span>.<\/li>\n  <li><span class='match'>Crouch<\/span> <span class='match'>before<\/span> <span class='match'>you<\/span> <span class='match'>jump<\/span> <span class='match'>or<\/span> <span class='match'>miss<\/span> <span class='match'>the<\/span> <span class='match'>mark<\/span>.<\/li>\n  <li><span class='match'>Pack<\/span> <span class='match'>the<\/span> <span class='match'>kits<\/span> <span class='match'>and<\/span> <span class='match'>don<\/span><span class='match'>t<\/span> <span class='match'>forget<\/span> <span class='match'>the<\/span> <span class='match'>salt<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>square<\/span> <span class='match'>peg<\/span> <span class='match'>will<\/span> <span class='match'>settle<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>round<\/span> <span class='match'>hole<\/span>.<\/li>\n  <li><span class='match'>Fine<\/span> <span class='match'>soap<\/span> <span class='match'>saves<\/span> <span class='match'>tender<\/span> <span class='match'>skin<\/span>.<\/li>\n  <li><span class='match'>Poached<\/span> <span class='match'>eggs<\/span> <span class='match'>and<\/span> <span class='match'>tea<\/span> <span class='match'>must<\/span> <span class='match'>suffice<\/span>.<\/li>\n  <li><span class='match'>Bad<\/span> <span class='match'>nerves<\/span> <span class='match'>are<\/span> <span class='match'>jangled<\/span> <span class='match'>by<\/span> <span class='match'>a<\/span> <span class='match'>door<\/span> <span class='match'>slam<\/span>.<\/li>\n  <li><span class='match'>Ship<\/span> <span class='match'>maps<\/span> <span class='match'>are<\/span> <span class='match'>different<\/span> <span class='match'>from<\/span> <span class='match'>those<\/span> <span class='match'>for<\/span> <span class='match'>planes<\/span>.<\/li>\n  <li><span class='match'>Dimes<\/span> <span class='match'>showered<\/span> <span class='match'>down<\/span> <span class='match'>from<\/span> <span class='match'>all<\/span> <span class='match'>sides<\/span>.<\/li>\n  <li><span class='match'>They<\/span> <span class='match'>sang<\/span> <span class='match'>the<\/span> <span class='match'>same<\/span> <span class='match'>tunes<\/span> <span class='match'>at<\/span> <span class='match'>each<\/span> <span class='match'>party<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>sky<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>west<\/span> <span class='match'>is<\/span> <span class='match'>tinged<\/span> <span class='match'>with<\/span> <span class='match'>orange<\/span> <span class='match'>red<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pods<\/span> <span class='match'>of<\/span> <span class='match'>peas<\/span> <span class='match'>ferment<\/span> <span class='match'>in<\/span> <span class='match'>bare<\/span> <span class='match'>fields<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>horse<\/span> <span class='match'>balked<\/span> <span class='match'>and<\/span> <span class='match'>threw<\/span> <span class='match'>the<\/span> <span class='match'>tall<\/span> <span class='match'>rider<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hitch<\/span> <span class='match'>between<\/span> <span class='match'>the<\/span> <span class='match'>horse<\/span> <span class='match'>and<\/span> <span class='match'>cart<\/span> <span class='match'>broke<\/span>.<\/li>\n  <li><span class='match'>Pile<\/span> <span class='match'>the<\/span> <span class='match'>coal<\/span> <span class='match'>high<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>shed<\/span> <span class='match'>corner<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>gold<\/span> <span class='match'>vase<\/span> <span class='match'>is<\/span> <span class='match'>both<\/span> <span class='match'>rare<\/span> <span class='match'>and<\/span> <span class='match'>costly<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>knife<\/span> <span class='match'>was<\/span> <span class='match'>hung<\/span> <span class='match'>inside<\/span> <span class='match'>its<\/span> <span class='match'>bright<\/span> <span class='match'>sheath<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>rarest<\/span> <span class='match'>spice<\/span> <span class='match'>comes<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>far<\/span> <span class='match'>East<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>roof<\/span> <span class='match'>should<\/span> <span class='match'>be<\/span> <span class='match'>tilted<\/span> <span class='match'>at<\/span> <span class='match'>a<\/span> <span class='match'>sharp<\/span> <span class='match'>slant<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>smatter<\/span> <span class='match'>of<\/span> <span class='match'>French<\/span> <span class='match'>is<\/span> <span class='match'>worse<\/span> <span class='match'>than<\/span> <span class='match'>none<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>mule<\/span> <span class='match'>trod<\/span> <span class='match'>the<\/span> <span class='match'>treadmill<\/span> <span class='match'>day<\/span> <span class='match'>and<\/span> <span class='match'>night<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>aim<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>contest<\/span> <span class='match'>is<\/span> <span class='match'>to<\/span> <span class='match'>raise<\/span> <span class='match'>a<\/span> <span class='match'>great<\/span> <span class='match'>fund<\/span>.<\/li>\n  <li><span class='match'>To<\/span> <span class='match'>send<\/span> <span class='match'>it<\/span>. <span class='match'>now<\/span> <span class='match'>in<\/span> <span class='match'>large<\/span> <span class='match'>amounts<\/span> <span class='match'>is<\/span> <span class='match'>bad<\/span>.<\/li>\n  <li><span class='match'>There<\/span> <span class='match'>is<\/span> <span class='match'>a<\/span> <span class='match'>fine<\/span> <span class='match'>hard<\/span> <span class='match'>tang<\/span> <span class='match'>in<\/span> <span class='match'>salty<\/span> <span class='match'>air<\/span>.<\/li>\n  <li><span class='match'>Cod<\/span> <span class='match'>is<\/span> <span class='match'>the<\/span> <span class='match'>main<\/span> <span class='match'>business<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>north<\/span> <span class='match'>shore<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>slab<\/span> <span class='match'>was<\/span> <span class='match'>hewn<\/span> <span class='match'>from<\/span> <span class='match'>heavy<\/span> <span class='match'>blocks<\/span> <span class='match'>of<\/span> <span class='match'>slat<\/span><span class='match'>e<\/span>.<\/li>\n  <li><span class='match'>Dunk<\/span> <span class='match'>the<\/span> <span class='match'>stale<\/span> <span class='match'>biscuits<\/span> <span class='match'>into<\/span> <span class='match'>strong<\/span> <span class='match'>drink<\/span>.<\/li>\n  <li><span class='match'>Hang<\/span> <span class='match'>tinsel<\/span> <span class='match'>from<\/span> <span class='match'>both<\/span> <span class='match'>branches<\/span>.<\/li>\n  <li><span class='match'>Cap<\/span> <span class='match'>the<\/span> <span class='match'>jar<\/span> <span class='match'>with<\/span> <span class='match'>a<\/span> <span class='match'>tight<\/span> <span class='match'>brass<\/span> <span class='match'>cover<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>poor<\/span> <span class='match'>boy<\/span> <span class='match'>missed<\/span> <span class='match'>the<\/span> <span class='match'>boat<\/span> <span class='match'>again<\/span>.<\/li>\n  <li><span class='match'>Be<\/span> <span class='match'>sure<\/span> <span class='match'>to<\/span> <span class='match'>set<\/span> <span class='match'>the<\/span> <span class='match'>lamp<\/span> <span class='match'>firmly<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>hole<\/span>.<\/li>\n  <li><span class='match'>Pick<\/span> <span class='match'>a<\/span> <span class='match'>card<\/span> <span class='match'>and<\/span> <span class='match'>slip<\/span> <span class='match'>it<\/span>. <span class='match'>under<\/span> <span class='match'>the<\/span> <span class='match'>pack<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>round<\/span> <span class='match'>mat<\/span> <span class='match'>will<\/span> <span class='match'>cover<\/span> <span class='match'>the<\/span> <span class='match'>dull<\/span> <span class='match'>spot<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>first<\/span> <span class='match'>part<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>plan<\/span> <span class='match'>needs<\/span> <span class='match'>changing<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>good<\/span> <span class='match'>book<\/span> <span class='match'>informs<\/span> <span class='match'>of<\/span> <span class='match'>what<\/span> <span class='match'>we<\/span> <span class='match'>ought<\/span> <span class='match'>to<\/span> <span class='match'>know<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>mail<\/span> <span class='match'>comes<\/span> <span class='match'>in<\/span> <span class='match'>three<\/span> <span class='match'>batches<\/span> <span class='match'>per<\/span> <span class='match'>day<\/span>.<\/li>\n  <li><span class='match'>You<\/span> <span class='match'>cannot<\/span> <span class='match'>brew<\/span> <span class='match'>tea<\/span> <span class='match'>in<\/span> <span class='match'>a<\/span> <span class='match'>cold<\/span> <span class='match'>pot<\/span>.<\/li>\n  <li><span class='match'>Dots<\/span> <span class='match'>of<\/span> <span class='match'>light<\/span> <span class='match'>betrayed<\/span> <span class='match'>the<\/span> <span class='match'>black<\/span> <span class='match'>cat<\/span>.<\/li>\n  <li><span class='match'>Put<\/span> <span class='match'>the<\/span> <span class='match'>chart<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>mantel<\/span> <span class='match'>and<\/span> <span class='match'>tack<\/span> <span class='match'>it<\/span> <span class='match'>down<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>night<\/span> <span class='match'>shift<\/span> <span class='match'>men<\/span> <span class='match'>rate<\/span> <span class='match'>extra<\/span> <span class='match'>pay<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>red<\/span> <span class='match'>paper<\/span> <span class='match'>brightened<\/span> <span class='match'>the<\/span> <span class='match'>dim<\/span> <span class='match'>stage<\/span>.<\/li>\n  <li><span class='match'>See<\/span> <span class='match'>the<\/span> <span class='match'>player<\/span> <span class='match'>scoot<\/span> <span class='match'>to<\/span> <span class='match'>third<\/span> <span class='match'>base<\/span>.<\/li>\n  <li><span class='match'>Slide<\/span> <span class='match'>the<\/span> <span class='match'>bill<\/span> <span class='match'>between<\/span> <span class='match'>the<\/span> <span class='match'>two<\/span> <span class='match'>leaves<\/span>.<\/li>\n  <li><span class='match'>Many<\/span> <span class='match'>hands<\/span> <span class='match'>help<\/span> <span class='match'>get<\/span> <span class='match'>the<\/span> <span class='match'>job<\/span> <span class='match'>done<\/span>.<\/li>\n  <li><span class='match'>We<\/span> <span class='match'>don't<\/span> <span class='match'>like<\/span> <span class='match'>to<\/span> <span class='match'>admit<\/span> <span class='match'>our<\/span> <span class='match'>small<\/span> <span class='match'>faults<\/span>.<\/li>\n  <li><span class='match'>No<\/span> <span class='match'>doubt<\/span> <span class='match'>about<\/span> <span class='match'>the<\/span> <span class='match'>way<\/span> <span class='match'>the<\/span> <span class='match'>wind<\/span> <span class='match'>blows<\/span>.<\/li>\n  <li><span class='match'>Dig<\/span> <span class='match'>deep<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>earth<\/span> <span class='match'>for<\/span> <span class='match'>pirate's<\/span> <span class='match'>gold<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>steady<\/span> <span class='match'>drip<\/span> <span class='match'>is<\/span> <span class='match'>worse<\/span> <span class='match'>than<\/span> <span class='match'>a<\/span> <span class='match'>drenching<\/span> <span class='match'>rain<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>flat<\/span> <span class='match'>pack<\/span> <span class='match'>takes<\/span> <span class='match'>less<\/span> <span class='match'>luggage<\/span> <span class='match'>space<\/span>.<\/li>\n  <li><span class='match'>Green<\/span> <span class='match'>ice<\/span> <span class='match'>frosted<\/span> <span class='match'>the<\/span> <span class='match'>punch<\/span> <span class='match'>bowl<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>stuffed<\/span> <span class='match'>chair<\/span> <span class='match'>slipped<\/span> <span class='match'>from<\/span> <span class='match'>the<\/span> <span class='match'>moving<\/span> <span class='match'>van<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>stitch<\/span> <span class='match'>will<\/span> <span class='match'>serve<\/span> <span class='match'>but<\/span> <span class='match'>needs<\/span> <span class='match'>to<\/span> <span class='match'>be<\/span> <span class='match'>shortened<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>thin<\/span> <span class='match'>book<\/span> <span class='match'>fits<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>side<\/span> <span class='match'>pocket<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>gloss<\/span> <span class='match'>on<\/span> <span class='match'>top<\/span> <span class='match'>made<\/span> <span class='match'>it<\/span> <span class='match'>unfit<\/span> <span class='match'>to<\/span> <span class='match'>read<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>hail<\/span> <span class='match'>pattered<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>burnt<\/span> <span class='match'>brown<\/span> <span class='match'>grass<\/span>.<\/li>\n  <li><span class='match'>Seven<\/span> <span class='match'>seals<\/span> <span class='match'>were<\/span> <span class='match'>stamped<\/span> <span class='match'>on<\/span> <span class='match'>great<\/span> <span class='match'>sheets<\/span>.<\/li>\n  <li><span class='match'>Our<\/span> <span class='match'>troops<\/span> <span class='match'>are<\/span> <span class='match'>set<\/span> <span class='match'>to<\/span> <span class='match'>strike<\/span> <span class='match'>heavy<\/span> <span class='match'>blows<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>store<\/span> <span class='match'>was<\/span> <span class='match'>jammed<\/span> <span class='match'>before<\/span> <span class='match'>the<\/span> <span class='match'>sale<\/span> <span class='match'>could<\/span> <span class='match'>start<\/span>.<\/li>\n  <li><span class='match'>It<\/span> <span class='match'>was<\/span> <span class='match'>a<\/span> <span class='match'>bad<\/span> <span class='match'>error<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>part<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>new<\/span> <span class='match'>judge<\/span>.<\/li>\n  <li><span class='match'>One<\/span> <span class='match'>step<\/span> <span class='match'>more<\/span> <span class='match'>and<\/span> <span class='match'>the<\/span> <span class='match'>board<\/span> <span class='match'>will<\/span> <span class='match'>collapse<\/span>.<\/li>\n  <li><span class='match'>Take<\/span> <span class='match'>the<\/span> <span class='match'>match<\/span> <span class='match'>and<\/span> <span class='match'>strike<\/span> <span class='match'>it<\/span> <span class='match'>against<\/span> <span class='match'>your<\/span> <span class='match'>shoe<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pot<\/span> <span class='match'>boiled<\/span>, <span class='match'>but<\/span> <span class='match'>the<\/span> <span class='match'>contents<\/span> <span class='match'>failed<\/span> <span class='match'>to<\/span> <span class='match'>jell<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>baby<\/span> <span class='match'>puts<\/span> <span class='match'>his<\/span> <span class='match'>right<\/span> <span class='match'>foot<\/span> <span class='match'>in<\/span> <span class='match'>his<\/span> <span class='match'>mouth<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>bombs<\/span> <span class='match'>left<\/span> <span class='match'>most<\/span> <span class='match'>of<\/span> <span class='match'>the<\/span> <span class='match'>town<\/span> <span class='match'>in<\/span> <span class='match'>ruins<\/span>.<\/li>\n  <li><span class='match'>Stop<\/span> <span class='match'>and<\/span> <span class='match'>stare<\/span> <span class='match'>at<\/span> <span class='match'>the<\/span> <span class='match'>hard<\/span> <span class='match'>working<\/span> <span class='match'>man<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>streets<\/span> <span class='match'>are<\/span> <span class='match'>narrow<\/span> <span class='match'>and<\/span> <span class='match'>full<\/span> <span class='match'>of<\/span> <span class='match'>sharp<\/span> <span class='match'>turns<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>pup<\/span> <span class='match'>jerked<\/span> <span class='match'>the<\/span> <span class='match'>leash<\/span> <span class='match'>as<\/span> <span class='match'>he<\/span> <span class='match'>saw<\/span> <span class='match'>a<\/span> <span class='match'>feline<\/span> <span class='match'>shape<\/span>.<\/li>\n  <li><span class='match'>Open<\/span> <span class='match'>your<\/span> <span class='match'>book<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>first<\/span> <span class='match'>page<\/span>.<\/li>\n  <li><span class='match'>Fish<\/span> <span class='match'>evade<\/span> <span class='match'>the<\/span> <span class='match'>net<\/span>, <span class='match'>and<\/span> <span class='match'>swim<\/span> <span class='match'>off<\/span>.<\/li>\n  <li><span class='match'>Dip<\/span> <span class='match'>the<\/span> <span class='match'>pail<\/span> <span class='match'>once<\/span> <span class='match'>and<\/span> <span class='match'>let<\/span> <span class='match'>it<\/span> <span class='match'>settle<\/span>.<\/li>\n  <li><span class='match'>Will<\/span> <span class='match'>you<\/span> <span class='match'>please<\/span> <span class='match'>answer<\/span> <span class='match'>that<\/span> <span class='match'>phone<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>big<\/span> <span class='match'>red<\/span> <span class='match'>apple<\/span> <span class='match'>fell<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>ground<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>curtain<\/span> <span class='match'>rose<\/span> <span class='match'>and<\/span> <span class='match'>the<\/span> <span class='match'>show<\/span> <span class='match'>was<\/span> <span class='match'>on<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>young<\/span> <span class='match'>prince<\/span> <span class='match'>became<\/span> <span class='match'>heir<\/span> <span class='match'>to<\/span> <span class='match'>the<\/span> <span class='match'>throne<\/span>.<\/li>\n  <li><span class='match'>He<\/span> <span class='match'>sent<\/span> <span class='match'>the<\/span> <span class='match'>boy<\/span> <span class='match'>on<\/span> <span class='match'>a<\/span> <span class='match'>short<\/span> <span class='match'>errand<\/span>.<\/li>\n  <li><span class='match'>Leave<\/span> <span class='match'>now<\/span> <span class='match'>and<\/span> <span class='match'>you<\/span> <span class='match'>will<\/span> <span class='match'>arrive<\/span> <span class='match'>on<\/span> <span class='match'>time<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>corner<\/span> <span class='match'>store<\/span> <span class='match'>was<\/span> <span class='match'>robbed<\/span> <span class='match'>last<\/span> <span class='match'>night<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>gold<\/span> <span class='match'>ring<\/span> <span class='match'>will<\/span> <span class='match'>please<\/span> <span class='match'>most<\/span> <span class='match'>any<\/span> <span class='match'>girl<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>long<\/span> <span class='match'>journey<\/span> <span class='match'>home<\/span> <span class='match'>took<\/span> <span class='match'>a<\/span> <span class='match'>year<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>saw<\/span> <span class='match'>a<\/span> <span class='match'>cat<\/span> <span class='match'>in<\/span> <span class='match'>the<\/span> <span class='match'>neighbor's<\/span> <span class='match'>house<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>pink<\/span> <span class='match'>shell<\/span> <span class='match'>was<\/span> <span class='match'>found<\/span> <span class='match'>on<\/span> <span class='match'>the<\/span> <span class='match'>sandy<\/span> <span class='match'>beach<\/span>.<\/li>\n  <li><span class='match'>Small<\/span> <span class='match'>children<\/span> <span class='match'>came<\/span> <span class='match'>to<\/span> <span class='match'>see<\/span> <span class='match'>him<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>grass<\/span> <span class='match'>and<\/span> <span class='match'>bushes<\/span> <span class='match'>were<\/span> <span class='match'>wet<\/span> <span class='match'>with<\/span> <span class='match'>dew<\/span>.<\/li>\n  <li><span class='match'>The<\/span> <span class='match'>blind<\/span> <span class='match'>man<\/span> <span class='match'>counted<\/span> <span class='match'>his<\/span> <span class='match'>old<\/span> <span class='match'>coins<\/span>.<\/li>\n  <li><span class='match'>A<\/span> <span class='match'>severe<\/span> <span class='match'>storm<\/span> <span class='match'>tore<\/span> <span class='match'>down<\/span> <span class='match'>the<\/span> <span class='match'>barn<\/span>.<\/li>\n  <li><span class='match'>She<\/span> <span class='match'>called<\/span> <span class='match'>his<\/span> <span class='match'>name<\/span> <span class='match'>many<\/span> <span class='match'>times<\/span>.<\/li>\n  <li><span class='match'>When<\/span> <span class='match'>you<\/span> <span class='match'>hear<\/span> <span class='match'>the<\/span> <span class='match'>bell<\/span>, <span class='match'>come<\/span> <span class='match'>quickly<\/span>.<\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb1261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1261-1" data-line-number="1"><span class="kw">str_extract_all</span>(sentences, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))[[<span class="dv">1</span>]] <span class="co"># Беру первое измерение для примера</span></a></code></pre></div>
<pre><code>## [1] &quot;The&quot;    &quot;birch&quot;  &quot;canoe&quot;  &quot;slid&quot;   &quot;on&quot;     &quot;the&quot;    &quot;smooth&quot; &quot;planks&quot;</code></pre>
<p>Эта функция выводит список, с которым трудно работать, для того чтобы превратить список в матрицу, я буду использовать функцию <code>unlist()</code></p>
<div class="sourceCode" id="cb1263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1263-1" data-line-number="1"><span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(sentences, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>)))</a></code></pre></div>
<pre><code>##    [1] &quot;The&quot;        &quot;birch&quot;      &quot;canoe&quot;      &quot;slid&quot;       &quot;on&quot;        
##    [6] &quot;the&quot;        &quot;smooth&quot;     &quot;planks&quot;     &quot;Glue&quot;       &quot;the&quot;       
##   [11] &quot;sheet&quot;      &quot;to&quot;         &quot;the&quot;        &quot;dark&quot;       &quot;blue&quot;      
##   [16] &quot;background&quot; &quot;It&#39;s&quot;       &quot;easy&quot;       &quot;to&quot;         &quot;tell&quot;      
##   [21] &quot;the&quot;        &quot;depth&quot;      &quot;of&quot;         &quot;a&quot;          &quot;well&quot;      
##   [26] &quot;These&quot;      &quot;days&quot;       &quot;a&quot;          &quot;chicken&quot;    &quot;leg&quot;       
##   [31] &quot;is&quot;         &quot;a&quot;          &quot;rare&quot;       &quot;dish&quot;       &quot;Rice&quot;      
##   [36] &quot;is&quot;         &quot;often&quot;      &quot;served&quot;     &quot;in&quot;         &quot;round&quot;     
##   [41] &quot;bowls&quot;      &quot;The&quot;        &quot;juice&quot;      &quot;of&quot;         &quot;lemons&quot;    
##   [46] &quot;makes&quot;      &quot;fine&quot;       &quot;punch&quot;      &quot;The&quot;        &quot;box&quot;       
##   [51] &quot;was&quot;        &quot;thrown&quot;     &quot;beside&quot;     &quot;the&quot;        &quot;parked&quot;    
##   [56] &quot;truck&quot;      &quot;The&quot;        &quot;hogs&quot;       &quot;were&quot;       &quot;fed&quot;       
##   [61] &quot;chopped&quot;    &quot;corn&quot;       &quot;and&quot;        &quot;garbage&quot;    &quot;Four&quot;      
##   [66] &quot;hours&quot;      &quot;of&quot;         &quot;steady&quot;     &quot;work&quot;       &quot;faced&quot;     
##   [71] &quot;us&quot;         &quot;Large&quot;      &quot;size&quot;       &quot;in&quot;         &quot;stockings&quot; 
##   [76] &quot;is&quot;         &quot;hard&quot;       &quot;to&quot;         &quot;sell&quot;       &quot;The&quot;       
##   [81] &quot;boy&quot;        &quot;was&quot;        &quot;there&quot;      &quot;when&quot;       &quot;the&quot;       
##   [86] &quot;sun&quot;        &quot;rose&quot;       &quot;A&quot;          &quot;rod&quot;        &quot;is&quot;        
##   [91] &quot;used&quot;       &quot;to&quot;         &quot;catch&quot;      &quot;pink&quot;       &quot;salmon&quot;    
##   [96] &quot;The&quot;        &quot;source&quot;     &quot;of&quot;         &quot;the&quot;        &quot;huge&quot;      
##  [101] &quot;river&quot;      &quot;is&quot;         &quot;the&quot;        &quot;clear&quot;      &quot;spring&quot;    
##  [106] &quot;Kick&quot;       &quot;the&quot;        &quot;ball&quot;       &quot;straight&quot;   &quot;and&quot;       
##  [111] &quot;follow&quot;     &quot;through&quot;    &quot;Help&quot;       &quot;the&quot;        &quot;woman&quot;     
##  [116] &quot;get&quot;        &quot;back&quot;       &quot;to&quot;         &quot;her&quot;        &quot;feet&quot;      
##  [121] &quot;A&quot;          &quot;pot&quot;        &quot;of&quot;         &quot;tea&quot;        &quot;helps&quot;     
##  [126] &quot;to&quot;         &quot;pass&quot;       &quot;the&quot;        &quot;evening&quot;    &quot;Smoky&quot;     
##  [131] &quot;fires&quot;      &quot;lack&quot;       &quot;flame&quot;      &quot;and&quot;        &quot;heat&quot;      
##  [136] &quot;The&quot;        &quot;soft&quot;       &quot;cushion&quot;    &quot;broke&quot;      &quot;the&quot;       
##  [141] &quot;man&#39;s&quot;      &quot;fall&quot;       &quot;The&quot;        &quot;salt&quot;       &quot;breeze&quot;    
##  [146] &quot;came&quot;       &quot;across&quot;     &quot;from&quot;       &quot;the&quot;        &quot;sea&quot;       
##  [151] &quot;The&quot;        &quot;girl&quot;       &quot;at&quot;         &quot;the&quot;        &quot;booth&quot;     
##  [156] &quot;sold&quot;       &quot;fifty&quot;      &quot;bonds&quot;      &quot;The&quot;        &quot;small&quot;     
##  [161] &quot;pup&quot;        &quot;gnawed&quot;     &quot;a&quot;          &quot;hole&quot;       &quot;in&quot;        
##  [166] &quot;the&quot;        &quot;sock&quot;       &quot;The&quot;        &quot;fish&quot;       &quot;twisted&quot;   
##  [171] &quot;and&quot;        &quot;turned&quot;     &quot;on&quot;         &quot;the&quot;        &quot;bent&quot;      
##  [176] &quot;hook&quot;       &quot;Press&quot;      &quot;the&quot;        &quot;pants&quot;      &quot;and&quot;       
##  [181] &quot;sew&quot;        &quot;a&quot;          &quot;button&quot;     &quot;on&quot;         &quot;the&quot;       
##  [186] &quot;vest&quot;       &quot;The&quot;        &quot;swan&quot;       &quot;dive&quot;       &quot;was&quot;       
##  [191] &quot;far&quot;        &quot;short&quot;      &quot;of&quot;         &quot;perfect&quot;    &quot;The&quot;       
##  [196] &quot;beauty&quot;     &quot;of&quot;         &quot;the&quot;        &quot;view&quot;       &quot;stunned&quot;   
##  [201] &quot;the&quot;        &quot;young&quot;      &quot;boy&quot;        &quot;Two&quot;        &quot;blue&quot;      
##  [206] &quot;fish&quot;       &quot;swam&quot;       &quot;in&quot;         &quot;the&quot;        &quot;tank&quot;      
##  [211] &quot;Her&quot;        &quot;purse&quot;      &quot;was&quot;        &quot;full&quot;       &quot;of&quot;        
##  [216] &quot;useless&quot;    &quot;trash&quot;      &quot;The&quot;        &quot;colt&quot;       &quot;reared&quot;    
##  [221] &quot;and&quot;        &quot;threw&quot;      &quot;the&quot;        &quot;tall&quot;       &quot;rider&quot;     
##  [226] &quot;It&quot;         &quot;snowed&quot;     &quot;rained&quot;     &quot;and&quot;        &quot;hailed&quot;    
##  [231] &quot;the&quot;        &quot;same&quot;       &quot;morning&quot;    &quot;Read&quot;       &quot;verse&quot;     
##  [236] &quot;out&quot;        &quot;loud&quot;       &quot;for&quot;        &quot;pleasure&quot;   &quot;Hoist&quot;     
##  [241] &quot;the&quot;        &quot;load&quot;       &quot;to&quot;         &quot;your&quot;       &quot;left&quot;      
##  [246] &quot;shoulder&quot;   &quot;Take&quot;       &quot;the&quot;        &quot;winding&quot;    &quot;path&quot;      
##  [251] &quot;to&quot;         &quot;reach&quot;      &quot;the&quot;        &quot;lake&quot;       &quot;Note&quot;      
##  [256] &quot;closely&quot;    &quot;the&quot;        &quot;size&quot;       &quot;of&quot;         &quot;the&quot;       
##  [261] &quot;gas&quot;        &quot;tank&quot;       &quot;Wipe&quot;       &quot;the&quot;        &quot;grease&quot;    
##  [266] &quot;off&quot;        &quot;his&quot;        &quot;dirty&quot;      &quot;face&quot;       &quot;Mend&quot;      
##  [271] &quot;the&quot;        &quot;coat&quot;       &quot;before&quot;     &quot;you&quot;        &quot;go&quot;        
##  [276] &quot;out&quot;        &quot;The&quot;        &quot;wrist&quot;      &quot;was&quot;        &quot;badly&quot;     
##  [281] &quot;strained&quot;   &quot;and&quot;        &quot;hung&quot;       &quot;limp&quot;       &quot;The&quot;       
##  [286] &quot;stray&quot;      &quot;cat&quot;        &quot;gave&quot;       &quot;birth&quot;      &quot;to&quot;        
##  [291] &quot;kittens&quot;    &quot;The&quot;        &quot;young&quot;      &quot;girl&quot;       &quot;gave&quot;      
##  [296] &quot;no&quot;         &quot;clear&quot;      &quot;response&quot;   &quot;The&quot;        &quot;meal&quot;      
##  [301] &quot;was&quot;        &quot;cooked&quot;     &quot;before&quot;     &quot;the&quot;        &quot;bell&quot;      
##  [306] &quot;rang&quot;       &quot;What&quot;       &quot;joy&quot;        &quot;there&quot;      &quot;is&quot;        
##  [311] &quot;in&quot;         &quot;living&quot;     &quot;A&quot;          &quot;king&quot;       &quot;ruled&quot;     
##  [316] &quot;the&quot;        &quot;state&quot;      &quot;in&quot;         &quot;the&quot;        &quot;early&quot;     
##  [321] &quot;days&quot;       &quot;The&quot;        &quot;ship&quot;       &quot;was&quot;        &quot;torn&quot;      
##  [326] &quot;apart&quot;      &quot;on&quot;         &quot;the&quot;        &quot;sharp&quot;      &quot;reef&quot;      
##  [331] &quot;Sickness&quot;   &quot;kept&quot;       &quot;him&quot;        &quot;home&quot;       &quot;the&quot;       
##  [336] &quot;third&quot;      &quot;week&quot;       &quot;The&quot;        &quot;wide&quot;       &quot;road&quot;      
##  [341] &quot;shimmered&quot;  &quot;in&quot;         &quot;the&quot;        &quot;hot&quot;        &quot;sun&quot;       
##  [346] &quot;The&quot;        &quot;lazy&quot;       &quot;cow&quot;        &quot;lay&quot;        &quot;in&quot;        
##  [351] &quot;the&quot;        &quot;cool&quot;       &quot;grass&quot;      &quot;Lift&quot;       &quot;the&quot;       
##  [356] &quot;square&quot;     &quot;stone&quot;      &quot;over&quot;       &quot;the&quot;        &quot;fence&quot;     
##  [361] &quot;The&quot;        &quot;rope&quot;       &quot;will&quot;       &quot;bind&quot;       &quot;the&quot;       
##  [366] &quot;seven&quot;      &quot;books&quot;      &quot;at&quot;         &quot;once&quot;       &quot;Hop&quot;       
##  [371] &quot;over&quot;       &quot;the&quot;        &quot;fence&quot;      &quot;and&quot;        &quot;plunge&quot;    
##  [376] &quot;in&quot;         &quot;The&quot;        &quot;friendly&quot;   &quot;gang&quot;       &quot;left&quot;      
##  [381] &quot;the&quot;        &quot;drug&quot;       &quot;store&quot;      &quot;Mesh&quot;       &quot;mire&quot;      
##  [386] &quot;keeps&quot;      &quot;chicks&quot;     &quot;inside&quot;     &quot;The&quot;        &quot;frosty&quot;    
##  [391] &quot;air&quot;        &quot;passed&quot;     &quot;through&quot;    &quot;the&quot;        &quot;coat&quot;      
##  [396] &quot;The&quot;        &quot;crooked&quot;    &quot;maze&quot;       &quot;failed&quot;     &quot;to&quot;        
##  [401] &quot;fool&quot;       &quot;the&quot;        &quot;mouse&quot;      &quot;Adding&quot;     &quot;fast&quot;      
##  [406] &quot;leads&quot;      &quot;to&quot;         &quot;wrong&quot;      &quot;sums&quot;       &quot;The&quot;       
##  [411] &quot;show&quot;       &quot;was&quot;        &quot;a&quot;          &quot;flop&quot;       &quot;from&quot;      
##  [416] &quot;the&quot;        &quot;very&quot;       &quot;start&quot;      &quot;A&quot;          &quot;saw&quot;       
##  [421] &quot;is&quot;         &quot;a&quot;          &quot;tool&quot;       &quot;used&quot;       &quot;for&quot;       
##  [426] &quot;making&quot;     &quot;boards&quot;     &quot;The&quot;        &quot;wagon&quot;      &quot;moved&quot;     
##  [431] &quot;on&quot;         &quot;well&quot;       &quot;oiled&quot;      &quot;wheels&quot;     &quot;March&quot;     
##  [436] &quot;the&quot;        &quot;soldiers&quot;   &quot;past&quot;       &quot;the&quot;        &quot;next&quot;      
##  [441] &quot;hill&quot;       &quot;A&quot;          &quot;cup&quot;        &quot;of&quot;         &quot;sugar&quot;     
##  [446] &quot;makes&quot;      &quot;sweet&quot;      &quot;fudge&quot;      &quot;Place&quot;      &quot;a&quot;         
##  [451] &quot;rosebush&quot;   &quot;near&quot;       &quot;the&quot;        &quot;porch&quot;      &quot;steps&quot;     
##  [456] &quot;Both&quot;       &quot;lost&quot;       &quot;their&quot;      &quot;lives&quot;      &quot;in&quot;        
##  [461] &quot;the&quot;        &quot;raging&quot;     &quot;storm&quot;      &quot;We&quot;         &quot;talked&quot;    
##  [466] &quot;of&quot;         &quot;the&quot;        &quot;slide&quot;      &quot;show&quot;       &quot;in&quot;        
##  [471] &quot;the&quot;        &quot;circus&quot;     &quot;Use&quot;        &quot;a&quot;          &quot;pencil&quot;    
##  [476] &quot;to&quot;         &quot;write&quot;      &quot;the&quot;        &quot;first&quot;      &quot;draft&quot;     
##  [481] &quot;He&quot;         &quot;ran&quot;        &quot;half&quot;       &quot;way&quot;        &quot;to&quot;        
##  [486] &quot;the&quot;        &quot;hardware&quot;   &quot;store&quot;      &quot;The&quot;        &quot;clock&quot;     
##  [491] &quot;struck&quot;     &quot;to&quot;         &quot;mark&quot;       &quot;the&quot;        &quot;third&quot;     
##  [496] &quot;period&quot;     &quot;A&quot;          &quot;small&quot;      &quot;creek&quot;      &quot;cut&quot;       
##  [501] &quot;across&quot;     &quot;the&quot;        &quot;field&quot;      &quot;Cars&quot;       &quot;and&quot;       
##  [506] &quot;busses&quot;     &quot;stalled&quot;    &quot;in&quot;         &quot;snow&quot;       &quot;drifts&quot;    
##  [511] &quot;The&quot;        &quot;set&quot;        &quot;of&quot;         &quot;china&quot;      &quot;hit&quot;       
##  [516] &quot;the&quot;        &quot;floor&quot;      &quot;with&quot;       &quot;a&quot;          &quot;crash&quot;     
##  [521] &quot;This&quot;       &quot;is&quot;         &quot;a&quot;          &quot;grand&quot;      &quot;season&quot;    
##  [526] &quot;for&quot;        &quot;hikes&quot;      &quot;on&quot;         &quot;the&quot;        &quot;road&quot;      
##  [531] &quot;The&quot;        &quot;dune&quot;       &quot;rose&quot;       &quot;from&quot;       &quot;the&quot;       
##  [536] &quot;edge&quot;       &quot;of&quot;         &quot;the&quot;        &quot;water&quot;      &quot;Those&quot;     
##  [541] &quot;words&quot;      &quot;were&quot;       &quot;the&quot;        &quot;cue&quot;        &quot;for&quot;       
##  [546] &quot;the&quot;        &quot;actor&quot;      &quot;to&quot;         &quot;leave&quot;      &quot;A&quot;         
##  [551] &quot;yacht&quot;      &quot;slid&quot;       &quot;around&quot;     &quot;the&quot;        &quot;point&quot;     
##  [556] &quot;into&quot;       &quot;the&quot;        &quot;bay&quot;        &quot;The&quot;        &quot;two&quot;       
##  [561] &quot;met&quot;        &quot;while&quot;      &quot;playing&quot;    &quot;on&quot;         &quot;the&quot;       
##  [566] &quot;sand&quot;       &quot;The&quot;        &quot;ink&quot;        &quot;stain&quot;      &quot;dried&quot;     
##  [571] &quot;on&quot;         &quot;the&quot;        &quot;finished&quot;   &quot;page&quot;       &quot;The&quot;       
##  [576] &quot;walled&quot;     &quot;town&quot;       &quot;was&quot;        &quot;seized&quot;     &quot;without&quot;   
##  [581] &quot;a&quot;          &quot;fight&quot;      &quot;The&quot;        &quot;lease&quot;      &quot;ran&quot;       
##  [586] &quot;out&quot;        &quot;in&quot;         &quot;sixteen&quot;    &quot;weeks&quot;      &quot;A&quot;         
##  [591] &quot;tame&quot;       &quot;squirrel&quot;   &quot;makes&quot;      &quot;a&quot;          &quot;nice&quot;      
##  [596] &quot;pet&quot;        &quot;The&quot;        &quot;horn&quot;       &quot;of&quot;         &quot;the&quot;       
##  [601] &quot;car&quot;        &quot;woke&quot;       &quot;the&quot;        &quot;sleeping&quot;   &quot;cop&quot;       
##  [606] &quot;The&quot;        &quot;heart&quot;      &quot;beat&quot;       &quot;strongly&quot;   &quot;and&quot;       
##  [611] &quot;with&quot;       &quot;firm&quot;       &quot;strokes&quot;    &quot;The&quot;        &quot;pearl&quot;     
##  [616] &quot;was&quot;        &quot;worn&quot;       &quot;in&quot;         &quot;a&quot;          &quot;thin&quot;      
##  [621] &quot;silver&quot;     &quot;ring&quot;       &quot;The&quot;        &quot;fruit&quot;      &quot;peel&quot;      
##  [626] &quot;was&quot;        &quot;cut&quot;        &quot;in&quot;         &quot;thick&quot;      &quot;slices&quot;    
##  [631] &quot;The&quot;        &quot;Navy&quot;       &quot;attacked&quot;   &quot;the&quot;        &quot;big&quot;       
##  [636] &quot;task&quot;       &quot;force&quot;      &quot;See&quot;        &quot;the&quot;        &quot;cat&quot;       
##  [641] &quot;glaring&quot;    &quot;at&quot;         &quot;the&quot;        &quot;scared&quot;     &quot;mouse&quot;     
##  [646] &quot;There&quot;      &quot;are&quot;        &quot;more&quot;       &quot;than&quot;       &quot;two&quot;       
##  [651] &quot;factors&quot;    &quot;here&quot;       &quot;The&quot;        &quot;hat&quot;        &quot;brim&quot;      
##  [656] &quot;was&quot;        &quot;wide&quot;       &quot;and&quot;        &quot;too&quot;        &quot;droopy&quot;    
##  [661] &quot;The&quot;        &quot;lawyer&quot;     &quot;tried&quot;      &quot;to&quot;         &quot;lose&quot;      
##  [666] &quot;his&quot;        &quot;case&quot;       &quot;The&quot;        &quot;grass&quot;      &quot;curled&quot;    
##  [671] &quot;around&quot;     &quot;the&quot;        &quot;fence&quot;      &quot;post&quot;       &quot;Cut&quot;       
##  [676] &quot;the&quot;        &quot;pie&quot;        &quot;into&quot;       &quot;large&quot;      &quot;parts&quot;     
##  [681] &quot;Men&quot;        &quot;strive&quot;     &quot;but&quot;        &quot;seldom&quot;     &quot;get&quot;       
##  [686] &quot;rich&quot;       &quot;Always&quot;     &quot;close&quot;      &quot;the&quot;        &quot;barn&quot;      
##  [691] &quot;door&quot;       &quot;tight&quot;      &quot;He&quot;         &quot;lay&quot;        &quot;prone&quot;     
##  [696] &quot;and&quot;        &quot;hardly&quot;     &quot;moved&quot;      &quot;a&quot;          &quot;limb&quot;      
##  [701] &quot;The&quot;        &quot;slush&quot;      &quot;lay&quot;        &quot;deep&quot;       &quot;along&quot;     
##  [706] &quot;the&quot;        &quot;street&quot;     &quot;A&quot;          &quot;wisp&quot;       &quot;of&quot;        
##  [711] &quot;cloud&quot;      &quot;hung&quot;       &quot;in&quot;         &quot;the&quot;        &quot;blue&quot;      
##  [716] &quot;air&quot;        &quot;A&quot;          &quot;pound&quot;      &quot;of&quot;         &quot;sugar&quot;     
##  [721] &quot;costs&quot;      &quot;more&quot;       &quot;than&quot;       &quot;eggs&quot;       &quot;The&quot;       
##  [726] &quot;fin&quot;        &quot;was&quot;        &quot;sharp&quot;      &quot;and&quot;        &quot;cut&quot;       
##  [731] &quot;the&quot;        &quot;clear&quot;      &quot;water&quot;      &quot;The&quot;        &quot;play&quot;      
##  [736] &quot;seems&quot;      &quot;dull&quot;       &quot;and&quot;        &quot;quite&quot;      &quot;stupid&quot;    
##  [741] &quot;Bail&quot;       &quot;the&quot;        &quot;boat&quot;       &quot;to&quot;         &quot;stop&quot;      
##  [746] &quot;it&quot;         &quot;from&quot;       &quot;sinking&quot;    &quot;The&quot;        &quot;term&quot;      
##  [751] &quot;ended&quot;      &quot;in&quot;         &quot;late&quot;       &quot;June&quot;       &quot;that&quot;      
##  [756] &quot;year&quot;       &quot;A&quot;          &quot;tusk&quot;       &quot;is&quot;         &quot;used&quot;      
##  [761] &quot;to&quot;         &quot;make&quot;       &quot;costly&quot;     &quot;gifts&quot;      &quot;Ten&quot;       
##  [766] &quot;pins&quot;       &quot;were&quot;       &quot;set&quot;        &quot;in&quot;         &quot;order&quot;     
##  [771] &quot;The&quot;        &quot;bill&quot;       &quot;as&quot;         &quot;paid&quot;       &quot;every&quot;     
##  [776] &quot;third&quot;      &quot;week&quot;       &quot;Oak&quot;        &quot;is&quot;         &quot;strong&quot;    
##  [781] &quot;and&quot;        &quot;also&quot;       &quot;gives&quot;      &quot;shade&quot;      &quot;Cats&quot;      
##  [786] &quot;and&quot;        &quot;dogs&quot;       &quot;each&quot;       &quot;hate&quot;       &quot;the&quot;       
##  [791] &quot;other&quot;      &quot;The&quot;        &quot;pipe&quot;       &quot;began&quot;      &quot;to&quot;        
##  [796] &quot;rust&quot;       &quot;while&quot;      &quot;new&quot;        &quot;Open&quot;       &quot;the&quot;       
##  [801] &quot;crate&quot;      &quot;but&quot;        &quot;don&#39;t&quot;      &quot;break&quot;      &quot;the&quot;       
##  [806] &quot;glass&quot;      &quot;Add&quot;        &quot;the&quot;        &quot;sum&quot;        &quot;to&quot;        
##  [811] &quot;the&quot;        &quot;product&quot;    &quot;of&quot;         &quot;these&quot;      &quot;three&quot;     
##  [816] &quot;Thieves&quot;    &quot;who&quot;        &quot;rob&quot;        &quot;friends&quot;    &quot;deserve&quot;   
##  [821] &quot;jail&quot;       &quot;The&quot;        &quot;ripe&quot;       &quot;taste&quot;      &quot;of&quot;        
##  [826] &quot;cheese&quot;     &quot;improves&quot;   &quot;with&quot;       &quot;age&quot;        &quot;Act&quot;       
##  [831] &quot;on&quot;         &quot;these&quot;      &quot;orders&quot;     &quot;with&quot;       &quot;great&quot;     
##  [836] &quot;speed&quot;      &quot;The&quot;        &quot;hog&quot;        &quot;crawled&quot;    &quot;under&quot;     
##  [841] &quot;the&quot;        &quot;high&quot;       &quot;fence&quot;      &quot;Move&quot;       &quot;the&quot;       
##  [846] &quot;vat&quot;        &quot;over&quot;       &quot;the&quot;        &quot;hot&quot;        &quot;fire&quot;      
##  [851] &quot;The&quot;        &quot;bark&quot;       &quot;of&quot;         &quot;the&quot;        &quot;pine&quot;      
##  [856] &quot;tree&quot;       &quot;was&quot;        &quot;shiny&quot;      &quot;and&quot;        &quot;dark&quot;      
##  [861] &quot;Leaves&quot;     &quot;turn&quot;       &quot;brown&quot;      &quot;and&quot;        &quot;yellow&quot;    
##  [866] &quot;in&quot;         &quot;the&quot;        &quot;fall&quot;       &quot;The&quot;        &quot;pennant&quot;   
##  [871] &quot;waved&quot;      &quot;when&quot;       &quot;the&quot;        &quot;wind&quot;       &quot;blew&quot;      
##  [876] &quot;Split&quot;      &quot;the&quot;        &quot;log&quot;        &quot;with&quot;       &quot;a&quot;         
##  [881] &quot;quick&quot;      &quot;sharp&quot;      &quot;blow&quot;       &quot;Burn&quot;       &quot;peat&quot;      
##  [886] &quot;after&quot;      &quot;the&quot;        &quot;logs&quot;       &quot;give&quot;       &quot;out&quot;       
##  [891] &quot;He&quot;         &quot;ordered&quot;    &quot;peach&quot;      &quot;pie&quot;        &quot;with&quot;      
##  [896] &quot;ice&quot;        &quot;cream&quot;      &quot;Weave&quot;      &quot;the&quot;        &quot;carpet&quot;    
##  [901] &quot;on&quot;         &quot;the&quot;        &quot;right&quot;      &quot;hand&quot;       &quot;side&quot;      
##  [906] &quot;Hemp&quot;       &quot;is&quot;         &quot;a&quot;          &quot;weed&quot;       &quot;found&quot;     
##  [911] &quot;in&quot;         &quot;parts&quot;      &quot;of&quot;         &quot;the&quot;        &quot;tropics&quot;   
##  [916] &quot;A&quot;          &quot;lame&quot;       &quot;back&quot;       &quot;kept&quot;       &quot;his&quot;       
##  [921] &quot;score&quot;      &quot;low&quot;        &quot;We&quot;         &quot;find&quot;       &quot;joy&quot;       
##  [926] &quot;in&quot;         &quot;the&quot;        &quot;simplest&quot;   &quot;things&quot;     &quot;Type&quot;      
##  [931] &quot;out&quot;        &quot;three&quot;      &quot;lists&quot;      &quot;of&quot;         &quot;orders&quot;    
##  [936] &quot;The&quot;        &quot;harder&quot;     &quot;he&quot;         &quot;tried&quot;      &quot;the&quot;       
##  [941] &quot;less&quot;       &quot;he&quot;         &quot;got&quot;        &quot;done&quot;       &quot;The&quot;       
##  [946] &quot;boss&quot;       &quot;ran&quot;        &quot;the&quot;        &quot;show&quot;       &quot;with&quot;      
##  [951] &quot;a&quot;          &quot;watchful&quot;   &quot;eye&quot;        &quot;The&quot;        &quot;cup&quot;       
##  [956] &quot;cracked&quot;    &quot;and&quot;        &quot;spilled&quot;    &quot;its&quot;        &quot;contents&quot;  
##  [961] &quot;Paste&quot;      &quot;can&quot;        &quot;cleanse&quot;    &quot;the&quot;        &quot;most&quot;      
##  [966] &quot;dirty&quot;      &quot;brass&quot;      &quot;The&quot;        &quot;slang&quot;      &quot;word&quot;      
##  [971] &quot;for&quot;        &quot;raw&quot;        &quot;whiskey&quot;    &quot;is&quot;         &quot;booze&quot;     
##  [976] &quot;It&quot;         &quot;caught&quot;     &quot;its&quot;        &quot;hind&quot;       &quot;paw&quot;       
##  [981] &quot;in&quot;         &quot;a&quot;          &quot;rusty&quot;      &quot;trap&quot;       &quot;The&quot;       
##  [986] &quot;wharf&quot;      &quot;could&quot;      &quot;be&quot;         &quot;seen&quot;       &quot;at&quot;        
##  [991] &quot;the&quot;        &quot;farther&quot;    &quot;shore&quot;      &quot;Feel&quot;       &quot;the&quot;       
##  [996] &quot;heat&quot;       &quot;of&quot;         &quot;the&quot;        &quot;weak&quot;       &quot;dying&quot;     
## [1001] &quot;flame&quot;      &quot;The&quot;        &quot;tiny&quot;       &quot;girl&quot;       &quot;took&quot;      
## [1006] &quot;off&quot;        &quot;her&quot;        &quot;hat&quot;        &quot;A&quot;          &quot;cramp&quot;     
## [1011] &quot;is&quot;         &quot;no&quot;         &quot;small&quot;      &quot;danger&quot;     &quot;on&quot;        
## [1016] &quot;a&quot;          &quot;swim&quot;       &quot;He&quot;         &quot;said&quot;       &quot;the&quot;       
## [1021] &quot;same&quot;       &quot;phrase&quot;     &quot;thirty&quot;     &quot;times&quot;      &quot;Pluck&quot;     
## [1026] &quot;the&quot;        &quot;bright&quot;     &quot;rose&quot;       &quot;without&quot;    &quot;leaves&quot;    
## [1031] &quot;Two&quot;        &quot;plus&quot;       &quot;seven&quot;      &quot;is&quot;         &quot;less&quot;      
## [1036] &quot;than&quot;       &quot;ten&quot;        &quot;The&quot;        &quot;glow&quot;       &quot;deepened&quot;  
## [1041] &quot;in&quot;         &quot;the&quot;        &quot;eyes&quot;       &quot;of&quot;         &quot;the&quot;       
## [1046] &quot;sweet&quot;      &quot;girl&quot;       &quot;Bring&quot;      &quot;your&quot;       &quot;problems&quot;  
## [1051] &quot;to&quot;         &quot;the&quot;        &quot;wise&quot;       &quot;chief&quot;      &quot;Write&quot;     
## [1056] &quot;a&quot;          &quot;fond&quot;       &quot;note&quot;       &quot;to&quot;         &quot;the&quot;       
## [1061] &quot;friend&quot;     &quot;you&quot;        &quot;cherish&quot;    &quot;Clothes&quot;    &quot;and&quot;       
## [1066] &quot;lodging&quot;    &quot;are&quot;        &quot;free&quot;       &quot;to&quot;         &quot;new&quot;       
## [1071] &quot;men&quot;        &quot;We&quot;         &quot;frown&quot;      &quot;when&quot;       &quot;events&quot;    
## [1076] &quot;take&quot;       &quot;a&quot;          &quot;bad&quot;        &quot;turn&quot;       &quot;Port&quot;      
## [1081] &quot;is&quot;         &quot;a&quot;          &quot;strong&quot;     &quot;wine&quot;       &quot;with&quot;      
## [1086] &quot;s&quot;          &quot;smoky&quot;      &quot;taste&quot;      &quot;The&quot;        &quot;young&quot;     
## [1091] &quot;kid&quot;        &quot;jumped&quot;     &quot;the&quot;        &quot;rusty&quot;      &quot;gate&quot;      
## [1096] &quot;Guess&quot;      &quot;the&quot;        &quot;results&quot;    &quot;from&quot;       &quot;the&quot;       
## [1101] &quot;first&quot;      &quot;scores&quot;     &quot;A&quot;          &quot;salt&quot;       &quot;pickle&quot;    
## [1106] &quot;tastes&quot;     &quot;fine&quot;       &quot;with&quot;       &quot;ham&quot;        &quot;The&quot;       
## [1111] &quot;just&quot;       &quot;claim&quot;      &quot;got&quot;        &quot;the&quot;        &quot;right&quot;     
## [1116] &quot;verdict&quot;    &quot;These&quot;      &quot;thistles&quot;   &quot;bend&quot;       &quot;in&quot;        
## [1121] &quot;a&quot;          &quot;high&quot;       &quot;wind&quot;       &quot;Pure&quot;       &quot;bred&quot;      
## [1126] &quot;poodles&quot;    &quot;have&quot;       &quot;curls&quot;      &quot;The&quot;        &quot;tree&quot;      
## [1131] &quot;top&quot;        &quot;waved&quot;      &quot;in&quot;         &quot;a&quot;          &quot;graceful&quot;  
## [1136] &quot;way&quot;        &quot;The&quot;        &quot;spot&quot;       &quot;on&quot;         &quot;the&quot;       
## [1141] &quot;blotter&quot;    &quot;was&quot;        &quot;made&quot;       &quot;by&quot;         &quot;green&quot;     
## [1146] &quot;ink&quot;        &quot;Mud&quot;        &quot;was&quot;        &quot;spattered&quot;  &quot;on&quot;        
## [1151] &quot;the&quot;        &quot;front&quot;      &quot;of&quot;         &quot;his&quot;        &quot;white&quot;     
## [1156] &quot;shirt&quot;      &quot;The&quot;        &quot;cigar&quot;      &quot;burned&quot;     &quot;a&quot;         
## [1161] &quot;hole&quot;       &quot;in&quot;         &quot;the&quot;        &quot;desk&quot;       &quot;top&quot;       
## [1166] &quot;The&quot;        &quot;empty&quot;      &quot;flask&quot;      &quot;stood&quot;      &quot;on&quot;        
## [1171] &quot;the&quot;        &quot;tin&quot;        &quot;tray&quot;       &quot;A&quot;          &quot;speedy&quot;    
## [1176] &quot;man&quot;        &quot;can&quot;        &quot;beat&quot;       &quot;this&quot;       &quot;track&quot;     
## [1181] &quot;mark&quot;       &quot;He&quot;         &quot;broke&quot;      &quot;a&quot;          &quot;new&quot;       
## [1186] &quot;shoelace&quot;   &quot;that&quot;       &quot;day&quot;        &quot;The&quot;        &quot;coffee&quot;    
## [1191] &quot;stand&quot;      &quot;is&quot;         &quot;too&quot;        &quot;high&quot;       &quot;for&quot;       
## [1196] &quot;the&quot;        &quot;couch&quot;      &quot;The&quot;        &quot;urge&quot;       &quot;to&quot;        
## [1201] &quot;write&quot;      &quot;short&quot;      &quot;stories&quot;    &quot;is&quot;         &quot;rare&quot;      
## [1206] &quot;The&quot;        &quot;pencils&quot;    &quot;have&quot;       &quot;all&quot;        &quot;been&quot;      
## [1211] &quot;used&quot;       &quot;The&quot;        &quot;pirates&quot;    &quot;seized&quot;     &quot;the&quot;       
## [1216] &quot;crew&quot;       &quot;of&quot;         &quot;the&quot;        &quot;lost&quot;       &quot;ship&quot;      
## [1221] &quot;We&quot;         &quot;tried&quot;      &quot;to&quot;         &quot;replace&quot;    &quot;the&quot;       
## [1226] &quot;coin&quot;       &quot;but&quot;        &quot;failed&quot;     &quot;She&quot;        &quot;sewed&quot;     
## [1231] &quot;the&quot;        &quot;torn&quot;       &quot;coat&quot;       &quot;quite&quot;      &quot;neatly&quot;    
## [1236] &quot;The&quot;        &quot;sofa&quot;       &quot;cushion&quot;    &quot;is&quot;         &quot;red&quot;       
## [1241] &quot;and&quot;        &quot;of&quot;         &quot;light&quot;      &quot;weight&quot;     &quot;The&quot;       
## [1246] &quot;jacket&quot;     &quot;hung&quot;       &quot;on&quot;         &quot;the&quot;        &quot;back&quot;      
## [1251] &quot;of&quot;         &quot;the&quot;        &quot;wide&quot;       &quot;chair&quot;      &quot;At&quot;        
## [1256] &quot;that&quot;       &quot;high&quot;       &quot;level&quot;      &quot;the&quot;        &quot;air&quot;       
## [1261] &quot;is&quot;         &quot;pure&quot;       &quot;Drop&quot;       &quot;the&quot;        &quot;two&quot;       
## [1266] &quot;when&quot;       &quot;you&quot;        &quot;add&quot;        &quot;the&quot;        &quot;figures&quot;   
## [1271] &quot;A&quot;          &quot;filing&quot;     &quot;case&quot;       &quot;is&quot;         &quot;now&quot;       
## [1276] &quot;hard&quot;       &quot;to&quot;         &quot;buy&quot;        &quot;An&quot;         &quot;abrupt&quot;    
## [1281] &quot;start&quot;      &quot;does&quot;       &quot;not&quot;        &quot;win&quot;        &quot;the&quot;       
## [1286] &quot;prize&quot;      &quot;Wood&quot;       &quot;is&quot;         &quot;best&quot;       &quot;for&quot;       
## [1291] &quot;making&quot;     &quot;toys&quot;       &quot;and&quot;        &quot;blocks&quot;     &quot;The&quot;       
## [1296] &quot;office&quot;     &quot;paint&quot;      &quot;was&quot;        &quot;a&quot;          &quot;dull&quot;      
## [1301] &quot;sad&quot;        &quot;tan&quot;        &quot;He&quot;         &quot;knew&quot;       &quot;the&quot;       
## [1306] &quot;skill&quot;      &quot;of&quot;         &quot;the&quot;        &quot;great&quot;      &quot;young&quot;     
## [1311] &quot;actress&quot;    &quot;A&quot;          &quot;rag&quot;        &quot;will&quot;       &quot;soak&quot;      
## [1316] &quot;up&quot;         &quot;spilled&quot;    &quot;water&quot;      &quot;A&quot;          &quot;shower&quot;    
## [1321] &quot;of&quot;         &quot;dirt&quot;       &quot;fell&quot;       &quot;from&quot;       &quot;the&quot;       
## [1326] &quot;hot&quot;        &quot;pipes&quot;      &quot;Steam&quot;      &quot;hissed&quot;     &quot;from&quot;      
## [1331] &quot;the&quot;        &quot;broken&quot;     &quot;valve&quot;      &quot;The&quot;        &quot;child&quot;     
## [1336] &quot;almost&quot;     &quot;hurt&quot;       &quot;the&quot;        &quot;small&quot;      &quot;dog&quot;       
## [1341] &quot;There&quot;      &quot;was&quot;        &quot;a&quot;          &quot;sound&quot;      &quot;of&quot;        
## [1346] &quot;dry&quot;        &quot;leaves&quot;     &quot;outside&quot;    &quot;The&quot;        &quot;sky&quot;       
## [1351] &quot;that&quot;       &quot;morning&quot;    &quot;was&quot;        &quot;clear&quot;      &quot;and&quot;       
## [1356] &quot;bright&quot;     &quot;blue&quot;       &quot;Torn&quot;       &quot;scraps&quot;     &quot;littered&quot;  
## [1361] &quot;the&quot;        &quot;stone&quot;      &quot;floor&quot;      &quot;Sunday&quot;     &quot;is&quot;        
## [1366] &quot;the&quot;        &quot;best&quot;       &quot;part&quot;       &quot;of&quot;         &quot;the&quot;       
## [1371] &quot;week&quot;       &quot;The&quot;        &quot;doctor&quot;     &quot;cured&quot;      &quot;him&quot;       
## [1376] &quot;with&quot;       &quot;these&quot;      &quot;pills&quot;      &quot;The&quot;        &quot;new&quot;       
## [1381] &quot;girl&quot;       &quot;was&quot;        &quot;fired&quot;      &quot;today&quot;      &quot;at&quot;        
## [1386] &quot;noon&quot;       &quot;They&quot;       &quot;felt&quot;       &quot;gay&quot;        &quot;when&quot;      
## [1391] &quot;the&quot;        &quot;ship&quot;       &quot;arrived&quot;    &quot;in&quot;         &quot;port&quot;      
## [1396] &quot;Add&quot;        &quot;the&quot;        &quot;store&#39;s&quot;    &quot;account&quot;    &quot;to&quot;        
## [1401] &quot;the&quot;        &quot;last&quot;       &quot;cent&quot;       &quot;Acid&quot;       &quot;burns&quot;     
## [1406] &quot;holes&quot;      &quot;in&quot;         &quot;wool&quot;       &quot;cloth&quot;      &quot;Fairy&quot;     
## [1411] &quot;tales&quot;      &quot;should&quot;     &quot;be&quot;         &quot;fun&quot;        &quot;to&quot;        
## [1416] &quot;write&quot;      &quot;Eight&quot;      &quot;miles&quot;      &quot;of&quot;         &quot;woodland&quot;  
## [1421] &quot;burned&quot;     &quot;to&quot;         &quot;waste&quot;      &quot;The&quot;        &quot;third&quot;     
## [1426] &quot;act&quot;        &quot;was&quot;        &quot;dull&quot;       &quot;and&quot;        &quot;tired&quot;     
## [1431] &quot;the&quot;        &quot;players&quot;    &quot;A&quot;          &quot;young&quot;      &quot;child&quot;     
## [1436] &quot;should&quot;     &quot;not&quot;        &quot;suffer&quot;     &quot;fright&quot;     &quot;Add&quot;       
## [1441] &quot;the&quot;        &quot;column&quot;     &quot;and&quot;        &quot;put&quot;        &quot;the&quot;       
## [1446] &quot;sum&quot;        &quot;here&quot;       &quot;We&quot;         &quot;admire&quot;     &quot;and&quot;       
## [1451] &quot;love&quot;       &quot;a&quot;          &quot;good&quot;       &quot;cook&quot;       &quot;There&quot;     
## [1456] &quot;the&quot;        &quot;flood&quot;      &quot;mark&quot;       &quot;is&quot;         &quot;ten&quot;       
## [1461] &quot;inches&quot;     &quot;He&quot;         &quot;carved&quot;     &quot;a&quot;          &quot;head&quot;      
## [1466] &quot;from&quot;       &quot;the&quot;        &quot;round&quot;      &quot;block&quot;      &quot;of&quot;        
## [1471] &quot;marble&quot;     &quot;She&quot;        &quot;has&quot;        &quot;st&quot;         &quot;smart&quot;     
## [1476] &quot;way&quot;        &quot;of&quot;         &quot;wearing&quot;    &quot;clothes&quot;    &quot;The&quot;       
## [1481] &quot;fruit&quot;      &quot;of&quot;         &quot;a&quot;          &quot;fig&quot;        &quot;tree&quot;      
## [1486] &quot;is&quot;         &quot;apple&quot;      &quot;shaped&quot;     &quot;Corn&quot;       &quot;cobs&quot;      
## [1491] &quot;can&quot;        &quot;be&quot;         &quot;used&quot;       &quot;to&quot;         &quot;kindle&quot;    
## [1496] &quot;a&quot;          &quot;fire&quot;       &quot;Where&quot;      &quot;were&quot;       &quot;they&quot;      
## [1501] &quot;when&quot;       &quot;the&quot;        &quot;noise&quot;      &quot;started&quot;    &quot;The&quot;       
## [1506] &quot;paper&quot;      &quot;box&quot;        &quot;is&quot;         &quot;full&quot;       &quot;of&quot;        
## [1511] &quot;thumb&quot;      &quot;tacks&quot;      &quot;Sell&quot;       &quot;your&quot;       &quot;gift&quot;      
## [1516] &quot;to&quot;         &quot;a&quot;          &quot;buyer&quot;      &quot;at&quot;         &quot;a&quot;         
## [1521] &quot;good&quot;       &quot;gain&quot;       &quot;The&quot;        &quot;tongs&quot;      &quot;lay&quot;       
## [1526] &quot;beside&quot;     &quot;the&quot;        &quot;ice&quot;        &quot;pail&quot;       &quot;The&quot;       
## [1531] &quot;petals&quot;     &quot;fall&quot;       &quot;with&quot;       &quot;the&quot;        &quot;next&quot;      
## [1536] &quot;puff&quot;       &quot;of&quot;         &quot;wind&quot;       &quot;Bring&quot;      &quot;your&quot;      
## [1541] &quot;best&quot;       &quot;compass&quot;    &quot;to&quot;         &quot;the&quot;        &quot;third&quot;     
## [1546] &quot;class&quot;      &quot;They&quot;       &quot;could&quot;      &quot;laugh&quot;      &quot;although&quot;  
## [1551] &quot;they&quot;       &quot;were&quot;       &quot;sad&quot;        &quot;Farmers&quot;    &quot;came&quot;      
## [1556] &quot;in&quot;         &quot;to&quot;         &quot;thresh&quot;     &quot;the&quot;        &quot;oat&quot;       
## [1561] &quot;crop&quot;       &quot;The&quot;        &quot;brown&quot;      &quot;house&quot;      &quot;was&quot;       
## [1566] &quot;on&quot;         &quot;fire&quot;       &quot;to&quot;         &quot;the&quot;        &quot;attic&quot;     
## [1571] &quot;The&quot;        &quot;lure&quot;       &quot;is&quot;         &quot;used&quot;       &quot;to&quot;        
## [1576] &quot;catch&quot;      &quot;trout&quot;      &quot;and&quot;        &quot;flounder&quot;   &quot;Float&quot;     
## [1581] &quot;the&quot;        &quot;soap&quot;       &quot;on&quot;         &quot;top&quot;        &quot;of&quot;        
## [1586] &quot;the&quot;        &quot;bath&quot;       &quot;water&quot;      &quot;A&quot;          &quot;blue&quot;      
## [1591] &quot;crane&quot;      &quot;is&quot;         &quot;a&quot;          &quot;tall&quot;       &quot;wading&quot;    
## [1596] &quot;bird&quot;       &quot;A&quot;          &quot;fresh&quot;      &quot;start&quot;      &quot;will&quot;      
## [1601] &quot;work&quot;       &quot;such&quot;       &quot;wonders&quot;    &quot;The&quot;        &quot;club&quot;      
## [1606] &quot;rented&quot;     &quot;the&quot;        &quot;rink&quot;       &quot;for&quot;        &quot;the&quot;       
## [1611] &quot;fifth&quot;      &quot;night&quot;      &quot;After&quot;      &quot;the&quot;        &quot;dance&quot;     
## [1616] &quot;they&quot;       &quot;went&quot;       &quot;straight&quot;   &quot;home&quot;       &quot;The&quot;       
## [1621] &quot;hostess&quot;    &quot;taught&quot;     &quot;the&quot;        &quot;new&quot;        &quot;maid&quot;      
## [1626] &quot;to&quot;         &quot;serve&quot;      &quot;He&quot;         &quot;wrote&quot;      &quot;his&quot;       
## [1631] &quot;last&quot;       &quot;novel&quot;      &quot;there&quot;      &quot;at&quot;         &quot;the&quot;       
## [1636] &quot;inn&quot;        &quot;Even&quot;       &quot;the&quot;        &quot;worst&quot;      &quot;will&quot;      
## [1641] &quot;beat&quot;       &quot;his&quot;        &quot;low&quot;        &quot;score&quot;      &quot;The&quot;       
## [1646] &quot;cement&quot;     &quot;had&quot;        &quot;dried&quot;      &quot;when&quot;       &quot;he&quot;        
## [1651] &quot;moved&quot;      &quot;it&quot;         &quot;The&quot;        &quot;loss&quot;       &quot;of&quot;        
## [1656] &quot;the&quot;        &quot;second&quot;     &quot;ship&quot;       &quot;was&quot;        &quot;hard&quot;      
## [1661] &quot;to&quot;         &quot;take&quot;       &quot;The&quot;        &quot;fly&quot;        &quot;made&quot;      
## [1666] &quot;its&quot;        &quot;way&quot;        &quot;along&quot;      &quot;the&quot;        &quot;wall&quot;      
## [1671] &quot;Do&quot;         &quot;that&quot;       &quot;with&quot;       &quot;a&quot;          &quot;wooden&quot;    
## [1676] &quot;stick&quot;      &quot;Lire&quot;       &quot;wires&quot;      &quot;should&quot;     &quot;be&quot;        
## [1681] &quot;kept&quot;       &quot;covered&quot;    &quot;The&quot;        &quot;large&quot;      &quot;house&quot;     
## [1686] &quot;had&quot;        &quot;hot&quot;        &quot;water&quot;      &quot;taps&quot;       &quot;It&quot;        
## [1691] &quot;is&quot;         &quot;hard&quot;       &quot;to&quot;         &quot;erase&quot;      &quot;blue&quot;      
## [1696] &quot;or&quot;         &quot;red&quot;        &quot;ink&quot;        &quot;Write&quot;      &quot;at&quot;        
## [1701] &quot;once&quot;       &quot;or&quot;         &quot;you&quot;        &quot;may&quot;        &quot;forget&quot;    
## [1706] &quot;it&quot;         &quot;The&quot;        &quot;doorknob&quot;   &quot;was&quot;        &quot;made&quot;      
## [1711] &quot;of&quot;         &quot;bright&quot;     &quot;clean&quot;      &quot;brass&quot;      &quot;The&quot;       
## [1716] &quot;wreck&quot;      &quot;occurred&quot;   &quot;by&quot;         &quot;the&quot;        &quot;bank&quot;      
## [1721] &quot;on&quot;         &quot;Main&quot;       &quot;Street&quot;     &quot;A&quot;          &quot;pencil&quot;    
## [1726] &quot;with&quot;       &quot;black&quot;      &quot;lead&quot;       &quot;writes&quot;     &quot;best&quot;      
## [1731] &quot;Coax&quot;       &quot;a&quot;          &quot;young&quot;      &quot;calf&quot;       &quot;to&quot;        
## [1736] &quot;drink&quot;      &quot;from&quot;       &quot;a&quot;          &quot;bucket&quot;     &quot;Schools&quot;   
## [1741] &quot;for&quot;        &quot;ladies&quot;     &quot;teach&quot;      &quot;charm&quot;      &quot;and&quot;       
## [1746] &quot;grace&quot;      &quot;The&quot;        &quot;lamp&quot;       &quot;shone&quot;      &quot;with&quot;      
## [1751] &quot;a&quot;          &quot;steady&quot;     &quot;green&quot;      &quot;flame&quot;      &quot;They&quot;      
## [1756] &quot;took&quot;       &quot;the&quot;        &quot;axe&quot;        &quot;and&quot;        &quot;the&quot;       
## [1761] &quot;saw&quot;        &quot;to&quot;         &quot;the&quot;        &quot;forest&quot;     &quot;The&quot;       
## [1766] &quot;ancient&quot;    &quot;coin&quot;       &quot;was&quot;        &quot;quite&quot;      &quot;dull&quot;      
## [1771] &quot;and&quot;        &quot;worn&quot;       &quot;The&quot;        &quot;shaky&quot;      &quot;barn&quot;      
## [1776] &quot;fell&quot;       &quot;with&quot;       &quot;a&quot;          &quot;loud&quot;       &quot;crash&quot;     
## [1781] &quot;Jazz&quot;       &quot;and&quot;        &quot;swing&quot;      &quot;fans&quot;       &quot;like&quot;      
## [1786] &quot;fast&quot;       &quot;music&quot;      &quot;Rake&quot;       &quot;the&quot;        &quot;rubbish&quot;   
## [1791] &quot;up&quot;         &quot;and&quot;        &quot;then&quot;       &quot;burn&quot;       &quot;it&quot;        
## [1796] &quot;Slash&quot;      &quot;the&quot;        &quot;gold&quot;       &quot;cloth&quot;      &quot;into&quot;      
## [1801] &quot;fine&quot;       &quot;ribbons&quot;    &quot;Try&quot;        &quot;to&quot;         &quot;have&quot;      
## [1806] &quot;the&quot;        &quot;court&quot;      &quot;decide&quot;     &quot;the&quot;        &quot;case&quot;      
## [1811] &quot;They&quot;       &quot;are&quot;        &quot;pushed&quot;     &quot;back&quot;       &quot;each&quot;      
## [1816] &quot;time&quot;       &quot;they&quot;       &quot;attack&quot;     &quot;He&quot;         &quot;broke&quot;     
## [1821] &quot;his&quot;        &quot;ties&quot;       &quot;with&quot;       &quot;groups&quot;     &quot;of&quot;        
## [1826] &quot;former&quot;     &quot;friends&quot;    &quot;They&quot;       &quot;floated&quot;    &quot;on&quot;        
## [1831] &quot;the&quot;        &quot;raft&quot;       &quot;to&quot;         &quot;sun&quot;        &quot;their&quot;     
## [1836] &quot;white&quot;      &quot;backs&quot;      &quot;The&quot;        &quot;map&quot;        &quot;had&quot;       
## [1841] &quot;an&quot;         &quot;X&quot;          &quot;that&quot;       &quot;meant&quot;      &quot;nothing&quot;   
## [1846] &quot;Whitings&quot;   &quot;are&quot;        &quot;small&quot;      &quot;fish&quot;       &quot;caught&quot;    
## [1851] &quot;in&quot;         &quot;nets&quot;       &quot;Some&quot;       &quot;ads&quot;        &quot;serve&quot;     
## [1856] &quot;to&quot;         &quot;cheat&quot;      &quot;buyers&quot;     &quot;Jerk&quot;       &quot;the&quot;       
## [1861] &quot;rope&quot;       &quot;and&quot;        &quot;the&quot;        &quot;bell&quot;       &quot;rings&quot;     
## [1866] &quot;weakly&quot;     &quot;A&quot;          &quot;waxed&quot;      &quot;floor&quot;      &quot;makes&quot;     
## [1871] &quot;us&quot;         &quot;lose&quot;       &quot;balance&quot;    &quot;Madam&quot;      &quot;this&quot;      
## [1876] &quot;is&quot;         &quot;the&quot;        &quot;best&quot;       &quot;brand&quot;      &quot;of&quot;        
## [1881] &quot;corn&quot;       &quot;On&quot;         &quot;the&quot;        &quot;islands&quot;    &quot;the&quot;       
## [1886] &quot;sea&quot;        &quot;breeze&quot;     &quot;is&quot;         &quot;soft&quot;       &quot;and&quot;       
## [1891] &quot;mild&quot;       &quot;The&quot;        &quot;play&quot;       &quot;began&quot;      &quot;as&quot;        
## [1896] &quot;soon&quot;       &quot;as&quot;         &quot;we&quot;         &quot;sat&quot;        &quot;down&quot;      
## [1901] &quot;This&quot;       &quot;will&quot;       &quot;lead&quot;       &quot;the&quot;        &quot;world&quot;     
## [1906] &quot;to&quot;         &quot;more&quot;       &quot;sound&quot;      &quot;and&quot;        &quot;fury&quot;      
## [1911] &quot;Add&quot;        &quot;salt&quot;       &quot;before&quot;     &quot;you&quot;        &quot;fry&quot;       
## [1916] &quot;the&quot;        &quot;egg&quot;        &quot;The&quot;        &quot;rush&quot;       &quot;for&quot;       
## [1921] &quot;funds&quot;      &quot;reached&quot;    &quot;its&quot;        &quot;peak&quot;       &quot;Tuesday&quot;   
## [1926] &quot;The&quot;        &quot;birch&quot;      &quot;looked&quot;     &quot;stark&quot;      &quot;white&quot;     
## [1931] &quot;and&quot;        &quot;lonesome&quot;   &quot;The&quot;        &quot;box&quot;        &quot;is&quot;        
## [1936] &quot;held&quot;       &quot;by&quot;         &quot;a&quot;          &quot;bright&quot;     &quot;red&quot;       
## [1941] &quot;snapper&quot;    &quot;To&quot;         &quot;make&quot;       &quot;pure&quot;       &quot;ice&quot;       
## [1946] &quot;you&quot;        &quot;freeze&quot;     &quot;water&quot;      &quot;The&quot;        &quot;first&quot;     
## [1951] &quot;worm&quot;       &quot;gets&quot;       &quot;snapped&quot;    &quot;early&quot;      &quot;Jump&quot;      
## [1956] &quot;the&quot;        &quot;fence&quot;      &quot;and&quot;        &quot;hurry&quot;      &quot;up&quot;        
## [1961] &quot;the&quot;        &quot;bank&quot;       &quot;Yell&quot;       &quot;and&quot;        &quot;clap&quot;      
## [1966] &quot;as&quot;         &quot;the&quot;        &quot;curtain&quot;    &quot;slides&quot;     &quot;back&quot;      
## [1971] &quot;They&quot;       &quot;are&quot;        &quot;men&quot;        &quot;nho&quot;        &quot;walk&quot;      
## [1976] &quot;the&quot;        &quot;middle&quot;     &quot;of&quot;         &quot;the&quot;        &quot;road&quot;      
## [1981] &quot;Both&quot;       &quot;brothers&quot;   &quot;wear&quot;       &quot;the&quot;        &quot;same&quot;      
## [1986] &quot;size&quot;       &quot;In&quot;         &quot;some&quot;       &quot;forin&quot;      &quot;or&quot;        
## [1991] &quot;other&quot;      &quot;we&quot;         &quot;need&quot;       &quot;fun&quot;        &quot;The&quot;       
## [1996] &quot;prince&quot;     &quot;ordered&quot;    &quot;his&quot;        &quot;head&quot;       &quot;chopped&quot;   
## [2001] &quot;off&quot;        &quot;The&quot;        &quot;houses&quot;     &quot;are&quot;        &quot;built&quot;     
## [2006] &quot;of&quot;         &quot;red&quot;        &quot;clay&quot;       &quot;bricks&quot;     &quot;Ducks&quot;     
## [2011] &quot;fly&quot;        &quot;north&quot;      &quot;but&quot;        &quot;lack&quot;       &quot;a&quot;         
## [2016] &quot;compass&quot;    &quot;Fruit&quot;      &quot;flavors&quot;    &quot;are&quot;        &quot;used&quot;      
## [2021] &quot;in&quot;         &quot;fizz&quot;       &quot;drinks&quot;     &quot;These&quot;      &quot;pills&quot;     
## [2026] &quot;do&quot;         &quot;less&quot;       &quot;good&quot;       &quot;than&quot;       &quot;others&quot;    
## [2031] &quot;Canned&quot;     &quot;pears&quot;      &quot;lack&quot;       &quot;full&quot;       &quot;flavor&quot;    
## [2036] &quot;The&quot;        &quot;dark&quot;       &quot;pot&quot;        &quot;hung&quot;       &quot;in&quot;        
## [2041] &quot;the&quot;        &quot;front&quot;      &quot;closet&quot;     &quot;Carry&quot;      &quot;the&quot;       
## [2046] &quot;pail&quot;       &quot;to&quot;         &quot;the&quot;        &quot;wall&quot;       &quot;and&quot;       
## [2051] &quot;spill&quot;      &quot;it&quot;         &quot;there&quot;      &quot;The&quot;        &quot;train&quot;     
## [2056] &quot;brought&quot;    &quot;our&quot;        &quot;hero&quot;       &quot;to&quot;         &quot;the&quot;       
## [2061] &quot;big&quot;        &quot;town&quot;       &quot;We&quot;         &quot;are&quot;        &quot;sure&quot;      
## [2066] &quot;that&quot;       &quot;one&quot;        &quot;war&quot;        &quot;is&quot;         &quot;enough&quot;    
## [2071] &quot;Gray&quot;       &quot;paint&quot;      &quot;stretched&quot;  &quot;for&quot;        &quot;miles&quot;     
## [2076] &quot;around&quot;     &quot;The&quot;        &quot;rude&quot;       &quot;laugh&quot;      &quot;filled&quot;    
## [2081] &quot;the&quot;        &quot;empty&quot;      &quot;room&quot;       &quot;High&quot;       &quot;seats&quot;     
## [2086] &quot;are&quot;        &quot;best&quot;       &quot;for&quot;        &quot;football&quot;   &quot;fans&quot;      
## [2091] &quot;Tea&quot;        &quot;served&quot;     &quot;from&quot;       &quot;the&quot;        &quot;brown&quot;     
## [2096] &quot;jug&quot;        &quot;is&quot;         &quot;tasty&quot;      &quot;A&quot;          &quot;dash&quot;      
## [2101] &quot;of&quot;         &quot;pepper&quot;     &quot;spoils&quot;     &quot;beef&quot;       &quot;stew&quot;      
## [2106] &quot;A&quot;          &quot;zestful&quot;    &quot;food&quot;       &quot;is&quot;         &quot;the&quot;       
## [2111] &quot;hot&quot;        &quot;cross&quot;      &quot;bun&quot;        &quot;The&quot;        &quot;horse&quot;     
## [2116] &quot;trotted&quot;    &quot;around&quot;     &quot;the&quot;        &quot;field&quot;      &quot;at&quot;        
## [2121] &quot;a&quot;          &quot;brisk&quot;      &quot;pace&quot;       &quot;Find&quot;       &quot;the&quot;       
## [2126] &quot;twin&quot;       &quot;who&quot;        &quot;stole&quot;      &quot;the&quot;        &quot;pearl&quot;     
## [2131] &quot;necklace&quot;   &quot;Cut&quot;        &quot;the&quot;        &quot;cord&quot;       &quot;that&quot;      
## [2136] &quot;binds&quot;      &quot;the&quot;        &quot;box&quot;        &quot;tightly&quot;    &quot;The&quot;       
## [2141] &quot;red&quot;        &quot;tape&quot;       &quot;bound&quot;      &quot;the&quot;        &quot;smuggled&quot;  
## [2146] &quot;food&quot;       &quot;Look&quot;       &quot;in&quot;         &quot;the&quot;        &quot;corner&quot;    
## [2151] &quot;to&quot;         &quot;find&quot;       &quot;the&quot;        &quot;tan&quot;        &quot;shirt&quot;     
## [2156] &quot;The&quot;        &quot;cold&quot;       &quot;drizzle&quot;    &quot;will&quot;       &quot;halt&quot;      
## [2161] &quot;the&quot;        &quot;bond&quot;       &quot;drive&quot;      &quot;Nine&quot;       &quot;men&quot;       
## [2166] &quot;were&quot;       &quot;hired&quot;      &quot;to&quot;         &quot;dig&quot;        &quot;the&quot;       
## [2171] &quot;ruins&quot;      &quot;The&quot;        &quot;junk&quot;       &quot;yard&quot;       &quot;had&quot;       
## [2176] &quot;a&quot;          &quot;mouldy&quot;     &quot;smell&quot;      &quot;The&quot;        &quot;flint&quot;     
## [2181] &quot;sputtered&quot;  &quot;and&quot;        &quot;lit&quot;        &quot;a&quot;          &quot;pine&quot;      
## [2186] &quot;torch&quot;      &quot;Soak&quot;       &quot;the&quot;        &quot;cloth&quot;      &quot;and&quot;       
## [2191] &quot;drown&quot;      &quot;the&quot;        &quot;sharp&quot;      &quot;odor&quot;       &quot;The&quot;       
## [2196] &quot;shelves&quot;    &quot;were&quot;       &quot;bare&quot;       &quot;of&quot;         &quot;both&quot;      
## [2201] &quot;jam&quot;        &quot;or&quot;         &quot;crackers&quot;   &quot;A&quot;          &quot;joy&quot;       
## [2206] &quot;to&quot;         &quot;every&quot;      &quot;child&quot;      &quot;is&quot;         &quot;the&quot;       
## [2211] &quot;swan&quot;       &quot;boat&quot;       &quot;All&quot;        &quot;sat&quot;        &quot;frozen&quot;    
## [2216] &quot;and&quot;        &quot;watched&quot;    &quot;the&quot;        &quot;screen&quot;     &quot;ii&quot;        
## [2221] &quot;cloud&quot;      &quot;of&quot;         &quot;dust&quot;       &quot;stung&quot;      &quot;his&quot;       
## [2226] &quot;tender&quot;     &quot;eyes&quot;       &quot;To&quot;         &quot;reach&quot;      &quot;the&quot;       
## [2231] &quot;end&quot;        &quot;he&quot;         &quot;needs&quot;      &quot;much&quot;       &quot;courage&quot;   
## [2236] &quot;Shape&quot;      &quot;the&quot;        &quot;clay&quot;       &quot;gently&quot;     &quot;into&quot;      
## [2241] &quot;block&quot;      &quot;form&quot;       &quot;The&quot;        &quot;ridge&quot;      &quot;on&quot;        
## [2246] &quot;a&quot;          &quot;smooth&quot;     &quot;surface&quot;    &quot;is&quot;         &quot;a&quot;         
## [2251] &quot;bump&quot;       &quot;or&quot;         &quot;flaw&quot;       &quot;Hedge&quot;      &quot;apples&quot;    
## [2256] &quot;may&quot;        &quot;stain&quot;      &quot;your&quot;       &quot;hands&quot;      &quot;green&quot;     
## [2261] &quot;Quench&quot;     &quot;your&quot;       &quot;thirst&quot;     &quot;then&quot;       &quot;eat&quot;       
## [2266] &quot;the&quot;        &quot;crackers&quot;   &quot;Tight&quot;      &quot;curls&quot;      &quot;get&quot;       
## [2271] &quot;limp&quot;       &quot;on&quot;         &quot;rainy&quot;      &quot;days&quot;       &quot;The&quot;       
## [2276] &quot;mute&quot;       &quot;muffled&quot;    &quot;the&quot;        &quot;high&quot;       &quot;tones&quot;     
## [2281] &quot;of&quot;         &quot;the&quot;        &quot;horn&quot;       &quot;The&quot;        &quot;gold&quot;      
## [2286] &quot;ring&quot;       &quot;fits&quot;       &quot;only&quot;       &quot;a&quot;          &quot;pierced&quot;   
## [2291] &quot;ear&quot;        &quot;The&quot;        &quot;old&quot;        &quot;pan&quot;        &quot;was&quot;       
## [2296] &quot;covered&quot;    &quot;with&quot;       &quot;hard&quot;       &quot;fudge&quot;      &quot;Watch&quot;     
## [2301] &quot;the&quot;        &quot;log&quot;        &quot;float&quot;      &quot;in&quot;         &quot;the&quot;       
## [2306] &quot;wide&quot;       &quot;river&quot;      &quot;The&quot;        &quot;node&quot;       &quot;on&quot;        
## [2311] &quot;the&quot;        &quot;stalk&quot;      &quot;of&quot;         &quot;wheat&quot;      &quot;grew&quot;      
## [2316] &quot;daily&quot;      &quot;The&quot;        &quot;heap&quot;       &quot;of&quot;         &quot;fallen&quot;    
## [2321] &quot;leaves&quot;     &quot;was&quot;        &quot;set&quot;        &quot;on&quot;         &quot;fire&quot;      
## [2326] &quot;Write&quot;      &quot;fast&quot;       &quot;if&quot;         &quot;you&quot;        &quot;want&quot;      
## [2331] &quot;to&quot;         &quot;finish&quot;     &quot;early&quot;      &quot;His&quot;        &quot;shirt&quot;     
## [2336] &quot;was&quot;        &quot;clean&quot;      &quot;but&quot;        &quot;one&quot;        &quot;button&quot;    
## [2341] &quot;was&quot;        &quot;gone&quot;       &quot;The&quot;        &quot;barrel&quot;     &quot;of&quot;        
## [2346] &quot;beer&quot;       &quot;was&quot;        &quot;a&quot;          &quot;brew&quot;       &quot;of&quot;        
## [2351] &quot;malt&quot;       &quot;and&quot;        &quot;hops&quot;       &quot;Tin&quot;        &quot;cans&quot;      
## [2356] &quot;are&quot;        &quot;absent&quot;     &quot;from&quot;       &quot;store&quot;      &quot;shelves&quot;   
## [2361] &quot;Slide&quot;      &quot;the&quot;        &quot;box&quot;        &quot;into&quot;       &quot;that&quot;      
## [2366] &quot;empty&quot;      &quot;space&quot;      &quot;The&quot;        &quot;plant&quot;      &quot;grew&quot;      
## [2371] &quot;large&quot;      &quot;and&quot;        &quot;green&quot;      &quot;in&quot;         &quot;the&quot;       
## [2376] &quot;window&quot;     &quot;The&quot;        &quot;beam&quot;       &quot;dropped&quot;    &quot;down&quot;      
## [2381] &quot;on&quot;         &quot;the&quot;        &quot;workmen&#39;s&quot;  &quot;head&quot;       &quot;Pink&quot;      
## [2386] &quot;clouds&quot;     &quot;floated&quot;    &quot;JTith&quot;      &quot;the&quot;        &quot;breeze&quot;    
## [2391] &quot;She&quot;        &quot;danced&quot;     &quot;like&quot;       &quot;a&quot;          &quot;swan&quot;      
## [2396] &quot;tall&quot;       &quot;and&quot;        &quot;graceful&quot;   &quot;The&quot;        &quot;tube&quot;      
## [2401] &quot;was&quot;        &quot;blown&quot;      &quot;and&quot;        &quot;the&quot;        &quot;tire&quot;      
## [2406] &quot;flat&quot;       &quot;and&quot;        &quot;useless&quot;    &quot;It&quot;         &quot;is&quot;        
## [2411] &quot;late&quot;       &quot;morning&quot;    &quot;on&quot;         &quot;the&quot;        &quot;old&quot;       
## [2416] &quot;wall&quot;       &quot;clock&quot;      &quot;Let&#39;s&quot;      &quot;all&quot;        &quot;join&quot;      
## [2421] &quot;as&quot;         &quot;we&quot;         &quot;sing&quot;       &quot;the&quot;        &quot;last&quot;      
## [2426] &quot;chorus&quot;     &quot;The&quot;        &quot;last&quot;       &quot;switch&quot;     &quot;cannot&quot;    
## [2431] &quot;be&quot;         &quot;turned&quot;     &quot;off&quot;        &quot;The&quot;        &quot;fight&quot;     
## [2436] &quot;will&quot;       &quot;end&quot;        &quot;in&quot;         &quot;just&quot;       &quot;six&quot;       
## [2441] &quot;minutes&quot;    &quot;The&quot;        &quot;store&quot;      &quot;walls&quot;      &quot;were&quot;      
## [2446] &quot;lined&quot;      &quot;with&quot;       &quot;colored&quot;    &quot;frocks&quot;     &quot;The&quot;       
## [2451] &quot;peace&quot;      &quot;league&quot;     &quot;met&quot;        &quot;to&quot;         &quot;discuss&quot;   
## [2456] &quot;their&quot;      &quot;plans&quot;      &quot;The&quot;        &quot;rise&quot;       &quot;to&quot;        
## [2461] &quot;fame&quot;       &quot;of&quot;         &quot;a&quot;          &quot;person&quot;     &quot;takes&quot;     
## [2466] &quot;luck&quot;       &quot;Paper&quot;      &quot;is&quot;         &quot;scarce&quot;     &quot;so&quot;        
## [2471] &quot;write&quot;      &quot;with&quot;       &quot;much&quot;       &quot;care&quot;       &quot;The&quot;       
## [2476] &quot;quick&quot;      &quot;fox&quot;        &quot;jumped&quot;     &quot;on&quot;         &quot;the&quot;       
## [2481] &quot;sleeping&quot;   &quot;cat&quot;        &quot;The&quot;        &quot;nozzle&quot;     &quot;of&quot;        
## [2486] &quot;the&quot;        &quot;fire&quot;       &quot;hose&quot;       &quot;was&quot;        &quot;bright&quot;    
## [2491] &quot;brass&quot;      &quot;Screw&quot;      &quot;the&quot;        &quot;round&quot;      &quot;cap&quot;       
## [2496] &quot;on&quot;         &quot;as&quot;         &quot;tight&quot;      &quot;as&quot;         &quot;needed&quot;    
## [2501] &quot;Time&quot;       &quot;brings&quot;     &quot;us&quot;         &quot;many&quot;       &quot;changes&quot;   
## [2506] &quot;The&quot;        &quot;purple&quot;     &quot;tie&quot;        &quot;was&quot;        &quot;ten&quot;       
## [2511] &quot;years&quot;      &quot;old&quot;        &quot;Men&quot;        &quot;think&quot;      &quot;and&quot;       
## [2516] &quot;plan&quot;       &quot;and&quot;        &quot;sometimes&quot;  &quot;act&quot;        &quot;Fill&quot;      
## [2521] &quot;the&quot;        &quot;ink&quot;        &quot;jar&quot;        &quot;with&quot;       &quot;sticky&quot;    
## [2526] &quot;glue&quot;       &quot;He&quot;         &quot;smoke&quot;      &quot;a&quot;          &quot;big&quot;       
## [2531] &quot;pipe&quot;       &quot;with&quot;       &quot;strong&quot;     &quot;contents&quot;   &quot;We&quot;        
## [2536] &quot;need&quot;       &quot;grain&quot;      &quot;to&quot;         &quot;keep&quot;       &quot;our&quot;       
## [2541] &quot;mules&quot;      &quot;healthy&quot;    &quot;Pack&quot;       &quot;the&quot;        &quot;records&quot;   
## [2546] &quot;in&quot;         &quot;a&quot;          &quot;neat&quot;       &quot;thin&quot;       &quot;case&quot;      
## [2551] &quot;The&quot;        &quot;crunch&quot;     &quot;of&quot;         &quot;feet&quot;       &quot;in&quot;        
## [2556] &quot;the&quot;        &quot;snow&quot;       &quot;was&quot;        &quot;the&quot;        &quot;only&quot;      
## [2561] &quot;sound&quot;      &quot;The&quot;        &quot;copper&quot;     &quot;bowl&quot;       &quot;shone&quot;     
## [2566] &quot;in&quot;         &quot;the&quot;        &quot;sun&#39;s&quot;      &quot;rays&quot;       &quot;Boards&quot;    
## [2571] &quot;will&quot;       &quot;warp&quot;       &quot;unless&quot;     &quot;kept&quot;       &quot;dry&quot;       
## [2576] &quot;The&quot;        &quot;plush&quot;      &quot;chair&quot;      &quot;leaned&quot;     &quot;against&quot;   
## [2581] &quot;the&quot;        &quot;wall&quot;       &quot;Glass&quot;      &quot;will&quot;       &quot;clink&quot;     
## [2586] &quot;when&quot;       &quot;struck&quot;     &quot;by&quot;         &quot;metal&quot;      &quot;Bathe&quot;     
## [2591] &quot;and&quot;        &quot;relax&quot;      &quot;in&quot;         &quot;the&quot;        &quot;cool&quot;      
## [2596] &quot;green&quot;      &quot;grass&quot;      &quot;Nine&quot;       &quot;rows&quot;       &quot;of&quot;        
## [2601] &quot;soldiers&quot;   &quot;stood&quot;      &quot;in&quot;         &quot;line&quot;       &quot;The&quot;       
## [2606] &quot;beach&quot;      &quot;is&quot;         &quot;dry&quot;        &quot;and&quot;        &quot;shallow&quot;   
## [2611] &quot;at&quot;         &quot;low&quot;        &quot;tide&quot;       &quot;The&quot;        &quot;idea&quot;      
## [2616] &quot;is&quot;         &quot;to&quot;         &quot;sew&quot;        &quot;both&quot;       &quot;edges&quot;     
## [2621] &quot;straight&quot;   &quot;The&quot;        &quot;kitten&quot;     &quot;chased&quot;     &quot;the&quot;       
## [2626] &quot;dog&quot;        &quot;down&quot;       &quot;the&quot;        &quot;street&quot;     &quot;Pages&quot;     
## [2631] &quot;bound&quot;      &quot;in&quot;         &quot;cloth&quot;      &quot;make&quot;       &quot;a&quot;         
## [2636] &quot;book&quot;       &quot;Try&quot;        &quot;to&quot;         &quot;trace&quot;      &quot;the&quot;       
## [2641] &quot;fine&quot;       &quot;lines&quot;      &quot;of&quot;         &quot;the&quot;        &quot;painting&quot;  
## [2646] &quot;Women&quot;      &quot;form&quot;       &quot;less&quot;       &quot;than&quot;       &quot;half&quot;      
## [2651] &quot;of&quot;         &quot;the&quot;        &quot;group&quot;      &quot;The&quot;        &quot;zones&quot;     
## [2656] &quot;merge&quot;      &quot;in&quot;         &quot;the&quot;        &quot;central&quot;    &quot;part&quot;      
## [2661] &quot;of&quot;         &quot;town&quot;       &quot;A&quot;          &quot;gem&quot;        &quot;in&quot;        
## [2666] &quot;the&quot;        &quot;rough&quot;      &quot;needs&quot;      &quot;work&quot;       &quot;to&quot;        
## [2671] &quot;polish&quot;     &quot;Code&quot;       &quot;is&quot;         &quot;used&quot;       &quot;when&quot;      
## [2676] &quot;secrets&quot;    &quot;are&quot;        &quot;sent&quot;       &quot;Most&quot;       &quot;of&quot;        
## [2681] &quot;the&quot;        &quot;new&quot;        &quot;is&quot;         &quot;easy&quot;       &quot;for&quot;       
## [2686] &quot;us&quot;         &quot;to&quot;         &quot;hear&quot;       &quot;He&quot;         &quot;used&quot;      
## [2691] &quot;the&quot;        &quot;lathe&quot;      &quot;to&quot;         &quot;make&quot;       &quot;brass&quot;     
## [2696] &quot;objects&quot;    &quot;The&quot;        &quot;vane&quot;       &quot;on&quot;         &quot;top&quot;       
## [2701] &quot;of&quot;         &quot;the&quot;        &quot;pole&quot;       &quot;revolved&quot;   &quot;in&quot;        
## [2706] &quot;the&quot;        &quot;wind&quot;       &quot;Mince&quot;      &quot;pie&quot;        &quot;is&quot;        
## [2711] &quot;a&quot;          &quot;dish&quot;       &quot;served&quot;     &quot;to&quot;         &quot;children&quot;  
## [2716] &quot;The&quot;        &quot;clan&quot;       &quot;gathered&quot;   &quot;on&quot;         &quot;each&quot;      
## [2721] &quot;dull&quot;       &quot;night&quot;      &quot;Let&quot;        &quot;it&quot;         &quot;burn&quot;      
## [2726] &quot;it&quot;         &quot;gives&quot;      &quot;us&quot;         &quot;warmth&quot;     &quot;and&quot;       
## [2731] &quot;comfort&quot;    &quot;A&quot;          &quot;castle&quot;     &quot;built&quot;      &quot;from&quot;      
## [2736] &quot;sand&quot;       &quot;fails&quot;      &quot;to&quot;         &quot;endure&quot;     &quot;A&quot;         
## [2741] &quot;child&#39;s&quot;    &quot;wit&quot;        &quot;saved&quot;      &quot;the&quot;        &quot;day&quot;       
## [2746] &quot;for&quot;        &quot;us&quot;         &quot;Tack&quot;       &quot;the&quot;        &quot;strip&quot;     
## [2751] &quot;of&quot;         &quot;carpet&quot;     &quot;to&quot;         &quot;the&quot;        &quot;worn&quot;      
## [2756] &quot;floor&quot;      &quot;Next&quot;       &quot;Tuesday&quot;    &quot;we&quot;         &quot;must&quot;      
## [2761] &quot;vote&quot;       &quot;Pour&quot;       &quot;the&quot;        &quot;stew&quot;       &quot;from&quot;      
## [2766] &quot;the&quot;        &quot;pot&quot;        &quot;into&quot;       &quot;the&quot;        &quot;plate&quot;     
## [2771] &quot;Each&quot;       &quot;penny&quot;      &quot;shone&quot;      &quot;like&quot;       &quot;new&quot;       
## [2776] &quot;The&quot;        &quot;man&quot;        &quot;went&quot;       &quot;to&quot;         &quot;the&quot;       
## [2781] &quot;woods&quot;      &quot;to&quot;         &quot;gather&quot;     &quot;sticks&quot;     &quot;The&quot;       
## [2786] &quot;dirt&quot;       &quot;piles&quot;      &quot;were&quot;       &quot;lines&quot;      &quot;along&quot;     
## [2791] &quot;the&quot;        &quot;road&quot;       &quot;The&quot;        &quot;logs&quot;       &quot;fell&quot;      
## [2796] &quot;and&quot;        &quot;tumbled&quot;    &quot;into&quot;       &quot;the&quot;        &quot;clear&quot;     
## [2801] &quot;stream&quot;     &quot;Just&quot;       &quot;hoist&quot;      &quot;it&quot;         &quot;up&quot;        
## [2806] &quot;and&quot;        &quot;take&quot;       &quot;it&quot;         &quot;away&quot;       &quot;A&quot;         
## [2811] &quot;ripe&quot;       &quot;plum&quot;       &quot;is&quot;         &quot;fit&quot;        &quot;for&quot;       
## [2816] &quot;a&quot;          &quot;king&#39;s&quot;     &quot;palate&quot;     &quot;Our&quot;        &quot;plans&quot;     
## [2821] &quot;right&quot;      &quot;now&quot;        &quot;are&quot;        &quot;hazy&quot;       &quot;Brass&quot;     
## [2826] &quot;rings&quot;      &quot;are&quot;        &quot;sold&quot;       &quot;by&quot;         &quot;these&quot;     
## [2831] &quot;natives&quot;    &quot;It&quot;         &quot;takes&quot;      &quot;a&quot;          &quot;good&quot;      
## [2836] &quot;trap&quot;       &quot;to&quot;         &quot;capture&quot;    &quot;a&quot;          &quot;bear&quot;      
## [2841] &quot;Feed&quot;       &quot;the&quot;        &quot;white&quot;      &quot;mouse&quot;      &quot;some&quot;      
## [2846] &quot;flower&quot;     &quot;seeds&quot;      &quot;The&quot;        &quot;thaw&quot;       &quot;came&quot;      
## [2851] &quot;early&quot;      &quot;and&quot;        &quot;freed&quot;      &quot;the&quot;        &quot;stream&quot;    
## [2856] &quot;He&quot;         &quot;took&quot;       &quot;the&quot;        &quot;lead&quot;       &quot;and&quot;       
## [2861] &quot;kept&quot;       &quot;it&quot;         &quot;the&quot;        &quot;whole&quot;      &quot;distance&quot;  
## [2866] &quot;The&quot;        &quot;key&quot;        &quot;you&quot;        &quot;designed&quot;   &quot;will&quot;      
## [2871] &quot;fit&quot;        &quot;the&quot;        &quot;lock&quot;       &quot;Plead&quot;      &quot;to&quot;        
## [2876] &quot;the&quot;        &quot;council&quot;    &quot;to&quot;         &quot;free&quot;       &quot;the&quot;       
## [2881] &quot;poor&quot;       &quot;thief&quot;      &quot;Better&quot;     &quot;hash&quot;       &quot;is&quot;        
## [2886] &quot;made&quot;       &quot;of&quot;         &quot;rare&quot;       &quot;beef&quot;       &quot;This&quot;      
## [2891] &quot;plank&quot;      &quot;was&quot;        &quot;made&quot;       &quot;for&quot;        &quot;walking&quot;   
## [2896] &quot;on&quot;         &quot;The&quot;        &quot;lake&quot;       &quot;sparkled&quot;   &quot;in&quot;        
## [2901] &quot;the&quot;        &quot;red&quot;        &quot;hot&quot;        &quot;sun&quot;        &quot;He&quot;        
## [2906] &quot;crawled&quot;    &quot;with&quot;       &quot;care&quot;       &quot;along&quot;      &quot;the&quot;       
## [2911] &quot;ledge&quot;      &quot;Tend&quot;       &quot;the&quot;        &quot;sheep&quot;      &quot;while&quot;     
## [2916] &quot;the&quot;        &quot;dog&quot;        &quot;wanders&quot;    &quot;It&quot;         &quot;takes&quot;     
## [2921] &quot;a&quot;          &quot;lot&quot;        &quot;of&quot;         &quot;help&quot;       &quot;to&quot;        
## [2926] &quot;finish&quot;     &quot;these&quot;      &quot;Mark&quot;       &quot;the&quot;        &quot;spot&quot;      
## [2931] &quot;with&quot;       &quot;a&quot;          &quot;sign&quot;       &quot;painted&quot;    &quot;red&quot;       
## [2936] &quot;Take&quot;       &quot;two&quot;        &quot;shares&quot;     &quot;as&quot;         &quot;a&quot;         
## [2941] &quot;fair&quot;       &quot;profit&quot;     &quot;The&quot;        &quot;fur&quot;        &quot;of&quot;        
## [2946] &quot;cats&quot;       &quot;goes&quot;       &quot;by&quot;         &quot;many&quot;       &quot;names&quot;     
## [2951] &quot;North&quot;      &quot;winds&quot;      &quot;bring&quot;      &quot;colds&quot;      &quot;and&quot;       
## [2956] &quot;fevers&quot;     &quot;He&quot;         &quot;asks&quot;       &quot;no&quot;         &quot;person&quot;    
## [2961] &quot;to&quot;         &quot;vouch&quot;      &quot;for&quot;        &quot;him&quot;        &quot;Go&quot;        
## [2966] &quot;now&quot;        &quot;and&quot;        &quot;come&quot;       &quot;here&quot;       &quot;later&quot;     
## [2971] &quot;A&quot;          &quot;sash&quot;       &quot;of&quot;         &quot;gold&quot;       &quot;silk&quot;      
## [2976] &quot;will&quot;       &quot;trim&quot;       &quot;her&quot;        &quot;dress&quot;      &quot;Soap&quot;      
## [2981] &quot;can&quot;        &quot;wash&quot;       &quot;most&quot;       &quot;dirt&quot;       &quot;away&quot;      
## [2986] &quot;That&quot;       &quot;move&quot;       &quot;means&quot;      &quot;the&quot;        &quot;game&quot;      
## [2991] &quot;is&quot;         &quot;over&quot;       &quot;He&quot;         &quot;wrote&quot;      &quot;down&quot;      
## [2996] &quot;a&quot;          &quot;long&quot;       &quot;list&quot;       &quot;of&quot;         &quot;items&quot;     
## [3001] &quot;A&quot;          &quot;siege&quot;      &quot;will&quot;       &quot;crack&quot;      &quot;the&quot;       
## [3006] &quot;strong&quot;     &quot;defense&quot;    &quot;Grape&quot;      &quot;juice&quot;      &quot;and&quot;       
## [3011] &quot;water&quot;      &quot;mix&quot;        &quot;well&quot;       &quot;Roads&quot;      &quot;are&quot;       
## [3016] &quot;paved&quot;      &quot;with&quot;       &quot;sticky&quot;     &quot;tar&quot;        &quot;Fake&quot;      
## [3021] &quot;ones&quot;       &quot;shine&quot;      &quot;but&quot;        &quot;cost&quot;       &quot;little&quot;    
## [3026] &quot;The&quot;        &quot;drip&quot;       &quot;of&quot;         &quot;the&quot;        &quot;rain&quot;      
## [3031] &quot;made&quot;       &quot;a&quot;          &quot;pleasant&quot;   &quot;sound&quot;      &quot;Smoke&quot;     
## [3036] &quot;poured&quot;     &quot;out&quot;        &quot;of&quot;         &quot;every&quot;      &quot;crack&quot;     
## [3041] &quot;Serve&quot;      &quot;the&quot;        &quot;hot&quot;        &quot;rum&quot;        &quot;to&quot;        
## [3046] &quot;the&quot;        &quot;tired&quot;      &quot;heroes&quot;     &quot;Much&quot;       &quot;of&quot;        
## [3051] &quot;the&quot;        &quot;story&quot;      &quot;makes&quot;      &quot;good&quot;       &quot;sense&quot;     
## [3056] &quot;The&quot;        &quot;sun&quot;        &quot;came&quot;       &quot;up&quot;         &quot;to&quot;        
## [3061] &quot;light&quot;      &quot;the&quot;        &quot;eastern&quot;    &quot;sky&quot;        &quot;Heave&quot;     
## [3066] &quot;the&quot;        &quot;line&quot;       &quot;over&quot;       &quot;the&quot;        &quot;port&quot;      
## [3071] &quot;side&quot;       &quot;A&quot;          &quot;lathe&quot;      &quot;cuts&quot;       &quot;and&quot;       
## [3076] &quot;trims&quot;      &quot;any&quot;        &quot;wood&quot;       &quot;It&#39;s&quot;       &quot;a&quot;         
## [3081] &quot;dense&quot;      &quot;crowd&quot;      &quot;in&quot;         &quot;two&quot;        &quot;distinct&quot;  
## [3086] &quot;ways&quot;       &quot;His&quot;        &quot;hip&quot;        &quot;struck&quot;     &quot;the&quot;       
## [3091] &quot;knee&quot;       &quot;of&quot;         &quot;the&quot;        &quot;next&quot;       &quot;player&quot;    
## [3096] &quot;The&quot;        &quot;stale&quot;      &quot;smell&quot;      &quot;of&quot;         &quot;old&quot;       
## [3101] &quot;beer&quot;       &quot;lingers&quot;    &quot;The&quot;        &quot;desk&quot;       &quot;was&quot;       
## [3106] &quot;firm&quot;       &quot;on&quot;         &quot;the&quot;        &quot;shaky&quot;      &quot;floor&quot;     
## [3111] &quot;It&quot;         &quot;takes&quot;      &quot;heat&quot;       &quot;to&quot;         &quot;bring&quot;     
## [3116] &quot;out&quot;        &quot;the&quot;        &quot;odor&quot;       &quot;Beef&quot;       &quot;is&quot;        
## [3121] &quot;scarcer&quot;    &quot;than&quot;       &quot;some&quot;       &quot;lamb&quot;       &quot;Raise&quot;     
## [3126] &quot;the&quot;        &quot;sail&quot;       &quot;and&quot;        &quot;steer&quot;      &quot;the&quot;       
## [3131] &quot;ship&quot;       &quot;northward&quot;  &quot;The&quot;        &quot;cone&quot;       &quot;costs&quot;     
## [3136] &quot;five&quot;       &quot;cents&quot;      &quot;on&quot;         &quot;Mondays&quot;    &quot;A&quot;         
## [3141] &quot;pod&quot;        &quot;is&quot;         &quot;what&quot;       &quot;peas&quot;       &quot;always&quot;    
## [3146] &quot;grow&quot;       &quot;in&quot;         &quot;Jerk&quot;       &quot;the&quot;        &quot;dart&quot;      
## [3151] &quot;from&quot;       &quot;the&quot;        &quot;cork&quot;       &quot;target&quot;     &quot;No&quot;        
## [3156] &quot;cement&quot;     &quot;will&quot;       &quot;hold&quot;       &quot;hard&quot;       &quot;wood&quot;      
## [3161] &quot;We&quot;         &quot;now&quot;        &quot;have&quot;       &quot;a&quot;          &quot;new&quot;       
## [3166] &quot;base&quot;       &quot;for&quot;        &quot;shipping&quot;   &quot;The&quot;        &quot;list&quot;      
## [3171] &quot;of&quot;         &quot;names&quot;      &quot;is&quot;         &quot;carved&quot;     &quot;around&quot;    
## [3176] &quot;the&quot;        &quot;base&quot;       &quot;The&quot;        &quot;sheep&quot;      &quot;were&quot;      
## [3181] &quot;led&quot;        &quot;home&quot;       &quot;by&quot;         &quot;a&quot;          &quot;dog&quot;       
## [3186] &quot;Three&quot;      &quot;for&quot;        &quot;a&quot;          &quot;dime&quot;       &quot;the&quot;       
## [3191] &quot;young&quot;      &quot;peddler&quot;    &quot;cried&quot;      &quot;The&quot;        &quot;sense&quot;     
## [3196] &quot;of&quot;         &quot;smell&quot;      &quot;is&quot;         &quot;better&quot;     &quot;than&quot;      
## [3201] &quot;that&quot;       &quot;of&quot;         &quot;touch&quot;      &quot;No&quot;         &quot;hardship&quot;  
## [3206] &quot;seemed&quot;     &quot;to&quot;         &quot;keep&quot;       &quot;him&quot;        &quot;sad&quot;       
## [3211] &quot;Grace&quot;      &quot;makes&quot;      &quot;up&quot;         &quot;for&quot;        &quot;lack&quot;      
## [3216] &quot;of&quot;         &quot;beauty&quot;     &quot;Nudge&quot;      &quot;gently&quot;     &quot;but&quot;       
## [3221] &quot;wake&quot;       &quot;her&quot;        &quot;now&quot;        &quot;The&quot;        &quot;news&quot;      
## [3226] &quot;struck&quot;     &quot;doubt&quot;      &quot;into&quot;       &quot;restless&quot;   &quot;minds&quot;     
## [3231] &quot;Once&quot;       &quot;we&quot;         &quot;stood&quot;      &quot;beside&quot;     &quot;the&quot;       
## [3236] &quot;shore&quot;      &quot;A&quot;          &quot;chink&quot;      &quot;in&quot;         &quot;the&quot;       
## [3241] &quot;wall&quot;       &quot;allowed&quot;    &quot;a&quot;          &quot;draft&quot;      &quot;to&quot;        
## [3246] &quot;blow&quot;       &quot;Fasten&quot;     &quot;two&quot;        &quot;pins&quot;       &quot;on&quot;        
## [3251] &quot;each&quot;       &quot;side&quot;       &quot;A&quot;          &quot;cold&quot;       &quot;dip&quot;       
## [3256] &quot;restores&quot;   &quot;health&quot;     &quot;and&quot;        &quot;zest&quot;       &quot;He&quot;        
## [3261] &quot;takes&quot;      &quot;the&quot;        &quot;oath&quot;       &quot;of&quot;         &quot;office&quot;    
## [3266] &quot;each&quot;       &quot;March&quot;      &quot;The&quot;        &quot;sand&quot;       &quot;drifts&quot;    
## [3271] &quot;over&quot;       &quot;the&quot;        &quot;sill&quot;       &quot;of&quot;         &quot;the&quot;       
## [3276] &quot;old&quot;        &quot;house&quot;      &quot;The&quot;        &quot;point&quot;      &quot;of&quot;        
## [3281] &quot;the&quot;        &quot;steel&quot;      &quot;pen&quot;        &quot;was&quot;        &quot;bent&quot;      
## [3286] &quot;and&quot;        &quot;twisted&quot;    &quot;There&quot;      &quot;is&quot;         &quot;a&quot;         
## [3291] &quot;lag&quot;        &quot;between&quot;    &quot;thought&quot;    &quot;and&quot;        &quot;act&quot;       
## [3296] &quot;Seed&quot;       &quot;is&quot;         &quot;needed&quot;     &quot;to&quot;         &quot;plant&quot;     
## [3301] &quot;the&quot;        &quot;spring&quot;     &quot;corn&quot;       &quot;Draw&quot;       &quot;the&quot;       
## [3306] &quot;chart&quot;      &quot;with&quot;       &quot;heavy&quot;      &quot;black&quot;      &quot;lines&quot;     
## [3311] &quot;The&quot;        &quot;boy&quot;        &quot;owed&quot;       &quot;his&quot;        &quot;pal&quot;       
## [3316] &quot;thirty&quot;     &quot;cents&quot;      &quot;The&quot;        &quot;chap&quot;       &quot;slipped&quot;   
## [3321] &quot;into&quot;       &quot;the&quot;        &quot;crowd&quot;      &quot;and&quot;        &quot;was&quot;       
## [3326] &quot;lost&quot;       &quot;Hats&quot;       &quot;are&quot;        &quot;worn&quot;       &quot;to&quot;        
## [3331] &quot;tea&quot;        &quot;and&quot;        &quot;not&quot;        &quot;to&quot;         &quot;dinner&quot;    
## [3336] &quot;The&quot;        &quot;ramp&quot;       &quot;led&quot;        &quot;up&quot;         &quot;to&quot;        
## [3341] &quot;the&quot;        &quot;wide&quot;       &quot;highway&quot;    &quot;Beat&quot;       &quot;the&quot;       
## [3346] &quot;dust&quot;       &quot;from&quot;       &quot;the&quot;        &quot;rug&quot;        &quot;onto&quot;      
## [3351] &quot;the&quot;        &quot;lawn&quot;       &quot;Say&quot;        &quot;it&quot;         &quot;slow&quot;      
## [3356] &quot;y&quot;          &quot;but&quot;        &quot;make&quot;       &quot;it&quot;         &quot;ring&quot;      
## [3361] &quot;clear&quot;      &quot;The&quot;        &quot;straw&quot;      &quot;nest&quot;       &quot;housed&quot;    
## [3366] &quot;five&quot;       &quot;robins&quot;     &quot;Screen&quot;     &quot;the&quot;        &quot;porch&quot;     
## [3371] &quot;with&quot;       &quot;woven&quot;      &quot;straw&quot;      &quot;mats&quot;       &quot;This&quot;      
## [3376] &quot;horse&quot;      &quot;will&quot;       &quot;nose&quot;       &quot;his&quot;        &quot;way&quot;       
## [3381] &quot;to&quot;         &quot;the&quot;        &quot;finish&quot;     &quot;The&quot;        &quot;dry&quot;       
## [3386] &quot;wax&quot;        &quot;protects&quot;   &quot;the&quot;        &quot;deep&quot;       &quot;scratch&quot;   
## [3391] &quot;He&quot;         &quot;picked&quot;     &quot;up&quot;         &quot;the&quot;        &quot;dice&quot;      
## [3396] &quot;for&quot;        &quot;a&quot;          &quot;second&quot;     &quot;roll&quot;       &quot;These&quot;     
## [3401] &quot;coins&quot;      &quot;will&quot;       &quot;be&quot;         &quot;needed&quot;     &quot;to&quot;        
## [3406] &quot;pay&quot;        &quot;his&quot;        &quot;debt&quot;       &quot;The&quot;        &quot;nag&quot;       
## [3411] &quot;pulled&quot;     &quot;the&quot;        &quot;frail&quot;      &quot;cart&quot;       &quot;along&quot;     
## [3416] &quot;Twist&quot;      &quot;the&quot;        &quot;valve&quot;      &quot;and&quot;        &quot;release&quot;   
## [3421] &quot;hot&quot;        &quot;steam&quot;      &quot;The&quot;        &quot;vamp&quot;       &quot;of&quot;        
## [3426] &quot;the&quot;        &quot;shoe&quot;       &quot;had&quot;        &quot;a&quot;          &quot;gold&quot;      
## [3431] &quot;buckle&quot;     &quot;The&quot;        &quot;smell&quot;      &quot;of&quot;         &quot;burned&quot;    
## [3436] &quot;rags&quot;       &quot;itches&quot;     &quot;my&quot;         &quot;nose&quot;       &quot;Xew&quot;       
## [3441] &quot;pants&quot;      &quot;lack&quot;       &quot;cuffs&quot;      &quot;and&quot;        &quot;pockets&quot;   
## [3446] &quot;The&quot;        &quot;marsh&quot;      &quot;will&quot;       &quot;freeze&quot;     &quot;when&quot;      
## [3451] &quot;cold&quot;       &quot;enough&quot;     &quot;They&quot;       &quot;slice&quot;      &quot;the&quot;       
## [3456] &quot;sausage&quot;    &quot;thin&quot;       &quot;with&quot;       &quot;a&quot;          &quot;knife&quot;     
## [3461] &quot;The&quot;        &quot;bloom&quot;      &quot;of&quot;         &quot;the&quot;        &quot;rose&quot;      
## [3466] &quot;lasts&quot;      &quot;a&quot;          &quot;few&quot;        &quot;days&quot;       &quot;A&quot;         
## [3471] &quot;gray&quot;       &quot;mare&quot;       &quot;walked&quot;     &quot;before&quot;     &quot;the&quot;       
## [3476] &quot;colt&quot;       &quot;Breakfast&quot;  &quot;buns&quot;       &quot;are&quot;        &quot;fine&quot;      
## [3481] &quot;with&quot;       &quot;a&quot;          &quot;hot&quot;        &quot;drink&quot;      &quot;Bottles&quot;   
## [3486] &quot;hold&quot;       &quot;four&quot;       &quot;kinds&quot;      &quot;of&quot;         &quot;rum&quot;       
## [3491] &quot;The&quot;        &quot;man&quot;        &quot;wore&quot;       &quot;a&quot;          &quot;feather&quot;   
## [3496] &quot;in&quot;         &quot;his&quot;        &quot;felt&quot;       &quot;hat&quot;        &quot;He&quot;        
## [3501] &quot;wheeled&quot;    &quot;the&quot;        &quot;bike&quot;       &quot;past&quot;       &quot;the&quot;       
## [3506] &quot;winding&quot;    &quot;road&quot;       &quot;Drop&quot;       &quot;the&quot;        &quot;ashes&quot;     
## [3511] &quot;on&quot;         &quot;the&quot;        &quot;worn&quot;       &quot;old&quot;        &quot;rug&quot;       
## [3516] &quot;The&quot;        &quot;desk&quot;       &quot;and&quot;        &quot;both&quot;       &quot;chairs&quot;    
## [3521] &quot;were&quot;       &quot;painted&quot;    &quot;tan&quot;        &quot;Throw&quot;      &quot;out&quot;       
## [3526] &quot;the&quot;        &quot;used&quot;       &quot;paper&quot;      &quot;cup&quot;        &quot;and&quot;       
## [3531] &quot;plate&quot;      &quot;A&quot;          &quot;clean&quot;      &quot;neck&quot;       &quot;means&quot;     
## [3536] &quot;a&quot;          &quot;neat&quot;       &quot;collar&quot;     &quot;The&quot;        &quot;couch&quot;     
## [3541] &quot;cover&quot;      &quot;and&quot;        &quot;hall&quot;       &quot;drapes&quot;     &quot;were&quot;      
## [3546] &quot;blue&quot;       &quot;The&quot;        &quot;stems&quot;      &quot;of&quot;         &quot;the&quot;       
## [3551] &quot;tall&quot;       &quot;glasses&quot;    &quot;cracked&quot;    &quot;and&quot;        &quot;broke&quot;     
## [3556] &quot;The&quot;        &quot;wall&quot;       &quot;phone&quot;      &quot;rang&quot;       &quot;loud&quot;      
## [3561] &quot;and&quot;        &quot;often&quot;      &quot;The&quot;        &quot;clothes&quot;    &quot;dried&quot;     
## [3566] &quot;on&quot;         &quot;a&quot;          &quot;thin&quot;       &quot;wooden&quot;     &quot;rack&quot;      
## [3571] &quot;Turn&quot;       &quot;on&quot;         &quot;the&quot;        &quot;lantern&quot;    &quot;which&quot;     
## [3576] &quot;gives&quot;      &quot;us&quot;         &quot;light&quot;      &quot;The&quot;        &quot;cleat&quot;     
## [3581] &quot;sank&quot;       &quot;deeply&quot;     &quot;into&quot;       &quot;the&quot;        &quot;soft&quot;      
## [3586] &quot;turf&quot;       &quot;The&quot;        &quot;bills&quot;      &quot;were&quot;       &quot;mailed&quot;    
## [3591] &quot;promptly&quot;   &quot;on&quot;         &quot;the&quot;        &quot;tenth&quot;      &quot;of&quot;        
## [3596] &quot;the&quot;        &quot;month&quot;      &quot;To&quot;         &quot;have&quot;       &quot;is&quot;        
## [3601] &quot;better&quot;     &quot;than&quot;       &quot;to&quot;         &quot;wait&quot;       &quot;and&quot;       
## [3606] &quot;hope&quot;       &quot;The&quot;        &quot;price&quot;      &quot;is&quot;         &quot;fair&quot;      
## [3611] &quot;for&quot;        &quot;a&quot;          &quot;good&quot;       &quot;antique&quot;    &quot;clock&quot;     
## [3616] &quot;The&quot;        &quot;music&quot;      &quot;played&quot;     &quot;on&quot;         &quot;while&quot;     
## [3621] &quot;they&quot;       &quot;talked&quot;     &quot;Dispense&quot;   &quot;with&quot;       &quot;a&quot;         
## [3626] &quot;vest&quot;       &quot;on&quot;         &quot;a&quot;          &quot;day&quot;        &quot;like&quot;      
## [3631] &quot;this&quot;       &quot;The&quot;        &quot;bunch&quot;      &quot;of&quot;         &quot;grapes&quot;    
## [3636] &quot;was&quot;        &quot;pressed&quot;    &quot;into&quot;       &quot;wine&quot;       &quot;He&quot;        
## [3641] &quot;sent&quot;       &quot;the&quot;        &quot;figs&quot;       &quot;but&quot;        &quot;kept&quot;      
## [3646] &quot;the&quot;        &quot;ripe&quot;       &quot;cherries&quot;   &quot;The&quot;        &quot;hinge&quot;     
## [3651] &quot;on&quot;         &quot;the&quot;        &quot;door&quot;       &quot;creaked&quot;    &quot;with&quot;      
## [3656] &quot;old&quot;        &quot;age&quot;        &quot;The&quot;        &quot;screen&quot;     &quot;before&quot;    
## [3661] &quot;the&quot;        &quot;fire&quot;       &quot;kept&quot;       &quot;in&quot;         &quot;the&quot;       
## [3666] &quot;sparks&quot;     &quot;Fly&quot;        &quot;by&quot;         &quot;night&quot;      &quot;and&quot;       
## [3671] &quot;you&quot;        &quot;waste&quot;      &quot;little&quot;     &quot;time&quot;       &quot;Thick&quot;     
## [3676] &quot;glasses&quot;    &quot;helped&quot;     &quot;him&quot;        &quot;read&quot;       &quot;the&quot;       
## [3681] &quot;print&quot;      &quot;Birth&quot;      &quot;and&quot;        &quot;death&quot;      &quot;mark&quot;      
## [3686] &quot;the&quot;        &quot;limits&quot;     &quot;of&quot;         &quot;life&quot;       &quot;The&quot;       
## [3691] &quot;chair&quot;      &quot;looked&quot;     &quot;strong&quot;     &quot;but&quot;        &quot;had&quot;       
## [3696] &quot;no&quot;         &quot;bottom&quot;     &quot;The&quot;        &quot;kite&quot;       &quot;flew&quot;      
## [3701] &quot;wildly&quot;     &quot;in&quot;         &quot;the&quot;        &quot;high&quot;       &quot;wind&quot;      
## [3706] &quot;A&quot;          &quot;fur&quot;        &quot;muff&quot;       &quot;is&quot;         &quot;stylish&quot;   
## [3711] &quot;once&quot;       &quot;more&quot;       &quot;The&quot;        &quot;tin&quot;        &quot;box&quot;       
## [3716] &quot;held&quot;       &quot;priceless&quot;  &quot;stones&quot;     &quot;We&quot;         &quot;need&quot;      
## [3721] &quot;an&quot;         &quot;end&quot;        &quot;of&quot;         &quot;all&quot;        &quot;such&quot;      
## [3726] &quot;matter&quot;     &quot;The&quot;        &quot;case&quot;       &quot;was&quot;        &quot;puzzling&quot;  
## [3731] &quot;to&quot;         &quot;the&quot;        &quot;old&quot;        &quot;and&quot;        &quot;wise&quot;      
## [3736] &quot;The&quot;        &quot;bright&quot;     &quot;lanterns&quot;   &quot;were&quot;       &quot;gay&quot;       
## [3741] &quot;on&quot;         &quot;the&quot;        &quot;dark&quot;       &quot;lawn&quot;       &quot;We&quot;        
## [3746] &quot;don&#39;t&quot;      &quot;get&quot;        &quot;much&quot;       &quot;money&quot;      &quot;but&quot;       
## [3751] &quot;we&quot;         &quot;have&quot;       &quot;fun&quot;        &quot;The&quot;        &quot;youth&quot;     
## [3756] &quot;drove&quot;      &quot;with&quot;       &quot;zest&quot;       &quot;but&quot;        &quot;little&quot;    
## [3761] &quot;skill&quot;      &quot;Five&quot;       &quot;years&quot;      &quot;he&quot;         &quot;lived&quot;     
## [3766] &quot;with&quot;       &quot;a&quot;          &quot;shaggy&quot;     &quot;dog&quot;        &quot;A&quot;         
## [3771] &quot;fence&quot;      &quot;cuts&quot;       &quot;through&quot;    &quot;the&quot;        &quot;corner&quot;    
## [3776] &quot;lot&quot;        &quot;The&quot;        &quot;way&quot;        &quot;to&quot;         &quot;save&quot;      
## [3781] &quot;money&quot;      &quot;is&quot;         &quot;not&quot;        &quot;to&quot;         &quot;spend&quot;     
## [3786] &quot;much&quot;       &quot;Shut&quot;       &quot;the&quot;        &quot;hatch&quot;      &quot;before&quot;    
## [3791] &quot;the&quot;        &quot;waves&quot;      &quot;push&quot;       &quot;it&quot;         &quot;in&quot;        
## [3796] &quot;The&quot;        &quot;odor&quot;       &quot;of&quot;         &quot;spring&quot;     &quot;makes&quot;     
## [3801] &quot;young&quot;      &quot;hearts&quot;     &quot;jump&quot;       &quot;Crack&quot;      &quot;the&quot;       
## [3806] &quot;walnut&quot;     &quot;with&quot;       &quot;your&quot;       &quot;sharp&quot;      &quot;side&quot;      
## [3811] &quot;teeth&quot;      &quot;He&quot;         &quot;offered&quot;    &quot;proof&quot;      &quot;in&quot;        
## [3816] &quot;the&quot;        &quot;form&quot;       &quot;of&quot;         &quot;a&quot;          &quot;lsrge&quot;     
## [3821] &quot;chart&quot;      &quot;Send&quot;       &quot;the&quot;        &quot;stuff&quot;      &quot;in&quot;        
## [3826] &quot;a&quot;          &quot;thick&quot;      &quot;paper&quot;      &quot;bag&quot;        &quot;A&quot;         
## [3831] &quot;quart&quot;      &quot;of&quot;         &quot;milk&quot;       &quot;is&quot;         &quot;water&quot;     
## [3836] &quot;for&quot;        &quot;the&quot;        &quot;most&quot;       &quot;part&quot;       &quot;They&quot;      
## [3841] &quot;told&quot;       &quot;wild&quot;       &quot;tales&quot;      &quot;to&quot;         &quot;frighten&quot;  
## [3846] &quot;him&quot;        &quot;The&quot;        &quot;three&quot;      &quot;story&quot;      &quot;house&quot;     
## [3851] &quot;was&quot;        &quot;built&quot;      &quot;of&quot;         &quot;stone&quot;      &quot;In&quot;        
## [3856] &quot;the&quot;        &quot;rear&quot;       &quot;of&quot;         &quot;the&quot;        &quot;ground&quot;    
## [3861] &quot;floor&quot;      &quot;was&quot;        &quot;a&quot;          &quot;large&quot;      &quot;passage&quot;   
## [3866] &quot;A&quot;          &quot;man&quot;        &quot;in&quot;         &quot;a&quot;          &quot;blue&quot;      
## [3871] &quot;sweater&quot;    &quot;sat&quot;        &quot;at&quot;         &quot;the&quot;        &quot;desk&quot;      
## [3876] &quot;Oats&quot;       &quot;are&quot;        &quot;a&quot;          &quot;food&quot;       &quot;eaten&quot;     
## [3881] &quot;by&quot;         &quot;horse&quot;      &quot;and&quot;        &quot;man&quot;        &quot;Their&quot;     
## [3886] &quot;eyelids&quot;    &quot;droop&quot;      &quot;for&quot;        &quot;want&quot;       &quot;of&quot;        
## [3891] &quot;sleep&quot;      &quot;The&quot;        &quot;sip&quot;        &quot;of&quot;         &quot;tea&quot;       
## [3896] &quot;revives&quot;    &quot;his&quot;        &quot;tired&quot;      &quot;friend&quot;     &quot;There&quot;     
## [3901] &quot;are&quot;        &quot;many&quot;       &quot;ways&quot;       &quot;to&quot;         &quot;do&quot;        
## [3906] &quot;these&quot;      &quot;things&quot;     &quot;Tuck&quot;       &quot;the&quot;        &quot;sheet&quot;     
## [3911] &quot;under&quot;      &quot;the&quot;        &quot;edge&quot;       &quot;of&quot;         &quot;the&quot;       
## [3916] &quot;mat&quot;        &quot;A&quot;          &quot;force&quot;      &quot;equal&quot;      &quot;to&quot;        
## [3921] &quot;that&quot;       &quot;would&quot;      &quot;move&quot;       &quot;the&quot;        &quot;earth&quot;     
## [3926] &quot;We&quot;         &quot;like&quot;       &quot;to&quot;         &quot;see&quot;        &quot;clear&quot;     
## [3931] &quot;weather&quot;    &quot;The&quot;        &quot;work&quot;       &quot;of&quot;         &quot;the&quot;       
## [3936] &quot;tailor&quot;     &quot;is&quot;         &quot;seen&quot;       &quot;on&quot;         &quot;each&quot;      
## [3941] &quot;side&quot;       &quot;Take&quot;       &quot;a&quot;          &quot;chance&quot;     &quot;and&quot;       
## [3946] &quot;win&quot;        &quot;a&quot;          &quot;china&quot;      &quot;doll&quot;       &quot;Shake&quot;     
## [3951] &quot;the&quot;        &quot;dust&quot;       &quot;from&quot;       &quot;your&quot;       &quot;shoes&quot;     
## [3956] &quot;stranger&quot;   &quot;She&quot;        &quot;was&quot;        &quot;kind&quot;       &quot;to&quot;        
## [3961] &quot;sick&quot;       &quot;old&quot;        &quot;people&quot;     &quot;The&quot;        &quot;dusty&quot;     
## [3966] &quot;bench&quot;      &quot;stood&quot;      &quot;by&quot;         &quot;the&quot;        &quot;stone&quot;     
## [3971] &quot;wall&quot;       &quot;The&quot;        &quot;square&quot;     &quot;wooden&quot;     &quot;crate&quot;     
## [3976] &quot;was&quot;        &quot;packed&quot;     &quot;to&quot;         &quot;be&quot;         &quot;shipped&quot;   
## [3981] &quot;We&quot;         &quot;dress&quot;      &quot;to&quot;         &quot;suit&quot;       &quot;the&quot;       
## [3986] &quot;weather&quot;    &quot;of&quot;         &quot;most&quot;       &quot;days&quot;       &quot;Smile&quot;     
## [3991] &quot;when&quot;       &quot;you&quot;        &quot;say&quot;        &quot;nasty&quot;      &quot;words&quot;     
## [3996] &quot;A&quot;          &quot;bowl&quot;       &quot;of&quot;         &quot;rice&quot;       &quot;is&quot;        
## [4001] &quot;free&quot;       &quot;with&quot;       &quot;chicken&quot;    &quot;stew&quot;       &quot;The&quot;       
## [4006] &quot;water&quot;      &quot;in&quot;         &quot;this&quot;       &quot;well&quot;       &quot;is&quot;        
## [4011] &quot;a&quot;          &quot;source&quot;     &quot;of&quot;         &quot;good&quot;       &quot;health&quot;    
## [4016] &quot;Take&quot;       &quot;shelter&quot;    &quot;in&quot;         &quot;this&quot;       &quot;tent&quot;      
## [4021] &quot;but&quot;        &quot;keep&quot;       &quot;still&quot;      &quot;That&quot;       &quot;guy&quot;       
## [4026] &quot;is&quot;         &quot;the&quot;        &quot;writer&quot;     &quot;of&quot;         &quot;a&quot;         
## [4031] &quot;few&quot;        &quot;banned&quot;     &quot;books&quot;      &quot;The&quot;        &quot;little&quot;    
## [4036] &quot;tales&quot;      &quot;they&quot;       &quot;tell&quot;       &quot;are&quot;        &quot;false&quot;     
## [4041] &quot;The&quot;        &quot;door&quot;       &quot;was&quot;        &quot;barred&quot;     &quot;locked&quot;    
## [4046] &quot;and&quot;        &quot;bolted&quot;     &quot;as&quot;         &quot;well&quot;       &quot;Ripe&quot;      
## [4051] &quot;pears&quot;      &quot;are&quot;        &quot;fit&quot;        &quot;for&quot;        &quot;a&quot;         
## [4056] &quot;queen&#39;s&quot;    &quot;table&quot;      &quot;A&quot;          &quot;big&quot;        &quot;wet&quot;       
## [4061] &quot;stain&quot;      &quot;was&quot;        &quot;on&quot;         &quot;the&quot;        &quot;round&quot;     
## [4066] &quot;carpet&quot;     &quot;The&quot;        &quot;kite&quot;       &quot;dipped&quot;     &quot;and&quot;       
## [4071] &quot;swayed&quot;     &quot;but&quot;        &quot;stayed&quot;     &quot;aloft&quot;      &quot;The&quot;       
## [4076] &quot;pleasant&quot;   &quot;hours&quot;      &quot;fly&quot;        &quot;by&quot;         &quot;much&quot;      
## [4081] &quot;too&quot;        &quot;soon&quot;       &quot;The&quot;        &quot;room&quot;       &quot;was&quot;       
## [4086] &quot;crowded&quot;    &quot;with&quot;       &quot;a&quot;          &quot;wild&quot;       &quot;mob&quot;       
## [4091] &quot;This&quot;       &quot;strong&quot;     &quot;arm&quot;        &quot;shall&quot;      &quot;shield&quot;    
## [4096] &quot;your&quot;       &quot;honor&quot;      &quot;She&quot;        &quot;blushed&quot;    &quot;when&quot;      
## [4101] &quot;he&quot;         &quot;gave&quot;       &quot;her&quot;        &quot;a&quot;          &quot;white&quot;     
## [4106] &quot;orchid&quot;     &quot;The&quot;        &quot;beetle&quot;     &quot;droned&quot;     &quot;in&quot;        
## [4111] &quot;the&quot;        &quot;hot&quot;        &quot;June&quot;       &quot;sun&quot;        &quot;Press&quot;     
## [4116] &quot;the&quot;        &quot;pedal&quot;      &quot;with&quot;       &quot;your&quot;       &quot;left&quot;      
## [4121] &quot;foot&quot;       &quot;Neat&quot;       &quot;plans&quot;      &quot;fail&quot;       &quot;without&quot;   
## [4126] &quot;luck&quot;       &quot;The&quot;        &quot;black&quot;      &quot;trunk&quot;      &quot;fell&quot;      
## [4131] &quot;from&quot;       &quot;the&quot;        &quot;landing&quot;    &quot;The&quot;        &quot;bank&quot;      
## [4136] &quot;pressed&quot;    &quot;for&quot;        &quot;payment&quot;    &quot;of&quot;         &quot;the&quot;       
## [4141] &quot;debt&quot;       &quot;The&quot;        &quot;theft&quot;      &quot;of&quot;         &quot;the&quot;       
## [4146] &quot;pearl&quot;      &quot;pin&quot;        &quot;was&quot;        &quot;kept&quot;       &quot;secret&quot;    
## [4151] &quot;Shake&quot;      &quot;hands&quot;      &quot;with&quot;       &quot;this&quot;       &quot;friendly&quot;  
## [4156] &quot;child&quot;      &quot;The&quot;        &quot;vast&quot;       &quot;space&quot;      &quot;stretched&quot; 
## [4161] &quot;into&quot;       &quot;the&quot;        &quot;far&quot;        &quot;distance&quot;   &quot;A&quot;         
## [4166] &quot;rich&quot;       &quot;farm&quot;       &quot;is&quot;         &quot;rare&quot;       &quot;in&quot;        
## [4171] &quot;this&quot;       &quot;sandy&quot;      &quot;waste&quot;      &quot;His&quot;        &quot;wide&quot;      
## [4176] &quot;grin&quot;       &quot;earned&quot;     &quot;many&quot;       &quot;friends&quot;    &quot;Flax&quot;      
## [4181] &quot;makes&quot;      &quot;a&quot;          &quot;fine&quot;       &quot;brand&quot;      &quot;of&quot;        
## [4186] &quot;paper&quot;      &quot;Hurdle&quot;     &quot;the&quot;        &quot;pit&quot;        &quot;with&quot;      
## [4191] &quot;the&quot;        &quot;aid&quot;        &quot;of&quot;         &quot;a&quot;          &quot;long&quot;      
## [4196] &quot;pole&quot;       &quot;A&quot;          &quot;strong&quot;     &quot;bid&quot;        &quot;may&quot;       
## [4201] &quot;scare&quot;      &quot;your&quot;       &quot;partner&quot;    &quot;stiff&quot;      &quot;Even&quot;      
## [4206] &quot;a&quot;          &quot;just&quot;       &quot;cause&quot;      &quot;needs&quot;      &quot;power&quot;     
## [4211] &quot;to&quot;         &quot;win&quot;        &quot;Peep&quot;       &quot;under&quot;      &quot;the&quot;       
## [4216] &quot;tent&quot;       &quot;and&quot;        &quot;see&quot;        &quot;the&quot;        &quot;clowns&quot;    
## [4221] &quot;The&quot;        &quot;leaf&quot;       &quot;drifts&quot;     &quot;along&quot;      &quot;with&quot;      
## [4226] &quot;a&quot;          &quot;slow&quot;       &quot;spin&quot;       &quot;Cheap&quot;      &quot;clothes&quot;   
## [4231] &quot;are&quot;        &quot;flashy&quot;     &quot;but&quot;        &quot;don&quot;        &quot;t&quot;         
## [4236] &quot;last&quot;       &quot;A&quot;          &quot;thing&quot;      &quot;of&quot;         &quot;small&quot;     
## [4241] &quot;note&quot;       &quot;can&quot;        &quot;cause&quot;      &quot;despair&quot;    &quot;Flood&quot;     
## [4246] &quot;the&quot;        &quot;mails&quot;      &quot;with&quot;       &quot;requests&quot;   &quot;for&quot;       
## [4251] &quot;this&quot;       &quot;book&quot;       &quot;A&quot;          &quot;thick&quot;      &quot;coat&quot;      
## [4256] &quot;of&quot;         &quot;black&quot;      &quot;paint&quot;      &quot;covered&quot;    &quot;all&quot;       
## [4261] &quot;The&quot;        &quot;pencil&quot;     &quot;was&quot;        &quot;cut&quot;        &quot;to&quot;        
## [4266] &quot;be&quot;         &quot;sharp&quot;      &quot;at&quot;         &quot;both&quot;       &quot;ends&quot;      
## [4271] &quot;Those&quot;      &quot;last&quot;       &quot;words&quot;      &quot;were&quot;       &quot;a&quot;         
## [4276] &quot;strong&quot;     &quot;statement&quot;  &quot;He&quot;         &quot;wrote&quot;      &quot;his&quot;       
## [4281] &quot;name&quot;       &quot;boldly&quot;     &quot;at&quot;         &quot;the&quot;        &quot;top&quot;       
## [4286] &quot;of&quot;         &quot;tile&quot;       &quot;sheet&quot;      &quot;Dill&quot;       &quot;pickles&quot;   
## [4291] &quot;are&quot;        &quot;sour&quot;       &quot;but&quot;        &quot;taste&quot;      &quot;fine&quot;      
## [4296] &quot;Down&quot;       &quot;that&quot;       &quot;road&quot;       &quot;is&quot;         &quot;the&quot;       
## [4301] &quot;way&quot;        &quot;to&quot;         &quot;the&quot;        &quot;grain&quot;      &quot;farmer&quot;    
## [4306] &quot;Either&quot;     &quot;mud&quot;        &quot;or&quot;         &quot;dust&quot;       &quot;are&quot;       
## [4311] &quot;found&quot;      &quot;at&quot;         &quot;all&quot;        &quot;times&quot;      &quot;The&quot;       
## [4316] &quot;best&quot;       &quot;method&quot;     &quot;is&quot;         &quot;to&quot;         &quot;fix&quot;       
## [4321] &quot;it&quot;         &quot;in&quot;         &quot;place&quot;      &quot;with&quot;       &quot;clips&quot;     
## [4326] &quot;If&quot;         &quot;you&quot;        &quot;mumble&quot;     &quot;your&quot;       &quot;speech&quot;    
## [4331] &quot;will&quot;       &quot;be&quot;         &quot;lost&quot;       &quot;At&quot;         &quot;night&quot;     
## [4336] &quot;the&quot;        &quot;alarm&quot;      &quot;roused&quot;     &quot;him&quot;        &quot;from&quot;      
## [4341] &quot;a&quot;          &quot;deep&quot;       &quot;sleep&quot;      &quot;Read&quot;       &quot;just&quot;      
## [4346] &quot;what&quot;       &quot;the&quot;        &quot;meter&quot;      &quot;says&quot;       &quot;Fill&quot;      
## [4351] &quot;your&quot;       &quot;pack&quot;       &quot;with&quot;       &quot;bright&quot;     &quot;trinkets&quot;  
## [4356] &quot;for&quot;        &quot;the&quot;        &quot;poor&quot;       &quot;The&quot;        &quot;small&quot;     
## [4361] &quot;red&quot;        &quot;neon&quot;       &quot;lamp&quot;       &quot;went&quot;       &quot;out&quot;       
## [4366] &quot;Clams&quot;      &quot;are&quot;        &quot;small&quot;      &quot;round&quot;      &quot;soft&quot;      
## [4371] &quot;and&quot;        &quot;tasty&quot;      &quot;The&quot;        &quot;fan&quot;        &quot;whirled&quot;   
## [4376] &quot;its&quot;        &quot;round&quot;      &quot;blades&quot;     &quot;softly&quot;     &quot;The&quot;       
## [4381] &quot;line&quot;       &quot;where&quot;      &quot;the&quot;        &quot;edges&quot;      &quot;join&quot;      
## [4386] &quot;was&quot;        &quot;clean&quot;      &quot;Breathe&quot;    &quot;deep&quot;       &quot;and&quot;       
## [4391] &quot;smell&quot;      &quot;the&quot;        &quot;piny&quot;       &quot;air&quot;        &quot;It&quot;        
## [4396] &quot;matters&quot;    &quot;not&quot;        &quot;if&quot;         &quot;he&quot;         &quot;reads&quot;     
## [4401] &quot;these&quot;      &quot;words&quot;      &quot;or&quot;         &quot;those&quot;      &quot;A&quot;         
## [4406] &quot;brown&quot;      &quot;leather&quot;    &quot;bag&quot;        &quot;hung&quot;       &quot;from&quot;      
## [4411] &quot;its&quot;        &quot;strap&quot;      &quot;A&quot;          &quot;toad&quot;       &quot;and&quot;       
## [4416] &quot;a&quot;          &quot;frog&quot;       &quot;are&quot;        &quot;hard&quot;       &quot;to&quot;        
## [4421] &quot;tell&quot;       &quot;apart&quot;      &quot;A&quot;          &quot;white&quot;      &quot;silk&quot;      
## [4426] &quot;jacket&quot;     &quot;goes&quot;       &quot;with&quot;       &quot;any&quot;        &quot;shoes&quot;     
## [4431] &quot;A&quot;          &quot;break&quot;      &quot;in&quot;         &quot;the&quot;        &quot;dam&quot;       
## [4436] &quot;almost&quot;     &quot;caused&quot;     &quot;a&quot;          &quot;flood&quot;      &quot;Paint&quot;     
## [4441] &quot;the&quot;        &quot;sockets&quot;    &quot;in&quot;         &quot;the&quot;        &quot;wall&quot;      
## [4446] &quot;dull&quot;       &quot;green&quot;      &quot;The&quot;        &quot;child&quot;      &quot;crawled&quot;   
## [4451] &quot;into&quot;       &quot;the&quot;        &quot;dense&quot;      &quot;grass&quot;      &quot;Bribes&quot;    
## [4456] &quot;fail&quot;       &quot;where&quot;      &quot;honest&quot;     &quot;men&quot;        &quot;work&quot;      
## [4461] &quot;Trample&quot;    &quot;the&quot;        &quot;spark&quot;      &quot;else&quot;       &quot;the&quot;       
## [4466] &quot;flames&quot;     &quot;will&quot;       &quot;spread&quot;     &quot;The&quot;        &quot;hilt&quot;      
## [4471] &quot;of&quot;         &quot;the&quot;        &quot;sword&quot;      &quot;was&quot;        &quot;carved&quot;    
## [4476] &quot;with&quot;       &quot;fine&quot;       &quot;designs&quot;    &quot;A&quot;          &quot;round&quot;     
## [4481] &quot;hole&quot;       &quot;was&quot;        &quot;drilled&quot;    &quot;through&quot;    &quot;the&quot;       
## [4486] &quot;thin&quot;       &quot;board&quot;      &quot;Footprints&quot; &quot;showed&quot;     &quot;the&quot;       
## [4491] &quot;path&quot;       &quot;he&quot;         &quot;took&quot;       &quot;up&quot;         &quot;the&quot;       
## [4496] &quot;beach&quot;      &quot;She&quot;        &quot;was&quot;        &quot;waiting&quot;    &quot;at&quot;        
## [4501] &quot;my&quot;         &quot;front&quot;      &quot;lawn&quot;       &quot;A&quot;          &quot;vent&quot;      
## [4506] &quot;near&quot;       &quot;the&quot;        &quot;edge&quot;       &quot;brought&quot;    &quot;in&quot;        
## [4511] &quot;fresh&quot;      &quot;air&quot;        &quot;Prod&quot;       &quot;the&quot;        &quot;old&quot;       
## [4516] &quot;mule&quot;       &quot;with&quot;       &quot;a&quot;          &quot;crooked&quot;    &quot;stick&quot;     
## [4521] &quot;It&quot;         &quot;is&quot;         &quot;a&quot;          &quot;band&quot;       &quot;of&quot;        
## [4526] &quot;steel&quot;      &quot;three&quot;      &quot;inches&quot;     &quot;wide&quot;       &quot;The&quot;       
## [4531] &quot;pipe&quot;       &quot;ran&quot;        &quot;almost&quot;     &quot;the&quot;        &quot;length&quot;    
## [4536] &quot;of&quot;         &quot;the&quot;        &quot;ditch&quot;      &quot;It&quot;         &quot;was&quot;       
## [4541] &quot;hidden&quot;     &quot;from&quot;       &quot;sight&quot;      &quot;by&quot;         &quot;a&quot;         
## [4546] &quot;mass&quot;       &quot;of&quot;         &quot;leaves&quot;     &quot;and&quot;        &quot;shrubs&quot;    
## [4551] &quot;The&quot;        &quot;weight&quot;     &quot;of&quot;         &quot;the&quot;        &quot;package&quot;   
## [4556] &quot;was&quot;        &quot;seen&quot;       &quot;on&quot;         &quot;the&quot;        &quot;high&quot;      
## [4561] &quot;scale&quot;      &quot;Wake&quot;       &quot;and&quot;        &quot;rise&quot;       &quot;and&quot;       
## [4566] &quot;step&quot;       &quot;into&quot;       &quot;the&quot;        &quot;green&quot;      &quot;outdoors&quot;  
## [4571] &quot;The&quot;        &quot;green&quot;      &quot;light&quot;      &quot;in&quot;         &quot;the&quot;       
## [4576] &quot;brown&quot;      &quot;box&quot;        &quot;flickered&quot;  &quot;The&quot;        &quot;brass&quot;     
## [4581] &quot;tube&quot;       &quot;circled&quot;    &quot;the&quot;        &quot;high&quot;       &quot;wall&quot;      
## [4586] &quot;The&quot;        &quot;lobes&quot;      &quot;of&quot;         &quot;her&quot;        &quot;ears&quot;      
## [4591] &quot;were&quot;       &quot;pierced&quot;    &quot;to&quot;         &quot;hold&quot;       &quot;rings&quot;     
## [4596] &quot;Hold&quot;       &quot;the&quot;        &quot;hammer&quot;     &quot;near&quot;       &quot;the&quot;       
## [4601] &quot;end&quot;        &quot;to&quot;         &quot;drive&quot;      &quot;the&quot;        &quot;nail&quot;      
## [4606] &quot;Next&quot;       &quot;Sunday&quot;     &quot;is&quot;         &quot;the&quot;        &quot;twelfth&quot;   
## [4611] &quot;of&quot;         &quot;the&quot;        &quot;month&quot;      &quot;Every&quot;      &quot;word&quot;      
## [4616] &quot;and&quot;        &quot;phrase&quot;     &quot;he&quot;         &quot;speaks&quot;     &quot;is&quot;        
## [4621] &quot;true&quot;       &quot;He&quot;         &quot;put&quot;        &quot;his&quot;        &quot;last&quot;      
## [4626] &quot;cartridge&quot;  &quot;into&quot;       &quot;the&quot;        &quot;gun&quot;        &quot;and&quot;       
## [4631] &quot;fired&quot;      &quot;They&quot;       &quot;took&quot;       &quot;their&quot;      &quot;kids&quot;      
## [4636] &quot;from&quot;       &quot;the&quot;        &quot;public&quot;     &quot;school&quot;     &quot;Drive&quot;     
## [4641] &quot;the&quot;        &quot;screw&quot;      &quot;straight&quot;   &quot;into&quot;       &quot;the&quot;       
## [4646] &quot;wood&quot;       &quot;Keep&quot;       &quot;the&quot;        &quot;hatch&quot;      &quot;tight&quot;     
## [4651] &quot;and&quot;        &quot;the&quot;        &quot;watch&quot;      &quot;constant&quot;   &quot;Sever&quot;     
## [4656] &quot;the&quot;        &quot;twine&quot;      &quot;with&quot;       &quot;a&quot;          &quot;quick&quot;     
## [4661] &quot;snip&quot;       &quot;of&quot;         &quot;the&quot;        &quot;knife&quot;      &quot;Paper&quot;     
## [4666] &quot;will&quot;       &quot;dry&quot;        &quot;out&quot;        &quot;when&quot;       &quot;wet&quot;       
## [4671] &quot;Slide&quot;      &quot;the&quot;        &quot;catch&quot;      &quot;back&quot;       &quot;and&quot;       
## [4676] &quot;open&quot;       &quot;the&quot;        &quot;desk&quot;       &quot;Help&quot;       &quot;the&quot;       
## [4681] &quot;weak&quot;       &quot;to&quot;         &quot;preserve&quot;   &quot;their&quot;      &quot;strength&quot;  
## [4686] &quot;A&quot;          &quot;sullen&quot;     &quot;smile&quot;      &quot;gets&quot;       &quot;few&quot;       
## [4691] &quot;friends&quot;    &quot;Stop&quot;       &quot;whistling&quot;  &quot;and&quot;        &quot;watch&quot;     
## [4696] &quot;the&quot;        &quot;boys&quot;       &quot;march&quot;      &quot;Jerk&quot;       &quot;the&quot;       
## [4701] &quot;cord&quot;       &quot;and&quot;        &quot;out&quot;        &quot;tumbles&quot;    &quot;the&quot;       
## [4706] &quot;gold&quot;       &quot;Slidc&quot;      &quot;the&quot;        &quot;tray&quot;       &quot;across&quot;    
## [4711] &quot;the&quot;        &quot;glass&quot;      &quot;top&quot;        &quot;The&quot;        &quot;cloud&quot;     
## [4716] &quot;moved&quot;      &quot;in&quot;         &quot;a&quot;          &quot;stately&quot;    &quot;way&quot;       
## [4721] &quot;and&quot;        &quot;was&quot;        &quot;gone&quot;       &quot;Light&quot;      &quot;maple&quot;     
## [4726] &quot;makes&quot;      &quot;for&quot;        &quot;a&quot;          &quot;swell&quot;      &quot;room&quot;      
## [4731] &quot;Set&quot;        &quot;the&quot;        &quot;piece&quot;      &quot;here&quot;       &quot;and&quot;       
## [4736] &quot;say&quot;        &quot;nothing&quot;    &quot;Dull&quot;       &quot;stories&quot;    &quot;make&quot;      
## [4741] &quot;her&quot;        &quot;laugh&quot;      &quot;A&quot;          &quot;stiff&quot;      &quot;cord&quot;      
## [4746] &quot;will&quot;       &quot;do&quot;         &quot;to&quot;         &quot;fasten&quot;     &quot;your&quot;      
## [4751] &quot;shoe&quot;       &quot;Get&quot;        &quot;the&quot;        &quot;trust&quot;      &quot;fund&quot;      
## [4756] &quot;to&quot;         &quot;the&quot;        &quot;bank&quot;       &quot;early&quot;      &quot;Choose&quot;    
## [4761] &quot;between&quot;    &quot;the&quot;        &quot;high&quot;       &quot;road&quot;       &quot;and&quot;       
## [4766] &quot;the&quot;        &quot;low&quot;        &quot;A&quot;          &quot;plea&quot;       &quot;for&quot;       
## [4771] &quot;funds&quot;      &quot;seems&quot;      &quot;to&quot;         &quot;come&quot;       &quot;again&quot;     
## [4776] &quot;He&quot;         &quot;lent&quot;       &quot;his&quot;        &quot;coat&quot;       &quot;to&quot;        
## [4781] &quot;the&quot;        &quot;tall&quot;       &quot;gaunt&quot;      &quot;stranger&quot;   &quot;There&quot;     
## [4786] &quot;is&quot;         &quot;a&quot;          &quot;strong&quot;     &quot;chance&quot;     &quot;it&quot;        
## [4791] &quot;will&quot;       &quot;happen&quot;     &quot;once&quot;       &quot;more&quot;       &quot;The&quot;       
## [4796] &quot;duke&quot;       &quot;left&quot;       &quot;the&quot;        &quot;park&quot;       &quot;in&quot;        
## [4801] &quot;a&quot;          &quot;silver&quot;     &quot;coach&quot;      &quot;Greet&quot;      &quot;the&quot;       
## [4806] &quot;new&quot;        &quot;guests&quot;     &quot;and&quot;        &quot;leave&quot;      &quot;quickly&quot;   
## [4811] &quot;When&quot;       &quot;the&quot;        &quot;frost&quot;      &quot;has&quot;        &quot;come&quot;      
## [4816] &quot;it&quot;         &quot;is&quot;         &quot;time&quot;       &quot;for&quot;        &quot;turkey&quot;    
## [4821] &quot;Sweet&quot;      &quot;words&quot;      &quot;work&quot;       &quot;better&quot;     &quot;than&quot;      
## [4826] &quot;fierce&quot;     &quot;A&quot;          &quot;thin&quot;       &quot;stripe&quot;     &quot;runs&quot;      
## [4831] &quot;down&quot;       &quot;the&quot;        &quot;middle&quot;     &quot;A&quot;          &quot;six&quot;       
## [4836] &quot;comes&quot;      &quot;up&quot;         &quot;more&quot;       &quot;often&quot;      &quot;than&quot;      
## [4841] &quot;a&quot;          &quot;ten&quot;        &quot;Lush&quot;       &quot;fern&quot;       &quot;grow&quot;      
## [4846] &quot;on&quot;         &quot;the&quot;        &quot;lofty&quot;      &quot;rocks&quot;      &quot;The&quot;       
## [4851] &quot;ram&quot;        &quot;scared&quot;     &quot;the&quot;        &quot;school&quot;     &quot;children&quot;  
## [4856] &quot;off&quot;        &quot;The&quot;        &quot;team&quot;       &quot;with&quot;       &quot;the&quot;       
## [4861] &quot;best&quot;       &quot;timing&quot;     &quot;looks&quot;      &quot;good&quot;       &quot;The&quot;       
## [4866] &quot;farmer&quot;     &quot;swapped&quot;    &quot;his&quot;        &quot;horse&quot;      &quot;for&quot;       
## [4871] &quot;a&quot;          &quot;brown&quot;      &quot;ox&quot;         &quot;Sit&quot;        &quot;on&quot;        
## [4876] &quot;the&quot;        &quot;perch&quot;      &quot;and&quot;        &quot;tell&quot;       &quot;the&quot;       
## [4881] &quot;others&quot;     &quot;what&quot;       &quot;to&quot;         &quot;do&quot;         &quot;A&quot;         
## [4886] &quot;steep&quot;      &quot;trail&quot;      &quot;is&quot;         &quot;painful&quot;    &quot;for&quot;       
## [4891] &quot;our&quot;        &quot;feet&quot;       &quot;The&quot;        &quot;early&quot;      &quot;phase&quot;     
## [4896] &quot;of&quot;         &quot;life&quot;       &quot;moves&quot;      &quot;fast&quot;       &quot;Green&quot;     
## [4901] &quot;moss&quot;       &quot;grows&quot;      &quot;on&quot;         &quot;the&quot;        &quot;northern&quot;  
## [4906] &quot;side&quot;       &quot;Tea&quot;        &quot;in&quot;         &quot;thin&quot;       &quot;china&quot;     
## [4911] &quot;has&quot;        &quot;a&quot;          &quot;sweet&quot;      &quot;taste&quot;      &quot;Pitch&quot;     
## [4916] &quot;the&quot;        &quot;straw&quot;      &quot;through&quot;    &quot;the&quot;        &quot;door&quot;      
## [4921] &quot;of&quot;         &quot;the&quot;        &quot;stable&quot;     &quot;The&quot;        &quot;latch&quot;     
## [4926] &quot;on&quot;         &quot;the&quot;        &quot;beck&quot;       &quot;gate&quot;       &quot;needed&quot;    
## [4931] &quot;a&quot;          &quot;nail&quot;       &quot;The&quot;        &quot;goose&quot;      &quot;was&quot;       
## [4936] &quot;brought&quot;    &quot;straight&quot;   &quot;from&quot;       &quot;the&quot;        &quot;old&quot;       
## [4941] &quot;market&quot;     &quot;The&quot;        &quot;sink&quot;       &quot;is&quot;         &quot;the&quot;       
## [4946] &quot;thing&quot;      &quot;in&quot;         &quot;which&quot;      &quot;we&quot;         &quot;pile&quot;      
## [4951] &quot;dishes&quot;     &quot;A&quot;          &quot;whiff&quot;      &quot;of&quot;         &quot;it&quot;        
## [4956] &quot;will&quot;       &quot;cure&quot;       &quot;the&quot;        &quot;most&quot;       &quot;stubborn&quot;  
## [4961] &quot;cold&quot;       &quot;The&quot;        &quot;facts&quot;      &quot;don&quot;        &quot;t&quot;         
## [4966] &quot;always&quot;     &quot;show&quot;       &quot;who&quot;        &quot;is&quot;         &quot;right&quot;     
## [4971] &quot;She&quot;        &quot;flaps&quot;      &quot;her&quot;        &quot;cape&quot;       &quot;as&quot;        
## [4976] &quot;she&quot;        &quot;parades&quot;    &quot;the&quot;        &quot;street&quot;     &quot;The&quot;       
## [4981] &quot;loss&quot;       &quot;of&quot;         &quot;the&quot;        &quot;cruiser&quot;    &quot;was&quot;       
## [4986] &quot;a&quot;          &quot;blow&quot;       &quot;to&quot;         &quot;the&quot;        &quot;fleet&quot;     
## [4991] &quot;Loop&quot;       &quot;the&quot;        &quot;braid&quot;      &quot;to&quot;         &quot;the&quot;       
## [4996] &quot;left&quot;       &quot;and&quot;        &quot;then&quot;       &quot;over&quot;       &quot;Plead&quot;     
## [5001] &quot;with&quot;       &quot;the&quot;        &quot;lawyer&quot;     &quot;to&quot;         &quot;drop&quot;      
## [5006] &quot;the&quot;        &quot;lost&quot;       &quot;cause&quot;      &quot;Calves&quot;     &quot;thrive&quot;    
## [5011] &quot;on&quot;         &quot;tender&quot;     &quot;spring&quot;     &quot;grass&quot;      &quot;Post&quot;      
## [5016] &quot;no&quot;         &quot;bills&quot;      &quot;on&quot;         &quot;this&quot;       &quot;office&quot;    
## [5021] &quot;wall&quot;       &quot;Tear&quot;       &quot;a&quot;          &quot;thin&quot;       &quot;sheet&quot;     
## [5026] &quot;from&quot;       &quot;the&quot;        &quot;yellow&quot;     &quot;pad&quot;        &quot;A&quot;         
## [5031] &quot;cruise&quot;     &quot;in&quot;         &quot;warm&quot;       &quot;waters&quot;     &quot;in&quot;        
## [5036] &quot;a&quot;          &quot;sleek&quot;      &quot;yacht&quot;      &quot;is&quot;         &quot;fun&quot;       
## [5041] &quot;A&quot;          &quot;streak&quot;     &quot;of&quot;         &quot;color&quot;      &quot;ran&quot;       
## [5046] &quot;down&quot;       &quot;the&quot;        &quot;left&quot;       &quot;edge&quot;       &quot;It&quot;        
## [5051] &quot;was&quot;        &quot;done&quot;       &quot;before&quot;     &quot;the&quot;        &quot;boy&quot;       
## [5056] &quot;could&quot;      &quot;see&quot;        &quot;it&quot;         &quot;Crouch&quot;     &quot;before&quot;    
## [5061] &quot;you&quot;        &quot;jump&quot;       &quot;or&quot;         &quot;miss&quot;       &quot;the&quot;       
## [5066] &quot;mark&quot;       &quot;Pack&quot;       &quot;the&quot;        &quot;kits&quot;       &quot;and&quot;       
## [5071] &quot;don&quot;        &quot;t&quot;          &quot;forget&quot;     &quot;the&quot;        &quot;salt&quot;      
## [5076] &quot;The&quot;        &quot;square&quot;     &quot;peg&quot;        &quot;will&quot;       &quot;settle&quot;    
## [5081] &quot;in&quot;         &quot;the&quot;        &quot;round&quot;      &quot;hole&quot;       &quot;Fine&quot;      
## [5086] &quot;soap&quot;       &quot;saves&quot;      &quot;tender&quot;     &quot;skin&quot;       &quot;Poached&quot;   
## [5091] &quot;eggs&quot;       &quot;and&quot;        &quot;tea&quot;        &quot;must&quot;       &quot;suffice&quot;   
## [5096] &quot;Bad&quot;        &quot;nerves&quot;     &quot;are&quot;        &quot;jangled&quot;    &quot;by&quot;        
## [5101] &quot;a&quot;          &quot;door&quot;       &quot;slam&quot;       &quot;Ship&quot;       &quot;maps&quot;      
## [5106] &quot;are&quot;        &quot;different&quot;  &quot;from&quot;       &quot;those&quot;      &quot;for&quot;       
## [5111] &quot;planes&quot;     &quot;Dimes&quot;      &quot;showered&quot;   &quot;down&quot;       &quot;from&quot;      
## [5116] &quot;all&quot;        &quot;sides&quot;      &quot;They&quot;       &quot;sang&quot;       &quot;the&quot;       
## [5121] &quot;same&quot;       &quot;tunes&quot;      &quot;at&quot;         &quot;each&quot;       &quot;party&quot;     
## [5126] &quot;The&quot;        &quot;sky&quot;        &quot;in&quot;         &quot;the&quot;        &quot;west&quot;      
## [5131] &quot;is&quot;         &quot;tinged&quot;     &quot;with&quot;       &quot;orange&quot;     &quot;red&quot;       
## [5136] &quot;The&quot;        &quot;pods&quot;       &quot;of&quot;         &quot;peas&quot;       &quot;ferment&quot;   
## [5141] &quot;in&quot;         &quot;bare&quot;       &quot;fields&quot;     &quot;The&quot;        &quot;horse&quot;     
## [5146] &quot;balked&quot;     &quot;and&quot;        &quot;threw&quot;      &quot;the&quot;        &quot;tall&quot;      
## [5151] &quot;rider&quot;      &quot;The&quot;        &quot;hitch&quot;      &quot;between&quot;    &quot;the&quot;       
## [5156] &quot;horse&quot;      &quot;and&quot;        &quot;cart&quot;       &quot;broke&quot;      &quot;Pile&quot;      
## [5161] &quot;the&quot;        &quot;coal&quot;       &quot;high&quot;       &quot;in&quot;         &quot;the&quot;       
## [5166] &quot;shed&quot;       &quot;corner&quot;     &quot;The&quot;        &quot;gold&quot;       &quot;vase&quot;      
## [5171] &quot;is&quot;         &quot;both&quot;       &quot;rare&quot;       &quot;and&quot;        &quot;costly&quot;    
## [5176] &quot;The&quot;        &quot;knife&quot;      &quot;was&quot;        &quot;hung&quot;       &quot;inside&quot;    
## [5181] &quot;its&quot;        &quot;bright&quot;     &quot;sheath&quot;     &quot;The&quot;        &quot;rarest&quot;    
## [5186] &quot;spice&quot;      &quot;comes&quot;      &quot;from&quot;       &quot;the&quot;        &quot;far&quot;       
## [5191] &quot;East&quot;       &quot;The&quot;        &quot;roof&quot;       &quot;should&quot;     &quot;be&quot;        
## [5196] &quot;tilted&quot;     &quot;at&quot;         &quot;a&quot;          &quot;sharp&quot;      &quot;slant&quot;     
## [5201] &quot;A&quot;          &quot;smatter&quot;    &quot;of&quot;         &quot;French&quot;     &quot;is&quot;        
## [5206] &quot;worse&quot;      &quot;than&quot;       &quot;none&quot;       &quot;The&quot;        &quot;mule&quot;      
## [5211] &quot;trod&quot;       &quot;the&quot;        &quot;treadmill&quot;  &quot;day&quot;        &quot;and&quot;       
## [5216] &quot;night&quot;      &quot;The&quot;        &quot;aim&quot;        &quot;of&quot;         &quot;the&quot;       
## [5221] &quot;contest&quot;    &quot;is&quot;         &quot;to&quot;         &quot;raise&quot;      &quot;a&quot;         
## [5226] &quot;great&quot;      &quot;fund&quot;       &quot;To&quot;         &quot;send&quot;       &quot;it&quot;        
## [5231] &quot;now&quot;        &quot;in&quot;         &quot;large&quot;      &quot;amounts&quot;    &quot;is&quot;        
## [5236] &quot;bad&quot;        &quot;There&quot;      &quot;is&quot;         &quot;a&quot;          &quot;fine&quot;      
## [5241] &quot;hard&quot;       &quot;tang&quot;       &quot;in&quot;         &quot;salty&quot;      &quot;air&quot;       
## [5246] &quot;Cod&quot;        &quot;is&quot;         &quot;the&quot;        &quot;main&quot;       &quot;business&quot;  
## [5251] &quot;of&quot;         &quot;the&quot;        &quot;north&quot;      &quot;shore&quot;      &quot;The&quot;       
## [5256] &quot;slab&quot;       &quot;was&quot;        &quot;hewn&quot;       &quot;from&quot;       &quot;heavy&quot;     
## [5261] &quot;blocks&quot;     &quot;of&quot;         &quot;slat&quot;       &quot;e&quot;          &quot;Dunk&quot;      
## [5266] &quot;the&quot;        &quot;stale&quot;      &quot;biscuits&quot;   &quot;into&quot;       &quot;strong&quot;    
## [5271] &quot;drink&quot;      &quot;Hang&quot;       &quot;tinsel&quot;     &quot;from&quot;       &quot;both&quot;      
## [5276] &quot;branches&quot;   &quot;Cap&quot;        &quot;the&quot;        &quot;jar&quot;        &quot;with&quot;      
## [5281] &quot;a&quot;          &quot;tight&quot;      &quot;brass&quot;      &quot;cover&quot;      &quot;The&quot;       
## [5286] &quot;poor&quot;       &quot;boy&quot;        &quot;missed&quot;     &quot;the&quot;        &quot;boat&quot;      
## [5291] &quot;again&quot;      &quot;Be&quot;         &quot;sure&quot;       &quot;to&quot;         &quot;set&quot;       
## [5296] &quot;the&quot;        &quot;lamp&quot;       &quot;firmly&quot;     &quot;in&quot;         &quot;the&quot;       
## [5301] &quot;hole&quot;       &quot;Pick&quot;       &quot;a&quot;          &quot;card&quot;       &quot;and&quot;       
## [5306] &quot;slip&quot;       &quot;it&quot;         &quot;under&quot;      &quot;the&quot;        &quot;pack&quot;      
## [5311] &quot;A&quot;          &quot;round&quot;      &quot;mat&quot;        &quot;will&quot;       &quot;cover&quot;     
## [5316] &quot;the&quot;        &quot;dull&quot;       &quot;spot&quot;       &quot;The&quot;        &quot;first&quot;     
## [5321] &quot;part&quot;       &quot;of&quot;         &quot;the&quot;        &quot;plan&quot;       &quot;needs&quot;     
## [5326] &quot;changing&quot;   &quot;The&quot;        &quot;good&quot;       &quot;book&quot;       &quot;informs&quot;   
## [5331] &quot;of&quot;         &quot;what&quot;       &quot;we&quot;         &quot;ought&quot;      &quot;to&quot;        
## [5336] &quot;know&quot;       &quot;The&quot;        &quot;mail&quot;       &quot;comes&quot;      &quot;in&quot;        
## [5341] &quot;three&quot;      &quot;batches&quot;    &quot;per&quot;        &quot;day&quot;        &quot;You&quot;       
## [5346] &quot;cannot&quot;     &quot;brew&quot;       &quot;tea&quot;        &quot;in&quot;         &quot;a&quot;         
## [5351] &quot;cold&quot;       &quot;pot&quot;        &quot;Dots&quot;       &quot;of&quot;         &quot;light&quot;     
## [5356] &quot;betrayed&quot;   &quot;the&quot;        &quot;black&quot;      &quot;cat&quot;        &quot;Put&quot;       
## [5361] &quot;the&quot;        &quot;chart&quot;      &quot;on&quot;         &quot;the&quot;        &quot;mantel&quot;    
## [5366] &quot;and&quot;        &quot;tack&quot;       &quot;it&quot;         &quot;down&quot;       &quot;The&quot;       
## [5371] &quot;night&quot;      &quot;shift&quot;      &quot;men&quot;        &quot;rate&quot;       &quot;extra&quot;     
## [5376] &quot;pay&quot;        &quot;The&quot;        &quot;red&quot;        &quot;paper&quot;      &quot;brightened&quot;
## [5381] &quot;the&quot;        &quot;dim&quot;        &quot;stage&quot;      &quot;See&quot;        &quot;the&quot;       
## [5386] &quot;player&quot;     &quot;scoot&quot;      &quot;to&quot;         &quot;third&quot;      &quot;base&quot;      
## [5391] &quot;Slide&quot;      &quot;the&quot;        &quot;bill&quot;       &quot;between&quot;    &quot;the&quot;       
## [5396] &quot;two&quot;        &quot;leaves&quot;     &quot;Many&quot;       &quot;hands&quot;      &quot;help&quot;      
## [5401] &quot;get&quot;        &quot;the&quot;        &quot;job&quot;        &quot;done&quot;       &quot;We&quot;        
## [5406] &quot;don&#39;t&quot;      &quot;like&quot;       &quot;to&quot;         &quot;admit&quot;      &quot;our&quot;       
## [5411] &quot;small&quot;      &quot;faults&quot;     &quot;No&quot;         &quot;doubt&quot;      &quot;about&quot;     
## [5416] &quot;the&quot;        &quot;way&quot;        &quot;the&quot;        &quot;wind&quot;       &quot;blows&quot;     
## [5421] &quot;Dig&quot;        &quot;deep&quot;       &quot;in&quot;         &quot;the&quot;        &quot;earth&quot;     
## [5426] &quot;for&quot;        &quot;pirate&#39;s&quot;   &quot;gold&quot;       &quot;The&quot;        &quot;steady&quot;    
## [5431] &quot;drip&quot;       &quot;is&quot;         &quot;worse&quot;      &quot;than&quot;       &quot;a&quot;         
## [5436] &quot;drenching&quot;  &quot;rain&quot;       &quot;A&quot;          &quot;flat&quot;       &quot;pack&quot;      
## [5441] &quot;takes&quot;      &quot;less&quot;       &quot;luggage&quot;    &quot;space&quot;      &quot;Green&quot;     
## [5446] &quot;ice&quot;        &quot;frosted&quot;    &quot;the&quot;        &quot;punch&quot;      &quot;bowl&quot;      
## [5451] &quot;A&quot;          &quot;stuffed&quot;    &quot;chair&quot;      &quot;slipped&quot;    &quot;from&quot;      
## [5456] &quot;the&quot;        &quot;moving&quot;     &quot;van&quot;        &quot;The&quot;        &quot;stitch&quot;    
## [5461] &quot;will&quot;       &quot;serve&quot;      &quot;but&quot;        &quot;needs&quot;      &quot;to&quot;        
## [5466] &quot;be&quot;         &quot;shortened&quot;  &quot;A&quot;          &quot;thin&quot;       &quot;book&quot;      
## [5471] &quot;fits&quot;       &quot;in&quot;         &quot;the&quot;        &quot;side&quot;       &quot;pocket&quot;    
## [5476] &quot;The&quot;        &quot;gloss&quot;      &quot;on&quot;         &quot;top&quot;        &quot;made&quot;      
## [5481] &quot;it&quot;         &quot;unfit&quot;      &quot;to&quot;         &quot;read&quot;       &quot;The&quot;       
## [5486] &quot;hail&quot;       &quot;pattered&quot;   &quot;on&quot;         &quot;the&quot;        &quot;burnt&quot;     
## [5491] &quot;brown&quot;      &quot;grass&quot;      &quot;Seven&quot;      &quot;seals&quot;      &quot;were&quot;      
## [5496] &quot;stamped&quot;    &quot;on&quot;         &quot;great&quot;      &quot;sheets&quot;     &quot;Our&quot;       
## [5501] &quot;troops&quot;     &quot;are&quot;        &quot;set&quot;        &quot;to&quot;         &quot;strike&quot;    
## [5506] &quot;heavy&quot;      &quot;blows&quot;      &quot;The&quot;        &quot;store&quot;      &quot;was&quot;       
## [5511] &quot;jammed&quot;     &quot;before&quot;     &quot;the&quot;        &quot;sale&quot;       &quot;could&quot;     
## [5516] &quot;start&quot;      &quot;It&quot;         &quot;was&quot;        &quot;a&quot;          &quot;bad&quot;       
## [5521] &quot;error&quot;      &quot;on&quot;         &quot;the&quot;        &quot;part&quot;       &quot;of&quot;        
## [5526] &quot;the&quot;        &quot;new&quot;        &quot;judge&quot;      &quot;One&quot;        &quot;step&quot;      
## [5531] &quot;more&quot;       &quot;and&quot;        &quot;the&quot;        &quot;board&quot;      &quot;will&quot;      
## [5536] &quot;collapse&quot;   &quot;Take&quot;       &quot;the&quot;        &quot;match&quot;      &quot;and&quot;       
## [5541] &quot;strike&quot;     &quot;it&quot;         &quot;against&quot;    &quot;your&quot;       &quot;shoe&quot;      
## [5546] &quot;The&quot;        &quot;pot&quot;        &quot;boiled&quot;     &quot;but&quot;        &quot;the&quot;       
## [5551] &quot;contents&quot;   &quot;failed&quot;     &quot;to&quot;         &quot;jell&quot;       &quot;The&quot;       
## [5556] &quot;baby&quot;       &quot;puts&quot;       &quot;his&quot;        &quot;right&quot;      &quot;foot&quot;      
## [5561] &quot;in&quot;         &quot;his&quot;        &quot;mouth&quot;      &quot;The&quot;        &quot;bombs&quot;     
## [5566] &quot;left&quot;       &quot;most&quot;       &quot;of&quot;         &quot;the&quot;        &quot;town&quot;      
## [5571] &quot;in&quot;         &quot;ruins&quot;      &quot;Stop&quot;       &quot;and&quot;        &quot;stare&quot;     
## [5576] &quot;at&quot;         &quot;the&quot;        &quot;hard&quot;       &quot;working&quot;    &quot;man&quot;       
## [5581] &quot;The&quot;        &quot;streets&quot;    &quot;are&quot;        &quot;narrow&quot;     &quot;and&quot;       
## [5586] &quot;full&quot;       &quot;of&quot;         &quot;sharp&quot;      &quot;turns&quot;      &quot;The&quot;       
## [5591] &quot;pup&quot;        &quot;jerked&quot;     &quot;the&quot;        &quot;leash&quot;      &quot;as&quot;        
## [5596] &quot;he&quot;         &quot;saw&quot;        &quot;a&quot;          &quot;feline&quot;     &quot;shape&quot;     
## [5601] &quot;Open&quot;       &quot;your&quot;       &quot;book&quot;       &quot;to&quot;         &quot;the&quot;       
## [5606] &quot;first&quot;      &quot;page&quot;       &quot;Fish&quot;       &quot;evade&quot;      &quot;the&quot;       
## [5611] &quot;net&quot;        &quot;and&quot;        &quot;swim&quot;       &quot;off&quot;        &quot;Dip&quot;       
## [5616] &quot;the&quot;        &quot;pail&quot;       &quot;once&quot;       &quot;and&quot;        &quot;let&quot;       
## [5621] &quot;it&quot;         &quot;settle&quot;     &quot;Will&quot;       &quot;you&quot;        &quot;please&quot;    
## [5626] &quot;answer&quot;     &quot;that&quot;       &quot;phone&quot;      &quot;The&quot;        &quot;big&quot;       
## [5631] &quot;red&quot;        &quot;apple&quot;      &quot;fell&quot;       &quot;to&quot;         &quot;the&quot;       
## [5636] &quot;ground&quot;     &quot;The&quot;        &quot;curtain&quot;    &quot;rose&quot;       &quot;and&quot;       
## [5641] &quot;the&quot;        &quot;show&quot;       &quot;was&quot;        &quot;on&quot;         &quot;The&quot;       
## [5646] &quot;young&quot;      &quot;prince&quot;     &quot;became&quot;     &quot;heir&quot;       &quot;to&quot;        
## [5651] &quot;the&quot;        &quot;throne&quot;     &quot;He&quot;         &quot;sent&quot;       &quot;the&quot;       
## [5656] &quot;boy&quot;        &quot;on&quot;         &quot;a&quot;          &quot;short&quot;      &quot;errand&quot;    
## [5661] &quot;Leave&quot;      &quot;now&quot;        &quot;and&quot;        &quot;you&quot;        &quot;will&quot;      
## [5666] &quot;arrive&quot;     &quot;on&quot;         &quot;time&quot;       &quot;The&quot;        &quot;corner&quot;    
## [5671] &quot;store&quot;      &quot;was&quot;        &quot;robbed&quot;     &quot;last&quot;       &quot;night&quot;     
## [5676] &quot;A&quot;          &quot;gold&quot;       &quot;ring&quot;       &quot;will&quot;       &quot;please&quot;    
## [5681] &quot;most&quot;       &quot;any&quot;        &quot;girl&quot;       &quot;The&quot;        &quot;long&quot;      
## [5686] &quot;journey&quot;    &quot;home&quot;       &quot;took&quot;       &quot;a&quot;          &quot;year&quot;      
## [5691] &quot;She&quot;        &quot;saw&quot;        &quot;a&quot;          &quot;cat&quot;        &quot;in&quot;        
## [5696] &quot;the&quot;        &quot;neighbor&#39;s&quot; &quot;house&quot;      &quot;A&quot;          &quot;pink&quot;      
## [5701] &quot;shell&quot;      &quot;was&quot;        &quot;found&quot;      &quot;on&quot;         &quot;the&quot;       
## [5706] &quot;sandy&quot;      &quot;beach&quot;      &quot;Small&quot;      &quot;children&quot;   &quot;came&quot;      
## [5711] &quot;to&quot;         &quot;see&quot;        &quot;him&quot;        &quot;The&quot;        &quot;grass&quot;     
## [5716] &quot;and&quot;        &quot;bushes&quot;     &quot;were&quot;       &quot;wet&quot;        &quot;with&quot;      
## [5721] &quot;dew&quot;        &quot;The&quot;        &quot;blind&quot;      &quot;man&quot;        &quot;counted&quot;   
## [5726] &quot;his&quot;        &quot;old&quot;        &quot;coins&quot;      &quot;A&quot;          &quot;severe&quot;    
## [5731] &quot;storm&quot;      &quot;tore&quot;       &quot;down&quot;       &quot;the&quot;        &quot;barn&quot;      
## [5736] &quot;She&quot;        &quot;called&quot;     &quot;his&quot;        &quot;name&quot;       &quot;many&quot;      
## [5741] &quot;times&quot;      &quot;When&quot;       &quot;you&quot;        &quot;hear&quot;       &quot;the&quot;       
## [5746] &quot;bell&quot;       &quot;come&quot;       &quot;quickly&quot;</code></pre>
<p>Она преобразовала все разбитые на слова предложения в один вектор.</p>
<p>Далее чтобы с этим было удобнее работать, преобразуем вектор в tibble-формат, т.е. таблицу с одним столбцом.</p>
<div class="sourceCode" id="cb1265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1265-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">word =</span> <span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(sentences, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>))))</a></code></pre></div>
<pre><code>## # A tibble: 5,748 x 1
##    word  
##    &lt;chr&gt; 
##  1 The   
##  2 birch 
##  3 canoe 
##  4 slid  
##  5 on    
##  6 the   
##  7 smooth
##  8 planks
##  9 Glue  
## 10 the   
## # … with 5,738 more rows</code></pre>
<p>Как видно, есть слова начинающиеся с заглавной буквы, по этой причине слова <code>The</code> и <code>the</code> будут считаться как два разных слова. Так не годится, нужно перевести всё в один регистр. Для этого добавим ещё один столбец, в котором при помощи функции <code>str_to_lower()</code> переведём все символы высокого регистра в низкий.</p>
<div class="sourceCode" id="cb1267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1267-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">word =</span> <span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(sentences, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1267-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">to_lower =</span> <span class="kw">str_to_lower</span>(word))</a></code></pre></div>
<pre><code>## # A tibble: 5,748 x 2
##    word   to_lower
##    &lt;chr&gt;  &lt;chr&gt;   
##  1 The    the     
##  2 birch  birch   
##  3 canoe  canoe   
##  4 slid   slid    
##  5 on     on      
##  6 the    the     
##  7 smooth smooth  
##  8 planks planks  
##  9 Glue   glue    
## 10 the    the     
## # … with 5,738 more rows</code></pre>
<p>И после этого осталось только посчитать количество раз, которое встречается каждое слово. Для этого воспользуемся функцией <code>count()</code> с параметром <code>sort = TRUE</code> для сортировки по возрастанию. По условию задачи нам нужно пять самых часто встречаемых слов, поэтому возьмём <code>head(5)</code>.</p>
<div class="sourceCode" id="cb1269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1269-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">word =</span> <span class="kw">unlist</span>(<span class="kw">str_extract_all</span>(sentences, <span class="kw">boundary</span>(<span class="st">&quot;word&quot;</span>)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1269-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">to_lower =</span> <span class="kw">str_to_lower</span>(word)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1269-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(to_lower, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1269-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##   to_lower     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 the        751
## 2 a          202
## 3 of         132
## 4 to         123
## 5 and        118</code></pre>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">3.5.6</span> Другие применения регулярных выражений</h3>
<p>В базовый состав R входят еще две функции, которы так же используют regex</p>
<ul>
<li><code>apropos()</code> — выполняет поиск всех объектов, доступных в глобальном окружении. Эту фкнецию удобно использовать в тех случаях, когда вы не можете вспомнить точное имя какой-то функции.</li>
</ul>
<div class="sourceCode" id="cb1271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1271-1" data-line-number="1"><span class="kw">apropos</span>(<span class="st">&quot;replace&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;%+replace%&quot;       &quot;replace&quot;          &quot;replace_na&quot;      
## [4] &quot;setReplaceMethod&quot; &quot;str_replace&quot;      &quot;str_replace_all&quot; 
## [7] &quot;str_replace_na&quot;   &quot;theme_replace&quot;</code></pre>
<ul>
<li><code>dir()</code>— перечисляет все файлы, зранящиеся в каталоге. Аргемент <code>pattern</code> принимает регулярное выражение и возвращает имена лишь тех файлов, которые соответствуют шаблону. Например, можно найти все файлы R Markdown в текущем каталоге с помощью следующего кода</li>
</ul>
<div class="sourceCode" id="cb1273"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1273-1" data-line-number="1"><span class="kw">head</span>(<span class="kw">dir</span>(<span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.Rmd$&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;01_data_visualisation.Rmd&quot;        &quot;02_workflow_basics.Rmd&quot;          
## [3] &quot;03_data_transformation.Rmd&quot;       &quot;04_workflow_scripts.Rmd&quot;         
## [5] &quot;05_exploratory_data_analysis.Rmd&quot; &quot;06_workflow_projects.Rmd&quot;</code></pre>
</div>
<div id="-stringi" class="section level3">
<h3><span class="header-section-number">3.5.7</span> Пакет <code>stringi</code></h3>
<p>Пакет <code>stringr</code> построени поверх пакета <code>stringi</code>. В <code>stringr</code> всего 42 функции, в <code>stringi</code> аж 234. Вызов функции различается лишь префиксом <code>stri_</code> для <code>stringi</code></p>
<div id="-14.7.1.1" class="section level4">
<h4><span class="header-section-number">3.5.7.1</span> Упражнение 14.7.1.1</h4>
<div class="question">
<p>Find the <code>stringi</code> functions that:</p>
<ol style="list-style-type: decimal">
<li><p>Count the number of words.</p></li>
<li><p>Find duplicated strings.</p></li>
<li>Generate random text.</li>
</ol>
</div>
<ol style="list-style-type: decimal">
<li>Подсчитывает количество слов:</li>
</ol>
<div class="sourceCode" id="cb1275"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1275-1" data-line-number="1"><span class="kw">apropos</span>(<span class="st">&quot;stri_count&quot;</span>)</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>Это функция — <code>stri_count_words()</code></p>
<ol start="2" style="list-style-type: decimal">
<li>Находит повторяющиеся строки:</li>
</ol>
<div class="sourceCode" id="cb1277"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1277-1" data-line-number="1"><span class="kw">apropos</span>(<span class="st">&quot;stri_repeat&quot;</span>) <span class="co"># нет, не угадал</span></a></code></pre></div>
<pre><code>## character(0)</code></pre>
<div class="sourceCode" id="cb1279"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1279-1" data-line-number="1"><span class="kw">apropos</span>(<span class="st">&quot;stri_duplicate&quot;</span>)</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>Это функция — <code>stri_duplicated()</code></p>
<ol start="3" style="list-style-type: decimal">
<li>Генерирует случайный текст</li>
</ol>
<div class="sourceCode" id="cb1281"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1281-1" data-line-number="1"><span class="kw">apropos</span>(<span class="st">&quot;stri_rand&quot;</span>)</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>Целых три функции:</p>
<ul>
<li><code>stri_rand_lipsum()</code> генерирует lorem-ipsum текст</li>
<li><code>stri_rand_strings()</code> генерирует рандомную строку</li>
<li><code>stri_rand_shuffle()</code> случайным образом перемешивает кодовые точки (символы) в тексте.</li>
</ul>
<!--chapter:end:11_string.Rmd-->
</div>
</div>
</div>
<div id="------forcats" class="section level2">
<h2><span class="header-section-number">3.6</span> Работа с факторами с помощью пакета <code>forcats</code></h2>
<div id="-9" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Введение</h3>
<p>Факторы используются для работы с категориальными переменными. Их так же можно использовать если нужно отобразить символьные векторы в порядке следования, отличающимся от алфавитного.</p>
<div id="--1" class="section level4">
<h4><span class="header-section-number">3.6.1.1</span> Используемые ресурсы</h4>
<div class="sourceCode" id="cb1283"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1283-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1283-2" data-line-number="2"><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb1283-3" data-line-number="3"><span class="kw">library</span>(stringr)</a></code></pre></div>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Создание факторов</h3>
<p>Предположим есть переменная, в которой внесены названия месяцев</p>
<div class="sourceCode" id="cb1284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1284-1" data-line-number="1">x1 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dec&quot;</span>, <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Mar&quot;</span>)</a></code></pre></div>
<p>Есть пару проблем с записью строки в эти перменные</p>
<ul>
<li>Возможны опечатки</li>
</ul>
<div class="sourceCode" id="cb1285"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1285-1" data-line-number="1">x2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Dec&quot;</span>, <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;Jam&quot;</span>, <span class="st">&quot;Mar&quot;</span>)</a></code></pre></div>
<ul>
<li>Список сортируется не правильно, т.е. он сортируется не по месяцам а по алфавиту.</li>
</ul>
<div class="sourceCode" id="cb1286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1286-1" data-line-number="1"><span class="kw">sort</span>(x1)</a></code></pre></div>
<pre><code>## [1] &quot;Apr&quot; &quot;Dec&quot; &quot;Jan&quot; &quot;Mar&quot;</code></pre>
<p>Обе проблемы решаются использованием фактора. Чтобы создать фактор нужно</p>
<ol style="list-style-type: decimal">
<li>Создать список допустимых уровней.</li>
</ol>
<div class="sourceCode" id="cb1288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1288-1" data-line-number="1">month_levels &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb1288-2" data-line-number="2">  <span class="st">&quot;Jan&quot;</span>, <span class="st">&quot;Feb&quot;</span>, <span class="st">&quot;Mar&quot;</span>, <span class="st">&quot;Apr&quot;</span>, <span class="st">&quot;May&quot;</span>, <span class="st">&quot;Jun&quot;</span>, </a>
<a class="sourceLine" id="cb1288-3" data-line-number="3">  <span class="st">&quot;Jul&quot;</span>, <span class="st">&quot;Aug&quot;</span>, <span class="st">&quot;Sep&quot;</span>, <span class="st">&quot;Oct&quot;</span>, <span class="st">&quot;Nov&quot;</span>, <span class="st">&quot;Dec&quot;</span></a>
<a class="sourceLine" id="cb1288-4" data-line-number="4">)</a></code></pre></div>
<ol style="list-style-type: decimal">
<li>Теперь можно создать фактор</li>
</ol>
<div class="sourceCode" id="cb1289"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1289-1" data-line-number="1">y1 &lt;-<span class="st"> </span><span class="kw">factor</span>(x1, <span class="dt">levels =</span> month_levels)</a>
<a class="sourceLine" id="cb1289-2" data-line-number="2">y1</a></code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
<div class="sourceCode" id="cb1291"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1291-1" data-line-number="1"><span class="kw">sort</span>(y1)</a></code></pre></div>
<pre><code>## [1] Jan Mar Apr Dec
## Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
<p>Любые значения не входящие в этот набор автоматически будут преобразовываться в <code>NA</code>.</p>
<div class="sourceCode" id="cb1293"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1293-1" data-line-number="1">y2 &lt;-<span class="st"> </span><span class="kw">factor</span>(x2, <span class="dt">levels =</span> month_levels)</a>
<a class="sourceLine" id="cb1293-2" data-line-number="2">y2</a></code></pre></div>
<pre><code>## [1] Dec  Apr  &lt;NA&gt; Mar 
## Levels: Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec</code></pre>
<p>Можно получить сообщения об ошибках, используя функцию <code>readr::parse_factor()</code></p>
<div class="sourceCode" id="cb1295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1295-1" data-line-number="1">y2 &lt;-<span class="st"> </span><span class="kw">parse_factor</span>(x2, <span class="dt">levels =</span> month_levels)</a></code></pre></div>
<pre><code>## Warning: 1 parsing failure.
## row col           expected actual
##   3  -- value in level set    Jam</code></pre>
<p>Если опустить уровни, они будут браться из данных в алфавитном порядке</p>
<div class="sourceCode" id="cb1297"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1297-1" data-line-number="1"><span class="kw">factor</span>(x1)</a></code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## Levels: Apr Dec Jan Mar</code></pre>
<p>Иногда предпочтительнее, чтобы порядок уровней совпадал с порядком первого появления в данных. Можно сделать это в процессе создания фактора путем задания уровней для функции <code>unique()</code> или уже постфактум с помощью функции <code>fct_inorder()</code></p>
<div class="sourceCode" id="cb1299"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1299-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="kw">factor</span>(x1, <span class="dt">levels =</span> <span class="kw">unique</span>(x1))</a>
<a class="sourceLine" id="cb1299-2" data-line-number="2">f1</a></code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## Levels: Dec Apr Jan Mar</code></pre>
<div class="sourceCode" id="cb1301"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1301-1" data-line-number="1">f2 &lt;-<span class="st"> </span>x1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">factor</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_inorder</span>()</a>
<a class="sourceLine" id="cb1301-2" data-line-number="2">f2</a></code></pre></div>
<pre><code>## [1] Dec Apr Jan Mar
## Levels: Dec Apr Jan Mar</code></pre>
<p>Если потребуется непосредственный доступ к набору допустимых уровней, это можно сделать с помошью функции <code>levels()</code></p>
<div class="sourceCode" id="cb1303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1303-1" data-line-number="1"><span class="kw">levels</span>(f2)</a></code></pre></div>
<pre><code>## [1] &quot;Dec&quot; &quot;Apr&quot; &quot;Jan&quot; &quot;Mar&quot;</code></pre>
</div>
<div id="-gss" class="section level3">
<h3><span class="header-section-number">3.6.3</span> Опрос GSS</h3>
<p>В оставшейся части главы работаем с <code>forcats::gss_cat</code> это данные, предоставленные General Society Survey — общенациональный социальный опрос США</p>
<div class="sourceCode" id="cb1305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1305-1" data-line-number="1">gss_cat</a></code></pre></div>
<pre><code>## # A tibble: 21,483 x 9
##     year marital     age race  rincome   partyid    relig   denom   tvhours
##    &lt;int&gt; &lt;fct&gt;     &lt;int&gt; &lt;fct&gt; &lt;fct&gt;     &lt;fct&gt;      &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;
##  1  2000 Never ma…    26 White $8000 to… Ind,near … Protes… Southe…      12
##  2  2000 Divorced     48 White $8000 to… Not str r… Protes… Baptis…      NA
##  3  2000 Widowed      67 White Not appl… Independe… Protes… No den…       2
##  4  2000 Never ma…    39 White Not appl… Ind,near … Orthod… Not ap…       4
##  5  2000 Divorced     25 White Not appl… Not str d… None    Not ap…       1
##  6  2000 Married      25 White $20000 -… Strong de… Protes… Southe…      NA
##  7  2000 Never ma…    36 White $25000 o… Not str r… Christ… Not ap…       3
##  8  2000 Divorced     44 White $7000 to… Ind,near … Protes… Luther…      NA
##  9  2000 Married      44 White $25000 o… Not str d… Protes… Other         0
## 10  2000 Married      47 White $25000 o… Strong re… Protes… Southe…       3
## # … with 21,473 more rows</code></pre>
<p>Информация о перменных по запросу хэлпа <code>?gss_cat</code>.</p>
<p>Если факторы хранятся в тиббле-фрэйме, мы не сможем увидеть их, не предпринимая никаких мер. Один из способов использовать функцию <code>count()</code>. Другой — более наглядный, использовать построение диаграмой.</p>
<div class="sourceCode" id="cb1307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1307-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(race)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   race      n
##   &lt;fct&gt; &lt;int&gt;
## 1 Other  1959
## 2 Black  3129
## 3 White 16395</code></pre>
<div class="sourceCode" id="cb1309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1309-1" data-line-number="1"><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(race)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1309-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-659-1.png" width="672" /></p>
<p>По умолчанию опускаются уровни, в которых не было ни одного значения, это не всегда полезно. Иногда нужно посмотреть и не встречающиеся значения. Для этого нужно принудлительно просить R показать таких перменные при помощи функции <code>scale_x_discrete()</code></p>
<div class="sourceCode" id="cb1310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1310-1" data-line-number="1"><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(race)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1310-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1310-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">drop =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-660-1.png" width="672" /></p>
<div id="-15.3.1.1" class="section level4">
<h4><span class="header-section-number">3.6.3.1</span> Упражнение 15.3.1.1</h4>
<div class="question">
<p>Explore the distribution of <code>rincome</code> (reported income). What makes the default bar chart hard to understand? How could you improve the plot?</p>
</div>
<p>Всё потому что подписи по абсциссе смешались в кучу.</p>
<div class="sourceCode" id="cb1311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1311-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1311-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(rincome)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 2
##    rincome            n
##    &lt;fct&gt;          &lt;int&gt;
##  1 No answer        183
##  2 Don&#39;t know       267
##  3 Refused          975
##  4 $25000 or more  7363
##  5 $20000 - 24999  1283
##  6 $15000 - 19999  1048
##  7 $10000 - 14999  1168
##  8 $8000 to 9999    340
##  9 $7000 to 7999    188
## 10 $6000 to 6999    215
## 11 $5000 to 5999    227
## 12 $4000 to 4999    226
## 13 $3000 to 3999    276
## 14 $1000 to 2999    395
## 15 Lt $1000         286
## 16 Not applicable  7043</code></pre>
<div class="sourceCode" id="cb1313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1313-1" data-line-number="1">rincome_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(rincome)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1313-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p>Первым шагом можно повернуть оси</p>
<div class="sourceCode" id="cb1314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1314-1" data-line-number="1">rincome_plot <span class="op">+</span></a>
<a class="sourceLine" id="cb1314-2" data-line-number="2"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-662-1.png" width="672" /></p>
<p>Или, как один из вариантов решения — перевернуть подписи на 90 градусов</p>
<div class="sourceCode" id="cb1315"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1315-1" data-line-number="1">rincome_plot <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-663-1.png" width="672" /></p>
<p>Или на другой угол, при котором будут хорошо читаться подписи.</p>
<div class="sourceCode" id="cb1316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1316-1" data-line-number="1">rincome_plot <span class="op">+</span><span class="st"> </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">45</span>, <span class="dt">hjust =</span> <span class="dv">1</span>))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-664-1.png" width="672" /></p>
<p>Но мне всё же больше нравится вариант с поворотом оси.</p>
<p>Далее видно, что из информативного представления о количестве зарплаты, выбиваются те кто либо не знают, не могут ответить, или не захотелили отвечать. Эта информация может быть статистически полезна, но прям хочется убрать тех кто указал “неприемлемую” зарплату. Кроме этого можно сократить записи тысячей на <code>k</code>, чтобы не сбивать с толку</p>
<div class="sourceCode" id="cb1317"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1317-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1317-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>rincome <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Not applicable&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1317-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(rincome)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1317-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1317-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_flip</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1317-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Number of Respondents&quot;</span>, <span class="dt">labels =</span> <span class="cf">function</span>(x) <span class="kw">paste0</span>(x<span class="op">/</span><span class="dv">1000</span>, <span class="st">&quot;k&quot;</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1317-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="st">&quot;Respondent&#39;s Income&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-665-1.png" width="672" /></p>
<p>Ещё хотелось бы сортировать в обратном порядке и заменить <code>Lt $1000</code> на <code>Less then $1000</code>, но об этом мы узнаем в следующей главе</p>
</div>
<div id="-15.3.1.2" class="section level4">
<h4><span class="header-section-number">3.6.3.2</span> Упражнение 15.3.1.2</h4>
<div class="question">
<p>What is the most common <code>relig</code> in this survey? What’s the most common <code>partyid</code>?</p>
</div>
<div class="sourceCode" id="cb1318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1318-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1318-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(relig)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1318-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1318-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-666-1.png" width="672" /></p>
<p>Очевидно, что протестанты встречаются чаще других. ПОсмотрим сколько это в числовом выражении:</p>
<div class="sourceCode" id="cb1319"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1319-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1319-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(relig) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1319-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1319-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   relig          n
##   &lt;fct&gt;      &lt;int&gt;
## 1 Protestant 10846</code></pre>
<p>Проделаем точно такую же операцию, но для переменной <code>partyid</code></p>
<div class="sourceCode" id="cb1321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1321-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1321-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(partyid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1321-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1321-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-668-1.png" width="672" /></p>
<p>А так же <code>Independent</code> встречается чаще других. И в числовом выражении</p>
<div class="sourceCode" id="cb1322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1322-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1322-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(partyid) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1322-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1322-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   partyid         n
##   &lt;fct&gt;       &lt;int&gt;
## 1 Independent  4119</code></pre>
</div>
<div id="-15.3.1.3" class="section level4">
<h4><span class="header-section-number">3.6.3.3</span> Упражнение 15.3.1.3</h4>
<div class="question">
<p>Which <code>relig</code> does <code>denom</code> (denomination) apply to? How can you find out with a table? How can you find out with a visualisation?</p>
</div>
<p>Можно графически посмотреть вот так</p>
<div class="sourceCode" id="cb1324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1324-1" data-line-number="1"><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(relig)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1324-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> denom), <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1324-3" data-line-number="3"><span class="st">  </span><span class="kw">scale_x_discrete</span>(<span class="dt">drop =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1324-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-670-1.png" width="672" /></p>
<p>Графически заметно, что в основном понятие конфессии применимо к протестантам и христианам. Реже встречаются в группе “Другие”. Можно добавить фильтрацию и убрать параметр <code>drop</code>, тогда графически всё станет явно.</p>
<div class="sourceCode" id="cb1325"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1325-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1325-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>denom <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Not applicable&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1325-3" data-line-number="3"><span class="kw">ggplot</span>(<span class="kw">aes</span>(relig)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1325-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> denom), <span class="dt">position =</span> <span class="st">&quot;fill&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1325-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-671-1.png" width="672" /></p>
<p>В числовом виде это можно представить как — убери всё что <code>Not applicable</code> в переменной <code>denom</code> и покажи всё содержимое <code>relig</code></p>
<div class="sourceCode" id="cb1326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1326-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1326-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span>denom <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Not applicable&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1326-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(relig) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1326-4" data-line-number="4"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(n))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   relig          n
##   &lt;fct&gt;      &lt;int&gt;
## 1 Protestant 10846
## 2 Christian    465
## 3 No answer     93
## 4 Other          7</code></pre>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">3.6.3.4</span> Изменение порядка следования факторов</h4>
<p>Часто оказывается полезным изменить порядок следования факторов в визуализации. Допустим мы хотим изучить среднее количество часов, посвящённы просмотру телевизора представителями разных религий.</p>
<div class="sourceCode" id="cb1328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1328-1" data-line-number="1">relig_summary &lt;-<span class="st"> </span>gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1328-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(relig) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1328-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb1328-4" data-line-number="4">    <span class="dt">age =</span> <span class="kw">mean</span>(age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1328-5" data-line-number="5">    <span class="dt">tvhours =</span> <span class="kw">mean</span>(tvhours, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1328-6" data-line-number="6">    <span class="dt">n =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb1328-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb1328-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1328-9" data-line-number="9"><span class="kw">ggplot</span>(relig_summary, <span class="kw">aes</span>(tvhours, relig)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-673-1.png" width="672" /></p>
<p>Конечно тут сложно рассмотреть закономерности, потому что точки разбросаны хаотично. Для того чтобы поменять порядок, используется знакомая мне уже функция <code>fct_reorder()</code>, она принимает три аргумента:</p>
<ul>
<li><p><code>f</code> — фактор, уровни которого надо поменять</p></li>
<li><p><code>x</code> — числовой вектор, которой нужно использовать для изменения порядка следования уровней.</p></li>
<li><p><code>fun</code> — необязательный аргумент, функция, которая используется если для кажджого значения фактора <code>f</code>, существует несколько значений числового вектора <code>x</code>. По умолчанию используется <code>median</code></p></li>
</ul>
<p>Итак изменим порядок следования в зависимости от количества часов</p>
<div class="sourceCode" id="cb1329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1329-1" data-line-number="1"><span class="kw">ggplot</span>(relig_summary, <span class="kw">aes</span>(tvhours, <span class="kw">fct_reorder</span>(relig, tvhours))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1329-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-674-1.png" width="672" /></p>
<p>Так-то лучше, теперь отчётливо видно что <code>Не знаю</code>-щие чаще смотрять, чем к примеру буддисты.</p>
<p>Но лучше вместо <code>aes()</code> выводить перераспределение в отдельный шаг при помощим <code>mutate()</code>. Это облегчит чтение кода.</p>
<div class="sourceCode" id="cb1330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1330-1" data-line-number="1">relig_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1330-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">relig =</span> <span class="kw">fct_reorder</span>(relig, tvhours)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1330-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(tvhours, relig)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1330-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-675-1.png" width="672" /></p>
<p>А теперь посмотрим, как меняется средний возраст от заявленного уровня дохода</p>
<div class="sourceCode" id="cb1331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1331-1" data-line-number="1">rincome_summary &lt;-<span class="st"> </span>gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1331-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(rincome) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1331-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb1331-4" data-line-number="4">    <span class="dt">age =</span> <span class="kw">mean</span>(age, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1331-5" data-line-number="5">    <span class="dt">tvhours =</span> <span class="kw">mean</span>(tvhours, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1331-6" data-line-number="6">    <span class="dt">n =</span> <span class="kw">n</span>()</a>
<a class="sourceLine" id="cb1331-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb1331-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1331-9" data-line-number="9"><span class="kw">ggplot</span>(rincome_summary, <span class="kw">aes</span>(age, <span class="kw">fct_reorder</span>(rincome, age))) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-676-1.png" width="672" /></p>
<p>Стало только хуже, потому что изначально перменная с доходом уже была упорядочена.</p>
<p>Оставьте функцию <code>fct_reorder()</code> для факторов, уровни котороых упорядочиваются произвольно.</p>
<p>В то же время имеет смысл переместить уровень <code>&quot;Не применимо&quot;</code> в начало вместе с дргими специальными уровнями.
Для этого можно использовать функцию <code>fct_relevel()</code>. В качестве аргументов она принимает фактор, и любое количество факторов которые нужно перместить в начало линии</p>
<div class="sourceCode" id="cb1332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1332-1" data-line-number="1"><span class="kw">ggplot</span>(rincome_summary, <span class="kw">aes</span>(age, <span class="kw">fct_relevel</span>(rincome, <span class="st">&quot;Not applicable&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1332-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-677-1.png" width="672" /></p>
<p>Столь высокое значение для уровня <code>&quot;Не применимо&quot;</code> вероятно связано с пенсионным возрастом.</p>
<p>Другой тип переупорядочивания уровней полезен в тех случаях, когда вы выделяете цветом линии на графике. Функция <code>fct_reorder2()</code>
переупорядочивает факторы по значениям <code>y</code>, связанным с наибольшими значениями <code>x</code>. Это облегчает чтения графика, посколько цвета линий выравниваются с легендой</p>
<div class="sourceCode" id="cb1333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1333-1" data-line-number="1">by_age &lt;-<span class="st"> </span>gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1333-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(age)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1333-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(age, marital) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1333-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(age) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1333-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a>
<a class="sourceLine" id="cb1333-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1333-7" data-line-number="7"><span class="kw">ggplot</span>(by_age, <span class="kw">aes</span>(age, prop, <span class="dt">colour =</span> marital)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1333-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-678-1.png" width="672" /></p>
<div class="sourceCode" id="cb1334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1334-1" data-line-number="1"><span class="kw">ggplot</span>(by_age, <span class="kw">aes</span>(age, prop, <span class="dt">colour =</span> <span class="kw">fct_reorder2</span>(marital, age, prop))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1334-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1334-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;marital&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-678-2.png" width="672" /></p>
<p>Наконец, в случае столбчатых диаграмм можно использовать <code>fct_infeq()</code> для упорядочивания уровней по возрастанию: это простейший тип переупорядочивания, посколько он не требует никаких дополнительных перменных.</p>
<div class="sourceCode" id="cb1335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1335-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1335-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">marital =</span> marital <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1335-3" data-line-number="3"><span class="st">           </span><span class="kw">fct_infreq</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1335-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(marital)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1335-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-679-1.png" width="672" /></p>
<p>Можно отзеркалить упорядочивания при помощи функции <code>fct_rev()</code></p>
<div class="sourceCode" id="cb1336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1336-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1336-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">marital =</span> marital <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1336-3" data-line-number="3"><span class="st">           </span><span class="kw">fct_infreq</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1336-4" data-line-number="4"><span class="st">           </span><span class="kw">fct_rev</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1336-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(marital)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1336-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-680-1.png" width="672" /></p>
</div>
<div id="-15.4.1.1" class="section level4">
<h4><span class="header-section-number">3.6.3.5</span> Упражнение 15.4.1.1</h4>
<div class="question">
<p>There are some suspiciously high numbers in <code>tvhours</code>. Is the mean a good summary?</p>
</div>
<p>Пожалуй, просмотр телевизора 24 часа в сутки это перебор.</p>
<div class="sourceCode" id="cb1337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1337-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1337-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(tvhours) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1337-3" data-line-number="3"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(tvhours))</a></code></pre></div>
<pre><code>## # A tibble: 25 x 2
##    tvhours     n
##      &lt;int&gt; &lt;int&gt;
##  1      24    22
##  2      23     1
##  3      22     2
##  4      21     2
##  5      20    14
##  6      18     7
##  7      17     2
##  8      16    10
##  9      15    17
## 10      14    24
## # … with 15 more rows</code></pre>
<div class="sourceCode" id="cb1339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1339-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1339-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(tvhours)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1339-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-682-1.png" width="672" /></p>
<p>В остальном данные не выглядят такими уж необычными.</p>
<div class="sourceCode" id="cb1340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1340-1" data-line-number="1"><span class="kw">summary</span>(gss_cat[[<span class="st">&quot;tvhours&quot;</span>]])</a></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   0.000   1.000   2.000   2.981   4.000  24.000   10146</code></pre>
<p>Среднее конечно чувствительнее к отскакивающим значениям, чем медиана, но всё зависит от того, что мы хотим изучить.</p>
</div>
<div id="-15.4.1.2" class="section level4">
<h4><span class="header-section-number">3.6.3.6</span> Упражнение 15.4.1.2</h4>
<div class="question">
<p>For each factor in <code>gss_cat</code> identify whether the order of the levels is arbitrary or principled.</p>
</div>
<p>Рассмотрим категориальные перменные <code>marital</code>, <code>race</code>, <code>rincome</code>, <code>partyid</code>, <code>relig</code>, <code>denom</code>.
И пожалуй <code>tvhours</code> тоже можно отнести к категориальной перменной потому что она обозначает время.</p>
<ol style="list-style-type: decimal">
<li>Пойдём по порядку и начнём с <code>marital</code>:</li>
</ol>
<div class="sourceCode" id="cb1342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1342-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1342-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> marital)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1342-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-684-1.png" width="672" /></p>
<p>Можно перерупорядочить значения по такой логике:</p>
<ul>
<li><p>сначала переменные, характеризующие пребывание когда-либо в отношениях</p>
<ul>
<li><p>еще в отношениях</p>
<ul>
<li><p>женаты</p></li>
<li><p>живут раздельно</p></li>
</ul></li>
<li><p>уже не в отношениях</p>
<ul>
<li><p>разведены</p></li>
<li>овдовели</li>
</ul></li>
</ul></li>
<li><p>никогда не были женаты</p></li>
<li><p>нет ответа</p></li>
</ul>
<p>Другими словами, я бы отсортировал всё вот таким образом:</p>
<div class="sourceCode" id="cb1343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1343-1" data-line-number="1"><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(<span class="kw">fct_relevel</span>(marital,<span class="st">&quot;Married&quot;</span>, <span class="st">&quot;Separated&quot;</span>, <span class="st">&quot;Divorced&quot;</span>, <span class="st">&quot;Widowed&quot;</span>, <span class="st">&quot;Never married&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1343-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1343-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;marital&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-685-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>Посмотрим на переменную <code>race</code></li>
</ol>
<div class="sourceCode" id="cb1344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1344-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1344-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> race)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1344-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-686-1.png" width="672" /></p>
<p>В принципе всё хорошо, и можно не передвигать ничего, но можно специальную группу можно поменять местами.</p>
<div class="sourceCode" id="cb1345"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1345-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1345-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">race =</span> race <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_infreq</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1345-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> race)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1345-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-687-1.png" width="672" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Посмотрим на переменную <code>rincome</code></li>
</ol>
<div class="sourceCode" id="cb1346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1346-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1346-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rincome)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1346-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1346-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-688-1.png" width="672" /></p>
<p>Эта перменная уже отсортирована, её не нужно сортировать дополнительно, разве что можно специальную группу передвинуть в конец</p>
<div class="sourceCode" id="cb1347"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1347-1" data-line-number="1"><span class="kw">ggplot</span>(gss_cat, <span class="kw">aes</span>(<span class="kw">fct_relevel</span>(rincome, <span class="st">&quot;Not applicable&quot;</span>))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1347-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1347-3" data-line-number="3"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-689-1.png" width="672" /></p>
<ol start="4" style="list-style-type: decimal">
<li>Посмотрим на переменную <code>partyid</code></li>
</ol>
<div class="sourceCode" id="cb1348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1348-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1348-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> partyid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1348-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1348-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-690-1.png" width="672" /></p>
<p>Ничего страшного не случится, если мы отсортируем эту переменную.</p>
<div class="sourceCode" id="cb1349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1349-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1349-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> partyid <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_infreq</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_rev</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1349-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> partyid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1349-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1349-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-691-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Посмотрим на переменную <code>denom</code></li>
</ol>
<div class="sourceCode" id="cb1350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1350-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1350-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> denom)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1350-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1350-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-692-1.png" width="672" /></p>
<p>Можно отсотрировать.</p>
<div class="sourceCode" id="cb1351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1351-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1351-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">denom =</span> denom <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_infreq</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">fct_rev</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1351-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> denom)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1351-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1351-5" data-line-number="5"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-693-1.png" width="672" /></p>
<ol start="5" style="list-style-type: decimal">
<li>Посмотрим на переменную <code>tvhours</code></li>
</ol>
<div class="sourceCode" id="cb1352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1352-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1352-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> tvhours)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1352-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<pre><code>## Warning: Removed 10146 rows containing non-finite values (stat_count).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-694-1.png" width="672" /></p>
<p>В зависимости от задачи, эту переменную можно отсортировать, допустим чтобы посмотреть какое количество часов уделяют больше всего экранному времени.
Или можно оставить неизменно, если нам нужно будет посмотреть как меняется активность час от часа.</p>
</div>
<div id="-15.4.1.3" class="section level4">
<h4><span class="header-section-number">3.6.3.7</span> Упражнение 15.4.1.3</h4>
<div class="question">
<p>Why did moving “Not applicable” to the front of the levels move it to the bottom of the plot?</p>
</div>
<p>Потому что это дает уровню «Не применимо» целочисленное значение 1.</p>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">3.6.4</span> Изменение уровней факторов</h3>
<p>Более мощным приёмом является изменение значений уровней, а не изменение следования.
Это позволяет сделать более понятными подписи для публикаций и свертывать уровни создавая уровни более высокго порядка для отображения.
Для этого можно использовать инструмент <code>fct_recode()</code>.
Она позволяет перекодировать, т.е. изменять значения каддого уровня. Возьмём например <code>gss_cat$partyid</code></p>
<div class="sourceCode" id="cb1354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1354-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">count</span>(partyid)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    partyid                n
##    &lt;fct&gt;              &lt;int&gt;
##  1 No answer            154
##  2 Don&#39;t know             1
##  3 Other party          393
##  4 Strong republican   2314
##  5 Not str republican  3032
##  6 Ind,near rep        1791
##  7 Independent         4119
##  8 Ind,near dem        2499
##  9 Not str democrat    3690
## 10 Strong democrat     3490</code></pre>
<p>СОдержащаяся в названиях уровней информация сжата и непоследовательна. Давайте немного расширим их и используем параллельную конструкцию</p>
<div class="sourceCode" id="cb1356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1356-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1356-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_recode</span>(partyid,</a>
<a class="sourceLine" id="cb1356-3" data-line-number="3">    <span class="st">&quot;Republican, strong&quot;</span>    =<span class="st"> &quot;Strong republican&quot;</span>,</a>
<a class="sourceLine" id="cb1356-4" data-line-number="4">    <span class="st">&quot;Republican, weak&quot;</span>      =<span class="st"> &quot;Not str republican&quot;</span>,</a>
<a class="sourceLine" id="cb1356-5" data-line-number="5">    <span class="st">&quot;Independent, near rep&quot;</span> =<span class="st"> &quot;Ind,near rep&quot;</span>,</a>
<a class="sourceLine" id="cb1356-6" data-line-number="6">    <span class="st">&quot;Independent, near dem&quot;</span> =<span class="st"> &quot;Ind,near dem&quot;</span>,</a>
<a class="sourceLine" id="cb1356-7" data-line-number="7">    <span class="st">&quot;Democrat, weak&quot;</span>        =<span class="st"> &quot;Not str democrat&quot;</span>,</a>
<a class="sourceLine" id="cb1356-8" data-line-number="8">    <span class="st">&quot;Democrat, strong&quot;</span>      =<span class="st"> &quot;Strong democrat&quot;</span></a>
<a class="sourceLine" id="cb1356-9" data-line-number="9">  )) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1356-10" data-line-number="10"><span class="st">  </span><span class="kw">count</span>(partyid)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    partyid                   n
##    &lt;fct&gt;                 &lt;int&gt;
##  1 No answer               154
##  2 Don&#39;t know                1
##  3 Other party             393
##  4 Republican, strong     2314
##  5 Republican, weak       3032
##  6 Independent, near rep  1791
##  7 Independent            4119
##  8 Independent, near dem  2499
##  9 Democrat, weak         3690
## 10 Democrat, strong       3490</code></pre>
<p>Как видно из кода выше, функция оставляет нетронутыми уровни, которые не были указаны в параметрах. Функция так же предупредит, если сослаться на несуществующий уровень.</p>
<p>МОжно создавать группы, приписывая несколько преждних уровней одному и тому же новому уровгю</p>
<div class="sourceCode" id="cb1358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1358-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1358-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_recode</span>(partyid,</a>
<a class="sourceLine" id="cb1358-3" data-line-number="3">    <span class="st">&quot;Republican, strong&quot;</span>    =<span class="st"> &quot;Strong republican&quot;</span>,</a>
<a class="sourceLine" id="cb1358-4" data-line-number="4">    <span class="st">&quot;Republican, weak&quot;</span>      =<span class="st"> &quot;Not str republican&quot;</span>,</a>
<a class="sourceLine" id="cb1358-5" data-line-number="5">    <span class="st">&quot;Independent, near rep&quot;</span> =<span class="st"> &quot;Ind,near rep&quot;</span>,</a>
<a class="sourceLine" id="cb1358-6" data-line-number="6">    <span class="st">&quot;Independent, near dem&quot;</span> =<span class="st"> &quot;Ind,near dem&quot;</span>,</a>
<a class="sourceLine" id="cb1358-7" data-line-number="7">    <span class="st">&quot;Democrat, weak&quot;</span>        =<span class="st"> &quot;Not str democrat&quot;</span>,</a>
<a class="sourceLine" id="cb1358-8" data-line-number="8">    <span class="st">&quot;Democrat, strong&quot;</span>      =<span class="st"> &quot;Strong democrat&quot;</span>,</a>
<a class="sourceLine" id="cb1358-9" data-line-number="9">    <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;No answer&quot;</span>,</a>
<a class="sourceLine" id="cb1358-10" data-line-number="10">    <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;Don&#39;t know&quot;</span>,</a>
<a class="sourceLine" id="cb1358-11" data-line-number="11">    <span class="st">&quot;Other&quot;</span>                 =<span class="st"> &quot;Other party&quot;</span></a>
<a class="sourceLine" id="cb1358-12" data-line-number="12">  )) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1358-13" data-line-number="13"><span class="st">  </span><span class="kw">count</span>(partyid)</a></code></pre></div>
<pre><code>## # A tibble: 8 x 2
##   partyid                   n
##   &lt;fct&gt;                 &lt;int&gt;
## 1 Other                   548
## 2 Republican, strong     2314
## 3 Republican, weak       3032
## 4 Independent, near rep  1791
## 5 Independent            4119
## 6 Independent, near dem  2499
## 7 Democrat, weak         3690
## 8 Democrat, strong       3490</code></pre>
<p>Как и при любой другой группировке, нужно быть остородным, группируя вместе категории, которые являются различными, мы будем получать результаты, которые будут вводить в заблуждение.</p>
<p>Если планируется свернуть значительное количество уровней, функция <code>fct_collapse()</code> — полезное решение. Для каждой новой переменной можно предоставить вектор прежних уровней.</p>
<div class="sourceCode" id="cb1360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1360-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1360-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_collapse</span>(partyid,</a>
<a class="sourceLine" id="cb1360-3" data-line-number="3">    <span class="dt">other =</span> <span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Other party&quot;</span>),</a>
<a class="sourceLine" id="cb1360-4" data-line-number="4">    <span class="dt">rep =</span> <span class="kw">c</span>(<span class="st">&quot;Strong republican&quot;</span>, <span class="st">&quot;Not str republican&quot;</span>),</a>
<a class="sourceLine" id="cb1360-5" data-line-number="5">    <span class="dt">ind =</span> <span class="kw">c</span>(<span class="st">&quot;Ind,near rep&quot;</span>, <span class="st">&quot;Independent&quot;</span>, <span class="st">&quot;Ind,near dem&quot;</span>),</a>
<a class="sourceLine" id="cb1360-6" data-line-number="6">    <span class="dt">dem =</span> <span class="kw">c</span>(<span class="st">&quot;Not str democrat&quot;</span>, <span class="st">&quot;Strong democrat&quot;</span>)</a>
<a class="sourceLine" id="cb1360-7" data-line-number="7">  )) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1360-8" data-line-number="8"><span class="st">  </span><span class="kw">count</span>(partyid)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   partyid     n
##   &lt;fct&gt;   &lt;int&gt;
## 1 other     548
## 2 rep      5346
## 3 ind      8409
## 4 dem      7180</code></pre>
<p>Иногда может понадобится объединить все небольшие группы, для того чтобы упростить график или таблицу. Это работа функции <code>fct_lump()</code></p>
<div class="sourceCode" id="cb1362"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1362-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1362-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">relig =</span> <span class="kw">fct_lump</span>(relig)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1362-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(relig)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   relig          n
##   &lt;fct&gt;      &lt;int&gt;
## 1 Protestant 10846
## 2 Other      10637</code></pre>
<p>Такое свёртование избыточно, благо поведением функции можно управлять.</p>
<div class="sourceCode" id="cb1364"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1364-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1364-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">relig =</span> <span class="kw">fct_lump</span>(relig, <span class="dt">n =</span> <span class="dv">10</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1364-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(relig, <span class="dt">sort =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1364-4" data-line-number="4"><span class="st">  </span><span class="kw">print</span>(<span class="dt">n =</span> <span class="ot">Inf</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    relig                       n
##    &lt;fct&gt;                   &lt;int&gt;
##  1 Protestant              10846
##  2 Catholic                 5124
##  3 None                     3523
##  4 Christian                 689
##  5 Other                     458
##  6 Jewish                    388
##  7 Buddhism                  147
##  8 Inter-nondenominational   109
##  9 Moslem/islam              104
## 10 Orthodox-christian         95</code></pre>
<div id="-15.5.1.1" class="section level4">
<h4><span class="header-section-number">3.6.4.1</span> Упражнение 15.5.1.1</h4>
<div class="question">
<p>How have the proportions of people identifying as Democrat, Republican, and Independent changed over time?</p>
</div>
<p>Объединим переменную, как это делалось в главе</p>
<div class="sourceCode" id="cb1366"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1366-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1366-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">partyid =</span> <span class="kw">fct_collapse</span>(partyid,</a>
<a class="sourceLine" id="cb1366-3" data-line-number="3">    <span class="dt">other =</span> <span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Other party&quot;</span>),</a>
<a class="sourceLine" id="cb1366-4" data-line-number="4">    <span class="dt">republican =</span> <span class="kw">c</span>(<span class="st">&quot;Strong republican&quot;</span>, <span class="st">&quot;Not str republican&quot;</span>),</a>
<a class="sourceLine" id="cb1366-5" data-line-number="5">    <span class="dt">independent =</span> <span class="kw">c</span>(<span class="st">&quot;Ind,near rep&quot;</span>, <span class="st">&quot;Independent&quot;</span>, <span class="st">&quot;Ind,near dem&quot;</span>),</a>
<a class="sourceLine" id="cb1366-6" data-line-number="6">    <span class="dt">democrat =</span> <span class="kw">c</span>(<span class="st">&quot;Not str democrat&quot;</span>, <span class="st">&quot;Strong democrat&quot;</span>)</a>
<a class="sourceLine" id="cb1366-7" data-line-number="7">  )) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1366-8" data-line-number="8"><span class="st">    </span><span class="kw">count</span>(year, partyid) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1366-9" data-line-number="9"><span class="st">  </span><span class="kw">group_by</span>(year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1366-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">portion =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1366-11" data-line-number="11"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, portion, <span class="dt">color =</span> <span class="kw">fct_reorder2</span>(partyid, year, portion))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1366-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1366-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1366-14" data-line-number="14"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">y =</span> <span class="st">&quot;count&quot;</span>,</a>
<a class="sourceLine" id="cb1366-15" data-line-number="15">       <span class="dt">color =</span> <span class="st">&quot;Party&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-701-1.png" width="672" /></p>
</div>
<div id="-15.5.1.2" class="section level4">
<h4><span class="header-section-number">3.6.4.2</span> Упражнение 15.5.1.2</h4>
<div class="question">
<p>How could you collapse <code>rincome</code> into a small set of categories?</p>
</div>
<div class="sourceCode" id="cb1367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1367-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1367-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rincome)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1367-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1367-4" data-line-number="4"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-702-1.png" width="672" /></p>
<p>Мелкий доход рассмотрен по тысячам, чуть больший рассмотрен по пять тысяч.
Я бы свернул всё что меньше пяти тысяч в одну группу. От пяти до 10 в другую.
И ввёл одну специальную группу для обозначения всех кто не рассказал про свой доход.</p>
<div class="sourceCode" id="cb1368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1368-1" data-line-number="1">gss_cat <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1368-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1368-3" data-line-number="3">    <span class="dt">rincome =</span></a>
<a class="sourceLine" id="cb1368-4" data-line-number="4">      <span class="kw">fct_collapse</span>(</a>
<a class="sourceLine" id="cb1368-5" data-line-number="5">        rincome,</a>
<a class="sourceLine" id="cb1368-6" data-line-number="6">        <span class="st">`</span><span class="dt">Unknown</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;No answer&quot;</span>, <span class="st">&quot;Don&#39;t know&quot;</span>, <span class="st">&quot;Refused&quot;</span>, <span class="st">&quot;Not applicable&quot;</span>),</a>
<a class="sourceLine" id="cb1368-7" data-line-number="7">        <span class="st">`</span><span class="dt">Loss then $5000</span><span class="st">`</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Lt $1000&quot;</span>, <span class="kw">str_c</span>(</a>
<a class="sourceLine" id="cb1368-8" data-line-number="8">          <span class="st">&quot;$&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;1000&quot;</span>, <span class="st">&quot;3000&quot;</span>, <span class="st">&quot;4000&quot;</span>),</a>
<a class="sourceLine" id="cb1368-9" data-line-number="9">          <span class="st">&quot; to &quot;</span>, <span class="kw">c</span>(<span class="st">&quot;2999&quot;</span>, <span class="st">&quot;3999&quot;</span>, <span class="st">&quot;4999&quot;</span>)</a>
<a class="sourceLine" id="cb1368-10" data-line-number="10">        )),</a>
<a class="sourceLine" id="cb1368-11" data-line-number="11">        <span class="st">`</span><span class="dt">$5000 - 10000</span><span class="st">`</span> =<span class="st"> </span><span class="kw">str_c</span>(</a>
<a class="sourceLine" id="cb1368-12" data-line-number="12">          <span class="st">&quot;$&quot;</span>, <span class="kw">c</span>(<span class="st">&quot;5000&quot;</span>, <span class="st">&quot;6000&quot;</span>, <span class="st">&quot;7000&quot;</span>, <span class="st">&quot;8000&quot;</span>),</a>
<a class="sourceLine" id="cb1368-13" data-line-number="13">          <span class="st">&quot; to &quot;</span>, <span class="kw">c</span>(<span class="st">&quot;5999&quot;</span>, <span class="st">&quot;6999&quot;</span>, <span class="st">&quot;7999&quot;</span>, <span class="st">&quot;9999&quot;</span>)</a>
<a class="sourceLine" id="cb1368-14" data-line-number="14">        )</a>
<a class="sourceLine" id="cb1368-15" data-line-number="15">      )</a>
<a class="sourceLine" id="cb1368-16" data-line-number="16">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1368-17" data-line-number="17"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> rincome)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1368-18" data-line-number="18"><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1368-19" data-line-number="19"><span class="st">  </span><span class="kw">coord_flip</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-703-1.png" width="672" /></p>
<!--chapter:end:12_factors.Rmd-->
</div>
</div>
</div>
<div id="--------lubridate" class="section level2">
<h2><span class="header-section-number">3.7</span> Работа с датами и временем с помощью пакета <code>lubridate</code></h2>
<div id="-10" class="section level3">
<h3><span class="header-section-number">3.7.1</span> Введение</h3>
<p>Время не так просто как может показаться. Всему своё время, и в этой главе мы наловчимся обрабатывать время.</p>
<div id="--2" class="section level4">
<h4><span class="header-section-number">3.7.1.1</span> Используемые ресурсы</h4>
<div class="sourceCode" id="cb1369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1369-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1369-2" data-line-number="2"><span class="kw">library</span>(lubridate)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:hms&#39;:
## 
##     hms</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<div class="sourceCode" id="cb1373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1373-1" data-line-number="1"><span class="kw">library</span>(nycflights13)</a></code></pre></div>
</div>
</div>
<div id="-----" class="section level3">
<h3><span class="header-section-number">3.7.2</span> Создание перменных описывающих дату и время</h3>
<p>Существует три типа данных ссылающихся на момент времени</p>
<ul>
<li><p>дата — календарная дата, tibble выводит это как <code>&lt;date&gt;</code></p></li>
<li><p>время — время суток, tibble выводит это как <code>&lt;time&gt;</code></p></li>
<li><p>дата/время — дата время, в tibble выводится как <code>&lt;dttm&gt;</code></p></li>
</ul>
<p>Для получения текущей даты можно использовать</p>
<div class="sourceCode" id="cb1374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1374-1" data-line-number="1"><span class="kw">today</span>()</a></code></pre></div>
<pre><code>## [1] &quot;2019-07-30&quot;</code></pre>
<div class="sourceCode" id="cb1376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1376-1" data-line-number="1"><span class="kw">now</span>()</a></code></pre></div>
<pre><code>## [1] &quot;2019-07-30 23:08:09 MSK&quot;</code></pre>
<p>Существует три способа создания данных в формате даты/времени.
Рассмотрим их более подробно</p>
<div id="-----" class="section level4">
<h4><span class="header-section-number">3.7.2.1</span> Создание значений даты/времени на основе строк</h4>
<p>МОжно распарсить дату время при помощи средств пакета <code>readr</code>, это описано в главе 8.
МОжно встроенными инструментами пакета <code>lubridate</code>, для этошо есть семейство функций, которые по факту осуществляют парсинг входных данных и выводят данные в формате даты времени</p>
<div class="sourceCode" id="cb1378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1378-1" data-line-number="1"><span class="kw">ymd</span>(<span class="st">&quot;2017-01-31&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-01-31&quot;</code></pre>
<div class="sourceCode" id="cb1380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1380-1" data-line-number="1"><span class="kw">mdy</span>(<span class="st">&quot;January 31st, 2017&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-01-31&quot;</code></pre>
<div class="sourceCode" id="cb1382"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1382-1" data-line-number="1"><span class="kw">dmy</span>(<span class="st">&quot;31-Jan-2017&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-01-31&quot;</code></pre>
<p>Главное в верном порядке расставить буквы, означающие год-месяц-день.
Можно так же через нижнее подчеркивание задавать время</p>
<div class="sourceCode" id="cb1384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1384-1" data-line-number="1"><span class="kw">ymd_hms</span>(<span class="st">&quot;2017-01-31 20:11:59&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-01-31 20:11:59 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1386-1" data-line-number="1"><span class="kw">mdy_hm</span>(<span class="st">&quot;01/31/2017 08:01&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-01-31 08:01:00 UTC&quot;</code></pre>
</div>
<div id="------" class="section level4">
<h4><span class="header-section-number">3.7.2.2</span> Создание значений даты/времени на основе отдельных компонентов</h4>
<p>Иногда вместо отдельной строки, в распоряжении будет отдельный компонент, предоставленный в нескольких столбцах.</p>
<div class="sourceCode" id="cb1388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1388-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1388-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year, month, day, hour, minute)</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 5
##     year month   day  hour minute
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1  2013     1     1     5     15
##  2  2013     1     1     5     29
##  3  2013     1     1     5     40
##  4  2013     1     1     5     45
##  5  2013     1     1     6      0
##  6  2013     1     1     5     58
##  7  2013     1     1     6      0
##  8  2013     1     1     6      0
##  9  2013     1     1     6      0
## 10  2013     1     1     6      0
## # … with 336,766 more rows</code></pre>
<p>Для таких случаев есть функции <code>make_date()</code> и <code>make_datetime()</code></p>
<div class="sourceCode" id="cb1390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1390-1" data-line-number="1">flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1390-2" data-line-number="2"><span class="st">  </span><span class="kw">select</span>(year, month, day, hour, minute) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1390-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">departure =</span> <span class="kw">make_datetime</span>(year, month, day, hour, minute))</a></code></pre></div>
<pre><code>## # A tibble: 336,776 x 6
##     year month   day  hour minute departure          
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dttm&gt;             
##  1  2013     1     1     5     15 2013-01-01 05:15:00
##  2  2013     1     1     5     29 2013-01-01 05:29:00
##  3  2013     1     1     5     40 2013-01-01 05:40:00
##  4  2013     1     1     5     45 2013-01-01 05:45:00
##  5  2013     1     1     6      0 2013-01-01 06:00:00
##  6  2013     1     1     5     58 2013-01-01 05:58:00
##  7  2013     1     1     6      0 2013-01-01 06:00:00
##  8  2013     1     1     6      0 2013-01-01 06:00:00
##  9  2013     1     1     6      0 2013-01-01 06:00:00
## 10  2013     1     1     6      0 2013-01-01 06:00:00
## # … with 336,766 more rows</code></pre>
<p>Сделаем тоже самое для таблиц <code>flights</code> связанные со временем.</p>
<div class="sourceCode" id="cb1392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1392-1" data-line-number="1">make_datetime_<span class="dv">100</span> &lt;-<span class="st"> </span><span class="cf">function</span>(year, month, day, time) {</a>
<a class="sourceLine" id="cb1392-2" data-line-number="2">  <span class="kw">make_datetime</span>(year, month, day, time <span class="op">%/%</span><span class="st"> </span><span class="dv">100</span>, time <span class="op">%%</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb1392-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1392-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1392-5" data-line-number="5">flights_dt &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1392-6" data-line-number="6"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_time), <span class="op">!</span><span class="kw">is.na</span>(arr_time)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1392-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1392-8" data-line-number="8">    <span class="dt">dep_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, dep_time),</a>
<a class="sourceLine" id="cb1392-9" data-line-number="9">    <span class="dt">arr_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, arr_time),</a>
<a class="sourceLine" id="cb1392-10" data-line-number="10">    <span class="dt">sched_dep_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, sched_dep_time),</a>
<a class="sourceLine" id="cb1392-11" data-line-number="11">    <span class="dt">sched_arr_time =</span> <span class="kw">make_datetime_100</span>(year, month, day, sched_arr_time)</a>
<a class="sourceLine" id="cb1392-12" data-line-number="12">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1392-13" data-line-number="13"><span class="st">  </span><span class="kw">select</span>(origin, dest, <span class="kw">ends_with</span>(<span class="st">&quot;delay&quot;</span>), <span class="kw">ends_with</span>(<span class="st">&quot;time&quot;</span>))</a>
<a class="sourceLine" id="cb1392-14" data-line-number="14"></a>
<a class="sourceLine" id="cb1392-15" data-line-number="15">flights_dt</a></code></pre></div>
<pre><code>## # A tibble: 328,063 x 9
##    origin dest  dep_delay arr_delay dep_time            sched_dep_time     
##    &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             
##  1 EWR    IAH           2        11 2013-01-01 05:17:00 2013-01-01 05:15:00
##  2 LGA    IAH           4        20 2013-01-01 05:33:00 2013-01-01 05:29:00
##  3 JFK    MIA           2        33 2013-01-01 05:42:00 2013-01-01 05:40:00
##  4 JFK    BQN          -1       -18 2013-01-01 05:44:00 2013-01-01 05:45:00
##  5 LGA    ATL          -6       -25 2013-01-01 05:54:00 2013-01-01 06:00:00
##  6 EWR    ORD          -4        12 2013-01-01 05:54:00 2013-01-01 05:58:00
##  7 EWR    FLL          -5        19 2013-01-01 05:55:00 2013-01-01 06:00:00
##  8 LGA    IAD          -3       -14 2013-01-01 05:57:00 2013-01-01 06:00:00
##  9 JFK    MCO          -3        -8 2013-01-01 05:57:00 2013-01-01 06:00:00
## 10 LGA    ORD          -2         8 2013-01-01 05:58:00 2013-01-01 06:00:00
## # … with 328,053 more rows, and 3 more variables: arr_time &lt;dttm&gt;,
## #   sched_arr_time &lt;dttm&gt;, air_time &lt;dbl&gt;</code></pre>
<p>Используя эти данные мы можем визуализировать распределение времени вылета на протяжении года</p>
<div class="sourceCode" id="cb1394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1394-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1394-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dep_time)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1394-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">86400</span>) <span class="co"># 86400 seconds = 1 day</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-711-1.png" width="672" /></p>
<p>Или на протяжении одного дня</p>
<div class="sourceCode" id="cb1395"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1395-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1395-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(dep_time <span class="op">&lt;</span><span class="st"> </span><span class="kw">ymd</span>(<span class="dv">20130102</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1395-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dep_time)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1395-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">600</span>) <span class="co"># 600 s = 10 minutes</span></a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-712-1.png" width="672" /></p>
<p>При построении значений даты/времени в числовом контексте, как в случае гистограммы, 1 означает одну секунду, поэтому значению параметра <code>binwidth</code> равному 86400 соответствует один день. Для дат значению 1 соответствует один день</p>
</div>
<div id="------" class="section level4">
<h4><span class="header-section-number">3.7.2.3</span> Создание значений даты/времени на основе других типов</h4>
<p>Может возникнуть необходимость в переходе между значениями даты/времени и даты.
Это работа функций <code>as_datetime()</code> и <code>as_date()</code></p>
<div class="sourceCode" id="cb1396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1396-1" data-line-number="1"><span class="kw">as_datetime</span>(<span class="kw">today</span>())</a></code></pre></div>
<pre><code>## [1] &quot;2019-07-30 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1398-1" data-line-number="1"><span class="kw">as_date</span>(<span class="kw">now</span>())</a></code></pre></div>
<pre><code>## [1] &quot;2019-07-30&quot;</code></pre>
</div>
<div id="-16.2.4.1" class="section level4">
<h4><span class="header-section-number">3.7.2.4</span> Упражнение 16.2.4.1</h4>
<div class="question">
<p>What happens if you parse a string that contains invalid dates?</p>
<div class="sourceCode" id="cb1400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1400-1" data-line-number="1"><span class="kw">print</span>(<span class="kw">class</span>(<span class="kw">ymd</span>(<span class="kw">c</span>(<span class="st">&quot;2010-10-10&quot;</span>, <span class="st">&quot;bananas&quot;</span>))))</a></code></pre></div>
<pre><code>## Warning: 1 failed to parse.</code></pre>
<pre><code>## [1] &quot;Date&quot;</code></pre>
</div>
<p>Функция создает NA и предупреждающее сообщение.</p>
</div>
<div id="-16.2.4.2" class="section level4">
<h4><span class="header-section-number">3.7.2.5</span> Упражнение 16.2.4.2</h4>
<div class="question">
<p>What does the <code>tzone</code> argument to today() do? Why is it important?</p>
</div>
<p>Часовой пояс.
Он определяет часовой пояс даты.
Поскольку разные часовые пояса могут иметь разные даты, значение <code>today()</code> может варьироваться в зависимости от указанного часового пояса.</p>
</div>
<div id="-16.2.4.3" class="section level4">
<h4><span class="header-section-number">3.7.2.6</span> Упражнение 16.2.4.3</h4>
<div class="question">
<p>Use the appropriate lubridate function to parse each of the following dates:</p>
<div class="sourceCode" id="cb1403"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1403-1" data-line-number="1">d1 &lt;-<span class="st"> &quot;January 1, 2010&quot;</span></a>
<a class="sourceLine" id="cb1403-2" data-line-number="2">d2 &lt;-<span class="st"> &quot;2015-Mar-07&quot;</span></a>
<a class="sourceLine" id="cb1403-3" data-line-number="3">d3 &lt;-<span class="st"> &quot;06-Jun-2017&quot;</span></a>
<a class="sourceLine" id="cb1403-4" data-line-number="4">d4 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;August 19 (2015)&quot;</span>, <span class="st">&quot;July 1 (2015)&quot;</span>)</a>
<a class="sourceLine" id="cb1403-5" data-line-number="5">d5 &lt;-<span class="st"> &quot;12/30/14&quot;</span> <span class="co"># Dec 30, 2014</span></a></code></pre></div>
</div>
<div class="sourceCode" id="cb1404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1404-1" data-line-number="1"><span class="kw">mdy</span>(d1)</a></code></pre></div>
<pre><code>## [1] &quot;2010-01-01&quot;</code></pre>
<div class="sourceCode" id="cb1406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1406-1" data-line-number="1"><span class="kw">ymd</span>(d2)</a></code></pre></div>
<pre><code>## [1] &quot;2015-03-07&quot;</code></pre>
<div class="sourceCode" id="cb1408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1408-1" data-line-number="1"><span class="kw">dmy</span>(d3)</a></code></pre></div>
<pre><code>## [1] &quot;2017-06-06&quot;</code></pre>
<div class="sourceCode" id="cb1410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1410-1" data-line-number="1"><span class="kw">mdy</span>(d4)</a></code></pre></div>
<pre><code>## [1] &quot;2015-08-19&quot; &quot;2015-07-01&quot;</code></pre>
<div class="sourceCode" id="cb1412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1412-1" data-line-number="1"><span class="kw">mdy</span>(d5)</a></code></pre></div>
<pre><code>## [1] &quot;2014-12-30&quot;</code></pre>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.7.3</span> Компоненты даты/времени</h3>
<p>В этом разделе наше внимание будет сосредоточено на функциях доступа, позволяющих получать и устанавливать значения отдельных компонентов.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">3.7.3.1</span> Получение компонентов</h4>
<p>Для извлечения отдельных компонентов предназначены функции</p>
<p><code>year()</code>,
<code>month()</code>,
<code>mday()</code> (day of the month),
<code>yday()</code> (day of the year),
<code>wday()</code> (day of the week),
<code>hour()</code>,
<code>minute()</code>,
<code>second()</code></p>
<div class="sourceCode" id="cb1414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1414-1" data-line-number="1">datetime &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2016-07-08 12:34:56&quot;</span>)</a>
<a class="sourceLine" id="cb1414-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1414-3" data-line-number="3"><span class="kw">year</span>(datetime)</a></code></pre></div>
<pre><code>## [1] 2016</code></pre>
<div class="sourceCode" id="cb1416"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1416-1" data-line-number="1"><span class="kw">month</span>(datetime)</a></code></pre></div>
<pre><code>## [1] 7</code></pre>
<div class="sourceCode" id="cb1418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1418-1" data-line-number="1"><span class="kw">mday</span>(datetime)</a></code></pre></div>
<pre><code>## [1] 8</code></pre>
<div class="sourceCode" id="cb1420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1420-1" data-line-number="1"><span class="kw">yday</span>(datetime)</a></code></pre></div>
<pre><code>## [1] 190</code></pre>
<div class="sourceCode" id="cb1422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1422-1" data-line-number="1"><span class="kw">wday</span>(datetime)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Можно передать функция аргумент <code>label = TRUE</code> чтобы получить сокращенное название месяца или дня недели. ЧТобы получить полное нзвание, задайте аргумент <code>abbr = FALSE</code></p>
<div class="sourceCode" id="cb1424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1424-1" data-line-number="1"><span class="kw">month</span>(datetime, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] июл
## 12 Levels: янв &lt; фев &lt; мар &lt; апр &lt; май &lt; июн &lt; июл &lt; авг &lt; сен &lt; ... &lt; дек</code></pre>
<div class="sourceCode" id="cb1426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1426-1" data-line-number="1"><span class="kw">wday</span>(datetime, <span class="dt">label =</span> <span class="ot">TRUE</span>, <span class="dt">abbr =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] пятница
## 7 Levels: воскресенье &lt; понедельник &lt; вторник &lt; среда &lt; ... &lt; суббота</code></pre>
<p>Мы можем использовать функцию <code>wday()</code> для того чтобы убедится, что количество вылетов на протяжении недели больше чем в выходные дни</p>
<div class="sourceCode" id="cb1428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1428-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1428-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(dep_time, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1428-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> wday)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1428-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_bar</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-719-1.png" width="672" /></p>
<p>В поведении среднего времени задержки вылета в зависимости от минуты часа наблюдается любопытная закономерность.
Похоже, что для авиарейсов, вылетающих в минутные интервалы часа 20-30 и 50-60, задержки намного меньше, чем для остальных временных промежутков.</p>
<div class="sourceCode" id="cb1429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1429-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1429-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">minute =</span> <span class="kw">minute</span>(dep_time)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1429-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1429-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb1429-5" data-line-number="5">    <span class="dt">avg_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1429-6" data-line-number="6">    <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1429-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(minute, avg_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1429-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-720-1.png" width="672" /></p>
<p>Интересно, что если взглянуть на время вылета по расписанию, то никакой ярко выраженной закономерности не наблюдается</p>
<div class="sourceCode" id="cb1430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1430-1" data-line-number="1">sched_dep &lt;-<span class="st"> </span>flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1430-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">minute =</span> <span class="kw">minute</span>(sched_dep_time)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1430-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1430-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb1430-5" data-line-number="5">    <span class="dt">avg_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1430-6" data-line-number="6">    <span class="dt">n =</span> <span class="kw">n</span>())</a>
<a class="sourceLine" id="cb1430-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1430-8" data-line-number="8"><span class="kw">ggplot</span>(sched_dep, <span class="kw">aes</span>(minute, avg_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1430-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-721-1.png" width="672" /></p>
<p>Так почему же нам удается наблюдать закономерность, в фактическом времени вылета? Подобно многим другим данным, подготовленным людьми, здесь наблюдаеися отчетливое смещение в сторону авиарейсов, отправляющихся в круглое время. Работая с данными, подверженными влиянию человеческих суждений, всегда надо быть настороже!</p>
<div class="sourceCode" id="cb1431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1431-1" data-line-number="1"><span class="kw">ggplot</span>(sched_dep, <span class="kw">aes</span>(minute, n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1431-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-722-1.png" width="672" /></p>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.7.3.2</span> Округление</h4>
<p>Альтернативный подход к построению графиков отдельных компонент — округление даты до ближайшей единицы времени с помощью функций
<code>floor_date()</code>, <code>round_date()</code>, <code>ceiling_date()</code>. Каждая из этих функций принимает вектор дат, подлежащих округлению и название единицы, до которой должно выполняться округление вниз <code>floor</code>, округление вверх <code>ceiling</code>, или до ближайшего значения <code>round</code>. Это например, позволяет построить график количества авиарейсов в неделю.</p>
<div class="sourceCode" id="cb1432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1432-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1432-2" data-line-number="2"><span class="st">  </span><span class="kw">count</span>(<span class="dt">week =</span> <span class="kw">floor_date</span>(dep_time, <span class="st">&quot;week&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1432-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(week, n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1432-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-723-1.png" width="672" /></p>
<p>Особенно полезно может быть вычсиление разницы между округленной и неокруглённой датой.</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">3.7.3.3</span> Задание значений компонентов</h4>
<p>Функции доступа так же позволяет устанавливать значения компонентов даты/времени.</p>
<div class="sourceCode" id="cb1433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1433-1" data-line-number="1">(datetime &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2016-07-08 12:34:56&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;2016-07-08 12:34:56 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1435-1" data-line-number="1"><span class="kw">year</span>(datetime) &lt;-<span class="st"> </span><span class="dv">2020</span></a>
<a class="sourceLine" id="cb1435-2" data-line-number="2">datetime</a></code></pre></div>
<pre><code>## [1] &quot;2020-07-08 12:34:56 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1437-1" data-line-number="1"><span class="kw">month</span>(datetime) &lt;-<span class="st"> </span><span class="dv">01</span></a>
<a class="sourceLine" id="cb1437-2" data-line-number="2">datetime</a></code></pre></div>
<pre><code>## [1] &quot;2020-01-08 12:34:56 UTC&quot;</code></pre>
<div class="sourceCode" id="cb1439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1439-1" data-line-number="1"><span class="kw">hour</span>(datetime) &lt;-<span class="st"> </span><span class="kw">hour</span>(datetime) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1439-2" data-line-number="2">datetime</a></code></pre></div>
<pre><code>## [1] &quot;2020-01-08 13:34:56 UTC&quot;</code></pre>
<p>Альтернативный вариант позволяет не изменять значения на месте, а создавать новые значения с помощью функции <code>update()</code>. Кроме того можно устанавливать одновременно несколько значений.</p>
<div class="sourceCode" id="cb1441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1441-1" data-line-number="1"><span class="kw">update</span>(datetime, <span class="dt">year =</span> <span class="dv">2020</span>, <span class="dt">month =</span> <span class="dv">2</span>, <span class="dt">mday =</span> <span class="dv">2</span>, <span class="dt">hour =</span> <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2020-02-02 02:34:56 UTC&quot;</code></pre>
<p>Если значения слишком велики, они “закольцовываются”</p>
<div class="sourceCode" id="cb1443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1443-1" data-line-number="1"><span class="kw">ymd</span>(<span class="st">&quot;2015-02-01&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1443-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(<span class="dt">mday =</span> <span class="dv">30</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2015-03-02&quot;</code></pre>
<div class="sourceCode" id="cb1445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1445-1" data-line-number="1"><span class="kw">ymd</span>(<span class="st">&quot;2015-02-01&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1445-2" data-line-number="2"><span class="st">  </span><span class="kw">update</span>(<span class="dt">hour =</span> <span class="dv">400</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2015-02-17 16:00:00 UTC&quot;</code></pre>
<p>Функцию <code>update()</code> можно использовать для того, чтобы отобразить распределение авиарейсов на протяжении дня для каждого дня в году</p>
<div class="sourceCode" id="cb1447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1447-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1447-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dep_hour =</span> <span class="kw">update</span>(dep_time, <span class="dt">yday =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1447-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dep_hour)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1447-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">300</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-727-1.png" width="672" /></p>
<p>Задание для более крупных компонентов даты постоянного значения — удобная методика, позволяющая исследовать закономерности, связанные с меньшими компонентами.</p>
</div>
<div id="-16.3.4.1" class="section level4">
<h4><span class="header-section-number">3.7.3.4</span> Упражнение 16.3.4.1</h4>
<div class="question">
<p>How does the distribution of flight times within a day change over the course of the year?</p>
</div>
<p>Давайте попробуем построить помесячный график.</p>
<div class="sourceCode" id="cb1448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1448-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1448-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1448-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dep_hour =</span> <span class="kw">update</span>(dep_time, <span class="dt">yday =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1448-4" data-line-number="4">         <span class="dt">month =</span> <span class="kw">factor</span>(<span class="kw">month</span>(dep_time))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1448-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dep_hour, <span class="dt">color =</span> month)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1448-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-728-1.png" width="672" /></p>
<p>Чтобы убрать отклонения заметные отклонения между месяцами из-за разного количества дней в месяце, нужно отнормировать построение</p>
<div class="sourceCode" id="cb1449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1449-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1449-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1449-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dep_hour =</span> <span class="kw">update</span>(dep_time, <span class="dt">yday =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1449-4" data-line-number="4">         <span class="dt">month =</span> <span class="kw">factor</span>(<span class="kw">month</span>(dep_time))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1449-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(dep_hour, <span class="dt">color =</span> month)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1449-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ..density..), <span class="dt">binwidth =</span> <span class="dv">60</span> <span class="op">*</span><span class="st"> </span><span class="dv">60</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-729-1.png" width="672" /></p>
</div>
<div id="-16.3.4.2" class="section level4">
<h4><span class="header-section-number">3.7.3.5</span> Упражнение 16.3.4.2</h4>
<div class="question">
<p>Compare <code>dep_time</code>, <code>sched_dep_time</code> and <code>dep_delay</code>. Are they consistent? Explain your findings.</p>
</div>
<div class="sourceCode" id="cb1450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1450-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1450-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">residual =</span> (dep_time <span class="op">-</span><span class="st"> </span>sched_dep_time) <span class="op">/</span><span class="st"> </span><span class="dv">60</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1450-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(residual <span class="op">!=</span><span class="st"> </span>dep_delay) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1450-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(residual, dep_time, sched_dep_time, dep_delay)</a></code></pre></div>
<pre><code>## # A tibble: 1,205 x 4
##    residual   dep_time            sched_dep_time      dep_delay
##    &lt;time&gt;     &lt;dttm&gt;              &lt;dttm&gt;                  &lt;dbl&gt;
##  1  -587 secs 2013-01-01 08:48:00 2013-01-01 18:35:00       853
##  2 -1397 secs 2013-01-02 00:42:00 2013-01-02 23:59:00        43
##  3 -1284 secs 2013-01-02 01:26:00 2013-01-02 22:50:00       156
##  4 -1407 secs 2013-01-03 00:32:00 2013-01-03 23:59:00        33
##  5 -1255 secs 2013-01-03 00:50:00 2013-01-03 21:45:00       185
##  6 -1284 secs 2013-01-03 02:35:00 2013-01-03 23:59:00       156
##  7 -1414 secs 2013-01-04 00:25:00 2013-01-04 23:59:00        26
##  8 -1299 secs 2013-01-04 01:06:00 2013-01-04 22:45:00       141
##  9 -1425 secs 2013-01-05 00:14:00 2013-01-05 23:59:00        15
## 10 -1313 secs 2013-01-05 00:37:00 2013-01-05 22:30:00       127
## # … with 1,195 more rows</code></pre>
<p>Существуют расхождения.
Похоже, в данных есть ошибки.
Это рейсы, в которых фактическое время отправления на следующий день относительно запланированного времени отправления.
Мы забыли учесть это при создании даты и времени с помощью функции <code>make_datetime_100()</code> в 16.2.2 из отдельных компонентов.
Код должен был бы проверить, если время отправления меньше запланированного времени отправления плюс задержка отправления (в минутах). В качестве альтернативы, простое добавление задержки отправления к запланированному времени отправления является более надежным способом построения времени отправления, поскольку оно автоматически учитывает переход на следующий день.</p>
</div>
<div id="-16.3.4.3" class="section level4">
<h4><span class="header-section-number">3.7.3.6</span> Упражнение 16.3.4.3</h4>
<div class="question">
<p>Compare <code>air_time</code> with the duration between the departure and arrival.
Explain your findings.
(Hint: consider the location of the airport.)</p>
</div>
<div class="sourceCode" id="cb1452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1452-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1452-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">residual =</span> <span class="kw">as.numeric</span>(arr_time <span class="op">-</span><span class="st"> </span>dep_time),</a>
<a class="sourceLine" id="cb1452-3" data-line-number="3">         <span class="dt">diff =</span> residual <span class="op">-</span><span class="st"> </span>air_time) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1452-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(origin, dest, residual, air_time, diff, arr_time, dep_time) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1452-5" data-line-number="5"><span class="st">  </span><span class="kw">group_by</span>(diff) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1452-6" data-line-number="6"><span class="st">  </span><span class="kw">count</span>(diff) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1452-7" data-line-number="7"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(diff)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1452-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(diff, n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1452-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">alpha =</span> <span class="fl">0.25</span>, <span class="dt">width =</span> <span class="dv">0</span>, <span class="dt">height =</span> <span class="fl">0.2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1452-10" data-line-number="10"><span class="st">  </span><span class="kw">scale_x_log10</span>()</a></code></pre></div>
<pre><code>## Warning in self$trans$transform(x): созданы NaN</code></pre>
<pre><code>## Warning: Transformation introduced infinite values in continuous x-axis</code></pre>
<pre><code>## Warning: Removed 579 rows containing missing values (geom_point).</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-731-1.png" width="672" /></p>
<p>Большая часть точек лежит в области отклонения. Вероятно, это связано с переводом времени.</p>
</div>
<div id="-16.3.4.4" class="section level4">
<h4><span class="header-section-number">3.7.3.7</span> Упражнение 16.3.4.4</h4>
<div class="question">
<p>How does the average delay time change over the course of a day? Should you use <code>dep_time</code> or <code>sched_dep_time</code>? Why?</p>
</div>
<p>Будем брать запланированное время вылета.
Потому что это заявленная характеристика вылета, и на неё можно ореентироваться.
КРоме того использование <code>dep_time</code> всегда смещает задержки на более поздний день.</p>
<div class="sourceCode" id="cb1456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1456-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1456-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sched_dep_hour =</span> <span class="kw">hour</span>(sched_dep_time)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1456-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(sched_dep_hour) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1456-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">dep_delay =</span> <span class="kw">mean</span>(dep_delay)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1456-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> dep_delay, <span class="dt">x =</span> sched_dep_hour)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1456-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1456-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_smooth</span>()</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-732-1.png" width="672" /></p>
<p>Как видно на графике, самые большие задержки плавно возрастают в течении дня, и за пару часов до полуночи, немного спадают. При этом пик образуется в районе 19 часов.</p>
</div>
<div id="-16.3.4.5" class="section level4">
<h4><span class="header-section-number">3.7.3.8</span> Упражнение 16.3.4.5</h4>
<div class="question">
<p>On what day of the week should you leave if you want to minimise the chance of a delay?</p>
</div>
<p>Чтобы ответить на этот вопрос, нужно посчитать среднее время задержки в каждом дне недели</p>
<div class="sourceCode" id="cb1458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1458-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1458-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(sched_dep_time, <span class="dt">label =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1458-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(wday) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1458-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_wday_arr_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1458-5" data-line-number="5">            <span class="dt">mean_wday_dep_delay =</span> <span class="kw">mean</span>(dep_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1458-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(mean_wday_dep_delay, mean_wday_arr_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1458-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb1458-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">label =</span> wday), <span class="dt">vjust =</span> <span class="fl">1.2</span>, <span class="dt">hjust =</span> <span class="fl">1.2</span>, <span class="dt">check_overlap =</span> <span class="ot">TRUE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb1458-9" data-line-number="9"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Среднее время задержки вылета, минут&quot;</span>,</a>
<a class="sourceLine" id="cb1458-10" data-line-number="10">       <span class="dt">y =</span> <span class="st">&quot;Среднее время задержки прилёта, минут&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-733-1.png" width="672" /></p>
<p>Очевидно, я бы выбрал для полёта субботу</p>
</div>
<div id="-16.3.4.6" class="section level4">
<h4><span class="header-section-number">3.7.3.9</span> Упражнение 16.3.4.6</h4>
<div class="question">
<p>What makes the distribution of <code>diamonds$carat</code> and <code>flights$sched_dep_time</code> similar?</p>
</div>
<div class="sourceCode" id="cb1459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1459-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(<span class="dt">x =</span> carat <span class="op">%%</span><span class="st"> </span><span class="dv">1</span> <span class="op">*</span><span class="st"> </span><span class="dv">100</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1459-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-734-1.png" width="672" /></p>
<div class="sourceCode" id="cb1460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1460-1" data-line-number="1"><span class="kw">ggplot</span>(flights_dt, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">minute</span>(sched_dep_time))) <span class="op">+</span></a>
<a class="sourceLine" id="cb1460-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-735-1.png" width="672" /></p>
<p>И в <code>diamonds$carat</code>, и в <code>flights$sched_dep_time</code> есть аномально большие значения, которые находятся под хорошими «человеческими» числами.
В <code>flights$sched_dep_time</code> это минуты 00 и 30 минут и кратные 0 и 5 минутам.</p>
<p>В <code>diamonds$carat</code> это в 0, 1/3, 1/2, 2/3.</p>
</div>
<div id="-16.3.4.7" class="section level4">
<h4><span class="header-section-number">3.7.3.10</span> Упражнение 16.3.4.7</h4>
<div class="question">
<p>Confirm my hypothesis that the early departures of flights in minutes 20-30 and 50-60 are caused by scheduled flights that leave early.
Hint: create a binary variable that tells you whether or not a flight was delayed</p>
</div>
<div class="sourceCode" id="cb1461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1461-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">minute =</span> <span class="kw">minute</span>(dep_time)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb1461-5" data-line-number="5">    <span class="dt">avg_delay =</span> <span class="kw">mean</span>(arr_delay, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb1461-6" data-line-number="6">    <span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1461-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(minute, avg_delay)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1461-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-736-1.png" width="672" /></p>
<p>На минутном уровне ничего не появляется:</p>
<div class="sourceCode" id="cb1462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1462-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1462-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1462-3" data-line-number="3">    <span class="dt">early =</span> dep_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1462-4" data-line-number="4">    <span class="dt">minute =</span> <span class="kw">minute</span>(sched_dep_time)</a>
<a class="sourceLine" id="cb1462-5" data-line-number="5">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1462-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1462-7" data-line-number="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">early =</span> <span class="kw">mean</span>(early)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1462-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> minute, <span class="dt">y =</span> early)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1462-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-737-1.png" width="672" /></p>
<p>Но если сгруппировать с 10-минутными интервалами, то в эти минуты будет больше доля ранних рейсов.</p>
<div class="sourceCode" id="cb1463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1463-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1463-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1463-3" data-line-number="3">    <span class="dt">early =</span> dep_delay <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb1463-4" data-line-number="4">    <span class="dt">minute =</span> <span class="kw">minute</span>(sched_dep_time) <span class="op">%%</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1463-5" data-line-number="5">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1463-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(minute) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1463-7" data-line-number="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">early =</span> <span class="kw">mean</span>(early)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1463-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> minute, <span class="dt">y =</span> early)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1463-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-738-1.png" width="672" /></p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.7.4</span> Временные промежутки</h3>
<ul>
<li><p>длительности — количество секунд</p></li>
<li><p>периоды — представляют промежутки времени, используемые людьми, такие как недели или месяцы</p></li>
<li><p>интервалы — начальный и конечный моменты времени</p></li>
</ul>
<div class="section level4">
<h4><span class="header-section-number">3.7.4.1</span> Длительности</h4>
<p>При вычитании двух дат в <code>R</code> получется объект <code>difftime</code></p>
<div class="sourceCode" id="cb1464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1464-1" data-line-number="1">h_age &lt;-<span class="st"> </span><span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">ymd</span>(<span class="dv">19921020</span>)</a>
<a class="sourceLine" id="cb1464-2" data-line-number="2">h_age</a></code></pre></div>
<pre><code>## Time difference of 9779 days</code></pre>
<p>Объект класса <code>difftime</code> записывает временные промежутки, выраженные в секундах, минутах, часах, днях или неделях. Эта неоднозначность может несколько затруднить работсу с объектами <code>difftime</code>, поэтому пакет <code>lubridate</code> предоставляет альтернативу — длительности <code>duration</code>, которая всегда выржается в секундах.</p>
<div class="sourceCode" id="cb1466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1466-1" data-line-number="1"><span class="kw">as.duration</span>(h_age)</a></code></pre></div>
<pre><code>## [1] &quot;844905600s (~26.77 years)&quot;</code></pre>
<p>Для длительностей предусмотрен целый ряд удобных конструкторов</p>
<div class="sourceCode" id="cb1468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1468-1" data-line-number="1"><span class="kw">dseconds</span>(<span class="dv">15</span>)</a></code></pre></div>
<pre><code>## [1] &quot;15s&quot;</code></pre>
<div class="sourceCode" id="cb1470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1470-1" data-line-number="1"><span class="kw">dminutes</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] &quot;600s (~10 minutes)&quot;</code></pre>
<div class="sourceCode" id="cb1472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1472-1" data-line-number="1"><span class="kw">dhours</span>(<span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">24</span>))</a></code></pre></div>
<pre><code>## [1] &quot;43200s (~12 hours)&quot; &quot;86400s (~1 days)&quot;</code></pre>
<div class="sourceCode" id="cb1474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1474-1" data-line-number="1"><span class="kw">ddays</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] &quot;0s&quot;                &quot;86400s (~1 days)&quot;  &quot;172800s (~2 days)&quot;
## [4] &quot;259200s (~3 days)&quot; &quot;345600s (~4 days)&quot; &quot;432000s (~5 days)&quot;</code></pre>
<div class="sourceCode" id="cb1476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1476-1" data-line-number="1"><span class="kw">dweeks</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;1814400s (~3 weeks)&quot;</code></pre>
<div class="sourceCode" id="cb1478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1478-1" data-line-number="1"><span class="kw">dyears</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;31536000s (~52.14 weeks)&quot;</code></pre>
<p>Длительности всегда выражают временные промежутки в секундах. Длительность можно умножать и складывать.</p>
<div class="sourceCode" id="cb1480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1480-1" data-line-number="1"><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">dyears</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;63072000s (~2 years)&quot;</code></pre>
<div class="sourceCode" id="cb1482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1482-1" data-line-number="1"><span class="kw">dyears</span>(<span class="dv">1</span>) <span class="op">+</span><span class="st"> </span><span class="kw">dweeks</span>(<span class="dv">3</span>) <span class="op">+</span><span class="st"> </span><span class="kw">dhours</span>(<span class="dv">15</span>)</a></code></pre></div>
<pre><code>## [1] &quot;33404400s (~1.06 years)&quot;</code></pre>
<p>Длительности могут участвовать в операциях сложения и вычитания совместно с днями.</p>
<div class="sourceCode" id="cb1484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1484-1" data-line-number="1">tomorrow &lt;-<span class="st"> </span><span class="kw">today</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ddays</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1484-2" data-line-number="2">last_year &lt;-<span class="st"> </span><span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">dyears</span>(<span class="dv">1</span>)</a></code></pre></div>
<p>Вместе с тем, поскольку длительности предоставляют точное количество секунд, можно получить неожиданные результаты.</p>
<div class="sourceCode" id="cb1485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1485-1" data-line-number="1">one_pm &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(</a>
<a class="sourceLine" id="cb1485-2" data-line-number="2">  <span class="st">&quot;2016-03-12 13:00:00&quot;</span>,</a>
<a class="sourceLine" id="cb1485-3" data-line-number="3">  <span class="dt">tz =</span> <span class="st">&quot;America/New_York&quot;</span></a>
<a class="sourceLine" id="cb1485-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb1485-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1485-6" data-line-number="6">one_pm</a></code></pre></div>
<pre><code>## [1] &quot;2016-03-12 13:00:00 EST&quot;</code></pre>
<div class="sourceCode" id="cb1487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1487-1" data-line-number="1">one_pm <span class="op">+</span><span class="st"> </span><span class="kw">ddays</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2016-03-13 14:00:00 EDT&quot;</code></pre>
<p>Почему момент времени спустя сутки после 13:00 12 марта получился равным 14:00 13 марта. Это всё потому что произошло изменение часового пояса. ВВиду перехода на летнее время 12 марта содержит лишь 23 часа, но после добавления полных суток, выраженных в секундах, мы получаем доугой результат.</p>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.7.4.2</span> Периоды</h4>
<p>Для разрешения этой проблемы пакет <code>lubridate</code> предоставляет <em>периоды</em>.
Это временные промежуткт, но оги не работают с фиксированной длительностью, выраженной в секундах. а используют такие единицы, используемые людьми, как дни и месяцы, благодаря чему работюь более интуитивным образом.</p>
<div class="sourceCode" id="cb1489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1489-1" data-line-number="1">one_pm</a></code></pre></div>
<pre><code>## [1] &quot;2016-03-12 13:00:00 EST&quot;</code></pre>
<div class="sourceCode" id="cb1491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1491-1" data-line-number="1">one_pm <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2016-03-13 13:00:00 EDT&quot;</code></pre>
<p>Подобно длительностям, периоды можно создавать с помощью целого ряда собственных функций конструкторов.</p>
<div class="sourceCode" id="cb1493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1493-1" data-line-number="1"><span class="kw">seconds</span>(<span class="dv">15</span>)</a></code></pre></div>
<pre><code>## [1] &quot;15S&quot;</code></pre>
<div class="sourceCode" id="cb1495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1495-1" data-line-number="1"><span class="kw">minutes</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] &quot;10M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1497-1" data-line-number="1"><span class="kw">hours</span>(<span class="kw">c</span>(<span class="dv">12</span>, <span class="dv">24</span>))</a></code></pre></div>
<pre><code>## [1] &quot;12H 0M 0S&quot; &quot;24H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1499-1" data-line-number="1"><span class="kw">days</span>(<span class="dv">7</span>)</a></code></pre></div>
<pre><code>## [1] &quot;7d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1501"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1501-1" data-line-number="1"><span class="kw">months</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</a></code></pre></div>
<pre><code>## [1] &quot;1m 0d 0H 0M 0S&quot; &quot;2m 0d 0H 0M 0S&quot; &quot;3m 0d 0H 0M 0S&quot; &quot;4m 0d 0H 0M 0S&quot;
## [5] &quot;5m 0d 0H 0M 0S&quot; &quot;6m 0d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1503"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1503-1" data-line-number="1"><span class="kw">weeks</span>(<span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] &quot;21d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1505-1" data-line-number="1"><span class="kw">years</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;1y 0m 0d 0H 0M 0S&quot;</code></pre>
<p>Периоды можно складывать и умножать на числа</p>
<div class="sourceCode" id="cb1507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1507-1" data-line-number="1"><span class="dv">10</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">months</span>(<span class="dv">6</span>) <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>))</a></code></pre></div>
<pre><code>## [1] &quot;60m 10d 0H 0M 0S&quot;</code></pre>
<div class="sourceCode" id="cb1509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1509-1" data-line-number="1"><span class="kw">days</span>(<span class="dv">50</span>) <span class="op">+</span><span class="st"> </span><span class="kw">hours</span>(<span class="dv">25</span>) <span class="op">+</span><span class="st"> </span><span class="kw">minutes</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] &quot;50d 25H 2M 0S&quot;</code></pre>
<p>Периоды можно так же складывать с датами. В отличае от длительностей, работая с периодами вы будете полчать резльтаты в соответствии со своими ожиданиями.</p>
<div class="sourceCode" id="cb1511"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1511-1" data-line-number="1"><span class="co"># Високосный год</span></a>
<a class="sourceLine" id="cb1511-2" data-line-number="2"><span class="kw">ymd</span>(<span class="st">&quot;2016-01-01&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">dyears</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2016-12-31&quot;</code></pre>
<div class="sourceCode" id="cb1513"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1513-1" data-line-number="1"><span class="kw">ymd</span>(<span class="st">&quot;2016-01-01&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2017-01-01&quot;</code></pre>
<div class="sourceCode" id="cb1515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1515-1" data-line-number="1"><span class="co"># Переход на летнее время</span></a>
<a class="sourceLine" id="cb1515-2" data-line-number="2">one_pm <span class="op">+</span><span class="st"> </span><span class="kw">ddays</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2016-03-13 14:00:00 EDT&quot;</code></pre>
<div class="sourceCode" id="cb1517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1517-1" data-line-number="1">one_pm <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;2016-03-13 13:00:00 EDT&quot;</code></pre>
<p>Давайте используем периоды для устранения кажущихся странностей, связанных с датами авиарейсов. Некоторые самолёты, если верить данным, прилетают в пункт назначения еще до того, как вылетели из Нью-Йорка!</p>
<div class="sourceCode" id="cb1519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1519-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1519-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(arr_time <span class="op">&lt;</span><span class="st"> </span>dep_time)</a></code></pre></div>
<pre><code>## # A tibble: 10,633 x 9
##    origin dest  dep_delay arr_delay dep_time            sched_dep_time     
##    &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dttm&gt;              &lt;dttm&gt;             
##  1 EWR    BQN           9        -4 2013-01-01 19:29:00 2013-01-01 19:20:00
##  2 JFK    DFW          59        NA 2013-01-01 19:39:00 2013-01-01 18:40:00
##  3 EWR    TPA          -2         9 2013-01-01 20:58:00 2013-01-01 21:00:00
##  4 EWR    SJU          -6       -12 2013-01-01 21:02:00 2013-01-01 21:08:00
##  5 EWR    SFO          11       -14 2013-01-01 21:08:00 2013-01-01 20:57:00
##  6 LGA    FLL         -10        -2 2013-01-01 21:20:00 2013-01-01 21:30:00
##  7 EWR    MCO          41        43 2013-01-01 21:21:00 2013-01-01 20:40:00
##  8 JFK    LAX          -7       -24 2013-01-01 21:28:00 2013-01-01 21:35:00
##  9 EWR    FLL          49        28 2013-01-01 21:34:00 2013-01-01 20:45:00
## 10 EWR    FLL          -9       -14 2013-01-01 21:36:00 2013-01-01 21:45:00
## # … with 10,623 more rows, and 3 more variables: arr_time &lt;dttm&gt;,
## #   sched_arr_time &lt;dttm&gt;, air_time &lt;dbl&gt;</code></pre>
<p>Это авиарейсы, в которых при переходе через полночь самолет находится в воздухе. Мы использовали одну и ту же информацию о дате, как для времени вылета, так и для времени прилета, но эти ночные авиарейсы прибывают в аэропорт назначения на следуюзий день. Мы можем это учесть, добавив <code>days(1)</code> ко времени прибытия каждого ночного авиарейса.</p>
<div class="sourceCode" id="cb1521"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1521-1" data-line-number="1">flights_dt &lt;-<span class="st"> </span>flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1521-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb1521-3" data-line-number="3">    <span class="dt">overnight =</span> arr_time <span class="op">&lt;</span><span class="st"> </span>dep_time,</a>
<a class="sourceLine" id="cb1521-4" data-line-number="4">    <span class="dt">arr_time =</span> arr_time <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(overnight <span class="op">*</span><span class="st"> </span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb1521-5" data-line-number="5">    <span class="co"># Бинарная переменная умножается на единицу --- FALSE * 1 = 0</span></a>
<a class="sourceLine" id="cb1521-6" data-line-number="6">    <span class="dt">sched_arr_time =</span> sched_arr_time <span class="op">+</span><span class="st"> </span><span class="kw">days</span>(overnight <span class="op">*</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1521-7" data-line-number="7">  )</a></code></pre></div>
<p>Теперь все авирейсы подчиняются законам физики.</p>
<div class="sourceCode" id="cb1522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1522-1" data-line-number="1">flights_dt <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1522-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(overnight, arr_time <span class="op">&lt;</span><span class="st"> </span>dep_time)</a></code></pre></div>
<pre><code>## # A tibble: 0 x 10
## # … with 10 variables: origin &lt;chr&gt;, dest &lt;chr&gt;, dep_delay &lt;dbl&gt;,
## #   arr_delay &lt;dbl&gt;, dep_time &lt;dttm&gt;, sched_dep_time &lt;dttm&gt;,
## #   arr_time &lt;dttm&gt;, sched_arr_time &lt;dttm&gt;, air_time &lt;dbl&gt;,
## #   overnight &lt;lgl&gt;</code></pre>
</div>
<div class="section level4">
<h4><span class="header-section-number">3.7.4.3</span> Интервалы</h4>
<p>Результат деления <code>dyears(1) / ddays(365)</code> результат очевиден — 1. Поскольку длительности всегда представляются количеством секунд, а длительность года определяется как кол-во секунд в 365 днях.</p>
<p>А какой результат будет при делении <code>years(1) / days(1)</code>. Если имеется в виду 2015 год, то 365, а если 2016 то 366.</p>
<p>В данном случае пакет <code>lubridate</code> не располагает достаточной информацией для того чтобы дать однозначный ответ. Вместо этого он даст лишь оценку рещультата, сопроводив её предупреждающим сообщением.</p>
<div class="sourceCode" id="cb1524"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1524-1" data-line-number="1"><span class="kw">years</span>(<span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## estimate only: convert to intervals for accuracy</code></pre>
<pre><code>## [1] 365.25</code></pre>
<p>Для точности, нужно использовать интервал. Интервал — это длительность, для которой указан начальный момент времени, что позволяет точно определить, сколько времени она занимает.</p>
<div class="sourceCode" id="cb1527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1527-1" data-line-number="1">next_year &lt;-<span class="st"> </span><span class="kw">today</span>() <span class="op">-</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1527-2" data-line-number="2">(<span class="kw">today</span>() <span class="op">%--%</span><span class="st"> </span>next_year) <span class="op">/</span><span class="st"> </span><span class="kw">ddays</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] -365</code></pre>
<p>Чтобы выяснить сколько периодов приходится на интервал, необходимо использовать целочисленное деление.</p>
<div class="sourceCode" id="cb1529"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1529-1" data-line-number="1">(<span class="kw">today</span>() <span class="op">%--%</span><span class="st"> </span>next_year) <span class="op">%/%</span><span class="st"> </span><span class="kw">days</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] -365</code></pre>
</div>
<div id="-1" class="section level4">
<h4><span class="header-section-number">3.7.4.4</span> Резюме</h4>
<p>Как обычно, всегда выбирайте самую простую структуру, которая позволяет решить вашу задачу.</p>
<ul>
<li><p>Если вас интересует лишь физическое время — длительность</p></li>
<li><p>Если нужно выразить время в терминах — период</p></li>
<li><p>Если нужно выразить длительность временного промежутка — интервал</p></li>
<li><p>Вставка рисунка — <img src="img/datetimes-arithmetic.png" alt="alt text" /></p></li>
</ul>
</div>
<div id="-16.4.5.1" class="section level4">
<h4><span class="header-section-number">3.7.4.5</span> Упражнение 16.4.5.1</h4>
<div class="question">
<p>Why is there <code>months()</code> but no <code>dmonths()</code>?</p>
</div>
<p>Потому что месяц это непостоянная величина.</p>
<ul>
<li><p>31 день: январь, март, май, июль, август, октябрь</p></li>
<li><p>30 дней: апрель, июнь, сентябрь, ноябрь, декабрь</p></li>
<li><p>28 или 29 дней: февраль</p></li>
</ul>
<p>Месяц — это не продолжительность времени, определяемая независимо от того, когда он происходит, а специальный интервал между двумя датами.</p>
</div>
<div id="-16.4.5.2" class="section level4">
<h4><span class="header-section-number">3.7.4.6</span> Упражнение 16.4.5.2</h4>
<div class="question">
<p>Explain <code>days(overnight * 1)</code> to someone who has just started learning R. How does it work?</p>
</div>
<p>Всё очень просто. <code>overnight = arr_time &lt; dep_time</code> это бинарная переменная, которая принимает значения либо <code>TRUE</code> если время прибытия меньше времени отправления, либо <code>FALSE</code>, если наоборот.
По правилу умножения бинарных операторов в <code>R</code> мы получим 0 если будем умножать на <code>FALSE</code> и 1 если будем умножать на <code>TRUE</code>.
Такой манёвр в функции <code>arr_time = arr_time + days(overnight * 1)</code> позволяет добавлять один день <code>days(1)</code> к дням, у которых время прибытия на день раньше, и не прибавлять ничего <code>days(0)</code>, в случае если прибытие было в день отправления.</p>
</div>
<div id="-16.4.5.3" class="section level4">
<h4><span class="header-section-number">3.7.4.7</span> Упражнение 16.4.5.3</h4>
<div class="question">
<p>Create a vector of dates giving the first day of every month in 2015. Create a vector of dates giving the first day of every month in the current year.</p>
</div>
<div class="sourceCode" id="cb1531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1531-1" data-line-number="1"><span class="co"># Сначала я подумал, что нумерация месяцев идёт от первого месяца</span></a>
<a class="sourceLine" id="cb1531-2" data-line-number="2"><span class="kw">ymd</span>(<span class="st">&quot;2015-01-01&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;2015-02-01&quot; &quot;2015-03-01&quot; &quot;2015-04-01&quot; &quot;2015-05-01&quot; &quot;2015-06-01&quot;
##  [6] &quot;2015-07-01&quot; &quot;2015-08-01&quot; &quot;2015-09-01&quot; &quot;2015-10-01&quot; &quot;2015-11-01&quot;
## [11] &quot;2015-12-01&quot; &quot;2016-01-01&quot;</code></pre>
<div class="sourceCode" id="cb1533"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1533-1" data-line-number="1"><span class="co"># Но это не так, первый месяц начинается с нуля</span></a>
<a class="sourceLine" id="cb1533-2" data-line-number="2"><span class="kw">ymd</span>(<span class="st">&quot;2015-01-01&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;2015-01-01&quot; &quot;2015-02-01&quot; &quot;2015-03-01&quot; &quot;2015-04-01&quot; &quot;2015-05-01&quot;
##  [6] &quot;2015-06-01&quot; &quot;2015-07-01&quot; &quot;2015-08-01&quot; &quot;2015-09-01&quot; &quot;2015-10-01&quot;
## [11] &quot;2015-11-01&quot; &quot;2015-12-01&quot;</code></pre>
<p>Чтобы узнать первый месяц текущего года, снача возьмём текущую дату.
Округлим её до года, а затем добавим месяцы, как это делалось выше.</p>
<div class="sourceCode" id="cb1535"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1535-1" data-line-number="1"><span class="kw">floor_date</span>(<span class="kw">today</span>(), <span class="dt">unit =</span> <span class="st">&quot;year&quot;</span>) <span class="op">+</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">11</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;2019-01-01&quot; &quot;2019-02-01&quot; &quot;2019-03-01&quot; &quot;2019-04-01&quot; &quot;2019-05-01&quot;
##  [6] &quot;2019-06-01&quot; &quot;2019-07-01&quot; &quot;2019-08-01&quot; &quot;2019-09-01&quot; &quot;2019-10-01&quot;
## [11] &quot;2019-11-01&quot; &quot;2019-12-01&quot;</code></pre>
</div>
<div id="-16.4.5.4" class="section level4">
<h4><span class="header-section-number">3.7.4.8</span> Упражнение 16.4.5.4</h4>
<div class="question">
<p>Write a function that given your birthday (as a date), returns how old you are in years.</p>
</div>
<div class="sourceCode" id="cb1537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1537-1" data-line-number="1">my_age &lt;-<span class="st"> </span><span class="cf">function</span>(birth) {</a>
<a class="sourceLine" id="cb1537-2" data-line-number="2">  (<span class="kw">ymd</span>(birth) <span class="op">%--%</span><span class="st"> </span><span class="kw">today</span>()) <span class="op">%/%</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1537-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1537-4" data-line-number="4"><span class="kw">my_age</span>(<span class="st">&quot;1992-10-20&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 26</code></pre>
</div>
<div id="-16.4.5.5" class="section level4">
<h4><span class="header-section-number">3.7.4.9</span> Упражнение 16.4.5.5</h4>
<div class="question">
<p>Why can’t <code>(today() %--% (today() + years(1)) / months(1)</code> work?</p>
</div>
<p>В коде нету скобки. Но даже если исправить выражение, и проставить в нужном месте скобочку, он работает не совсем так как ожидается. Потому что делим на период, а не на интервал или длительность.</p>
<div class="sourceCode" id="cb1539"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1539-1" data-line-number="1">(<span class="kw">today</span>() <span class="op">%--%</span><span class="st"> </span>(<span class="kw">today</span>() <span class="op">+</span><span class="st"> </span><span class="kw">years</span>(<span class="dv">1</span>))) <span class="op">/</span><span class="st"> </span><span class="kw">months</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 12</code></pre>
<p>Числитель выражения <code>(today ()% -% (today () + years (1))</code> представляет собой интервал, который представляет длительность времени вместе с начальной точкой. Интервал имеет точное количество секунд.
Знаменатель выражения, <code>months(1)</code>, представляет собой период, который имеет значение для человека, но не определен в терминах точного количества секунд.
Месяцы могут составлять 28, 29, 30 или 31 день, поэтому неясно на какие <code>months(1)</code> делится?
Код не выдает предупреждающее сообщение, но не всегда дает правильный результат.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">3.7.5</span> Часовые пояса</h3>
<p>Есть несколько трудностей, с котороми возможно предстоит столкнуться.</p>
<ul>
<li>Используемые названия часовых поясов бывают неоднозначны. Но в R для отображения часового пояса используется формат <code>&quot;&lt;континент&gt;/&lt;город&gt;&quot;</code>
Чтобы узнать свой текущий часовой пояс достаточно вызвать функцию <code>Sys.timezone()</code></li>
</ul>
<div class="sourceCode" id="cb1541"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1541-1" data-line-number="1"><span class="kw">Sys.timezone</span>()</a></code></pre></div>
<pre><code>## [1] &quot;Europe/Moscow&quot;</code></pre>
<div class="sourceCode" id="cb1543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1543-1" data-line-number="1"><span class="co"># View(OlsonNames())</span></a></code></pre></div>
<p>В <code>R</code> часовой пояс это атрибут даты/времени, которы лишь управляет выводом на печать. Например, следующие три объекта представляют один и тот же момент времени.</p>
<div class="sourceCode" id="cb1544"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1544-1" data-line-number="1">(x1 &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2015-06-01 12:00:00&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;America/New_York&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;2015-06-01 12:00:00 EDT&quot;</code></pre>
<div class="sourceCode" id="cb1546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1546-1" data-line-number="1">(x2 &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2015-06-01 18:00:00&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;Europe/Copenhagen&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;2015-06-01 18:00:00 CEST&quot;</code></pre>
<div class="sourceCode" id="cb1548"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1548-1" data-line-number="1">(x3 &lt;-<span class="st"> </span><span class="kw">ymd_hms</span>(<span class="st">&quot;2015-06-02 04:00:00&quot;</span>, <span class="dt">tz =</span> <span class="st">&quot;Pacific/Auckland&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;2015-06-02 04:00:00 NZST&quot;</code></pre>
<p>Можно проверить это путём вычитания</p>
<div class="sourceCode" id="cb1550"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1550-1" data-line-number="1">x1 <span class="op">-</span><span class="st"> </span>x2</a></code></pre></div>
<pre><code>## Time difference of 0 secs</code></pre>
<div class="sourceCode" id="cb1552"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1552-1" data-line-number="1">x2 <span class="op">-</span><span class="st"> </span>x3</a></code></pre></div>
<pre><code>## Time difference of 0 secs</code></pre>
<p>Если не указано иное, пакет <code>lubridate</code> всегда использует UTC. Это стандартный часовой пояс, используемый научным сообществом, который примерно эквивалентен своему предшественнику GMT. В нём отсутствует переход на летнее время, что удобно для выполнения вычислений. В операциях, объединяющих дату и время наподобие <code>c()</code> часовой пояс часто опускается. В этом случае дата и время будут отображаться с текущим часовым поясом</p>
<div class="sourceCode" id="cb1554"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1554-1" data-line-number="1">(x4 &lt;-<span class="st"> </span><span class="kw">c</span>(x1, x2, x3))</a></code></pre></div>
<pre><code>## [1] &quot;2015-06-01 12:00:00 EDT&quot; &quot;2015-06-01 12:00:00 EDT&quot;
## [3] &quot;2015-06-01 12:00:00 EDT&quot;</code></pre>
<p>Часовой пояс можно изменить двумя способами.</p>
<ul>
<li>Можно оставить тоже время, но изменить его отображение. Используйте этот метод, если хотите отобразить время в более естественном формате.</li>
</ul>
<div class="sourceCode" id="cb1556"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1556-1" data-line-number="1">(x4a &lt;-<span class="st"> </span><span class="kw">with_tz</span>(x4, <span class="dt">tzone =</span> <span class="st">&quot;Australia/Lord_Howe&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;2015-06-02 02:30:00 +1030&quot; &quot;2015-06-02 02:30:00 +1030&quot;
## [3] &quot;2015-06-02 02:30:00 +1030&quot;</code></pre>
<p>Этот пример иллюстрирует ещё одну проблему — разница между часовыми поясами не всегда выражается целым числом часов.</p>
<ul>
<li>МОжно изменить само время. Используйте этот метод, если время было выведено с некорректно указанным часовым поясом и вы хотите исправить это</li>
</ul>
<div class="sourceCode" id="cb1558"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1558-1" data-line-number="1">(x4b &lt;-<span class="st"> </span><span class="kw">force_tz</span>(x4, <span class="dt">tzone =</span> <span class="st">&quot;Australia/Lord_Howe&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;2015-06-01 12:00:00 +1030&quot; &quot;2015-06-01 12:00:00 +1030&quot;
## [3] &quot;2015-06-01 12:00:00 +1030&quot;</code></pre>
<div class="sourceCode" id="cb1560"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1560-1" data-line-number="1">x4b <span class="op">-</span><span class="st"> </span>x4</a></code></pre></div>
<pre><code>## Time differences in hours
## [1] -14.5 -14.5 -14.5</code></pre>
<!--chapter:end:13_lubridate.Rmd-->
</div>
</div>
</div>
<div class="section level1">
<h1><span class="header-section-number">4</span> Программирование</h1>
<div id="-11" class="section level2">
<h2><span class="header-section-number">4.1</span> Введение</h2>
<p>Запомни — код это средство коммуникации.
Коммуницируем мы с компьютером и человеком.
Поэтому он должен быть понятен и тому и другому.</p>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">4.2</span> Узнайте больше</h2>
<p>Две книги, которые предстоит изучить</p>
<ul>
<li><p>Первая это <a href="https://www.amazon.com/dp/1449359019/ref=cm_sw_su_dp">Hands on Programming with R</a> by Garrett Grolemund.</p></li>
<li><p>Вторая это <a href="http://adv-r.had.co.nz">Advanced R</a> by Hadley Wickham</p></li>
</ul>
</div>
<div id="------magrittr" class="section level2">
<h2><span class="header-section-number">4.3</span> Работа с каналами с помощью пакета <code>magrittr</code></h2>
<div id="-12" class="section level3">
<h3><span class="header-section-number">4.3.1</span> Введение</h3>
<p>Каналы мощный инструмент. В этой главе познакомимся как с ними работать, когда следует и когда не следует использовать.</p>
<div id="--6" class="section level4">
<h4><span class="header-section-number">4.3.1.1</span> Необходимые ресурсы</h4>
<div class="sourceCode" id="cb1562"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1562-1" data-line-number="1"><span class="kw">library</span>(magrittr)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;magrittr&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     set_names</code></pre>
<pre><code>## The following object is masked from &#39;package:tidyr&#39;:
## 
##     extract</code></pre>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">4.3.2</span> Альтернативы каналам</h3>
<p>Смысл использования каналов – помочь писать код, который легко читать и понимать. Рассмотрим на шуточном примере:</p>
<div class="question">
<p>Little bunny Foo Foo
Went hopping through the forest
Scooping up the field mice
And bopping them on the head</p>
</div>
<div class="sourceCode" id="cb1566"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1566-1" data-line-number="1"><span class="co"># foo_foo &lt;- little_bunny()</span></a></code></pre></div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.3.2.1</span> Промежуточные объекты</h4>
<p>Простейший подход — итеративно заменять каждый шаг.</p>
<div class="sourceCode" id="cb1567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1567-1" data-line-number="1"><span class="co"># foo_foo_1 &lt;- hop(foo_foo, through = forest)</span></a>
<a class="sourceLine" id="cb1567-2" data-line-number="2"><span class="co"># foo_foo_2 &lt;- scoop(foo_foo_1, up = field_mice)</span></a>
<a class="sourceLine" id="cb1567-3" data-line-number="3"><span class="co"># foo_foo_3 &lt;- bop(foo_foo_2, on = head)</span></a></code></pre></div>
<p>Минусы — нужно запоминать и тщательно следить за нумерацией функций, повышается вероятность ошибок.
Но вариант имеет право на жизнь.</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">4.3.2.2</span> Замена исходного объекта</h4>
<div class="sourceCode" id="cb1568"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1568-1" data-line-number="1"><span class="co"># foo_foo &lt;- hop(foo_foo, through = forest)</span></a>
<a class="sourceLine" id="cb1568-2" data-line-number="2"><span class="co"># foo_foo &lt;- scoop(foo_foo, up = field_mice)</span></a>
<a class="sourceLine" id="cb1568-3" data-line-number="3"><span class="co"># foo_foo &lt;- bop(foo_foo, on = head)</span></a></code></pre></div>
<p>Здесь повышается читабельность, однако</p>
<ul>
<li><p>ослажняется отладка — если допустить ошибку, то придется выполнять заново весь канал</p></li>
<li><p>повторение преобразуемого объекта затрудняет понимание смысла изменений в каждой строке</p></li>
</ul>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.3.2.3</span> Композиция функций</h4>
<div class="sourceCode" id="cb1569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1569-1" data-line-number="1"><span class="co"># bop(</span></a>
<a class="sourceLine" id="cb1569-2" data-line-number="2"><span class="co">#  scoop(</span></a>
<a class="sourceLine" id="cb1569-3" data-line-number="3"><span class="co">#     hop(foo_foo, through = forest),</span></a>
<a class="sourceLine" id="cb1569-4" data-line-number="4"><span class="co">#     up = field_mice</span></a>
<a class="sourceLine" id="cb1569-5" data-line-number="5"><span class="co">#   ), </span></a>
<a class="sourceLine" id="cb1569-6" data-line-number="6"><span class="co">#   on = head</span></a>
<a class="sourceLine" id="cb1569-7" data-line-number="7"><span class="co"># )</span></a></code></pre></div>
<p>Минус — код приходится читать снизу вверх и слева направо, а аргументы и соответствующие им функции оказываются разнесёнными.
Такой код воспринимать человеку очень непросто.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.3.2.4</span> Использование канала</h4>
<div class="sourceCode" id="cb1570"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1570-1" data-line-number="1"><span class="co"># foo_foo %&gt;%</span></a>
<a class="sourceLine" id="cb1570-2" data-line-number="2"><span class="co">#   hop(through = forest) %&gt;%</span></a>
<a class="sourceLine" id="cb1570-3" data-line-number="3"><span class="co">#   scoop(up = field_mice) %&gt;%</span></a>
<a class="sourceLine" id="cb1570-4" data-line-number="4"><span class="co">#   bop(on = head)</span></a></code></pre></div>
<p>Использование канала проще для понимания — поскольку он фокусирует внимание на глаголах а не на существительных.</p>
<p>Канал работает, выполняя “лексическое преобразование”: <code>magrittr</code> за кулисами переассемблирует код в канале, преобразуя его в форму, которая работает путём замены промежуточного объекта. Когда вы выполняете канал наподобие предыдущего, <code>magrittr</code> делает примерно следующее</p>
<div class="sourceCode" id="cb1571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1571-1" data-line-number="1"><span class="co"># y_pipe &lt;- function(.) {</span></a>
<a class="sourceLine" id="cb1571-2" data-line-number="2"><span class="co">#   . &lt;- hop(., through = forest)</span></a>
<a class="sourceLine" id="cb1571-3" data-line-number="3"><span class="co">#   . &lt;- scoop(., up = field_mice)</span></a>
<a class="sourceLine" id="cb1571-4" data-line-number="4"><span class="co">#   bop(., on = head)</span></a>
<a class="sourceLine" id="cb1571-5" data-line-number="5"><span class="co"># }</span></a>
<a class="sourceLine" id="cb1571-6" data-line-number="6"><span class="co"># my_pipe(foo_foo)</span></a></code></pre></div>
<p>Отсюда следует, что канал не работает для следующих двух классов функций</p>
<ul>
<li>Функции использующие текущее окружение. Например функции <code>load()</code>, <code>get()</code>, <code>assign()</code></li>
</ul>
<div class="sourceCode" id="cb1572"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1572-1" data-line-number="1"><span class="kw">assign</span>(<span class="st">&quot;x&quot;</span>, <span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>))</a>
<a class="sourceLine" id="cb1572-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1572-3" data-line-number="3">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>)</a></code></pre></div>
<ul>
<li>Функции использующие ленивые вычисления. <code>try()</code>, <code>suppressMessages()</code>, <code>suppressWarnings()</code> и многие другие.</li>
</ul>
</div>
</div>
<div id="----" class="section level3">
<h3><span class="header-section-number">4.3.3</span> Когда канал не следует использовать</h3>
<ul>
<li><p>Длина канала превышает 10 шагов. Это облегчит отладку.</p></li>
<li><p>Имеется несколько входных или выходных значений. Если преобразуемых объектов не один, а два или более и все они взаимосвязаны, не используйте канал.</p></li>
<li><p>Вы начинаете задумываться об использовании направленного графа со сложной структурой зависимостей. Каналу в силу своей природы линейны, и выражение сложных отношений с их помощью обычно приводит к запутанному коду</p></li>
</ul>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">4.3.4</span> Другие инструменты</h3>
<p>Все пакеты <code>tidyverse</code> автоматически делают доступным оператор <code>%&gt;%</code>, однако понадобится явно указать пакет <code>magrittr</code> если возникнет одна из следующих ситуаций</p>
<ul>
<li>В процессе работы с более сложными каналами иногда удобно вызывть функцию ради её побочных эффектов. Во многих случаях такие функции ничего не возвращают, фактически закрывая канал.</li>
</ul>
<p>В качестве обходного пути, можно использовать Т-канал. Оператор <code>%T&gt;%</code> работает подобно <code>%&gt;%</code>, за исключением того, что возвращает не правую, а левую часть.</p>
<div class="sourceCode" id="cb1573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1573-1" data-line-number="1"><span class="kw">rnorm</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1573-2" data-line-number="2"><span class="st">  </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">2</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1573-3" data-line-number="3"><span class="st">  </span><span class="kw">plot</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1573-4" data-line-number="4"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-774-1.png" width="672" /></p>
<pre><code>##  NULL</code></pre>
<div class="sourceCode" id="cb1575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1575-1" data-line-number="1"><span class="kw">rnorm</span>(<span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1575-2" data-line-number="2"><span class="st">  </span><span class="kw">matrix</span>(<span class="dt">ncol =</span> <span class="dv">2</span>) <span class="op">%T&gt;%</span></a>
<a class="sourceLine" id="cb1575-3" data-line-number="3"><span class="st">  </span><span class="kw">plot</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1575-4" data-line-number="4"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-775-1.png" width="672" /></p>
<pre><code>##  num [1:50, 1:2] -1.979 -1.034 -1.817 -0.045 -0.432 ...</code></pre>
<ul>
<li>Если вы работаете с функциями, не имеющими программного интерфейса, для работы с фреймами данных, то есть передаете им индивидуальные векторы, а не фрейм данных и вычисляемые в его контексте выражения, вам может быть полезен оператор <code>%$%</code>. Он вырывает переменные из фрейма данных, чтобы на них можно было явно ссылаться. Это может пригодиться, при работе со многими функциями, входящими в базовый комплект R</li>
</ul>
<div class="sourceCode" id="cb1577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1577-1" data-line-number="1">mtcars <span class="op">%$%</span></a>
<a class="sourceLine" id="cb1577-2" data-line-number="2"><span class="st">  </span><span class="kw">cor</span>(disp, mpg)</a></code></pre></div>
<pre><code>## [1] -0.8475514</code></pre>
<ul>
<li>Оператор присваивания <code>%&lt;&gt;%</code>.</li>
</ul>
<div class="sourceCode" id="cb1579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1579-1" data-line-number="1">mtcars &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1579-2" data-line-number="2"><span class="st">  </span><span class="kw">transform</span>(<span class="dt">cyl =</span> cyl <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1579-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1579-4" data-line-number="4">mtcars <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw">transform</span>(<span class="dt">cyl =</span> cyl <span class="op">*</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p>Но операция присваивания на столько специфичная, что для большей читаемости кода рекомендуется делать всё же так <code>mtcars &lt;- mtcars</code></p>
<!--chapter:end:14_magrittr.Rmd-->
</div>
</div>
<div class="section level2">
<h2><span class="header-section-number">4.4</span> Функции</h2>
<div id="-13" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Введение</h3>
<p>Написание хороших функций — это путешествие длинною в жизнь, и да начнётся оно сейчас.</p>
<div id="--3" class="section level4">
<h4><span class="header-section-number">4.4.1.1</span> Используемые ресурсы</h4>
<p>Здесь работаем с базовым функционалом, дополнительные пакеты, не потребуются</p>
<div class="sourceCode" id="cb1580"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1580-1" data-line-number="1"><span class="kw">library</span>(lubridate)</a>
<a class="sourceLine" id="cb1580-2" data-line-number="2"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb1580-3" data-line-number="3"><span class="kw">library</span>(stringr)</a>
<a class="sourceLine" id="cb1580-4" data-line-number="4"><span class="kw">library</span>(ggplot2)</a></code></pre></div>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">4.4.2</span> Когда следует писать функции</h3>
<p>Когда есть необходимость повторять фрагмент кода более чем два раза.</p>
<div class="sourceCode" id="cb1581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1581-1" data-line-number="1">df &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb1581-2" data-line-number="2">  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1581-3" data-line-number="3">  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1581-4" data-line-number="4">  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb1581-5" data-line-number="5">  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1581-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb1581-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1581-8" data-line-number="8">df<span class="op">$</span>a &lt;-<span class="st"> </span>(df<span class="op">$</span>a <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1581-9" data-line-number="9"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1581-10" data-line-number="10">df<span class="op">$</span>b &lt;-<span class="st"> </span>(df<span class="op">$</span>b <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>b, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1581-11" data-line-number="11"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>b, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1581-12" data-line-number="12">df<span class="op">$</span>c &lt;-<span class="st"> </span>(df<span class="op">$</span>c <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>c, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1581-13" data-line-number="13"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>c, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>c, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1581-14" data-line-number="14">df<span class="op">$</span>d &lt;-<span class="st"> </span>(df<span class="op">$</span>d <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1581-15" data-line-number="15"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1581-16" data-line-number="16">df</a></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##        a     b     c     d
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 0.297 2.24  0.311 0    
##  2 0     2.54  1     0.137
##  3 0.561 2.91  0.512 0.257
##  4 0.353 0.633 0.263 0.113
##  5 0.205 1.64  0.324 0.574
##  6 0.602 2.12  0.397 1    
##  7 1     0.761 0.913 0.814
##  8 0.781 1.25  0.918 0.224
##  9 0.283 2.17  0     0.714
## 10 0.258 0     0.454 0.162</code></pre>
<p>Код выше масштабирует значения в каждом столбцу таким образом, чтобы они изменялись в пределах от 0 до 1. Но если присмотреться к выводу <code>df$b</code> можно увидеть значения больше единицы. Почему так произошло? Потому что в коде ошибка — <code>(max(df$b, na.rm = TRUE) - min(df$a, na.rm = TRUE)</code> в минимуме вместо <code>df$b</code>, стоит <code>df$a</code>.</p>
<p>Не так-то просто обнаружить ошибку в коде, среди однообразных выводов. Внесение повторяющегося кода в функцию — неплохая идея, поскольку это избавит от ошибок подобного кода.</p>
<p>Чтобы написать фукнцию, нужно сначала проанализировать код. Сколько в нём имеется входных переменных.</p>
<p>В этом коде:</p>
<div class="sourceCode" id="cb1583"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1583-1" data-line-number="1">(df<span class="op">$</span>a <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span></a>
<a class="sourceLine" id="cb1583-2" data-line-number="2"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>##  [1] 0.2966224 0.0000000 0.5607474 0.3531286 0.2046600 0.6023315 1.0000000
##  [8] 0.7805249 0.2834507 0.2580384</code></pre>
<p>Есть лишь одна входная переменная <code>df$a</code>. Чтобы облегчить понимание кода вынесем повторяющийся числовой вектор во временную переменную с простым именем</p>
<div class="sourceCode" id="cb1585"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1585-1" data-line-number="1">x &lt;-<span class="st"> </span>df<span class="op">$</span>a</a>
<a class="sourceLine" id="cb1585-2" data-line-number="2">(x <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span>(<span class="kw">max</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<pre><code>##  [1] 0.2966224 0.0000000 0.5607474 0.3531286 0.2046600 0.6023315 1.0000000
##  [8] 0.7805249 0.2834507 0.2580384</code></pre>
<p>Теперь можно заметить, что и тут код дублируется — диапазон данных вычислется три раза. Хотя это можно сделать только один раз. В этом нам поможет базовая функция <code>range()</code>.</p>
<div class="sourceCode" id="cb1587"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1587-1" data-line-number="1">rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1587-2" data-line-number="2">(x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a></code></pre></div>
<pre><code>##  [1] 0.2966224 0.0000000 0.5607474 0.3531286 0.2046600 0.6023315 1.0000000
##  [8] 0.7805249 0.2834507 0.2580384</code></pre>
<p>На сколько проще и читабельнее стал код. Но и это ещё не всё. Теперь на авансцену выходит — создание функции</p>
<div class="sourceCode" id="cb1589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1589-1" data-line-number="1">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1589-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1589-3" data-line-number="3">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1589-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1589-5" data-line-number="5"><span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>))</a></code></pre></div>
<pre><code>## [1] 0.0 0.5 1.0</code></pre>
<p>Итак, как видно из кода выше, создание новой функции включает три ключевых момента</p>
<ol style="list-style-type: decimal">
<li><p>Необходимо выбрать <em>имя</em> функции. Здесь мы используем имя <code>rescale01</code>, поскольку функция масштабирует вектор таким образом, чтобы его значения изменялись в пределах от 0 до 1.</p></li>
<li><p>Необходимо перечислить входные значения, или <em>аргументы</em> функции, после ключевого слова <code>function</code>, заключив их в круглые скобки. В данном случае имеется всего один аргумент — это <code>(x)</code>, но если бы их было больше, вызов функции выглядел примерно так <code>function(x, y, z)</code>.</p></li>
<li><p>Разработанный код помещается в тело <em>функции</em> — заключенный в фигурные скобки блок кода, следующий непосредственно за названием функции со списком аргументов.</p></li>
</ol>
<p>Если взглянуть на ситуацию в целом, то мы сначала создали простой код, а затем превратили её в функцию. Так следует поступать и в остальных ситуациях.</p>
<p>На этой стадии целесообразно проверить как работает функция с разными значениями</p>
<div class="sourceCode" id="cb1591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1591-1" data-line-number="1"><span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="ot">NA</span>, <span class="fl">0.2</span>))</a></code></pre></div>
<pre><code>## [1] 0.2857143 0.6428571 1.0000000        NA 0.0000000</code></pre>
<p>Со временем — очень захочется превратить эти неформальные интерактивные проверки в формальные автоматизированные тесты. Этот процесс называют блочным тестированием.</p>
<p>Об этом можно узнать больше по адресу <a href="http://r-pkgs.had.co.nz/tests.html" class="uri">http://r-pkgs.had.co.nz/tests.html</a>.</p>
<p>Теперь, когда у нас есть функция, мы можем заменить исходный пример.</p>
<div class="sourceCode" id="cb1593"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1593-1" data-line-number="1">df<span class="op">$</span>a &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>a)</a>
<a class="sourceLine" id="cb1593-2" data-line-number="2">df<span class="op">$</span>b &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>b)</a>
<a class="sourceLine" id="cb1593-3" data-line-number="3">df<span class="op">$</span>c &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>c)</a>
<a class="sourceLine" id="cb1593-4" data-line-number="4">df<span class="op">$</span>d &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df<span class="op">$</span>d)</a></code></pre></div>
<p>И для сравнения, рядом первоначальный код</p>
<div class="sourceCode" id="cb1594"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1594-1" data-line-number="1">df<span class="op">$</span>a &lt;-<span class="st"> </span>(df<span class="op">$</span>a <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1594-2" data-line-number="2"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1594-3" data-line-number="3">df<span class="op">$</span>b &lt;-<span class="st"> </span>(df<span class="op">$</span>b <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>b, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1594-4" data-line-number="4"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>b, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>a, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1594-5" data-line-number="5">df<span class="op">$</span>c &lt;-<span class="st"> </span>(df<span class="op">$</span>c <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>c, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1594-6" data-line-number="6"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>c, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>c, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1594-7" data-line-number="7">df<span class="op">$</span>d &lt;-<span class="st"> </span>(df<span class="op">$</span>d <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">/</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1594-8" data-line-number="8"><span class="st">  </span>(<span class="kw">max</span>(df<span class="op">$</span>d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(df<span class="op">$</span>d, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb1594-9" data-line-number="9">df</a></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##        a     b     c     d
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 0.297 0.771 0.311 0    
##  2 0     0.871 1     0.137
##  3 0.561 1     0.512 0.257
##  4 0.353 0.217 0.263 0.113
##  5 0.205 0.562 0.324 0.574
##  6 0.602 0.729 0.397 1    
##  7 1     0.261 0.913 0.814
##  8 0.781 0.429 0.918 0.224
##  9 0.283 0.746 0     0.714
## 10 0.258 0     0.454 0.162</code></pre>
<p>Тут есть ещё над чем работать, например очень хочется избавиться от дублирования и сделать это всё “одной строкой”, но об этом мы узнаем чуть позже.</p>
<p>Большим преимуществом функций, является то, что при изменении требований коду изменение нужно вносить в одном месте. Например, можно обнаружить, что некоторые значения приводят к аварийной работе функции.</p>
<div class="sourceCode" id="cb1596"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1596-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb1596-2" data-line-number="2"><span class="kw">rescale01</span>(x)</a></code></pre></div>
<pre><code>##  [1]   0   0   0   0   0   0   0   0   0   0 NaN</code></pre>
<p>Поскольку мы внесли код в функцию, правку нужно врести в одном месте</p>
<div class="sourceCode" id="cb1598"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1598-1" data-line-number="1">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1598-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">finite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1598-3" data-line-number="3">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1598-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1598-5" data-line-number="5"><span class="kw">rescale01</span>(x)</a></code></pre></div>
<pre><code>##  [1] 0.0000000 0.1111111 0.2222222 0.3333333 0.4444444 0.5555556 0.6666667
##  [8] 0.7777778 0.8888889 1.0000000       Inf</code></pre>
<p>Это важная составляющая принципа — НЕ ПОВТОРЯЙСЯ (“Do not repeat yourself”, DRY). Чем больше повторений, тем сложнее держать в голове все места, которые будут нуждаться в обновлении.</p>
<div id="-19.2.1.1" class="section level4">
<h4><span class="header-section-number">4.4.2.1</span> Упражнение 19.2.1.1</h4>
<div class="question">
<p>Why is <code>TRUE</code> not a parameter to <code>rescale01()</code>? What would happen if <code>x</code> contained a single missing value, and <code>na.rm</code> was <code>FALSE</code>?</p>
</div>
<p>Напомню функцию <code>rescale01()</code></p>
<div class="sourceCode" id="cb1600"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1600-1" data-line-number="1">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1600-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">finite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1600-3" data-line-number="3">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1600-4" data-line-number="4">}</a></code></pre></div>
<p><code>TRUE</code> не является параметром функции, поскольку он не указан в круглых скобках после слова тэга <code>function</code></p>
<p>Если <code>x</code> содержит единственное пропущенное значение и <code>na.rm = FALSE</code>, то эта функция по-прежнему возвращает не пропущенное значение.</p>
<div class="sourceCode" id="cb1601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1601-1" data-line-number="1">rescale01_alt &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1601-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> na.rm, <span class="dt">finite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1601-3" data-line-number="3">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1601-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1601-5" data-line-number="5"><span class="kw">rescale01_alt</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), <span class="dt">na.rm =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1]   NA 0.00 0.25 0.50 0.75 1.00</code></pre>
<div class="sourceCode" id="cb1603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1603-1" data-line-number="1"><span class="kw">rescale01_alt</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1]   NA 0.00 0.25 0.50 0.75 1.00</code></pre>
<p>Опция <code>finite = TRUE</code> у параметра <code>range()</code> удалит все неконечные элементы, а NA - неконечный элемент.</p>
<p>Однако, если и <code>finite = FALSE</code> и <code>na.rm = FALSE</code>, то эта функция будет возвращать вектор значений <code>NA</code>.
Напомним, арифметические операции со значениями NA возвращают NA.</p>
<div class="sourceCode" id="cb1605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1605-1" data-line-number="1">rescale01_alt2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">finite =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1605-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> na.rm, <span class="dt">finite =</span> finite)</a>
<a class="sourceLine" id="cb1605-3" data-line-number="3">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1605-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1605-5" data-line-number="5"><span class="kw">rescale01_alt2</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>), <span class="dt">na.rm =</span> <span class="ot">FALSE</span>, <span class="dt">finite =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] NA NA NA NA NA NA</code></pre>
</div>
<div id="-19.2.1.2" class="section level4">
<h4><span class="header-section-number">4.4.2.2</span> Упражнение 19.2.1.2</h4>
<div class="question">
<p>In the second variant of <code>rescale01()</code>, infinite values are left unchanged. Rewrite <code>rescale01()</code> so that <code>-Inf</code> is mapped to 0, and <code>Inf</code> is mapped to 1.</p>
</div>
<p>Для решения хочется использовать конструкцию если <code>y == -Inf</code>, то верни 0, если <code>y == Inf</code> то верни 1.
Но так как с работой с условиями я ещё не знаком, то внесу эти в явном виде.</p>
<div class="sourceCode" id="cb1607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1607-1" data-line-number="1">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1607-2" data-line-number="2">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>, <span class="dt">finite =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1607-3" data-line-number="3">  y &lt;-<span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1607-4" data-line-number="4">  y[y <span class="op">==</span><span class="st"> </span><span class="op">-</span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb1607-5" data-line-number="5">  y[y <span class="op">==</span><span class="st"> </span><span class="ot">Inf</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb1607-6" data-line-number="6">  y</a>
<a class="sourceLine" id="cb1607-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1607-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1607-9" data-line-number="9"><span class="kw">rescale01</span>(<span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">3</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="ot">Inf</span>, <span class="ot">NA</span>))</a></code></pre></div>
<pre><code>## [1] 0.0000000 0.3333333 0.6666667 1.0000000 0.0000000 1.0000000        NA</code></pre>
</div>
<div id="-19.2.1.3" class="section level4">
<h4><span class="header-section-number">4.4.2.3</span> Упражнение 19.2.1.3</h4>
<div class="question">
<p>Practice turning the following code snippets into functions. Think about what each function does. What would you call it? How many arguments does it need? Can you rewrite it to be more expressive or less duplicative?</p>
</div>
<div class="sourceCode" id="cb1609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1609-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1609-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1609-3" data-line-number="3"><span class="kw">mean</span>(<span class="kw">is.na</span>(x))</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb1611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1611-1" data-line-number="1">x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##  [1] 0.00000000 0.01818182 0.03636364 0.05454545 0.07272727 0.09090909
##  [7] 0.10909091 0.12727273 0.14545455 0.16363636 0.18181818</code></pre>
<div class="sourceCode" id="cb1613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1613-1" data-line-number="1"><span class="kw">sd</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 0.663325</code></pre>
<ol style="list-style-type: decimal">
<li>Эта функция подсчитывает делит количество пропущенных значений на общее количество значений.
Другими словами — функция возвращает долю пропущенных значений.</li>
</ol>
<div class="sourceCode" id="cb1615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1615-1" data-line-number="1">t &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>)</a>
<a class="sourceLine" id="cb1615-2" data-line-number="2">i &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">7</span>)</a>
<a class="sourceLine" id="cb1615-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1615-4" data-line-number="4"><span class="kw">is.na</span>(x)</a></code></pre></div>
<pre><code>##  [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb1617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1617-1" data-line-number="1"><span class="kw">mean</span>(<span class="kw">is.na</span>(x))</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>Я бы назвал эту функцию missing_value_rate, или ещё лучше — <code>NA_rate</code></p>
<div class="sourceCode" id="cb1619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1619-1" data-line-number="1">NA_rate &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1619-2" data-line-number="2">  <span class="kw">mean</span>(<span class="kw">is.na</span>(x))</a>
<a class="sourceLine" id="cb1619-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1619-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1619-5" data-line-number="5"><span class="kw">NA_rate</span>(t)</a></code></pre></div>
<pre><code>## [1] 0.4</code></pre>
<div class="sourceCode" id="cb1621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1621-1" data-line-number="1"><span class="kw">NA_rate</span>(i)</a></code></pre></div>
<pre><code>## [1] 0.3</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Эта функция нормирует выборку относительно единицы или другими словами возвращает вес каждого значения в векторе, при этом пропущенные значения не берутся в расчёт.</li>
</ol>
<div class="sourceCode" id="cb1623"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1623-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb1623-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [1]     2 10000</code></pre>
<div class="sourceCode" id="cb1625"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1625-1" data-line-number="1">x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 0.00019996 0.99980004</code></pre>
<p>Я бы назвал эту функцию <code>weight_to_one</code> поскольку она показывает вес каждого значения относительно единицы</p>
<div class="sourceCode" id="cb1627"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1627-1" data-line-number="1">weight_to_one &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1627-2" data-line-number="2">  x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1627-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1627-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1627-5" data-line-number="5"><span class="kw">weight_to_one</span>(x)</a></code></pre></div>
<pre><code>## [1] 0.00019996 0.99980004</code></pre>
<p>Будет выглядеть хорошо, ну по крайне мере однообразно с базовыми функциями, если вынести <code>na.rm</code> (по аналогии с <code>mean</code> и <code>median</code>) со значением по умолчанию <code>FALSE</code> как параметр функции. То есть указать его в круглых скобочках после слова <code>function()</code></p>
<div class="sourceCode" id="cb1629"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1629-1" data-line-number="1">weight_to_one &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1629-2" data-line-number="2">  x <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x)</a>
<a class="sourceLine" id="cb1629-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1629-4" data-line-number="4"></a>
<a class="sourceLine" id="cb1629-5" data-line-number="5"><span class="kw">weight_to_one</span>(x)</a></code></pre></div>
<pre><code>## [1] 0.00019996 0.99980004</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Стандартное отклонение делённое на среднеарифметическое — это <a href="http://statistica.ru/glossary/general/koeffitsient-variatsii/">коэффициент вариации</a>.
Поэтому я назову эту функцию <code>coefficient_of_variation</code>.</li>
</ol>
<div class="sourceCode" id="cb1631"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1631-1" data-line-number="1">gti &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1631-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1631-3" data-line-number="3">coefficient_of_variation &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1631-4" data-line-number="4">  <span class="kw">sd</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1631-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1631-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1631-7" data-line-number="7"><span class="kw">coefficient_of_variation</span>(gti)</a></code></pre></div>
<pre><code>## [1] 0.5770618</code></pre>
<p>Будет ещё лучше, если я, как в предыдущем примере, вынесу <code>na.rm = FALSE</code> в параметр функции. Тогда можно будет управлять выводом функции, не изменяя её код.</p>
<div class="sourceCode" id="cb1633"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1633-1" data-line-number="1">coefficient_of_variation &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1633-2" data-line-number="2">  <span class="kw">sd</span>(x, <span class="dt">na.rm =</span> na.rm) <span class="op">/</span><span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> na.rm)</a>
<a class="sourceLine" id="cb1633-3" data-line-number="3">}</a></code></pre></div>
</div>
<div id="-19.2.1.4" class="section level4">
<h4><span class="header-section-number">4.4.2.4</span> Упражнение 19.2.1.4</h4>
<div class="question">
<p>Follow <a href="http://nicercode.github.io/intro/writing-functions.html" class="uri">http://nicercode.github.io/intro/writing-functions.html</a> to write your own functions to compute the variance and skew of a numeric vector.</p>
</div>
<p>Первая функция, которую многие люди, похоже, должны написать, — это вычислить стандартную ошибку среднего для некоторой переменной, потому что, как ни странно, эта функция не поставляется с базовым пакетом R. Она вычисляется следующим образом <span class="math inline">\(\sqrt{\mathrm{var}(x)/n}\)</span></p>
<div class="sourceCode" id="cb1634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1634-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">169</span>)</a>
<a class="sourceLine" id="cb1634-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1634-3" data-line-number="3"><span class="kw">var</span>(x)</a></code></pre></div>
<pre><code>## [1] 2394.167</code></pre>
<p><code>var</code> — подсчитывает дисперсию (<code>variance</code>). Это то что нам нужно написать самим.</p>
<p>Но для начала мы напишем функцию для определения стандартной ошибки:</p>
<div class="sourceCode" id="cb1636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1636-1" data-line-number="1">standart.error &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1636-2" data-line-number="2">  <span class="kw">sqrt</span>(<span class="kw">var</span>(x)<span class="op">/</span><span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb1636-3" data-line-number="3">}</a></code></pre></div>
<p>Но вот таким образом, на самом деле она выглядит “некрасиво” и слабочитаемо. Понятнее будет, если каждую опцию внести в отдельную внутреннюю переменную</p>
<div class="sourceCode" id="cb1637"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1637-1" data-line-number="1">standart.error &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1637-2" data-line-number="2">  v &lt;-<span class="st"> </span><span class="kw">var</span>(x)</a>
<a class="sourceLine" id="cb1637-3" data-line-number="3">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb1637-4" data-line-number="4">  <span class="kw">sqrt</span>(v<span class="op">/</span>n)</a>
<a class="sourceLine" id="cb1637-5" data-line-number="5">}</a></code></pre></div>
<p>Правда же так гораздо приятнее? Теперь возьмёмся за функцию дисперсии</p>
<p>По определению, дисперсия — это среднеквадратическое отклонение от среднего или
<span class="math display">\[
D = \frac{1}{n - 1} \sum_{i=1}^n (x_i - \bar{x}) ^2 \text{,}
\]</span>
Отлично. Теперь переведём это в функцию. <span class="math inline">\(n\)</span> в формуле это длина вектора или <code>length(x)</code>. <span class="math inline">\(\bar{x}\)</span> — это математическое ожидание или среднее <code>mean(x)</code>. Тогда вся формула будет иметь вид</p>
<div class="sourceCode" id="cb1638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1638-1" data-line-number="1">variance &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1638-2" data-line-number="2">    n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb1638-3" data-line-number="3">    m &lt;-<span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> na.rm)</a>
<a class="sourceLine" id="cb1638-4" data-line-number="4">    <span class="kw">sum</span>((x <span class="op">-</span><span class="st"> </span>m)<span class="op">^</span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span><span class="op">/</span>(n <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1638-5" data-line-number="5">}</a></code></pre></div>
<p>И теперь проверим нашу функцию</p>
<div class="sourceCode" id="cb1639"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1639-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">169</span>)</a>
<a class="sourceLine" id="cb1639-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1639-3" data-line-number="3"><span class="kw">var</span>(x)</a></code></pre></div>
<pre><code>## [1] 2394.167</code></pre>
<div class="sourceCode" id="cb1641"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1641-1" data-line-number="1"><span class="kw">variance</span>(x)</a></code></pre></div>
<pre><code>## [1] 2394.167</code></pre>
<p>Отлично!</p>
<p>Возьмёмся за коэффициент асимметрии числового вектора.
Неформально говоря, коэффициент асимметрии положителен, если правый хвост распределения длиннее левого, и отрицателен в противном случае.
Если распределение симметрично относительно математического ожидания, то его коэффициент асимметрии равен нулю.</p>
<div class="figure">
<img src="img/skew.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Этот коэффициент считается следующим образом</p>
<p><span class="math display">\[
\gamma_1 = \frac{\frac{1}{n - 2}\left(\sum_{i=1}^{n}(x_{i} - \bar x)^3\right)}{D^{3 / 2}}
\]</span></p>
<p>Или переводя в функцию, получим</p>
<div class="sourceCode" id="cb1643"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1643-1" data-line-number="1">skewness &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1643-2" data-line-number="2">  v &lt;-<span class="st"> </span><span class="kw">var</span>(x, <span class="dt">na.rm =</span> na.rm)</a>
<a class="sourceLine" id="cb1643-3" data-line-number="3">  n &lt;-<span class="st"> </span><span class="kw">length</span>(x)</a>
<a class="sourceLine" id="cb1643-4" data-line-number="4">  m &lt;-<span class="st"> </span><span class="kw">mean</span>(x, <span class="dt">na.rm =</span> na.rm)</a>
<a class="sourceLine" id="cb1643-5" data-line-number="5">  (<span class="kw">sum</span>(x <span class="op">-</span><span class="st"> </span>m)<span class="op">^</span><span class="dv">3</span> <span class="op">/</span><span class="st"> </span>(n <span class="op">-</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">/</span><span class="st"> </span>v<span class="op">^</span>(<span class="dv">3</span> <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1643-6" data-line-number="6">}</a></code></pre></div>
</div>
<div id="-19.2.1.5" class="section level4">
<h4><span class="header-section-number">4.4.2.5</span> Упражнение 19.2.1.5</h4>
<div class="question">
<p>Write <code>both_na()</code>, a function that takes two vectors of the same length and returns the number of positions that have an NA in both vectors.</p>
</div>
<p>Сначала разберёмся, как нам считать пропуски.
Чтобы определить пропущенное значение воспользуемся функцией <code>is.na()</code></p>
<div class="sourceCode" id="cb1644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1644-1" data-line-number="1">t &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1644-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1644-3" data-line-number="3"><span class="kw">is.na</span>(t)</a></code></pre></div>
<pre><code>## [1] FALSE FALSE  TRUE</code></pre>
<p>А количество значений <code>TRUE</code> в векторе, нам поможет посчитать функция <code>sum()</code></p>
<div class="sourceCode" id="cb1646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1646-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">is.na</span>(t))</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb1648"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1648-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">is.na</span>(y))</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Итак, теперь нам надо посмотреть в скольких местах в обоих векторах встречаются пропуски.
В нашем случае это один раз</p>
<p>Такое выражение не верно, оно даёт сумму всех пропущенных значений в обоих векторах</p>
<div class="sourceCode" id="cb1650"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1650-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">is.na</span>(t)) <span class="op">+</span><span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(y))</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Такое выражение тоже не подходит, поскольку это логическое <code>ИЛИ</code> и оно сравнивает оба вектора и считает за единицу, случай если хотя бы в одном векторе был пропуск.</p>
<div class="sourceCode" id="cb1652"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1652-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">is.na</span>(t) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(y))</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Тогда наше решение — это логический оператор <code>И</code>. Функция ниже возвращает сумму случаев когда оба значения вектора есть пропущенные значения</p>
<div class="sourceCode" id="cb1654"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1654-1" data-line-number="1"><span class="kw">sum</span>(<span class="kw">is.na</span>(t) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(y))</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Теперь определим это в функцию</p>
<div class="sourceCode" id="cb1656"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1656-1" data-line-number="1">both_na &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb1656-2" data-line-number="2">  <span class="kw">sum</span>(<span class="kw">is.na</span>(x) <span class="op">&amp;</span><span class="st"> </span><span class="kw">is.na</span>(y))</a>
<a class="sourceLine" id="cb1656-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1656-4" data-line-number="4"><span class="kw">both_na</span>(t, y)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<p>Вуаля</p>
</div>
<div id="-19.2.1.6" class="section level4">
<h4><span class="header-section-number">4.4.2.6</span> Упражнение 19.2.1.6</h4>
<div class="question">
<p>What do the following functions do? Why are they useful even though they are so short?</p>
<div class="sourceCode" id="cb1658"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1658-1" data-line-number="1">is_directory &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">file.info</span>(x)<span class="op">$</span>isdir</a>
<a class="sourceLine" id="cb1658-2" data-line-number="2">is_readable &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">file.access</span>(x, <span class="dv">4</span>) <span class="op">==</span><span class="st"> </span><span class="dv">0</span></a></code></pre></div>
</div>
<p>Функция <code>is_directory()</code> проверяет, является ли путь в <code>x</code> каталогом.
Функция <code>is_readable()</code> проверяет, является ли путь в <code>x</code> доступный для чтения.
Что означает, что файл существует и у пользователя есть разрешение на его открытие.
Эти функции полезны даже при том, что они короткие, потому что их имена значительно упрощают работу кода.</p>
</div>
<div id="-19.2.1.6-1" class="section level4">
<h4><span class="header-section-number">4.4.2.7</span> Упражнение 19.2.1.6</h4>
<div class="question">
<p>Read the complete lyrics to “Little Bunny Foo Foo”. There’s a lot of duplication in this song. Extend the initial piping example to recreate the complete song, and use functions to reduce the duplication.</p>
</div>
<p>Пожалуй я скипну это упражнение и вернусь к нему однажды</p>
</div>
</div>
<div id="-----" class="section level3">
<h3><span class="header-section-number">4.4.3</span> Функции создаются для компьютеров и людей</h3>
<p>Делай читабельные функции с внятным названием</p>
<p>Будь последовательным — используй один стиль именования функций.</p>
<p>Семейство аналогичных функций называй согласованно.</p>
<p>Избегай перекрывания имен функций и переменных.</p>
<p>Комментируй свой код отвечая на вопрос <code>зачем?</code>. Избегай комментов отвечающих на вопрос <code>что?</code> и <code>как?</code></p>
<p>Делай понятный код.</p>
<p>Подумай о добавлении промежуточных переменных.</p>
<div id="-19.3.1.1" class="section level4">
<h4><span class="header-section-number">4.4.3.1</span> Упражнение 19.3.1.1</h4>
<div class="question">
<p>Read the source code for each of the following three functions, puzzle out what they do, and then brainstorm better names.</p>
</div>
<ol style="list-style-type: decimal">
<li>Пойдём по порядку.</li>
</ol>
<div class="sourceCode" id="cb1659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1659-1" data-line-number="1">f1 &lt;-<span class="st"> </span><span class="cf">function</span>(string, prefix) {</a>
<a class="sourceLine" id="cb1659-2" data-line-number="2">  <span class="kw">substr</span>(string, <span class="dv">1</span>, <span class="kw">nchar</span>(prefix)) <span class="op">==</span><span class="st"> </span>prefix</a>
<a class="sourceLine" id="cb1659-3" data-line-number="3">}</a></code></pre></div>
<p>В <code>f1</code> используются следующие функции:</p>
<p><code>substr()</code> извлекает подстроки в символьном векторе с заданными параметрами начала извлечения и конца</p>
<div class="sourceCode" id="cb1660"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1660-1" data-line-number="1"><span class="kw">substr</span>(<span class="kw">c</span>(<span class="st">&quot;abc77777&quot;</span>, <span class="st">&quot;abd77777&quot;</span>, <span class="st">&quot;qwe77777&quot;</span>), <span class="dv">1</span>, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] &quot;abc77&quot; &quot;abd77&quot; &quot;qwe77&quot;</code></pre>
<p><code>nchar()</code> считает количество символов в каждом члене символьного вектора</p>
<div class="sourceCode" id="cb1662"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1662-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;abc77777&quot;</span>, <span class="st">&quot;abd77777&quot;</span>, <span class="st">&quot;qwe77777&quot;</span>)</a>
<a class="sourceLine" id="cb1662-2" data-line-number="2">y &lt;-<span class="st"> &quot;ab&quot;</span></a>
<a class="sourceLine" id="cb1662-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1662-4" data-line-number="4"><span class="co"># Всё вместе это работает так</span></a>
<a class="sourceLine" id="cb1662-5" data-line-number="5"><span class="kw">substr</span>(x, <span class="dv">1</span>, <span class="kw">nchar</span>(y)) <span class="op">==</span><span class="st"> </span>y</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb1664"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1664-1" data-line-number="1"><span class="kw">f1</span>(<span class="kw">c</span>(<span class="st">&quot;resdfj&quot;</span>, <span class="st">&quot;rejsdj-&quot;</span>, <span class="st">&quot;eradsf,&quot;</span>, <span class="st">&quot;resdfj&quot;</span>), <span class="st">&quot;re&quot;</span>)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE  TRUE</code></pre>
<p>Теперь как работает эта функция. <code>substr()</code> принимает первым значением параметр <code>string</code> (это на самом деле немного путает вначале, потому что <code>string</code> не название функции, а название параметра).</p>
<p>Дальше указана единица — т.е. из вектора будут извлекаться значения с первой позиции.</p>
<p>Далее следует функция <code>nchar(prefix)</code> — которая считает количество символов во втором заданном в функцию векторе. Полученное число будет третьим параметром для функции <code>substr()</code>, т.е. он задаёт конечное значение извлекаемого вектора.</p>
<p>Таким образом выражение <code>substr(string, 1, nchar(prefix))</code> всегда будет брать из заданных символьных векторов количество символов с первого по длинну префикса.</p>
<p>И наконец операция <code>== prefix</code> сравнивает извлечённые символы с заданным префиксом. И возвращает булево значение <code>TRUE</code> если вектор содержит префикс и <code>FALSE</code></p>
<p>Исходя из выше описанного я бы назвал функцию <code>f1</code> <code>имеет_префикс()</code> или по-английски <code>has_prefix()</code></p>
<div class="sourceCode" id="cb1666"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1666-1" data-line-number="1">has_prefix &lt;-<span class="st"> </span><span class="cf">function</span>(string, prefix) {</a>
<a class="sourceLine" id="cb1666-2" data-line-number="2">  <span class="kw">substr</span>(string, <span class="dv">1</span>, <span class="kw">nchar</span>(prefix)) <span class="op">==</span><span class="st"> </span>prefix</a>
<a class="sourceLine" id="cb1666-3" data-line-number="3">}</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Функция <code>f2</code> отбрасывает последний элемент вектора <code>x</code></li>
</ol>
<div class="sourceCode" id="cb1667"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1667-1" data-line-number="1">f2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1667-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1667-3" data-line-number="3">  x[<span class="op">-</span><span class="kw">length</span>(x)]</a>
<a class="sourceLine" id="cb1667-4" data-line-number="4">}</a></code></pre></div>
<p>Но тут добавлено условие — если длинна заданного вектора равна или меньше единице, то возвращается <code>NULL</code>. И это логично, потому что отбросить последнее значение от единичного вектора всё равно что взять ноль.</p>
<div class="sourceCode" id="cb1668"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1668-1" data-line-number="1"><span class="kw">f2</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## NULL</code></pre>
<p>Я бы назваль эту функцию <code>пни последнего</code> или <code>kick_last</code></p>
<div class="sourceCode" id="cb1670"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1670-1" data-line-number="1">kick_last &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1670-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb1670-3" data-line-number="3">  x[<span class="op">-</span><span class="kw">length</span>(x)]</a>
<a class="sourceLine" id="cb1670-4" data-line-number="4">}</a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>В функции <code>f3</code></li>
</ol>
<div class="sourceCode" id="cb1671"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1671-1" data-line-number="1">f3 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb1671-2" data-line-number="2">  <span class="kw">rep</span>(y, <span class="dt">length.out =</span> <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb1671-3" data-line-number="3">}</a></code></pre></div>
<p>используется функция <code>rep()</code> — она копирует значения в <code>x</code> с заданным параметром <code>length.out</code> который указывает желаемую длинy выходного вектора, т.е. длине вектора <code>x</code>. Другие входные данные будут приведены к двойному вектору, и первый элемент будет взят. Игнорируется, если NA или недействительным.</p>
<div class="sourceCode" id="cb1672"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1672-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;c77&quot;</span>, <span class="st">&quot;c777&quot;</span>, <span class="st">&quot;abd77777&quot;</span>, <span class="st">&quot;qwe77777&quot;</span>)</a>
<a class="sourceLine" id="cb1672-2" data-line-number="2"><span class="kw">length</span>(x)</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb1674"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1674-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1674-2" data-line-number="2"><span class="kw">f3</span>(x, y)</a></code></pre></div>
<pre><code>## [1] 1 2 1 2 1</code></pre>
<div class="sourceCode" id="cb1676"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1676-1" data-line-number="1"><span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">length.out =</span> <span class="dv">9</span>)</a></code></pre></div>
<pre><code>## [1] 1 2 3 4 1 2 3 4 1</code></pre>
<p>Получается, функция <code>f3</code> берёт параметр <code>y</code> и повторяет его столько раз, какая длина у <code>x</code>.</p>
<div class="sourceCode" id="cb1678"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1678-1" data-line-number="1"><span class="kw">f3</span>(<span class="kw">c</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>), <span class="st">&quot;cv&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cv&quot; &quot;cv&quot; &quot;cv&quot; &quot;cv&quot;</code></pre>
<p>Эту функцию можно назвать <code>расширение()</code> или <code>recycle()</code></p>
</div>
<div id="-19.3.1.2" class="section level4">
<h4><span class="header-section-number">4.4.3.2</span> Упражнение 19.3.1.2</h4>
<div class="question">
<p>Take a function that you’ve written recently and spend 5 minutes brainstorming a better name for it and its arguments.</p>
</div>
<p>Вернусь сюда когда начну писать свои функции</p>
</div>
<div id="-19.3.1.3" class="section level4">
<h4><span class="header-section-number">4.4.3.3</span> Упражнение 19.3.1.3</h4>
<div class="question">
<p>Compare and contrast <code>rnorm()</code> and <code>MASS::mvrnorm()</code>. How could you make them more consistent?</p>
</div>
<div class="sourceCode" id="cb1680"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1680-1" data-line-number="1"><span class="co">#?rnorm</span></a></code></pre></div>
<p><code>rnorm()</code> производит выборки из одномерного нормального распределения, а <code>MASS::mvrnorm</code> - из многомерного нормального распределения.
Основными аргументами в <code>rnorm()</code> являются</p>
<ul>
<li><p><code>n</code> — кол-во наблюдений</p></li>
<li><p><code>mean</code> — мат.ожидание</p></li>
<li><p><code>sd</code> — стандартное отклонение.</p></li>
</ul>
<p>Основными аргументами <code>MASS::mvrnorm</code> являются</p>
<ul>
<li><p><code>n</code> — необходимое кол-во образцов</p></li>
<li><p><code>mu</code> — вектор, дающий средние значения переменных.</p></li>
<li><p><code>Sigma</code> — положительно определенная симметричная матрица, определяющая ковариационную матрицу переменных.</p></li>
</ul>
<p>Чтобы быть последовательными, они должны иметь одинаковые имена. Однако это сложно. В общем случае лучше соответствовать более широко используемым функциям, например, <code>rmvnorm()</code> должен следовать соглашениям <code>rnorm()</code>. Однако, хотя среднее значение является правильным в многомерном случае, <code>sd</code> не имеет смысла в многомерном случае. Однако обе функции внутренне согласованы. Не было бы хорошей практикой иметь в качестве аргументов аргументы <code>mu</code> и <code>sd</code>, а в качестве аргументов - Sigma.</p>
</div>
<div id="-19.3.1.4" class="section level4">
<h4><span class="header-section-number">4.4.3.4</span> Упражнение 19.3.1.4</h4>
<div class="question">
<p>Make a case for why <code>norm_r()</code>, <code>norm_d()</code> etc would be better than <code>rnorm()</code>, <code>dnorm()</code>. Make a case for the opposite.</p>
</div>
<p>Если функции названы <code>norm_r()</code> и <code>norm_d()</code>, группы соглашений об именах функционируют по их распределению.</p>
<p>Если они названы <code>rnorm()</code> и <code>dnorm()</code>, соглашение об именовании группирует функции по действию, которое они выполняют.</p>
<ul>
<li><p>Функции r * всегда выбирают из распределений: например, <code>rnorm()</code>, <code>rbinom()</code>, <code>runif()</code> и <code>rexp()</code>.</p></li>
<li><p>Функции d * вычисляют плотность вероятности или массу распределения: например, <code>dnorm()</code>, <code>dbinom()</code>, <code>dunif()</code> и <code>dexp()</code>.</p></li>
</ul>
<p>В дистрибутивах <code>R</code> используется это последнее соглашение об именах.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">4.4.4</span> Условное выполнение</h3>
<p>Инструкция <code>if</code> позволяет организовать условное выполнение кода. Она имеет следующий синтаксис</p>
<div class="sourceCode" id="cb1681"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1681-1" data-line-number="1"><span class="co">#if (условие) {</span></a>
<a class="sourceLine" id="cb1681-2" data-line-number="2">  <span class="co"># код выполняемый если условие TRUE</span></a>
<a class="sourceLine" id="cb1681-3" data-line-number="3"><span class="co">#} else {</span></a>
<a class="sourceLine" id="cb1681-4" data-line-number="4">  <span class="co"># код выполняемый если условие FALSE</span></a>
<a class="sourceLine" id="cb1681-5" data-line-number="5"><span class="co">#}</span></a></code></pre></div>
<p>Чтобы получить справку нужно заключить инструкцию в апострофы <code>?</code>if``</p>
<p>Рассмотрим пример простой функции, которая возвращает логический вектор, указывающий на то, именован или не именован каждый из элементов вектора</p>
<div class="sourceCode" id="cb1682"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1682-1" data-line-number="1">has_name &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1682-2" data-line-number="2">  nms &lt;-<span class="st"> </span><span class="kw">names</span>(x)</a>
<a class="sourceLine" id="cb1682-3" data-line-number="3">  <span class="cf">if</span> (<span class="kw">is.null</span>(nms)) {</a>
<a class="sourceLine" id="cb1682-4" data-line-number="4">    <span class="kw">rep</span>(<span class="ot">FALSE</span>, <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb1682-5" data-line-number="5">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1682-6" data-line-number="6">    <span class="op">!</span><span class="kw">is.na</span>(nms) <span class="op">&amp;</span><span class="st"> </span>nms <span class="op">!=</span><span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb1682-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb1682-8" data-line-number="8">}</a></code></pre></div>
<p>Стандартное для функций правило — функция возвращает последнее вычисленное значение. В случае функции выше, это может быть результат вычисления любой из двух ветвей оператора <code>if</code></p>
<div class="section level4">
<h4><span class="header-section-number">4.4.4.1</span> Условия</h4>
<p>Результатом вычисления условия должно быть логическое значение — либо <code>TRUE</code> либо <code>FALSE</code>.</p>
<p>Если это вектор — будет предупреждение.</p>
<p>Если <code>NA</code> — будет ошибка.</p>
<p>Несколько условий можно объединять при помощи логических векторов <code>||</code> (ИЛИ) <code>&amp;&amp;</code> (И).
Они используют короткий цикл вычислений — как только для оператора обнаруживается, что первое условие равно <code>TRUE</code>, остальные условия не обрабатываются.
Аналогично для <code>&amp;&amp;</code> — Если первое условие <code>FALSE</code>, остальные не обрабатываются.</p>
<p>Важно — никогда не использовать операторы <code>|</code> <code>&amp;</code> в инструкции <code>if</code> потому что эти операции векторизованы и применяются к нескольким значениям. Если имеется логический вектор, можно свернуть его в одиночное значение с помощью функции <code>any()</code> или <code>all()</code>.</p>
<p>Будь внимателен при проверке на равенство. Оператор <code>==</code> векторизован, это означает что может быть получено более чем одно выходное значение. В током случае можно проверить, что длина переменной уже равна 1, свернуть вектор с помощью функции <code>any()</code> или <code>all()</code> или использовать не векторизованную функцию <code>identical()</code>.</p>
<p>Функция <code>identical()</code> строгая — она всегда возвращает одиночное значение <code>TRUE</code>, либо одиночное значение <code>FALSE</code> и не выполняет прпиведение типов. Это означает, что нужно быть аккуратным при сравнении целых чисел с числами двойной точности.</p>
<div class="sourceCode" id="cb1683"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1683-1" data-line-number="1"><span class="kw">identical</span>(0L, <span class="dv">0</span>)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Так же будь осторожен при проверке вещественных чисел.</p>
<div class="sourceCode" id="cb1685"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1685-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1685-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb1687"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1687-1" data-line-number="1">x <span class="op">==</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb1689"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1689-1" data-line-number="1">x <span class="op">-</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] 4.440892e-16</code></pre>
<p>вместо этого используй для сравнения функцию <code>dplyr::near()</code></p>
<p>И ещё — не сравнивай <code>x == NA</code>, оно не принесет никакой пользы.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.4.4.2</span> Множественные условия</h4>
<p>Несколько инструкций можно объединить в цепочки</p>
<div class="sourceCode" id="cb1691"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1691-1" data-line-number="1"><span class="co">#if (this) {</span></a>
<a class="sourceLine" id="cb1691-2" data-line-number="2">  <span class="co"># сделай это</span></a>
<a class="sourceLine" id="cb1691-3" data-line-number="3"><span class="co">#} else if (that) {</span></a>
<a class="sourceLine" id="cb1691-4" data-line-number="4">  <span class="co"># сделай ещё что-то</span></a>
<a class="sourceLine" id="cb1691-5" data-line-number="5"><span class="co">#} else {</span></a>
<a class="sourceLine" id="cb1691-6" data-line-number="6">  <span class="co"># </span></a>
<a class="sourceLine" id="cb1691-7" data-line-number="7"><span class="co">#}</span></a></code></pre></div>
<p>Если цепочка получается длинной, подумай как её переписать. Одна полезная методика предпологает использование функции <code>switch()</code>. Эта функция позволяет выбирать ветвь кода на основании заданной позиции или имени.</p>
<div class="sourceCode" id="cb1692"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1692-1" data-line-number="1">foo &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, op) {</a>
<a class="sourceLine" id="cb1692-2" data-line-number="2"> <span class="cf">switch</span>(op,</a>
<a class="sourceLine" id="cb1692-3" data-line-number="3">  <span class="dt">plus =</span> x <span class="op">+</span><span class="st"> </span>y,</a>
<a class="sourceLine" id="cb1692-4" data-line-number="4">  <span class="dt">minus =</span> x <span class="op">-</span><span class="st"> </span>y,</a>
<a class="sourceLine" id="cb1692-5" data-line-number="5">  <span class="dt">times =</span> x <span class="op">*</span><span class="st"> </span>y,</a>
<a class="sourceLine" id="cb1692-6" data-line-number="6">  <span class="dt">divide =</span> x <span class="op">/</span><span class="st"> </span>y,</a>
<a class="sourceLine" id="cb1692-7" data-line-number="7">  <span class="kw">stop</span>(<span class="st">&quot;Unknown op!&quot;</span>)</a>
<a class="sourceLine" id="cb1692-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb1692-9" data-line-number="9">}</a></code></pre></div>
<p>Работает она таким образом — в аргументах функции указываем тег триггер. В теле <code>switch</code>-а указываем условия наступления триггера.</p>
<p>вызывается триггер вот таким образом:</p>
<div class="sourceCode" id="cb1693"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1693-1" data-line-number="1"><span class="co"># foo(2, 5, &quot;plus&quot;)</span></a>
<a class="sourceLine" id="cb1693-2" data-line-number="2"><span class="co"># foo(2, 5, &quot;divide&quot;)</span></a>
<a class="sourceLine" id="cb1693-3" data-line-number="3"><span class="co"># foo(2, 5, &quot;plва&quot;)</span></a></code></pre></div>
<p>Ещё есть функция <code>cut()</code>. Разберём её работу в упражнениях</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.4.4.3</span> Стиль кода</h4>
<p>За инструкцией <code>if</code> должны следовать курвы <code>{}</code>. Содержимое внутри скобочек должно отделяться двумя пробелами.
Так легче отслеживать иерархию в коде, скользя взглядом вдоль левого края.</p>
<p>Открывающаяся скобка не должна стоять на отдельной строке.</p>
<p>За ней всегда должен следовать переход на новую строка.</p>
<p>Закрывающаяюся курва всегда должна распологаться на отдельной строке, если за ней не следует блок <code>else</code>.</p>
<p>Код в фигурных скобках следует всегда отделять пробелами.</p>
<div class="sourceCode" id="cb1694"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1694-1" data-line-number="1"><span class="co"># Good</span></a>
<a class="sourceLine" id="cb1694-2" data-line-number="2"><span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>debug) {</a>
<a class="sourceLine" id="cb1694-3" data-line-number="3">  <span class="kw">message</span>(<span class="st">&quot;Y is negative&quot;</span>)</a>
<a class="sourceLine" id="cb1694-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb1694-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1694-6" data-line-number="6"><span class="cf">if</span> (y <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1694-7" data-line-number="7">  <span class="kw">log</span>(x)</a>
<a class="sourceLine" id="cb1694-8" data-line-number="8">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1694-9" data-line-number="9">  y <span class="op">^</span><span class="st"> </span>x</a>
<a class="sourceLine" id="cb1694-10" data-line-number="10">}</a></code></pre></div>
<pre><code>## Warning in if (y == 0) {: длина условия &gt; 1, будет использован только
## первый элемент</code></pre>
<pre><code>## [1] 1 4</code></pre>
<p>В случае коротких конструкций, умещающихся в одной строке, фигурные скобки можно опустить.</p>
<div class="sourceCode" id="cb1697"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1697-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1697-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>) <span class="st">&quot;Too low&quot;</span> <span class="cf">else</span> <span class="st">&quot;Too high&quot;</span></a></code></pre></div>
<p>Но так лучше не делать, лучше повысить чтение кода курвами</p>
<div class="sourceCode" id="cb1698"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1698-1" data-line-number="1"><span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>) {</a>
<a class="sourceLine" id="cb1698-2" data-line-number="2">  x &lt;-<span class="st"> &quot;Too low&quot;</span> </a>
<a class="sourceLine" id="cb1698-3" data-line-number="3">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1698-4" data-line-number="4">  x &lt;-<span class="st"> &quot;Too high&quot;</span></a>
<a class="sourceLine" id="cb1698-5" data-line-number="5">}</a></code></pre></div>
</div>
<div id="-19.4.4.1" class="section level4">
<h4><span class="header-section-number">4.4.4.4</span> Упражнение 19.4.4.1</h4>
<div class="question">
<p>What’s the difference between <code>if</code> and <code>ifelse()</code>?
Carefully read the help and construct three examples that illustrate the key differences.</p>
</div>
<p>У <code>ifelse()</code> следующие аргументы <code>ifelse(test, yes, no)</code>.</p>
<p><code>test</code> — логическая проверка. Объект.</p>
<p><code>yes</code> — return values for true elements of <code>test</code>.</p>
<p><code>no</code> — return values for false elements of <code>test</code>.</p>
<div class="sourceCode" id="cb1699"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1699-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">6</span><span class="op">:-</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb1699-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1699-3" data-line-number="3"><span class="kw">sqrt</span>(<span class="kw">ifelse</span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>, x, <span class="ot">NA</span>))</a></code></pre></div>
<pre><code>##  [1] 2.449490 2.236068 2.000000 1.732051 1.414214 1.000000 0.000000
##  [8]       NA       NA       NA       NA</code></pre>
<div class="sourceCode" id="cb1701"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1701-1" data-line-number="1"><span class="cf">if</span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>) <span class="kw">sqrt</span>(x)</a></code></pre></div>
<pre><code>## Warning in if (x &gt;= 0) sqrt(x): длина условия &gt; 1, будет использован только
## первый элемент</code></pre>
<pre><code>## Warning in sqrt(x): созданы NaN</code></pre>
<pre><code>##  [1] 2.449490 2.236068 2.000000 1.732051 1.414214 1.000000 0.000000
##  [8]      NaN      NaN      NaN      NaN</code></pre>
<p>Ключевое слово <code>if</code> проверяет одно условие, тогда как <code>ifelse()</code> проверяет каждый элемент.</p>
<div class="sourceCode" id="cb1705"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1705-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1705-2" data-line-number="2"><span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>) {</a>
<a class="sourceLine" id="cb1705-3" data-line-number="3">  <span class="st">&quot;Too low&quot;</span> </a>
<a class="sourceLine" id="cb1705-4" data-line-number="4">}</a></code></pre></div>
<pre><code>## [1] &quot;Too low&quot;</code></pre>
<div class="sourceCode" id="cb1707"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1707-1" data-line-number="1"><span class="cf">if</span> (y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1707-2" data-line-number="2">  <span class="st">&quot;Too low&quot;</span> </a>
<a class="sourceLine" id="cb1707-3" data-line-number="3">}</a></code></pre></div>
<p>В то время как <code>ifelse()</code></p>
<div class="sourceCode" id="cb1708"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1708-1" data-line-number="1"><span class="kw">ifelse</span>(y <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>, <span class="st">&quot;Too high&quot;</span>, <span class="st">&quot;Too low&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Too high&quot;</code></pre>
<div class="sourceCode" id="cb1710"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1710-1" data-line-number="1"><span class="kw">ifelse</span>(y <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>, <span class="st">&quot;Too high&quot;</span>, <span class="st">&quot;Too low&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;Too low&quot;</code></pre>
</div>
<div id="-19.4.4.2" class="section level4">
<h4><span class="header-section-number">4.4.4.5</span> Упражнение 19.4.4.2</h4>
<div class="question">
<p>Write a greeting function that says “good morning”, “good afternoon”, or “good evening”, depending on the time of day. (Hint: use a time argument that defaults to <code>lubridate::now()</code>. That will make it easier to test your function.)</p>
</div>
<p>Итак функция должна работать следующим образом.
Если текущее время меньше либо равно 12:00 — то выведи «good morning»,
Если текущее время меньше либо равно 18:00 — то выведи «good afternoon»,
Для всего оставшегося времени выведи «good evening».</p>
<div class="sourceCode" id="cb1712"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1712-1" data-line-number="1">greeting &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">time =</span> <span class="kw">now</span>()) {</a>
<a class="sourceLine" id="cb1712-2" data-line-number="2">  hour &lt;-<span class="st"> </span><span class="kw">hour</span>(time)</a>
<a class="sourceLine" id="cb1712-3" data-line-number="3">  <span class="cf">if</span> (hour <span class="op">&lt;=</span><span class="st"> </span><span class="dv">12</span>) {</a>
<a class="sourceLine" id="cb1712-4" data-line-number="4">    <span class="kw">print</span>(<span class="st">&quot;good morning&quot;</span>)</a>
<a class="sourceLine" id="cb1712-5" data-line-number="5">  } <span class="cf">else</span> <span class="cf">if</span> (hour <span class="op">&lt;=</span><span class="st"> </span><span class="dv">18</span>) {</a>
<a class="sourceLine" id="cb1712-6" data-line-number="6">    <span class="kw">print</span>(<span class="st">&quot;good afternoon&quot;</span>)</a>
<a class="sourceLine" id="cb1712-7" data-line-number="7">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1712-8" data-line-number="8">    <span class="kw">print</span>(<span class="st">&quot;good evening&quot;</span>)</a>
<a class="sourceLine" id="cb1712-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1712-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb1712-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1712-12" data-line-number="12"><span class="kw">greeting</span>(<span class="kw">now</span>())</a></code></pre></div>
<pre><code>## [1] &quot;good evening&quot;</code></pre>
<div class="sourceCode" id="cb1714"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1714-1" data-line-number="1"><span class="kw">hour</span>(<span class="kw">ymd_h</span>(<span class="st">&quot;2017-01-08:05&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb1716"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1716-1" data-line-number="1"><span class="kw">greeting</span>((<span class="kw">ymd_h</span>(<span class="st">&quot;2017-01-08:05&quot;</span>)))</a></code></pre></div>
<pre><code>## [1] &quot;good morning&quot;</code></pre>
</div>
<div id="-19.4.4.3" class="section level4">
<h4><span class="header-section-number">4.4.4.6</span> Упражнение 19.4.4.3</h4>
<div class="question">
<p>Implement a <code>fizzbuzz</code> function. It takes a single number as input. If the number is divisible by three, it returns “fizz”. If it’s divisible by five it returns “buzz”. If it’s divisible by three and five, it returns “fizzbuzz”. Otherwise, it returns the number. Make sure you first write working code before you create the function.</p>
</div>
<p>Если остаток от деления на 3 равен нулю и остаток от деления на 5 равен нулю верни «fizzbuzz»,
Если остаток от деления на 3 равен нулю, то верни «fizz»,
Если остаток от деления на 5 равен нулю, то верни «buzz»,
В любом другом случае верни само число</p>
<div class="sourceCode" id="cb1718"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1718-1" data-line-number="1">fizzbuzz &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1718-2" data-line-number="2">  <span class="cf">if</span> (x <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;&amp;</span><span class="st"> </span>x <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1718-3" data-line-number="3">    <span class="kw">print</span>(<span class="st">&quot;fizzbuzz&quot;</span>)</a>
<a class="sourceLine" id="cb1718-4" data-line-number="4">  } <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">%%</span><span class="st"> </span><span class="dv">3</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1718-5" data-line-number="5">    <span class="kw">print</span>(<span class="st">&quot;fizz&quot;</span>)</a>
<a class="sourceLine" id="cb1718-6" data-line-number="6">  } <span class="cf">else</span> <span class="cf">if</span> (x <span class="op">%%</span><span class="st"> </span><span class="dv">5</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1718-7" data-line-number="7">    <span class="kw">print</span>(<span class="st">&quot;buzz&quot;</span>)</a>
<a class="sourceLine" id="cb1718-8" data-line-number="8">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1718-9" data-line-number="9">    <span class="kw">print</span>(x)</a>
<a class="sourceLine" id="cb1718-10" data-line-number="10">  }</a>
<a class="sourceLine" id="cb1718-11" data-line-number="11">}</a></code></pre></div>
<div class="sourceCode" id="cb1719"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1719-1" data-line-number="1"><span class="kw">fizzbuzz</span>(<span class="dv">6</span>)</a></code></pre></div>
<pre><code>## [1] &quot;fizz&quot;</code></pre>
<div class="sourceCode" id="cb1721"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1721-1" data-line-number="1"><span class="kw">fizzbuzz</span>(<span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] &quot;buzz&quot;</code></pre>
<div class="sourceCode" id="cb1723"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1723-1" data-line-number="1"><span class="kw">fizzbuzz</span>(<span class="dv">15</span>)</a></code></pre></div>
<pre><code>## [1] &quot;fizzbuzz&quot;</code></pre>
<div class="sourceCode" id="cb1725"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1725-1" data-line-number="1"><span class="kw">fizzbuzz</span>(<span class="dv">4</span>)</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
</div>
<div id="-19.4.4.4" class="section level4">
<h4><span class="header-section-number">4.4.4.7</span> Упражнение 19.4.4.4</h4>
<div class="question">
<p>How could you use <code>cut()</code> to simplify this set of nested if-else statements?</p>
<p>How would you change the call to <code>cut()</code> if I’d used <code>&lt;</code> instead of <code>&lt;=</code>? What is the other chief advantage of <code>cut()</code> for this problem? (Hint: what happens if you have many values in temp?)</p>
</div>
<div class="sourceCode" id="cb1727"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1727-1" data-line-number="1">temp &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">20</span>, <span class="dv">40</span>, <span class="dt">by =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1727-2" data-line-number="2">temp</a></code></pre></div>
<pre><code>##  [1] -20 -15 -10  -5   0   5  10  15  20  25  30  35  40</code></pre>
<div class="sourceCode" id="cb1729"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1729-1" data-line-number="1"><span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1729-2" data-line-number="2">  <span class="st">&quot;freezing&quot;</span></a>
<a class="sourceLine" id="cb1729-3" data-line-number="3">} <span class="cf">else</span> <span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb1729-4" data-line-number="4">  <span class="st">&quot;cold&quot;</span></a>
<a class="sourceLine" id="cb1729-5" data-line-number="5">} <span class="cf">else</span> <span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">20</span>) {</a>
<a class="sourceLine" id="cb1729-6" data-line-number="6">  <span class="st">&quot;cool&quot;</span></a>
<a class="sourceLine" id="cb1729-7" data-line-number="7">} <span class="cf">else</span> <span class="cf">if</span> (temp <span class="op">&lt;=</span><span class="st"> </span><span class="dv">30</span>) {</a>
<a class="sourceLine" id="cb1729-8" data-line-number="8">  <span class="st">&quot;warm&quot;</span></a>
<a class="sourceLine" id="cb1729-9" data-line-number="9">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1729-10" data-line-number="10">  <span class="st">&quot;hot&quot;</span></a>
<a class="sourceLine" id="cb1729-11" data-line-number="11">}</a></code></pre></div>
<pre><code>## Warning in if (temp &lt;= 0) {: длина условия &gt; 1, будет использован только
## первый элемент</code></pre>
<pre><code>## [1] &quot;freezing&quot;</code></pre>
<p>Функция <code>cut()</code> делит диапазон <code>x</code> на интервалы и кодирует значения в <code>x</code> в зависимости от того, на какой интервал они попадают. Крайний левый интервал соответствует первому уровню, следующий левый - второму уровню и так далее.</p>
<p>У функции есть аргумент <code>breaks</code> — числовой вектор из двух или более уникальных точек разреза, либо одно число (больше или равное 2), дающее число интервалов, на которые должен быть вырезан x. Число интервалов</p>
<p>У функции есть логический аргумент <code>right</code>, по умолчанию заданный <code>right = TRUE</code> указывающий, должны ли интервалы быть закрыты справа (и открыты слева) или наоборот.</p>
<div class="sourceCode" id="cb1732"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1732-1" data-line-number="1">Z &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw">rnorm</span>(<span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb1732-2" data-line-number="2"><span class="kw">table</span>(<span class="kw">cut</span>(Z, <span class="dt">breaks =</span> <span class="dv">-6</span><span class="op">:</span><span class="dv">6</span>))</a></code></pre></div>
<pre><code>## 
## (-6,-5] (-5,-4] (-4,-3] (-3,-2] (-2,-1]  (-1,0]   (0,1]   (1,2]   (2,3] 
##       0       0       9     187    1392    3418    3385    1378     215 
##   (3,4]   (4,5]   (5,6] 
##      16       0       0</code></pre>
<div class="sourceCode" id="cb1734"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1734-1" data-line-number="1">aaa &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>)</a>
<a class="sourceLine" id="cb1734-2" data-line-number="2"><span class="kw">table</span>(<span class="kw">cut</span>(aaa, <span class="dv">11</span>))</a></code></pre></div>
<pre><code>## 
## (0.994,1.55]  (1.55,2.09]  (2.09,2.64]  (2.64,3.18]  (3.18,3.73] 
##            1            2            0            2            0 
##  (3.73,4.27]  (4.27,4.82]  (4.82,5.36]  (5.36,5.91]  (5.91,6.45] 
##            2            0            2            0            1 
##  (6.45,7.01] 
##            1</code></pre>
<p>Если посмотреть на скобочки, когда параметр <code>right = TRUE</code>, то они являются включающим множеством т.е. неравенством <code>&lt;=</code> что подходит для первого условия нашей задачи. Тогда для оптимизации функции нужно проделать следующее:</p>
<ol style="list-style-type: decimal">
<li><p>Указать диапазоны — от минус бесконечности, 0, 10, 20, 30, до плюс бесконечности.</p></li>
<li><p>Указать параметр — <code>right = TRUE</code>,</p></li>
<li><p>Указать подписи — “freezing”, “cold”, “cool”, “warm”, “hot” в параметре <code>labels()</code></p></li>
</ol>
<p>Итого получаем:</p>
<div class="sourceCode" id="cb1736"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1736-1" data-line-number="1">temp</a></code></pre></div>
<pre><code>##  [1] -20 -15 -10  -5   0   5  10  15  20  25  30  35  40</code></pre>
<div class="sourceCode" id="cb1738"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1738-1" data-line-number="1"><span class="kw">table</span>(<span class="kw">cut</span>(temp, <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb1738-2" data-line-number="2">  <span class="dt">right =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb1738-3" data-line-number="3">  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;freezing&quot;</span>, <span class="st">&quot;cold&quot;</span>, <span class="st">&quot;cool&quot;</span>, <span class="st">&quot;warm&quot;</span>, <span class="st">&quot;hot&quot;</span>)</a>
<a class="sourceLine" id="cb1738-4" data-line-number="4">))</a></code></pre></div>
<pre><code>## 
## freezing     cold     cool     warm      hot 
##        5        2        2        2        2</code></pre>
<p>Если неравенство станет строгим, то есть сменится <code>&lt;=</code> на <code>&lt;</code>, тогда нам нужно будет поменять параметр на противоположное значение <code>right = FALSE</code></p>
<div class="sourceCode" id="cb1740"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1740-1" data-line-number="1"><span class="kw">table</span>(<span class="kw">cut</span>(temp, <span class="kw">c</span>(<span class="op">-</span><span class="ot">Inf</span>, <span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="ot">Inf</span>),</a>
<a class="sourceLine" id="cb1740-2" data-line-number="2">  <span class="dt">right =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb1740-3" data-line-number="3">  <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;freezing&quot;</span>, <span class="st">&quot;cold&quot;</span>, <span class="st">&quot;cool&quot;</span>, <span class="st">&quot;warm&quot;</span>, <span class="st">&quot;hot&quot;</span>)</a>
<a class="sourceLine" id="cb1740-4" data-line-number="4">))</a></code></pre></div>
<pre><code>## 
## freezing     cold     cool     warm      hot 
##        4        2        2        2        3</code></pre>
<p>Двумя преимуществами использования <code>cut()</code> является:</p>
<ol style="list-style-type: decimal">
<li><p><code>cut()</code> работает с векторами, тогда как, <code>if</code> работает только с одним значением,</p></li>
<li><p>для изменения условия сравнения нужно было только изменить аргумент <code>right</code>, в то время как в инструкции <code>if</code> пришлось бы изменить четыре оператора.</p></li>
</ol>
</div>
<div id="-19.4.4.5" class="section level4">
<h4><span class="header-section-number">4.4.4.8</span> Упражнение 19.4.4.5</h4>
<div class="question">
<p>What happens if you use <code>switch()</code> with numeric values?</p>
</div>
<p>В <code>switch(n, ...)</code>, если <code>n</code> является числовым, он вернет <code>n</code>-й аргумент из <code>...</code>. Это означает, что если <code>n = 1</code>, <code>switch()</code> вернет первый аргумент в <code>...</code>, если <code>n = 2</code>, второй и тд. Например,</p>
<div class="sourceCode" id="cb1742"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1742-1" data-line-number="1"><span class="cf">switch</span>(<span class="dv">1</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cow&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cat&quot;</code></pre>
<div class="sourceCode" id="cb1744"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1744-1" data-line-number="1"><span class="cf">switch</span>(<span class="dv">3</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cow&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cow&quot;</code></pre>
<div class="sourceCode" id="cb1746"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1746-1" data-line-number="1"><span class="co"># При нуле и меньше функция работает вхолостую</span></a>
<a class="sourceLine" id="cb1746-2" data-line-number="2"><span class="cf">switch</span>(<span class="dv">0</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cow&quot;</span>)</a>
<a class="sourceLine" id="cb1746-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1746-4" data-line-number="4"><span class="cf">switch</span>(<span class="op">-</span><span class="dv">1</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cow&quot;</span>)</a>
<a class="sourceLine" id="cb1746-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1746-6" data-line-number="6"><span class="co"># Если чесло нецело, то игнорируется нецелая часть.</span></a>
<a class="sourceLine" id="cb1746-7" data-line-number="7"><span class="co"># Не округляется, а именно отсекается</span></a>
<a class="sourceLine" id="cb1746-8" data-line-number="8"><span class="cf">switch</span>(<span class="fl">1.5</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cow&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cat&quot;</code></pre>
<div class="sourceCode" id="cb1748"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1748-1" data-line-number="1"><span class="cf">switch</span>(<span class="fl">3.2</span>, <span class="st">&quot;cat&quot;</span>, <span class="st">&quot;dog&quot;</span>, <span class="st">&quot;cow&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cow&quot;</code></pre>
</div>
<div id="-19.4.4.6" class="section level4">
<h4><span class="header-section-number">4.4.4.9</span> Упражнение 19.4.4.6</h4>
<div class="question">
<p>What does this switch() call do? What happens if x is “e”?</p>
<div class="sourceCode" id="cb1750"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1750-1" data-line-number="1"><span class="co">#switch(x, </span></a>
<a class="sourceLine" id="cb1750-2" data-line-number="2"><span class="co">#  a = ,</span></a>
<a class="sourceLine" id="cb1750-3" data-line-number="3"><span class="co">#  b = &quot;ab&quot;,</span></a>
<a class="sourceLine" id="cb1750-4" data-line-number="4"><span class="co">#  c = ,</span></a>
<a class="sourceLine" id="cb1750-5" data-line-number="5"><span class="co">#  d = &quot;cd&quot;</span></a>
<a class="sourceLine" id="cb1750-6" data-line-number="6"><span class="co">#)</span></a></code></pre></div>
<p>Experiment, then carefully read the documentation.</p>
</div>
<div class="sourceCode" id="cb1751"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1751-1" data-line-number="1">foo1 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1751-2" data-line-number="2"> <span class="cf">switch</span>(x, </a>
<a class="sourceLine" id="cb1751-3" data-line-number="3">  <span class="dt">a =</span> ,</a>
<a class="sourceLine" id="cb1751-4" data-line-number="4">  <span class="dt">b =</span> <span class="st">&quot;ab&quot;</span>,</a>
<a class="sourceLine" id="cb1751-5" data-line-number="5">  <span class="dt">c =</span> ,</a>
<a class="sourceLine" id="cb1751-6" data-line-number="6">  <span class="dt">d =</span> <span class="st">&quot;cd&quot;</span></a>
<a class="sourceLine" id="cb1751-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb1751-8" data-line-number="8">}</a></code></pre></div>
<div class="sourceCode" id="cb1752"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1752-1" data-line-number="1"><span class="kw">foo1</span>(<span class="st">&quot;a&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;ab&quot;</code></pre>
<div class="sourceCode" id="cb1754"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1754-1" data-line-number="1"><span class="kw">foo1</span>(<span class="st">&quot;b&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;ab&quot;</code></pre>
<div class="sourceCode" id="cb1756"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1756-1" data-line-number="1"><span class="kw">foo1</span>(<span class="st">&quot;c&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cd&quot;</code></pre>
<div class="sourceCode" id="cb1758"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1758-1" data-line-number="1"><span class="kw">foo1</span>(<span class="st">&quot;d&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cd&quot;</code></pre>
<div class="sourceCode" id="cb1760"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1760-1" data-line-number="1"><span class="kw">foo1</span>(<span class="st">&quot;e&quot;</span>)</a>
<a class="sourceLine" id="cb1760-2" data-line-number="2"><span class="kw">foo1</span>(<span class="st">&quot;f&quot;</span>)</a></code></pre></div>
<p>Если есть совпадение, то этот элемент оценивается, если только он не отсутствует, и в этом случае следующий не пропущенный элемент оценивается, поэтому, например, <code>switch(&quot;cc&quot;, a = 1, cc =, cd =, d = 2)</code> оценивается как 2. Если найдено более одного совпадения, используется первый соответствующий элемент. В случае отсутствия совпадения, если есть неназванный элемент … возвращается его значение. (Если существует более одного такого аргумента, сообщается об ошибке.)</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">4.4.5</span> Аргументы функций</h3>
<p>Аргументы, можно разделить на две категории:</p>
<ul>
<li><p>ПРедоставляют данные</p></li>
<li><p>ПРедоставляют параметеры, управляющие деталями вычислений</p></li>
</ul>
<p>Аргументы с данными указываются в начале.
Аргументы с параметрами указываются в конце. И правилом хорошего тона будет указать значение по умолчанию</p>
<div class="sourceCode" id="cb1761"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1761-1" data-line-number="1"><span class="co"># Вычисление доверительного интервала вокруг среднего,</span></a>
<a class="sourceLine" id="cb1761-2" data-line-number="2"><span class="co"># С использованием нормального распределения</span></a>
<a class="sourceLine" id="cb1761-3" data-line-number="3">mean_ci &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">conf =</span> <span class="fl">0.95</span>) {</a>
<a class="sourceLine" id="cb1761-4" data-line-number="4">  se &lt;-<span class="st"> </span><span class="kw">sd</span>(x) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb1761-5" data-line-number="5">  alpha &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>conf</a>
<a class="sourceLine" id="cb1761-6" data-line-number="6">  <span class="kw">mean</span>(x) <span class="op">+</span><span class="st"> </span>se <span class="op">*</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="kw">c</span>(alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb1761-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1761-8" data-line-number="8"></a>
<a class="sourceLine" id="cb1761-9" data-line-number="9">x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">105</span>)</a>
<a class="sourceLine" id="cb1761-10" data-line-number="10">x</a></code></pre></div>
<pre><code>##   [1] 0.026487029 0.515130897 0.195167141 0.831703663 0.129554717
##   [6] 0.185168429 0.632251463 0.535526327 0.675046351 0.988661654
##  [11] 0.432200926 0.370042007 0.707427392 0.849246441 0.863696977
##  [16] 0.041913603 0.297786287 0.165085997 0.008960255 0.296157301
##  [21] 0.290192978 0.288962480 0.571073835 0.945594596 0.205834738
##  [26] 0.062982355 0.987443567 0.821872583 0.079915832 0.629564789
##  [31] 0.186292728 0.814616146 0.593920487 0.944233858 0.164173601
##  [36] 0.903212487 0.625423856 0.303799649 0.598635467 0.355935154
##  [41] 0.114941126 0.097112356 0.630946873 0.954617942 0.019959864
##  [46] 0.159609491 0.511225586 0.550200659 0.512295697 0.818957088
##  [51] 0.710447021 0.230856191 0.622277329 0.220444546 0.517584426
##  [56] 0.164817421 0.722157116 0.563538347 0.114757291 0.672849227
##  [61] 0.786299957 0.928532834 0.438271166 0.855849516 0.548716651
##  [66] 0.766583868 0.822483113 0.627915543 0.881178064 0.920999965
##  [71] 0.293866682 0.039950435 0.917561812 0.789187250 0.441902744
##  [76] 0.738156016 0.794554169 0.507301225 0.086756641 0.432960022
##  [81] 0.632847381 0.390235433 0.229736655 0.870462565 0.420516149
##  [86] 0.405545351 0.714031155 0.915720364 0.701967294 0.541794774
##  [91] 0.503859381 0.122195936 0.667280148 0.953083149 0.648686296
##  [96] 0.364512863 0.779595392 0.674644516 0.259211450 0.513851226
## [101] 0.138915154 0.313264571 0.665255905 0.236335580 0.322729481</code></pre>
<div class="sourceCode" id="cb1763"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1763-1" data-line-number="1"><span class="kw">mean_ci</span>(x)</a></code></pre></div>
<pre><code>## [1] 0.4562925 0.5653417</code></pre>
<p>Функция предоставляет рандомное отклонение со следующими параметрами <code>runif(n, min = 0, max = 1)</code></p>
<p>Значение по умолчанию — наиболее часто используемое значение.
Исключение — безопасность. Например — <code>na.rm = FALSE</code> использовать значение <code>TRUE</code>, даже если чаще всего пропущенные значения и игнорируются, делать это по умолчанию плохая затея.
Тут просматривается паттернализм — если делается выбор, по умолчанию то максимально безопасный. Чтобы изменить его, нужно сделать это осознанно.</p>
<p>Если перекрываешь значение по умолчанию аргумента, управляющего вычислениями, то нужно использовать полное имя</p>
<div class="sourceCode" id="cb1765"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1765-1" data-line-number="1"><span class="co"># Good</span></a>
<a class="sourceLine" id="cb1765-2" data-line-number="2"><span class="kw">mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 5.5</code></pre>
<div class="sourceCode" id="cb1767"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1767-1" data-line-number="1"><span class="co"># Bad</span></a>
<a class="sourceLine" id="cb1767-2" data-line-number="2"><span class="co"># mean(x = 1:10, , FALSE)</span></a>
<a class="sourceLine" id="cb1767-3" data-line-number="3"><span class="co"># mean(, TRUE, x = c(1:10, NA))</span></a></code></pre></div>
<p>Используй пробелы, это упростит чтение кода</p>
<div class="sourceCode" id="cb1768"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1768-1" data-line-number="1"><span class="co"># Good</span></a>
<a class="sourceLine" id="cb1768-2" data-line-number="2"><span class="co"># average &lt;- mean(feet / 12 + inches, na.rm = TRUE)</span></a>
<a class="sourceLine" id="cb1768-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1768-4" data-line-number="4"><span class="co"># Bad</span></a>
<a class="sourceLine" id="cb1768-5" data-line-number="5"><span class="co"># average&lt;-mean(feet/12+inches,na.rm=TRUE)</span></a></code></pre></div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.4.5.1</span> Выбор имени</h4>
<p>Имя аргументов очень важная штука. Имена нужны для упрощения восприятия твоего кода читателем, а не программой.</p>
<p>Существуют часто употребимые названия аргументов, их следует запомнить</p>
<ul>
<li><p>x, y, z: vectors.</p></li>
<li><p>w: a vector of weights.</p></li>
<li><p>df: a data frame.</p></li>
<li><p>i, j: numeric indices (typically rows and columns).</p></li>
<li><p>n: length, or number of rows.</p></li>
<li><p>p: number of columns.</p></li>
</ul>
<p>Во всех остальных случаях операйся на уже существующие имена. Например используй имя <code>na.rm</code> для аргумента который опускает пропущенные значения.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.4.5.2</span> Проверка значений</h4>
<p>Часто бывает полезно сделать ограничения явными. ПРедположим, мы написали функции для вычисления взвешенных итоговых статистик</p>
<div class="sourceCode" id="cb1769"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1769-1" data-line-number="1">wt_mean &lt;-<span class="st"> </span><span class="cf">function</span>(x, w) {</a>
<a class="sourceLine" id="cb1769-2" data-line-number="2">  <span class="kw">sum</span>(x <span class="op">*</span><span class="st"> </span>w) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(w)</a>
<a class="sourceLine" id="cb1769-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1769-4" data-line-number="4">wt_var &lt;-<span class="st"> </span><span class="cf">function</span>(x, w) {</a>
<a class="sourceLine" id="cb1769-5" data-line-number="5">  mu &lt;-<span class="st"> </span><span class="kw">wt_mean</span>(x, w)</a>
<a class="sourceLine" id="cb1769-6" data-line-number="6">  <span class="kw">sum</span>(w <span class="op">*</span><span class="st"> </span>(x <span class="op">-</span><span class="st"> </span>mu) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(w)</a>
<a class="sourceLine" id="cb1769-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb1769-8" data-line-number="8">wt_sd &lt;-<span class="st"> </span><span class="cf">function</span>(x, w) {</a>
<a class="sourceLine" id="cb1769-9" data-line-number="9">  <span class="kw">sqrt</span>(<span class="kw">wt_var</span>(x, w))</a>
<a class="sourceLine" id="cb1769-10" data-line-number="10">}</a></code></pre></div>
<p>Что произойдёт, если <code>x</code> и <code>w</code> имеют разную длинну.</p>
<div class="sourceCode" id="cb1770"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1770-1" data-line-number="1"><span class="kw">wt_mean</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>)</a></code></pre></div>
<pre><code>## [1] 7.666667</code></pre>
<p>Хорошая практика заключается в проверке важных предусловий и генерирования ошибки, если они не выполняются</p>
<div class="sourceCode" id="cb1772"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1772-1" data-line-number="1">wt_mean &lt;-<span class="st"> </span><span class="cf">function</span>(x, w) {</a>
<a class="sourceLine" id="cb1772-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(w)) {</a>
<a class="sourceLine" id="cb1772-3" data-line-number="3">    <span class="kw">stop</span>(<span class="st">&quot;`x` and `w` must be the same length&quot;</span>, <span class="dt">call =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1772-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb1772-5" data-line-number="5">  <span class="kw">sum</span>(x <span class="op">*</span><span class="st"> </span>w) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(x)</a>
<a class="sourceLine" id="cb1772-6" data-line-number="6">}</a></code></pre></div>
<p>Робастная — устойчивая к ошибкам. С этим нужно не перестараться.</p>
<p>Например, если бы мы добавили в функцию аргумент <code>na.rm</code>, то мы вероятно, не проверяли бы его слишком тщательно</p>
<div class="sourceCode" id="cb1773"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1773-1" data-line-number="1">wt_mean &lt;-<span class="st"> </span><span class="cf">function</span>(x, w, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1773-2" data-line-number="2">  <span class="co"># Проверка на то, логический ли параметр</span></a>
<a class="sourceLine" id="cb1773-3" data-line-number="3">  <span class="cf">if</span> (<span class="op">!</span><span class="kw">is.logical</span>(na.rm)) {</a>
<a class="sourceLine" id="cb1773-4" data-line-number="4">    <span class="kw">stop</span>(<span class="st">&quot;`na.rm` must be logical&quot;</span>)</a>
<a class="sourceLine" id="cb1773-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb1773-6" data-line-number="6">  <span class="co"># Проверка на совпадение длины</span></a>
<a class="sourceLine" id="cb1773-7" data-line-number="7">  <span class="cf">if</span> (<span class="kw">length</span>(na.rm) <span class="op">!=</span><span class="st"> </span><span class="dv">1</span>) {</a>
<a class="sourceLine" id="cb1773-8" data-line-number="8">    <span class="kw">stop</span>(<span class="st">&quot;`na.rm` must be length 1&quot;</span>)</a>
<a class="sourceLine" id="cb1773-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1773-10" data-line-number="10">  <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">!=</span><span class="st"> </span><span class="kw">length</span>(w)) {</a>
<a class="sourceLine" id="cb1773-11" data-line-number="11">    <span class="kw">stop</span>(<span class="st">&quot;`x` and `w` must be the same length&quot;</span>, <span class="dt">call. =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb1773-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb1773-13" data-line-number="13">  <span class="cf">if</span> (na.rm) {</a>
<a class="sourceLine" id="cb1773-14" data-line-number="14">    miss &lt;-<span class="st"> </span><span class="kw">is.na</span>(x) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(w)</a>
<a class="sourceLine" id="cb1773-15" data-line-number="15">    x &lt;-<span class="st"> </span>x[<span class="op">!</span>miss]</a>
<a class="sourceLine" id="cb1773-16" data-line-number="16">    w &lt;-<span class="st"> </span>w[<span class="op">!</span>miss]</a>
<a class="sourceLine" id="cb1773-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb1773-18" data-line-number="18">  <span class="kw">sum</span>(w <span class="op">*</span><span class="st"> </span>x) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(w)</a>
<a class="sourceLine" id="cb1773-19" data-line-number="19">}</a></code></pre></div>
<div class="sourceCode" id="cb1774"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1774-1" data-line-number="1"><span class="co"># wt_mean(1:3, 2:4, na.rm = 0)</span></a>
<a class="sourceLine" id="cb1774-2" data-line-number="2"><span class="co"># `na.rm` must be logical</span></a></code></pre></div>
<p>Для получения столь небольшого выигрыша нам пришлось проделать много дополнительной работ.
ПОлезным компромиссом является использование встроенной функции <code>stopifnot()</code>, которая выполняет проверку того, что каждый аргумент равен <code>TRUE</code>, и генерирует типовое сообщение об ошибке, если это не так.</p>
<div class="sourceCode" id="cb1775"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1775-1" data-line-number="1">wt_mean &lt;-<span class="st"> </span><span class="cf">function</span>(x, w, <span class="dt">na.rm =</span> <span class="ot">FALSE</span>) {</a>
<a class="sourceLine" id="cb1775-2" data-line-number="2">  <span class="kw">stopifnot</span>(<span class="kw">is.logical</span>(na.rm), <span class="kw">length</span>(na.rm) <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb1775-3" data-line-number="3">  <span class="kw">stopifnot</span>(<span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="kw">length</span>(w))</a>
<a class="sourceLine" id="cb1775-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb1775-5" data-line-number="5">  <span class="cf">if</span> (na.rm) {</a>
<a class="sourceLine" id="cb1775-6" data-line-number="6">    miss &lt;-<span class="st"> </span><span class="kw">is.na</span>(x) <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(w)</a>
<a class="sourceLine" id="cb1775-7" data-line-number="7">    x &lt;-<span class="st"> </span>x[<span class="op">!</span>miss]</a>
<a class="sourceLine" id="cb1775-8" data-line-number="8">    w &lt;-<span class="st"> </span>w[<span class="op">!</span>miss]</a>
<a class="sourceLine" id="cb1775-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb1775-10" data-line-number="10">  <span class="kw">sum</span>(w <span class="op">*</span><span class="st"> </span>x) <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(w)</a>
<a class="sourceLine" id="cb1775-11" data-line-number="11">}</a></code></pre></div>
<div class="sourceCode" id="cb1776"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1776-1" data-line-number="1"><span class="co">#wt_mean(1:6, 6:1, na.rm = &quot;foo&quot;)</span></a></code></pre></div>
<p>Заметим, что когда мы используем функцию <code>stopifnot()</code>, мы утверждаем что именно должно быть истинным, а не проверяете что может быть неправильным.</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">4.4.5.3</span> Точка-точка-точка (…)</h4>
<p>В R многие функции принимают произвольное количество входных параметров со значениями.</p>
<div class="sourceCode" id="cb1777"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1777-1" data-line-number="1"><span class="kw">sum</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 15</code></pre>
<p>Как они это делают? При помощи сабжа — <code>...</code> (многоточие). Этот аргумент захватывает любое количество аргументов, которым не назначено явных имен.</p>
<p>Такой подход очень удобен, посколько далее можно передать эти точки другой функции. Это особенно полезно, если функция в основном используется в качестве оболочки другой функции.
Например обычно мы создаем следующие вспомогательные функции-оболочки для функции <code>str_c()</code></p>
<div class="sourceCode" id="cb1779"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1779-1" data-line-number="1">commas &lt;-<span class="st"> </span><span class="cf">function</span>(...) stringr<span class="op">::</span><span class="kw">str_c</span>(..., <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)</a>
<a class="sourceLine" id="cb1779-2" data-line-number="2"><span class="kw">commas</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])</a></code></pre></div>
<pre><code>## [1] &quot;a, b, c, d, e, f, g, h, i, j&quot;</code></pre>
<div class="sourceCode" id="cb1781"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1781-1" data-line-number="1">rule &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">pad =</span> <span class="st">&quot;-&quot;</span>) {</a>
<a class="sourceLine" id="cb1781-2" data-line-number="2">  title &lt;-<span class="st"> </span><span class="kw">paste0</span>(...)</a>
<a class="sourceLine" id="cb1781-3" data-line-number="3">  width &lt;-<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;width&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">nchar</span>(title) <span class="op">-</span><span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1781-4" data-line-number="4">  <span class="kw">cat</span>(title, <span class="st">&quot; &quot;</span>, stringr<span class="op">::</span><span class="kw">str_dup</span>(pad, width), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1781-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1781-6" data-line-number="6"><span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>)</a></code></pre></div>
<pre><code>## Important output ------------------------------------------------------</code></pre>
<p>В данном случае многоточия позволяют передать функции <code>str_c()</code> любые аргументы, не нуждающиеся в обработке.</p>
<p>Любые неправильно записанные аргументы не будут генерировать ошибку.
Из-за этого опечатки могут легко пройти незамеыченными.</p>
<div class="sourceCode" id="cb1783"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1783-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb1783-2" data-line-number="2"><span class="kw">sum</span>(x, <span class="dt">na.mr =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb1785"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1785-1" data-line-number="1"><span class="kw">sum</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.4.5.4</span> Ленивые вычисления</h4>
<p>Аргументы обрабатываются в соответствии с концепцией ленивых <em>отложенных</em> вычислений.</p>
<p>Вычисление аргументов откладывается до тех пор, пока в этом не возникнет необходимости.</p>
<p>Отсюда следует, что те аргументы, которые не используются в функции, никогда не вычисляются.</p>
</div>
<div id="-19.5.5.1" class="section level4">
<h4><span class="header-section-number">4.4.5.5</span> Упражнение 19.5.5.1</h4>
<div class="question">
<p>What does <code>commas(letters, collapse = &quot;-&quot;)</code> do? Why?</p>
</div>
<p>Для начала напомню функцию которую мы прописали в параграфе “многоточие”</p>
<div class="sourceCode" id="cb1787"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1787-1" data-line-number="1">commas &lt;-<span class="st"> </span><span class="cf">function</span>(...) stringr<span class="op">::</span><span class="kw">str_c</span>(..., <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>)</a>
<a class="sourceLine" id="cb1787-2" data-line-number="2"><span class="kw">commas</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>])</a></code></pre></div>
<pre><code>## [1] &quot;a, b, c, d, e, f, g, h, i, j&quot;</code></pre>
<div class="sourceCode" id="cb1789"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1789-1" data-line-number="1"><span class="co"># commas(letters, collapse = &quot;-&quot;)</span></a></code></pre></div>
<p>Когда функция <code>commas()</code> свертывание задается способом указанном выше, она выдает ошибку.</p>
<p>Это связано с тем, что когда аргумент <code>collapse</code> передается <code>commas()</code>, он передается в <code>str_c()</code> как часть <code>...</code>. Другими словами, предыдущий код эквивалентен</p>
<div class="sourceCode" id="cb1790"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1790-1" data-line-number="1"><span class="co"># str_c(letters, collapse = &quot;-&quot;, collapse = &quot;, &quot;)</span></a></code></pre></div>
<p>Тем не менее, ошибочно давать один и тот же именованный аргумент функции дважды.
Почитай хэлп к <code>?stringr::str_c</code> — <code>collapse</code> аргумент для <code>str_c</code>.</p>
<p>Один из способов разрешить пользователю переопределять разделитель в <code>commas()</code> — это добавить аргумент свертывания в функцию.</p>
<div class="sourceCode" id="cb1791"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1791-1" data-line-number="1">commas &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">collapse =</span> <span class="st">&quot;, &quot;</span>) {</a>
<a class="sourceLine" id="cb1791-2" data-line-number="2">  stringr<span class="op">::</span><span class="kw">str_c</span>(..., <span class="dt">collapse =</span> collapse)</a>
<a class="sourceLine" id="cb1791-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1791-4" data-line-number="4"><span class="kw">commas</span>(letters, <span class="dt">collapse =</span> <span class="st">&quot;-&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;a-b-c-d-e-f-g-h-i-j-k-l-m-n-o-p-q-r-s-t-u-v-w-x-y-z&quot;</code></pre>
<p>Это может запутать. Поэтому имеет смысл назвать аргумент <code>collapse</code> в <code>commas()</code> как-нибудь по-другому например <code>furl</code>, или ещё каким-нибудь словом синонимом.</p>
<div class="sourceCode" id="cb1793"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1793-1" data-line-number="1">commas &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">furl =</span> <span class="st">&quot;, &quot;</span>) {</a>
<a class="sourceLine" id="cb1793-2" data-line-number="2">  stringr<span class="op">::</span><span class="kw">str_c</span>(..., <span class="dt">collapse =</span> furl)</a>
<a class="sourceLine" id="cb1793-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1793-4" data-line-number="4"><span class="kw">commas</span>(letters, <span class="dt">furl =</span> <span class="st">&quot;-&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;a-b-c-d-e-f-g-h-i-j-k-l-m-n-o-p-q-r-s-t-u-v-w-x-y-z&quot;</code></pre>
</div>
<div id="-19.5.5.2" class="section level4">
<h4><span class="header-section-number">4.4.5.6</span> Упражнение 19.5.5.2</h4>
<div class="question">
<p>It’d be nice if you could supply multiple characters to the <code>pad</code> argument, e.g. <code>rule(&quot;Title&quot;, pad = &quot;-+&quot;)</code>.
Why doesn’t this currently work?
How could you fix it?</p>
</div>
<p>Функция <code>rule</code> добивает до конца консоли заданные в <code>pad</code> символы. По умолчанию мы задали один символ <code>-</code></p>
<div class="sourceCode" id="cb1795"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1795-1" data-line-number="1">rule &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">pad =</span> <span class="st">&quot;-&quot;</span>) {</a>
<a class="sourceLine" id="cb1795-2" data-line-number="2">  title &lt;-<span class="st"> </span><span class="kw">paste0</span>(...)</a>
<a class="sourceLine" id="cb1795-3" data-line-number="3">  width &lt;-<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;width&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">nchar</span>(title) <span class="op">-</span><span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1795-4" data-line-number="4">  <span class="kw">cat</span>(title, <span class="st">&quot; &quot;</span>, stringr<span class="op">::</span><span class="kw">str_dup</span>(pad, width), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1795-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1795-6" data-line-number="6"><span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>)</a></code></pre></div>
<pre><code>## Important output ------------------------------------------------------</code></pre>
<p>Разберём всё по порядку.</p>
<p>Функция <code>getOption(&quot;width&quot;)</code> — возвращает текущую длину консоли</p>
<div class="sourceCode" id="cb1797"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1797-1" data-line-number="1"><span class="kw">getOption</span>(<span class="st">&quot;width&quot;</span>)</a></code></pre></div>
<pre><code>## [1] 75</code></pre>
<p>Отсюда получается, что выражение <code>getOption(&quot;width&quot;) - nchar(title) - 5</code> возвращает длинну текущего окна консоли минус длинну передаваемого заголовка и минус 5</p>
<p>Функция <code>cat()</code> — это конкатенация.</p>
<div class="sourceCode" id="cb1799"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1799-1" data-line-number="1"><span class="kw">cat</span>(<span class="st">&quot;1&quot;</span>, <span class="dv">2</span>, <span class="st">&quot;doggy&quot;</span>)</a></code></pre></div>
<pre><code>## 1 2 doggy</code></pre>
<p>Функция <code>stringr::str_dup()</code> повторяет вектор строк заданное количество раз.</p>
<div class="sourceCode" id="cb1801"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1801-1" data-line-number="1">fruit &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;apple&quot;</span>, <span class="st">&quot;pear&quot;</span>, <span class="st">&quot;banana&quot;</span>)</a>
<a class="sourceLine" id="cb1801-2" data-line-number="2">stringr<span class="op">::</span><span class="kw">str_dup</span>(fruit, <span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] &quot;appleapple&quot;   &quot;pearpear&quot;     &quot;bananabanana&quot;</code></pre>
<p>Итого функция <code>rule()</code> дублирует <code>pad</code> количество раз, равное желаемой ширине, минус длина <code>title</code> и пять дополнительных символов. Это подразумевает, что <code>pad</code> — это всего лишь один символ. Если бы <code>pad</code> был двухсимвольным, результат будет почти вдвое длиннее.</p>
<div class="sourceCode" id="cb1803"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1803-1" data-line-number="1"><span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;+-&quot;</span>)</a></code></pre></div>
<pre><code>## Important output +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-</code></pre>
<div class="sourceCode" id="cb1805"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1805-1" data-line-number="1"><span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;+-Ж&quot;</span>)</a></code></pre></div>
<pre><code>## Important output +-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж+-Ж</code></pre>
<div class="sourceCode" id="cb1807"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1807-1" data-line-number="1"><span class="kw">rule</span>(<span class="st">&quot;Important output&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;+-01&quot;</span>)</a></code></pre></div>
<pre><code>## Important output +-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01+-01</code></pre>
<p>Чтобы функция работала с несколькими символами в <code>pad</code>, одним из подходов можно укоротить количество выводимых символов.</p>
<div class="sourceCode" id="cb1809"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1809-1" data-line-number="1">rule &lt;-<span class="st"> </span><span class="cf">function</span>(..., <span class="dt">pad =</span> <span class="st">&quot;-&quot;</span>) {</a>
<a class="sourceLine" id="cb1809-2" data-line-number="2">  title &lt;-<span class="st"> </span><span class="kw">paste0</span>(...)</a>
<a class="sourceLine" id="cb1809-3" data-line-number="3">  width &lt;-<span class="st"> </span><span class="kw">getOption</span>(<span class="st">&quot;width&quot;</span>) <span class="op">-</span><span class="st"> </span><span class="kw">nchar</span>(title) <span class="op">-</span><span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb1809-4" data-line-number="4">  gap &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_dup</span>(</a>
<a class="sourceLine" id="cb1809-5" data-line-number="5">    pad,</a>
<a class="sourceLine" id="cb1809-6" data-line-number="6">    <span class="kw">ceiling</span>(width <span class="op">/</span><span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_length</span>(title))</a>
<a class="sourceLine" id="cb1809-7" data-line-number="7">  )</a>
<a class="sourceLine" id="cb1809-8" data-line-number="8">  <span class="kw">cat</span>(title, <span class="st">&quot; &quot;</span>, gap, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1809-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb1809-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1809-11" data-line-number="11"><span class="kw">rule</span>(<span class="st">&quot;Valuable output&quot;</span>, <span class="dt">pad =</span> <span class="st">&quot;-+38&quot;</span>)</a></code></pre></div>
<pre><code>## Valuable output -+38-+38-+38-+38</code></pre>
<p>Это решение в пределе не совершенно, поскольку при увеличении количества символов, разделитель будет переходить на другую строку. Этого можно избежать усекая строку. Но это уже отладка функции. Вернусь к этой проблеме немного попозже.</p>
</div>
<div id="-19.5.5.3" class="section level4">
<h4><span class="header-section-number">4.4.5.7</span> Упражнение 19.5.5.3</h4>
<div class="question">
<p>What does the <code>trim</code> argument to <code>mean()</code> do?
When might you use it?</p>
</div>
<p><code>trim</code> — это доля (от 0 до 0,5) наблюдений, которая будет обрезана с каждого конца <code>x</code> до вычисления среднего значения. Значения дифферента за пределами этого диапазона принимаются в качестве ближайшей конечной точки.</p>
<p>Это может пригодится, когда известны выбросы в данных, и понятно, что их можно отбросить.
Это полезно для расчета показателя центральной тенденции, который устойчив к выбросам.</p>
<div class="sourceCode" id="cb1811"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1811-1" data-line-number="1">x &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1811-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">100</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb1811-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1811-4" data-line-number="4">matrix &lt;-<span class="st"> </span><span class="kw">as_tibble</span>(<span class="kw">cbind</span>(x, y))</a>
<a class="sourceLine" id="cb1811-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1811-6" data-line-number="6"><span class="kw">ggplot</span>(<span class="dt">data =</span> matrix, <span class="kw">aes</span>(x,y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb1811-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-876-1.png" width="672" /></p>
<div class="sourceCode" id="cb1812"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1812-1" data-line-number="1"><span class="kw">mean</span>(y)</a></code></pre></div>
<pre><code>## [1] 20.8</code></pre>
<div class="sourceCode" id="cb1814"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1814-1" data-line-number="1"><span class="kw">mean</span>(y, <span class="dt">trim =</span> <span class="fl">0.2</span>)</a></code></pre></div>
<pre><code>## [1] 1</code></pre>
</div>
<div id="-19.5.5.4" class="section level4">
<h4><span class="header-section-number">4.4.5.8</span> Упражнение 19.5.5.4</h4>
<div class="question">
<p>The default value for the method argument to <code>cor()</code> is <code>c(&quot;pearson&quot;, &quot;kendall&quot;, &quot;spearman&quot;)</code>.
What does that mean?
What value is used by default?</p>
</div>
<div class="sourceCode" id="cb1816"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1816-1" data-line-number="1"><span class="co"># ?cor</span></a></code></pre></div>
<p>В описании говорится:</p>
<p><code>method</code> — это строка символов, указывающая, какой коэффициент корреляции должен быть вычислен. Один из «pearson» (по умолчанию), «kendall» или «spearman».</p>
<p>Это означает, что аргумент метода может принимать одно из этих трех значений. Первое значение, «pearson», используется по умолчанию.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">4.4.6</span> Возвращаемые значения</h3>
<p>При организации возврата следует помнить две вещи:</p>
<ul>
<li><p>Облегчит ли чтение текста функции преждевременный возврат</p></li>
<li><p>Нельзя ли сделать функцию пригодной для включения в цепочки канала</p></li>
</ul>
<div id="--" class="section level4">
<h4><span class="header-section-number">4.4.6.1</span> Явные команды возврата</h4>
<p>Обычно возврат значения является последней инструкцией функции, однако можно организовать преждевременный при помощи <code>return()</code></p>
<div class="sourceCode" id="cb1817"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1817-1" data-line-number="1">complicated_function &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, z) {</a>
<a class="sourceLine" id="cb1817-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">length</span>(x) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">||</span><span class="st"> </span><span class="kw">length</span>(y) <span class="op">==</span><span class="st"> </span><span class="dv">0</span>) {</a>
<a class="sourceLine" id="cb1817-3" data-line-number="3">    <span class="kw">return</span>(<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb1817-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb1817-5" data-line-number="5">    </a>
<a class="sourceLine" id="cb1817-6" data-line-number="6">  <span class="co"># Complicated code here</span></a>
<a class="sourceLine" id="cb1817-7" data-line-number="7">}</a></code></pre></div>
<p>Другой ситуацией является инструкция <code>if</code> с одним сложным и одним простым блоками. Например</p>
<div class="sourceCode" id="cb1818"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1818-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1818-2" data-line-number="2">  <span class="cf">if</span> (x) {</a>
<a class="sourceLine" id="cb1818-3" data-line-number="3">    <span class="co"># Do </span></a>
<a class="sourceLine" id="cb1818-4" data-line-number="4">    <span class="co"># something</span></a>
<a class="sourceLine" id="cb1818-5" data-line-number="5">    <span class="co"># that</span></a>
<a class="sourceLine" id="cb1818-6" data-line-number="6">    <span class="co"># takes</span></a>
<a class="sourceLine" id="cb1818-7" data-line-number="7">    <span class="co"># many</span></a>
<a class="sourceLine" id="cb1818-8" data-line-number="8">    <span class="co"># lines</span></a>
<a class="sourceLine" id="cb1818-9" data-line-number="9">    <span class="co"># to</span></a>
<a class="sourceLine" id="cb1818-10" data-line-number="10">    <span class="co"># express</span></a>
<a class="sourceLine" id="cb1818-11" data-line-number="11">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1818-12" data-line-number="12">    <span class="co"># return something short</span></a>
<a class="sourceLine" id="cb1818-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb1818-14" data-line-number="14">}</a></code></pre></div>
<p>Но если первый блок ичень длинный то к тому времени, когда дойдём до <code>else</code> можно забыть об условии. Один из способов устранить это недоразумение — использовать ранний возврат</p>
<div class="sourceCode" id="cb1819"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1819-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>() {</a>
<a class="sourceLine" id="cb1819-2" data-line-number="2">  <span class="cf">if</span> (<span class="op">!</span>x) {</a>
<a class="sourceLine" id="cb1819-3" data-line-number="3">    <span class="kw">return</span>(something_short)</a>
<a class="sourceLine" id="cb1819-4" data-line-number="4">  }</a>
<a class="sourceLine" id="cb1819-5" data-line-number="5"></a>
<a class="sourceLine" id="cb1819-6" data-line-number="6">  <span class="co"># Do </span></a>
<a class="sourceLine" id="cb1819-7" data-line-number="7">  <span class="co"># something</span></a>
<a class="sourceLine" id="cb1819-8" data-line-number="8">  <span class="co"># that</span></a>
<a class="sourceLine" id="cb1819-9" data-line-number="9">  <span class="co"># takes</span></a>
<a class="sourceLine" id="cb1819-10" data-line-number="10">  <span class="co"># many</span></a>
<a class="sourceLine" id="cb1819-11" data-line-number="11">  <span class="co"># lines</span></a>
<a class="sourceLine" id="cb1819-12" data-line-number="12">  <span class="co"># to</span></a>
<a class="sourceLine" id="cb1819-13" data-line-number="13">  <span class="co"># express</span></a>
<a class="sourceLine" id="cb1819-14" data-line-number="14">}</a></code></pre></div>
<p>В этом случае на ранний возврат обращаешь внимание сразу, не просматривая весь длинный код.</p>
</div>
<div id="------" class="section level4">
<h4><span class="header-section-number">4.4.6.2</span> Написание функций, пригодных для включения в канал</h4>
<p>Функции способные работать в канале можно разбить на два типа:</p>
<ul>
<li><p>преобразования</p></li>
<li><p>побочные</p></li>
</ul>
<p>Преобразующие — имеется четко определённый первичный объект, который передается в качестве первого аргумента, и его модифицированная версия возвращается функцией.
Например для <code>dplyr</code> и <code>tidyr</code> — ключевыми объектами являются фреймы данных.</p>
<p>Функции с побочным эффектом вызываются в первую очередь для какого-либо действия, например для рисования графика или созхранения файла, а не для преобразования объекта. Эти функции должны возвращать первый аргумент “невидимо”, поэтому по умолчанию они ничего не выводят, но могут быть использованы в канале. Напримео, следующая функцию выводит кол-во отсутствующих значений во фрейме данных.</p>
<div class="sourceCode" id="cb1820"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1820-1" data-line-number="1">show_missings &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb1820-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">is.na</span>(df))</a>
<a class="sourceLine" id="cb1820-3" data-line-number="3">  <span class="kw">cat</span>(<span class="st">&quot;Missing values: &quot;</span>, n, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1820-4" data-line-number="4">  </a>
<a class="sourceLine" id="cb1820-5" data-line-number="5">  <span class="kw">invisible</span>(df)</a>
<a class="sourceLine" id="cb1820-6" data-line-number="6">}</a></code></pre></div>
<p>Если мы вызываем её интерактивно, то вызыво <code>invisible()</code> означает, что входной объект <code>df</code> не выводится.</p>
<div class="sourceCode" id="cb1821"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1821-1" data-line-number="1"><span class="kw">show_missings</span>(mtcars)</a></code></pre></div>
<pre><code>## Missing values: 0</code></pre>
<p>Но он есть, просто по умолчанию не выводится.</p>
<div class="sourceCode" id="cb1823"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1823-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">show_missings</span>(mtcars) </a></code></pre></div>
<pre><code>## Missing values: 0</code></pre>
<div class="sourceCode" id="cb1825"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1825-1" data-line-number="1"><span class="kw">class</span>(x)</a></code></pre></div>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<div class="sourceCode" id="cb1827"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1827-1" data-line-number="1"><span class="kw">dim</span>(x)</a></code></pre></div>
<pre><code>## [1] 32 11</code></pre>
<p>И мы всё ещё можем использовать функцию в канале.</p>
<div class="sourceCode" id="cb1829"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1829-1" data-line-number="1">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1829-2" data-line-number="2"><span class="st">  </span><span class="kw">show_missings</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1829-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mpg =</span> <span class="kw">ifelse</span>(mpg <span class="op">&lt;</span><span class="st"> </span><span class="dv">20</span>, <span class="ot">NA</span>, mpg)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1829-4" data-line-number="4"><span class="st">  </span><span class="kw">show_missings</span>()</a></code></pre></div>
<pre><code>## Missing values: 0
## Missing values: 18</code></pre>
</div>
</div>
<div class="section level3">
<h3><span class="header-section-number">4.4.7</span> Окружение</h3>
<p>Окружение функции в значительной мере определяют как работают функции. Окружение управляет тем, как R находит значение, связанное с именем. Возьмем, например,</p>
<div class="sourceCode" id="cb1831"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1831-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1831-2" data-line-number="2">  x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb1831-3" data-line-number="3">}</a></code></pre></div>
<p>Во многих языках программирования этот код будет ошибочным — потому что отсутствует определение переменной <code>y</code>.
Но в данном случае это нормальный код, так как в R для определения значений переменных используется <em>лексическая область видимости</em>. Поскольку переменная <code>y</code> не определена в функции, R будет искать её в <em>окружении</em>, содержащим определение функции.</p>
<div class="sourceCode" id="cb1832"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1832-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb1832-2" data-line-number="2"><span class="kw">f</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 110</code></pre>
<div class="sourceCode" id="cb1834"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1834-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb1834-2" data-line-number="2"><span class="kw">f</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 1010</code></pre>
<p>R сила — благодаря своей гибкости можно переопределять базовые функции. И ещё много чего, о чём можно узнать из книги <em>Advanced R</em> <a href="http://adv-r.had.co.nz" class="uri">http://adv-r.had.co.nz</a></p>
<!--chapter:end:15_function.Rmd-->
</div>
</div>
<div class="section level2">
<h2><span class="header-section-number">4.5</span> Векторы</h2>
<div id="-14" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Введение</h3>
<p>Векторы в R — наше всё. Надо быть готовыми к работе с ними.</p>
<div id="--4" class="section level4">
<h4><span class="header-section-number">4.5.1.1</span> Используемые ресурсы</h4>
<p>Нам понадятся ряд функций из пакета <code>purrr</code></p>
<div class="sourceCode" id="cb1836"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1836-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb1836-2" data-line-number="2"><span class="kw">library</span>(pryr)</a></code></pre></div>
<pre><code>## 
## Attaching package: &#39;pryr&#39;</code></pre>
<pre><code>## The following object is masked _by_ &#39;.GlobalEnv&#39;:
## 
##     f</code></pre>
<pre><code>## The following objects are masked from &#39;package:purrr&#39;:
## 
##     compose, partial</code></pre>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Основные сведения о векторах</h3>
<p>Есть два основных типа векторов: атомарные вектора и списки</p>
<ol style="list-style-type: decimal">
<li><em>Атомарные векторы</em> :</li>
</ol>
<ul>
<li><p>логический (<code>logical</code>)</p></li>
<li><p>целочисленный (<code>integer</code>)</p></li>
<li><p>вещественный (<code>double</code>)</p></li>
<li><p>символьный (<code>character</code>)</p></li>
<li><p>комплексный (<code>complex</code>)</p></li>
<li><p>двоичные (“сырые”) данные (<code>raw</code>)</p></li>
</ul>
<ol start="2" style="list-style-type: decimal">
<li><em>Списки</em>, их иногда называют рекурсивными векторами — потому что они могут содержать другие списки.</li>
</ol>
<p>Главное различие между атомарными векторами и списками заключается в том, что первые однородны, тогда как вторые могут быть неоднородными, т.е. могут содержать элементы разных типов.
Существует еще один родственный им объект <code>NULL</code> — его часто используют для представления отсутствия вектора (в отличае от значения <code>NA</code>, используемого для представления отсутствия значения в векторе!).</p>
<p>Обычно <code>NULL</code> ведёт себя как вектор нулевой длины. Взаимосвязь различных векторов показана на рисунке</p>
<div class="figure">
<img src="img/vectors.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Каждый вектор зарактеризуется двумя основными свойствами.</p>
<ul>
<li><em>Тип</em> Для определениея типа вектора служит функция <code>typeof()</code></li>
</ul>
<div class="sourceCode" id="cb1840"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1840-1" data-line-number="1"><span class="kw">typeof</span>(<span class="st">&quot;letters&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb1842"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1842-1" data-line-number="1"><span class="kw">typeof</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<ul>
<li><em>Длина</em> Для определения длины вектора служит функция <code>length()</code></li>
</ul>
<div class="sourceCode" id="cb1844"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1844-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb1844-2" data-line-number="2"><span class="kw">length</span>(x)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<p>Кроме того, векторы могут содержать произвольные дополнительные метаданные в форме атрибутов, которые используются для создания <em>расширенных</em> векторово, обладающих дополнительными аспектами поведения. Существуют четыре важных типа расширенных векторов:</p>
<ul>
<li><p><em>факторы</em> — строятся поверх целочисленных векторов</p></li>
<li><p>векторы <em>даты</em> и <em>даты/времени</em> — строятся поверх числовых векторов</p></li>
<li><p><em>фрейм данные</em> и <em>tibble-фреймы</em> — строятся поверх списков</p></li>
</ul>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">4.5.3</span> Важные типы атомарных векторов</h3>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.3.1</span> Логический тип</h4>
<p>Простейший тип, могут содержать только три возможных значения <code>FALSE</code>, <code>TRUE</code>, и <code>NA</code></p>
<div class="sourceCode" id="cb1846"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1846-1" data-line-number="1"><span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE    NA</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.3.2</span> Числовой тип</h4>
<p>Целочисленные и вещественные векторы совокупно называются числовыми. Число обозначается как целое следующей за ним большой буквой <code>L</code></p>
<div class="sourceCode" id="cb1848"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1848-1" data-line-number="1"><span class="kw">typeof</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb1850"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1850-1" data-line-number="1"><span class="kw">typeof</span>(1L)</a></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<p>В R числа являются вещественными по умолчанию, за исключением следующих случаев</p>
<ul>
<li>Вещественные числа являются приближенными. Это значения, представляющие числа с плавающей точкой.
Например,</li>
</ul>
<div class="sourceCode" id="cb1852"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1852-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span>) <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb1852-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb1854"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1854-1" data-line-number="1">x <span class="op">-</span><span class="st"> </span><span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] 4.440892e-16</code></pre>
<p>Поэтому вещественные числа лучше сравнивать при помощи <code>dplyr::near()</code>. Это безопасный способ сравнения, если два вектора чисел с плавающей запятой (попарно) равны. Это безопаснее, чем использовать <code>==</code>, потому что он имеет встроенный допуск</p>
<ol style="list-style-type: decimal">
<li>Целые числа включают одно специальное значение — <code>NA</code>, тогда как среди вещественных чисел таких щначений четыре: <code>NA</code>, <code>NaN</code>, <code>Inf</code> и<code>-Inf</code>. Все огни могу появится при делении чисел</li>
</ol>
<div class="sourceCode" id="cb1856"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1856-1" data-line-number="1"><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="op">/</span><span class="st"> </span><span class="dv">0</span></a></code></pre></div>
<pre><code>## [1] -Inf  NaN  Inf</code></pre>
<p>Избегай использования оператора <code>==</code> для тестирования указанных специальных значений. Вместо этого используй вспомогательные функции
<code>is.finite()</code>, <code>is.infinite()</code> и <code>is.nan()</code></p>
<pre><code>|                  |  0  | Inf | NA  | NaN |
|------------------|-----|-----|-----|-----|
| `is.finite()`    |  x  |     |     |     |
| `is.infinite()`  |     |  x  |     |     |
| `is.na()`        |     |     |  x  |  x  |
| `is.nan()`       |     |     |     |  x  |</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.3.3</span> Символьный тип</h4>
<p>Самый сложный, поскольку каждый элемент — строка, а строка может содержать произвольное количество данных.</p>
<p>R использует глобальный пул строк — каждая уникальная строка сохраняется в памяти всего один раз. И всякий раз когда оа используется, фактически используется указательна представление строка.
Это позволяет снизить расход памяти при дублировании строк, в чем можно непосредственно убедиться с помощью функции <code>pryr::object_size()</code></p>
<div class="sourceCode" id="cb1859"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1859-1" data-line-number="1">x &lt;-<span class="st"> &quot;This is a reasonably long string.&quot;</span></a>
<a class="sourceLine" id="cb1859-2" data-line-number="2">pryr<span class="op">::</span><span class="kw">object_size</span>(x)</a></code></pre></div>
<pre><code>## 152 B</code></pre>
<div class="sourceCode" id="cb1861"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1861-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">rep</span>(x, <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb1861-2" data-line-number="2">pryr<span class="op">::</span><span class="kw">object_size</span>(y)</a></code></pre></div>
<pre><code>## 8.14 kB</code></pre>
<p>Переменная <code>y</code> не занимает в 1000 раз больше памяти по сравнению с <code>x</code>, поскольку каждый элемент <code>y</code> всего лишь указатель на одну и ту же строчку. Указатель занимает 8 байт, поэтому для 1000 указателей на строку, занимающую 136 байт, требуется память объёмом 8 * 1000 + 136 = 8,13 Кбайт.</p>
</div>
<div id="--4" class="section level4">
<h4><span class="header-section-number">4.5.3.4</span> Отсутствующие значения</h4>
<p>Для каждого типа атомарных векторов предусмотрено своё отсутствующее значение.</p>
<div class="sourceCode" id="cb1863"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1863-1" data-line-number="1"><span class="ot">NA</span>            <span class="co"># logical</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb1865"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1865-1" data-line-number="1"><span class="ot">NA_integer_</span>   <span class="co"># integer</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb1867"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1867-1" data-line-number="1"><span class="ot">NA_real_</span>      <span class="co"># double</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb1869"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1869-1" data-line-number="1"><span class="ot">NA_character_</span> <span class="co"># character</span></a></code></pre></div>
<pre><code>## [1] NA</code></pre>
</div>
<div id="-20.3.5.1" class="section level4">
<h4><span class="header-section-number">4.5.3.5</span> Упражнение 20.3.5.1</h4>
<div class="question">
<p>Describe the difference between <code>is.finite(x)</code> and <code>!is.infinite(x)</code>.</p>
</div>
<div class="sourceCode" id="cb1871"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1871-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="ot">NA</span>, <span class="ot">NaN</span>, <span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>)</a>
<a class="sourceLine" id="cb1871-2" data-line-number="2"><span class="kw">is.finite</span>(x)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE FALSE FALSE FALSE FALSE</code></pre>
<div class="sourceCode" id="cb1873"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1873-1" data-line-number="1"><span class="op">!</span><span class="kw">is.infinite</span>(x)</a></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE FALSE FALSE</code></pre>
<p>Функция <code>is.finite()</code> считает, что не пропущенные числовые <code>(0, 1)</code> значения являются конечными, а пропущенные <code>(NA)</code>, не число <code>(NaN)</code> и положительная-отрицательная бесконечность <code>(Inf, -Inf)</code> не являются конечными.
Функция <code>is.infinite()</code> ведет себя немного по-другому. Она считает, что <code>Inf</code> и <code>-Inf</code> бесконечны, а все остальное, включая не пропущенные числа, <code>NA</code> и <code>NaN</code>, не бесконечно.</p>
</div>
<div id="-20.3.5.2" class="section level4">
<h4><span class="header-section-number">4.5.3.6</span> Упражнение 20.3.5.2</h4>
<div class="question">
<p>Read the source code for <code>dplyr::near()</code> (Hint: to see the source code, drop the ()). How does it work?</p>
</div>
<div class="sourceCode" id="cb1875"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1875-1" data-line-number="1">dplyr<span class="op">::</span>near</a></code></pre></div>
<pre><code>## function (x, y, tol = .Machine$double.eps^0.5) 
## {
##     abs(x - y) &lt; tol
## }
## &lt;bytecode: 0x7fbe95905710&gt;
## &lt;environment: namespace:dplyr&gt;</code></pre>
<p>Вместо проверки на точное равенство, функция <code>dplyr::near()</code> проверяет, что два числа находятся в пределах определенного допуска, <code>tol</code>. По умолчанию для допуска установлен квадратный корень из <code>.Machine$double.eps</code>, который является наименьшим числом с плавающей запятой, которое может представить компьютер.</p>
<div class="sourceCode" id="cb1877"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1877-1" data-line-number="1">.Machine<span class="op">$</span>double.eps</a></code></pre></div>
<pre><code>## [1] 2.220446e-16</code></pre>
</div>
<div id="-20.3.5.3" class="section level4">
<h4><span class="header-section-number">4.5.3.7</span> Упражнение 20.3.5.3</h4>
<div class="question">
<p>A logical vector can take 3 possible values. How many possible values can an integer vector take? How many possible values can a double take? Use google to do some research.</p>
</div>
<p>Для целочисленных векторов, R использует a 32-битное представление. Это означает что вектор может быть представлен <span class="math inline">\(2^{32}\)</span> различными значениями с целыми числами. Одно из этих значений отложено для <code>NA_integer_</code>. Из справки для целых чисел.</p>
<blockquote>
<p>Note that current implementations of R use 32-bit integers for integer vectors,
so the range of representable integers is restricted to about +/-2*10^9: doubles
can hold much larger integers exactly.</p>
</blockquote>
<p>Диапазон значений целых чисел, которые R может представлять в целочисленном векторе, равен <span class="math inline">\(\pm 2^{31} - 1\)</span>,</p>
<div class="sourceCode" id="cb1879"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1879-1" data-line-number="1">.Machine<span class="op">$</span>integer.max</a></code></pre></div>
<pre><code>## [1] 2147483647</code></pre>
<p>Самое большое целое число это <span class="math inline">\(2^{31} - 1\)</span> меньше чем <span class="math inline">\(2^{32}\)</span> потому что 1 bit используется для записи (<span class="math inline">\(+\)</span>, <span class="math inline">\(-\)</span>) и одно значение используется для записи <code>NA_integer_</code>.</p>
<p>Если вы попытаетесь представить целое число больше этого значения, R вернет значения <code>NA</code>.</p>
<div class="sourceCode" id="cb1881"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1881-1" data-line-number="1">.Machine<span class="op">$</span>integer.max <span class="op">+</span><span class="st"> </span>1L</a></code></pre></div>
<pre><code>## Warning in .Machine$integer.max + 1L: целочисленное переполнение привело к
## созданию NA</code></pre>
<pre><code>## [1] NA</code></pre>
<p>Тем не менее, вы можете представить это значение (точно) с помощью числового вектора, затратив примерно в два раза больше памяти.</p>
<div class="sourceCode" id="cb1884"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1884-1" data-line-number="1"><span class="kw">as.numeric</span>(.Machine<span class="op">$</span>integer.max) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a></code></pre></div>
<pre><code>## [1] 2147483648</code></pre>
<p>Тоже самое верно для самого большого отрицательного числа</p>
<div class="sourceCode" id="cb1886"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1886-1" data-line-number="1"><span class="op">-</span>.Machine<span class="op">$</span>integer.max <span class="op">-</span><span class="st"> </span>1L</a></code></pre></div>
<pre><code>## Warning in -.Machine$integer.max - 1L: целочисленное переполнение привело к
## созданию NA</code></pre>
<pre><code>## [1] NA</code></pre>
<p>Для вещественных векторов R использует 64-битное представление. Это означает, что они могут держать
до <span class="math inline">\(2^{64}\)</span> значений точно. Однако некоторые из этих значений присваиваются специальным значениям.
такие как <code>-Inf</code>,<code>Inf</code>, <code>NA_real_</code> и<code>NaN</code>. Из справки для <code>double</code>:</p>
<blockquote>
<p>All R platforms are required to work with values conforming to the IEC 60559
(also known as IEEE 754) standard. This basically works with a precision of
53 bits, and represents to that precision a range of absolute values from
about 2e-308 to 2e+308. It also has special values <code>NaN</code> (many of them),
plus and minus infinity
and plus and minus zero (although R acts as if these are the same). There are
also denormal(ized) (or subnormal) numbers with absolute values above or below
the range given above but represented to less precision.</p>
</blockquote>
<p>Детали представления с плавающей точкой и арифметики сложны, выходят за рамки этого вопроса и лучше обсуждаются в ссылках, представленных ниже.
Вещественное число может представлять числа в диапазоне около $2 10 ^ {308} $, что
предоставляется в</p>
<div class="sourceCode" id="cb1889"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1889-1" data-line-number="1">.Machine<span class="op">$</span>double.xmax</a></code></pre></div>
<pre><code>## [1] 1.797693e+308</code></pre>
<p>Многие другие подробности реализации двойных векторов приведены в переменной <code>.Machine</code> (и ее документации).</p>
<div class="sourceCode" id="cb1891"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1891-1" data-line-number="1">.Machine<span class="op">$</span>double.base</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>количество бит, используемых для значимого (мантисса),</p>
<div class="sourceCode" id="cb1893"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1893-1" data-line-number="1">.Machine<span class="op">$</span>double.digits</a></code></pre></div>
<pre><code>## [1] 53</code></pre>
<p>количество битов, использованных в показателе степени,</p>
<div class="sourceCode" id="cb1895"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1895-1" data-line-number="1">.Machine<span class="op">$</span>double.exponent</a></code></pre></div>
<pre><code>## [1] 11</code></pre>
<p>и самые маленькие положительные и отрицательные числа не равные нулю,</p>
<div class="sourceCode" id="cb1897"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1897-1" data-line-number="1">.Machine<span class="op">$</span>double.eps</a></code></pre></div>
<pre><code>## [1] 2.220446e-16</code></pre>
<div class="sourceCode" id="cb1899"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1899-1" data-line-number="1">.Machine<span class="op">$</span>double.neg.eps</a></code></pre></div>
<pre><code>## [1] 1.110223e-16</code></pre>
<ul>
<li>Computerphile, “<a href="https://www.youtube.com/watch?v=PZRI1IfStY0">Floating Point Numbers</a>”</li>
<li><a href="https://en.wikipedia.org/wiki/IEEE_754" class="uri">https://en.wikipedia.org/wiki/IEEE_754</a></li>
<li><a href="https://en.wikipedia.org/wiki/Double-precision_floating-point_format" class="uri">https://en.wikipedia.org/wiki/Double-precision_floating-point_format</a></li>
<li>“<a href="https://floating-point-gui.de/formats/fp/">Floating Point Numbers: Why floating-point numbers are needed</a>”</li>
<li>Fabien Sanglard, “<a href="http://fabiensanglard.net/floating_point_visually_explained/">Floating Point Numbers: Visually Explained</a>”</li>
<li>James Howard, “<a href="https://jameshoward.us/2015/09/09/how-many-floating-point-numbers-are-there/">How Many Floating Point Numbers are There?</a>”</li>
<li>GeeksforGeeks, “<a href="https://www.geeksforgeeks.org/floating-point-representation-basics/">Floating Point Representation Basics</a>”</li>
<li>Chris Hecker, “<a href="http://chrishecker.com/images/f/fb/Gdmfp.pdf">Lets Go to the (Floating) Point</a>”, <em>Game Developer</em></li>
<li>Chua Hock-Chuan, <a href="http://www.ntu.edu.sg/home/ehchua/programming/java/datarepresentation.html">A Tutorial on Data Representation Integers, Floating-point Numbers, and Characters</a></li>
<li>John D. Cook, “<a href="https://www.johndcook.com/blog/2009/04/06/anatomy-of-a-floating-point-number/">Anatomy of a floating point number</a>”</li>
<li>John D. Cook, “<a href="https://www.codeproject.com/Articles/29637/Five-Tips-for-Floating-Point-Programming">Five Tips for Floating Point Programming</a>”</li>
</ul>
</div>
<div id="-20.3.5.4" class="section level4">
<h4><span class="header-section-number">4.5.3.8</span> Упражнение 20.3.5.4</h4>
<div class="question">
<p>Brainstorm at least four functions that allow you to convert a double to an integer. How do they differ? Be precise.</p>
</div>
<p>Для тестирования функций округления будем использовать тестовый набор:</p>
<div class="sourceCode" id="cb1901"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1901-1" data-line-number="1">test &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="dt">by =</span> <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb1901-2" data-line-number="2">test</a></code></pre></div>
<pre><code>##  [1] -3.0 -2.5 -2.0 -1.5 -1.0 -0.5  0.0  0.5  1.0  1.5  2.0  2.5  3.0</code></pre>
<p>Стандарт <a href="https://ru.wikipedia.org/wiki/IEEE_754-2008#Правила_округления">IEEE 754-2008</a> определяет пять правил округления. Первые два правила округляют к ближайшему значению, другие называются направленными округлениями.</p>
<ul>
<li><p>Округление к ближайшему (привязка к четному). Если два ближайших числа с плавающей точкой одинаково близки, то должно быть получено число с чётной самой младшей цифрой. Это вариант по умолчанию для двоичной плавающей запятой и рекомендованный вариант по умолчанию для десятичного числа.</p></li>
<li><p>Округление к ближайшему (привязка к бесконечности). Если два ближайших числа с плавающей точкой одинаково близки, то должно быть получено число с большим модулем.</p></li>
<li><p>Округление к 0 — направленное округление к нулю (также известное как усечение).</p></li>
<li><p>Округление к <span class="math inline">\(+\infty\)</span> — направленное округление к положительной бесконечности (также известное как округление вверх или потолок).</p></li>
<li><p>Округление к <span class="math inline">\(-\infty\)</span> — направленное округление к отрицательной бесконечности (также известное как округление вниз или пол).</p></li>
</ul>
<table>
<thead>
<tr class="header">
<th>methods</th>
<th>0.5</th>
<th>-0.5</th>
<th>1.5</th>
<th>-1.5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>к нулю</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>-1</td>
</tr>
<tr class="even">
<td>от нуля</td>
<td>1</td>
<td>-1</td>
<td>2</td>
<td>-2</td>
</tr>
<tr class="odd">
<td>к <span class="math inline">\(+\infty\)</span></td>
<td>1</td>
<td>0</td>
<td>2</td>
<td>-1</td>
</tr>
<tr class="even">
<td>к <span class="math inline">\(-\infty\)</span></td>
<td>0</td>
<td>-1</td>
<td>1</td>
<td>-2</td>
</tr>
<tr class="odd">
<td>чётное</td>
<td>0</td>
<td>0</td>
<td>2</td>
<td>-2</td>
</tr>
<tr class="even">
<td>нечётное</td>
<td>1</td>
<td>-1</td>
<td>1</td>
<td>-1</td>
</tr>
</tbody>
</table>
<p>Для округления, в R как и во многих других языках программирования используется стандарт IEEE. Это «округление до ближайшего, с привязкой к четному».</p>
<div class="sourceCode" id="cb1903"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1903-1" data-line-number="1">round2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">to_even =</span> <span class="ot">TRUE</span>) {</a>
<a class="sourceLine" id="cb1903-2" data-line-number="2">  q &lt;-<span class="st"> </span>x <span class="op">%/%</span><span class="st"> </span><span class="dv">1</span>    <span class="co"># Деление нацело</span></a>
<a class="sourceLine" id="cb1903-3" data-line-number="3">  r &lt;-<span class="st"> </span>x <span class="op">%%</span><span class="st"> </span><span class="dv">1</span>     <span class="co"># Остаток отделения</span></a>
<a class="sourceLine" id="cb1903-4" data-line-number="4">  q <span class="op">+</span><span class="st"> </span>(r <span class="op">&gt;=</span><span class="st"> </span><span class="fl">0.5</span>)  <span class="co"># Если r больше 0.5, то `TRUE` и соответственно прибавление единицы</span></a>
<a class="sourceLine" id="cb1903-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb1903-6" data-line-number="6">test</a></code></pre></div>
<pre><code>##  [1] -3.0 -2.5 -2.0 -1.5 -1.0 -0.5  0.0  0.5  1.0  1.5  2.0  2.5  3.0</code></pre>
<div class="sourceCode" id="cb1905"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1905-1" data-line-number="1"><span class="kw">round2</span>(test)</a></code></pre></div>
<pre><code>##  [1] -3 -2 -2 -1 -1  0  0  1  1  2  2  3  3</code></pre>
<div class="sourceCode" id="cb1907"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1907-1" data-line-number="1"><span class="kw">round2</span>(test, <span class="dt">to_even =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>##  [1] -3 -2 -2 -1 -1  0  0  1  1  2  2  3  3</code></pre>
</div>
<div id="-20.3.5.5" class="section level4">
<h4><span class="header-section-number">4.5.3.9</span> Упражнение 20.3.5.5</h4>
<div class="question">
<p>What functions from the readr package allow you to turn a string into logical, integer, and double vector?</p>
</div>
<ol style="list-style-type: decimal">
<li>Функция <code>parse_logical()</code> анализирует логические значения, которые могут отображаться как варианты <code>ИСТИНА/ЛОЖЬ</code> или <code>1/0</code>.</li>
</ol>
<div class="sourceCode" id="cb1909"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1909-1" data-line-number="1"><span class="kw">parse_logical</span>(<span class="kw">c</span>(<span class="st">&quot;TRUE&quot;</span>, <span class="st">&quot;FALSE&quot;</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>, <span class="st">&quot;true&quot;</span>, <span class="st">&quot;t&quot;</span>, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;false&quot;</span>, <span class="st">&quot;f&quot;</span>))</a></code></pre></div>
<pre><code>## [1]  TRUE FALSE  TRUE FALSE  TRUE  TRUE    NA FALSE FALSE</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Функция <code>parse_integer()</code> анализирует целочисленные значения</li>
</ol>
<div class="sourceCode" id="cb1911"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1911-1" data-line-number="1"><span class="kw">parse_integer</span>(<span class="kw">c</span>(<span class="st">&quot;1234&quot;</span>, <span class="st">&quot;000845&quot;</span>, <span class="st">&quot;NA&quot;</span>, <span class="st">&quot;345&quot;</span>))</a></code></pre></div>
<pre><code>## [1] 1234  845   NA  345</code></pre>
<p>Однако если в строке есть нечисловые символы, функция вызовет ошибку</p>
<div class="sourceCode" id="cb1913"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1913-1" data-line-number="1"><span class="kw">parse_integer</span>(<span class="kw">c</span>(<span class="st">&quot;1000&quot;</span>, <span class="st">&quot;$1,000&quot;</span>, <span class="st">&quot;10.00&quot;</span>))</a></code></pre></div>
<pre><code>## Warning: 2 parsing failures.
## row col               expected actual
##   2  -- an integer             $1,000
##   3  -- no trailing characters .00</code></pre>
<pre><code>## [1] 1000   NA   NA
## attr(,&quot;problems&quot;)
## # A tibble: 2 x 4
##     row   col expected               actual
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                  &lt;chr&gt; 
## 1     2    NA an integer             $1,000
## 2     3    NA no trailing characters .00</code></pre>
<p>В таких случаях выручит функция <code>parse_number</code></p>
<div class="sourceCode" id="cb1916"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1916-1" data-line-number="1"><span class="kw">parse_number</span>(<span class="kw">c</span>(<span class="st">&quot;1.0&quot;</span>, <span class="st">&quot;3.5&quot;</span>, <span class="st">&quot;$1,000.00&quot;</span>, <span class="st">&quot;NA&quot;</span>))</a></code></pre></div>
<pre><code>## [1]    1.0    3.5 1000.0     NA</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>И для анализа вещественных значений в векторе используется функция <code>parse_double()</code></li>
</ol>
<div class="sourceCode" id="cb1918"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1918-1" data-line-number="1"><span class="kw">parse_double</span>(<span class="kw">c</span>(<span class="st">&quot;1.23&quot;</span>, <span class="st">&quot;23.646&quot;</span>))</a></code></pre></div>
<pre><code>## [1]  1.230 23.646</code></pre>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">4.5.4</span> Использование атомарных векторов</h3>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.4.1</span> Приведение типов</h4>
<p>Существует два типа преобразования или <strong>приведения</strong> одного вектора в другой</p>
<ul>
<li><p>Явное приведение — при помощи функций <code>as.logical()</code>, <code>as.integer()</code>, <code>as.double()</code>, или <code>as.character()</code></p></li>
<li><p>Неявное преобразование происходит когда вектор используется в контексте, ожидающем вектор определённого типа. Например когда используется логический вектор с функцией суммирования.</p></li>
</ul>
<p><code>TRUE</code> конвертируется в <code>1</code> и соответственно <code>FALSE</code> в <code>0</code>. Это означает что суммирование логического вектора даёт количество истинных значений, а среднее логического вектора даёт долю таких значений.</p>
<div class="sourceCode" id="cb1920"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1920-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">20</span>, <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1920-2" data-line-number="2">x</a></code></pre></div>
<pre><code>##   [1]  5 19  3  1  6 16  7  3 10 16 20  5  7 14  9 18 13  4  7 15  7 10  7
##  [24]  2 13  5  8 16  1  8 13 19  1  3 10  8 10 10 18 11  4 17  5 18 14 12
##  [47] 19 11  1  7  4 17 11  3  3 17  5 13  4  2 12 15  9  4 12 13 12 16 15
##  [70]  4  9  8  2 19 12 15 18  3 12 20 17  3  2 10  6 11 12  2 16  7 17  8
##  [93] 10  3  1  2 20 11 16 10</code></pre>
<div class="sourceCode" id="cb1922"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1922-1" data-line-number="1">y &lt;-<span class="st"> </span>x <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1922-2" data-line-number="2"><span class="kw">sum</span>(y) </a></code></pre></div>
<pre><code>## [1] 45</code></pre>
<div class="sourceCode" id="cb1924"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1924-1" data-line-number="1"><span class="kw">mean</span>(y)</a></code></pre></div>
<pre><code>## [1] 0.45</code></pre>
<p>Бывает и обратное использование — от целочисленного типа к логическому.</p>
<div class="sourceCode" id="cb1926"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1926-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">length</span>(x)) {</a>
<a class="sourceLine" id="cb1926-2" data-line-number="2">  <span class="co"># do something</span></a>
<a class="sourceLine" id="cb1926-3" data-line-number="3">}</a></code></pre></div>
<pre><code>## NULL</code></pre>
<p>В данном случае 0 преобращуется в <code>FALSE</code>, а все остальные значения преобразуются в <code>TRUE</code>.
Такой подход усложняет чтение кода, лучше так не делать.
Вместо этого лучше в явном виде выразить намерения <code>length(x) &gt; 0</code></p>
<p>Важно понимать что происходит, когда вектор создаётся при помощи функции <code>с()</code>.
Верх одерживает наиболее сложный тип.</p>
<div class="sourceCode" id="cb1928"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1928-1" data-line-number="1"><span class="kw">typeof</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, 1L))</a></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb1930"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1930-1" data-line-number="1"><span class="kw">typeof</span>(<span class="kw">c</span>(1L, <span class="fl">1.5</span>))</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb1932"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1932-1" data-line-number="1"><span class="kw">typeof</span>(<span class="kw">c</span>(<span class="fl">1.5</span>, <span class="st">&quot;a&quot;</span>))</a></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>Атомарный вектор не может содержать смесь типов — тип это семейство вектора в целом, а не его отдельных элементов.</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">4.5.4.2</span> Функции проверки типов</h4>
<p>Для проверки типов вектора лучше использовать семейство векторов, которое приведено в таблице ниже</p>
<table>
<thead>
<tr class="header">
<th></th>
<th>lgl</th>
<th>int</th>
<th>dbl</th>
<th>chr</th>
<th>list</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>is_logical()</code></td>
<td>x</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>is_integer()</code></td>
<td></td>
<td>x</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>is_double()</code></td>
<td></td>
<td></td>
<td>x</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><code>is_numeric()</code></td>
<td></td>
<td>x</td>
<td>x</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><code>is_character()</code></td>
<td></td>
<td></td>
<td></td>
<td>x</td>
<td></td>
</tr>
<tr class="even">
<td><code>is_atomic()</code></td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td></td>
</tr>
<tr class="odd">
<td><code>is_list()</code></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>x</td>
</tr>
<tr class="even">
<td><code>is_vector()</code></td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
<td>x</td>
</tr>
</tbody>
</table>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">4.5.4.3</span> Скаляры и правила зацикливания</h4>
<p>Более короткий вектор повторяется, или зацикливается, для достижения той же длины, что и более длинный.</p>
<p>В R основные математические операции работают с векторами.
Это означает, что при формировании простых математических вычислений никогда не придётся итерировать по элементам.</p>
<div class="sourceCode" id="cb1934"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1934-1" data-line-number="1"><span class="kw">sample</span>(<span class="dv">10</span>) <span class="op">+</span><span class="st"> </span><span class="dv">100</span></a></code></pre></div>
<pre><code>##  [1] 101 109 106 104 102 108 107 110 103 105</code></pre>
<div class="sourceCode" id="cb1936"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1936-1" data-line-number="1"><span class="kw">runif</span>(<span class="dv">10</span>) <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.5</span></a></code></pre></div>
<pre><code>##  [1] FALSE  TRUE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE  TRUE</code></pre>
<p>В случае сложения векторов разной длинны, R расширяет, или как говорят <strong>зацикливает</strong> — многократно повторяет короткий вектор для достижения длинны более длинного.</p>
<div class="sourceCode" id="cb1938"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1938-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span></a></code></pre></div>
<pre><code>##  [1]  2  4  4  6  6  8  8 10 10 12</code></pre>
<p>Этот процесс будет происходить без вывода дополнительных сообщений, за исключением случаев, когда короткий вектор не кратен длинному.</p>
<div class="sourceCode" id="cb1940"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1940-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="dv">10</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a></code></pre></div>
<pre><code>## Warning in 1:10 + 1:3: длина большего объекта не является произведением
## длины меньшего объекта</code></pre>
<pre><code>##  [1]  2  4  6  5  7  9  8 10 12 11</code></pre>
<p>НА самом деле это может привести к ошибке, поэтому в <code>tidyverse</code> для того чтобы зациклить, нужно указать это в явном виде</p>
<div class="sourceCode" id="cb1943"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1943-1" data-line-number="1"><span class="co"># tibble(x = 1:4, y = 1:2)</span></a>
<a class="sourceLine" id="cb1943-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1943-3" data-line-number="3"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">y =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dv">2</span>))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     2
## 3     3     1
## 4     4     2</code></pre>
<div class="sourceCode" id="cb1945"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1945-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">y =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">each =</span> <span class="dv">2</span>))</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     1     1
## 2     2     1
## 3     3     2
## 4     4     2</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.4.4</span> Именование векторов</h4>
<p>Векторам можно присваивать имена.</p>
<p>Можно в процессе создания вектора</p>
<div class="sourceCode" id="cb1947"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1947-1" data-line-number="1"><span class="kw">c</span>(<span class="dt">x =</span> <span class="dv">1</span>, <span class="dt">y =</span> <span class="dv">2</span>, <span class="dt">z =</span> <span class="dv">4</span>)</a></code></pre></div>
<pre><code>## x y z 
## 1 2 4</code></pre>
<p>Можно постфактум при помощи <code>purrr::set_names()</code>:</p>
<div class="sourceCode" id="cb1949"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1949-1" data-line-number="1"><span class="kw">set_names</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>))</a></code></pre></div>
<pre><code>## a b c 
## 1 2 3</code></pre>
<p>Именованные векторы удобнее всего использовать для извлечения элементов векторов</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.4.5</span> Извлечение элементов</h4>
<p>До сих пор, для фильтрации строк мы использовали функцию <code>dplyr::filter()</code>.
Она работает только с tibble-фреймами, поэтому для векторов необходимо использовать новый инструмент.
Этим инструментом является <code>[]</code>, которая вызывается примерно так <code>x[a]</code>.
Для управления извлечением жлементов можно использовать одну из четырех структур</p>
<ul>
<li>Числовой вектор, содержащий только целые числа. Целые числа должны быть либо все положительны, либо все отрицательны, либо нулём.
Извлекаются элементы вектора, соответствующие указанным позициям</li>
</ul>
<div class="sourceCode" id="cb1951"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1951-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;one&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;four&quot;</span>, <span class="st">&quot;five&quot;</span>)</a>
<a class="sourceLine" id="cb1951-2" data-line-number="2">x[<span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>)]</a></code></pre></div>
<pre><code>## [1] &quot;three&quot; &quot;two&quot;   &quot;five&quot;</code></pre>
<p>В действительности, повторяя некоторые позиции, можно получить выходной вектор большей длины, чем входной.</p>
<div class="sourceCode" id="cb1953"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1953-1" data-line-number="1">x[<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">2</span>)]</a></code></pre></div>
<pre><code>## [1] &quot;one&quot;  &quot;one&quot;  &quot;five&quot; &quot;five&quot; &quot;five&quot; &quot;two&quot;</code></pre>
<p>Отрицательные значения отбрасывают соответствующие элементы</p>
<div class="sourceCode" id="cb1955"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1955-1" data-line-number="1">x[<span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-3</span>, <span class="dv">-5</span>)]</a></code></pre></div>
<pre><code>## [1] &quot;two&quot;  &quot;four&quot;</code></pre>
<p>Смешивать плюс с минусом не можно</p>
<div class="sourceCode" id="cb1957"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1957-1" data-line-number="1"><span class="co"># x[c(-1, 1)]</span></a></code></pre></div>
<p>Только нули могут смешиваться с отрицательльными значениями — но нуль ничего не возвращает</p>
<div class="sourceCode" id="cb1958"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1958-1" data-line-number="1">x[<span class="dv">0</span>]</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<ul>
<li>При извлечениии элементов с помощью логического вектора сохраняются все значения, соответствующие <code>TRUE</code></li>
</ul>
<div class="sourceCode" id="cb1960"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1960-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="ot">NA</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">1</span>, <span class="ot">NA</span>)</a>
<a class="sourceLine" id="cb1960-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1960-3" data-line-number="3"><span class="co"># Все кроме отсутствующих</span></a>
<a class="sourceLine" id="cb1960-4" data-line-number="4">x[<span class="op">!</span><span class="kw">is.na</span>(x)]</a></code></pre></div>
<pre><code>## [1] 10  3  5  8  1</code></pre>
<div class="sourceCode" id="cb1962"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1962-1" data-line-number="1"><span class="co"># Все четные или отсутствующие</span></a>
<a class="sourceLine" id="cb1962-2" data-line-number="2">x[x <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]</a></code></pre></div>
<pre><code>## [1] 10 NA  8 NA</code></pre>
<ul>
<li>Элементы именнованного вектора можно извлекать при помощи символьного вектора</li>
</ul>
<div class="sourceCode" id="cb1964"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1964-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">abc =</span> <span class="dv">1</span>, <span class="dt">def =</span> <span class="dv">2</span>, <span class="dt">xyz =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1964-2" data-line-number="2">x[<span class="kw">c</span>(<span class="st">&quot;xyz&quot;</span>, <span class="st">&quot;def&quot;</span>)]</a></code></pre></div>
<pre><code>## xyz def 
##   5   2</code></pre>
<p>Как и в случае целых чисел, символьный вектор так же позволяет дублировать отдельные элементы</p>
<div class="sourceCode" id="cb1966"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1966-1" data-line-number="1">x[<span class="kw">c</span>(<span class="st">&quot;xyz&quot;</span>, <span class="st">&quot;def&quot;</span>, <span class="st">&quot;xyz&quot;</span>)]</a></code></pre></div>
<pre><code>## xyz def xyz 
##   5   2   5</code></pre>
<ul>
<li>Простейшей из структур, управля.щих извлечением элементов векторов является пустая структура <code>x[]</code>, которая возвращает целый вектор <code>x</code>.
В случае векторов она бесполезна, но ее можно с успехом использовать для извлечения элементов матриц (и других высокоразмерных структур), поскольку например, с ее помощью можно выбрать все строки или все столбцы, оставляя соответствующий индекс пустым.</li>
</ul>
<p>К примеру, если <code>x</code> — двумерная матрица, то <code>x[1, ]</code> выбирает все столбцы первой строки, а <code>x[, -1]</code> все строки за исключением первой.</p>
<p>ПОдробнее об этом нужно будет обязательно прочитать в <a href="http://adv-r.had.co.nz">Advanced R</a></p>
<p>Существует важное видоизменение функции <code>[]</code> это <code>[[]]</code> Эта функция возвращает лишь один элемент и всегда отбрасывает имена. Она отлично подходит для тех случаев, когда мы хотим ясно указать что извлекаем одиночный элемент, как например в цикле <code>for</code>.
Различие моежду <code>[]</code> и <code>[[]]</code> играет очень важную роль в списках. Мы их разберём после упражнений</p>
<div class="figure">
<img src="img/elements.PNG" alt="Шпаргалка-напоминание" />
<p class="caption">Шпаргалка-напоминание</p>
</div>
</div>
<div id="-20.4.6.1" class="section level4">
<h4><span class="header-section-number">4.5.4.6</span> Упражнение 20.4.6.1</h4>
<div class="question">
<p>What does <code>mean(is.na(x))</code> tell you about a vector <code>x</code>?
What about <code>sum(!is.finite(x))</code>?</p>
</div>
<p>Функция <code>mean(is.na(x))</code> показывает долю пропущенных значений в векторе. А функция <code>sum(!is.finite(x))</code> показывает количество не бесконечных значений</p>
<div class="sourceCode" id="cb1968"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1968-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">abc =</span> <span class="ot">NA</span>, <span class="dt">def =</span> <span class="ot">Inf</span>, <span class="dt">xyz =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb1968-2" data-line-number="2"><span class="kw">mean</span>(<span class="kw">is.na</span>(y))</a></code></pre></div>
<pre><code>## [1] 0.3333333</code></pre>
<div class="sourceCode" id="cb1970"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1970-1" data-line-number="1"><span class="kw">sum</span>(<span class="op">!</span><span class="kw">is.finite</span>(y))</a></code></pre></div>
<pre><code>## [1] 2</code></pre>
</div>
<div id="-20.4.6.2" class="section level4">
<h4><span class="header-section-number">4.5.4.7</span> Упражнение 20.4.6.2</h4>
<div class="question">
<p>Carefully read the documentation of <code>is.vector()</code>.
What does it actually test for?
Why does <code>is.atomic()</code> not agree with the definition of atomic vectors above?</p>
</div>
<p>Функция <code>is.vector()</code> только проверяет, не имеет ли объект каких-нибудь атрибутов, кроме имен.
Таким образом, список является вектором:</p>
<div class="sourceCode" id="cb1972"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1972-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1972-2" data-line-number="2"><span class="kw">attr</span>(x, <span class="st">&quot;woops&quot;</span>) &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb1972-3" data-line-number="3"><span class="kw">is.vector</span>(x)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Идея заключается в том, что объектно-ориентированные классы будут включать атрибуты, в том числе, но не ограничиваясь этим, «класс».</p>
<p>Функция <code>is.atomic()</code> явно проверяет, является ли объект одним из атомарных типов («логический», «целочисленный», «числовой», «сложный», «символьный» и «необработанный») или <code>NULL</code>.</p>
<div class="sourceCode" id="cb1974"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1974-1" data-line-number="1"><span class="kw">is.atomic</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb1976"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1976-1" data-line-number="1"><span class="kw">is.atomic</span>(<span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>))</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Функция <code>is.atomic()</code> будет считать объекты атомарными, даже если они имеют дополнительные атрибуты.</p>
<div class="sourceCode" id="cb1978"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1978-1" data-line-number="1"><span class="kw">is.atomic</span>(x)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
</div>
<div id="-20.4.6.3" class="section level4">
<h4><span class="header-section-number">4.5.4.8</span> Упражнение 20.4.6.3</h4>
<div class="question">
<p>Compare and contrast <code>setNames()</code> with <code>purrr::set_names()</code>.</p>
</div>
<p>Функция <code>setNames()</code> принимает два аргумента: вектор для именования и вектор имен для применения к своим элементам.</p>
<div class="sourceCode" id="cb1980"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1980-1" data-line-number="1"><span class="kw">setNames</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>))</a></code></pre></div>
<pre><code>## a b c d 
## 1 2 3 4</code></pre>
<p>Если использовать аргумент <code>nm</code> можно использовать значения вектора в качестве имени.</p>
<div class="sourceCode" id="cb1982"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1982-1" data-line-number="1"><span class="kw">setNames</span>(<span class="dt">nm =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>))</a></code></pre></div>
<pre><code>##   a   b   c   d 
## &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<p>Функция <code>set_names()</code> имеет больше способов установить имена, чем <code>setNames()</code>.
Имена могут быть указаны так же, как <code>setNames()</code>.</p>
<div class="sourceCode" id="cb1984"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1984-1" data-line-number="1">purrr<span class="op">::</span><span class="kw">set_names</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>))</a></code></pre></div>
<pre><code>## a b c d 
## 1 2 3 4</code></pre>
<p>Имена могут так же быть присвоены как безымянные аргументы.</p>
<div class="sourceCode" id="cb1986"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1986-1" data-line-number="1">purrr<span class="op">::</span><span class="kw">set_names</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>)</a></code></pre></div>
<pre><code>## a b c d 
## 1 2 3 4</code></pre>
<p>Функция <code>set_names()</code> будет называть объект самим собой, если не указан аргумент <code>nm</code> (противоположно поведению <code>setNames()</code>).</p>
<div class="sourceCode" id="cb1988"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1988-1" data-line-number="1">purrr<span class="op">::</span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>))</a></code></pre></div>
<pre><code>##   a   b   c   d 
## &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<p>Самое большое различие между <code>set_names()</code> и <code>setNames()</code> состоит в том, что <code>set_names()</code> позволяет использовать функцию или формулу для преобразования существующих имен.</p>
<div class="sourceCode" id="cb1990"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1990-1" data-line-number="1">purrr<span class="op">::</span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>), toupper)</a></code></pre></div>
<pre><code>## A B C 
## 1 2 3</code></pre>
<div class="sourceCode" id="cb1992"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1992-1" data-line-number="1">purrr<span class="op">::</span><span class="kw">set_names</span>(<span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>), <span class="op">~</span><span class="st"> </span><span class="kw">toupper</span>(.))</a></code></pre></div>
<pre><code>## A B C 
## 1 2 3</code></pre>
<p>Функция <code>set_names()</code> также проверяет, что длина аргумента <code>names</code> имеет ту же длину, что и именуемый вектор, и выдает ошибку, если это не так.</p>
<div class="sourceCode" id="cb1994"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1994-1" data-line-number="1"><span class="co"># purrr::set_names(1:4, c(&quot;a&quot;, &quot;b&quot;))</span></a></code></pre></div>
<p>Функция <code>setNames()</code> позволит именам быть короче, чем именуемый вектор, и установит отсутствующие имена в <code>NA</code>.</p>
<div class="sourceCode" id="cb1995"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1995-1" data-line-number="1"><span class="kw">setNames</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>))</a></code></pre></div>
<pre><code>##    a    b &lt;NA&gt; &lt;NA&gt; 
##    1    2    3    4</code></pre>
</div>
<div id="-20.4.6.4" class="section level4">
<h4><span class="header-section-number">4.5.4.9</span> Упражнение 20.4.6.4</h4>
<div class="question">
<p>Create functions that take a vector as input and returns:</p>
<ol style="list-style-type: decimal">
<li><p>The last value. Should you use <code>[</code> or <code>[[</code>?</p></li>
<li><p>The elements at even numbered positions.</p></li>
<li><p>Every element except the last value.</p></li>
<li>Only even numbers (and no missing values).</li>
</ol>
</div>
<ol style="list-style-type: decimal">
<li>Возвращаем последнее значение в векторе. Это просто — достаточно использовать конструкцию <code>[]</code></li>
</ol>
<div class="sourceCode" id="cb1997"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1997-1" data-line-number="1">last_value &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1997-2" data-line-number="2">  x[<span class="kw">length</span>(x)]</a>
<a class="sourceLine" id="cb1997-3" data-line-number="3">}</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Элементы на чётных позициях</li>
</ol>
<div class="sourceCode" id="cb1998"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1998-1" data-line-number="1">even_indices &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1998-2" data-line-number="2">  <span class="cf">if</span> (<span class="kw">length</span>(x)) {</a>
<a class="sourceLine" id="cb1998-3" data-line-number="3">    x[<span class="kw">seq_along</span>(x) <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]</a>
<a class="sourceLine" id="cb1998-4" data-line-number="4">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb1998-5" data-line-number="5">    x</a>
<a class="sourceLine" id="cb1998-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb1998-7" data-line-number="7">}</a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Все элементы, кроме последнего значения</li>
</ol>
<div class="sourceCode" id="cb1999"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1999-1" data-line-number="1">without_last_value &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb1999-2" data-line-number="2">  x[<span class="op">-</span><span class="kw">length</span>(x)]</a>
<a class="sourceLine" id="cb1999-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb1999-4" data-line-number="4"><span class="kw">without_last_value</span>(x)</a></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6 7 8 9</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Только чётные числа</li>
</ol>
<div class="sourceCode" id="cb2001"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2001-1" data-line-number="1">even_numbers &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb2001-2" data-line-number="2">  x[x <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>]</a>
<a class="sourceLine" id="cb2001-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb2001-4" data-line-number="4"><span class="kw">even_numbers</span>(x)</a></code></pre></div>
<pre><code>## [1]  2  4  6  8 10</code></pre>
</div>
<div id="-20.4.6.5" class="section level4">
<h4><span class="header-section-number">4.5.4.10</span> Упражнение 20.4.6.5</h4>
<div class="question">
<p>Why is <code>x[-which(x &gt; 0)]</code> not the same as <code>x[x &lt;= 0]</code>?</p>
</div>
<div class="sourceCode" id="cb2003"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2003-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">5</span><span class="op">:</span><span class="dv">5</span>, <span class="ot">NA</span>, <span class="ot">Inf</span>, <span class="op">-</span><span class="ot">Inf</span>, <span class="ot">NaN</span>)</a>
<a class="sourceLine" id="cb2003-2" data-line-number="2">x[<span class="op">-</span><span class="kw">which</span>(x <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)]</a></code></pre></div>
<pre><code>## [1]   -5   -4   -3   -2   -1    0   NA -Inf  NaN</code></pre>
<div class="sourceCode" id="cb2005"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2005-1" data-line-number="1">x[x <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>]</a></code></pre></div>
<pre><code>## [1]   -5   -4   -3   -2   -1    0   NA -Inf   NA</code></pre>
<p>Как нетрудно заметить, в случае нечсилого значения выражение <code>x[x &lt;= 0]</code> возвращает <code>NA</code>.</p>
<p>Любая реляционная операция, которая включает в себя <code>NA</code>, возвращает <code>NA</code>. <code>NA &lt;= 0</code>? Мы не знаем, потому что это зависит от неизвестного значения <code>NA</code>, поэтому ответ - <code>NA</code>. Этот же аргумент применим к <code>NaN</code>. Спрашивать, <code>NaN &lt;= 0</code> не имеет никакого смысла, потому что нельзя сравнить число с «Не числом».</p>
<p>Это упражнение напоминаниеи, что всегда нужно проверять ваш код.
Несмотря на то, что эти два выражения выглядят эквивалентными, на практике они разные.
И когда вы делаете тестовый код, учитывайте как он работает с типичными значениями, так и со специальными значениями и крайними случаями, такими как вектор со значениями <code>NA</code> или <code>NaN</code> или <code>Inf</code>, или пустой вектор.
Руководствуемся правилом — если имеет место неожиданное поведение, вероятнее всего, оно произойдет.</p>
</div>
<div id="-20.4.6.6" class="section level4">
<h4><span class="header-section-number">4.5.4.11</span> Упражнение 20.4.6.6</h4>
<div class="question">
<p>What happens when you subset with a positive integer that’s bigger than the length of the vector?
What happens when you subset with a name that doesn’t exist?</p>
</div>
<p>Давайте проверим</p>
<div class="sourceCode" id="cb2007"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2007-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">10</span>, <span class="dt">b =</span> <span class="dv">20</span>)</a></code></pre></div>
<div class="sourceCode" id="cb2008"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2008-1" data-line-number="1">x[<span class="dv">7</span>]</a></code></pre></div>
<pre><code>## &lt;NA&gt; 
##   NA</code></pre>
<div class="sourceCode" id="cb2010"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2010-1" data-line-number="1">x[<span class="dv">4</span><span class="op">:</span><span class="dv">6</span>]</a></code></pre></div>
<pre><code>## &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; 
##   NA   NA   NA</code></pre>
<div class="sourceCode" id="cb2012"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2012-1" data-line-number="1">x[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a></code></pre></div>
<pre><code>##    a    b &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; 
##   10   20   NA   NA   NA</code></pre>
<div class="sourceCode" id="cb2014"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2014-1" data-line-number="1">x[<span class="st">&quot;c&quot;</span>]</a></code></pre></div>
<pre><code>## &lt;NA&gt; 
##   NA</code></pre>
<div class="sourceCode" id="cb2016"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2016-1" data-line-number="1">x[<span class="kw">c</span>(<span class="st">&quot;c&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;e&quot;</span>)]</a></code></pre></div>
<pre><code>## &lt;NA&gt; &lt;NA&gt; &lt;NA&gt; 
##   NA   NA   NA</code></pre>
<div class="sourceCode" id="cb2018"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2018-1" data-line-number="1">x[<span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;d&quot;</span>, <span class="st">&quot;b&quot;</span>)]</a></code></pre></div>
<pre><code>##    a &lt;NA&gt;    b 
##   10   NA   20</code></pre>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">4.5.5</span> Рекурсивные векторы (списки)</h3>
<p>Списки, следуюший по сложности тип, после атомарных векторов.</p>
<p>Списки могут содержать другие списки.</p>
<p>Списки можно создавать с помощью <code>list()</code></p>
<div class="sourceCode" id="cb2020"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2020-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb2020-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 4</code></pre>
<p>Весьма удобным инструментом для работы со списками, является функция <code>str()</code>, которая фокусируется на структуре, а не на содержимом</p>
<div class="sourceCode" id="cb2022"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2022-1" data-line-number="1"><span class="kw">str</span>(x)</a></code></pre></div>
<pre><code>## List of 4
##  $ : num 1
##  $ : num 2
##  $ : num 3
##  $ : num 4</code></pre>
<div class="sourceCode" id="cb2024"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2024-1" data-line-number="1">x_named &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2024-2" data-line-number="2"><span class="kw">str</span>(x_named)</a></code></pre></div>
<pre><code>## List of 3
##  $ a: num 1
##  $ b: num 2
##  $ c: num 3</code></pre>
<p>Списики могут содержать смесь объектов.</p>
<div class="sourceCode" id="cb2026"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2026-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">a =</span> <span class="st">&quot;c,&quot;</span>, <span class="dt">b =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2026-2" data-line-number="2"><span class="kw">str</span>(y)</a></code></pre></div>
<pre><code>## List of 3
##  $ a: chr &quot;c,&quot;
##  $ b: num 2
##  $ c: logi TRUE</code></pre>
<p>Как говорилось выше — списки могут содержать другие списки</p>
<div class="sourceCode" id="cb2028"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2028-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">list</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb2028-2" data-line-number="2"><span class="kw">str</span>(z)</a></code></pre></div>
<pre><code>## List of 2
##  $ :List of 2
##   ..$ : num 1
##   ..$ : num 2
##  $ :List of 2
##   ..$ : num 3
##   ..$ : num 4</code></pre>
<div class="sourceCode" id="cb2030"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2030-1" data-line-number="1">zz &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="kw">list</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb2030-2" data-line-number="2"><span class="kw">str</span>(zz)</a></code></pre></div>
<pre><code>## List of 3
##  $ : num 1
##  $ : num 2
##  $ :List of 2
##   ..$ : num 3
##   ..$ : num 4</code></pre>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.5.1</span> Визуализация списков</h4>
<div class="sourceCode" id="cb2032"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2032-1" data-line-number="1">x1 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb2032-2" data-line-number="2">x2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">list</span>(<span class="dv">3</span>, <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb2032-3" data-line-number="3">x3 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="kw">list</span>(<span class="dv">2</span>, <span class="kw">list</span>(<span class="dv">3</span>)))</a></code></pre></div>
<p>Списки, созданные выше можно визуализировать следующим образом</p>
<div class="figure">
<img src="img/list.png" alt="Демонстрация вложенности списков" />
<p class="caption">Демонстрация вложенности списков</p>
</div>
<p>Это представление интерпритируется в соответствии со следующими правилами</p>
<ul>
<li><p>Спискам соответствуют прямоугольники со скругленными углами. В прямоугольниках соответствующим атомарным векторам, углы не скруглены</p></li>
<li><p>Дочерние элементы отображаются в родительских и имеют несколько более тёмный фон, подчеркивающий структурную иерархию.</p></li>
<li><p>Ориентация дочерних элементов (то есть строк и столбцов) не имеет значения, поэтому мы выбираем её такой, чтобы либо сэкономить место на рисунке, либо наилучшим образом проиллюстрировать важное свойство.</p></li>
</ul>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.5.2</span> Извлечение списков</h4>
<p>Есть три способа извлечения элементов списка, которые мы проиллюстрируем на примере списка <code>a</code></p>
<div class="sourceCode" id="cb2033"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2033-1" data-line-number="1">a &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">f =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">e =</span> <span class="st">&quot;a string&quot;</span>, <span class="dt">c =</span> pi, <span class="dt">d =</span> <span class="kw">list</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">-5</span>))</a></code></pre></div>
<ol style="list-style-type: decimal">
<li><code>[]</code> — извлекает подчинённый список. Результат всегда является списком.</li>
</ol>
<div class="sourceCode" id="cb2034"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2034-1" data-line-number="1"><span class="kw">str</span>(a[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>])</a></code></pre></div>
<pre><code>## List of 2
##  $ f: int [1:3] 1 2 3
##  $ e: chr &quot;a string&quot;</code></pre>
<div class="sourceCode" id="cb2036"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2036-1" data-line-number="1"><span class="kw">str</span>(a[<span class="dv">4</span>])</a></code></pre></div>
<pre><code>## List of 1
##  $ d:List of 2
##   ..$ : num -1
##   ..$ : num -5</code></pre>
<p>Как и в случае векторов, извлечение элементов списка может осуществляться с помощью логического, целочисленного или символьного вектора.</p>
<ol start="2" style="list-style-type: decimal">
<li><code>[[]]</code> — извлекает одиночный компонент списка. Эта функция удаляет один уровень иерархии списка.</li>
</ol>
<div class="sourceCode" id="cb2038"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2038-1" data-line-number="1"><span class="kw">str</span>(a[[<span class="dv">1</span>]])</a></code></pre></div>
<pre><code>##  int [1:3] 1 2 3</code></pre>
<div class="sourceCode" id="cb2040"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2040-1" data-line-number="1"><span class="kw">str</span>(a[[<span class="dv">4</span>]])</a></code></pre></div>
<pre><code>## List of 2
##  $ : num -1
##  $ : num -5</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><code>$</code> — сокращение для извлечения именованных элементов списка. Работает аналогично функции <code>[[]]</code>, но не требует использования кавычек</li>
</ol>
<div class="sourceCode" id="cb2042"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2042-1" data-line-number="1">a<span class="op">$</span>f</a></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<div class="sourceCode" id="cb2044"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2044-1" data-line-number="1">a[[<span class="st">&quot;f&quot;</span>]]</a></code></pre></div>
<pre><code>## [1] 1 2 3</code></pre>
<p>В случае списков различие между функциями <code>[[]]</code> и <code>[]</code> играет важную роль.
ПОскольку <code>[[]]</code> проникает в список, тогда как <code>[]</code> возвращает новый список меньшего размера.
Предыдущий код и его вывод показаны на рисунке ниже</p>
<div class="figure">
<img src="img/exercise_of_list.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.5.5.3</span> Список специй</h4>
<p>Список <code>x</code> — перечница</p>
<div class="figure">
<img src="img/pepper1.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p><code>x[1]</code> — это перечница содержащая один пакетик перца. Элемент <code>x[2]</code> выглядит точно так же, но будет содержать второй пакет. Выражение <code>x[1:2]</code> будет представлять перечницу содержащую два пакета.</p>
<div class="figure">
<img src="img/pepper2.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p><code>x[[1]]</code> — это</p>
<div class="figure">
<img src="img/pepper3.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>Если нужно получить содержимое пакета, то мне нужен элемент <code>x[[1]][[1]]</code></p>
<div class="figure">
<img src="img/pepper4.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
</div>
<div id="-20.5.4.1" class="section level4">
<h4><span class="header-section-number">4.5.5.4</span> Упражнение 20.5.4.1</h4>
<div class="question">
<p>Draw the following lists as nested sets:</p>
<ol style="list-style-type: decimal">
<li><p><code>list(a, b, list(c, d), list(e, f))</code></p></li>
<li><code>list(list(list(list(list(list(a))))))</code></li>
</ol>
</div>
<ol style="list-style-type: decimal">
<li>Ответ</li>
</ol>
<div class="figure">
<img src="img/exercise_list.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<ol style="list-style-type: decimal">
<li>Ответ</li>
</ol>
<div class="figure">
<img src="img/recursion_list.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
</div>
<div id="-20.5.4.2" class="section level4">
<h4><span class="header-section-number">4.5.5.5</span> Упражнение 20.5.4.2</h4>
<div class="question">
<p>What happens if you subset a tibble as if you’re subsetting a list?
What are the key differences between a list and a tibble?</p>
</div>
<p>Подмножество <code>tibble</code> работает так же, как список; фрейм данных можно рассматривать как список столбцов. Основное различие между списком и таблицей заключается в том, что все элементы (столбцы) таблицы должны иметь одинаковую длину (количество строк).
Списки в свою очередь могут иметь векторы различной длины в качестве элементов.</p>
</div>
</div>
<div class="section level3">
<h3><span class="header-section-number">4.5.6</span> Атрибуты</h3>
<p>Любой вектор может содержать произвольные дополнительные <strong>метаданные</strong>, которые хранятся в атрибутах</p>
<div class="sourceCode" id="cb2046"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2046-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb2046-2" data-line-number="2"><span class="kw">attr</span>(x, <span class="st">&quot;greeting&quot;</span>)</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb2048"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2048-1" data-line-number="1"><span class="kw">attr</span>(x, <span class="st">&quot;greeting&quot;</span>) &lt;-<span class="st"> &quot;Hi!&quot;</span></a>
<a class="sourceLine" id="cb2048-2" data-line-number="2"><span class="kw">attr</span>(x, <span class="st">&quot;farewell&quot;</span>) &lt;-<span class="st"> &quot;Bye!&quot;</span></a>
<a class="sourceLine" id="cb2048-3" data-line-number="3"><span class="kw">attributes</span>(x)</a></code></pre></div>
<pre><code>## $greeting
## [1] &quot;Hi!&quot;
## 
## $farewell
## [1] &quot;Bye!&quot;</code></pre>
<p>При помощи функции <code>attr()</code> можно устанавоивать или получать значения отдельных атрибутов.
<code>attributes()</code> помогает просматривать все сразу.</p>
<p>СУществует три важных атрибута, которые используются для реализации фундаментальных понятий R</p>
<ul>
<li><p><em>имена</em> используются для именования элементов вектора</p></li>
<li><p><em>размерности</em> обеспечивают поведение вектора как матрицы или массива</p></li>
<li><p><em>классы</em> используются для реализации объектно-ориентированной системы S3</p></li>
</ul>
<p>Классы управляют работой обобщённых функций.
Обобщенные функции служат ключом к пониманию объектно-ориентированного программирования в R.
Обобщенные функции обеспечивают различное поведение для различных классов входных данных.
Обобщённые функции подробно разобраны в книге Advanced R <a href="http://adv-r.had.co.nz/OO-essentials.html#s3" class="uri">http://adv-r.had.co.nz/OO-essentials.html#s3</a></p>
<p>Обобщённая функция выглядит так</p>
<div class="sourceCode" id="cb2050"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2050-1" data-line-number="1">as.Date</a></code></pre></div>
<pre><code>## function (x, ...) 
## UseMethod(&quot;as.Date&quot;)
## &lt;bytecode: 0x7fbe9d80a858&gt;
## &lt;environment: namespace:base&gt;</code></pre>
<p><code>UseMethod</code> означает что это обобщённая функция и что она будет использовать определённый метод, т.е. функцию в зависимости от класса первоначального аргумента.</p>
<p>Все методы являются функциями, но не все функции являются методами.
Все террористы мусульмане, но не все мусульмане террористы.
Подмножество во множестве.</p>
<p>Список всех методов обобщённой функции можно получить с помощью функции <code>methods()</code></p>
<div class="sourceCode" id="cb2052"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2052-1" data-line-number="1"><span class="kw">methods</span>(<span class="st">&quot;as.Date&quot;</span>)</a></code></pre></div>
<pre><code>## [1] as.Date.character as.Date.default   as.Date.factor    as.Date.numeric  
## [5] as.Date.POSIXct   as.Date.POSIXlt  
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>Если <code>x</code> — символьный вектор, то <code>as.Date</code> вызовет функцию <code>as.Date.character()</code>, а если это фактор то вызовет <code>as.Date.factor()</code></p>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">4.5.7</span> Расширенные векторы</h3>
<p>Атомарные векторы и списки — это строительные кирпичи, для факторов и дат. Вот их особенности</p>
<div id="-1" class="section level4">
<h4><span class="header-section-number">4.5.7.1</span> Факторы</h4>
<p>Факторы представляют категориальные или номинативные переменные. То есть факторы могут принимать ряд фиксированных значений возможных значений.
Факторы создаются поверх целых чисел и имеют атрибут <code>levels</code></p>
<div class="sourceCode" id="cb2054"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2054-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">factor</span>(<span class="kw">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;cd&quot;</span>, <span class="st">&quot;ab&quot;</span>), <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;ab&quot;</span>, <span class="st">&quot;cd&quot;</span>, <span class="st">&quot;ef&quot;</span>))</a>
<a class="sourceLine" id="cb2054-2" data-line-number="2"><span class="kw">typeof</span>(x)</a></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<div class="sourceCode" id="cb2056"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2056-1" data-line-number="1"><span class="kw">attributes</span>(x)</a></code></pre></div>
<pre><code>## $levels
## [1] &quot;ab&quot; &quot;cd&quot; &quot;ef&quot;
## 
## $class
## [1] &quot;factor&quot;</code></pre>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">4.5.7.2</span> Дата и дата-время</h4>
<p>В R дата — это числовые векторы, которы представляют количество дней истекших с 1 января 1970 года.</p>
<div class="sourceCode" id="cb2058"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2058-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">as.Date</span>(<span class="st">&quot;1971-01-01&quot;</span>)</a>
<a class="sourceLine" id="cb2058-2" data-line-number="2"><span class="kw">unclass</span>(x)</a></code></pre></div>
<pre><code>## [1] 365</code></pre>
<div class="sourceCode" id="cb2060"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2060-1" data-line-number="1"><span class="kw">typeof</span>(x)</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb2062"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2062-1" data-line-number="1"><span class="kw">attributes</span>(x)</a></code></pre></div>
<pre><code>## $class
## [1] &quot;Date&quot;</code></pre>
<p>Дата-время — это числовые векторы с классом <code>POSIXct</code>. Календарное время соответствующее стандарту POSIX</p>
<div class="sourceCode" id="cb2064"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2064-1" data-line-number="1">x &lt;-<span class="st"> </span>lubridate<span class="op">::</span><span class="kw">ymd_hm</span>(<span class="st">&quot;1970-01-01 01:00&quot;</span>)</a>
<a class="sourceLine" id="cb2064-2" data-line-number="2"><span class="kw">unclass</span>(x)</a></code></pre></div>
<pre><code>## [1] 3600
## attr(,&quot;tzone&quot;)
## [1] &quot;UTC&quot;</code></pre>
<div class="sourceCode" id="cb2066"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2066-1" data-line-number="1"><span class="kw">typeof</span>(x)</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<div class="sourceCode" id="cb2068"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2068-1" data-line-number="1"><span class="kw">attributes</span>(x)</a></code></pre></div>
<pre><code>## $class
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot; 
## 
## $tzone
## [1] &quot;UTC&quot;</code></pre>
<p>Атрибут <code>tzone</code> — необязательный. Он управляет способом вывода времени на печать, а не абсолютным временем, на что указывает его название.</p>
<div class="sourceCode" id="cb2070"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2070-1" data-line-number="1"><span class="kw">attr</span>(x, <span class="st">&quot;tzone&quot;</span>) &lt;-<span class="st"> &quot;US/Pacific&quot;</span></a>
<a class="sourceLine" id="cb2070-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [1] &quot;1969-12-31 17:00:00 PST&quot;</code></pre>
<div class="sourceCode" id="cb2072"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2072-1" data-line-number="1"><span class="kw">attr</span>(x, <span class="st">&quot;tzone&quot;</span>) &lt;-<span class="st"> &quot;US/Eastern&quot;</span></a>
<a class="sourceLine" id="cb2072-2" data-line-number="2">x</a></code></pre></div>
<pre><code>## [1] &quot;1969-12-31 20:00:00 EST&quot;</code></pre>
<p>Существует другой тип объектов даты-времени который называется POSIXlt.
Эти объекты создаются на основе именованных списков.
Но их лучше преобразовывать в POSIXсt при помощи <code>lubridate::as_date_time()</code>
.</p>
<div class="sourceCode" id="cb2074"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2074-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">as.POSIXlt</span>(x)</a>
<a class="sourceLine" id="cb2074-2" data-line-number="2"><span class="kw">typeof</span>(y)</a></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb2076"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2076-1" data-line-number="1"><span class="kw">attributes</span>(y)</a></code></pre></div>
<pre><code>## $names
##  [1] &quot;sec&quot;    &quot;min&quot;    &quot;hour&quot;   &quot;mday&quot;   &quot;mon&quot;    &quot;year&quot;   &quot;wday&quot;  
##  [8] &quot;yday&quot;   &quot;isdst&quot;  &quot;zone&quot;   &quot;gmtoff&quot;
## 
## $class
## [1] &quot;POSIXlt&quot; &quot;POSIXt&quot; 
## 
## $tzone
## [1] &quot;US/Eastern&quot; &quot;EST&quot;        &quot;EDT&quot;</code></pre>
</div>
<div id="tibble-" class="section level4">
<h4><span class="header-section-number">4.5.7.3</span> Tibble-фреймы</h4>
<p>Tibble-фреймы — это расширенные списки.
Они имеют три класса</p>
<ul>
<li><p><code>tbl_df</code></p></li>
<li><p><code>tbl</code></p></li>
<li><p><code>data.frame</code>,</p></li>
</ul>
<p>А так же два атрибута</p>
<ul>
<li><p><code>names</code> (имена столбцов)</p></li>
<li><p><code>row.names</code> (имена строк)</p></li>
</ul>
<div class="sourceCode" id="cb2078"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2078-1" data-line-number="1">tb &lt;-<span class="st"> </span>tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">y =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2078-2" data-line-number="2"><span class="kw">typeof</span>(tb)</a></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb2080"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2080-1" data-line-number="1"><span class="kw">attributes</span>(tb)</a></code></pre></div>
<pre><code>## $names
## [1] &quot;x&quot; &quot;y&quot;
## 
## $row.names
## [1] 1 2 3 4 5
## 
## $class
## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<p>Традиционный тип <code>data.frame</code> имеет аналогичную структуру.</p>
<div class="sourceCode" id="cb2082"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2082-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">y =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2082-2" data-line-number="2"><span class="kw">typeof</span>(df)</a></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<div class="sourceCode" id="cb2084"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2084-1" data-line-number="1"><span class="kw">attributes</span>(df)</a></code></pre></div>
<pre><code>## $names
## [1] &quot;x&quot; &quot;y&quot;
## 
## $class
## [1] &quot;data.frame&quot;
## 
## $row.names
## [1] 1 2 3 4 5</code></pre>
<p>Основным отличием является класс. Класс tibble-фреймов включает <code>data-frame</code>, а это означает, что tibble-фреймы наследуют поведение обычных фреймов по умолчанию.</p>
<p>Различие между тиббл-фреймом или фреймом данных и списком заключается в том, что все элементы тиббл-фрейма или фрейма данных должны быть векторами одинаковой длинны.</p>
</div>
<div id="-20.7.4.1" class="section level4">
<h4><span class="header-section-number">4.5.7.4</span> Упражнение 20.7.4.1</h4>
<div class="question">
<ol style="list-style-type: decimal">
<li><p>What does <code>hms::hms(3600)</code> return?</p></li>
<li><p>How does it print?</p></li>
<li><p>What primitive type is the augmented vector built on top of?</p></li>
<li>What attributes does it use?</li>
</ol>
</div>
<ol style="list-style-type: decimal">
<li>Функция возвращает продолжительность времени равную одному часу.</li>
</ol>
<div class="sourceCode" id="cb2086"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2086-1" data-line-number="1">t &lt;-<span class="st"> </span>hms<span class="op">::</span><span class="kw">hms</span>(<span class="dv">3600</span>)</a></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>На печать выводится в формате <code>%H:%M:%S</code></li>
</ol>
<div class="sourceCode" id="cb2087"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2087-1" data-line-number="1">t</a></code></pre></div>
<pre><code>## 01:00:00</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Расширенный вектор строится поверх класса <code>double</code></li>
</ol>
<div class="sourceCode" id="cb2089"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2089-1" data-line-number="1"><span class="kw">typeof</span>(t)</a></code></pre></div>
<pre><code>## [1] &quot;double&quot;</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Расширенный вектор использует атрибуты <code>class</code> и <code>units</code></li>
</ol>
<div class="sourceCode" id="cb2091"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2091-1" data-line-number="1"><span class="kw">attributes</span>(t)</a></code></pre></div>
<pre><code>## $class
## [1] &quot;hms&quot;      &quot;difftime&quot;
## 
## $units
## [1] &quot;secs&quot;</code></pre>
</div>
<div id="-20.7.4.2" class="section level4">
<h4><span class="header-section-number">4.5.7.5</span> Упражнение 20.7.4.2</h4>
<div class="question">
<p>Try and make a tibble that has columns with different lengths.
What happens?</p>
</div>
<p>Если задавать векторы разной длинны, то произойдёт ошибка</p>
<div class="sourceCode" id="cb2093"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2093-1" data-line-number="1"><span class="co"># tibble::tibble(x = 1:5, y = 4:1)</span></a>
<a class="sourceLine" id="cb2093-2" data-line-number="2"><span class="co"># Ошибка: Tibble columns must have consistent lengths, only values of length one are recycled:</span></a>
<a class="sourceLine" id="cb2093-3" data-line-number="3"><span class="co"># * Length 4: Column `y`</span></a>
<a class="sourceLine" id="cb2093-4" data-line-number="4"><span class="co"># * Length 5: Column `x`</span></a>
<a class="sourceLine" id="cb2093-5" data-line-number="5"><span class="co"># Call `rlang::last_error()` to see a backtrace</span></a></code></pre></div>
<p>Однако если задать один из параметров числом, или вектором единичной длинны, то столбец автозаполняется этим числом</p>
<div class="sourceCode" id="cb2094"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2094-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="dv">1</span></a></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb2096"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2096-1" data-line-number="1">tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">y =</span> <span class="dv">2</span><span class="op">:</span><span class="dv">2</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##       x     y
##   &lt;int&gt; &lt;int&gt;
## 1     1     2
## 2     2     2
## 3     3     2
## 4     4     2
## 5     5     2</code></pre>
</div>
<div id="-20.7.4.3" class="section level4">
<h4><span class="header-section-number">4.5.7.6</span> Упражнение 20.7.4.3</h4>
<div class="question">
<p>Based on the definition above, is it OK to have a list as a column of a tibble?</p>
</div>
<p>Оказывается, что может быть. А значит может быть и разной длинны</p>
<div class="sourceCode" id="cb2098"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2098-1" data-line-number="1">tibble<span class="op">::</span><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">y =</span> <span class="kw">list</span>(<span class="st">&quot;a&quot;</span>, <span class="dv">0</span>, <span class="kw">list</span>(<span class="dv">6</span><span class="op">:</span><span class="dv">8</span>)))[[<span class="dv">2</span>]]</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;a&quot;
## 
## [[2]]
## [1] 0
## 
## [[3]]
## [[3]][[1]]
## [1] 6 7 8</code></pre>
<!--chapter:end:16_vectors.Rmd-->
</div>
</div>
</div>
<div id="----purrr" class="section level2">
<h2><span class="header-section-number">4.6</span> Итерирование с помощью пакета <code>purrr</code></h2>
<div id="-15" class="section level3">
<h3><span class="header-section-number">4.6.1</span> Введение</h3>
<p>Снижение дублирования кода обеспечивает три основных преимущества</p>
<ul>
<li><p>Проследить намерения автора кода гораздо проще. Потому что внимание концентрируется на содержательной части кода, а не на повторяющихся участках</p></li>
<li><p>Вносить исправления в код гораздо проще. Потому что нужно внести изменение в одном месте, а не бегать по всему коду и менять в соответствующих участках.</p></li>
<li><p>Это облегчает устранение ошибок. Потому что опять-таки исправлять нужно в одном месте, а не в нескольких участках программы.</p></li>
</ul>
<p>В этой главе мы познакомимся с двумя важными парадигмами итерирования:</p>
<ul>
<li><p>императивное программирование</p>
<p>В императивном программировании имеются инструменты как циклы <code>for</code> или <code>while</code>. Эти циклы нужно описывать достаточно подробно</p></li>
<li><p>функциональное программирование</p>
<p>Функциональное программирование предлагает средства изолирования повторяющегося кода. Так что каждый шаблон цикла получает собственную функцию.</p></li>
</ul>
<p>Как только научимся фигачить в функциональное программирование, будет легче решать многие итерационные задачи</p>
<div id="--5" class="section level4">
<h4><span class="header-section-number">4.6.1.1</span> Используемые ресурсы</h4>
<p>Тут понадобятся <code>purrr</code>, который входит в библиотеку <code>tidyverse</code></p>
<div class="sourceCode" id="cb2100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2100-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a></code></pre></div>
</div>
</div>
<div id="-for" class="section level3">
<h3><span class="header-section-number">4.6.2</span> Циклы <code>for</code></h3>
<p>Пример. Есть такой фрейм.</p>
<div class="sourceCode" id="cb2101"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2101-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2101-2" data-line-number="2">  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2101-3" data-line-number="3">  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2101-4" data-line-number="4">  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2101-5" data-line-number="5">  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2101-6" data-line-number="6">)</a></code></pre></div>
<p>Вычислим медиану для каждого столбца</p>
<div class="sourceCode" id="cb2102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2102-1" data-line-number="1">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(df))  <span class="co"># 1. вывод</span></a>
<a class="sourceLine" id="cb2102-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {            <span class="co"># 2. последовательность</span></a>
<a class="sourceLine" id="cb2102-3" data-line-number="3">  output[[i]] &lt;-<span class="st"> </span><span class="kw">median</span>(df[[i]])      <span class="co"># 3. тело</span></a>
<a class="sourceLine" id="cb2102-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2102-5" data-line-number="5">output</a></code></pre></div>
<pre><code>## [1]  0.5372029 -0.3053302 -0.2959342  0.2304663</code></pre>
<p>Итак. каждый цикл <code>for</code> содержит три компонента</p>
<ul>
<li><p><em>вывод</em> — <code>output &lt;- vector(&quot;double&quot;, ncol(df))</code></p>
<p>Прежде чем выполнить цикл, всегда необходимо выделить достаточно места для хранения выходных результатов.
Это очень важно для обеспечения эффективности вычислений — если наращивать выходные результаты при помощи например вызовов <code>с()</code>, то цикл будет работать очень медленно.
Общий способ создания пустого вектора заданной длины предлагает функция <code>vector()</code>. Она имеет два аргумента: тип вектора(логически, целочисленный, вещественный, символьный) и длина вектора</p></li>
<li><p><em>последовательность</em> — <code>i in seq_along(df)</code></p>
<p>Этот компонент определяет по какой переменной выполняется итерирование.
На каждй итерации цикла переменной <code>i</code> будет присваиваться другое значение, берущееся из последовательности <code>seq_along(df)</code></p>
<p>Отныне лучше всегда использовать именно <code>seq_along(df)</code> вместо <code>1:length(x)</code>. Вот почему</p></li>
</ul>
<div class="sourceCode" id="cb2104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2104-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2104-2" data-line-number="2"><span class="kw">seq_along</span>(y) <span class="co"># это же вектор нулевой длины, всё верно</span></a></code></pre></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb2106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2106-1" data-line-number="1"><span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(y)  <span class="co"># это же должен быть вектор нулевой длины, почему тут два числа???</span></a></code></pre></div>
<pre><code>## [1] 1 0</code></pre>
<ul>
<li><p><em>тело цикла</em> — <code>output[[i]] &lt;- median(df[[i]])</code></p>
<p>Этот код делает всю работу. Он выполняется многократно, каждый раз с последующим значением <code>i</code>.
На первой итерации будет выполненяться инструкция <code>output[[1]] &lt;- median(df[[1]])</code>, на второй <code>output[[2]] &lt;- median(df[[2]])</code> и так далее</p></li>
</ul>
<div id="-21.2.1.1" class="section level4">
<h4><span class="header-section-number">4.6.2.1</span> Упражнение 21.2.1.1</h4>
<div class="question">
<p>Write for loops to:</p>
<ol style="list-style-type: decimal">
<li><p>Compute the mean of every column in mtcars.</p></li>
<li><p>Determine the type of each column in <code>nycflights13::flights</code>.</p></li>
<li><p>Compute the number of unique values in each column of iris.</p></li>
<li><p>Generate 10 random normals for each of <span class="math inline">\(\mu = -10, 0, 10, 100\)</span></p></li>
</ol>
<p>Think about the output, sequence, and body before you start writing the loop.</p>
</div>
<ol style="list-style-type: decimal">
<li>Если решать циклом, можно переделать задачу из упражнения:</li>
</ol>
<div class="sourceCode" id="cb2108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2108-1" data-line-number="1">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(mtcars))</a>
<a class="sourceLine" id="cb2108-2" data-line-number="2"><span class="kw">names</span>(output) &lt;-<span class="st"> </span><span class="kw">names</span>(mtcars)</a>
<a class="sourceLine" id="cb2108-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(mtcars)) {</a>
<a class="sourceLine" id="cb2108-4" data-line-number="4">  output[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(mtcars[[i]])</a>
<a class="sourceLine" id="cb2108-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2108-6" data-line-number="6">output</a></code></pre></div>
<pre><code>##        mpg        cyl       disp         hp       drat         wt 
##  20.090625  24.750000 230.721875 146.687500   3.596563   3.217250 
##       qsec         vs         am       gear       carb 
##  17.848750   0.437500   0.406250   3.687500   2.812500</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Тип вектора определяет функция <code>class()</code></li>
</ol>
<div class="sourceCode" id="cb2110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2110-1" data-line-number="1">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">ncol</span>(nycflights13<span class="op">::</span>flights))</a>
<a class="sourceLine" id="cb2110-2" data-line-number="2"><span class="kw">names</span>(output) &lt;-<span class="st"> </span><span class="kw">names</span>(nycflights13<span class="op">::</span>flights)</a>
<a class="sourceLine" id="cb2110-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(nycflights13<span class="op">::</span>flights)) {</a>
<a class="sourceLine" id="cb2110-4" data-line-number="4">  output[[i]] &lt;-<span class="st"> </span><span class="kw">class</span>(nycflights13<span class="op">::</span>flights[[i]])</a>
<a class="sourceLine" id="cb2110-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2110-6" data-line-number="6">output</a></code></pre></div>
<pre><code>## $year
## [1] &quot;integer&quot;
## 
## $month
## [1] &quot;integer&quot;
## 
## $day
## [1] &quot;integer&quot;
## 
## $dep_time
## [1] &quot;integer&quot;
## 
## $sched_dep_time
## [1] &quot;integer&quot;
## 
## $dep_delay
## [1] &quot;numeric&quot;
## 
## $arr_time
## [1] &quot;integer&quot;
## 
## $sched_arr_time
## [1] &quot;integer&quot;
## 
## $arr_delay
## [1] &quot;numeric&quot;
## 
## $carrier
## [1] &quot;character&quot;
## 
## $flight
## [1] &quot;integer&quot;
## 
## $tailnum
## [1] &quot;character&quot;
## 
## $origin
## [1] &quot;character&quot;
## 
## $dest
## [1] &quot;character&quot;
## 
## $air_time
## [1] &quot;numeric&quot;
## 
## $distance
## [1] &quot;numeric&quot;
## 
## $hour
## [1] &quot;numeric&quot;
## 
## $minute
## [1] &quot;numeric&quot;
## 
## $time_hour
## [1] &quot;POSIXct&quot; &quot;POSIXt&quot;</code></pre>
<div class="sourceCode" id="cb2112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2112-1" data-line-number="1"><span class="kw">ncol</span>(nycflights13<span class="op">::</span>flights)</a></code></pre></div>
<pre><code>## [1] 19</code></pre>
<div class="sourceCode" id="cb2114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2114-1" data-line-number="1"><span class="kw">class</span>(nycflights13<span class="op">::</span>flights[[<span class="dv">1</span>]])</a></code></pre></div>
<pre><code>## [1] &quot;integer&quot;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Тут тоже не сложно</li>
</ol>
<div class="sourceCode" id="cb2116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2116-1" data-line-number="1">iris</a></code></pre></div>
<pre><code>##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1            5.1         3.5          1.4         0.2     setosa
## 2            4.9         3.0          1.4         0.2     setosa
## 3            4.7         3.2          1.3         0.2     setosa
## 4            4.6         3.1          1.5         0.2     setosa
## 5            5.0         3.6          1.4         0.2     setosa
## 6            5.4         3.9          1.7         0.4     setosa
## 7            4.6         3.4          1.4         0.3     setosa
## 8            5.0         3.4          1.5         0.2     setosa
## 9            4.4         2.9          1.4         0.2     setosa
## 10           4.9         3.1          1.5         0.1     setosa
## 11           5.4         3.7          1.5         0.2     setosa
## 12           4.8         3.4          1.6         0.2     setosa
## 13           4.8         3.0          1.4         0.1     setosa
## 14           4.3         3.0          1.1         0.1     setosa
## 15           5.8         4.0          1.2         0.2     setosa
## 16           5.7         4.4          1.5         0.4     setosa
## 17           5.4         3.9          1.3         0.4     setosa
## 18           5.1         3.5          1.4         0.3     setosa
## 19           5.7         3.8          1.7         0.3     setosa
## 20           5.1         3.8          1.5         0.3     setosa
## 21           5.4         3.4          1.7         0.2     setosa
## 22           5.1         3.7          1.5         0.4     setosa
## 23           4.6         3.6          1.0         0.2     setosa
## 24           5.1         3.3          1.7         0.5     setosa
## 25           4.8         3.4          1.9         0.2     setosa
## 26           5.0         3.0          1.6         0.2     setosa
## 27           5.0         3.4          1.6         0.4     setosa
## 28           5.2         3.5          1.5         0.2     setosa
## 29           5.2         3.4          1.4         0.2     setosa
## 30           4.7         3.2          1.6         0.2     setosa
## 31           4.8         3.1          1.6         0.2     setosa
## 32           5.4         3.4          1.5         0.4     setosa
## 33           5.2         4.1          1.5         0.1     setosa
## 34           5.5         4.2          1.4         0.2     setosa
## 35           4.9         3.1          1.5         0.2     setosa
## 36           5.0         3.2          1.2         0.2     setosa
## 37           5.5         3.5          1.3         0.2     setosa
## 38           4.9         3.6          1.4         0.1     setosa
## 39           4.4         3.0          1.3         0.2     setosa
## 40           5.1         3.4          1.5         0.2     setosa
## 41           5.0         3.5          1.3         0.3     setosa
## 42           4.5         2.3          1.3         0.3     setosa
## 43           4.4         3.2          1.3         0.2     setosa
## 44           5.0         3.5          1.6         0.6     setosa
## 45           5.1         3.8          1.9         0.4     setosa
## 46           4.8         3.0          1.4         0.3     setosa
## 47           5.1         3.8          1.6         0.2     setosa
## 48           4.6         3.2          1.4         0.2     setosa
## 49           5.3         3.7          1.5         0.2     setosa
## 50           5.0         3.3          1.4         0.2     setosa
## 51           7.0         3.2          4.7         1.4 versicolor
## 52           6.4         3.2          4.5         1.5 versicolor
## 53           6.9         3.1          4.9         1.5 versicolor
## 54           5.5         2.3          4.0         1.3 versicolor
## 55           6.5         2.8          4.6         1.5 versicolor
## 56           5.7         2.8          4.5         1.3 versicolor
## 57           6.3         3.3          4.7         1.6 versicolor
## 58           4.9         2.4          3.3         1.0 versicolor
## 59           6.6         2.9          4.6         1.3 versicolor
## 60           5.2         2.7          3.9         1.4 versicolor
## 61           5.0         2.0          3.5         1.0 versicolor
## 62           5.9         3.0          4.2         1.5 versicolor
## 63           6.0         2.2          4.0         1.0 versicolor
## 64           6.1         2.9          4.7         1.4 versicolor
## 65           5.6         2.9          3.6         1.3 versicolor
## 66           6.7         3.1          4.4         1.4 versicolor
## 67           5.6         3.0          4.5         1.5 versicolor
## 68           5.8         2.7          4.1         1.0 versicolor
## 69           6.2         2.2          4.5         1.5 versicolor
## 70           5.6         2.5          3.9         1.1 versicolor
## 71           5.9         3.2          4.8         1.8 versicolor
## 72           6.1         2.8          4.0         1.3 versicolor
## 73           6.3         2.5          4.9         1.5 versicolor
## 74           6.1         2.8          4.7         1.2 versicolor
## 75           6.4         2.9          4.3         1.3 versicolor
## 76           6.6         3.0          4.4         1.4 versicolor
## 77           6.8         2.8          4.8         1.4 versicolor
## 78           6.7         3.0          5.0         1.7 versicolor
## 79           6.0         2.9          4.5         1.5 versicolor
## 80           5.7         2.6          3.5         1.0 versicolor
## 81           5.5         2.4          3.8         1.1 versicolor
## 82           5.5         2.4          3.7         1.0 versicolor
## 83           5.8         2.7          3.9         1.2 versicolor
## 84           6.0         2.7          5.1         1.6 versicolor
## 85           5.4         3.0          4.5         1.5 versicolor
## 86           6.0         3.4          4.5         1.6 versicolor
## 87           6.7         3.1          4.7         1.5 versicolor
## 88           6.3         2.3          4.4         1.3 versicolor
## 89           5.6         3.0          4.1         1.3 versicolor
## 90           5.5         2.5          4.0         1.3 versicolor
## 91           5.5         2.6          4.4         1.2 versicolor
## 92           6.1         3.0          4.6         1.4 versicolor
## 93           5.8         2.6          4.0         1.2 versicolor
## 94           5.0         2.3          3.3         1.0 versicolor
## 95           5.6         2.7          4.2         1.3 versicolor
## 96           5.7         3.0          4.2         1.2 versicolor
## 97           5.7         2.9          4.2         1.3 versicolor
## 98           6.2         2.9          4.3         1.3 versicolor
## 99           5.1         2.5          3.0         1.1 versicolor
## 100          5.7         2.8          4.1         1.3 versicolor
## 101          6.3         3.3          6.0         2.5  virginica
## 102          5.8         2.7          5.1         1.9  virginica
## 103          7.1         3.0          5.9         2.1  virginica
## 104          6.3         2.9          5.6         1.8  virginica
## 105          6.5         3.0          5.8         2.2  virginica
## 106          7.6         3.0          6.6         2.1  virginica
## 107          4.9         2.5          4.5         1.7  virginica
## 108          7.3         2.9          6.3         1.8  virginica
## 109          6.7         2.5          5.8         1.8  virginica
## 110          7.2         3.6          6.1         2.5  virginica
## 111          6.5         3.2          5.1         2.0  virginica
## 112          6.4         2.7          5.3         1.9  virginica
## 113          6.8         3.0          5.5         2.1  virginica
## 114          5.7         2.5          5.0         2.0  virginica
## 115          5.8         2.8          5.1         2.4  virginica
## 116          6.4         3.2          5.3         2.3  virginica
## 117          6.5         3.0          5.5         1.8  virginica
## 118          7.7         3.8          6.7         2.2  virginica
## 119          7.7         2.6          6.9         2.3  virginica
## 120          6.0         2.2          5.0         1.5  virginica
## 121          6.9         3.2          5.7         2.3  virginica
## 122          5.6         2.8          4.9         2.0  virginica
## 123          7.7         2.8          6.7         2.0  virginica
## 124          6.3         2.7          4.9         1.8  virginica
## 125          6.7         3.3          5.7         2.1  virginica
## 126          7.2         3.2          6.0         1.8  virginica
## 127          6.2         2.8          4.8         1.8  virginica
## 128          6.1         3.0          4.9         1.8  virginica
## 129          6.4         2.8          5.6         2.1  virginica
## 130          7.2         3.0          5.8         1.6  virginica
## 131          7.4         2.8          6.1         1.9  virginica
## 132          7.9         3.8          6.4         2.0  virginica
## 133          6.4         2.8          5.6         2.2  virginica
## 134          6.3         2.8          5.1         1.5  virginica
## 135          6.1         2.6          5.6         1.4  virginica
## 136          7.7         3.0          6.1         2.3  virginica
## 137          6.3         3.4          5.6         2.4  virginica
## 138          6.4         3.1          5.5         1.8  virginica
## 139          6.0         3.0          4.8         1.8  virginica
## 140          6.9         3.1          5.4         2.1  virginica
## 141          6.7         3.1          5.6         2.4  virginica
## 142          6.9         3.1          5.1         2.3  virginica
## 143          5.8         2.7          5.1         1.9  virginica
## 144          6.8         3.2          5.9         2.3  virginica
## 145          6.7         3.3          5.7         2.5  virginica
## 146          6.7         3.0          5.2         2.3  virginica
## 147          6.3         2.5          5.0         1.9  virginica
## 148          6.5         3.0          5.2         2.0  virginica
## 149          6.2         3.4          5.4         2.3  virginica
## 150          5.9         3.0          5.1         1.8  virginica</code></pre>
<div class="sourceCode" id="cb2118"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2118-1" data-line-number="1"><span class="kw">length</span>(<span class="kw">unique</span>(iris<span class="op">$</span>Sepal.Length))</a></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb2120"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2120-1" data-line-number="1"><span class="kw">length</span>(<span class="kw">unique</span>(iris[[<span class="dv">2</span>]]))</a></code></pre></div>
<pre><code>## [1] 23</code></pre>
<div class="sourceCode" id="cb2122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2122-1" data-line-number="1">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">ncol</span>(iris))</a>
<a class="sourceLine" id="cb2122-2" data-line-number="2"><span class="kw">names</span>(output) &lt;-<span class="st"> </span><span class="kw">names</span>(iris)</a>
<a class="sourceLine" id="cb2122-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(iris)) {</a>
<a class="sourceLine" id="cb2122-4" data-line-number="4">  output[[i]] &lt;-<span class="st"> </span><span class="kw">length</span>(<span class="kw">unique</span>(iris[[i]]))</a>
<a class="sourceLine" id="cb2122-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2122-6" data-line-number="6">output</a></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
##           35           23           43           22            3</code></pre>
<ol start="4" style="list-style-type: decimal">
<li></li>
</ol>
<div class="sourceCode" id="cb2124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2124-1" data-line-number="1"><span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dt">mean =</span> <span class="dv">-10</span>)</a></code></pre></div>
<pre><code>##  [1]  -9.198223  -9.855136  -8.687458  -9.576080  -9.585917  -9.859268
##  [7] -10.566781  -9.215299 -10.354624  -9.315234</code></pre>
<div class="sourceCode" id="cb2126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2126-1" data-line-number="1">mu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2126-2" data-line-number="2">output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(mu))</a>
<a class="sourceLine" id="cb2126-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(mu)) {</a>
<a class="sourceLine" id="cb2126-4" data-line-number="4">  output[[i]] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">10</span>, <span class="dt">mean =</span> i)</a>
<a class="sourceLine" id="cb2126-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2126-6" data-line-number="6">output</a></code></pre></div>
<pre><code>## [[1]]
##  [1] -0.11778418  0.35253735  1.34944969  1.40894867  0.60715720
##  [6]  1.88141480 -0.69067204 -0.02585697  0.52840387  1.24013944
## 
## [[2]]
##  [1] 1.5898667 4.4422959 2.1721776 2.9755254 3.6360921 2.2930357 1.0219444
##  [8] 0.3265073 0.9261285 2.7862969
## 
## [[3]]
##  [1] 2.901989 1.956732 3.773886 2.572628 3.834407 2.015861 2.463225
##  [8] 3.728005 3.062660 3.153461
## 
## [[4]]
##  [1] 3.683432 3.012178 5.009770 3.441351 4.017146 4.123459 3.668362
##  [8] 4.320092 3.128078 3.817107</code></pre>
</div>
<div id="-21.2.1.2" class="section level4">
<h4><span class="header-section-number">4.6.2.2</span> Упражнение 21.2.1.2</h4>
<div class="question">
<p>Eliminate the for loop in each of the following examples by taking advantage of an existing function that works with vectors:</p>
</div>
<ol style="list-style-type: decimal">
<li>Цикл <code>for</code> в данном примере объединяет все элементы вектора <code>letters</code>. Функция <code>str_c()</code> содержит внутри себя аргумент <code>collapse</code>, который выполняет эту же функцию.</li>
</ol>
<div class="sourceCode" id="cb2128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2128-1" data-line-number="1">out &lt;-<span class="st"> &quot;&quot;</span></a>
<a class="sourceLine" id="cb2128-2" data-line-number="2"><span class="cf">for</span> (x <span class="cf">in</span> letters) {</a>
<a class="sourceLine" id="cb2128-3" data-line-number="3">  out &lt;-<span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_c</span>(out, x)</a>
<a class="sourceLine" id="cb2128-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2128-5" data-line-number="5">out</a></code></pre></div>
<pre><code>## [1] &quot;abcdefghijklmnopqrstuvwxyz&quot;</code></pre>
<div class="sourceCode" id="cb2130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2130-1" data-line-number="1"><span class="kw">str_c</span>(letters, <span class="dt">collapse =</span> <span class="st">&quot;&quot;</span>)</a></code></pre></div>
<pre><code>## [1] &quot;abcdefghijklmnopqrstuvwxyz&quot;</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Этот цикл считает стандартное отклонение <span class="math inline">\(sd = \frac{\sum{(x_i - \bar{x}})^2}{n-1}\)</span>.
Но ведь для этого есть функция <code>sd()</code></li>
</ol>
<div class="sourceCode" id="cb2132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2132-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2132-2" data-line-number="2">sd &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb2132-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb2132-4" data-line-number="4">  sd &lt;-<span class="st"> </span>sd <span class="op">+</span><span class="st"> </span>(x[i] <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(x)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb2132-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2132-6" data-line-number="6">sd &lt;-<span class="st"> </span><span class="kw">sqrt</span>(sd <span class="op">/</span><span class="st"> </span>(<span class="kw">length</span>(x) <span class="op">-</span><span class="st"> </span><span class="dv">1</span>))</a>
<a class="sourceLine" id="cb2132-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2132-8" data-line-number="8"><span class="kw">sd</span>(x)</a></code></pre></div>
<pre><code>## [1] 29.01149</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Эта функция считает скользящую (или кумулятивную) сумму — считает сумму для каждого последующего элемента.
Для этих целей есть внутренняя функция <code>cumsum()</code></li>
</ol>
<div class="sourceCode" id="cb2134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2134-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">runif</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2134-2" data-line-number="2">out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb2134-3" data-line-number="3">out[<span class="dv">1</span>] &lt;-<span class="st"> </span>x[<span class="dv">1</span>]</a>
<a class="sourceLine" id="cb2134-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(x)) {</a>
<a class="sourceLine" id="cb2134-5" data-line-number="5">  out[i] &lt;-<span class="st"> </span>out[i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>x[i]</a>
<a class="sourceLine" id="cb2134-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb2134-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2134-8" data-line-number="8"><span class="kw">cumsum</span>(x)</a></code></pre></div>
<pre><code>##   [1]  0.1942294  0.6944156  1.4195624  2.3335249  2.4502001  3.3080216
##   [7]  3.5118332  3.7560776  4.6529152  5.4256014  5.9613789  6.2082816
##  [13]  6.2846635  7.1661863  7.3629545  7.9818262  8.3254949  8.8840140
##  [19]  9.7763698 10.0059066 10.8478567 10.8766460 11.4086109 11.4235597
##  [25] 11.9022820 12.4359866 12.9691154 13.7955970 13.9187242 14.5303908
##  [31] 14.6282924 15.1760687 15.7387249 16.4879979 16.7695960 17.1900762
##  [37] 17.9384638 18.5504540 19.4226059 20.2481258 21.1283132 21.9106805
##  [43] 22.0669951 22.6039628 23.5240345 24.3140276 24.9822113 25.1236491
##  [49] 25.5502225 26.4356110 26.8797657 27.2718121 28.0600562 28.3215390
##  [55] 28.9613446 29.3638064 30.2441093 31.1995306 31.3241553 32.2911252
##  [61] 32.8009721 33.5902942 33.9000316 34.6359253 34.7541703 34.9253864
##  [67] 35.7151449 36.6874894 37.3267313 37.4168756 38.3614189 38.6523647
##  [73] 39.1140704 39.3867306 39.9338462 40.1419077 41.0840287 41.8590055
##  [79] 42.0510841 42.3888931 43.1357790 43.6864938 44.0757892 44.9430419
##  [85] 45.5703344 46.5469009 46.7501166 47.1878275 48.1184054 48.1414620
##  [91] 48.2521260 48.8637065 49.2247246 50.0303987 50.2266678 50.4395631
##  [97] 50.8128959 51.5961775 51.9232793 52.3540170</code></pre>
</div>
<div id="-21.2.1.3" class="section level4">
<h4><span class="header-section-number">4.6.2.3</span> Упражнение 21.2.1.3</h4>
<div class="question">
<p>Combine your function writing and for loop skills:</p>
<p>Write a for loop that <code>prints()</code> the lyrics to the children’s song “Alice the camel”.</p>
<p>Convert the nursery rhyme “ten in the bed” to a function. Generalise it to any number of people in any sleeping structure.</p>
<p>Convert the song “99 bottles of beer on the wall” to a function. Generalise to any number of any vessel containing any liquid on any surface.</p>
</div>
<ul>
<li>Задание 1 — песенка доступна по адресу <a href="http://www.metrolyrics.com/alice-the-camel-lyrics-children.html" class="uri">http://www.metrolyrics.com/alice-the-camel-lyrics-children.html</a></li>
</ul>
<p>Смысл такой, что по очереди от числа 5 до нуля у верблюда исчезают горбы и когда горбов нет, верблюд превращается в лошадь.</p>
<p>Реализовать можно и без команды <code>print()</code>. Я подошёл лениво к реализации — моё решение не учитывает общий случай (когда горбов больше чем 5), но где вы видели верблюда с таким количеством горбов?
Но зато решение учитывает правила орфографии для единственного числа.</p>
<div class="sourceCode" id="cb2136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2136-1" data-line-number="1">count &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;five&quot;</span>, <span class="st">&quot;four&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;one&quot;</span>, <span class="st">&quot;no&quot;</span>)</a>
<a class="sourceLine" id="cb2136-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2136-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(count)) {</a>
<a class="sourceLine" id="cb2136-4" data-line-number="4">  <span class="cf">if</span> (i <span class="op">&lt;=</span><span class="st"> </span><span class="dv">4</span>) {</a>
<a class="sourceLine" id="cb2136-5" data-line-number="5">    <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="st">&quot;Alice the camel has &quot;</span>, <span class="kw">rep</span>(count[i], <span class="dv">3</span>), <span class="st">&quot; humps.&quot;</span>,</a>
<a class="sourceLine" id="cb2136-6" data-line-number="6">    <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb2136-7" data-line-number="7">  ), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">So go, Alice, go.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb2136-8" data-line-number="8">  }</a>
<a class="sourceLine" id="cb2136-9" data-line-number="9">  <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">5</span>) {</a>
<a class="sourceLine" id="cb2136-10" data-line-number="10">    <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="st">&quot;Alice the camel has &quot;</span>, <span class="kw">rep</span>(count[i], <span class="dv">3</span>), <span class="st">&quot; hump.&quot;</span>,</a>
<a class="sourceLine" id="cb2136-11" data-line-number="11">    <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb2136-12" data-line-number="12">  ), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">So go, Alice, go.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb2136-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb2136-14" data-line-number="14">  <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">6</span>) {</a>
<a class="sourceLine" id="cb2136-15" data-line-number="15">   <span class="kw">cat</span>(<span class="kw">str_c</span>(<span class="st">&quot;Alice the camel has &quot;</span>, <span class="kw">rep</span>(count[i], <span class="dv">3</span>), <span class="st">&quot; humps.&quot;</span>,</a>
<a class="sourceLine" id="cb2136-16" data-line-number="16">    <span class="dt">collapse =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb2136-17" data-line-number="17">  ), <span class="st">&quot;</span><span class="ch">\n</span><span class="st">Now Alice is a horse.&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>) </a>
<a class="sourceLine" id="cb2136-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb2136-19" data-line-number="19">}</a></code></pre></div>
<pre><code>## Alice the camel has five humps.
## Alice the camel has five humps.
## Alice the camel has five humps. 
## So go, Alice, go.
##  
## Alice the camel has four humps.
## Alice the camel has four humps.
## Alice the camel has four humps. 
## So go, Alice, go.
##  
## Alice the camel has three humps.
## Alice the camel has three humps.
## Alice the camel has three humps. 
## So go, Alice, go.
##  
## Alice the camel has two humps.
## Alice the camel has two humps.
## Alice the camel has two humps. 
## So go, Alice, go.
##  
## Alice the camel has one hump.
## Alice the camel has one hump.
## Alice the camel has one hump. 
## So go, Alice, go.
##  
## Alice the camel has no humps.
## Alice the camel has no humps.
## Alice the camel has no humps. 
## Now Alice is a horse.</code></pre>
<ul>
<li>Задание 2 — песенка доступна по адресу <a href="https://www.kididdles.com/lyrics/t003.html" class="uri">https://www.kididdles.com/lyrics/t003.html</a></li>
</ul>
<p>От заданного числа до нуля происходит счёт</p>
<p>There were ten in a bed
And the little one said
“Roll over, roll over”
So they all rolled over
And one fell out</p>
<p>на последнем элементе текст меняется на</p>
<p>There was one in a bed
And the little one said
“Good night!”</p>
<p>Для создания функции т.е. общего случая нужно иметь вектор всех названий числительных.
Либо заменить числительные на число. Я в этой реализации опять сделаю ленивую версию в которой просто отработаю навык создания цикла <code>for</code></p>
<div class="sourceCode" id="cb2138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2138-1" data-line-number="1">numbers &lt;-<span class="st"> </span><span class="kw">c</span>(</a>
<a class="sourceLine" id="cb2138-2" data-line-number="2">  <span class="st">&quot;ten&quot;</span>, <span class="st">&quot;nine&quot;</span>, <span class="st">&quot;eight&quot;</span>, <span class="st">&quot;seven&quot;</span>, <span class="st">&quot;six&quot;</span>, <span class="st">&quot;five&quot;</span>,</a>
<a class="sourceLine" id="cb2138-3" data-line-number="3">  <span class="st">&quot;four&quot;</span>, <span class="st">&quot;three&quot;</span>, <span class="st">&quot;two&quot;</span>, <span class="st">&quot;one&quot;</span></a>
<a class="sourceLine" id="cb2138-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb2138-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2138-6" data-line-number="6"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(numbers)) {</a>
<a class="sourceLine" id="cb2138-7" data-line-number="7">  <span class="cf">if</span>(<span class="kw">length</span>(numbers) <span class="op">-</span><span class="st"> </span>i <span class="op">==</span><span class="st"> </span><span class="dv">0</span> ) {</a>
<a class="sourceLine" id="cb2138-8" data-line-number="8">    <span class="kw">cat</span>(<span class="st">&quot;There were&quot;</span>, numbers[i], <span class="st">&quot;in a bed&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">And the little one said</span></a>
<a class="sourceLine" id="cb2138-9" data-line-number="9"><span class="ch">\&quot;</span><span class="st">Good night!</span><span class="ch">\&quot;\n</span></a>
<a class="sourceLine" id="cb2138-10" data-line-number="10"><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb2138-11" data-line-number="11">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb2138-12" data-line-number="12">  <span class="kw">cat</span>(<span class="st">&quot;There were&quot;</span>, numbers[i], <span class="st">&quot;in a bed&quot;</span>, <span class="st">&quot;</span><span class="ch">\n</span><span class="st">And the little one said</span></a>
<a class="sourceLine" id="cb2138-13" data-line-number="13"><span class="ch">\&quot;</span><span class="st">Roll over, roll over</span><span class="ch">\&quot;</span></a>
<a class="sourceLine" id="cb2138-14" data-line-number="14"><span class="st">So they all rolled over</span></a>
<a class="sourceLine" id="cb2138-15" data-line-number="15"><span class="st">And one fell out</span></a>
<a class="sourceLine" id="cb2138-16" data-line-number="16"><span class="ch">\n</span><span class="st">&quot;</span>)</a>
<a class="sourceLine" id="cb2138-17" data-line-number="17">  } </a>
<a class="sourceLine" id="cb2138-18" data-line-number="18">}</a></code></pre></div>
<pre><code>## There were ten in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were nine in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were eight in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were seven in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were six in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were five in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were four in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were three in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were two in a bed 
## And the little one said
## &quot;Roll over, roll over&quot;
## So they all rolled over
## And one fell out
## 
## There were one in a bed 
## And the little one said
## &quot;Good night!&quot;</code></pre>
<ul>
<li>Задание 3 — песенка доступна по адресу <a href="https://en.wikipedia.org/wiki/99_Bottles_of_Beer" class="uri">https://en.wikipedia.org/wiki/99_Bottles_of_Beer</a></li>
</ul>
<div class="sourceCode" id="cb2140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2140-1" data-line-number="1"><span class="co"># Сначала я реализую функцию считалку, которая будет сокращать количество бутылок.</span></a>
<a class="sourceLine" id="cb2140-2" data-line-number="2">bottles &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb2140-3" data-line-number="3">  <span class="cf">if</span> (i <span class="op">&gt;</span><span class="st"> </span><span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb2140-4" data-line-number="4">    bottles &lt;-<span class="st"> </span><span class="kw">str_c</span>(i <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="st">&quot; bottles&quot;</span>)</a>
<a class="sourceLine" id="cb2140-5" data-line-number="5">  } <span class="cf">else</span> <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span><span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb2140-6" data-line-number="6">    bottles &lt;-<span class="st"> &quot;1 bottle&quot;</span></a>
<a class="sourceLine" id="cb2140-7" data-line-number="7">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb2140-8" data-line-number="8">    bottles &lt;-<span class="st"> &quot;no more bottles&quot;</span></a>
<a class="sourceLine" id="cb2140-9" data-line-number="9">  }</a>
<a class="sourceLine" id="cb2140-10" data-line-number="10">  bottles</a>
<a class="sourceLine" id="cb2140-11" data-line-number="11">}</a>
<a class="sourceLine" id="cb2140-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2140-13" data-line-number="13"><span class="co"># Теперь можно и песенку сделать. Введём параметры по умолчанию --- если ничего не указать, кроме числа, будет стандартная песенка, но параметры можно менять. Задавать жижку, и поверхность.</span></a>
<a class="sourceLine" id="cb2140-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2140-15" data-line-number="15">song &lt;-<span class="st"> </span><span class="cf">function</span>(i, <span class="dt">liquid =</span> <span class="st">&quot;beer&quot;</span>, <span class="dt">surface =</span> <span class="st">&quot;wall&quot;</span>) {</a>
<a class="sourceLine" id="cb2140-16" data-line-number="16"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq</span>(i, <span class="dv">1</span>, <span class="dv">-1</span>)) {</a>
<a class="sourceLine" id="cb2140-17" data-line-number="17">  <span class="kw">cat</span>(<span class="kw">bottles</span>(i),<span class="st">&quot; of &quot;</span>, liquid, <span class="st">&quot; on the &quot;</span>, surface, <span class="st">&quot;, &quot;</span>, <span class="kw">bottles</span>(i), <span class="st">&quot; o f&quot;</span>, liquid,<span class="st">&quot;.</span><span class="ch">\n</span></a>
<a class="sourceLine" id="cb2140-18" data-line-number="18"><span class="st">Take one down, pass it around, &quot;</span>, <span class="kw">bottles</span>(i), <span class="st">&quot; of &quot;</span>, liquid, <span class="st">&quot; on the &quot;</span>, surface, <span class="st">&quot;.</span><span class="ch">\n</span><span class="st">&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb2140-19" data-line-number="19">}  </a>
<a class="sourceLine" id="cb2140-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb2140-21" data-line-number="21"></a>
<a class="sourceLine" id="cb2140-22" data-line-number="22"><span class="kw">song</span>(<span class="dv">10</span>, <span class="st">&quot;wine&quot;</span>, <span class="st">&quot;table&quot;</span>)</a></code></pre></div>
<pre><code>## 9 bottles of wine on the table, 9 bottles o fwine.
## 
## Take one down, pass it around, 9 bottles of wine on the table.
## 8 bottles of wine on the table, 8 bottles o fwine.
## 
## Take one down, pass it around, 8 bottles of wine on the table.
## 7 bottles of wine on the table, 7 bottles o fwine.
## 
## Take one down, pass it around, 7 bottles of wine on the table.
## 6 bottles of wine on the table, 6 bottles o fwine.
## 
## Take one down, pass it around, 6 bottles of wine on the table.
## 5 bottles of wine on the table, 5 bottles o fwine.
## 
## Take one down, pass it around, 5 bottles of wine on the table.
## 4 bottles of wine on the table, 4 bottles o fwine.
## 
## Take one down, pass it around, 4 bottles of wine on the table.
## 3 bottles of wine on the table, 3 bottles o fwine.
## 
## Take one down, pass it around, 3 bottles of wine on the table.
## 2 bottles of wine on the table, 2 bottles o fwine.
## 
## Take one down, pass it around, 2 bottles of wine on the table.
## 1 bottle of wine on the table, 1 bottle o fwine.
## 
## Take one down, pass it around, 1 bottle of wine on the table.
## no more bottles of wine on the table, no more bottles o fwine.
## 
## Take one down, pass it around, no more bottles of wine on the table.</code></pre>
</div>
<div id="-21.2.1.4" class="section level4">
<h4><span class="header-section-number">4.6.2.4</span> Упражнение 21.2.1.4</h4>
<div class="question">
<p>It’s common to see for loops that don’t preallocate the output and instead increase the length of a vector at each step:
How does this affect performance? Design and execute an experiment.</p>
</div>
<p>При помощи пакета</p>
<div class="sourceCode" id="cb2142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2142-1" data-line-number="1"><span class="kw">library</span>(microbenchmark)</a></code></pre></div>
<p>который мы уже использовали в курсе по обучению программированию, мы проверим, на сколько изменяется производительность</p>
<div class="sourceCode" id="cb2143"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2143-1" data-line-number="1">add_to_vector &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb2143-2" data-line-number="2">  output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;integer&quot;</span>, <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb2143-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(n)) {</a>
<a class="sourceLine" id="cb2143-4" data-line-number="4">    output &lt;-<span class="st"> </span><span class="kw">c</span>(output, i)</a>
<a class="sourceLine" id="cb2143-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb2143-6" data-line-number="6">  output</a>
<a class="sourceLine" id="cb2143-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb2143-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2143-9" data-line-number="9"><span class="kw">microbenchmark</span>(<span class="kw">add_to_vector</span>(<span class="dv">10000</span>), <span class="dt">times =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## Unit: milliseconds
##                  expr      min       lq     mean   median      uq      max
##  add_to_vector(10000) 113.6245 123.5266 144.5535 133.4288 160.018 186.6073
##  neval
##      3</code></pre>
<div class="sourceCode" id="cb2145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2145-1" data-line-number="1">?<span class="kw">microbenchmark</span>()</a></code></pre></div>
<div class="sourceCode" id="cb2146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2146-1" data-line-number="1">dd_to_vector_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="cf">function</span>(n) {</a>
<a class="sourceLine" id="cb2146-2" data-line-number="2">  output &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;integer&quot;</span>, n)</a>
<a class="sourceLine" id="cb2146-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(n)) {</a>
<a class="sourceLine" id="cb2146-4" data-line-number="4">    output[[i]] &lt;-<span class="st"> </span>i</a>
<a class="sourceLine" id="cb2146-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb2146-6" data-line-number="6">  output</a>
<a class="sourceLine" id="cb2146-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb2146-8" data-line-number="8"><span class="kw">microbenchmark</span>(<span class="kw">dd_to_vector_2</span>(<span class="dv">10000</span>), <span class="dt">times =</span> <span class="dv">3</span>)</a></code></pre></div>
<pre><code>## Unit: microseconds
##                   expr     min       lq     mean  median       uq     max
##  dd_to_vector_2(10000) 636.126 643.3905 1878.574 650.655 2499.797 4348.94
##  neval
##      3</code></pre>
<p>Предварительно выделенный вектор примерно в 10 раз быстрее! Вы можете получить разные ответы, но чем длиннее вектор и чем больше объекты, тем больше предварительное выделение превзойдет добавление.</p>
</div>
</div>
<div id="--for" class="section level3">
<h3><span class="header-section-number">4.6.3</span> Варианты цикла <code>for</code></h3>
<p>Существуют 4 следующих вариации на тему цикла <code>for</code></p>
<div id="-----" class="section level4">
<h4><span class="header-section-number">4.6.3.1</span> Изменение существующего объекта вместо создания нового</h4>
<p>Иногда возникает необходимость в использовании цикла для изменения существующего объекта.
Например, вспомним задачу</p>
<div class="sourceCode" id="cb2148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2148-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2148-2" data-line-number="2">  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2148-3" data-line-number="3">  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2148-4" data-line-number="4">  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2148-5" data-line-number="5">  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2148-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2148-7" data-line-number="7">rescale01 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb2148-8" data-line-number="8">  rng &lt;-<span class="st"> </span><span class="kw">range</span>(x, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2148-9" data-line-number="9">  (x <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>]) <span class="op">/</span><span class="st"> </span>(rng[<span class="dv">2</span>] <span class="op">-</span><span class="st"> </span>rng[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2148-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb2148-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2148-12" data-line-number="12">df</a></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##          a      b       c        d
##      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 -1.01    0.876  0.443  -0.00586
##  2 -0.0686  0.152  1.23    0.104  
##  3  1.22   -1.04   2.26    0.188  
##  4  0.0805 -1.03  -0.735   1.39   
##  5  0.658   1.08  -1.07    0.316  
##  6  0.205   0.813  0.0550  0.559  
##  7  1.60   -0.391 -0.818  -1.24   
##  8 -0.0719  0.773 -0.180  -0.211  
##  9 -0.0639  1.02   1.20    1.67   
## 10 -1.41    0.599 -0.259   2.22</code></pre>
<p>Вновь обратимся к трем компонентам цикла <code>for</code></p>
<p><em>Вывод</em> — у нас уже есть выходной объект — этот тот же объект, что и входной.</p>
<p><em>Последовательность</em> — фрейм данных можно представлять как список столбцов, поэтому мы можем итерировать, по столбцам с помощью функции <code>seq_along(df)</code></p>
<p><em>Тело цикла</em> — примените функцию <code>rescale01()</code></p>
<p>В результате получаем следующий код</p>
<div class="sourceCode" id="cb2150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2150-1" data-line-number="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb2150-2" data-line-number="2">  df[[i]] &lt;-<span class="st"> </span><span class="kw">rescale01</span>(df[[i]])</a>
<a class="sourceLine" id="cb2150-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb2150-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2150-5" data-line-number="5">df</a></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##        a       b      c     d
##    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1 0.132 0.906   0.455  0.356
##  2 0.445 0.564   0.691  0.388
##  3 0.874 0       1      0.412
##  4 0.494 0.00720 0.101  0.761
##  5 0.686 1       0      0.450
##  6 0.535 0.876   0.338  0.520
##  7 1     0.308   0.0759 0    
##  8 0.443 0.857   0.268  0.297
##  9 0.446 0.975   0.682  0.840
## 10 0     0.775   0.244  1</code></pre>
<p>Как правило, именно эту разновидность цикла, я буду применять для изменения списка или фрейма данных — поэтому надо использовать двойные квадратные скобки <code>[[]]</code>. Да и вообще, лучше в циклах чаще использовать именно двойные скобки, для того чтобы отчетливо указать — мы рабаотем, с одиночным элементом.</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">4.6.3.2</span> Шаблоны формирования циклов</h4>
<p>Существуют три способа организации цикла для вектора</p>
<ul>
<li><p>по числовым индексам <code>for (i in seq_along(xs))</code> и извлечение выражения с помощью <code>x[[i]]</code></p></li>
<li><p>циклический перебор по элементам <code>for (x in xs)</code>. Эта форма наиболее полезна, когда нужно лишь выводить на печать, или сохранять в файл.</p></li>
<li><p>циклический перебор по именам <code>for (nm in names(xs))</code>. В результате, получаем имя которое можно использовать для доступа к значению с помощью выражения <code>x[[nm]]</code>. Это полезно, когда нужно использовать имя в качестве названия графика или имени файла.
При этом создавая именованные выходные данных, присваивать имя результирующему вектору нужно так</p></li>
</ul>
<div class="sourceCode" id="cb2152"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2152-1" data-line-number="1">results &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb2152-2" data-line-number="2"><span class="kw">names</span>(results) &lt;-<span class="st"> </span><span class="kw">names</span>(x)</a></code></pre></div>
<p>Однако итерирования по числовым индксам это наиболее общая форма. Зная позицию элемента, можно вытащить и имя и значение</p>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">4.6.3.3</span> Выходные данные неизвестной длинны</h4>
<p>Иногда длина выходных данных неизвестна заранее.</p>
<p>Предположим нужно имитировать набор случайных векторов со случайной длинной.</p>
<p>Есть соблазн решить задачу постепенного наращивания</p>
<div class="sourceCode" id="cb2153"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2153-1" data-line-number="1">means &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2153-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2153-3" data-line-number="3">output &lt;-<span class="st"> </span><span class="kw">double</span>()</a>
<a class="sourceLine" id="cb2153-4" data-line-number="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(means)) {</a>
<a class="sourceLine" id="cb2153-5" data-line-number="5">  n &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">100</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2153-6" data-line-number="6">  output &lt;-<span class="st"> </span><span class="kw">c</span>(output, <span class="kw">rnorm</span>(n, means[[i]]))</a>
<a class="sourceLine" id="cb2153-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb2153-8" data-line-number="8"><span class="kw">str</span>(output)</a></code></pre></div>
<pre><code>##  num [1:99] 0.10632 -0.95251 -0.43187 0.00983 0.28561 ...</code></pre>
<p>Но это неэффективно, поскольку на каждой итерации приходится копировать все данные из предыдущих итераций. Это квадратичная сложность <span class="math inline">\(O(n^2)\)</span>. А это охначает что цикл, обрабатывающий в три раза больше элементов, будет работать в три раза дольше.</p>
<p>Лучшее решении заключается в сохранении результатов в виде списка, а затем объединение в один вектор, по завершении цикла</p>
<div class="sourceCode" id="cb2155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2155-1" data-line-number="1">out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(means))</a>
<a class="sourceLine" id="cb2155-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(means)) {</a>
<a class="sourceLine" id="cb2155-3" data-line-number="3">  n &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">100</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2155-4" data-line-number="4">  out[[i]] &lt;-<span class="st"> </span><span class="kw">rnorm</span>(n, means[[i]])</a>
<a class="sourceLine" id="cb2155-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2155-6" data-line-number="6"><span class="kw">str</span>(out)</a></code></pre></div>
<pre><code>## List of 3
##  $ : num [1:10] -0.0701 -0.165 -1.6663 -1.4621 0.1535 ...
##  $ : num [1:9] 0.0544 0.666 0.0788 1.5906 0.171 ...
##  $ : num [1:71] 2.22 1.8 2.6 3.26 3.93 ...</code></pre>
<div class="sourceCode" id="cb2157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2157-1" data-line-number="1"><span class="kw">str</span>(<span class="kw">unlist</span>(out))</a></code></pre></div>
<pre><code>##  num [1:90] -0.0701 -0.165 -1.6663 -1.4621 0.1535 ...</code></pre>
<p>В данном случае был использован <code>unlist()</code> для сведения в один вектор.
Более строгий подход — использовать <code>purrr::flatten_dbl()</code>, в случае если входные данные не являются списком вещественных чисел, она выдаст ошибку.</p>
<p>Такой шаблон так же встречается в ещё двух ситуациях</p>
<ol style="list-style-type: decimal">
<li><p>Вы генерируете длинную строку. Вместо объединения результатов каждой итерации с предыдущими с помощью функции <code>paste()</code> сохраните выходные данные в символьном векторе, а затем объедините в одну строку при помощи <code>paste(output, collapse = &quot;&quot;)</code></p></li>
<li><p>Вы генерируете большой фрейм данных. Вместо последовательного объединения строк или столбцов на каждой итерации с помощью <code>rbind()</code> сохраните данные в виде списка, а затем используйте вызов <code>dplyr::bind_rows(output)</code> для объединения в один фрейм.</p></li>
</ol>
<p>Всякий раз, когда встречается этот шаблон — переходи к более сложному объекту результата, а по завершении объедини выходные данные за один приём. Так эффективнее.</p>
</div>
<div id="----" class="section level4">
<h4><span class="header-section-number">4.6.3.4</span> Последовательность на входе неизвестной длинны</h4>
<p>Это обычная ситуация, при выполнении различных имитаций. Предположим, нужно чтобы цикл выполнялся до тех пор, пока три раза не выподет орёл.</p>
<p>Для таких целей нужен цикл <code>while</code>. Он более общий — поскольку каждый цикл фор можно переписать как цикл вайл, однако не каждый цикл вайл можно сделать при помощи цикла фор.</p>
<div class="sourceCode" id="cb2159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2159-1" data-line-number="1">flip &lt;-<span class="st"> </span><span class="cf">function</span>() <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">&quot;T&quot;</span>, <span class="st">&quot;H&quot;</span>), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2159-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2159-3" data-line-number="3">flips &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb2159-4" data-line-number="4">nheads &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb2159-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2159-6" data-line-number="6"><span class="cf">while</span> (nheads <span class="op">&lt;</span><span class="st"> </span><span class="dv">3</span>) {</a>
<a class="sourceLine" id="cb2159-7" data-line-number="7">  <span class="cf">if</span> (<span class="kw">flip</span>() <span class="op">==</span><span class="st"> &quot;H&quot;</span>) {</a>
<a class="sourceLine" id="cb2159-8" data-line-number="8">    nheads &lt;-<span class="st"> </span>nheads <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2159-9" data-line-number="9">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb2159-10" data-line-number="10">    nheads &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb2159-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb2159-12" data-line-number="12">  flips &lt;-<span class="st"> </span>flips <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2159-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb2159-14" data-line-number="14">flips</a></code></pre></div>
<pre><code>## [1] 21</code></pre>
</div>
<div id="-21.3.5.1" class="section level4">
<h4><span class="header-section-number">4.6.3.5</span> Упражнение 21.3.5.1</h4>
<div class="question">
<p>Imagine you have a directory full of CSV files that you want to read in. You have their paths in a vector, <code>files &lt;- dir(&quot;data/&quot;, pattern = &quot;\\.csv$&quot;, full.names = TRUE)</code>, and now want to read each one with <code>read_csv()</code>. Write the for loop that will load them into a single data frame.</p>
</div>
<p>Сначала я предварительно распределяю список.
Затем я считываю каждый файл во фрейм данных и назначаю его элементу в этом списке.
Результатом является список фреймов данных.
Затем я использую <code>bind_rows()</code>, чтобы объединить список фреймов данных в один фрейм данных.</p>
<div class="sourceCode" id="cb2161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2161-1" data-line-number="1">files &lt;-<span class="st"> </span><span class="kw">dir</span>(<span class="st">&quot;data/&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.csv$&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2161-2" data-line-number="2">df &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(files))</a>
<a class="sourceLine" id="cb2161-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(files)) {</a>
<a class="sourceLine" id="cb2161-4" data-line-number="4">  df[[i]] &lt;-<span class="st"> </span><span class="kw">read_csv</span>(files[[i]])</a>
<a class="sourceLine" id="cb2161-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb2161-6" data-line-number="6">df &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(df)</a></code></pre></div>
</div>
<div id="-21.3.5.3" class="section level4">
<h4><span class="header-section-number">4.6.3.6</span> Упражнение 21.3.5.3</h4>
<div class="question">
<p>What happens if you use <code>for (nm in names(x))</code> and <code>x</code> has no names?
What if only some of the elements are named?
What if the names are not unique?</p>
</div>
<ol style="list-style-type: decimal">
<li>не содержит имён</li>
</ol>
<div class="sourceCode" id="cb2162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2162-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb2162-2" data-line-number="2"><span class="kw">print</span>(<span class="kw">names</span>(x))</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb2164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2164-1" data-line-number="1"><span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(x)) {</a>
<a class="sourceLine" id="cb2164-2" data-line-number="2">  <span class="kw">print</span>(nm)</a>
<a class="sourceLine" id="cb2164-3" data-line-number="3">  <span class="kw">print</span>(x[[nm]])</a>
<a class="sourceLine" id="cb2164-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2164-5" data-line-number="5"><span class="co"># То есть ничего не произошло. Потому что нет имён</span></a>
<a class="sourceLine" id="cb2164-6" data-line-number="6"><span class="co"># Стоит помнить что</span></a>
<a class="sourceLine" id="cb2164-7" data-line-number="7"><span class="kw">length</span>(<span class="ot">NULL</span>)</a></code></pre></div>
<pre><code>## [1] 0</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Некоторые элементы содержат имена. Тогда генерируется ошибка</li>
</ol>
<div class="sourceCode" id="cb2166"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2166-1" data-line-number="1"><span class="co"># x &lt;- c(a = 1, 2, c = 3)</span></a>
<a class="sourceLine" id="cb2166-2" data-line-number="2"><span class="co">#names(x)</span></a>
<a class="sourceLine" id="cb2166-3" data-line-number="3"><span class="co">#</span></a>
<a class="sourceLine" id="cb2166-4" data-line-number="4"><span class="co">#for (nm in names(x)) {</span></a>
<a class="sourceLine" id="cb2166-5" data-line-number="5"><span class="co">#  print(nm)</span></a>
<a class="sourceLine" id="cb2166-6" data-line-number="6"><span class="co">#  print(x[[nm]])</span></a>
<a class="sourceLine" id="cb2166-7" data-line-number="7"><span class="co">#}</span></a></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Есть неуникальные имена. Так как есть неуникальные имена, нет возможности обратиться доступ к элементам с повторяющимися именами</li>
</ol>
<div class="sourceCode" id="cb2167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2167-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb2167-2" data-line-number="2"><span class="kw">names</span>(x)</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;a&quot; &quot;c&quot;</code></pre>
<div class="sourceCode" id="cb2169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2169-1" data-line-number="1"><span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(x)) {</a>
<a class="sourceLine" id="cb2169-2" data-line-number="2">  <span class="kw">print</span>(nm)</a>
<a class="sourceLine" id="cb2169-3" data-line-number="3">  <span class="kw">print</span>(x[[nm]])</a>
<a class="sourceLine" id="cb2169-4" data-line-number="4">}</a></code></pre></div>
<pre><code>## [1] &quot;a&quot;
## [1] 1
## [1] &quot;a&quot;
## [1] 1
## [1] &quot;c&quot;
## [1] 3</code></pre>
</div>
<div id="-21.3.5.3-1" class="section level4">
<h4><span class="header-section-number">4.6.3.7</span> Упражнение 21.3.5.3</h4>
<div class="question">
<p>Write a function that prints the mean of each numeric column in a data frame, along with its name. For example, show_mean(iris) would print:</p>
<div class="sourceCode" id="cb2171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2171-1" data-line-number="1"><span class="co">#show_mean(iris)</span></a>
<a class="sourceLine" id="cb2171-2" data-line-number="2"><span class="co"># &gt; Sepal.Length: 5.84</span></a>
<a class="sourceLine" id="cb2171-3" data-line-number="3"><span class="co"># &gt; Sepal.Width:  3.06</span></a>
<a class="sourceLine" id="cb2171-4" data-line-number="4"><span class="co"># &gt; Petal.Length: 3.76</span></a>
<a class="sourceLine" id="cb2171-5" data-line-number="5"><span class="co"># &gt; Petal.Width:  1.20</span></a></code></pre></div>
<p>Extra challenge: what function did I use to make sure that the numbers lined up nicely, even though the variable names had different lengths?</p>
</div>
<div class="sourceCode" id="cb2172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2172-1" data-line-number="1">show_mean &lt;-<span class="st"> </span><span class="cf">function</span>(df, <span class="dt">digits =</span> <span class="dv">2</span>) {</a>
<a class="sourceLine" id="cb2172-2" data-line-number="2">  <span class="co"># Получаем максимальную длину названия столбца</span></a>
<a class="sourceLine" id="cb2172-3" data-line-number="3">  maxstr &lt;-<span class="st"> </span><span class="kw">max</span>(<span class="kw">str_length</span>(<span class="kw">names</span>(df)))</a>
<a class="sourceLine" id="cb2172-4" data-line-number="4">  <span class="cf">for</span> (nm <span class="cf">in</span> <span class="kw">names</span>(df)) {</a>
<a class="sourceLine" id="cb2172-5" data-line-number="5">    <span class="co"># Задаём условие --- считаем среднее только для числовых столбцов</span></a>
<a class="sourceLine" id="cb2172-6" data-line-number="6">    <span class="cf">if</span> (<span class="kw">is.numeric</span>(df[[nm]])) {</a>
<a class="sourceLine" id="cb2172-7" data-line-number="7">      <span class="co"># Объединяем в красивый вывод</span></a>
<a class="sourceLine" id="cb2172-8" data-line-number="8">      <span class="kw">cat</span>(</a>
<a class="sourceLine" id="cb2172-9" data-line-number="9">        <span class="kw">str_c</span>(<span class="kw">str_pad</span>(<span class="kw">str_c</span>(nm, <span class="st">&quot;:&quot;</span>), maxstr <span class="op">+</span><span class="st"> </span>1L, <span class="dt">side =</span> <span class="st">&quot;right&quot;</span>),</a>
<a class="sourceLine" id="cb2172-10" data-line-number="10">          <span class="kw">format</span>(<span class="kw">mean</span>(df[[nm]]), <span class="dt">digits =</span> digits, <span class="dt">nsmall =</span> digits),</a>
<a class="sourceLine" id="cb2172-11" data-line-number="11">          <span class="dt">sep =</span> <span class="st">&quot; &quot;</span></a>
<a class="sourceLine" id="cb2172-12" data-line-number="12">        ),</a>
<a class="sourceLine" id="cb2172-13" data-line-number="13">        <span class="co"># Выносим каждый вывод функции в отдельную строку</span></a>
<a class="sourceLine" id="cb2172-14" data-line-number="14">        <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb2172-15" data-line-number="15">      )</a>
<a class="sourceLine" id="cb2172-16" data-line-number="16">    }</a>
<a class="sourceLine" id="cb2172-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb2172-18" data-line-number="18">}</a>
<a class="sourceLine" id="cb2172-19" data-line-number="19"><span class="kw">show_mean</span>(iris)</a></code></pre></div>
<pre><code>## Sepal.Length: 5.84 
## Sepal.Width:  3.06 
## Petal.Length: 3.76 
## Petal.Width:  1.20</code></pre>
<div class="sourceCode" id="cb2174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2174-1" data-line-number="1"><span class="kw">show_mean</span>(df)</a></code></pre></div>
<pre><code>## Warning in max(str_length(names(df))): у &#39;max&#39; нет не пропущенных
## аргументов; возвращаю -Inf</code></pre>
</div>
<div id="-21.3.5.4" class="section level4">
<h4><span class="header-section-number">4.6.3.8</span> Упражнение 21.3.5.4</h4>
<div class="question">
<p>What does this code do? How does it work?</p>
</div>
<div class="sourceCode" id="cb2176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2176-1" data-line-number="1">trans &lt;-<span class="st"> </span><span class="kw">list</span>( </a>
<a class="sourceLine" id="cb2176-2" data-line-number="2">  <span class="dt">disp =</span> <span class="cf">function</span>(x) x <span class="op">*</span><span class="st"> </span><span class="fl">0.0163871</span>,            <span class="co"># Эта функция умножает х на константу</span></a>
<a class="sourceLine" id="cb2176-3" data-line-number="3">  <span class="dt">am =</span> <span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb2176-4" data-line-number="4">    <span class="kw">factor</span>(x, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;auto&quot;</span>, <span class="st">&quot;manual&quot;</span>))    <span class="co"># Эта функция делает из переменной фактор, с понятными названиями уровней</span></a>
<a class="sourceLine" id="cb2176-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb2176-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2176-7" data-line-number="7"><span class="cf">for</span> (var <span class="cf">in</span> <span class="kw">names</span>(trans)) {</a>
<a class="sourceLine" id="cb2176-8" data-line-number="8">  mtcars[[var]] &lt;-<span class="st"> </span>trans[[var]](mtcars[[var]]) <span class="co"># Теперь мы заменяем в исходном фрейме данных две переменные на видоизменённые</span></a>
<a class="sourceLine" id="cb2176-9" data-line-number="9">}</a></code></pre></div>
<p>Код работает зацикливанием на именованный список функций.
Он вызывает именованную функцию в списке столбца <code>mtcars</code> с тем же именем и заменяет значения этого столбца.</p>
<p>Это функция.</p>
<p><code>trans[[&quot;disp&quot;]]</code></p>
<p>Это применяет функцию к столбцу <code>mtcars</code> с тем же именем</p>
<p><code>trans[[&quot;disp&quot;]](mtcars[[&quot;disp&quot;]])</code></p>
</div>
</div>
<div id="-for--" class="section level3">
<h3><span class="header-section-number">4.6.4</span> Циклы <code>for</code> и функционалы</h3>
<p>Есть мощная штука — выносить функции в функции. Пример</p>
<div class="sourceCode" id="cb2177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2177-1" data-line-number="1">col_summary &lt;-<span class="st"> </span><span class="cf">function</span>(df, fun) {</a>
<a class="sourceLine" id="cb2177-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))</a>
<a class="sourceLine" id="cb2177-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb2177-4" data-line-number="4">    out[[i]] &lt;-<span class="st"> </span><span class="kw">fun</span>(df[[i]])</a>
<a class="sourceLine" id="cb2177-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb2177-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb2177-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb2177-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2177-9" data-line-number="9"><span class="kw">col_summary</span>(df, mean)</a></code></pre></div>
<pre><code>## numeric(0)</code></pre>
<div class="sourceCode" id="cb2179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2179-1" data-line-number="1"><span class="kw">col_summary</span>(df, sd)</a></code></pre></div>
<pre><code>## numeric(0)</code></pre>
<div class="sourceCode" id="cb2181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2181-1" data-line-number="1"><span class="kw">col_summary</span>(df, median)</a></code></pre></div>
<pre><code>## numeric(0)</code></pre>
<div id="-21.3.6.1" class="section level4">
<h4><span class="header-section-number">4.6.4.1</span> Упражнение 21.3.6.1</h4>
<div class="question">
<p>Read the documentation for <code>apply()</code>.
In the 2nd case, what two for-loops does it generalize.</p>
</div>
<p>С функциями этого семейства мы уже знакомы</p>
<p>Для объекта с двумя измерениями, такого как матрица или фрейм данных, метод <code>apply()</code> заменяет зацикливание строк или столбцов матрицы или фрейма данных. Функция <code>apply()</code> используется аналогично <code>apply(X, MARGIN, FUN, ...)</code>, где <code>X</code> - это матрица или массив, <code>FUN</code> - это функция, которую нужно применить, и <code>...</code> дополнительные аргументы, передаваемые в <code>FUN</code>.</p>
<p>Когда <code>MARGIN = 1</code>, функция применяется к каждой строке. Например, в следующем примере вычисляется среднее значение строки матрицы.</p>
<div class="sourceCode" id="cb2183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2183-1" data-line-number="1">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">15</span>), <span class="dt">nrow =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2183-2" data-line-number="2"><span class="kw">apply</span>(X, <span class="dv">1</span>, mean)</a></code></pre></div>
<pre><code>## [1] -0.5174705  0.1946778  0.1802687  0.6461280 -0.1264977</code></pre>
<p>Это эквивалентно циклу:</p>
<div class="sourceCode" id="cb2185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2185-1" data-line-number="1">X_row_means &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dt">length =</span> <span class="kw">nrow</span>(X))</a>
<a class="sourceLine" id="cb2185-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">nrow</span>(X))) {</a>
<a class="sourceLine" id="cb2185-3" data-line-number="3">  X_row_means[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(X[i, ])</a>
<a class="sourceLine" id="cb2185-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2185-5" data-line-number="5">X_row_means</a></code></pre></div>
<pre><code>## [1] -0.5174705  0.1946778  0.1802687  0.6461280 -0.1264977</code></pre>
<p>Когда <code>MARGIN = 2</code>, <code>apply()</code> эквивалентно циклу <code>for</code> для столбцов.</p>
<div class="sourceCode" id="cb2187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2187-1" data-line-number="1">X &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">15</span>), <span class="dt">nrow =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2187-2" data-line-number="2">X</a></code></pre></div>
<pre><code>##            [,1]       [,2]       [,3]
## [1,]  0.5711768  0.5269752 -1.2789948
## [2,]  0.3093178  0.3083229 -0.3388911
## [3,] -0.7719007  0.5929228 -0.7478341
## [4,] -1.1811703 -1.1799401 -0.5688712
## [5,]  0.1293323 -0.3760643  0.7096096</code></pre>
<div class="sourceCode" id="cb2189"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2189-1" data-line-number="1"><span class="kw">apply</span>(X, <span class="dv">2</span>, mean)</a></code></pre></div>
<pre><code>## [1] -0.1886488 -0.0255567 -0.4449963</code></pre>
<div class="sourceCode" id="cb2191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2191-1" data-line-number="1">X_col_means &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;numeric&quot;</span>, <span class="dt">length =</span> <span class="kw">ncol</span>(X))</a>
<a class="sourceLine" id="cb2191-2" data-line-number="2"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_len</span>(<span class="kw">ncol</span>(X))) {</a>
<a class="sourceLine" id="cb2191-3" data-line-number="3">  X_col_means[[i]] &lt;-<span class="st"> </span><span class="kw">mean</span>(X[i, ])</a>
<a class="sourceLine" id="cb2191-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2191-5" data-line-number="5">X_col_means</a></code></pre></div>
<pre><code>## [1] -0.06028095  0.09291653 -0.30893732</code></pre>
</div>
<div id="-21.3.6.1-1" class="section level4">
<h4><span class="header-section-number">4.6.4.2</span> Упражнение 21.3.6.1</h4>
<div class="question">
<p>Adapt <code>col_summary()</code> so that it only applies to numeric columns. You might want to start with an <code>is_numeric()</code> function that returns a logical vector that has a <code>TRUE</code> corresponding to each numeric column.</p>
</div>
<p>Напомню функцию</p>
<div class="sourceCode" id="cb2193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2193-1" data-line-number="1">col_summary &lt;-<span class="st"> </span><span class="cf">function</span>(df, fun) {</a>
<a class="sourceLine" id="cb2193-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, <span class="kw">length</span>(df))</a>
<a class="sourceLine" id="cb2193-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb2193-4" data-line-number="4">    out[i] &lt;-<span class="st"> </span><span class="kw">fun</span>(df[[i]])</a>
<a class="sourceLine" id="cb2193-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb2193-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb2193-7" data-line-number="7">}</a></code></pre></div>
<p>Теперь переделаем</p>
<div class="sourceCode" id="cb2194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2194-1" data-line-number="1">col_summary2 &lt;-<span class="st"> </span><span class="cf">function</span>(df, fun) {</a>
<a class="sourceLine" id="cb2194-2" data-line-number="2">  <span class="co"># создаём пустой вектор, который будет хранить каждый числовой столбец</span></a>
<a class="sourceLine" id="cb2194-3" data-line-number="3">  numeric_cols &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;logical&quot;</span>, <span class="kw">length</span>(df))</a>
<a class="sourceLine" id="cb2194-4" data-line-number="4">  <span class="co"># проверяем, является ли каждый столбец числовым</span></a>
<a class="sourceLine" id="cb2194-5" data-line-number="5">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(df)) {</a>
<a class="sourceLine" id="cb2194-6" data-line-number="6">    numeric_cols[[i]] &lt;-<span class="st"> </span><span class="kw">is.numeric</span>(df[[i]])</a>
<a class="sourceLine" id="cb2194-7" data-line-number="7">  }</a>
<a class="sourceLine" id="cb2194-8" data-line-number="8">  <span class="co"># находим индексы числовых столбцов</span></a>
<a class="sourceLine" id="cb2194-9" data-line-number="9">  idxs &lt;-<span class="st"> </span><span class="kw">which</span>(numeric_cols)</a>
<a class="sourceLine" id="cb2194-10" data-line-number="10">  <span class="co"># находим количество числовых столбцов</span></a>
<a class="sourceLine" id="cb2194-11" data-line-number="11">  n &lt;-<span class="st"> </span><span class="kw">sum</span>(numeric_cols)</a>
<a class="sourceLine" id="cb2194-12" data-line-number="12">  <span class="co"># создаем вектор для хранения результатов</span></a>
<a class="sourceLine" id="cb2194-13" data-line-number="13">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;double&quot;</span>, n)</a>
<a class="sourceLine" id="cb2194-14" data-line-number="14">  <span class="co"># применять функцию только к числовым векторам</span></a>
<a class="sourceLine" id="cb2194-15" data-line-number="15">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(idxs)) {</a>
<a class="sourceLine" id="cb2194-16" data-line-number="16">    out[[i]] &lt;-<span class="st"> </span><span class="kw">fun</span>(df[[idxs[[i]]]])</a>
<a class="sourceLine" id="cb2194-17" data-line-number="17">  }</a>
<a class="sourceLine" id="cb2194-18" data-line-number="18">  <span class="co"># даём имена векторам</span></a>
<a class="sourceLine" id="cb2194-19" data-line-number="19">  <span class="kw">names</span>(out) &lt;-<span class="st"> </span><span class="kw">names</span>(df)[idxs]</a>
<a class="sourceLine" id="cb2194-20" data-line-number="20">  out</a>
<a class="sourceLine" id="cb2194-21" data-line-number="21">}</a>
<a class="sourceLine" id="cb2194-22" data-line-number="22"></a>
<a class="sourceLine" id="cb2194-23" data-line-number="23">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2194-24" data-line-number="24">  <span class="dt">X1 =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb2194-25" data-line-number="25">  <span class="dt">X2 =</span> <span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>),</a>
<a class="sourceLine" id="cb2194-26" data-line-number="26">  <span class="dt">X3 =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">-1</span>, <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb2194-27" data-line-number="27">  <span class="dt">X4 =</span> <span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2194-28" data-line-number="28">)</a>
<a class="sourceLine" id="cb2194-29" data-line-number="29">df</a></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##      X1 X2       X3 X4   
##   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;lgl&gt;
## 1     1 A         0 TRUE 
## 2     2 B        -1 FALSE
## 3     3 C         5 TRUE</code></pre>
<div class="sourceCode" id="cb2196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2196-1" data-line-number="1"><span class="kw">col_summary2</span>(df, mean)</a></code></pre></div>
<pre><code>##       X1       X3 
## 2.000000 1.333333</code></pre>
</div>
</div>
<div id="--map" class="section level3">
<h3><span class="header-section-number">4.6.5</span> Функции семейства <code>map</code></h3>
<p>Конечно не стоит отказываться от циклов совсем — главное решить задачу. А уж потом работать над тем, как бы ускорить работу, или сделать код более удобочитаемым.</p>
<p>Для повышения удобочитаемости в пакете <code>purrr</code> есть семейство функций <code>map</code>, которые создают</p>
<ul>
<li><p><code>map()</code> — list.</p></li>
<li><p><code>map_lgl()</code> — logical vector.</p></li>
<li><p><code>map_int()</code> — integer vector.</p></li>
<li><p><code>map_dbl()</code> — double vector.</p></li>
<li><p><code>map_chr()</code> — character vector.</p></li>
</ul>
<p>вот например как они работают</p>
<div class="sourceCode" id="cb2198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2198-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2198-2" data-line-number="2">  <span class="dt">a =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2198-3" data-line-number="3">  <span class="dt">b =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2198-4" data-line-number="4">  <span class="dt">c =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2198-5" data-line-number="5">  <span class="dt">d =</span> <span class="kw">rnorm</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2198-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2198-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2198-8" data-line-number="8"><span class="kw">map_dbl</span>(df, mean)</a></code></pre></div>
<pre><code>##           a           b           c           d 
## -0.02984852 -0.37831923  0.22302942 -0.84712665</code></pre>
<div class="sourceCode" id="cb2200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2200-1" data-line-number="1"><span class="kw">map_dbl</span>(df, median)</a></code></pre></div>
<pre><code>##           a           b           c           d 
## -0.06305706 -0.25525316  0.19467366 -0.88898784</code></pre>
<div class="sourceCode" id="cb2202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2202-1" data-line-number="1"><span class="co"># map_dbl(df, sd)</span></a></code></pre></div>
<p>Это семейство помогает сфокусироваться на выполнении операции, а не на вспомогатеольных действиях по обслуживанию цикла и сохранению результата. Это ещё более понятно при использовании каналов-конвееров <code>%&gt;%</code></p>
<div class="sourceCode" id="cb2203"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2203-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(mean)</a></code></pre></div>
<pre><code>##           a           b           c           d 
## -0.02984852 -0.37831923  0.22302942 -0.84712665</code></pre>
<div class="sourceCode" id="cb2205"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2205-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(median)</a></code></pre></div>
<pre><code>##           a           b           c           d 
## -0.06305706 -0.25525316  0.19467366 -0.88898784</code></pre>
<div class="sourceCode" id="cb2207"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2207-1" data-line-number="1"><span class="co"># df %&gt;% map_dbl(sd)</span></a></code></pre></div>
<p>Что нужно о них знать</p>
<ol style="list-style-type: decimal">
<li><p>Реализованы на языке С</p></li>
<li><p>Второй аргумент <code>.f</code> может быть функцией, формулой, символьным или целочисленным значением</p></li>
<li><p>Для передачи особых настроек есть аргумент многоточие <code>...</code></p></li>
<li><p>Они отображают имена</p></li>
</ol>
<div class="sourceCode" id="cb2208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2208-1" data-line-number="1">z &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">y =</span> <span class="dv">4</span><span class="op">:</span><span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2208-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2208-3" data-line-number="3"><span class="kw">map_int</span>(z, length)</a></code></pre></div>
<pre><code>## x y 
## 3 2</code></pre>
<div class="section level4">
<h4><span class="header-section-number">4.6.5.1</span> Сокращения</h4>
<p>Ниже представлен пример, разбивающий набор данных на три части, и применяющий одну и ту же модель к каждой из них</p>
<div class="sourceCode" id="cb2210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2210-1" data-line-number="1">models &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2210-2" data-line-number="2"><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2210-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(<span class="cf">function</span>(df) <span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> df))</a>
<a class="sourceLine" id="cb2210-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2210-5" data-line-number="5"><span class="co"># еще короче</span></a>
<a class="sourceLine" id="cb2210-6" data-line-number="6">models &lt;-<span class="st"> </span>mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2210-7" data-line-number="7"><span class="st">  </span><span class="kw">split</span>(.<span class="op">$</span>cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2210-8" data-line-number="8"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .))</a></code></pre></div>
<p>Но самый топчик, это извлечение именнованных компонентов</p>
<div class="sourceCode" id="cb2211"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2211-1" data-line-number="1">models <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2211-2" data-line-number="2"><span class="st">  </span><span class="kw">map</span>(summary) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2211-3" data-line-number="3"><span class="st">  </span><span class="kw">map_dbl</span>(<span class="op">~</span>.<span class="op">$</span>r.squared)</a>
<a class="sourceLine" id="cb2211-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2211-5" data-line-number="5"><span class="co"># еще короче</span></a>
<a class="sourceLine" id="cb2211-6" data-line-number="6">models <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2211-7" data-line-number="7"><span class="st">  </span><span class="kw">map</span>(summary) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2211-8" data-line-number="8"><span class="st">  </span><span class="kw">map_dbl</span>(<span class="st">&quot;r.squared&quot;</span>)</a></code></pre></div>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.6.5.2</span> Базовые возможности</h4>
<p>Они есть, их можно будет поискать. Но пока не придумал зачем, если есть более понятные и простые альтернативы</p>
</div>
<div id="-21.5.3.1" class="section level4">
<h4><span class="header-section-number">4.6.5.3</span> Упражнение 21.5.3.1</h4>
<div class="question">
<p>Write code that uses one of the map functions to:</p>
<ol style="list-style-type: decimal">
<li><p>Compute the mean of every column in mtcars.</p></li>
<li><p>Determine the type of each column in nycflights13::flights.</p></li>
<li><p>Compute the number of unique values in each column of iris.</p></li>
<li>Generate 10 random normals for each of <span class="math inline">\(\mu = -10, 0, 10, 100\)</span></li>
</ol>
</div>
<ol style="list-style-type: decimal">
<li>Это проще простого</li>
</ol>
<div class="sourceCode" id="cb2212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2212-1" data-line-number="1"><span class="kw">map_dbl</span>(mtcars, mean)</a></code></pre></div>
<pre><code>## Warning in mean.default(.x[[i]], ...): argument is not numeric or logical:
## returning NA</code></pre>
<pre><code>##        mpg        cyl       disp         hp       drat         wt 
##  20.090625  24.750000   3.780862 146.687500   3.596563   3.217250 
##       qsec         vs         am       gear       carb 
##  17.848750   0.437500         NA   3.687500   2.812500</code></pre>
<p>Проверим:</p>
<div class="sourceCode" id="cb2215"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2215-1" data-line-number="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2215-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_mpg =</span> <span class="kw">mean</span>(.<span class="op">$</span>mpg))</a></code></pre></div>
<pre><code>##   mean_mpg
## 1 20.09062</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Тип данных вектора</li>
</ol>
<div class="sourceCode" id="cb2217"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2217-1" data-line-number="1"><span class="kw">map_chr</span>(nycflights13<span class="op">::</span>flights, typeof)</a></code></pre></div>
<pre><code>##           year          month            day       dep_time sched_dep_time 
##      &quot;integer&quot;      &quot;integer&quot;      &quot;integer&quot;      &quot;integer&quot;      &quot;integer&quot; 
##      dep_delay       arr_time sched_arr_time      arr_delay        carrier 
##       &quot;double&quot;      &quot;integer&quot;      &quot;integer&quot;       &quot;double&quot;    &quot;character&quot; 
##         flight        tailnum         origin           dest       air_time 
##      &quot;integer&quot;    &quot;character&quot;    &quot;character&quot;    &quot;character&quot;       &quot;double&quot; 
##       distance           hour         minute      time_hour 
##       &quot;double&quot;       &quot;double&quot;       &quot;double&quot;       &quot;double&quot;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Уникальные столбцы</li>
</ol>
<div class="sourceCode" id="cb2219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2219-1" data-line-number="1"><span class="co"># для начала посмотрим как это делается для одного столбца</span></a>
<a class="sourceLine" id="cb2219-2" data-line-number="2"><span class="kw">length</span>(<span class="kw">unique</span>(iris<span class="op">$</span>Species))</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
<div class="sourceCode" id="cb2221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2221-1" data-line-number="1"><span class="co"># Теперь встроим функцию в map</span></a>
<a class="sourceLine" id="cb2221-2" data-line-number="2"><span class="kw">map_int</span>(iris, <span class="cf">function</span>(x) <span class="kw">length</span>(<span class="kw">unique</span>(x)))</a></code></pre></div>
<pre><code>## Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species 
##           35           23           43           22            3</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Сгенерировать случайные значения</li>
</ol>
<div class="sourceCode" id="cb2223"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2223-1" data-line-number="1">mu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">0</span>, <span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2223-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2223-3" data-line-number="3"><span class="co"># Если нужен список, то можно просто вот так</span></a>
<a class="sourceLine" id="cb2223-4" data-line-number="4"><span class="kw">map</span>(mu, <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">mean =</span> .))</a>
<a class="sourceLine" id="cb2223-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2223-6" data-line-number="6"><span class="co"># Но можно завернуть в красивую матрицу</span></a>
<a class="sourceLine" id="cb2223-7" data-line-number="7"><span class="kw">matrix</span>(<span class="kw">unlist</span>(</a>
<a class="sourceLine" id="cb2223-8" data-line-number="8">  <span class="kw">map</span>(mu, <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">mean =</span> .))</a>
<a class="sourceLine" id="cb2223-9" data-line-number="9">  ), </a>
<a class="sourceLine" id="cb2223-10" data-line-number="10">       <span class="dt">ncol =</span> <span class="dv">10</span>, </a>
<a class="sourceLine" id="cb2223-11" data-line-number="11">       <span class="dt">byrow =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb2223-12" data-line-number="12">       <span class="dt">dimnames =</span> <span class="kw">list</span>(mu, <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>))</a></code></pre></div>
</div>
<div id="-21.5.3.2" class="section level4">
<h4><span class="header-section-number">4.6.5.4</span> Упражнение 21.5.3.2</h4>
<div class="question">
<p>How can you create a single vector that for each column in a data frame indicates whether or not it’s a factor?</p>
</div>
<p>Несколько упражнений назад, мы преобразовали во фрейме данных <code>mtcars</code> один из параметров в фактор</p>
<div class="sourceCode" id="cb2224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2224-1" data-line-number="1"><span class="kw">is.factor</span>(mtcars<span class="op">$</span>am)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Теперь применим знания о <code>map</code>, собственно это и будет решением</p>
<div class="sourceCode" id="cb2226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2226-1" data-line-number="1"><span class="kw">map_lgl</span>(mtcars, is.factor)</a></code></pre></div>
<pre><code>##   mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb 
## FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE</code></pre>
</div>
<div id="-21.5.3.3" class="section level4">
<h4><span class="header-section-number">4.6.5.5</span> Упражнение 21.5.3.3</h4>
<div class="question">
<p>What happens when you use the map functions on vectors that aren’t lists?
What does <code>map(1:5, runif)</code> do?
Why?</p>
</div>
<p>Функции <code>map</code> работают с любыми векторами, а не только со списками.
Как и в случае списков, функции <code>map</code> будут применять функцию к каждому элементу вектора.
В следующих примерах входные данные для <code>map</code> представляют собой атомарные векторы (логические, символьные, числовые).</p>
<div class="sourceCode" id="cb2228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2228-1" data-line-number="1"><span class="kw">map</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>), <span class="op">~</span><span class="st"> </span><span class="op">!</span>.)</a>
<a class="sourceLine" id="cb2228-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2228-3" data-line-number="3"><span class="kw">map</span>(<span class="kw">c</span>(<span class="st">&quot;Hello&quot;</span>, <span class="st">&quot;World&quot;</span>), str_to_upper)</a>
<a class="sourceLine" id="cb2228-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2228-5" data-line-number="5"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(.))</a>
<a class="sourceLine" id="cb2228-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2228-7" data-line-number="7"><span class="kw">map</span>(<span class="kw">c</span>(<span class="op">-</span><span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="op">~</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dv">1</span>, <span class="dt">mean =</span> .))</a></code></pre></div>
<p>Важно помнить, что хотя входом <code>map()</code> может быть любой вектор, выводом всегда является список.</p>
<div class="sourceCode" id="cb2229"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2229-1" data-line-number="1"><span class="co"># map(1:5, runif) # runif создаёт случайное число указанное количество раз. По умолчанию между 0 и 1</span></a></code></pre></div>
<p>Функция <code>map()</code> перебирает числа от 1 до 5. Для каждого значения она вызывает <code>runif()</code> с этим номером в качестве первого аргумента, который является номером выборки для рисования. В результате получается список длиной пять с числовыми векторами размеров от одного до пяти, каждый со случайными выборками из равномерного распределения. Обращаю внимание, что хотя <code>input</code> для <code>map()</code> был целочисленным вектором, возвращаемое значение было списком.</p>
</div>
<div id="-21.5.3.4" class="section level4">
<h4><span class="header-section-number">4.6.5.6</span> Упражнение 21.5.3.4</h4>
<div class="question">
<p>What does <code>map(-2:2, rnorm, n = 5)</code> do? Why?</p>
<p>What does <code>map_dbl(-2:2, rnorm, n = 5)</code> do? Why?</p>
</div>
<p>Не очень понятно, при заданных параметрах, что за что отвечает, потому что <code>n = 5</code> и количество значений от -2 до 2 = 5.</p>
<div class="sourceCode" id="cb2230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2230-1" data-line-number="1"> <span class="kw">map</span>(<span class="op">-</span><span class="dv">2</span><span class="op">:</span><span class="dv">2</span>, rnorm, <span class="dt">n =</span> <span class="dv">10</span>)</a></code></pre></div>
<p><code>n</code> — это передаваемый через <code>...</code> параметр <code>rnorm</code>, который отвечает за количество наблюдений.</p>
<p><code>-2:2</code> — определяет среднее вокруг которого будет считаться <code>rnorm</code>.</p>
<p>Исходное выражение берет выборки размера пять из пяти нормальных распределений со средними значениями (-2, -1, 0, 1 и 2), но с тем же стандартным отклонением (1). Возвращает список с каждым элементом числовые векторы длиной 5.</p>
<p>Однако, если вместо этого мы используем <code>map_dbl()</code>, выражение вызывает ошибку.</p>
<p>Это потому, что функция <code>map_dbl()</code> требует, чтобы функция, которую она применяет к каждому элементу, возвращала числовой вектор длины один. Если функция возвращает не числовой вектор или числовой вектор длиной более единицы, <code>map_dbl()</code> вызовет ошибку. Причиной такой строгости является то, что <code>map_dbl()</code> гарантирует, что он вернет числовой вектор такой же длины, что и его входной вектор.</p>
<p>Эта концепция применяется к другим функциям <code>map_*()</code>:</p>
<ul>
<li><p><code>map_chr()</code> требует, чтобы функция всегда возвращала символьный вектор длины один;</p></li>
<li><p><code>map_int()</code> требует, чтобы функция всегда возвращала целочисленный вектор длины один;</p></li>
<li><p><code>map_lglg()</code> требует, чтобы функция всегда возвращала логический вектор длины один.</p></li>
<li><p>Используйте функцию <code>map()</code>, если функция будет возвращать значения различных типов или длин.</p></li>
</ul>
</div>
<div id="-21.5.3.5" class="section level4">
<h4><span class="header-section-number">4.6.5.7</span> Упражнение 21.5.3.5</h4>
<div class="question">
<p>Rewrite <code>map(x, function(df) lm(mpg ~ wt, data = df))</code> to eliminate the anonymous function.</p>
</div>
<div class="sourceCode" id="cb2231"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2231-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">split</span>(mtcars, mtcars<span class="op">$</span>cyl) <span class="co"># разделить набор данных на список по параметру cyl</span></a>
<a class="sourceLine" id="cb2231-2" data-line-number="2"><span class="kw">map</span>(x, <span class="cf">function</span>(df) <span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> df))</a>
<a class="sourceLine" id="cb2231-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2231-4" data-line-number="4"><span class="co"># Теперь применим синтаксис сокращения, и перепишем без анонимной функции</span></a>
<a class="sourceLine" id="cb2231-5" data-line-number="5"><span class="kw">map</span>(x, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(mpg <span class="op">~</span><span class="st"> </span>wt, <span class="dt">data =</span> .))</a></code></pre></div>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">4.6.6</span> Обработка ошибок</h3>
<p>Когда <code>map</code> завершается ошибкой, можно исправить ситуацию функцией <code>safely()</code>.</p>
<p>Она возвращает список из двух элементов</p>
<ul>
<li><p><code>result</code> — оригинальный результат. В случае ошибки будет <code>NULL</code></p></li>
<li><p><code>error</code> — объект ошибки. В случае успешного завершения операции будет <code>NULL</code></p></li>
</ul>
<div class="sourceCode" id="cb2232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2232-1" data-line-number="1"> safe_log &lt;-<span class="st"> </span><span class="kw">safely</span>(log)</a>
<a class="sourceLine" id="cb2232-2" data-line-number="2"> <span class="kw">str</span>(<span class="kw">safe_log</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb2232-3" data-line-number="3"> <span class="kw">str</span>(<span class="kw">safe_log</span>(<span class="st">&quot;a&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb2233"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2233-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="st">&quot;a&quot;</span>)</a>
<a class="sourceLine" id="cb2233-2" data-line-number="2">y &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="kw">safely</span>(log))</a>
<a class="sourceLine" id="cb2233-3" data-line-number="3"><span class="kw">str</span>(y)</a></code></pre></div>
<p>Можно получить два списка — один для всех ошибок, другой — для всех выходных результатов.</p>
<div class="sourceCode" id="cb2234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2234-1" data-line-number="1">y &lt;-<span class="st"> </span>y <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">transpose</span>()</a>
<a class="sourceLine" id="cb2234-2" data-line-number="2"><span class="kw">str</span>(y)</a></code></pre></div>
<p>Обработка ошибок полностью зависит от нас — в типичных случаях надо либо просматривать значения <code>x</code>, для которых <code>y</code> содержит ошибку, либо работать с нормальными <code>y</code></p>
<div class="sourceCode" id="cb2235"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2235-1" data-line-number="1">is_ok &lt;-<span class="st"> </span>y<span class="op">$</span>error <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_lgl</span>(is_null)</a>
<a class="sourceLine" id="cb2235-2" data-line-number="2">x[<span class="op">!</span>is_ok]</a>
<a class="sourceLine" id="cb2235-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2235-4" data-line-number="4"> y<span class="op">$</span>result[is_ok] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">flatten_dbl</span>()</a></code></pre></div>
<p>Есть ещё два полезных наречия</p>
<ul>
<li><code>possibily()</code>. С помощью неё можно указать, что будет в случае ошибки</li>
</ul>
<div class="sourceCode" id="cb2236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2236-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="st">&quot;a&quot;</span>)</a>
<a class="sourceLine" id="cb2236-2" data-line-number="2">x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map_dbl</span>(<span class="kw">possibly</span>(log, <span class="ot">NA_real_</span>))</a></code></pre></div>
<ul>
<li><code>quietly()</code> перехватывает выводимые результаты, сообщения, предупреждения</li>
</ul>
<div class="sourceCode" id="cb2237"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2237-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">-1</span>)</a>
<a class="sourceLine" id="cb2237-2" data-line-number="2">x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">map</span>(<span class="kw">quietly</span>(log)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
</div>
<div id="--map----" class="section level3">
<h3><span class="header-section-number">4.6.7</span> Функции семейства <code>map</code> с несоколькими входными переменными</h3>
<p>Если нужно выполнять итерации параллельно по нескольким входным перменным, то можно использовать <code>map2</code> и <code>pmap</code>.
Предположим, нужно имитировать нормальные распределения с разными средними значениями.</p>
<div class="sourceCode" id="cb2238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2238-1" data-line-number="1">mu &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">-3</span>)</a>
<a class="sourceLine" id="cb2238-2" data-line-number="2">mu <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2238-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(rnorm, <span class="dt">n =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2238-4" data-line-number="4"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<p>А если нужно варьировать ещё и стандартное отклонение?
Итерировать по индексам и индексировать вектора средних значений и стандартных отклонений</p>
<div class="sourceCode" id="cb2239"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2239-1" data-line-number="1">sigma &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2239-2" data-line-number="2"><span class="kw">seq_along</span>(mu) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2239-3" data-line-number="3"><span class="st">  </span><span class="kw">map</span>(<span class="op">~</span><span class="kw">rnorm</span>(<span class="dv">5</span>, mu[[.]], sigma[[.]])) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2239-4" data-line-number="4"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<p>Это затрудняет понимание кода. Вместо этого используем <code>map2</code> для итерирования по двум векторам</p>
<div class="sourceCode" id="cb2240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2240-1" data-line-number="1"><span class="kw">map2</span>(mu, sigma, rnorm, <span class="dt">n =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<p><code>map2</code> итерирует следующую последовательность вызовов функций</p>
<div class="figure">
<img src="img/iteration.png" alt="итерации" />
<p class="caption">итерации</p>
</div>
<p>Как и <code>map()</code> функция <code>map2()</code> это оболочка вокруг цикла <code>for</code></p>
<div class="sourceCode" id="cb2241"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2241-1" data-line-number="1">map2 &lt;-<span class="st"> </span><span class="cf">function</span>(x, y, f, ...) {</a>
<a class="sourceLine" id="cb2241-2" data-line-number="2">  out &lt;-<span class="st"> </span><span class="kw">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb2241-3" data-line-number="3">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x)) {</a>
<a class="sourceLine" id="cb2241-4" data-line-number="4">    out[[i]] &lt;-<span class="st"> </span><span class="kw">f</span>(x[[i]], y[[i]], ...)</a>
<a class="sourceLine" id="cb2241-5" data-line-number="5">  }</a>
<a class="sourceLine" id="cb2241-6" data-line-number="6">  out</a>
<a class="sourceLine" id="cb2241-7" data-line-number="7">}</a></code></pre></div>
<p>А теперь черёд <code>pmap</code> — она принимает список аргументов. Её можно испольховать если нужно например варьировать среднее значение, стандартное отклонение и количество выборок</p>
<div class="sourceCode" id="cb2242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2242-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2242-2" data-line-number="2">args1 &lt;-<span class="st"> </span><span class="kw">list</span>(n, mu, sigma)</a>
<a class="sourceLine" id="cb2242-3" data-line-number="3">args1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2242-4" data-line-number="4"><span class="st">  </span><span class="kw">pmap</span>(rnorm) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2242-5" data-line-number="5"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<p>Это выглядит примерно так</p>
<div class="figure">
<img src="img/iteration2.png" alt="итерации" />
<p class="caption">итерации</p>
</div>
<p>Если элементы не поименованы, функция будет использвать при выо=зове позиционное соответствие.
Это затрудняет чтение кода, так что лучше всё-таки именовать</p>
<div class="sourceCode" id="cb2243"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2243-1" data-line-number="1">args2 &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">mean =</span> mu, <span class="dt">sd =</span> sigma, <span class="dt">n =</span> n)</a>
<a class="sourceLine" id="cb2243-2" data-line-number="2">args2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2243-3" data-line-number="3"><span class="st">  </span><span class="kw">pmap</span>(rnorm) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2243-4" data-line-number="4"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<div class="figure">
<img src="img/iteration3.png" alt="итерации" />
<p class="caption">итерации</p>
</div>
<p>Можно работть и со фреймом данных — это вообще отвал башки</p>
<div class="sourceCode" id="cb2244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2244-1" data-line-number="1">params &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2244-2" data-line-number="2">  <span class="op">~</span>mean, <span class="op">~</span>sd, <span class="op">~</span>n,</a>
<a class="sourceLine" id="cb2244-3" data-line-number="3">    <span class="dv">5</span>,     <span class="dv">1</span>,  <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2244-4" data-line-number="4">   <span class="dv">10</span>,     <span class="dv">5</span>,  <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb2244-5" data-line-number="5">   <span class="dv">-3</span>,    <span class="dv">10</span>,  <span class="dv">5</span></a>
<a class="sourceLine" id="cb2244-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2244-7" data-line-number="7">params <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2244-8" data-line-number="8"><span class="st">  </span><span class="kw">pmap</span>(rnorm)</a></code></pre></div>
<pre><code>## [[1]]
## [1] 2.193683
## 
## [[2]]
## [1] 14.48231 10.80153  2.45742
## 
## [[3]]
## [1] -13.29221 -17.76962 -12.98508 -14.06308  25.39880</code></pre>
<p>Как только код усложняется, имеет смысл использовать фрейм данных.</p>
<div id="--" class="section level4">
<h4><span class="header-section-number">4.6.7.1</span> Вызов различных функций</h4>
<p>Можно варьировать саму функцию</p>
<div class="sourceCode" id="cb2246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2246-1" data-line-number="1">f &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;runif&quot;</span>, <span class="st">&quot;rnorm&quot;</span>, <span class="st">&quot;rpois&quot;</span>)</a>
<a class="sourceLine" id="cb2246-2" data-line-number="2">param &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2246-3" data-line-number="3">  <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">-1</span>, <span class="dt">max =</span> <span class="dv">1</span>), </a>
<a class="sourceLine" id="cb2246-4" data-line-number="4">  <span class="kw">list</span>(<span class="dt">sd =</span> <span class="dv">5</span>), </a>
<a class="sourceLine" id="cb2246-5" data-line-number="5">  <span class="kw">list</span>(<span class="dt">lambda =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2246-6" data-line-number="6">)</a></code></pre></div>
<p>Для обработки подобных случаев можно использовать <code>invoke_map()</code></p>
<div class="sourceCode" id="cb2247"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2247-1" data-line-number="1"><span class="kw">invoke_map</span>(f, param, <span class="dt">n =</span> <span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## List of 3
##  $ : num [1:5] 0.187 -0.28 -0.338 0.19 0.427
##  $ : num [1:5] -2.403 2.568 2.136 -0.561 -3.365
##  $ : int [1:5] 9 9 7 15 14</code></pre>
<p>Первый аргумент — список функций, или символьный вектор имён функций.</p>
<p>Второй аргумент — список списков, предоставляющий аргументы разные, для разных функций.</p>
<p>Последующие аргументы передаются всем функция.</p>
<p>И вновь, чтобы упростить, можно использовать <code>tribble()</code></p>
<div class="sourceCode" id="cb2249"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2249-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2249-2" data-line-number="2">  <span class="op">~</span>f,      <span class="op">~</span>params,</a>
<a class="sourceLine" id="cb2249-3" data-line-number="3">  <span class="st">&quot;runif&quot;</span>, <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">-1</span>, <span class="dt">max =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb2249-4" data-line-number="4">  <span class="st">&quot;rnorm&quot;</span>, <span class="kw">list</span>(<span class="dt">sd =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb2249-5" data-line-number="5">  <span class="st">&quot;rpois&quot;</span>, <span class="kw">list</span>(<span class="dt">lambda =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2249-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2249-7" data-line-number="7">sim <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2249-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sim =</span> <span class="kw">invoke_map</span>(f, params, <span class="dt">n =</span> <span class="dv">10</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   f     params     sim       
##   &lt;chr&gt; &lt;list&gt;     &lt;list&gt;    
## 1 runif &lt;list [2]&gt; &lt;dbl [10]&gt;
## 2 rnorm &lt;list [1]&gt; &lt;dbl [10]&gt;
## 3 rpois &lt;list [1]&gt; &lt;int [10]&gt;</code></pre>
<div class="figure">
<img src="img/iteration4.png" alt="итерации" />
<p class="caption">итерации</p>
</div>
</div>
</div>
<div id="--walk" class="section level3">
<h3><span class="header-section-number">4.6.8</span> Функции семейства <code>walk</code></h3>
<p>Функции семейства <code>walk</code> это альтернатива <code>map</code>.</p>
<p>Используется с целью получения побочных эффектов, например когда нужно отобразить вывод на экране или сохранить файлы на диск.</p>
<p>Посмотри <a href="https://r4ds.had.co.nz/iteration.html#exercises-58">здесь</a> чтобы вспомнить об этом побольше.</p>
</div>
<div id="---for" class="section level3">
<h3><span class="header-section-number">4.6.9</span> Другие шаблоны циклов <code>for</code></h3>
<p>Есть ещё ряд функций абстракций. Понадобятся, когда вдруг столкнусь с такой проблемой</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">4.6.9.1</span> Функции-предикаты</h4>
<p>Ряд функций работает с функциями-предикатами, которые возвращают одиночное значение <code>TRUE</code> или <code>FALSE</code>.</p>
<p>Функции <code>keep()</code> и <code>discard()</code> удерживают те элементы входного объекта, для которых предикатом является соответственно значени <code>TRUE</code> или <code>FALSE</code>.</p>
<div class="sourceCode" id="cb2251"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2251-1" data-line-number="1">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2251-2" data-line-number="2"><span class="st">  </span><span class="kw">keep</span>(is.factor) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2251-3" data-line-number="3"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  1 variable:
##  $ Species: Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<div class="sourceCode" id="cb2253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2253-1" data-line-number="1">iris <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2253-2" data-line-number="2"><span class="st">  </span><span class="kw">discard</span>(is.factor) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2253-3" data-line-number="3"><span class="st">  </span><span class="kw">str</span>()</a></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  4 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...</code></pre>
<p>Функции <code>some()</code> и <code>every()</code> определяют, являются ли предикат истинным для некоторых или для всех элементов</p>
<div class="sourceCode" id="cb2255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2255-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, letters, <span class="kw">list</span>(<span class="dv">10</span>))</a>
<a class="sourceLine" id="cb2255-2" data-line-number="2"><span class="kw">str</span>(x)</a></code></pre></div>
<pre><code>## List of 3
##  $ : int [1:5] 1 2 3 4 5
##  $ : chr [1:26] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; ...
##  $ :List of 1
##   ..$ : num 10</code></pre>
<div class="sourceCode" id="cb2257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2257-1" data-line-number="1">x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2257-2" data-line-number="2"><span class="st">  </span><span class="kw">some</span>(is_character)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2259-1" data-line-number="1">x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2259-2" data-line-number="2"><span class="st">  </span><span class="kw">every</span>(is_character)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>функция <code>detect()</code> находит первый элемент с истинным предикатом, а функция <code>detect_index()</code> возвращает позицию этого элемента</p>
<div class="sourceCode" id="cb2261"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2261-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2261-2" data-line-number="2">x</a></code></pre></div>
<pre><code>##  [1]  1  5  2 10  4  8  7  9  3  6</code></pre>
<div class="sourceCode" id="cb2263"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2263-1" data-line-number="1">x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2263-2" data-line-number="2"><span class="st">  </span><span class="kw">detect</span>(<span class="op">~</span><span class="st"> </span>. <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 10</code></pre>
<div class="sourceCode" id="cb2265"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2265-1" data-line-number="1">x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2265-2" data-line-number="2"><span class="st">  </span><span class="kw">detect_index</span>(<span class="op">~</span><span class="st"> </span>. <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 4</code></pre>
<p>Функции <code>head_while()</code> и <code>tail_while()</code> принимают элементы с начала или с конца вектора, до тех пор, пока предикат имеет истинное значение</p>
<div class="sourceCode" id="cb2267"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2267-1" data-line-number="1">x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2267-2" data-line-number="2"><span class="st">  </span><span class="kw">head_while</span>(<span class="op">~</span><span class="st"> </span>. <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## integer(0)</code></pre>
<div class="sourceCode" id="cb2269"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2269-1" data-line-number="1">x <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2269-2" data-line-number="2"><span class="st">  </span><span class="kw">tail_while</span>(<span class="op">~</span><span class="st"> </span>. <span class="op">&gt;</span><span class="st"> </span><span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
</div>
<div id="-reduce--accumulate" class="section level4">
<h4><span class="header-section-number">4.6.9.2</span> Функции <code>reduce</code> и <code>accumulate</code></h4>
<p>В случае сложного списка, иногда возникает потребность в сведении его к более простому, путём повторного применения функции, преобразующей пару в синглтон (объект-одиночку). Это может быть полезным, если вы хотите применить двухтабличный глагол к нескольким таблицам.</p>
<p>Например, может быть список фреймов данных, и вы хотите свести его к одиночному фрейму, объеденив все элементы</p>
<div class="sourceCode" id="cb2271"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2271-1" data-line-number="1">dfs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2271-2" data-line-number="2">  <span class="dt">age =</span> <span class="kw">tibble</span>(<span class="dt">name =</span> <span class="st">&quot;John&quot;</span>, <span class="dt">age =</span> <span class="dv">30</span>),</a>
<a class="sourceLine" id="cb2271-3" data-line-number="3">  <span class="dt">sex =</span> <span class="kw">tibble</span>(<span class="dt">name =</span> <span class="kw">c</span>(<span class="st">&quot;John&quot;</span>, <span class="st">&quot;Mary&quot;</span>), <span class="dt">sex =</span> <span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;F&quot;</span>)),</a>
<a class="sourceLine" id="cb2271-4" data-line-number="4">  <span class="dt">trt =</span> <span class="kw">tibble</span>(<span class="dt">name =</span> <span class="st">&quot;Mary&quot;</span>, <span class="dt">treatment =</span> <span class="st">&quot;A&quot;</span>)</a>
<a class="sourceLine" id="cb2271-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb2271-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2271-7" data-line-number="7">dfs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(full_join)</a></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;
## Joining, by = &quot;name&quot;</code></pre>
<pre><code>## # A tibble: 2 x 4
##   name    age sex   treatment
##   &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;    
## 1 John     30 M     &lt;NA&gt;     
## 2 Mary     NA F     A</code></pre>
<p>Другим примером, может быть список векторов, для которого вы хотите найти пересечение. Какие значения есть во всех векторах? ответ:</p>
<div class="sourceCode" id="cb2274"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2274-1" data-line-number="1">vs &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2274-2" data-line-number="2">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2274-3" data-line-number="3">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>),</a>
<a class="sourceLine" id="cb2274-4" data-line-number="4">  <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2274-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb2274-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2274-7" data-line-number="7">vs <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">reduce</span>(intersect)</a></code></pre></div>
<pre><code>## [1]  1  3 10</code></pre>
<p>Функция <code>reduce</code> принимает бинарную функцию — функцию с двумя основными входными переменными — и повторно применяет её к списку до тех пор, пока остаётся хотя бы один элемент.</p>
<p>Функция <code>accumulate</code> аналогична предыдущей, но удерживает все промежуточные результаты. Вы можете использовать её для реализации кумулятивного суммирования</p>
<div class="sourceCode" id="cb2276"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2276-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2276-2" data-line-number="2">x</a></code></pre></div>
<pre><code>##  [1]  3  7  4  5  6  1  8  9  2 10</code></pre>
<div class="sourceCode" id="cb2278"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2278-1" data-line-number="1">x <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">accumulate</span>(<span class="st">`</span><span class="dt">+</span><span class="st">`</span>)</a></code></pre></div>
<pre><code>##  [1]  3 10 14 19 25 26 34 43 45 55</code></pre>
</div>
<div id="-21.9.3.1" class="section level4">
<h4><span class="header-section-number">4.6.9.3</span> Упражнение 21.9.3.1</h4>
<div class="question">
<p>Implement your own version of <code>every()</code> using a for loop. Compare it with <code>purrr::every()</code>.
What does purrr’s version do that your version doesn’t?</p>
</div>
<p>Подглядим как работает функция <code>every()</code></p>
<div class="sourceCode" id="cb2280"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2280-1" data-line-number="1">every</a></code></pre></div>
<pre><code>## function (.x, .p, ...) 
## {
##     .p &lt;- as_predicate(.p, ..., .mapper = TRUE, .deprecate = TRUE)
##     for (i in seq_along(.x)) {
##         val &lt;- .p(.x[[i]], ...)
##         if (is_false(val)) 
##             return(FALSE)
##         if (anyNA(val)) 
##             return(NA)
##     }
##     TRUE
## }
## &lt;bytecode: 0x7fbe69cd4ee0&gt;
## &lt;environment: namespace:purrr&gt;</code></pre>
<p>Ага, мы для каждого элемента проверяем является ли истиной результат применения функции к этому элементу.
Если результат не_ложь, то возвращаем истину, если результат не_истина возвращаем ложь.</p>
<p>Если есть ЛОЖЬ, мы знаем, что не все из них были ИСТИННЫМИ
если ничего не было ЛОЖЬ, то ИСТИНА</p>
<div class="sourceCode" id="cb2282"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2282-1" data-line-number="1">y &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">10</span>, <span class="fl">5.5</span>)</a>
<a class="sourceLine" id="cb2282-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb2282-3" data-line-number="3"><span class="kw">every</span>(y, is.numeric)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2284"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2284-1" data-line-number="1"><span class="kw">every</span>(y, is.integer)</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb2286"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2286-1" data-line-number="1"><span class="kw">every</span>(x, is.integer)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2288"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2288-1" data-line-number="1"><span class="kw">is.numeric</span>(<span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2290"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2290-1" data-line-number="1"><span class="kw">is.numeric</span>(<span class="dv">2</span>)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb2292"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2292-1" data-line-number="1">every1 &lt;-<span class="st"> </span><span class="cf">function</span>(value, fun, ...){</a>
<a class="sourceLine" id="cb2292-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> value) {</a>
<a class="sourceLine" id="cb2292-3" data-line-number="3">    <span class="cf">if</span>(<span class="op">!</span><span class="kw">fun</span>(i, ...)){</a>
<a class="sourceLine" id="cb2292-4" data-line-number="4">      <span class="kw">return</span>(<span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2292-5" data-line-number="5">    }</a>
<a class="sourceLine" id="cb2292-6" data-line-number="6">  }</a>
<a class="sourceLine" id="cb2292-7" data-line-number="7">  <span class="kw">return</span>(<span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2292-8" data-line-number="8">}</a>
<a class="sourceLine" id="cb2292-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2292-10" data-line-number="10"><span class="kw">every1</span>(x, is.numeric)</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Функция <code>purrr::every()</code> делает причудливые вещи с аргументом функции предиката <code>fun</code>, например, берет логический вектор вместо функции или может проверить часть строки, если элементы <code>fun</code> являются списками.</p>
</div>
<div id="-21.9.3.2" class="section level4">
<h4><span class="header-section-number">4.6.9.4</span> Упражнение 21.9.3.2</h4>
<div class="question">
<p>Create an enhanced <code>col_summary()</code> that applies a summary function to every numeric column in a data frame.</p>
</div>
<div class="sourceCode" id="cb2294"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2294-1" data-line-number="1">col_sum2 &lt;-<span class="st"> </span><span class="cf">function</span>(df, f, ...) {</a>
<a class="sourceLine" id="cb2294-2" data-line-number="2">  <span class="kw">map</span>(<span class="kw">keep</span>(df, is.numeric), f, ...)</a>
<a class="sourceLine" id="cb2294-3" data-line-number="3">}</a></code></pre></div>
</div>
<div id="-21.9.3.3" class="section level4">
<h4><span class="header-section-number">4.6.9.5</span> Упражнение 21.9.3.3</h4>
<div class="question">
<p>A possible base R equivalent of col_summary() is:</p>
<div class="sourceCode" id="cb2295"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2295-1" data-line-number="1">col_sum3 &lt;-<span class="st"> </span><span class="cf">function</span>(df, f) {</a>
<a class="sourceLine" id="cb2295-2" data-line-number="2">  is_num &lt;-<span class="st"> </span><span class="kw">sapply</span>(df, is.numeric)</a>
<a class="sourceLine" id="cb2295-3" data-line-number="3">  df_num &lt;-<span class="st"> </span>df[, is_num]</a>
<a class="sourceLine" id="cb2295-4" data-line-number="4">  <span class="kw">sapply</span>(df_num, f)</a>
<a class="sourceLine" id="cb2295-5" data-line-number="5">}</a></code></pre></div>
<p>But it has a number of bugs as illustrated with the following inputs:</p>
<div class="sourceCode" id="cb2296"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2296-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2296-2" data-line-number="2">  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb2296-3" data-line-number="3">  <span class="dt">y =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2296-4" data-line-number="4">  <span class="dt">z =</span> <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>)</a>
<a class="sourceLine" id="cb2296-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb2296-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2296-7" data-line-number="7"><span class="co"># OK</span></a>
<a class="sourceLine" id="cb2296-8" data-line-number="8"><span class="kw">col_sum3</span>(df, mean)</a></code></pre></div>
<pre><code>## x y 
## 2 2</code></pre>
<div class="sourceCode" id="cb2298"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2298-1" data-line-number="1"><span class="co"># Has problems: don&#39;t always return numeric vector</span></a>
<a class="sourceLine" id="cb2298-2" data-line-number="2"><span class="kw">col_sum3</span>(df[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], mean)</a></code></pre></div>
<pre><code>## x y 
## 2 2</code></pre>
<div class="sourceCode" id="cb2300"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2300-1" data-line-number="1"><span class="kw">col_sum3</span>(df[<span class="dv">1</span>], mean)</a></code></pre></div>
<pre><code>## x 
## 2</code></pre>
<div class="sourceCode" id="cb2302"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2302-1" data-line-number="1"><span class="co"># col_sum3(df[0], mean)</span></a></code></pre></div>
<p>What causes these bugs?</p>
</div>
<p>Причиной этих ошибок является поведение <code>sapply()</code>. Функция <code>sapply()</code> не гарантирует тип вектора, который она возвращает, и будет возвращать разные типы векторов в зависимости от ее входных данных. Если столбцы не выбраны, вместо возврата пустого числового вектора возвращается пустой список. Это вызывает ошибку, так как мы не можем использовать список с <code>[</code>.</p>
<div class="sourceCode" id="cb2303"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2303-1" data-line-number="1"><span class="kw">sapply</span>(df[<span class="dv">0</span>], is.numeric)</a></code></pre></div>
<pre><code>## named list()</code></pre>
<div class="sourceCode" id="cb2305"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2305-1" data-line-number="1"><span class="kw">sapply</span>(df[<span class="dv">1</span>], is.numeric)</a></code></pre></div>
<pre><code>##    x 
## TRUE</code></pre>
<div class="sourceCode" id="cb2307"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2307-1" data-line-number="1"><span class="kw">sapply</span>(df[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>], is.numeric)</a></code></pre></div>
<pre><code>##    x    y 
## TRUE TRUE</code></pre>
<p>Функция <code>sapply()</code> пытается помочь, упрощая результаты, но такое поведение может быть контрпродуктивным. Можно использовать функцию <code>sapply()</code> в интерактивном режиме, но избегайте программирования с ней.</p>
<!--chapter:end:17_iteration.Rmd-->
</div>
</div>
</div>
</div>
<div class="section level1">
<h1><span class="header-section-number">5</span> Моделирование</h1>
<p>Знакомимся с Exploratory data analysis (EDA) — разведочный анализ данных.</p>
<p>Цель моделирования — получение простых суммарных (сводных) характеристик набора данных.</p>
<p>Здесь разбриаем предсказательные модели анализа данных. Есть ещё много разных, например data discovery, но их здесь не рассматриваем</p>
<p>Базовые принципы корректного статистического вывода:</p>
<ul>
<li><p>Каждое наблюдение можно использовать либо для разведочного анализа, либо для подтверждения гипотезы. Но не для того и другого одновременно</p></li>
<li><p>В целях разведочного анализа допускается многократное использование наблюдения, но в целях подтверждения гипотез — только однократное. Использование одного и того же наблюдения более одного раза равносильно переходу от подтверждения гипотезы к разведочному анализу.</p></li>
</ul>
<p>Данные используемые для подтверждения гипотезы не должны зависеть от данных на основании которых эта гипотеза была выдвинута.</p>
<div id="----" class="section level3">
<h3><span class="header-section-number">5.0.1</span> Выдвижение гипотез и их подтверждение</h3>
<p>Один из подходов к анализу, направленному на подтверждение гипотезы, заключается в разбиении данных на три части ещё до того, как приступить к анализу</p>
<ul>
<li><p><span class="math inline">\(60%\)</span> — training set. С этим набором можноделать всё что пожелается.</p></li>
<li><p><span class="math inline">\(20%\)</span> — query set. Набор для сравнения моделей или вариантов визуализации вручную, но их не разрешается использовать в качестве части автоматизированного процесса.</p></li>
<li><p><span class="math inline">\(20%\)</span> — test set. Эти данные можно использовать только один раз для тестирования окончательной модели.</p></li>
</ul>
</div>
<div id="-----modelr" class="section level2">
<h2><span class="header-section-number">5.1</span> Базовое моделирование при помощи пакета <code>modelr</code></h2>
<div id="-16" class="section level3">
<h3><span class="header-section-number">5.1.1</span> Введение</h3>
<p>Цель моделирования — определение суммарных характеристик набора данных.</p>
<p>Моделирование включает два аспекта</p>
<ol style="list-style-type: decimal">
<li><p>Прежде всего необходимо определить семейство моделей. Они определяют типичную закономерность, например линейную или квадратичную зависимость. Семейство моделей описывается уравнением наподобие <code>y = a_1 * x + a_2</code> or <code>y = a_1 * x ^ a_2</code>. Где <code>x</code> и <code>y</code> — известные переменные, а <code>a_1</code> и <code>a_2</code> варьируемые параметры.</p></li>
<li><p>Далее вы генерируете подходяющую модель, выбирая ту из семейства моделей, которая больше всего соответствует данным. В результате этого обобщенного уравнения семейства моделей конкретизируется принимая вид наподобие <code>y = 3 * x + 7</code></p></li>
</ol>
<p>Целью моделирования является не установление окончательной истины, а нахождение простого, но тем не менее полезного приближения</p>
<div id="--7" class="section level4">
<h4><span class="header-section-number">5.1.1.1</span> Необходимые ресурсы</h4>
<div class="sourceCode" id="cb2309"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2309-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb2309-2" data-line-number="2"><span class="kw">library</span>(splines)</a>
<a class="sourceLine" id="cb2309-3" data-line-number="3"><span class="kw">library</span>(modelr)</a>
<a class="sourceLine" id="cb2309-4" data-line-number="4"><span class="kw">options</span>(<span class="dt">na.action =</span> na.warn)</a></code></pre></div>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">5.1.2</span> Простая модель</h3>
<p>Демонстрационный набор данный <code>sim1</code> содержит две непрерывные переменные <code>x</code> и <code>y</code>. Отложим их на графике, чтобы увидеть, как они связаны между собой</p>
<div class="sourceCode" id="cb2310"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2310-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2310-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1059-1.png" width="672" /></p>
<p>между переменными наблюдается сильная взаимосвязь. Коэффициент корреляции</p>
<div class="sourceCode" id="cb2311"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2311-1" data-line-number="1"><span class="kw">cor</span>(sim1<span class="op">$</span>x, sim1<span class="op">$</span>y)</a></code></pre></div>
<pre><code>## [1] 0.9405384</code></pre>
<p>Опишем эту взаимосвязь с помощью модели и выразим ее в явном виде.</p>
<p>Наша задача — предоставить базовую форму модели. В данном случае мы используем линейное соотношение между переменными <code>y = a_0 + a_1 * x</code>.
Начнем с получения общего представления о том, как выглядят модели этого семейства. Путём случайной генерации некоторых из них и наложения их на данные.</p>
<p>В нашем случае можно использовать <code>geom_abline</code> — она принимает наклон (slope), и y-пересечение (intercept).</p>
<div class="sourceCode" id="cb2313"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2313-1" data-line-number="1">models &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2313-2" data-line-number="2">  <span class="dt">a1 =</span> <span class="kw">runif</span>(<span class="dv">250</span>, <span class="dv">-20</span>, <span class="dv">40</span>),</a>
<a class="sourceLine" id="cb2313-3" data-line-number="3">  <span class="dt">a2 =</span> <span class="kw">runif</span>(<span class="dv">250</span>, <span class="dv">-5</span>, <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2313-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb2313-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2313-6" data-line-number="6"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2313-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_abline</span>(</a>
<a class="sourceLine" id="cb2313-8" data-line-number="8">    <span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2), </a>
<a class="sourceLine" id="cb2313-9" data-line-number="9">    <span class="dt">data =</span> models, <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span></a>
<a class="sourceLine" id="cb2313-10" data-line-number="10">  ) <span class="op">+</span></a>
<a class="sourceLine" id="cb2313-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1061-1.png" width="672" /></p>
<p>Большинство из построенных моделей совсем неудачны. Нам нужен метод обеспечивающий количественную оценку расстояния между данными и моделью.</p>
<p>Это расстояние — разность между значением предоставляемым моделью — прогноз, и фактическим значением <code>y</code> согласно данным <code>data</code> — результат.</p>
<div class="figure">
<img src="img/model.png" alt="расстояния от результата до прогноза" />
<p class="caption">расстояния от результата до прогноза</p>
</div>
<p>Для вычисления расстояния мы прежде всего превратим семейство моделей в функцию.
В качестве аргументов, эта функция принимает параметры модели и данные, а в качестве выходного результата предоставляет значения, предсказанные моделью</p>
<div class="sourceCode" id="cb2314"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2314-1" data-line-number="1">model1 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {</a>
<a class="sourceLine" id="cb2314-2" data-line-number="2">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb2314-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb2314-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2314-5" data-line-number="5"><span class="kw">model1</span>(<span class="kw">c</span>(<span class="dv">7</span>, <span class="fl">1.5</span>), sim1)</a></code></pre></div>
<pre><code>##  [1]  8.5  8.5  8.5 10.0 10.0 10.0 11.5 11.5 11.5 13.0 13.0 13.0 14.5 14.5
## [15] 14.5 16.0 16.0 16.0 17.5 17.5 17.5 19.0 19.0 19.0 20.5 20.5 20.5 22.0
## [29] 22.0 22.0</code></pre>
<p>Чтобы найти минимальное расстояние при помощи среднеквадратического отклонения.</p>
<div class="sourceCode" id="cb2316"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2316-1" data-line-number="1">measure_distance &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb2316-2" data-line-number="2">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model1</span>(mod, data)</a>
<a class="sourceLine" id="cb2316-3" data-line-number="3">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff <span class="op">^</span><span class="st"> </span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb2316-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2316-5" data-line-number="5"><span class="kw">measure_distance</span>(<span class="kw">c</span>(<span class="dv">7</span>, <span class="fl">1.5</span>), sim1)</a></code></pre></div>
<pre><code>## [1] 2.665212</code></pre>
<p>Теперь используем пакет <code>purrr</code> для того чтобы вычислить это расстояние для всех ранее определённых моделей. Нам нужна вспомогательная функция, поскольку наша функция вычисляющая расстояние лжидает модель в качестве числового вектора с длиной 2</p>
<div class="sourceCode" id="cb2318"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2318-1" data-line-number="1">sim1_dist &lt;-<span class="st"> </span><span class="cf">function</span>(a1, a2) {</a>
<a class="sourceLine" id="cb2318-2" data-line-number="2">  <span class="kw">measure_distance</span>(<span class="kw">c</span>(a1, a2), sim1)</a>
<a class="sourceLine" id="cb2318-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb2318-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2318-5" data-line-number="5">models &lt;-<span class="st"> </span>models <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2318-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dist =</span> purrr<span class="op">::</span><span class="kw">map2_dbl</span>(a1, a2, sim1_dist))</a>
<a class="sourceLine" id="cb2318-7" data-line-number="7">models</a></code></pre></div>
<pre><code>## # A tibble: 250 x 3
##        a1     a2  dist
##     &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
##  1  -9.44  1.20  18.6 
##  2 -18.1  -3.21  53.5 
##  3  -8.52  4.14   6.49
##  4  21.8   2.78  21.8 
##  5  -6.53 -3.36  43.5 
##  6  31.5  -3.14  15.1 
##  7  22.8  -3.42  19.6 
##  8 -10.3  -3.22  46.1 
##  9  10.7   3.89  17.5 
## 10   3.99 -0.126 13.9 
## # … with 240 more rows</code></pre>
<p>Выделим лучшие модели</p>
<div class="sourceCode" id="cb2320"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2320-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2320-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2320-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>(</a>
<a class="sourceLine" id="cb2320-4" data-line-number="4">    <span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2, <span class="dt">color =</span> <span class="op">-</span>dist), </a>
<a class="sourceLine" id="cb2320-5" data-line-number="5">    <span class="dt">data =</span> <span class="kw">filter</span>(models, <span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2320-6" data-line-number="6">  )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1065-1.png" width="672" /></p>
<p>Мы можем рассматривать эти модели как наблюдения и визуализировать их с помощью точечной диаграмы с осями <code>a1</code> и <code>a2</code>, опять таки расцветив их в соответстсвии со значениями <code>-dist</code>. При этом мы увидим множество моделей одновременно.
Выделим 10 лучшиъ моделей кржочками</p>
<div class="sourceCode" id="cb2321"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2321-1" data-line-number="1"><span class="kw">ggplot</span>(models, <span class="kw">aes</span>(a1, a2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2321-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">filter</span>(models, <span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>), <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2321-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="op">-</span>dist))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1066-1.png" width="672" /></p>
<p>Можно так же построить сетку поиска! Где точки расположены не хаотично, а упорядоченно</p>
<div class="sourceCode" id="cb2322"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2322-1" data-line-number="1">grid &lt;-<span class="st"> </span><span class="kw">expand.grid</span>(</a>
<a class="sourceLine" id="cb2322-2" data-line-number="2">  <span class="dt">a1 =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">2</span>, <span class="dv">10</span>, <span class="dt">length =</span> <span class="dv">25</span>),</a>
<a class="sourceLine" id="cb2322-3" data-line-number="3">  <span class="dt">a2 =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dt">length =</span> <span class="dv">25</span>)</a>
<a class="sourceLine" id="cb2322-4" data-line-number="4">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2322-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">dist =</span> purrr<span class="op">::</span><span class="kw">map2_dbl</span>(a1, a2, sim1_dist))</a>
<a class="sourceLine" id="cb2322-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2322-7" data-line-number="7">grid <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2322-8" data-line-number="8"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(a1, a2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2322-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> <span class="kw">filter</span>(grid, <span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>), <span class="dt">size =</span> <span class="dv">4</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2322-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">colour =</span> <span class="op">-</span>dist)) </a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1067-1.png" width="672" /></p>
<p>Если наложить эти 10 наилучших моделей на исходные данные, то они будут выглядеть довольно прилично</p>
<div class="sourceCode" id="cb2323"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2323-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2323-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2323-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>(</a>
<a class="sourceLine" id="cb2323-4" data-line-number="4">    <span class="kw">aes</span>(<span class="dt">intercept =</span> a1, <span class="dt">slope =</span> a2, <span class="dt">colour =</span> <span class="op">-</span>dist), </a>
<a class="sourceLine" id="cb2323-5" data-line-number="5">    <span class="dt">data =</span> <span class="kw">filter</span>(grid, <span class="kw">rank</span>(dist) <span class="op">&lt;=</span><span class="st"> </span><span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2323-6" data-line-number="6">  )</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1068-1.png" width="672" /></p>
<p>но конечно самый простой способ это воспользоваться функцией <code>lm()</code> для построения линейных моделей</p>
<div class="sourceCode" id="cb2324"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2324-1" data-line-number="1">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb2324-2" data-line-number="2"><span class="kw">coef</span>(sim1_mod)</a></code></pre></div>
<pre><code>## (Intercept)           x 
##    4.220822    2.051533</code></pre>
<div class="sourceCode" id="cb2326"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2326-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2326-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2326-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="kw">coef</span>(sim1_mod)[<span class="dv">1</span>], <span class="dt">slope =</span> <span class="kw">coef</span>(sim1_mod)[<span class="dv">2</span>])</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1070-1.png" width="672" /></p>
<div id="-23.2.1.1" class="section level4">
<h4><span class="header-section-number">5.1.2.1</span> Упражнение 23.2.1.1</h4>
<div class="question">
<p>One downside of the linear model is that it is sensitive to unusual values because the distance incorporates a squared term. Fit a linear model to the simulated data below, and visualise the results. Rerun a few times to generate different simulated datasets. What do you notice about the model?</p>
<div class="sourceCode" id="cb2327"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2327-1" data-line-number="1">sim1a &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2327-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb2327-3" data-line-number="3">  <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2327-4" data-line-number="4">)</a></code></pre></div>
</div>
<p>Линейные модели неустойчивы к выбросам — известный факт.</p>
<p>Попробуем это на одиночной модели</p>
<div class="sourceCode" id="cb2328"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2328-1" data-line-number="1">sim1a_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, sim1a)</a>
<a class="sourceLine" id="cb2328-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2328-3" data-line-number="3"><span class="kw">ggplot</span>(sim1a, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2328-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2328-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="kw">coef</span>(sim1a_mod)[<span class="dv">1</span>], <span class="dt">slope =</span> <span class="kw">coef</span>(sim1a_mod)[<span class="dv">2</span>], <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1072-1.png" width="672" /></p>
<p>Сделаем функцию, которая бы генерировала несколько распределений сразу</p>
<div class="sourceCode" id="cb2329"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2329-1" data-line-number="1">simt &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb2329-2" data-line-number="2">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2329-3" data-line-number="3">    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb2329-4" data-line-number="4">    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rt</span>(<span class="kw">length</span>(x), <span class="dt">df =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb2329-5" data-line-number="5">    <span class="dt">id =</span> i</a>
<a class="sourceLine" id="cb2329-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb2329-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb2329-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2329-9" data-line-number="9">sims &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>, simt)</a>
<a class="sourceLine" id="cb2329-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2329-11" data-line-number="11"><span class="kw">ggplot</span>(sims, <span class="kw">aes</span>(x, y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2329-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2329-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2329-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>id, <span class="dt">ncol =</span> <span class="dv">5</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1073-1.png" width="672" /></p>
<p>Что если проделать всё тоже самое с нормальным распределением</p>
<div class="sourceCode" id="cb2330"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2330-1" data-line-number="1">sim_norm &lt;-<span class="st"> </span><span class="cf">function</span>(i) {</a>
<a class="sourceLine" id="cb2330-2" data-line-number="2">  <span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2330-3" data-line-number="3">    <span class="dt">x =</span> <span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dt">each =</span> <span class="dv">3</span>),</a>
<a class="sourceLine" id="cb2330-4" data-line-number="4">    <span class="dt">y =</span> x <span class="op">*</span><span class="st"> </span><span class="fl">1.5</span> <span class="op">+</span><span class="st"> </span><span class="dv">6</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(x)),</a>
<a class="sourceLine" id="cb2330-5" data-line-number="5">    <span class="dt">.id =</span> i</a>
<a class="sourceLine" id="cb2330-6" data-line-number="6">  )</a>
<a class="sourceLine" id="cb2330-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb2330-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2330-9" data-line-number="9">simdf_norm &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">12</span>, sim_norm)</a>
<a class="sourceLine" id="cb2330-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2330-11" data-line-number="11"><span class="kw">ggplot</span>(simdf_norm, <span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2330-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2330-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2330-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>.id, <span class="dt">ncol =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1074-1.png" width="672" /></p>
<p>Здесь не большие выбросы, а склоны больше похожи.</p>
<p>Причина в том, что t-распределение Стьюдента, из которого мы выбираем с помощью <code>rt()</code>, имеет более тяжелые хвосты, чем нормальное распределение <code>rnorm()</code>. Это означает, что t-распределение Стьюдента присваивает большую вероятность значениям дальше от центра распределения.</p>
<div class="sourceCode" id="cb2331"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2331-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2331-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">seq</span>(<span class="op">-</span><span class="dv">5</span>, <span class="dv">5</span>, <span class="dt">length.out =</span> <span class="dv">100</span>),</a>
<a class="sourceLine" id="cb2331-3" data-line-number="3">  <span class="dt">normal =</span> <span class="kw">dnorm</span>(x),</a>
<a class="sourceLine" id="cb2331-4" data-line-number="4">  <span class="dt">student_t =</span> <span class="kw">dt</span>(x, <span class="dt">df =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb2331-5" data-line-number="5">) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2331-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(distribution, density, <span class="op">-</span>x) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2331-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x, <span class="dt">y =</span> density, <span class="dt">color =</span> distribution)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2331-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1075-1.png" width="672" /></p>
<p>Для нормального распределения со средним <code>0</code> и стандартным отклонением <code>1</code> — вероятность того, что оно больше 2, составляет</p>
<div class="sourceCode" id="cb2332"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2332-1" data-line-number="1"><span class="kw">pnorm</span>(<span class="dv">2</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 0.02275013</code></pre>
<p>В то время как в распределении Стьюдента, с числом степеней свободы = 2,</p>
<div class="sourceCode" id="cb2334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2334-1" data-line-number="1"><span class="kw">pt</span>(<span class="dv">2</span>, <span class="dt">df =</span> <span class="dv">2</span>, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## [1] 0.09175171</code></pre>
</div>
<div id="-23.2.1.2" class="section level4">
<h4><span class="header-section-number">5.1.2.2</span> Упражнение 23.2.1.2</h4>
<div class="question">
<p>One way to make linear models more robust is to use a different distance measure. For example, instead of root-mean-squared distance, you could use mean-absolute distance:</p>
<div class="sourceCode" id="cb2336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2336-1" data-line-number="1">measure_distance &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb2336-2" data-line-number="2">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model1</span>(mod, data)</a>
<a class="sourceLine" id="cb2336-3" data-line-number="3">  <span class="kw">mean</span>(<span class="kw">abs</span>(diff))</a>
<a class="sourceLine" id="cb2336-4" data-line-number="4">}</a></code></pre></div>
<p>Use <code>optim()</code> to fit this model to the simulated data above and compare it to the linear model.</p>
</div>
<p>Чтобы вышеуказанная функция работала, нам нужно определить функцию <code>make_prediction()</code>, которая принимает числовой вектор длины два (пересечение и наклон) и возвращает предсказания,</p>
<div class="sourceCode" id="cb2337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2337-1" data-line-number="1">make_prediction &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb2337-2" data-line-number="2">  mod[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>mod[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>data<span class="op">$</span>x</a>
<a class="sourceLine" id="cb2337-3" data-line-number="3">}</a></code></pre></div>
<p>Используя данные <code>sim1a</code>, лучшие параметры наименьшего абсолютного отклонения:</p>
<div class="sourceCode" id="cb2338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2338-1" data-line-number="1">best &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), measure_distance, <span class="dt">data =</span> sim1a)</a>
<a class="sourceLine" id="cb2338-2" data-line-number="2">best<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 6.642140 1.391345</code></pre>
<p>Используя данные <code>sim1a</code>, параметры целевой функции минимизации наименьших квадратов:</p>
<div class="sourceCode" id="cb2340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2340-1" data-line-number="1">measure_distance_ls &lt;-<span class="st"> </span><span class="cf">function</span>(mod, data) {</a>
<a class="sourceLine" id="cb2340-2" data-line-number="2">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span>(mod[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>mod[<span class="dv">2</span>] <span class="op">*</span><span class="st"> </span>data<span class="op">$</span>x)</a>
<a class="sourceLine" id="cb2340-3" data-line-number="3">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb2340-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb2340-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2340-6" data-line-number="6">best &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), measure_distance_ls, <span class="dt">data =</span> sim1a)</a>
<a class="sourceLine" id="cb2340-7" data-line-number="7">best<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 5.861504 1.520616</code></pre>
<p>На практике предлагают не использовать <code>optim()</code> для соответствия этой модели, а вместо этого использовать существующую реализацию.
Функции <code>rlm()</code> и <code>lqs()</code> в <code>MASS</code> подходят для надежных и устойчивых линейных моделей.</p>
</div>
<div id="-23.2.1.3" class="section level4">
<h4><span class="header-section-number">5.1.2.3</span> Упражнение 23.2.1.3</h4>
<div class="question">
<p>One challenge with performing numerical optimisation is that it’s only guaranteed to find one local optimum. What’s the problem with optimising a three parameter model like this?</p>
<div class="sourceCode" id="cb2342"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2342-1" data-line-number="1">model3 &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {</a>
<a class="sourceLine" id="cb2342-2" data-line-number="2">  a[<span class="dv">1</span>] <span class="op">+</span><span class="st"> </span>data<span class="op">$</span>x <span class="op">*</span><span class="st"> </span>a[<span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>a[<span class="dv">3</span>]</a>
<a class="sourceLine" id="cb2342-3" data-line-number="3">}</a></code></pre></div>
</div>
<p>Проблема в том, что для любых значений <code>a[1] = a1</code> и <code>a[3] = a3</code>, любых других значений <code>a[1]</code> и <code>a[3]</code>, где <code>a[1] + a[3] == (a1 + а3)</code> будет иметь такую же посадку.</p>
<div class="sourceCode" id="cb2343"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2343-1" data-line-number="1">measure_distance_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="cf">function</span>(a, data) {</a>
<a class="sourceLine" id="cb2343-2" data-line-number="2">  diff &lt;-<span class="st"> </span>data<span class="op">$</span>y <span class="op">-</span><span class="st"> </span><span class="kw">model3</span>(a, data)</a>
<a class="sourceLine" id="cb2343-3" data-line-number="3">  <span class="kw">sqrt</span>(<span class="kw">mean</span>(diff<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb2343-4" data-line-number="4">}</a></code></pre></div>
<p>В зависимости от наших отправных точек, мы можем найти различные оптимальные значения:</p>
<div class="sourceCode" id="cb2344"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2344-1" data-line-number="1">best3a &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), measure_distance_<span class="dv">3</span>, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb2344-2" data-line-number="2">best3a<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] 3.3672228 2.0515737 0.8528513</code></pre>
<div class="sourceCode" id="cb2346"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2346-1" data-line-number="1">best3b &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), measure_distance_<span class="dv">3</span>, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb2346-2" data-line-number="2">best3b<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] -3.469885  2.051509  7.690289</code></pre>
<div class="sourceCode" id="cb2348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2348-1" data-line-number="1">best3c &lt;-<span class="st"> </span><span class="kw">optim</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">5</span>), measure_distance_<span class="dv">3</span>, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb2348-2" data-line-number="2">best3c<span class="op">$</span>par</a></code></pre></div>
<pre><code>## [1] -1.124446  2.051520  5.345616</code></pre>
<p>На самом деле существует бесконечное количество оптимальных значений для этой модели.</p>
</div>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">5.1.3</span> Визуализация моделей</h3>
<p>Если вашей целью является применение моделей для исследования статистических характеристик массивов данных, то вероятнее всего большую часть времени вы будете исследовать какие закономерности отражает модель, путём тщательного изучания семейства моделей.</p>
<p>Полезно бывает рассмотреть то, что моделью не охватывается, — остатки., т.е. то что остается после вычитания прогнозных значений из фактических данных. Остатки предоставляют чрезвычайно полезную информацию, поскольку они позволяют использовать модели для устранения экстремальных пиков и тем самым дают возможность изучать слабые остаточные тренды.</p>
<div class="section level4">
<h4><span class="header-section-number">5.1.3.1</span> Предсказания</h4>
<p>Визуализацию предсказаний на основе модели мы начнём с того, что сгенерируем равномерную сетку значений охватывающих всю облать, в которой распологаются наши данные. Проще всего это можно сделать с помощью <code>modelr::data_grid()</code>.
Первый аргумент — фрейм данных. Для последующих аргументов она находит уникальные переменные и генерирует все комбинации.</p>
<div class="sourceCode" id="cb2350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2350-1" data-line-number="1">grid &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2350-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(x)</a></code></pre></div>
<p>Станет ещё более понятно и интереснее, когда мы добавим переменные в нашу модель.</p>
<p>Следующий шаг — добавление предсказаний. Сделаем это при помощи <code>modelr::add_predictions()</code>. Она принимает модель данных и сами данные. олученные с помощтю модели предсказания добавляет в новый столбец фрейма данных</p>
<div class="sourceCode" id="cb2351"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2351-1" data-line-number="1">grid &lt;-<span class="st"> </span>grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2351-2" data-line-number="2"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod) <span class="co"># sim1_mod --- это модель</span></a></code></pre></div>
<p>Эту функцию можно использовать для добавления предсказаний в исходный набор данных.</p>
<p>Далее мы откладываем предсказания в виде графика.</p>
<div class="sourceCode" id="cb2352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2352-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2352-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2352-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred), <span class="dt">data =</span> grid, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1087-1.png" width="672" /></p>
<p>Такой подход будет работать с любой моделью в R. Здесь предсказание — это не построение дополнительных значений, а построение зависимости, по которой эти дополнительные значения должны строится.</p>
</div>
<div class="section level4">
<h4><span class="header-section-number">5.1.3.2</span> Остатки</h4>
<p>Обратная сторона предсказаний, как завещал Тьюки — остатки. Предсказания отражают закономерность, которую модели удалось уловить, тогда как остатки предоставляют информацию о том, что не охватывается моделью.</p>
<p>Остатки — это не что иное, как расстояния между наблюдениями и вычисленными нами прогнозными значениями.</p>
<p>Мы добавляем остатки к данным с помощью функции <code>modelr::add_residuals()</code>, которая работает во многом аналогично функции <code>modelr::add_predictions()</code>. Стоит отметить — что мы используем исходный набор данных, а не искуственную сетку.</p>
<p>Это обсуловлено тем, что для вычисления остатков нам нужны фактические значения <code>y</code></p>
<div class="sourceCode" id="cb2353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2353-1" data-line-number="1">sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2353-2" data-line-number="2"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod)</a></code></pre></div>
<p>Существует несколько способов извлечения информации о модели на основе остатков. Один из них — графические представление распределения остатков с помощю полигона частот.</p>
<div class="sourceCode" id="cb2354"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2354-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(resid)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2354-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1089-1.png" width="672" /></p>
<p>Это ползволяет калибровать качество модели: насколько прогноз отличается от наблюдаемых значений? Обратите внимание на то, что среднее остатков всегда равно 0.</p>
<p>Потребность в построении графиков с использование остатков вместо исходного предиктора будет возникать довольно часто.</p>
<div class="sourceCode" id="cb2355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2355-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, resid)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2355-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2355-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1090-1.png" width="672" /></p>
<p>Этот график выглядит как случайный шум. Это косвенно говорит о том, что наша модель неплохо справилась со своей задачей определения закономерности в поведении данных.</p>
</div>
<div id="-23.3.3.1" class="section level4">
<h4><span class="header-section-number">5.1.3.3</span> Упражнение 23.3.3.1</h4>
<div class="question">
<p>Instead of using <code>lm()</code> to fit a straight line, you can use <code>loess()</code> to fit a smooth curve.
Repeat the process of model fitting, grid generation, predictions, and visualisation on <code>sim1</code> using <code>loess()</code> instead of <code>lm()</code>.
How does the result compare to <code>geom_smooth()</code>?</p>
</div>
<p>Сначала произведём подгонку модели</p>
<div class="sourceCode" id="cb2356"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2356-1" data-line-number="1">sim1_loess &lt;-<span class="st"> </span><span class="kw">loess</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb2356-2" data-line-number="2">sim1_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a></code></pre></div>
<p>Теперь сгенерируем сетку</p>
<div class="sourceCode" id="cb2357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2357-1" data-line-number="1">grid_loess &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2357-2" data-line-number="2"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess)</a></code></pre></div>
<p>Теперь спрогнозируем</p>
<div class="sourceCode" id="cb2358"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2358-1" data-line-number="1">sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2358-2" data-line-number="2"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_lm) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2358-3" data-line-number="3"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_lm) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2358-4" data-line-number="4"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;resid_loess&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2358-5" data-line-number="5"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>)</a></code></pre></div>
<p>И после этого визуализируем. На одном графике, для сравнения, я построил три модели. Зелёная линейная, синяя — гладкая при помощи функции <code>geom_smooth()</code>. И красная, при помощи функции <code>loess()</code>.</p>
<div class="sourceCode" id="cb2359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2359-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2359-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;grey30&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2359-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> F, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2359-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(x, pred), <span class="dt">data =</span> grid_loess, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2359-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> pred), <span class="dt">data =</span> grid, <span class="dt">color =</span> <span class="st">&quot;green&quot;</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1094-1.png" width="672" /></p>
<p>И наконец, построим остатки для гладкой модели и сравним их с остатками из прямолинейной модели (черный цвет).</p>
<div class="sourceCode" id="cb2361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2361-1" data-line-number="1"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2361-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2361-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2361-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> resid_loess), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1095-1.png" width="672" /></p>
<p>В целом, довольно схоже.</p>
</div>
<div id="-23.3.3.2" class="section level4">
<h4><span class="header-section-number">5.1.3.4</span> Упражнение 23.3.3.2</h4>
<div class="question">
<p><code>add_predictions()</code> is paired with <code>gather_predictions()</code> and <code>spread_predictions()</code>.
How do these three functions differ?</p>
</div>
<p>Функции <code>collect_predictions()</code> и <code>spread_predictions()</code> позволяют добавлять прогнозы из нескольких моделей одновременно.
Например</p>
<div class="sourceCode" id="cb2362"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2362-1" data-line-number="1">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb2362-2" data-line-number="2">grid &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2362-3" data-line-number="3"><span class="st">  </span><span class="kw">data_grid</span>(x)</a></code></pre></div>
<p>Функция <code>add_predictions()</code> добавляет только одну модель за раз. Чтобы добавить две модели:</p>
<div class="sourceCode" id="cb2363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2363-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2363-2" data-line-number="2"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_mod, <span class="dt">var =</span> <span class="st">&quot;pred_lm&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2363-3" data-line-number="3"><span class="st">  </span><span class="kw">add_predictions</span>(sim1_loess, <span class="dt">var =</span> <span class="st">&quot;pred_loess&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##        x pred_lm pred_loess
##    &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt;
##  1     1    6.27       5.34
##  2     2    8.32       8.27
##  3     3   10.4       10.8 
##  4     4   12.4       12.8 
##  5     5   14.5       14.6 
##  6     6   16.5       16.6 
##  7     7   18.6       18.7 
##  8     8   20.6       20.8 
##  9     9   22.7       22.6 
## 10    10   24.7       24.0</code></pre>
<p>Функция <code>collect_predictions()</code> добавляет прогнозы из нескольких моделей, складывая результаты и добавляя столбец с именем модели</p>
<div class="sourceCode" id="cb2365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2365-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2365-2" data-line-number="2"><span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_loess)</a></code></pre></div>
<pre><code>## # A tibble: 20 x 3
##    model          x  pred
##    &lt;chr&gt;      &lt;int&gt; &lt;dbl&gt;
##  1 sim1_mod       1  6.27
##  2 sim1_mod       2  8.32
##  3 sim1_mod       3 10.4 
##  4 sim1_mod       4 12.4 
##  5 sim1_mod       5 14.5 
##  6 sim1_mod       6 16.5 
##  7 sim1_mod       7 18.6 
##  8 sim1_mod       8 20.6 
##  9 sim1_mod       9 22.7 
## 10 sim1_mod      10 24.7 
## 11 sim1_loess     1  5.34
## 12 sim1_loess     2  8.27
## 13 sim1_loess     3 10.8 
## 14 sim1_loess     4 12.8 
## 15 sim1_loess     5 14.6 
## 16 sim1_loess     6 16.6 
## 17 sim1_loess     7 18.7 
## 18 sim1_loess     8 20.8 
## 19 sim1_loess     9 22.6 
## 20 sim1_loess    10 24.0</code></pre>
<p>Функция <code>spread_predictions()</code> добавляет прогнозы из нескольких моделей, добавляя несколько столбцов (с добавлением названия модели) с прогнозами из каждой модели.</p>
<div class="sourceCode" id="cb2367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2367-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2367-2" data-line-number="2"><span class="st">  </span><span class="kw">spread_predictions</span>(sim1_mod, sim1_loess)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##        x sim1_mod sim1_loess
##    &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1     1     6.27       5.34
##  2     2     8.32       8.27
##  3     3    10.4       10.8 
##  4     4    12.4       12.8 
##  5     5    14.5       14.6 
##  6     6    16.5       16.6 
##  7     7    18.6       18.7 
##  8     8    20.6       20.8 
##  9     9    22.7       22.6 
## 10    10    24.7       24.0</code></pre>
<p>Функция <code>spread_predictions()</code> аналогична примеру, который запускает <code>add_predictions()</code> для каждой модели, и эквивалентна запуску <code>spread()</code> после запуска <code>collect_predictions()</code>:</p>
<div class="sourceCode" id="cb2369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2369-1" data-line-number="1">grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2369-2" data-line-number="2"><span class="st">  </span><span class="kw">gather_predictions</span>(sim1_mod, sim1_loess) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2369-3" data-line-number="3"><span class="st">  </span><span class="kw">spread</span>(model, pred)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##        x sim1_loess sim1_mod
##    &lt;int&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1     1       5.34     6.27
##  2     2       8.27     8.32
##  3     3      10.8     10.4 
##  4     4      12.8     12.4 
##  5     5      14.6     14.5 
##  6     6      16.6     16.5 
##  7     7      18.7     18.6 
##  8     8      20.8     20.6 
##  9     9      22.6     22.7 
## 10    10      24.0     24.7</code></pre>
</div>
<div id="-23.3.3.3" class="section level4">
<h4><span class="header-section-number">5.1.3.5</span> Упражнение 23.3.3.3</h4>
<div class="question">
<p>What does <code>geom_ref_line()</code> do?
What package does it come from?
Why is displaying a reference line in plots showing residuals useful and important?</p>
</div>
<p><code>geom_ref_line()</code> добавляет в качестве опорной линии на участок.
В примере выше это был ноль.
В принципе, это эквивалентно запуску <code>geom_hline()</code> или <code>geom_vline()</code> с настройками по умолчанию, которые полезны для визуализации моделей.
Поместить опорную линию в ноль для остатков важно, потому что хорошие модели (как правило) должны иметь остатки, центрированные в нуле, с примерно той же дисперсией (или распределением) по отношению к поддержке <code>x</code> и без корреляции.
Нулевая контрольная линия облегчает визуальную оценку этих характеристик.</p>
</div>
<div id="-23.3.3.4" class="section level4">
<h4><span class="header-section-number">5.1.3.6</span> Упражнение 23.3.3.4</h4>
<div class="question">
<p>Why might you want to look at a frequency polygon of absolute residuals? W
hat are the pros and cons compared to looking at the raw residuals?</p>
</div>
<p>Отображение абсолютных значений остатков облегчает просмотр распределения остатков.
Модель предполагает, что остатки имеют средний ноль, а использование абсолютных значений остатков фактически удваивает число остатков.</p>
<div class="sourceCode" id="cb2371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2371-1" data-line-number="1">sim1_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim1)</a>
<a class="sourceLine" id="cb2371-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2371-3" data-line-number="3">sim1 &lt;-<span class="st"> </span>sim1 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2371-4" data-line-number="4"><span class="st">  </span><span class="kw">add_residuals</span>(sim1_mod)</a>
<a class="sourceLine" id="cb2371-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2371-6" data-line-number="6"><span class="kw">ggplot</span>(sim1, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">abs</span>(resid))) <span class="op">+</span></a>
<a class="sourceLine" id="cb2371-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1101-1.png" width="672" /></p>
<p>Однако использование абсолютных значений невязок отбрасывает информацию о знаке, а это означает, что многоугольник частоты не может показать, насколько модель систематически переоценивает или занижает невязки.</p>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">5.1.4</span> Формулы и семейства моделей</h3>
<p>ДО этого мы уже сталкивались с формулами, когда использовали функции <code>facet_wrap()</code> и <code>facet_grid()</code>. В R формулы обуспечивают обзий способ получения специального поведения.</p>
<p>Вместо того чтобы сразу же использовать переменные в вычислениях, они захватыввают их для последующей интепретации с помощью функции.</p>
<p>Большинство функций моделирования в R используют стандартное преобразование от формул к функциям. Один из примеров простого преобразования:</p>
<p><code>y ~ x</code> — <code>y = a_1 + a_2 * x</code></p>
<p>Если нужно увидеть что фактически делает R, можно использовать функцию <code>model_matrix()</code>.
Эта функция принимает фрейм данных и формулу и возвращает tibble-фрейм, определяющий уравнение модели: каждый столбец результата связан с одним коэффициентом модели, а функция всегда имеет вид <code>y = a_1 * out + a_2 * out_2</code>.
Для простого случая <code>y ~ x1</code> мы получаем нечто любопытное.</p>
<div class="sourceCode" id="cb2372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2372-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2372-2" data-line-number="2">  <span class="op">~</span>y, <span class="op">~</span>x1, <span class="op">~</span>x2,</a>
<a class="sourceLine" id="cb2372-3" data-line-number="3">  <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb2372-4" data-line-number="4">  <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">6</span></a>
<a class="sourceLine" id="cb2372-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb2372-6" data-line-number="6"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span>x1)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   `(Intercept)`    x1
##           &lt;dbl&gt; &lt;dbl&gt;
## 1             1     2
## 2             1     1</code></pre>
<p>По умолчанию R добавляет столбец заполненный единицами. Если гнужно отказаться от него добавим в формулу <code>-1</code></p>
<div class="sourceCode" id="cb2374"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2374-1" data-line-number="1"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span>x1 <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 1
##      x1
##   &lt;dbl&gt;
## 1     2
## 2     1</code></pre>
<p>При добавлении дополнительных переменных в модель размер матрицы модели, как и следовало ожидать, увеличивается</p>
<div class="sourceCode" id="cb2376"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2376-1" data-line-number="1"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   `(Intercept)`    x1    x2
##           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1             1     2     5
## 2             1     1     6</code></pre>
<p>Здесь <a href="https://www.jstor.org/stable/2346786?read-now=1&amp;seq=1#metadata_info_tab_contents" class="uri">https://www.jstor.org/stable/2346786?read-now=1&amp;seq=1#metadata_info_tab_contents</a> подробнее о символьных преобразованиях.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.1.4.1</span> Категориальные переменные</h4>
<p>Если предиктором является непрерывная переменная, то генерация функции из формулы осуществляется непосредственным образом, но если предикатор — категориальная переменная, то всё немного усложняется.</p>
<p>Предположим, имеется формула наподобие <code>y ~ sex</code>, где переменная <code>sex</code> — может принимать два значения, которые обозначают мужчину и женщину (<code>male</code> и <code>female</code>). Преобразовать эту формулу к виду <code>y = x_1 + x_2 * sex</code> не имеет смысла, поскольку переменная <code>sex</code> не является числом — она просто не может участвовать в умножении. Вместо этого R преобразует её к виду <code>y = x_1 + x_2 * sex_male</code>, где sex_male принимает 1 для мужчин и 0 для женщин.</p>
<div class="sourceCode" id="cb2378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2378-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2378-2" data-line-number="2">  <span class="op">~</span><span class="st"> </span>sex, <span class="op">~</span><span class="st"> </span>response,</a>
<a class="sourceLine" id="cb2378-3" data-line-number="3">  <span class="st">&quot;male&quot;</span>, <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2378-4" data-line-number="4">  <span class="st">&quot;female&quot;</span>, <span class="dv">2</span>,</a>
<a class="sourceLine" id="cb2378-5" data-line-number="5">  <span class="st">&quot;male&quot;</span>, <span class="dv">1</span></a>
<a class="sourceLine" id="cb2378-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2378-7" data-line-number="7"><span class="kw">model_matrix</span>(df, response <span class="op">~</span><span class="st"> </span>sex)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   `(Intercept)` sexmale
##           &lt;dbl&gt;   &lt;dbl&gt;
## 1             1       1
## 2             1       0
## 3             1       1</code></pre>
<p>Используем набор данных <code>sim2</code> для того чтобы конкретизировать общие утверждения о точной параметризации.</p>
<div class="sourceCode" id="cb2380"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2380-1" data-line-number="1"><span class="kw">ggplot</span>(sim2) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2380-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(x, y))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1106-1.png" width="672" /></p>
<p>Мы можем подобрать модель для этого набора данных и сгенерировать прогноз.</p>
<div class="sourceCode" id="cb2381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2381-1" data-line-number="1">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim2)</a>
<a class="sourceLine" id="cb2381-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2381-3" data-line-number="3">grid &lt;-<span class="st"> </span>sim2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2381-4" data-line-number="4"><span class="st">  </span><span class="kw">data_grid</span>(x) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2381-5" data-line-number="5"><span class="st">  </span><span class="kw">add_predictions</span>(mod2)</a>
<a class="sourceLine" id="cb2381-6" data-line-number="6">grid</a></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   x      pred
##   &lt;chr&gt; &lt;dbl&gt;
## 1 a      1.15
## 2 b      8.12
## 3 c      6.13
## 4 d      1.91</code></pre>
<p>В конечном счете модель с категориальной переменной <code>x</code> будет предсказывать среднее значение для каждой категории. (Почему? потому что среднее минимизирует среднеквадратическое отклонение). Это можно легко увидеть, если наложить предсказания на исходные данные.</p>
<div class="sourceCode" id="cb2383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2383-1" data-line-number="1"><span class="kw">ggplot</span>(sim2, <span class="kw">aes</span>(x)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2383-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2383-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> grid, <span class="kw">aes</span>(<span class="dt">y =</span> pred), <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">4</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1108-1.png" width="672" /></p>
<p>Вы не можете делать прогнозы относительно уровней, которые не наблюдали. Иногда это будет происходить случайно, поэтому стоит запомнить следующее сообщение об ошибке.</p>
<div class="sourceCode" id="cb2384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2384-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="st">&quot;e&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2384-2" data-line-number="2"><span class="st">  </span><span class="kw">add_predictions</span>(mod2)</a>
<a class="sourceLine" id="cb2384-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2384-4" data-line-number="4"><span class="co">#Ошибка в model.frame.default(Terms, newdata, na.action = na.action, xlev = #object$xlevels) :</span></a>
<a class="sourceLine" id="cb2384-5" data-line-number="5"><span class="co">#  длины переменных различаются (найдено в &#39;x2&#39;)</span></a>
<a class="sourceLine" id="cb2384-6" data-line-number="6"><span class="co">#Вдобавок: Предупреждение:</span></a>
<a class="sourceLine" id="cb2384-7" data-line-number="7"><span class="co">#&#39;newdata&#39; had 1 row but variables found have 100 rows </span></a></code></pre></div>
</div>
<div id="----" class="section level4">
<h4><span class="header-section-number">5.1.4.2</span> Взаимодействия — непрерывная и категориальная переменные</h4>
<p>Что происходит в тех случаях, когда непрерывная переменная сочетается с категориальной?</p>
<div class="sourceCode" id="cb2385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2385-1" data-line-number="1"><span class="kw">ggplot</span>(sim3, <span class="kw">aes</span>(x1, y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2385-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">color =</span> x2))</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1110-1.png" width="672" /></p>
<p>Для этих данных возможны две модели</p>
<div class="sourceCode" id="cb2386"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2386-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a>
<a class="sourceLine" id="cb2386-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a></code></pre></div>
<p>КОгда добавляешь модели с помощью знака <code>+</code> они оценивают каждый эффект независимо от всех остальных. Для подгонки так называемого взаиомодействия можно использовать знак <code>*</code>. Например <code>y ~ x1 * x2</code> транслируется в <code>y = a_0 + a_1 * x1 + a_2 * x2 + a_12 * x1 * x2</code>.
Когда используешь знак <code>*</code> в модель включается как взаимодействие, так и индивидуальная компонента.</p>
<p>Для визуализации понадобится два новшества</p>
<ul>
<li><p>У нас два предиктора, поэтому мы должны предоставить функции <code>data_grid()</code> обе переменные. Эта функция найдёт все уникальные значения <code>x1</code> и <code>x2</code> и сгенерирует все их комбинации</p></li>
<li><p>Чтобы сгенерировать прогнозы на основе сразу двух моделей, можно использовать функцию <code>gather_predictions()</code>, которая добавляет каждый прогноз в качестве строки. Комплементарной к функции <code>gather_predictions()</code> является <code>spread_predictions()</code>, которая добавляет каждый прогноз в новый столбец.</p></li>
</ul>
<p>Вместе это даёт нам следующее</p>
<div class="sourceCode" id="cb2387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2387-1" data-line-number="1">grid &lt;-<span class="st"> </span>sim3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2387-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(x1, x2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2387-3" data-line-number="3"><span class="st">  </span><span class="kw">gather_predictions</span>(mod1, mod2)</a></code></pre></div>
<p>Результаты для обеих моделей можно визуализировать на одном графике</p>
<div class="sourceCode" id="cb2388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2388-1" data-line-number="1"><span class="kw">ggplot</span>(sim3, <span class="kw">aes</span>(x1, y, <span class="dt">colour =</span> x2)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2388-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2388-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> grid, <span class="kw">aes</span>(<span class="dt">y =</span> pred)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2388-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1113-1.png" width="672" /></p>
<p>ВТорая модель интуитивно кажется более корректной.
Стоит обратить внимание, что во второй модели все прямые имеют разный угол наклона, тогда как при использовании <code>+</code> в <code>mod1</code> все прямые наклонены под одним углом но с разным intercept.</p>
<p>Чтобы убедиться в том, какая модель лучше описывает данные можно рассмотреть остатки.</p>
<div class="sourceCode" id="cb2389"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2389-1" data-line-number="1">sim3 &lt;-<span class="st"> </span>sim3 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2389-2" data-line-number="2"><span class="st">  </span><span class="kw">gather_residuals</span>(mod1, mod2)</a>
<a class="sourceLine" id="cb2389-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2389-4" data-line-number="4"><span class="kw">ggplot</span>(sim3, <span class="kw">aes</span>(x1, resid, <span class="dt">colour =</span> x2)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2389-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2389-6" data-line-number="6"><span class="st">  </span><span class="kw">facet_grid</span>(model <span class="op">~</span><span class="st"> </span>x2)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1114-1.png" width="672" /></p>
<p>В остальном, нужна большая математическая подготовка, чтобы ответить на то, насколько вторая модель лучше чем первая.</p>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">5.1.4.3</span> Взаимодействия — две непрерывные переменные</h4>
<p>РАссмотрим эквивалентную модель для двух непрерывных переменных.</p>
<div class="sourceCode" id="cb2390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2390-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a>
<a class="sourceLine" id="cb2390-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a>
<a class="sourceLine" id="cb2390-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2390-4" data-line-number="4">grid &lt;-<span class="st"> </span>sim4 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2390-5" data-line-number="5"><span class="st">  </span><span class="kw">data_grid</span>(</a>
<a class="sourceLine" id="cb2390-6" data-line-number="6">    <span class="dt">x1 =</span> <span class="kw">seq_range</span>(x1, <span class="dv">5</span>), </a>
<a class="sourceLine" id="cb2390-7" data-line-number="7">    <span class="dt">x2 =</span> <span class="kw">seq_range</span>(x2, <span class="dv">5</span>) </a>
<a class="sourceLine" id="cb2390-8" data-line-number="8">  ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2390-9" data-line-number="9"><span class="st">  </span><span class="kw">gather_predictions</span>(mod1, mod2)</a>
<a class="sourceLine" id="cb2390-10" data-line-number="10">grid</a></code></pre></div>
<pre><code>## # A tibble: 50 x 4
##    model    x1    x2   pred
##    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 mod1   -1    -1    0.996
##  2 mod1   -1    -0.5 -0.395
##  3 mod1   -1     0   -1.79 
##  4 mod1   -1     0.5 -3.18 
##  5 mod1   -1     1   -4.57 
##  6 mod1   -0.5  -1    1.91 
##  7 mod1   -0.5  -0.5  0.516
##  8 mod1   -0.5   0   -0.875
##  9 mod1   -0.5   0.5 -2.27 
## 10 mod1   -0.5   1   -3.66 
## # … with 40 more rows</code></pre>
<p>удобный приём с <code>seq_range()</code>. Вместо того чтобы использовать каждое уникальное значение <code>х</code> мы собираемся задействовать регулярную сетку из <em>пяти</em> значений, равномерно расположенных между минимальным и максимальным значением.</p>
<p>Функция <code>seq_range()</code> имеет три других полезных аргумента</p>
<ul>
<li><code>pretty = TRUE</code> — генерирует красивую последовательность. Т.е. ту, которая хорошо воспринимается человеческим глазом.</li>
</ul>
<div class="sourceCode" id="cb2392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2392-1" data-line-number="1"><span class="kw">seq_range</span>(<span class="kw">c</span>(<span class="fl">0.0123</span>, <span class="fl">0.923423</span>), <span class="dt">n =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 0.0123000 0.2400808 0.4678615 0.6956423 0.9234230</code></pre>
<div class="sourceCode" id="cb2394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2394-1" data-line-number="1"><span class="kw">seq_range</span>(<span class="kw">c</span>(<span class="fl">0.0123</span>, <span class="fl">0.923423</span>), <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">pretty =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] 0.0 0.2 0.4 0.6 0.8 1.0</code></pre>
<ul>
<li><code>trim = 0.1</code> — отсекает 10% хвостовых значений. Это полезно, если распределение имеет длинные хвосты и нужно сосредоточится на генерировании значений вблизи центра</li>
</ul>
<div class="sourceCode" id="cb2396"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2396-1" data-line-number="1">x1 &lt;-<span class="st"> </span><span class="kw">rcauchy</span>(<span class="dv">100</span>)</a>
<a class="sourceLine" id="cb2396-2" data-line-number="2"><span class="kw">seq_range</span>(x1, <span class="dt">n =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] -67.87071  42.52342 152.91756 263.31169 373.70583</code></pre>
<div class="sourceCode" id="cb2398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2398-1" data-line-number="1"><span class="kw">seq_range</span>(x1, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">trim =</span> <span class="fl">0.10</span>)</a></code></pre></div>
<pre><code>## [1] -5.018429 -1.334279  2.349870  6.034020  9.718170</code></pre>
<div class="sourceCode" id="cb2400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2400-1" data-line-number="1"><span class="kw">seq_range</span>(x1, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">trim =</span> <span class="fl">0.25</span>)</a></code></pre></div>
<pre><code>## [1] -2.4381800 -0.8470327  0.7441146  2.3352618  3.9264091</code></pre>
<div class="sourceCode" id="cb2402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2402-1" data-line-number="1"><span class="kw">seq_range</span>(x1, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">trim =</span> <span class="fl">0.50</span>)</a></code></pre></div>
<pre><code>## [1] -0.90788400 -0.42094842  0.06598715  0.55292273  1.03985830</code></pre>
<ul>
<li><code>expand = 0.1</code> — производит эффект, в некотором смысле противоположный эффекту <code>trim</code>, приводя расширение диапазона на 10%</li>
</ul>
<div class="sourceCode" id="cb2404"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2404-1" data-line-number="1">x2 &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2404-2" data-line-number="2"><span class="kw">seq_range</span>(x2, <span class="dt">n =</span> <span class="dv">5</span>)</a></code></pre></div>
<pre><code>## [1] 0.00 0.25 0.50 0.75 1.00</code></pre>
<div class="sourceCode" id="cb2406"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2406-1" data-line-number="1"><span class="kw">seq_range</span>(x2, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">expand =</span> <span class="fl">0.10</span>)</a></code></pre></div>
<pre><code>## [1] -0.050  0.225  0.500  0.775  1.050</code></pre>
<div class="sourceCode" id="cb2408"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2408-1" data-line-number="1"><span class="kw">seq_range</span>(x2, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">expand =</span> <span class="fl">0.25</span>)</a></code></pre></div>
<pre><code>## [1] -0.1250  0.1875  0.5000  0.8125  1.1250</code></pre>
<div class="sourceCode" id="cb2410"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2410-1" data-line-number="1"><span class="kw">seq_range</span>(x2, <span class="dt">n =</span> <span class="dv">5</span>, <span class="dt">expand =</span> <span class="fl">0.50</span>)</a></code></pre></div>
<pre><code>## [1] -0.250  0.125  0.500  0.875  1.250</code></pre>
<p>Попробуем визуализировать эту модель. У нас имеется два непрерывных предиктора, поэтому мы можем представить модель в виде трехмерной поверхности. Для её отображения можно воспользовать функцией <code>geom_tile()</code></p>
<div class="sourceCode" id="cb2412"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2412-1" data-line-number="1"><span class="kw">ggplot</span>(grid, <span class="kw">aes</span>(x1, x2)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2412-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">fill =</span> pred)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2412-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1119-1.png" width="672" /></p>
<p>Из результатов не следует, что модели сильно различаются.
Отчасти это оптическая иллюзия — наши глаза и мозг недостаточно чувствительны, если речь идёт о различении цветовых оттенков.
Вместо того чтобы всматриваться на поверхность сверху, мы можем посмотреть на неё с любой другой строноы и продемонстрировать не один срез.</p>
<div class="sourceCode" id="cb2413"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2413-1" data-line-number="1"><span class="kw">ggplot</span>(grid, <span class="kw">aes</span>(x1, pred, <span class="dt">colour =</span> x2, <span class="dt">group =</span> x2)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2413-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2413-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1120-1.png" width="672" /></p>
<div class="sourceCode" id="cb2414"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2414-1" data-line-number="1"><span class="kw">ggplot</span>(grid, <span class="kw">aes</span>(x2, pred, <span class="dt">colour =</span> x1, <span class="dt">group =</span> x1)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2414-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2414-3" data-line-number="3"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1120-2.png" width="672" /></p>
<p>Как показывают результаты — взаимодействие двух непрерывных переменных работает в основном так же, как и взаимодействие категориальной и непрерывной переменных.
Взаимодействие указывает на отсутствие фиксированного сдвига — для того чтобы прогнозировать значения <code>y</code>, необходимо рассматривать одновременно значения <code>x1</code> и <code>x2</code></p>
<p>Модель не должна быть идеальной — она должна лишь помогать обнаруживать пусть даже небольшую дополнительную информацию о данных.</p>
<p>Мы посвятили некоторое время рассмотрению остатков, чтобы посмотреть, сможем ли мы определить что <code>mod2</code> работает лучше чем <code>mod1</code>. Судя по всему, это так, но различие мужду ними довольно незначительное.</p>
</div>
<div class="section level4">
<h4><span class="header-section-number">5.1.4.4</span> Преобразования</h4>
<p>В формуле модели так же можно выполнять преобразования. Например <code>log(y) ~ sqrt(x1) + x2</code> преобразуется в <code>log(y) = a_1 + a_2 * sqrt(x1) + a_3 * x2</code></p>
<p>Если преобразование включает операторы <code>+</code>, <code>*</code>, <code>^</code>, <code>-</code> то те части формулы в которых эти операторы используются в качестве арифметических, необходимо обернуть в функцию <code>I()</code>, чтобы R не обрабатывал их как символические операторы специфицкации модели.
Например <code>y ~ x + I(x ^ 2)</code> преобразуется в <code>y = a_1 + a_2 * x + a_3 * x^2</code></p>
<p>Если получается что-то не то, что хотелось увидеть можно посмотреть при помощи <code>model_matrix()</code> в соответствии с каким уравнение функция <code>lm()</code> строит модель</p>
<div class="sourceCode" id="cb2415"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2415-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2415-2" data-line-number="2">  <span class="op">~</span>y, <span class="op">~</span>x,</a>
<a class="sourceLine" id="cb2415-3" data-line-number="3">   <span class="dv">1</span>,  <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2415-4" data-line-number="4">   <span class="dv">2</span>,  <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb2415-5" data-line-number="5">   <span class="dv">3</span>,  <span class="dv">3</span></a>
<a class="sourceLine" id="cb2415-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2415-7" data-line-number="7"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span>x<span class="op">^</span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>x)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   `(Intercept)`     x
##           &lt;dbl&gt; &lt;dbl&gt;
## 1             1     1
## 2             1     2
## 3             1     3</code></pre>
<div class="sourceCode" id="cb2417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2417-1" data-line-number="1"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(x<span class="op">^</span><span class="dv">2</span>) <span class="op">+</span><span class="st"> </span>x)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   `(Intercept)` `I(x^2)`     x
##           &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;
## 1             1        1     1
## 2             1        4     2
## 3             1        9     3</code></pre>
<p>ПРеобразования полезны тем, что их можно использовать для аппроксимации нелинейных функций.
Ряд Тейлора — любую гладкую функцию можно разложить на бесконечную сумму многочленов.</p>
<p>Их можно задавать в R при помощи встроенной функции <code>poly()</code>. Так уравнение наподобие <code>y = a_1 + a_2 * x + a_3 * x^2 + a_4 * x ^ 3</code> будет записано в</p>
<div class="sourceCode" id="cb2419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2419-1" data-line-number="1"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(x, <span class="dv">2</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   `(Intercept)` `poly(x, 2)1` `poly(x, 2)2`
##           &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
## 1             1     -7.07e- 1         0.408
## 2             1     -7.85e-17        -0.816
## 3             1      7.07e- 1         0.408</code></pre>
<p>Однако с использование функции <code>poly()</code> существует серьёзная проблема — за пределами диапазона данных значения полинома быстро стремятся к положительной или отрицательной бесконечности. Одна из безопасных альтернатив заключается в использовании натуральных сплайнов <code>splines::ns()</code></p>
<div class="sourceCode" id="cb2421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2421-1" data-line-number="1"><span class="kw">model_matrix</span>(df, y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dv">2</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   `(Intercept)` `ns(x, 2)1` `ns(x, 2)2`
##           &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;
## 1             1       0           0    
## 2             1       0.566      -0.211
## 3             1       0.344       0.771</code></pre>
<p>Посмотрим как это будет выглядеть при попытке аппроксимации нелинейной функции</p>
<div class="sourceCode" id="cb2423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2423-1" data-line-number="1">sim5 &lt;-<span class="st"> </span><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2423-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="fl">3.5</span> <span class="op">*</span><span class="st"> </span>pi, <span class="dt">length =</span> <span class="dv">50</span>),</a>
<a class="sourceLine" id="cb2423-3" data-line-number="3">  <span class="dt">y =</span> <span class="dv">4</span> <span class="op">*</span><span class="st"> </span><span class="kw">sin</span>(x) <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="kw">length</span>(x))</a>
<a class="sourceLine" id="cb2423-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb2423-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2423-6" data-line-number="6"><span class="kw">ggplot</span>(sim5, <span class="kw">aes</span>(x, y)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2423-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1124-1.png" width="672" /></p>
<p>Мы собираемся построить 5 моделей для этих данных</p>
<div class="sourceCode" id="cb2424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2424-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dv">1</span>), <span class="dt">data =</span> sim5)</a>
<a class="sourceLine" id="cb2424-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dv">2</span>), <span class="dt">data =</span> sim5)</a>
<a class="sourceLine" id="cb2424-3" data-line-number="3">mod3 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dv">3</span>), <span class="dt">data =</span> sim5)</a>
<a class="sourceLine" id="cb2424-4" data-line-number="4">mod4 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dv">4</span>), <span class="dt">data =</span> sim5)</a>
<a class="sourceLine" id="cb2424-5" data-line-number="5">mod5 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span><span class="kw">ns</span>(x, <span class="dv">5</span>), <span class="dt">data =</span> sim5)</a>
<a class="sourceLine" id="cb2424-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2424-7" data-line-number="7">grid &lt;-<span class="st"> </span>sim5 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2424-8" data-line-number="8"><span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">x =</span> <span class="kw">seq_range</span>(x, <span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">expand =</span> <span class="fl">0.1</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2424-9" data-line-number="9"><span class="st">  </span><span class="kw">gather_predictions</span>(mod1, mod2, mod3, mod4, mod5, <span class="dt">.pred =</span> <span class="st">&quot;y&quot;</span>)</a>
<a class="sourceLine" id="cb2424-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2424-11" data-line-number="11"><span class="kw">ggplot</span>(sim5, <span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2424-12" data-line-number="12"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2424-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> grid, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2424-14" data-line-number="14"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>model)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1125-1.png" width="672" /></p>
<p>По графикку остатков, косвенно можно заключить, что модель 5 лучше остальных справляется с предсказанием.</p>
<div class="sourceCode" id="cb2425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2425-1" data-line-number="1">grid2 &lt;-<span class="st"> </span>sim5 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2425-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">x =</span> <span class="kw">seq_range</span>(x, <span class="dt">n =</span> <span class="dv">50</span>, <span class="dt">expand =</span> <span class="fl">0.1</span>))</a>
<a class="sourceLine" id="cb2425-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2425-4" data-line-number="4">sim5 &lt;-<span class="st"> </span>sim5 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2425-5" data-line-number="5"><span class="st">  </span><span class="kw">gather_residuals</span>(mod1, mod2, mod3, mod4, mod5)</a>
<a class="sourceLine" id="cb2425-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2425-7" data-line-number="7"><span class="kw">ggplot</span>(sim5, <span class="kw">aes</span>(x, resid, <span class="dt">color =</span> model)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2425-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2425-9" data-line-number="9"><span class="st">  </span><span class="kw">facet_grid</span>(model <span class="op">~</span><span class="st"> </span>.)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1126-1.png" width="672" /></p>
<p>Обратите внимание на явно низкую точность экстраполяции за пределами набора данных. Таков недостаток аппроксимации с помощью полиномов.
ОДнако это становится реальной проблемой для всех моделей: ни одна модель не позволяет судить о том, будет ли найденное поведение истинным при экстраполяции за пределы видимых данных. В подобном случае нужно полагаться на выводы научной теории.</p>
</div>
<div id="-23.4.5.1" class="section level4">
<h4><span class="header-section-number">5.1.4.5</span> Упражнение 23.4.5.1</h4>
<div class="question">
<p>What happens if you repeat the analysis of <code>sim2</code> using a model without an intercept.
What happens to the model equation?
What happens to the predictions?</p>
</div>
<p>Чтобы запустить модель без y-пересечения, добавьте -1 или + 0 к правой части формулы:</p>
<div class="sourceCode" id="cb2426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2426-1" data-line-number="1">mod2a &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> sim2)</a>
<a class="sourceLine" id="cb2426-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2426-3" data-line-number="3">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> sim2)</a></code></pre></div>
<p>Предсказания точно такие же в моделях с и без y-пересечения:</p>
<div class="sourceCode" id="cb2427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2427-1" data-line-number="1">grid &lt;-<span class="st"> </span>sim2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2427-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(x) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2427-3" data-line-number="3"><span class="st">  </span><span class="kw">spread_predictions</span>(mod2, mod2a)</a>
<a class="sourceLine" id="cb2427-4" data-line-number="4">grid</a></code></pre></div>
<pre><code>## # A tibble: 4 x 3
##   x      mod2 mod2a
##   &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 a      1.15  1.15
## 2 b      8.12  8.12
## 3 c      6.13  6.13
## 4 d      1.91  1.91</code></pre>
</div>
<div id="-23.4.5.2" class="section level4">
<h4><span class="header-section-number">5.1.4.6</span> Упражнение 23.4.5.2</h4>
<div class="question">
<p>Use <code>model_matrix()</code> to explore the equations generated for the models I fit to <code>sim3</code> and <code>sim4</code>.
Why is <code>*</code> a good shorthand for interaction?</p>
</div>
<p>Для <code>x1 * x2</code>, когда <code>x2</code> является <em>категориальной</em> переменной, создаются индикаторные переменные <code>x2b</code>, <code>x2c</code>, <code>x2d</code> и переменные <code>x1:x2b</code>, <code>x1:x2c</code> и <code>x1:x2d</code>, которые являются произведениями переменных <code>x1</code> и <code>x2</code>:</p>
<div class="sourceCode" id="cb2429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2429-1" data-line-number="1">x3 &lt;-<span class="st"> </span><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a>
<a class="sourceLine" id="cb2429-2" data-line-number="2">x3</a></code></pre></div>
<pre><code>## # A tibble: 240 x 8
##    `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`
##            &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1             1     1     0     0     0        0        0        0
##  2             1     1     0     0     0        0        0        0
##  3             1     1     0     0     0        0        0        0
##  4             1     1     1     0     0        1        0        0
##  5             1     1     1     0     0        1        0        0
##  6             1     1     1     0     0        1        0        0
##  7             1     1     0     1     0        0        1        0
##  8             1     1     0     1     0        0        1        0
##  9             1     1     0     1     0        0        1        0
## 10             1     1     0     0     1        0        0        1
## # … with 230 more rows</code></pre>
<p>Мы можем подтвердить, что переменные <code>x1:x2b</code> являются произведением <code>x1</code> и <code>x2b</code></p>
<div class="sourceCode" id="cb2431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2431-1" data-line-number="1"><span class="kw">all</span>(x3[[<span class="st">&quot;x1:x2b&quot;</span>]] <span class="op">==</span><span class="st"> </span>(x3[[<span class="st">&quot;x1&quot;</span>]] <span class="op">*</span><span class="st"> </span>x3[[<span class="st">&quot;x2b&quot;</span>]]))</a></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>Для <code>x1 * x2</code>, где <code>x1</code> и <code>x2</code> являются <em>непрерывными</em> переменными, <code>model_matrix()</code> создает переменные <code>x1</code>, <code>x2</code> и <code>x1:x2</code>:</p>
<div class="sourceCode" id="cb2433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2433-1" data-line-number="1">x4 &lt;-<span class="st"> </span><span class="kw">model_matrix</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a>
<a class="sourceLine" id="cb2433-2" data-line-number="2">x4</a></code></pre></div>
<pre><code>## # A tibble: 300 x 4
##    `(Intercept)`    x1     x2 `x1:x2`
##            &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
##  1             1    -1 -1       1    
##  2             1    -1 -1       1    
##  3             1    -1 -1       1    
##  4             1    -1 -0.778   0.778
##  5             1    -1 -0.778   0.778
##  6             1    -1 -0.778   0.778
##  7             1    -1 -0.556   0.556
##  8             1    -1 -0.556   0.556
##  9             1    -1 -0.556   0.556
## 10             1    -1 -0.333   0.333
## # … with 290 more rows</code></pre>
<p>Звездочка <code>*</code> является хорошим сокращением для взаимодействия, поскольку взаимодействие между <code>x1</code> и <code>x2</code> включает в себя слагаемые для <code>x1</code>, <code>x2</code> и произведение <code>x1</code> и <code>x2</code>.</p>
</div>
<div id="-23.4.5.3" class="section level4">
<h4><span class="header-section-number">5.1.4.7</span> Упражнение 23.4.5.3</h4>
<div class="question">
<p>Using the basic principles, convert the formulas in the following two models into functions. (Hint: start by converting the categorical variable into 0-1 variables.)</p>
<div class="sourceCode" id="cb2435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2435-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a>
<a class="sourceLine" id="cb2435-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim3)</a></code></pre></div>
</div>
<p>Задача состоит в том, чтобы преобразовать формулы в моделях в функции. Я предполагаю, что функция обрабатывает только преобразование правой части формулы в матрицу модели. Функции будут принимать один аргумент - фрейм данных со столбцами <code>x1</code> и <code>x2</code> и возвращать фрейм данных. Другими словами, функции будут частными случаями функции <code>model_matrix()</code>.</p>
<p>Рассмотрим правую часть первой формулы <code>~ x1 + x2</code>. Во фрейме данных <code>sim3</code> столбец <code>x1</code> представляет собой целое число, а переменная <code>x2</code> представляет собой множитель с четырьмя уровнями.</p>
<div class="sourceCode" id="cb2436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2436-1" data-line-number="1"><span class="kw">levels</span>(sim3<span class="op">$</span>x2)</a></code></pre></div>
<pre><code>## [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot;</code></pre>
<p>Поскольку <code>x1</code> является числовым, оно не изменяется. Поскольку <code>x2</code> является фактором, он заменяется столбцами переменных индикатора для всех уровней, кроме одного. Сначала я рассмотрю особый случай, когда <code>x2</code> принимает только уровни <code>x2</code> в <code>sim3</code>. В этом случае <code>«a»</code> считается опорным уровнем и опускается, и создаются новые столбцы для <code>«b»</code>, <code>«c»</code> и <code>«d»</code>.</p>
<div class="sourceCode" id="cb2438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2438-1" data-line-number="1">model_matrix_mod1 &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb2438-2" data-line-number="2">  <span class="kw">mutate</span>(.data,</a>
<a class="sourceLine" id="cb2438-3" data-line-number="3">    <span class="dt">x2b =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb2438-4" data-line-number="4">    <span class="dt">x2c =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb2438-5" data-line-number="5">    <span class="dt">x2d =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;d&quot;</span>),</a>
<a class="sourceLine" id="cb2438-6" data-line-number="6">    <span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2438-7" data-line-number="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2438-8" data-line-number="8"><span class="st">    </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span>, x1, x2b, x2c, x2d)</a>
<a class="sourceLine" id="cb2438-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb2438-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2438-11" data-line-number="11"><span class="kw">model_matrix_mod1</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 240 x 5
##    `(Intercept)`    x1   x2b   x2c   x2d
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1             1     1     0     0     0
##  2             1     1     0     0     0
##  3             1     1     0     0     0
##  4             1     1     1     0     0
##  5             1     1     1     0     0
##  6             1     1     1     0     0
##  7             1     1     0     1     0
##  8             1     1     0     1     0
##  9             1     1     0     1     0
## 10             1     1     0     0     1
## # … with 230 more rows</code></pre>
<p>Более общая функция для <code>~ x1 + x2</code> не будет жестко кодировать конкретные уровни в <code>x2</code>.</p>
<div class="sourceCode" id="cb2440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2440-1" data-line-number="1">model_matrix_mod1b &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb2440-2" data-line-number="2">  <span class="co"># уровни x2</span></a>
<a class="sourceLine" id="cb2440-3" data-line-number="3">  lvls &lt;-<span class="st"> </span><span class="kw">levels</span>(.data<span class="op">$</span>x2)</a>
<a class="sourceLine" id="cb2440-4" data-line-number="4">  <span class="co"># отбросим первый уровень</span></a>
<a class="sourceLine" id="cb2440-5" data-line-number="5">  <span class="co"># this assumes that there are at least two levels</span></a>
<a class="sourceLine" id="cb2440-6" data-line-number="6">  lvls &lt;-<span class="st"> </span>lvls[<span class="dv">2</span><span class="op">:</span><span class="kw">length</span>(lvls)]</a>
<a class="sourceLine" id="cb2440-7" data-line-number="7">  <span class="co"># create an indicator variable for each level of x2</span></a>
<a class="sourceLine" id="cb2440-8" data-line-number="8">  <span class="cf">for</span> (lvl <span class="cf">in</span> lvls) {</a>
<a class="sourceLine" id="cb2440-9" data-line-number="9">    <span class="co"># new column name x2 + level name</span></a>
<a class="sourceLine" id="cb2440-10" data-line-number="10">    varname &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;x2&quot;</span>, lvl)</a>
<a class="sourceLine" id="cb2440-11" data-line-number="11">    <span class="co"># add indicator variable for lvl</span></a>
<a class="sourceLine" id="cb2440-12" data-line-number="12">    .data[[varname]] &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(.data<span class="op">$</span>x2 <span class="op">==</span><span class="st"> </span>lvl)</a>
<a class="sourceLine" id="cb2440-13" data-line-number="13">  }</a>
<a class="sourceLine" id="cb2440-14" data-line-number="14">  <span class="co"># generate the list of variables to keep</span></a>
<a class="sourceLine" id="cb2440-15" data-line-number="15">  x2_variables &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;x2&quot;</span>, lvls)</a>
<a class="sourceLine" id="cb2440-16" data-line-number="16">  <span class="co"># Add an intercept</span></a>
<a class="sourceLine" id="cb2440-17" data-line-number="17">  .data[[<span class="st">&quot;(Intercept)&quot;</span>]] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2440-18" data-line-number="18">  <span class="co"># keep x1 and x2 indicator variables</span></a>
<a class="sourceLine" id="cb2440-19" data-line-number="19">  <span class="kw">select</span>(.data, <span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span>, x1, <span class="kw">one_of</span>(x2_variables))</a>
<a class="sourceLine" id="cb2440-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb2440-21" data-line-number="21"></a>
<a class="sourceLine" id="cb2440-22" data-line-number="22"><span class="kw">model_matrix_mod1b</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 240 x 5
##    `(Intercept)`    x1   x2b   x2c   x2d
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1             1     1     0     0     0
##  2             1     1     0     0     0
##  3             1     1     0     0     0
##  4             1     1     1     0     0
##  5             1     1     1     0     0
##  6             1     1     1     0     0
##  7             1     1     0     1     0
##  8             1     1     0     1     0
##  9             1     1     0     1     0
## 10             1     1     0     0     1
## # … with 230 more rows</code></pre>
<p>Рассмотрим правую часть первой формулы <code>~ x1 * x2</code>. Фрейм выходных данных будет состоять из <code>x1</code>, столбцов с переменными индикатора для каждого уровня (кроме контрольного уровня) <code>x2</code> и столбцов с переменными индикатора <code>x2</code>, умноженными на <code>x1.</code></p>
<p>Как и в предыдущей формуле, сначала я напишу функцию, которая жестко кодирует уровни <code>x2</code>.</p>
<div class="sourceCode" id="cb2442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2442-1" data-line-number="1">model_matrix_mod2 &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb2442-2" data-line-number="2">  <span class="kw">mutate</span>(.data,</a>
<a class="sourceLine" id="cb2442-3" data-line-number="3">    <span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span> =<span class="st"> </span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb2442-4" data-line-number="4">    <span class="dt">x2b =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;b&quot;</span>),</a>
<a class="sourceLine" id="cb2442-5" data-line-number="5">    <span class="dt">x2c =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;c&quot;</span>),</a>
<a class="sourceLine" id="cb2442-6" data-line-number="6">    <span class="dt">x2d =</span> <span class="kw">as.numeric</span>(x2 <span class="op">==</span><span class="st"> &quot;d&quot;</span>),</a>
<a class="sourceLine" id="cb2442-7" data-line-number="7">    <span class="st">`</span><span class="dt">x1:x2b</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2b,</a>
<a class="sourceLine" id="cb2442-8" data-line-number="8">    <span class="st">`</span><span class="dt">x1:x2c</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2c,</a>
<a class="sourceLine" id="cb2442-9" data-line-number="9">    <span class="st">`</span><span class="dt">x1:x2d</span><span class="st">`</span> =<span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2d</a>
<a class="sourceLine" id="cb2442-10" data-line-number="10">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2442-11" data-line-number="11"><span class="st">    </span><span class="kw">select</span>(<span class="st">`</span><span class="dt">(Intercept)</span><span class="st">`</span>, x1, x2b, x2c, x2d, <span class="st">`</span><span class="dt">x1:x2b</span><span class="st">`</span>, <span class="st">`</span><span class="dt">x1:x2c</span><span class="st">`</span>, <span class="st">`</span><span class="dt">x1:x2d</span><span class="st">`</span>)</a>
<a class="sourceLine" id="cb2442-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb2442-13" data-line-number="13"></a>
<a class="sourceLine" id="cb2442-14" data-line-number="14"><span class="kw">model_matrix_mod2</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 240 x 8
##    `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1             1     1     0     0     0        0        0        0
##  2             1     1     0     0     0        0        0        0
##  3             1     1     0     0     0        0        0        0
##  4             1     1     1     0     0        1        0        0
##  5             1     1     1     0     0        1        0        0
##  6             1     1     1     0     0        1        0        0
##  7             1     1     0     1     0        0        1        0
##  8             1     1     0     1     0        0        1        0
##  9             1     1     0     1     0        0        1        0
## 10             1     1     0     0     1        0        0        1
## # … with 230 more rows</code></pre>
<p>Для более общей функции, которая будет обрабатывать произвольные уровни в <code>x2</code>, я расширю функцию <code>model_matrix_mod1b()</code>, которую я написал ранее.</p>
<div class="sourceCode" id="cb2444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2444-1" data-line-number="1">model_matrix_mod2b &lt;-<span class="st"> </span><span class="cf">function</span>(.data) {</a>
<a class="sourceLine" id="cb2444-2" data-line-number="2">  <span class="co"># get dataset with x1 and x2 indicator variables</span></a>
<a class="sourceLine" id="cb2444-3" data-line-number="3">  out &lt;-<span class="st"> </span><span class="kw">model_matrix_mod1b</span>(.data)</a>
<a class="sourceLine" id="cb2444-4" data-line-number="4">  <span class="co"># get names of the x2 indicator columns</span></a>
<a class="sourceLine" id="cb2444-5" data-line-number="5">  x2cols &lt;-<span class="st"> </span><span class="kw">str_subset</span>(<span class="kw">colnames</span>(out), <span class="st">&quot;^x2&quot;</span>)</a>
<a class="sourceLine" id="cb2444-6" data-line-number="6">  <span class="co"># create interactions between x1 and the x2 indicator columns</span></a>
<a class="sourceLine" id="cb2444-7" data-line-number="7">  <span class="cf">for</span> (varname <span class="cf">in</span> x2cols) {</a>
<a class="sourceLine" id="cb2444-8" data-line-number="8">    <span class="co"># name of the interaction variable</span></a>
<a class="sourceLine" id="cb2444-9" data-line-number="9">    newvar &lt;-<span class="st"> </span><span class="kw">str_c</span>(<span class="st">&quot;x1:&quot;</span>, varname)</a>
<a class="sourceLine" id="cb2444-10" data-line-number="10">    out[[newvar]] &lt;-<span class="st"> </span>out<span class="op">$</span>x1 <span class="op">*</span><span class="st"> </span>out[[varname]]</a>
<a class="sourceLine" id="cb2444-11" data-line-number="11">  }</a>
<a class="sourceLine" id="cb2444-12" data-line-number="12">  out</a>
<a class="sourceLine" id="cb2444-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb2444-14" data-line-number="14"></a>
<a class="sourceLine" id="cb2444-15" data-line-number="15"><span class="kw">model_matrix_mod2b</span>(sim3)</a></code></pre></div>
<pre><code>## # A tibble: 240 x 8
##    `(Intercept)`    x1   x2b   x2c   x2d `x1:x2b` `x1:x2c` `x1:x2d`
##            &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
##  1             1     1     0     0     0        0        0        0
##  2             1     1     0     0     0        0        0        0
##  3             1     1     0     0     0        0        0        0
##  4             1     1     1     0     0        1        0        0
##  5             1     1     1     0     0        1        0        0
##  6             1     1     1     0     0        1        0        0
##  7             1     1     0     1     0        0        1        0
##  8             1     1     0     1     0        0        1        0
##  9             1     1     0     1     0        0        1        0
## 10             1     1     0     0     1        0        0        1
## # … with 230 more rows</code></pre>
<p>Эти функции могут быть дополнительно обобщены, чтобы <code>x1</code> и <code>x2</code> могли быть либо числовыми, либо факторами. Однако, обобщив намного больше, мы скоро начнем переопределять все функции <code>matrix_model()</code>.</p>
</div>
<div id="-23.4.5.4" class="section level4">
<h4><span class="header-section-number">5.1.4.8</span> Упражнение 23.4.5.4</h4>
<div class="question">
<p>For <code>sim4</code>, which of <code>mod1</code> and <code>mod2</code> is better?
I think <code>mod2</code> does a slightly better job at removing patterns, but it’s pretty subtle. Can you come up with a plot to support my claim?</p>
</div>
<p>Оценим модели <code>mod1</code> и <code>mod2</code> на <code>sim4</code>,</p>
<div class="sourceCode" id="cb2446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2446-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">+</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a>
<a class="sourceLine" id="cb2446-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x1 <span class="op">*</span><span class="st"> </span>x2, <span class="dt">data =</span> sim4)</a></code></pre></div>
<p>Добавим остатки</p>
<div class="sourceCode" id="cb2447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2447-1" data-line-number="1">sim4_mods &lt;-<span class="st"> </span><span class="kw">gather_residuals</span>(sim4, mod1, mod2)</a></code></pre></div>
<p>Построим график частот для остатков обеих моделей</p>
<div class="sourceCode" id="cb2448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2448-1" data-line-number="1"><span class="kw">ggplot</span>(sim4_mods, <span class="kw">aes</span>(<span class="dt">x =</span> resid, <span class="dt">colour =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2448-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2448-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_rug</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1140-1.png" width="672" /></p>
<p>ПОстроим абсолютные значения остатков</p>
<div class="sourceCode" id="cb2449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2449-1" data-line-number="1"><span class="kw">ggplot</span>(sim4_mods, <span class="kw">aes</span>(<span class="dt">x =</span> <span class="kw">abs</span>(resid), <span class="dt">colour =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2449-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2449-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_rug</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1141-1.png" width="672" /></p>
<p>не показывает большой разницы в остатках между моделями. Тем не менее, у mod2, по-видимому, меньше остатков в хвостах распределения между 2,5 и 5 (хотя самые крайние остатки относятся к mod2.</p>
<p>Это подтверждается проверкой стандартного отклонения от остатков этих моделей,</p>
<div class="sourceCode" id="cb2450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2450-1" data-line-number="1">sim4_mods <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2450-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(model) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2450-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">resid =</span> <span class="kw">sd</span>(resid))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   model resid
##   &lt;chr&gt; &lt;dbl&gt;
## 1 mod1   2.10
## 2 mod2   2.07</code></pre>
<p>Стандартное отклонение остатков mod2, меньше, чем отклонение mod1</p>
</div>
</div>
<div id="--5" class="section level3">
<h3><span class="header-section-number">5.1.5</span> Отсутствующие значения</h3>
<p>Моделирующие функции будут пропускать любые строки, которые содержат missing values.
По умолчанию, об этом не выводится никаких сообщений об ошибке.
Можно вывести добавочной функцией</p>
<div class="sourceCode" id="cb2452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2452-1" data-line-number="1"><span class="kw">options</span>(<span class="dt">na.action =</span> na.warn)</a></code></pre></div>
<div class="sourceCode" id="cb2453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2453-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2453-2" data-line-number="2">  <span class="op">~</span>x, <span class="op">~</span>y,</a>
<a class="sourceLine" id="cb2453-3" data-line-number="3">  <span class="dv">1</span>, <span class="fl">2.2</span>,</a>
<a class="sourceLine" id="cb2453-4" data-line-number="4">  <span class="dv">2</span>, <span class="ot">NA</span>,</a>
<a class="sourceLine" id="cb2453-5" data-line-number="5">  <span class="dv">3</span>, <span class="fl">3.5</span>,</a>
<a class="sourceLine" id="cb2453-6" data-line-number="6">  <span class="dv">4</span>, <span class="fl">8.3</span>,</a>
<a class="sourceLine" id="cb2453-7" data-line-number="7">  <span class="ot">NA</span>, <span class="dv">10</span></a>
<a class="sourceLine" id="cb2453-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb2453-9" data-line-number="9"></a>
<a class="sourceLine" id="cb2453-10" data-line-number="10">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> df)</a></code></pre></div>
<pre><code>## Warning: Dropping 2 rows with missing values</code></pre>
<p>Для того чтобы подавить вывод сообщений нужно установить</p>
<div class="sourceCode" id="cb2455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2455-1" data-line-number="1"><span class="kw">options</span>(<span class="dt">na.action =</span> na.exclude)</a></code></pre></div>
<div class="sourceCode" id="cb2456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2456-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> df, <span class="dt">na.action =</span> na.exclude)</a></code></pre></div>
<p>Для того чтобы узнать сколько наблюдений было использовано</p>
<div class="sourceCode" id="cb2457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2457-1" data-line-number="1"><span class="kw">nobs</span>(mod)</a></code></pre></div>
<pre><code>## [1] 3</code></pre>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">5.1.6</span> Другие семейства моделей</h3>
<p>В главе выше мы заострили внимание на классе линейный моделей <code>y = a_1 * x1 + a_2 * x2 + ... + a_n * xn</code>.
В случае линейныз моделей дополнительно предполагается что остатки характеризуются нормальным распределением, которое мы ещё не обсуждали.</p>
<p>Существует большое разнообразие классов моделей.</p>
<ul>
<li><p><em>Обобщённые линейные модели</em> — например <code>stats::glm()</code>. В линейных моделях предполагается, что отклик является непрерывным, а ошибки подчиняются нормальному распределению. ОЛМ расширяют линейные модели, дополнительно включая возможность отклика, не являющегося непрерывным (например, двоичные данные или счётчики). Их работа базируется на определении меры расстояния, основанной на статистической идее правдоподобия</p></li>
<li><p><em>Обобщенные аддитивные модели</em> — например <code>mgcv::gam()</code>, расширяет обобщенные линейные модели для включения произвольных гладких функций. Это означает, что вы можете написать формулу, подобную <code>y ~ s(x)</code>, которая станет уравнением, подобным <code>y = f (x)</code>, и позволить <code>gam()</code> оценить, что это за функция (с учетом некоторых ограничений гладкости, чтобы сделать задачу решаемой).</p></li>
<li><p><em>Линейные модели со штрафом</em>, например <code>glmnet::glmnet()</code>, добавляют штрафной член к расстоянию, которое штрафует сложные модели (как определено расстоянием между вектором параметра и источником). Это приводит к тому, что модели лучше обобщаются на новые наборы данных из той же совокупности.</p></li>
<li><p><em>Робастные линейные модели</em>, например <code>MASS:rlm()</code>, корректирует расстояние до точек с пониженным весом, которые находятся очень далеко. Это делает их менее чувствительными к наличию выбросов, за счет того, что они не так хороши, когда нет выбросов.</p></li>
<li><p><em>Деревья</em>, например <code>rpart::rpart()</code>, работают совершенно иначе, чем линейные модели. Они используют кусочно-постоянную модель, разбивая данные на постепенно все меньшие и меньшие части. Деревья не очень эффективны сами по себе, но они очень мощны, когда используются в совокупности с такими моделями, как случайные леса (например, <code>randomForest::randomForest()</code>) или машины градиентного бустинга (например, <code>xgboost::xgboost</code>.)</p></li>
</ul>
<p>Ещё немного моделей</p>
<ul>
<li><p><a href="http://www-bcf.usc.edu/~gareth/ISL/" class="uri">http://www-bcf.usc.edu/~gareth/ISL/</a></p></li>
<li><p><a href="http://project-mosaic-books.com" class="uri">http://project-mosaic-books.com</a></p></li>
<li><p><a href="http://appliedpredictivemodeling.com" class="uri">http://appliedpredictivemodeling.com</a></p></li>
<li><p><a href="https://web.stanford.edu/~hastie/Papers/ESLII.pdf" class="uri">https://web.stanford.edu/~hastie/Papers/ESLII.pdf</a></p></li>
</ul>
<!--chapter:end:18_modelr.Rmd-->
</div>
</div>
<div id="-" class="section level2">
<h2><span class="header-section-number">5.2</span> Создание модели</h2>
<div id="-17" class="section level3">
<h3><span class="header-section-number">5.2.1</span> Введение</h3>
<p>В прошлой главе были искусственные данные, сейчас поработаем на реальных.</p>
<p>Порядок будет такой — мы будем обнаруживать тенденции посредством визуализации, а затем конкретизировать и уточнять из с помощью модели.
Затем мы повторим процесс, но заменим старую пременную отклика остатками, опеределённой модели.</p>
<p>Нашей целью является переход от неявных знаний, содержащихся в данных и наших головах, к явным знаниям, содержащимся в количественной модели. Это облешчит их применение в новых областях и использование другими людьми.</p>
<p>Нужно уметь вовремя остановится</p>
<p>Давным-давно на уроке рисования мой учитель сказал мне: «Художник должен знать, когда произведение готово. Вы не можете что-то настроить в совершенстве - заверните это. Если вам это не нравится, сделайте это снова. В противном случае начните что-то новое ». Позже я услышал: «Бедная швея делает много ошибок. Хорошая швея усердно работает над исправлением этих ошибок. Великая швея не боится выбросить одежду и начать все сначала ».</p>
<p><a href="https://www.reddit.com/r/datascience/comments/4irajq" class="uri">https://www.reddit.com/r/datascience/comments/4irajq</a></p>
<div id="--8" class="section level4">
<h4><span class="header-section-number">5.2.1.1</span> Необходимые ресурсы</h4>
<div class="sourceCode" id="cb2459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2459-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb2459-2" data-line-number="2"><span class="kw">library</span>(modelr)</a>
<a class="sourceLine" id="cb2459-3" data-line-number="3"><span class="kw">options</span>(<span class="dt">na.action =</span> na.warn)</a>
<a class="sourceLine" id="cb2459-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2459-5" data-line-number="5"><span class="kw">library</span>(nycflights13)</a>
<a class="sourceLine" id="cb2459-6" data-line-number="6"><span class="kw">library</span>(lubridate)</a></code></pre></div>
</div>
</div>
<div id="------" class="section level3">
<h3><span class="header-section-number">5.2.2</span> Почему бриллианты низкого качества оказались более дорогими</h3>
<p>В предыдущих главах мы наблюдали необычное соотношение между качеством бриллиантов и их ценой.
Бриллианты низкого качества, плохая огранка, неудачный цвет, и худшая чистота стоят дороже</p>
<div class="sourceCode" id="cb2460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2460-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(cut, price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1149-1.png" width="672" /></p>
<div class="sourceCode" id="cb2461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2461-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(color, price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1149-2.png" width="672" /></p>
<div class="sourceCode" id="cb2462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2462-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(clarity, price)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1149-3.png" width="672" /></p>
<p>Худший цвет бриллианта — J
Худший класс чистоты — I1</p>
<div id="--" class="section level4">
<h4><span class="header-section-number">5.2.2.1</span> Цена и вес</h4>
<p>Похоже, цена низкокачественных бриллиантов оказалась выше из-за одной важной переменной — <code>carat</code> (вес в каратах).
Вес бриллианта — единственно важный фактор, для определения его цены. А низкокачественные бриллианты имеют как правило большие размеры</p>
<div class="sourceCode" id="cb2463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2463-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds, <span class="kw">aes</span>(carat, price)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2463-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">50</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1150-1.png" width="672" /></p>
<p>Нам будет проще увидеть, как другие атрибуты бриллианта влияют на его относительную цену, если мы построим модель, отделяющую эффект прпеменной карат. Но сначала немного подправим набор данных, чтобы с ним легче было работать</p>
<ol style="list-style-type: decimal">
<li><p>Сфокусируемся на бриллиантах весом меньше 2.5 карата (99,7 данных)</p></li>
<li><p>Перейдём к логарифмам переменных карат и прайс</p></li>
</ol>
<div class="sourceCode" id="cb2464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2464-1" data-line-number="1">diamonds2 &lt;-<span class="st"> </span>diamonds <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2464-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(carat <span class="op">&lt;=</span><span class="st"> </span><span class="fl">2.5</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2464-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lprice =</span> <span class="kw">log2</span>(price), <span class="dt">lcarat =</span> <span class="kw">log2</span>(carat))</a></code></pre></div>
<p>Совместное внесение этих изменений упрощает выявление взаимосвязи переменных карат и прайс</p>
<div class="sourceCode" id="cb2465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2465-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(lcarat, lprice)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2465-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">50</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1152-1.png" width="672" /></p>
<p>В данном случае логарифмическое преобразование особенно удобно, посколько оно линеаризует шаблон, а с линейными шаблонами легче работать.</p>
<p>Сделем еще один шаг и исключим эту ярко выраженную линейную тенденцию. Сначала мы явно создаём шаблон путём построения модели</p>
<div class="sourceCode" id="cb2466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2466-1" data-line-number="1">mod_diamond &lt;-<span class="st"> </span><span class="kw">lm</span>(lprice <span class="op">~</span><span class="st"> </span>lcarat, <span class="dt">data =</span> diamonds2)</a></code></pre></div>
<p>Затем мы смотрим что говорит о данных эта модель. Мы выполняем обратное преобразование предсказаний отменяя логарифмическое преобразование, чтобы предсказания можно было наложить на исходные данные</p>
<div class="sourceCode" id="cb2467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2467-1" data-line-number="1">grid &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2467-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">carat =</span> <span class="kw">seq_range</span>(carat, <span class="dv">20</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2467-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lcarat =</span> <span class="kw">log2</span>(carat)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2467-4" data-line-number="4"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond, <span class="st">&quot;lprice&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2467-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">price =</span> <span class="dv">2</span> <span class="op">^</span><span class="st"> </span>lprice)</a>
<a class="sourceLine" id="cb2467-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2467-7" data-line-number="7"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(carat, price)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2467-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">50</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2467-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> grid, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">size =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1154-1.png" width="672" /></p>
<p>В результате получаем интересную информацию о данных. Если мы долверяем нашей модели, то большие бриллианты намного дешевле, мем можно было ожидать. Вероятно это объясняется тем, что ни один бриллиант в данном наборе не стоит более 19000 долларов.</p>
<p>Рассмотрение остатков подтверждает, что мы успешно исключили ярковыраженный линейный шаблон. На графике сплошное облако шума.</p>
<div class="sourceCode" id="cb2468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2468-1" data-line-number="1">diamonds2 &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2468-2" data-line-number="2"><span class="st">  </span><span class="kw">add_residuals</span>(mod_diamond, <span class="st">&quot;lresid&quot;</span>)</a>
<a class="sourceLine" id="cb2468-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2468-4" data-line-number="4"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(lcarat, lresid)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2468-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">50</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1155-1.png" width="672" /></p>
<p>Важно что теперь мы можем заново построить наши мотивирующие графики используя остатки, вместо переменной прайс</p>
<div class="sourceCode" id="cb2469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2469-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(cut, lresid)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1156-1.png" width="672" /></p>
<div class="sourceCode" id="cb2470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2470-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(color, lresid)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1156-2.png" width="672" /></p>
<div class="sourceCode" id="cb2471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2471-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(clarity, lresid)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1156-3.png" width="672" /></p>
<p>Теперь мы видим ожидаемую взаимосвязь — по мере улучшения качества бриллиантов растёт их относительная цена.
Для интерпретации оси игрее необходимо подумать о том, о чем на говорят остатки и по какой шкале они измеряются.</p>
<p>Остаток -1 указывает на то, что переменная <code>lprice</code>была на единицу ниже предсказанного значения, если основываться на его весе. <span class="math inline">\(2^{-1}\)</span> равно <span class="math inline">\(\frac{1}{2}\)</span> поэтому точка со значением -1 соответствует половине ожидаемой цены. А остатки со значением 1 соответствуют двойной предсказанной цене.</p>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">5.2.3</span> Более сложная модель</h3>
<p>При желании можно достраивть модель, усложняя её имеющимися параметрами</p>
<div class="sourceCode" id="cb2472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2472-1" data-line-number="1">mod_diamond2 &lt;-<span class="st"> </span><span class="kw">lm</span>(lprice <span class="op">~</span><span class="st"> </span>lcarat <span class="op">+</span><span class="st"> </span>color <span class="op">+</span><span class="st"> </span>cut <span class="op">+</span><span class="st"> </span>clarity, <span class="dt">data =</span> diamonds2)</a></code></pre></div>
<p>Теперь модель включает 4 предиктора и её труднее визуализировать. К счастью, к настоящему моменту все они независимы, а это означает что мы можем отобразить их по отдельности на 3 графиках.</p>
<div class="sourceCode" id="cb2473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2473-1" data-line-number="1">grid &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2473-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(cut, <span class="dt">.model =</span> mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2473-3" data-line-number="3"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2)</a>
<a class="sourceLine" id="cb2473-4" data-line-number="4">grid</a></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   cut       lcarat color clarity  pred
##   &lt;ord&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
## 1 Fair      -0.515 G     VS2      11.2
## 2 Good      -0.515 G     VS2      11.3
## 3 Very Good -0.515 G     VS2      11.4
## 4 Premium   -0.515 G     VS2      11.4
## 5 Ideal     -0.515 G     VS2      11.4</code></pre>
<div class="sourceCode" id="cb2475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2475-1" data-line-number="1"><span class="kw">ggplot</span>(grid, <span class="kw">aes</span>(cut, pred)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2475-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1158-1.png" width="672" /></p>
<p>Если модель нуждается в переменных, которые вы не продоставили ей явно, функция <code>data_grid()</code> автоматически заполнит их типичными значениям. Для непрерывных переенных она использует медиану, а для категориальных — моду.</p>
<div class="sourceCode" id="cb2476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2476-1" data-line-number="1">diamonds2 &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2476-2" data-line-number="2"><span class="st">  </span><span class="kw">add_residuals</span>(mod_diamond2, <span class="st">&quot;lresid2&quot;</span>)</a>
<a class="sourceLine" id="cb2476-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2476-4" data-line-number="4"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(lcarat, lresid2)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2476-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_hex</span>(<span class="dt">bins =</span> <span class="dv">50</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1159-1.png" width="672" /></p>
<p>Этот график указывает на то, что имеюбтся бриллианты с довольно большими остатками — вспомните о том, что остаток 2 означет 4-кратное превышение цены по сравнению с ожидаемой. Часто целесообразно рассматривать необчные значения по отдельности</p>
<div class="sourceCode" id="cb2477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2477-1" data-line-number="1">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2477-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(<span class="kw">abs</span>(lresid2) <span class="op">&gt;</span><span class="st"> </span><span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2477-3" data-line-number="3"><span class="st">  </span><span class="kw">add_predictions</span>(mod_diamond2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2477-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pred =</span> <span class="kw">round</span>(<span class="dv">2</span> <span class="op">^</span><span class="st"> </span>pred)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2477-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(price, pred, carat<span class="op">:</span>table, x<span class="op">:</span>z) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2477-6" data-line-number="6"><span class="st">  </span><span class="kw">arrange</span>(price)</a></code></pre></div>
<pre><code>## # A tibble: 16 x 11
##    price  pred carat cut       color clarity depth table     x     y     z
##    &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;     &lt;ord&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1  1013   264 0.25  Fair      F     SI2      54.4    64  4.3   4.23  2.32
##  2  1186   284 0.25  Premium   G     SI2      59      60  5.33  5.28  3.12
##  3  1186   284 0.25  Premium   G     SI2      58.8    60  5.33  5.28  3.12
##  4  1262  2644 1.03  Fair      E     I1       78.2    54  5.72  5.59  4.42
##  5  1415   639 0.35  Fair      G     VS2      65.9    54  5.57  5.53  3.66
##  6  1415   639 0.35  Fair      G     VS2      65.9    54  5.57  5.53  3.66
##  7  1715   576 0.32  Fair      F     VS2      59.6    60  4.42  4.34  2.61
##  8  1776   412 0.290 Fair      F     SI1      55.8    60  4.48  4.41  2.48
##  9  2160   314 0.34  Fair      F     I1       55.8    62  4.72  4.6   2.6 
## 10  2366   774 0.3   Very Good D     VVS2     60.6    58  4.33  4.35  2.63
## 11  3360  1373 0.51  Premium   F     SI1      62.7    62  5.09  4.96  3.15
## 12  3807  1540 0.61  Good      F     SI2      62.5    65  5.36  5.29  3.33
## 13  3920  1705 0.51  Fair      F     VVS2     65.4    60  4.98  4.9   3.23
## 14  4368  1705 0.51  Fair      F     VVS2     60.7    66  5.21  5.11  3.13
## 15 10011  4048 1.01  Fair      D     SI2      64.6    58  6.25  6.2   4.02
## 16 10470 23622 2.46  Premium   E     SI2      59.7    59  8.82  8.76  5.25</code></pre>
<p>В данном случае мы не находим ничего необычного, но вероятно стоило потратить какое-то время на выяснение того, не указывает ли это на возможноые проблемы с нашей моделью или на наличие ошибок в данных. В случае существования ошибок в данных это могло бы обернуться счастливыой возможностью купить бриллианты по неоправданно заниженной цене. Сила в данных</p>
<div id="-24.2.3.1" class="section level4">
<h4><span class="header-section-number">5.2.3.1</span> Упражнение 24.2.3.1</h4>
<div class="question">
<p>In the plot of <code>lcarat</code> vs. <code>lprice</code>, there are some bright vertical strips. What do they represent?</p>
</div>
<div class="sourceCode" id="cb2479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2479-1" data-line-number="1"><span class="kw">ggplot</span>(diamonds2, <span class="kw">aes</span>(lcarat, lprice)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2479-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1161-1.png" width="672" /></p>
<p>Распределение алмазов имеет больше алмазов в круглых или дружественных для человека числах (дроби).</p>
</div>
<div id="-24.2.3.2" class="section level4">
<h4><span class="header-section-number">5.2.3.2</span> Упражнение 24.2.3.2</h4>
<div class="question">
<p>If <code>log(price) = a_0 + a_1 * log(carat)</code>, what does that say about the relationship between price and carat?</p>
</div>
<p>Переведём исходное выражение в привычную математическую запись. Цену <code>price</code> я запишу как <span class="math inline">\(y\)</span>, а караты <code>carat</code> как <span class="math inline">\(x\)</span></p>
<p><span class="math display">\[\log_b y = a_0 + a_1\log_b x\]</span></p>
<p>Сравним между собой отношение двух исходных выражений. Мы хотим понять, как изменяется отношение <span class="math inline">\(y\)</span> при изменении <span class="math inline">\(x\)</span>.</p>
<p><span class="math display">\[\log_b y_1 = a_0 + a_1\log_b x_1\]</span>
<span class="math display">\[\log_b y_2 = a_0 + a_1\log_b x_2\]</span>
<span class="math display">\[\log_b (y_2) - \log_b (y_1) = (a_0 + a_1\log_b x_2) - (a_0 + a_1\log_b x_1)\]</span>
<span class="math display">\[\log_b(\frac{y_2}{y_1}) = \log_b(\frac{x_2}{x_1})^{a_1}\]</span></p>
<p><span class="math display">\[\frac{y_2}{y_1} = (\frac{x_2}{x_1})^{a_1}\]</span></p>
<p>Собственно это и будет решением.</p>
</div>
<div id="-24.2.3.3" class="section level4">
<h4><span class="header-section-number">5.2.3.3</span> Упражнение 24.2.3.3</h4>
<div class="question">
<p>Extract the diamonds that have very high and very low residuals. Is there anything unusual about these diamonds? Are the particularly bad or good, or do you think these are pricing errors?</p>
</div>
<p>Я буду искать подозрительные остатки, по предложенному Тьюки способу —– буду считать выбросом, значение отклоняющиеся от квартилей на полтора размаха.</p>
<div class="sourceCode" id="cb2480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2480-1" data-line-number="1">left &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2480-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(lresid2 <span class="op">&lt;=</span><span class="st"> </span><span class="kw">quantile</span>(lresid2,<span class="fl">0.25</span>) <span class="op">-</span><span class="st"> </span><span class="fl">1.5</span><span class="op">*</span>(<span class="kw">quantile</span>(lresid2,<span class="fl">0.75</span>) <span class="op">-</span><span class="st"> </span><span class="kw">quantile</span>(lresid2,<span class="fl">0.25</span>)))</a>
<a class="sourceLine" id="cb2480-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2480-4" data-line-number="4">right &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2480-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(lresid2 <span class="op">&gt;=</span><span class="st"> </span><span class="kw">quantile</span>(lresid2,<span class="fl">0.75</span>) <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span><span class="op">*</span>(<span class="kw">quantile</span>(lresid2,<span class="fl">0.75</span>) <span class="op">-</span><span class="st"> </span><span class="kw">quantile</span>(lresid2,<span class="fl">0.25</span>)))</a>
<a class="sourceLine" id="cb2480-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2480-7" data-line-number="7">outliers_lresid2 &lt;-<span class="st"> </span><span class="kw">rbind</span>(left, right)</a></code></pre></div>
<p>Теперь давайте визуализируем ч</p>
<div class="sourceCode" id="cb2481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2481-1" data-line-number="1">diamonds2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2481-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cut, lresid2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2481-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1163-1.png" width="672" /></p>
<p>Вроде бы ничего подозрительного нет.
Выбросы равномерно распределены, относительно качества огранки.
Наблюдается некая тенденция, что большая часть выбросов лижит в пределах от -1 до 1</p>
<p>Но давайте взглянем на остатки поближе.</p>
<div class="sourceCode" id="cb2482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2482-1" data-line-number="1">outliers_lresid2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2482-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lresid2, <span class="dt">color =</span> cut)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2482-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2482-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_grid</span>(cut<span class="op">~</span>.)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1164-1.png" width="672" /></p>
<div class="sourceCode" id="cb2483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2483-1" data-line-number="1">outliers_lresid2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2483-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lresid2, <span class="dt">color =</span> color)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2483-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2483-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_grid</span>(color<span class="op">~</span>.)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1164-2.png" width="672" /></p>
<div class="sourceCode" id="cb2484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2484-1" data-line-number="1">outliers_lresid2 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2484-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(lresid2, <span class="dt">color =</span> clarity)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2484-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_freqpoly</span>(<span class="dt">binwidth =</span> <span class="fl">0.1</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2484-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_grid</span>(clarity<span class="op">~</span>.)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1164-3.png" width="672" /></p>
<p>Основная масса выбросов приходится на значения плюс-минус 0.5.
Практически в одинаковой мере попадаются плохие и хорошие.
Заметно чаще эти ошибки встречаются в более дорогих алмазах.
Можно предположить, что цена искусственно завышена-занижена.</p>
</div>
<div id="-24.2.3.4" class="section level4">
<h4><span class="header-section-number">5.2.3.4</span> Упражнение 24.2.3.4</h4>
<div class="question">
<p>Does the final model, <code>mod_diamond2</code>, do a good job of predicting diamond prices?
Would you trust it to tell you how much to spend if you were buying a diamond?</p>
</div>
<div class="sourceCode" id="cb2485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2485-1" data-line-number="1"><span class="kw">summary</span>(mod_diamond2)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = lprice ~ lcarat + color + cut + clarity, data = diamonds2)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -1.17388 -0.12437 -0.00094  0.11920  2.78322 
## 
## Coefficients:
##              Estimate Std. Error  t value Pr(&gt;|t|)    
## (Intercept) 12.206978   0.001693 7211.806  &lt; 2e-16 ***
## lcarat       1.886239   0.001124 1677.809  &lt; 2e-16 ***
## color.L     -0.633998   0.002910 -217.872  &lt; 2e-16 ***
## color.Q     -0.137580   0.002676  -51.409  &lt; 2e-16 ***
## color.C     -0.022072   0.002503   -8.819  &lt; 2e-16 ***
## color^4      0.016570   0.002297    7.213 5.54e-13 ***
## color^5     -0.002828   0.002169   -1.304    0.192    
## color^6      0.003533   0.001971    1.793    0.073 .  
## cut.L        0.173866   0.003386   51.349  &lt; 2e-16 ***
## cut.Q       -0.050346   0.002980  -16.897  &lt; 2e-16 ***
## cut.C        0.019129   0.002583    7.407 1.31e-13 ***
## cut^4       -0.002410   0.002066   -1.166    0.243    
## clarity.L    1.308155   0.005179  252.598  &lt; 2e-16 ***
## clarity.Q   -0.334090   0.004839  -69.047  &lt; 2e-16 ***
## clarity.C    0.178423   0.004140   43.093  &lt; 2e-16 ***
## clarity^4   -0.088059   0.003298  -26.697  &lt; 2e-16 ***
## clarity^5    0.035885   0.002680   13.389  &lt; 2e-16 ***
## clarity^6   -0.001371   0.002327   -0.589    0.556    
## clarity^7    0.048221   0.002051   23.512  &lt; 2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1916 on 53795 degrees of freedom
## Multiple R-squared:  0.9828, Adjusted R-squared:  0.9828 
## F-statistic: 1.706e+05 on 18 and 53795 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Adjusted R-squared имеет значение 0.9828.
Это очень хороший результат. Возьмём теперь предсказанные значение логарифма цены.</p>
<div class="sourceCode" id="cb2487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2487-1" data-line-number="1">diamonds2<span class="op">$</span>predict &lt;-<span class="st"> </span><span class="kw">predict</span>(<span class="dt">object =</span> mod_diamond2)</a></code></pre></div>
<p>Сравним предсказания, с реальной ценой. Я введу новую переменную, которая показывает во сколько раз предсказание отличается от реальной цены</p>
<div class="sourceCode" id="cb2488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2488-1" data-line-number="1">diamonds2 &lt;-<span class="st"> </span>diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2488-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">result =</span> <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(predict <span class="op">/</span><span class="st"> </span>lprice))</a>
<a class="sourceLine" id="cb2488-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2488-4" data-line-number="4">diamonds2 <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2488-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(cut, result)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2488-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1167-1.png" width="672" /></p>
<div class="sourceCode" id="cb2489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2489-1" data-line-number="1"><span class="kw">mean</span>(<span class="kw">abs</span>(diamonds2<span class="op">$</span>result))</a></code></pre></div>
<pre><code>## [1] 0.01363648</code></pre>
<div class="sourceCode" id="cb2491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2491-1" data-line-number="1"><span class="kw">max</span>(<span class="kw">abs</span>(diamonds2<span class="op">$</span>result))</a></code></pre></div>
<pre><code>## [1] 0.2512653</code></pre>
<p>То есть средняя ошибка модели это 1%.
Я бы доверился такой модели перед покупкой</p>
</div>
</div>
<div id="-----" class="section level3">
<h3><span class="header-section-number">5.2.4</span> Что влияет на количество ежедневных авиарейсов</h3>
<p>Это небольшой набло данных, в нём 365 строк и 2 столбца.
Мы не будем доводить процесс до полностью реализованной модели, но каждый наш шаг будет способствовать лучшему опниманию данных.</p>
<p>Начнём с количества авиарейсов за день и визуализируем данные</p>
<div class="sourceCode" id="cb2493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2493-1" data-line-number="1">daily &lt;-<span class="st"> </span>flights <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2493-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> <span class="kw">make_date</span>(year, month, day)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2493-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2493-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())</a></code></pre></div>
<div class="sourceCode" id="cb2494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2494-1" data-line-number="1"><span class="kw">ggplot</span>(daily, <span class="kw">aes</span>(date, n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2494-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1169-1.png" width="672" /></p>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.2.4.1</span> День недели</h4>
<p>Выявления долгосрочных тенденций — непростая задача из-за наличия сильного эффекта для недели, который доминирует над более слабыми тенденциями. Начнём с рассмортения распределения количества авиварейсов по дням недели.</p>
<div class="sourceCode" id="cb2495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2495-1" data-line-number="1">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2495-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> T))</a>
<a class="sourceLine" id="cb2495-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2495-4" data-line-number="4"><span class="kw">ggplot</span>(daily, <span class="kw">aes</span>(wday, n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2495-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1170-1.png" width="672" /></p>
<p>В выходные дни полётов меньше, поскольку большинство путешествуют в деловых целях. Этот эффект особенно выражен по субботам: иногда вы можете вылететь в вс, чтобы успеть на встречу, которая назначена на утро понедельника, но очень редко выбереть для вылета субботу, поскольку предпочтете провести это время с домашними.</p>
<p>Один из способов исключения этой сильной тенденции — использовать модель. Сначала мы строим модель и отображаем её предсказания поверх исходных данных.</p>
<div class="sourceCode" id="cb2496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2496-1" data-line-number="1">mod &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday, <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2496-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2496-3" data-line-number="3">grid &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2496-4" data-line-number="4"><span class="st">  </span><span class="kw">data_grid</span>(wday) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2496-5" data-line-number="5"><span class="st">  </span><span class="kw">add_predictions</span>(mod, <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb2496-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2496-7" data-line-number="7"><span class="kw">ggplot</span>(daily, <span class="kw">aes</span>(wday, n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2496-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2496-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> grid, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1171-1.png" width="672" /></p>
<p>Затем вычисляем, и визуализируем остатки</p>
<div class="sourceCode" id="cb2497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2497-1" data-line-number="1">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2497-2" data-line-number="2"><span class="st">  </span><span class="kw">add_residuals</span>(mod)</a>
<a class="sourceLine" id="cb2497-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2497-4" data-line-number="4">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2497-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2497-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2497-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1172-1.png" width="672" /></p>
<p>Обращаем внимание на изменени смысла оси <code>y</code> — теперь вдоль неё откладываются отклонения количества полётов от ожидаемого для разных дней недели. Этот график весьма полезен, поскольку теперь, когда из него исключена значительная часть сильного эффекта дня недели, мы можем видеть некоторые слабые оставшиеся тендеции</p>
<ul>
<li>По видимому, начиная с июня, наша модель работает плохо — вы по-прежнему можете наблюдать сильный регулярный шаблон, который модели не удалось захватить. Вычерчивание графика с использованием отдельных линий для каждого дня недели позволяет лучше это увидеть</li>
</ul>
<div class="sourceCode" id="cb2498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2498-1" data-line-number="1"><span class="kw">ggplot</span>(daily, <span class="kw">aes</span>(date, resid, <span class="dt">colour =</span> wday)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2498-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2498-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1173-1.png" width="672" /></p>
<p>Нашей модели не удаётся точно предсказать количество авиарейсов по субботам — летом колчиество полетов превышает ожидаемое значение, а осенью оно ниже ожидаемого значения. В следующем разделе будет показано, каким образом можно улучшить захват этого шаблона.</p>
<ul>
<li>Для некоторых дней количество рейсов значительно превышает ожидаемое значение</li>
</ul>
<div class="sourceCode" id="cb2499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2499-1" data-line-number="1">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2499-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(resid <span class="op">&lt;</span><span class="st"> </span><span class="dv">-100</span>)</a></code></pre></div>
<pre><code>## # A tibble: 11 x 4
##    date           n wday  resid
##    &lt;date&gt;     &lt;int&gt; &lt;ord&gt; &lt;dbl&gt;
##  1 2013-01-01   842 вт    -109.
##  2 2013-01-20   786 вс    -105.
##  3 2013-05-26   729 вс    -162.
##  4 2013-07-04   737 чт    -229.
##  5 2013-07-05   822 пт    -145.
##  6 2013-09-01   718 вс    -173.
##  7 2013-11-28   634 чт    -332.
##  8 2013-11-29   661 пт    -306.
##  9 2013-12-24   761 вт    -190.
## 10 2013-12-25   719 ср    -244.
## 11 2013-12-31   776 вт    -175.</code></pre>
<p>Заметно, что часть дней выпадают на праздники</p>
<ul>
<li>Очевидно существование гладкого долгосрочного тренда на протяжении года. Этот тренд можно выделить с помощью функции</li>
</ul>
<div class="sourceCode" id="cb2501"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2501-1" data-line-number="1">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2501-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2501-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2501-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">colour =</span> <span class="st">&quot;grey50&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2501-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">span =</span> <span class="fl">0.20</span>)</a></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1175-1.png" width="672" /></p>
<p>В январе (и декабре) меньше рейсов, а летом больше (май-сентябрь). Мы не можем сделать много с этой моделью количественно, потому что у нас есть только один год данных. Но мы можем использовать наши знания предметной области для мозгового штурма потенциальных объяснений.</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">5.2.4.2</span> Сезонный субботний эффект</h4>
<p>Давайте сначала рассмотрим нашу неспособность точно предсказать количество рейсов в субботу. Хорошее место для начала - вернуться к необработанным числам, сосредоточившись на субботах:</p>
<div class="sourceCode" id="cb2503"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2503-1" data-line-number="1">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2503-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(wday <span class="op">==</span><span class="st"> &quot;Сб&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2503-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, n)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2503-4" data-line-number="4"><span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2503-5" data-line-number="5"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2503-6" data-line-number="6"><span class="st">    </span><span class="kw">scale_x_date</span>(<span class="ot">NULL</span>, <span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1176-1.png" width="672" /></p>
<p>Я подозреваю, что эта закономерность вызвана летними каникулами: многие люди уезжают в отпуск летом, и люди не против путешествовать по субботам в отпуск. Глядя на этот график, можно догадаться, что летние каникулы идут с начала июня до конца августа. Похоже, это очень хорошо согласуется со школьными условиями штата: летний отпуск в 2013 году был 26 июня - 9 сентября.</p>
<p>Давайте создадим переменную «term», которая приблизительно охватывает три школьных термина, и проверим нашу работу с помощью графика:</p>
<div class="sourceCode" id="cb2504"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2504-1" data-line-number="1">term &lt;-<span class="st"> </span><span class="cf">function</span>(date) {</a>
<a class="sourceLine" id="cb2504-2" data-line-number="2">  <span class="kw">cut</span>(date, </a>
<a class="sourceLine" id="cb2504-3" data-line-number="3">    <span class="dt">breaks =</span> <span class="kw">ymd</span>(<span class="dv">20130101</span>, <span class="dv">20130605</span>, <span class="dv">20130825</span>, <span class="dv">20140101</span>),</a>
<a class="sourceLine" id="cb2504-4" data-line-number="4">    <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;весна&quot;</span>, <span class="st">&quot;лето&quot;</span>, <span class="st">&quot;осень&quot;</span>) </a>
<a class="sourceLine" id="cb2504-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb2504-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb2504-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2504-8" data-line-number="8">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2504-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">term =</span> <span class="kw">term</span>(date)) </a>
<a class="sourceLine" id="cb2504-10" data-line-number="10"></a>
<a class="sourceLine" id="cb2504-11" data-line-number="11">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2504-12" data-line-number="12"><span class="st">  </span><span class="kw">filter</span>(wday <span class="op">==</span><span class="st"> &quot;Сб&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2504-13" data-line-number="13"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, n, <span class="dt">colour =</span> term)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2504-14" data-line-number="14"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2504-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2504-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="ot">NULL</span>, <span class="dt">date_breaks =</span> <span class="st">&quot;1 month&quot;</span>, <span class="dt">date_labels =</span> <span class="st">&quot;%b&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1177-1.png" width="672" /></p>
<p>(Я вручную подправил даты, чтобы получить хорошие перерывы в сюжете. Использование визуализации, чтобы помочь вам понять, что делает ваша функция, является действительно мощной и общей техникой.)</p>
<p>Полезно посмотреть, как эта новая переменная влияет на другие дни недели:</p>
<div class="sourceCode" id="cb2505"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2505-1" data-line-number="1">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2505-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(wday, n, <span class="dt">colour =</span> term)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2505-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1178-1.png" width="672" /></p>
<p>Похоже, что есть существенные различия между временами года, поэтому целесообразно использовать отдельный эффект дня недели для каждого. Это улучшает нашу модель, но не настолько, как мы могли бы надеяться:</p>
<div class="sourceCode" id="cb2506"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2506-1" data-line-number="1">mod1 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday, <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2506-2" data-line-number="2">mod2 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday <span class="op">*</span><span class="st"> </span>term, <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2506-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2506-4" data-line-number="4">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2506-5" data-line-number="5"><span class="st">  </span><span class="kw">gather_residuals</span>(<span class="dt">without_term =</span> mod1, <span class="dt">with_term =</span> mod2) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2506-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid, <span class="dt">colour =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2506-7" data-line-number="7"><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1179-1.png" width="672" /></p>
<p>Мы можем увидеть проблему, наложив прогнозы из модели на необработанные данные:</p>
<div class="sourceCode" id="cb2507"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2507-1" data-line-number="1">grid &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2507-2" data-line-number="2"><span class="st">  </span><span class="kw">data_grid</span>(wday, term) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2507-3" data-line-number="3"><span class="st">  </span><span class="kw">add_predictions</span>(mod2, <span class="st">&quot;n&quot;</span>)</a>
<a class="sourceLine" id="cb2507-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2507-5" data-line-number="5"><span class="kw">ggplot</span>(daily, <span class="kw">aes</span>(wday, n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2507-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2507-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> grid, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2507-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span><span class="st"> </span>term)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1180-1.png" width="672" /></p>
<p>Наша модель находит среднее значение, но у нас есть много больших отклонений, поэтому среднее значение, как правило, далеко от типичного значения. Мы можем решить эту проблему, используя модель, устойчивую к воздействию выбросов: <code>MASS::rlm()</code>. Это значительно уменьшает влияние выбросов на наши оценки и дает модель, которая хорошо справляется с удалением модели дня недели:</p>
<div class="sourceCode" id="cb2508"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2508-1" data-line-number="1">mod3 &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">rlm</span>(n <span class="op">~</span><span class="st"> </span>wday <span class="op">*</span><span class="st"> </span>term, <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2508-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2508-3" data-line-number="3">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2508-4" data-line-number="4"><span class="st">  </span><span class="kw">add_residuals</span>(mod3, <span class="st">&quot;resid&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2508-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2508-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">size =</span> <span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2508-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1181-1.png" width="672" /></p>
<p>Теперь намного легче увидеть долгосрочную тенденцию, а также положительные и отрицательные выбросы.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.2.4.3</span> Вычисляемые переменные</h4>
<p>Если вы экспериментируете со многими моделями и множеством визуализаций, было бы неплохо объединить создание переменных в функцию, чтобы не было возможности случайно применить другое преобразование в разных местах. Например, мы могли бы написать:</p>
<div class="sourceCode" id="cb2509"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2509-1" data-line-number="1">compute_vars &lt;-<span class="st"> </span><span class="cf">function</span>(data) {</a>
<a class="sourceLine" id="cb2509-2" data-line-number="2">  data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2509-3" data-line-number="3"><span class="st">    </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2509-4" data-line-number="4">      <span class="dt">term =</span> <span class="kw">term</span>(date), </a>
<a class="sourceLine" id="cb2509-5" data-line-number="5">      <span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2509-6" data-line-number="6">    )</a>
<a class="sourceLine" id="cb2509-7" data-line-number="7">}</a></code></pre></div>
<p>Другой вариант - поместить преобразования непосредственно в формулу модели:</p>
<div class="sourceCode" id="cb2510"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2510-1" data-line-number="1">wday2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) <span class="kw">wday</span>(x, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2510-2" data-line-number="2">mod3 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span><span class="kw">wday2</span>(date) <span class="op">*</span><span class="st"> </span><span class="kw">term</span>(date), <span class="dt">data =</span> daily)</a></code></pre></div>
<p>Любой подход является разумным. Делаnm преобразованную переменную явной, полезно, если вы хотите проверить свою работу или использовать их в визуализации. Но вы не можете легко использовать преобразования (например, конвейеры), которые возвращают несколько столбцов. Включение преобразований в функцию модели немного облегчает жизнь, когда вы работаете со многими различными наборами данных, потому что модель самодостаточна.</p>
</div>
<div id="---" class="section level4">
<h4><span class="header-section-number">5.2.4.4</span> Время года: альтернативный подход</h4>
<p>В предыдущем разделе мы использовали наши знания предметной области (как термин «школа» в США влияет на поездки), чтобы улучшить модель. Альтернатива прямому использованию наших знаний в модели - предоставить данным больше пространства для разговора. Мы могли бы использовать более гибкую модель и позволить ей охватить интересующий нас паттерн. Простой линейный тренд не является адекватным, поэтому мы могли бы попытаться использовать естественный сплайн, чтобы соответствовать плавной кривой в течение года:</p>
<div class="sourceCode" id="cb2511"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2511-1" data-line-number="1"><span class="kw">library</span>(splines)</a>
<a class="sourceLine" id="cb2511-2" data-line-number="2">mod &lt;-<span class="st"> </span>MASS<span class="op">::</span><span class="kw">rlm</span>(n <span class="op">~</span><span class="st"> </span>wday <span class="op">*</span><span class="st"> </span><span class="kw">ns</span>(date, <span class="dv">5</span>), <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2511-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2511-4" data-line-number="4">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2511-5" data-line-number="5"><span class="st">  </span><span class="kw">data_grid</span>(wday, <span class="dt">date =</span> <span class="kw">seq_range</span>(date, <span class="dt">n =</span> <span class="dv">13</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2511-6" data-line-number="6"><span class="st">  </span><span class="kw">add_predictions</span>(mod) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2511-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, pred, <span class="dt">colour =</span> wday)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2511-8" data-line-number="8"><span class="st">    </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2511-9" data-line-number="9"><span class="st">    </span><span class="kw">geom_point</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1184-1.png" width="672" /></p>
<p>Мы видим сильную закономерность в количестве субботних рейсов. Это обнадеживает, потому что мы также видели этот шаблон в необработанных данных. Это хороший знак, когда вы получаете один и тот же сигнал с разных подходов.</p>
</div>
<div id="-24.3.5.1" class="section level4">
<h4><span class="header-section-number">5.2.4.5</span> Упражнение 24.3.5.1</h4>
<div class="question">
<p>Use your Google sleuthing skills to brainstorm why there were fewer than expected flights on Jan 20, May 26, and Sep 1. (Hint: they all have the same explanation.) How would these days generalise to another year?</p>
</div>
<p>Это воскресенье перед выходными в понедельник, День Мартина Лютера Кинга-младшего, День памяти и День труда. Для других лет используйте даты выходных для этих лет: третий понедельник января для Мартина Лютера Кинга-младшего, последний понедельник мая для Дня памяти и первый понедельник сентября для Дня труда.</p>
</div>
<div id="-24.3.5.2" class="section level4">
<h4><span class="header-section-number">5.2.4.6</span> Упражнение 24.3.5.2</h4>
<div class="question">
<p>What do the three days with high positive residuals represent? How would these days generalize to another year?</p>
</div>
<div class="sourceCode" id="cb2512"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2512-1" data-line-number="1">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2512-2" data-line-number="2"><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">3</span>, resid)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 5
##   date           n wday  resid term 
##   &lt;date&gt;     &lt;int&gt; &lt;ord&gt; &lt;dbl&gt; &lt;fct&gt;
## 1 2013-11-30   857 сб    112.  осень
## 2 2013-12-01   987 вс     95.5 осень
## 3 2013-12-28   814 сб     69.4 осень</code></pre>
<p>Три верхних дня соответствуют субботе после Дня благодарения (30 ноября), воскресенью после Дня благодарения (1 декабря) и субботе после Рождества (28 декабря). Мы могли бы обобщить их на другие годы, используя даты этих праздников тех лет.</p>
</div>
<div id="-24.3.5.3" class="section level4">
<h4><span class="header-section-number">5.2.4.7</span> Упражнение 24.3.5.3</h4>
<div class="question">
<p>Create a new variable that splits the <code>wday</code> variable into terms, but only for Saturdays, i.e. it should have <code>Thurs</code>, <code>Fri</code>, but <code>Sat-summer</code>, <code>Sat-spring</code>, <code>Sat-fall</code>. How does this model compare with the model with every combination of <code>wday</code> and <code>term</code>?</p>
</div>
<div class="sourceCode" id="cb2514"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2514-1" data-line-number="1">daily &lt;-<span class="st"> </span>daily  <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2514-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">splitted_day =</span> </a>
<a class="sourceLine" id="cb2514-3" data-line-number="3">           <span class="kw">ifelse</span>(wday <span class="op">==</span><span class="st"> &quot;Сб&quot;</span>, <span class="kw">paste0</span>(wday, <span class="st">&quot;-&quot;</span>, term), <span class="kw">as.character</span>(wday)))</a>
<a class="sourceLine" id="cb2514-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2514-5" data-line-number="5">mod4 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>splitted_day, <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2514-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2514-7" data-line-number="7">daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2514-8" data-line-number="8"><span class="st">  </span><span class="kw">gather_residuals</span>(<span class="dt">sat_term =</span> mod4, <span class="dt">all_interact =</span> mod2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2514-9" data-line-number="9"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid, <span class="dt">color =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2514-10" data-line-number="10"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2514-11" data-line-number="11"><span class="st">  </span><span class="kw">facet_grid</span>(model<span class="op">~</span>.)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1186-1.png" width="672" /></p>
<p>Посмотрим на разницы остатков.</p>
<div class="sourceCode" id="cb2515"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2515-1" data-line-number="1">daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2515-2" data-line-number="2"><span class="st">  </span><span class="kw">spread_residuals</span>(<span class="dt">sat_term =</span> mod4, <span class="dt">all_interact =</span> mod2) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2515-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid_diff =</span> sat_term <span class="op">-</span><span class="st"> </span>all_interact) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2515-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid_diff)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2515-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1187-1.png" width="672" /></p>
<p>Получаем, что модифицифрованная модель (Сб-весна) имеет более высокие остатки летом и более низкие остатки весной. При этом осенью остатки более менее одинаковы.</p>
</div>
<div id="-24.3.5.4" class="section level4">
<h4><span class="header-section-number">5.2.4.8</span> Упражнение 24.3.5.4</h4>
<div class="question">
<p>Create a new <code>wday</code> variable that combines the day of week, term (for Saturdays), and public holidays. What do the residuals of that model look like?</p>
</div>
<p>Итак, погуглив, находим общенациональные американские праздники.
Создадим переменную, в которую положим все эти праздники</p>
<div class="sourceCode" id="cb2516"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2516-1" data-line-number="1">holidays_<span class="dv">2013</span> &lt;-</a>
<a class="sourceLine" id="cb2516-2" data-line-number="2"><span class="st">  </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2516-3" data-line-number="3">    <span class="op">~</span>holiday, <span class="op">~</span>date,</a>
<a class="sourceLine" id="cb2516-4" data-line-number="4">    <span class="st">&quot;New Year&#39;s Day&quot;</span>, <span class="dv">20130101</span>,</a>
<a class="sourceLine" id="cb2516-5" data-line-number="5">    <span class="st">&quot;Martin Luther King Jr. Day&quot;</span>, <span class="dv">20130121</span>,</a>
<a class="sourceLine" id="cb2516-6" data-line-number="6">    <span class="st">&quot;Washington&#39;s Birthday&quot;</span>, <span class="dv">20130218</span>,</a>
<a class="sourceLine" id="cb2516-7" data-line-number="7">    <span class="st">&quot;Memorial Day&quot;</span>, <span class="dv">20130527</span>,</a>
<a class="sourceLine" id="cb2516-8" data-line-number="8">    <span class="st">&quot;Independence Day&quot;</span>, <span class="dv">20130704</span>,</a>
<a class="sourceLine" id="cb2516-9" data-line-number="9">    <span class="st">&quot;Labor Day&quot;</span>, <span class="dv">20130902</span>,</a>
<a class="sourceLine" id="cb2516-10" data-line-number="10">    <span class="st">&quot;Columbus Day&quot;</span>, <span class="dv">20131028</span>,</a>
<a class="sourceLine" id="cb2516-11" data-line-number="11">    <span class="st">&quot;Veteran&#39;s Day&quot;</span>, <span class="dv">20131111</span>,</a>
<a class="sourceLine" id="cb2516-12" data-line-number="12">    <span class="st">&quot;Thanksgiving&quot;</span>, <span class="dv">20131128</span>,</a>
<a class="sourceLine" id="cb2516-13" data-line-number="13">    <span class="st">&quot;Christmas&quot;</span>, <span class="dv">20131225</span></a>
<a class="sourceLine" id="cb2516-14" data-line-number="14">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2516-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">date =</span> lubridate<span class="op">::</span><span class="kw">ymd</span>(date))</a></code></pre></div>
<p>Добавим, для интереса, ещё и дни до и после праздников.
Потому что по собственному опыту скажу, что чаще всего, я вылетаю на праздники в день до наступления праздника. Точнее вечером после работы, чтобы побольше побыть с родными или друзьями.</p>
<div class="sourceCode" id="cb2517"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2517-1" data-line-number="1">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2517-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2517-3" data-line-number="3">    <span class="dt">wday3 =</span></a>
<a class="sourceLine" id="cb2517-4" data-line-number="4">      <span class="kw">case_when</span>(</a>
<a class="sourceLine" id="cb2517-5" data-line-number="5">        date <span class="op">%in%</span><span class="st"> </span>(holidays_<span class="dv">2013</span><span class="op">$</span>date <span class="op">-</span><span class="st"> </span>1L) <span class="op">~</span><span class="st"> &quot;день до праздника&quot;</span>,</a>
<a class="sourceLine" id="cb2517-6" data-line-number="6">        date <span class="op">%in%</span><span class="st"> </span>(holidays_<span class="dv">2013</span><span class="op">$</span>date <span class="op">+</span><span class="st"> </span>1L) <span class="op">~</span><span class="st"> &quot;день после праздника&quot;</span>,</a>
<a class="sourceLine" id="cb2517-7" data-line-number="7">        date <span class="op">%in%</span><span class="st"> </span>holidays_<span class="dv">2013</span><span class="op">$</span>date <span class="op">~</span><span class="st"> &quot;праздник&quot;</span>,</a>
<a class="sourceLine" id="cb2517-8" data-line-number="8">        .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;сб&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;лето&quot;</span> <span class="op">~</span><span class="st"> &quot;сб-лето&quot;</span>,</a>
<a class="sourceLine" id="cb2517-9" data-line-number="9">        .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;сб&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;осень&quot;</span> <span class="op">~</span><span class="st"> &quot;сб-осень&quot;</span>,</a>
<a class="sourceLine" id="cb2517-10" data-line-number="10">        .<span class="op">$</span>wday <span class="op">==</span><span class="st"> &quot;сб&quot;</span> <span class="op">&amp;</span><span class="st"> </span>.<span class="op">$</span>term <span class="op">==</span><span class="st"> &quot;spring&quot;</span> <span class="op">~</span><span class="st"> &quot;сб-весн&quot;</span>,</a>
<a class="sourceLine" id="cb2517-11" data-line-number="11">        <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span><span class="kw">as.character</span>(.<span class="op">$</span>wday)</a>
<a class="sourceLine" id="cb2517-12" data-line-number="12">      )</a>
<a class="sourceLine" id="cb2517-13" data-line-number="13">  )</a></code></pre></div>
<p>Теперь построим модель, которая будет учитывать не только сезонность суббот, но и включенные праздники.</p>
<div class="sourceCode" id="cb2518"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2518-1" data-line-number="1">mod5 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday3, <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2518-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2518-3" data-line-number="3">daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2518-4" data-line-number="4"><span class="st">  </span><span class="kw">spread_residuals</span>(<span class="dt">resid_sat_terms =</span> mod4, <span class="dt">resid_holidays =</span> mod5) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2518-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid_diff =</span> resid_holidays <span class="op">-</span><span class="st"> </span>resid_sat_terms) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2518-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid_diff)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2518-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1190-1.png" width="672" /></p>
<p>Как видно на графике, модель довольно точно определяет даты, очень похожие на введёные нами праздники и дни до и после праздников.</p>
<div class="sourceCode" id="cb2519"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2519-1" data-line-number="1">daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2519-2" data-line-number="2"><span class="st">  </span><span class="kw">spread_residuals</span>(<span class="dt">resid_sat_terms =</span> mod4, <span class="dt">resid_holidays =</span> mod5) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2519-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">resid_diff =</span> resid_holidays <span class="op">-</span><span class="st"> </span>resid_sat_terms) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2519-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(resid_diff <span class="op">&gt;</span><span class="st"> </span><span class="dv">50</span>)</a></code></pre></div>
<pre><code>## # A tibble: 17 x 10
##    date           n wday    resid term  splitted_day wday3 resid_sat_terms
##    &lt;date&gt;     &lt;int&gt; &lt;ord&gt;   &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;        &lt;chr&gt;           &lt;dbl&gt;
##  1 2013-01-01   842 вт    -109.   весна вт           праз…         -109.  
##  2 2013-01-02   943 ср     -19.7  весна ср           день…          -19.7 
##  3 2013-01-21   912 пн     -62.8  весна пн           праз…          -62.8 
##  4 2013-02-18   948 пн     -26.8  весна пн           праз…          -26.8 
##  5 2013-05-27   928 пн     -46.8  весна пн           праз…          -46.8 
##  6 2013-07-03   983 ср      20.3  лето  ср           день…           20.3 
##  7 2013-07-04   737 чт    -229.   лето  чт           праз…         -229.  
##  8 2013-07-05   822 пт    -145.   лето  пт           день…         -145.  
##  9 2013-09-02   929 пн     -45.8  осень пн           праз…          -45.8 
## 10 2013-10-28   983 пн       8.19 осень пн           праз…            8.19
## 11 2013-11-11   983 пн       8.19 осень пн           праз…            8.19
## 12 2013-11-27  1014 ср      51.3  осень ср           день…           51.3 
## 13 2013-11-28   634 чт    -332.   осень чт           праз…         -332.  
## 14 2013-11-29   661 пт    -306.   осень пт           день…         -306.  
## 15 2013-12-24   761 вт    -190.   осень вт           день…         -190.  
## 16 2013-12-25   719 ср    -244.   осень ср           праз…         -244.  
## 17 2013-12-26   936 чт     -29.8  осень чт           день…          -29.8 
## # … with 2 more variables: resid_holidays &lt;dbl&gt;, resid_diff &lt;dbl&gt;</code></pre>
</div>
<div id="-24.3.5.5" class="section level4">
<h4><span class="header-section-number">5.2.4.9</span> Упражнение 24.3.5.5</h4>
<div class="question">
<p>What happens if you fit a day of week effect that varies by month (i.e., n ~ wday * month)? Why is this not very helpful?</p>
</div>
<p>Добавим новую переменную, которая определяет месяц</p>
<div class="sourceCode" id="cb2521"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2521-1" data-line-number="1">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2521-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">month =</span> <span class="kw">factor</span>(<span class="kw">month</span>(date)))</a></code></pre></div>
<div class="sourceCode" id="cb2522"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2522-1" data-line-number="1">mod6 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday<span class="op">*</span>month, <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2522-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2522-3" data-line-number="3">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2522-4" data-line-number="4"><span class="st">  </span><span class="kw">add_residuals</span>(mod6)</a>
<a class="sourceLine" id="cb2522-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2522-6" data-line-number="6">daily <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2522-7" data-line-number="7"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(date, resid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2522-8" data-line-number="8"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2522-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1193-1.png" width="672" /></p>
<p>Как видим, эта модель не эффективна, поскольку не ловит большие отклонения.
Если м ы посмотрим, на то из чего состоит модель, то увидим что в модели будет 12 * 7 = 84 параметра. Поскольку у каждого месяца есть только четыре-пять недель, каждый из этих дней недели × месяц - это в среднем только четыре или пять наблюдений. Эти оценки имеют большие стандартные ошибки и, вероятно, не обобщаются далеко за пределы выборочных данных, поскольку они оцениваются только из нескольких наблюдений.</p>
<div class="sourceCode" id="cb2523"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2523-1" data-line-number="1"><span class="kw">summary</span>(mod6)</a></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = n ~ wday * month, data = daily)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -269.2   -5.0    1.5    8.8  113.2 
## 
## Coefficients:
##                 Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)     867.4000     7.5983 114.157  &lt; 2e-16 ***
## wday.L          -64.0744    20.8737  -3.070 0.002353 ** 
## wday.Q         -165.6001    20.1555  -8.216 7.77e-15 ***
## wday.C          -68.2591    20.3115  -3.361 0.000885 ***
## wday^4          -92.0814    20.4991  -4.492 1.03e-05 ***
## wday^5            9.7925    19.7334   0.496 0.620111    
## wday^6          -20.4376    18.9922  -1.076 0.282802    
## month2           23.7071    10.9946   2.156 0.031912 *  
## month3           67.8857    10.7456   6.318 1.04e-09 ***
## month4           74.5929    10.8292   6.888 3.70e-11 ***
## month5           56.2786    10.7456   5.237 3.20e-07 ***
## month6           80.3071    10.8292   7.416 1.43e-12 ***
## month7           77.1143    10.7456   7.176 6.39e-12 ***
## month8           81.6357    10.7456   7.597 4.52e-13 ***
## month9           51.3714    10.8292   4.744 3.34e-06 ***
## month10          60.1357    10.7456   5.596 5.20e-08 ***
## month11          46.9143    10.8292   4.332 2.06e-05 ***
## month12          38.7786    10.7456   3.609 0.000364 ***
## wday.L:month2    -3.7230    29.6267  -0.126 0.900089    
## wday.Q:month2    -3.8188    29.1251  -0.131 0.895776    
## wday.C:month2     0.4899    29.2333   0.017 0.986641    
## wday^4:month2     4.5690    29.3639   0.156 0.876460    
## wday^5:month2    -4.2552    28.8346  -0.148 0.882784    
## wday^6:month2    12.0570    28.3325   0.426 0.670760    
## wday.L:month3   -14.5705    28.4302  -0.513 0.608703    
## wday.Q:month3    15.4389    28.2073   0.547 0.584581    
## wday.C:month3     8.2262    28.4672   0.289 0.772817    
## wday^4:month3    22.7202    28.7015   0.792 0.429261    
## wday^5:month3   -15.3298    28.5042  -0.538 0.591135    
## wday^6:month3    11.3727    28.2682   0.402 0.687759    
## wday.L:month4   -16.6682    29.3590  -0.568 0.570667    
## wday.Q:month4    10.7254    28.9620   0.370 0.711418    
## wday.C:month4    -0.2449    28.7249  -0.009 0.993202    
## wday^4:month4    23.2883    28.8711   0.807 0.420561    
## wday^5:month4   -17.8720    28.0764  -0.637 0.524935    
## wday^6:month4     5.3524    27.8883   0.192 0.847940    
## wday.L:month5     3.6663    29.3590   0.125 0.900711    
## wday.Q:month5   -20.6652    28.6699  -0.721 0.471632    
## wday.C:month5     4.6336    28.7249   0.161 0.871965    
## wday^4:month5     5.9994    28.5109   0.210 0.833490    
## wday^5:month5   -16.9119    28.0764  -0.602 0.547425    
## wday^6:month5    12.7643    27.1935   0.469 0.639158    
## wday.L:month6    -4.5261    28.6515  -0.158 0.874593    
## wday.Q:month6    23.8130    28.2073   0.844 0.399267    
## wday.C:month6    13.7580    28.7249   0.479 0.632342    
## wday^4:month6    24.1183    29.1875   0.826 0.409322    
## wday^5:month6   -17.6484    28.7981  -0.613 0.540483    
## wday^6:month6    10.5256    28.3291   0.372 0.710510    
## wday.L:month7   -28.7914    29.3590  -0.981 0.327601    
## wday.Q:month7    49.5846    28.6699   1.730 0.084818 .  
## wday.C:month7    54.5011    28.7249   1.897 0.058807 .  
## wday^4:month7    50.8474    28.5109   1.783 0.075594 .  
## wday^5:month7   -33.6983    28.0764  -1.200 0.231058    
## wday^6:month7   -13.8943    27.1935  -0.511 0.609793    
## wday.L:month8   -20.4479    28.8711  -0.708 0.479378    
## wday.Q:month8     6.7648    28.5042   0.237 0.812578    
## wday.C:month8     6.0012    28.4672   0.211 0.833186    
## wday^4:month8    19.0738    28.7814   0.663 0.508058    
## wday^5:month8   -19.3123    28.0576  -0.688 0.491827    
## wday^6:month8     9.5074    27.8866   0.341 0.733410    
## wday.L:month9   -30.3411    28.9257  -1.049 0.295110    
## wday.Q:month9   -42.0342    28.6699  -1.466 0.143726    
## wday.C:month9   -20.7186    28.7249  -0.721 0.471338    
## wday^4:month9   -20.3752    28.7914  -0.708 0.479728    
## wday^5:month9   -18.2376    28.5226  -0.639 0.523079    
## wday^6:month9    11.7263    28.2699   0.415 0.678606    
## wday.L:month10  -61.0507    29.5199  -2.068 0.039544 *  
## wday.Q:month10  -26.2352    28.5042  -0.920 0.358153    
## wday.C:month10  -32.4353    28.7249  -1.129 0.259788    
## wday^4:month10  -12.2122    28.9901  -0.421 0.673890    
## wday^5:month10  -27.6864    27.9072  -0.992 0.322008    
## wday^6:month10    0.1234    26.8590   0.005 0.996339    
## wday.L:month11  -54.9466    28.9257  -1.900 0.058512 .  
## wday.Q:month11   16.0117    28.6699   0.558 0.576957    
## wday.C:month11   54.9502    28.7249   1.913 0.056766 .  
## wday^4:month11   47.2857    28.7914   1.642 0.101635    
## wday^5:month11  -44.7401    28.5226  -1.569 0.117871    
## wday^6:month11  -20.6876    28.2699  -0.732 0.464907    
## wday.L:month12   -9.5058    28.8711  -0.329 0.742212    
## wday.Q:month12   75.2088    28.5042   2.639 0.008791 ** 
## wday.C:month12  -25.0256    28.4672  -0.879 0.380097    
## wday^4:month12  -23.7798    28.7814  -0.826 0.409380    
## wday^5:month12   20.4470    28.0576   0.729 0.466761    
## wday^6:month12    9.5864    27.8866   0.344 0.731282    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 42.05 on 281 degrees of freedom
## Multiple R-squared:  0.8355, Adjusted R-squared:  0.7869 
## F-statistic:  17.2 on 83 and 281 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div id="-24.3.5.6" class="section level4">
<h4><span class="header-section-number">5.2.4.10</span> Упражнение 24.3.5.6</h4>
<div class="question">
<p>What would you expect the model <code>n ~ wday + ns(date, 5)</code> to look like?
Knowing what you know about the data, why would you expect it to be not particularly effective?</p>
</div>
<p>Предыдущие модели вписываются в главу, и упражнения показывают, что влияние дней недели меняется в зависимости от времени года. Модель в этом упражнении не взаимодействует с эффектом дня недели и со временем года.</p>
<div class="sourceCode" id="cb2525"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2525-1" data-line-number="1">mod7 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday <span class="op">+</span><span class="st"> </span><span class="kw">ns</span>(date, <span class="dv">5</span>), <span class="dt">data =</span> daily)</a>
<a class="sourceLine" id="cb2525-2" data-line-number="2">mod8 &lt;-<span class="st"> </span><span class="kw">lm</span>(n <span class="op">~</span><span class="st"> </span>wday <span class="op">*</span><span class="st"> </span><span class="kw">ns</span>(date, <span class="dv">5</span>), <span class="dt">data =</span> daily)</a></code></pre></div>
<p>Остатки модели, которая не взаимодействует со днём недели со временем года (mod7), больше, чем остатки модели, которая взаимодействует (mod8). Модель mod7 недооценивает выходные летом и переоценивает выходные осенью.</p>
<div class="sourceCode" id="cb2526"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2526-1" data-line-number="1">daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2526-2" data-line-number="2"><span class="st">  </span><span class="kw">gather_residuals</span>(mod7, mod8) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2526-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date, <span class="dt">y =</span> resid, <span class="dt">color =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2526-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">alpha =</span> <span class="fl">0.75</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1196-1.png" width="672" /></p>
</div>
<div id="-24.3.5.7" class="section level4">
<h4><span class="header-section-number">5.2.4.11</span> Упражнение 24.3.5.7</h4>
<div class="question">
<p>We hypothesized that people leaving on Sundays are more likely to be business travelers who need to be somewhere on Monday. Explore that hypothesis by seeing how it breaks down based on distance and time: if it’s true, you’d expect to see more Sunday evening flights to places that are far away.</p>
</div>
<p>Сравнивая средние расстояния рейсов по дням недели, воскресные рейсы занимают второе место по длине. Субботние рейсы самые длинные в среднем. В субботу могут быть самые длинные рейсы в среднем, потому что на выходные меньше регулярных регулярных рейсов бизнес / пригородных рейсов, но это предположение.</p>
<div class="sourceCode" id="cb2527"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2527-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2527-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2527-3" data-line-number="3">    <span class="dt">date =</span> <span class="kw">make_date</span>(year, month, day),</a>
<a class="sourceLine" id="cb2527-4" data-line-number="4">    <span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2527-5" data-line-number="5">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2527-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> distance, <span class="dt">x =</span> wday)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2527-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_boxplot</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1197-1.png" width="672" /></p>
<p>Построим средние дистанции и величины стандартного.
Используем функцию из упражнения ниже, чтобы поставить понедельник не первое место.</p>
<div class="sourceCode" id="cb2528"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2528-1" data-line-number="1">relevel &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb2528-2" data-line-number="2">  <span class="kw">fct_relevel</span>(x, <span class="kw">levels</span>(x)[<span class="op">-</span><span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2528-3" data-line-number="3">}</a></code></pre></div>
<div class="sourceCode" id="cb2529"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2529-1" data-line-number="1">flights <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2529-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2529-3" data-line-number="3">    <span class="dt">date =</span> <span class="kw">make_date</span>(year, month, day),</a>
<a class="sourceLine" id="cb2529-4" data-line-number="4">    <span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2529-5" data-line-number="5">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2529-6" data-line-number="6"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> distance, <span class="dt">x =</span> <span class="kw">relevel</span>(wday))) <span class="op">+</span></a>
<a class="sourceLine" id="cb2529-7" data-line-number="7"><span class="st">  </span><span class="kw">stat_summary</span>()</a></code></pre></div>
<pre><code>## No summary function supplied, defaulting to `mean_se()</code></pre>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1199-1.png" width="672" /></p>
<p>В субботу в среднем летают на большие дистанции.</p>
<p>Необходимо продолжить исследование.</p>
</div>
<div id="-24.3.5.8" class="section level4">
<h4><span class="header-section-number">5.2.4.12</span> Упражнение 24.3.5.8</h4>
<div class="question">
<p>It’s a little frustrating that Sunday and Saturday are on separate ends of the plot. Write a small function to set the levels of the factor so that the week starts on Monday.</p>
</div>
<p>Используем релевел</p>
<div class="sourceCode" id="cb2531"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2531-1" data-line-number="1">relevel &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb2531-2" data-line-number="2">  <span class="kw">fct_relevel</span>(x, <span class="kw">levels</span>(x)[<span class="op">-</span><span class="dv">1</span>])</a>
<a class="sourceLine" id="cb2531-3" data-line-number="3">}</a></code></pre></div>
<p>Вуаля, понедельник первый</p>
<div class="sourceCode" id="cb2532"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2532-1" data-line-number="1">daily &lt;-<span class="st"> </span>daily <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2532-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">wday =</span> <span class="kw">wday</span>(date, <span class="dt">label =</span> <span class="ot">TRUE</span>))</a>
<a class="sourceLine" id="cb2532-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2532-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2532-5" data-line-number="5"><span class="kw">ggplot</span>(daily, <span class="kw">aes</span>(<span class="kw">relevel</span>(wday), n)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2532-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_boxplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2532-7" data-line-number="7"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;День недели&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Число полётов&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1201-1.png" width="672" /></p>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">5.2.5</span> Больше о моделях</h3>
<p>Тут ссылки на ещё информацию о моделях</p>
<ul>
<li><p><em>Statistical Modeling: A Fresh Approach</em> by Danny Kaplan,
<a href="http://www.mosaic-web.org/go/StatisticalModeling/" class="uri">http://www.mosaic-web.org/go/StatisticalModeling/</a>. This book provides
a gentle introduction to modelling, where you build your intuition,
mathematical tools, and R skills in parallel. The book replaces a traditional
“introduction to statistics” course, providing a curriculum that is up-to-date
and relevant to data science.</p></li>
<li><p><em>An Introduction to Statistical Learning</em> by Gareth James, Daniela Witten,
Trevor Hastie, and Robert Tibshirani, <a href="http://www-bcf.usc.edu/~gareth/ISL/" class="uri">http://www-bcf.usc.edu/~gareth/ISL/</a>
(available online for free). This book presents a family of modern modelling
techniques collectively known as statistical learning. For an even deeper
understanding of the math behind the models, read the classic
<em>Elements of Statistical Learning</em> by Trevor Hastie, Robert Tibshirani, and
Jerome Friedman, <a href="https://web.stanford.edu/~hastie/Papers/ESLII.pdf" class="uri">https://web.stanford.edu/~hastie/Papers/ESLII.pdf</a> (also
available online for free).</p></li>
<li><p><em>Applied Predictive Modeling</em> by Max Kuhn and Kjell Johnson,
<a href="http://appliedpredictivemodeling.com" class="uri">http://appliedpredictivemodeling.com</a>. This book is a companion to the
<strong>caret</strong> package and provides practical tools for dealing with real-life
predictive modelling challenges.</p></li>
</ul>
<!--chapter:end:19_make_models.Rmd-->
</div>
</div>
<div id="------purrr--broom" class="section level2">
<h2><span class="header-section-number">5.3</span> Обработка множества моделей с помощью пакетов <code>purrr</code> и <code>broom</code></h2>
<div id="-18" class="section level3">
<h3><span class="header-section-number">5.3.1</span> Введение</h3>
<p>Тут советуют не отчаиваться если сразу не получится осмыслить всё то что здесь объясняется.</p>
<div id="--9" class="section level4">
<h4><span class="header-section-number">5.3.1.1</span> Необходимые ресурсы</h4>
<div class="sourceCode" id="cb2533"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2533-1" data-line-number="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb2533-2" data-line-number="2"><span class="kw">library</span>(modelr)</a></code></pre></div>
</div>
</div>
<div id="--gapminder" class="section level3">
<h3><span class="header-section-number">5.3.2</span> Набор данных <code>gapminder</code></h3>
<p>В наборе соз=держится информация об изменении во времени суммарных показателей развития стран мира, рассчитанных на основк таких статистик как средняя продолжительность жизни и ВВП.</p>
<div class="sourceCode" id="cb2534"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2534-1" data-line-number="1"><span class="kw">library</span>(gapminder)</a>
<a class="sourceLine" id="cb2534-2" data-line-number="2">gapminder</a></code></pre></div>
<pre><code>## # A tibble: 1,704 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
## # … with 1,694 more rows</code></pre>
<p>В данном примере мы сосредоточим внимание всего лишь на трех переменных и попытаемся ответить на вопрос: &quot;Как изменяется средняя продолжительность жизни <code>lifeExp</code> со временем <code>year</code> для каждой страны <code>country</code>.</p>
<div class="sourceCode" id="cb2536"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2536-1" data-line-number="1">gapminder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2536-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, lifeExp, <span class="dt">group =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2536-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1204-1.png" width="672" /></p>
<p>Набор хоть и небольшой но тем не менее так сразу и не скажешь что тут происходит.
Один из способов заключается в том, чтобы использовать тот же подход, что и в предыдущей главе: существует один сильный сигнал (общий линейный тренд), который затрудняет наблюдение более слабых трендов.
Мы разведем эти факторы посредством построения модели с линейным трендом.
Эта модель захватит постоянный рост во времени, а остатки покажут, что остается.</p>
<p>Мы знаем как сделать это для одной страны.</p>
<div class="sourceCode" id="cb2537"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2537-1" data-line-number="1">nz &lt;-<span class="st"> </span><span class="kw">filter</span>(gapminder, country <span class="op">==</span><span class="st"> &quot;New Zealand&quot;</span>)</a>
<a class="sourceLine" id="cb2537-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2537-3" data-line-number="3">nz <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2537-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2537-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2537-6" data-line-number="6"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Full data&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1205-1.png" width="672" /></p>
<div class="sourceCode" id="cb2538"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2538-1" data-line-number="1">nz_mod &lt;-<span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span>year, <span class="dt">data =</span> nz)</a>
<a class="sourceLine" id="cb2538-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2538-3" data-line-number="3">nz <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2538-4" data-line-number="4"><span class="st">  </span><span class="kw">add_predictions</span>(nz_mod) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2538-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, pred)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2538-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2538-7" data-line-number="7"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Linear trend&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1205-2.png" width="672" /></p>
<div class="sourceCode" id="cb2539"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2539-1" data-line-number="1">nz <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2539-2" data-line-number="2"><span class="st">  </span><span class="kw">add_residuals</span>(nz_mod) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2539-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, resid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2539-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb2539-5" data-line-number="5"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Remaining pattern&quot;</span>)</a></code></pre></div>
<p><img src="r4ds-ex-sol_files/figure-html/unnamed-chunk-1205-3.png" width="672" /></p>
<p>Теперь посмотрим как строить модель для каждой страны.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.3.2.1</span> Вложенные данные</h4>
<p>Сделаем вложенные данные</p>
<div class="sourceCode" id="cb2540"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2540-1" data-line-number="1">by_country &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2540-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2540-3" data-line-number="3"><span class="st">  </span><span class="kw">nest</span>()</a>
<a class="sourceLine" id="cb2540-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2540-5" data-line-number="5">by_country</a></code></pre></div>
<pre><code>## # A tibble: 142 x 3
##    country     continent data             
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           
##  1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;
##  2 Albania     Europe    &lt;tibble [12 × 4]&gt;
##  3 Algeria     Africa    &lt;tibble [12 × 4]&gt;
##  4 Angola      Africa    &lt;tibble [12 × 4]&gt;
##  5 Argentina   Americas  &lt;tibble [12 × 4]&gt;
##  6 Australia   Oceania   &lt;tibble [12 × 4]&gt;
##  7 Austria     Europe    &lt;tibble [12 × 4]&gt;
##  8 Bahrain     Asia      &lt;tibble [12 × 4]&gt;
##  9 Bangladesh  Asia      &lt;tibble [12 × 4]&gt;
## 10 Belgium     Europe    &lt;tibble [12 × 4]&gt;
## # … with 132 more rows</code></pre>
<div class="sourceCode" id="cb2542"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2542-1" data-line-number="1">by_country &lt;-<span class="st"> </span><span class="cf">if</span> (<span class="kw">require</span>(<span class="st">&quot;gapminder&quot;</span>)) {</a>
<a class="sourceLine" id="cb2542-2" data-line-number="2">  gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2542-3" data-line-number="3"><span class="st">    </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2542-4" data-line-number="4"><span class="st">    </span><span class="kw">nest</span>()</a>
<a class="sourceLine" id="cb2542-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2542-6" data-line-number="6">  gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2542-7" data-line-number="7"><span class="st">    </span><span class="kw">nest</span>(<span class="op">-</span>country, <span class="op">-</span>continent)</a>
<a class="sourceLine" id="cb2542-8" data-line-number="8">}</a></code></pre></div>
<p>Последняя функция позволяет вложить в тиббл-фрейм ещё один тиббл-фрейм.</p>
<p>Это создает фрейм данных, который имеет одну строку на группу (на страну) и довольно необычный столбец: данные. Данные - это список фреймов данных (или, если быть точным, фрагментов данных). Это кажется сумасшедшей идеей: у нас есть фрейм данных со столбцом, который является списком других фреймов данных! Я вскоре объясню, почему я думаю, что это хорошая идея.</p>
<p>Столбец данных немного сложен, потому что это умеренно сложный список, и мы все еще работаем над хорошими инструментами для изучения этих объектов. К сожалению, использование str () не рекомендуется, так как это часто приводит к очень длинному выводу. Но если вы выделите один элемент из столбца данных, вы увидите, что он содержит все данные для этой страны (в данном случае, Афганистан).</p>
<div class="sourceCode" id="cb2543"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2543-1" data-line-number="1">by_country<span class="op">$</span>data[[<span class="dv">50</span>]]</a></code></pre></div>
<pre><code>## NULL</code></pre>
<div class="sourceCode" id="cb2545"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2545-1" data-line-number="1">by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2545-2" data-line-number="2"><span class="st">  </span><span class="kw">head</span>(<span class="dv">29</span>)</a></code></pre></div>
<p>Обратите внимание на разницу между стандартным сгруппированным кадром данных и вложенным фреймом данных: в сгруппированном фрейме данных каждая строка является наблюдением; во вложенном фрейме данных каждая строка является группой. Еще один способ думать о вложенном наборе данных - теперь у нас есть мета-наблюдение: строка, представляющая полный временной курс для страны, а не один момент времени.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.3.2.2</span> Столбцы-списки</h4>
<p>Теперь, когда у нас есть вложенный фрейм данных, мы в состоянии приспособиться к некоторым моделям. У нас есть функция подбора модели:</p>
<div class="sourceCode" id="cb2546"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2546-1" data-line-number="1">country_model &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb2546-2" data-line-number="2">  <span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span>year, <span class="dt">data =</span> df)</a>
<a class="sourceLine" id="cb2546-3" data-line-number="3">}</a></code></pre></div>
<p>И мы хотим применить его к каждому фрейму данных. Фреймы данных находятся в списке, поэтому мы можем использовать <code>purrr::map()</code>, чтобы применить <code>country_model</code> к каждому элементу:</p>
<div class="sourceCode" id="cb2547"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2547-1" data-line-number="1">models &lt;-<span class="st"> </span><span class="kw">map</span>(by_country<span class="op">$</span>data, country_model)</a></code></pre></div>
<pre><code>## Error in paste(&quot;(^&quot;, regions, &quot;)&quot;, sep = &quot;&quot;, collapse = &quot;|&quot;): cannot coerce type &#39;closure&#39; to vector of type &#39;character&#39;</code></pre>
<p>Однако вместо того, чтобы оставлять список моделей как свободно плавающий объект, я думаю, что лучше хранить его в виде столбца во фрейме данных <code>by_country</code>.
Хранение связанных объектов в столбцах является ключевой частью значения фреймов данных, и поэтому я считаю, что списочные столбцы - это хорошая идея.
В ходе работы с этими странами у нас будет много списков, в которых у нас будет один элемент на страну. Так почему бы не хранить их все вместе в одном фрейме данных?</p>
<p>Другими словами, вместо создания нового объекта в глобальной среде, мы собираемся создать новую переменную во фрейме данных <code>by_country</code>. Это работа для <code>dplyr::mutate()</code>:</p>
<div class="sourceCode" id="cb2549"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2549-1" data-line-number="1">by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2549-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map</span>(data, country_model))</a></code></pre></div>
<pre><code>## Error in paste(&quot;(^&quot;, regions, &quot;)&quot;, sep = &quot;&quot;, collapse = &quot;|&quot;): cannot coerce type &#39;closure&#39; to vector of type &#39;character&#39;</code></pre>
<div class="sourceCode" id="cb2551"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2551-1" data-line-number="1">by_country</a></code></pre></div>
<pre><code>## # A tibble: 29 x 3
##    country     continent data             
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           
##  1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;
##  2 Albania     Europe    &lt;tibble [12 × 4]&gt;
##  3 Algeria     Africa    &lt;tibble [12 × 4]&gt;
##  4 Angola      Africa    &lt;tibble [12 × 4]&gt;
##  5 Argentina   Americas  &lt;tibble [12 × 4]&gt;
##  6 Australia   Oceania   &lt;tibble [12 × 4]&gt;
##  7 Austria     Europe    &lt;tibble [12 × 4]&gt;
##  8 Bahrain     Asia      &lt;tibble [12 × 4]&gt;
##  9 Bangladesh  Asia      &lt;tibble [12 × 4]&gt;
## 10 Belgium     Europe    &lt;tibble [12 × 4]&gt;
## # … with 19 more rows</code></pre>
<p>Это имеет большое преимущество: поскольку все связанные объекты хранятся вместе, вам не нужно вручную синхронизировать их при фильтрации или упорядочивании. Семантика фрейма данных позаботится об этом за вас:</p>
<div class="sourceCode" id="cb2553"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2553-1" data-line-number="1">by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2553-2" data-line-number="2"><span class="st">  </span><span class="kw">filter</span>(continent <span class="op">==</span><span class="st"> &quot;Europe&quot;</span>)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 3
##   country                continent data             
##   &lt;fct&gt;                  &lt;fct&gt;     &lt;list&gt;           
## 1 Albania                Europe    &lt;tibble [12 × 4]&gt;
## 2 Austria                Europe    &lt;tibble [12 × 4]&gt;
## 3 Belgium                Europe    &lt;tibble [12 × 4]&gt;
## 4 Bosnia and Herzegovina Europe    &lt;tibble [12 × 4]&gt;
## 5 Bulgaria               Europe    &lt;tibble [12 × 4]&gt;</code></pre>
<div class="sourceCode" id="cb2555"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2555-1" data-line-number="1">by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2555-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(continent, country)</a></code></pre></div>
<pre><code>## # A tibble: 29 x 3
##    country                  continent data             
##    &lt;fct&gt;                    &lt;fct&gt;     &lt;list&gt;           
##  1 Algeria                  Africa    &lt;tibble [12 × 4]&gt;
##  2 Angola                   Africa    &lt;tibble [12 × 4]&gt;
##  3 Benin                    Africa    &lt;tibble [12 × 4]&gt;
##  4 Botswana                 Africa    &lt;tibble [12 × 4]&gt;
##  5 Burkina Faso             Africa    &lt;tibble [12 × 4]&gt;
##  6 Burundi                  Africa    &lt;tibble [12 × 4]&gt;
##  7 Cameroon                 Africa    &lt;tibble [12 × 4]&gt;
##  8 Central African Republic Africa    &lt;tibble [12 × 4]&gt;
##  9 Chad                     Africa    &lt;tibble [12 × 4]&gt;
## 10 Comoros                  Africa    &lt;tibble [12 × 4]&gt;
## # … with 19 more rows</code></pre>
<p>Если ваш список фреймов данных и список моделей были отдельными объектами, вы должны помнить, что всякий раз, когда вы переупорядочиваете или поднастраиваете один вектор, вы должны переупорядочивать или подгруппировать все остальные, чтобы синхронизировать их. Если вы забудете, ваш код продолжит работать, но он даст неправильный ответ!</p>
</div>
<div id="--" class="section level4">
<h4><span class="header-section-number">5.3.2.3</span> Отмена вложенния данных</h4>
<p>Вычислим остатки</p>
<div class="sourceCode" id="cb2557"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2557-1" data-line-number="1">by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2557-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2557-3" data-line-number="3">    <span class="dt">resid =</span> <span class="kw">map2</span>(data, model, add_residuals)</a>
<a class="sourceLine" id="cb2557-4" data-line-number="4">  )</a></code></pre></div>
<pre><code>## Error in map2(data, model, add_residuals): объект &#39;model&#39; не найден</code></pre>
<div class="sourceCode" id="cb2559"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2559-1" data-line-number="1">by_country</a></code></pre></div>
<pre><code>## # A tibble: 29 x 3
##    country     continent data             
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           
##  1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;
##  2 Albania     Europe    &lt;tibble [12 × 4]&gt;
##  3 Algeria     Africa    &lt;tibble [12 × 4]&gt;
##  4 Angola      Africa    &lt;tibble [12 × 4]&gt;
##  5 Argentina   Americas  &lt;tibble [12 × 4]&gt;
##  6 Australia   Oceania   &lt;tibble [12 × 4]&gt;
##  7 Austria     Europe    &lt;tibble [12 × 4]&gt;
##  8 Bahrain     Asia      &lt;tibble [12 × 4]&gt;
##  9 Bangladesh  Asia      &lt;tibble [12 × 4]&gt;
## 10 Belgium     Europe    &lt;tibble [12 × 4]&gt;
## # … with 19 more rows</code></pre>
<p>Для того чтобы нарисовать всё на одном графике разгруппируем, и приведём всё к виду обычного тиббл-фрейма</p>
<div class="sourceCode" id="cb2561"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2561-1" data-line-number="1">resids &lt;-<span class="st"> </span><span class="kw">unnest</span>(by_country, resid)</a></code></pre></div>
<pre><code>## Error: Column `resid` is of unsupported type function</code></pre>
<div class="sourceCode" id="cb2563"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2563-1" data-line-number="1">resids</a></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): объект &#39;resids&#39; не найден</code></pre>
<p>Каждый столбец повторяется один раз для каждой строки вложенного столбца.</p>
<p>Теперь, когда у нас есть обычный фрейм данных, построим график остатков</p>
<div class="sourceCode" id="cb2565"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2565-1" data-line-number="1">resids <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2565-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, resid)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2565-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2565-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## Error in eval(lhs, parent, parent): объект &#39;resids&#39; не найден</code></pre>
<p>Добавим чуть-чуть информативности — отобразим по континентам на разных панелях.</p>
<div class="sourceCode" id="cb2567"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2567-1" data-line-number="1">resids <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2567-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, resid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2567-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2567-4" data-line-number="4"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>continent)</a></code></pre></div>
<pre><code>## Error in eval(lhs, parent, parent): объект &#39;resids&#39; не найден</code></pre>
<p>Большие остатки указывают на то, что мы упустили какую-то тенденцию — наша модель работает не слишком хорошо.</p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.3.2.4</span> Качество модели</h4>
<p>Вместо анализа остатков, возникающих в модели, можно рассмотреть екоторые общие меры качества модели.
До этого мы узнали, как вычислять специализированные меры.
Здесь мы будем использовать функцию <code>broom::glance()</code> для извлечения качественных метрик модели. Применяя их к модели, мы получаем фрейм данных, состоящих из одной строки.</p>
<div class="sourceCode" id="cb2569"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2569-1" data-line-number="1">broom<span class="op">::</span><span class="kw">glance</span>(nz_mod)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC
##       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1     0.954         0.949 0.804      205. 5.41e-8     2  -13.3  32.6  34.1
## # … with 2 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;</code></pre>
<p>Создадим фрейм данных с одной строкой для каждой страны.</p>
<div class="sourceCode" id="cb2571"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2571-1" data-line-number="1">by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2571-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2571-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>(glance)</a></code></pre></div>
<pre><code>## Error in maptype(database): объект &#39;model&#39; не найден</code></pre>
<p>Это не совсем тот вывод который нужен, поскольку тут ещё есть столбцы списки.
Таково поведение по-умолчанию. Чтобы отменить это поведение нужно:</p>
<div class="sourceCode" id="cb2573"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2573-1" data-line-number="1">glance &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2573-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2573-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>(glance, <span class="dt">.drop =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Error in maptype(database): объект &#39;model&#39; не найден</code></pre>
<p>Имея в своём распоряжении новые данные, мы можем приступить к поиску неудачных моделей.</p>
<div class="sourceCode" id="cb2575"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2575-1" data-line-number="1">glance <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2575-2" data-line-number="2"><span class="st">  </span><span class="kw">arrange</span>(r.squared)</a></code></pre></div>
<pre><code>## Error in eval(lhs, parent, parent): объект &#39;glance&#39; не найден</code></pre>
<p>Визуализируем, кому больше всего принадлежат неудачные модели</p>
<div class="sourceCode" id="cb2577"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2577-1" data-line-number="1">glance <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2577-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(continent, r.squared)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2577-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.4</span>)</a></code></pre></div>
<pre><code>## Error in eval(lhs, parent, parent): объект &#39;glance&#39; не найден</code></pre>
<p>В большей степени это Африка.</p>
<p>Мы можем отфильтровать данные соответствующие странам, с особо низким коэффициентом детерминации, и отобразить из в виде графика.</p>
<div class="sourceCode" id="cb2579"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2579-1" data-line-number="1">bad_fit &lt;-<span class="st"> </span><span class="kw">filter</span>(glance, r.squared <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.25</span>)</a></code></pre></div>
<pre><code>## Error in filter(glance, r.squared &lt; 0.25): объект &#39;glance&#39; не найден</code></pre>
<div class="sourceCode" id="cb2581"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2581-1" data-line-number="1">gapminder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2581-2" data-line-number="2"><span class="st">  </span><span class="kw">semi_join</span>(bad_fit, <span class="dt">by =</span> <span class="st">&quot;country&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2581-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, lifeExp, <span class="dt">color =</span> country)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2581-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<pre><code>## Error in tbl_vars(y): объект &#39;bad_fit&#39; не найден</code></pre>
<p>Ну в моём случае это вот так. Но вообще, там стран побольше конечно.</p>
<p>Здесь видно не отчётливо. Но в оригинале выделяются два основных эффекта — эпидемия СПИД (1999-2002 годы) и геноцид в Руанде.</p>
</div>
<div id="-25.2.1" class="section level4">
<h4><span class="header-section-number">5.3.2.5</span> Упражнение 25.2.1</h4>
<div class="question">
<p>A linear trend seems to be slightly too simple for the overall trend. Can you do better with a quadratic polynomial? How can you interpret the coefficients of the quadratic? Hint you might want to transform year so that it has mean zero.)</p>
</div>
<p>Квадратичный полином мы можем добавить при помощи функции <code>poly()</code>
Преобразуем функцию <code>country_model</code> которая дана в учебнике.</p>
<div class="sourceCode" id="cb2583"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2583-1" data-line-number="1">country_model &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb2583-2" data-line-number="2">  <span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span><span class="kw">poly</span>(year <span class="op">-</span><span class="st"> </span><span class="kw">median</span>(year), <span class="dv">2</span>), <span class="dt">data =</span> df)</a>
<a class="sourceLine" id="cb2583-3" data-line-number="3">}</a>
<a class="sourceLine" id="cb2583-4" data-line-number="4"></a>
<a class="sourceLine" id="cb2583-5" data-line-number="5">by_country &lt;-<span class="st"> </span>gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2583-6" data-line-number="6"><span class="st">  </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2583-7" data-line-number="7"><span class="st">  </span><span class="kw">nest</span>()</a>
<a class="sourceLine" id="cb2583-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2583-9" data-line-number="9">by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2583-10" data-line-number="10"><span class="st">  </span><span class="kw">head</span>(<span class="dv">29</span>)</a>
<a class="sourceLine" id="cb2583-11" data-line-number="11"></a>
<a class="sourceLine" id="cb2583-12" data-line-number="12">by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2583-13" data-line-number="13"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map</span>(data, country_model))</a></code></pre></div>
<pre><code>## Error in paste(&quot;(^&quot;, regions, &quot;)&quot;, sep = &quot;&quot;, collapse = &quot;|&quot;): cannot coerce type &#39;closure&#39; to vector of type &#39;character&#39;</code></pre>
<div class="sourceCode" id="cb2585"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2585-1" data-line-number="1">by_country &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2585-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2585-3" data-line-number="3">    <span class="dt">resids =</span> <span class="kw">map2</span>(data, model, add_residuals)</a>
<a class="sourceLine" id="cb2585-4" data-line-number="4">  )</a></code></pre></div>
<pre><code>## Error in map2(data, model, add_residuals): объект &#39;model&#39; не найден</code></pre>
<div class="sourceCode" id="cb2587"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2587-1" data-line-number="1"><span class="kw">unnest</span>(by_country, resids) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2587-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, resid)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2587-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">group =</span> country), <span class="dt">alpha =</span> <span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2587-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_smooth</span>(<span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb2587-5" data-line-number="5"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>continent)</a></code></pre></div>
<pre><code>## Error: объект &#39;resids&#39; не найден</code></pre>
<div class="sourceCode" id="cb2589"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2589-1" data-line-number="1">by_country <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2589-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2589-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>(glance, <span class="dt">.drop =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2589-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(continent, r.squared)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2589-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">width =</span> <span class="fl">0.2</span>)</a></code></pre></div>
<pre><code>## Error in maptype(database): объект &#39;model&#39; не найден</code></pre>
<div class="sourceCode" id="cb2591"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2591-1" data-line-number="1">glance1 &lt;-<span class="st"> </span>by_country <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2591-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2591-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>(glance, <span class="dt">.drop =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## Error in maptype(database): объект &#39;model&#39; не найден</code></pre>
<div class="sourceCode" id="cb2593"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2593-1" data-line-number="1">glance1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(r.squared)</a></code></pre></div>
<pre><code>## Error in eval(lhs, parent, parent): объект &#39;glance1&#39; не найден</code></pre>
<p>Как видно, в моём усечённом примере, квадратный полином улучшил модель.
Показатель коэффициента детерминации уменьшился для стран Африки.</p>
</div>
<div id="-25.2.2" class="section level4">
<h4><span class="header-section-number">5.3.2.6</span> Упражнение 25.2.2</h4>
<div class="question">
<p>Explore other methods for visualizing the distribution of <span class="math inline">\(R^2\)</span> per continent. You might want to try the ggbeeswarm package, which provides similar methods for avoiding overlaps as jitter, but uses deterministic methods.</p>
</div>
<p>Вот например такой метод</p>
<div class="sourceCode" id="cb2595"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2595-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;ggbeeswarm&quot;</span>)</a>
<a class="sourceLine" id="cb2595-2" data-line-number="2">by_country <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2595-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2595-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>(glance, <span class="dt">.drop =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2595-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(continent, r.squared)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2595-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_beeswarm</span>()</a></code></pre></div>
<pre><code>## Error in maptype(database): объект &#39;model&#39; не найден</code></pre>
<p>Выглядит несколько приятнее чем <code>jitter</code></p>
<div class="sourceCode" id="cb2597"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2597-1" data-line-number="1">by_country <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2597-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2597-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>(glance, <span class="dt">.drop =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2597-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(continent, r.squared)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2597-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_quasirandom</span>()</a></code></pre></div>
<pre><code>## Error in maptype(database): объект &#39;model&#39; не найден</code></pre>
<p>А этот почти такой же <code>jitter</code></p>
</div>
<div id="-25.2.3" class="section level4">
<h4><span class="header-section-number">5.3.2.7</span> Упражнение 25.2.3</h4>
<div class="question">
<p>To create the last plot (showing the data for the countries with the worst model fits), we needed two steps: we created a data frame with one row per country and then semi-joined it to the original dataset. It’s possible to avoid this join if we use <code>unnest()</code> instead of <code>unnest(.drop = TRUE)</code>. How?</p>
</div>
<p>Для того чтобы избежать объединения, можно дважды раскрыть вложенные столбца списки.</p>
<div class="sourceCode" id="cb2599"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2599-1" data-line-number="1">gapminder <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-3" data-line-number="3"><span class="st">  </span><span class="kw">nest</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">29</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2599-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="kw">map</span>(data, <span class="op">~</span><span class="st"> </span><span class="kw">lm</span>(lifeExp <span class="op">~</span><span class="st"> </span>year, .))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">glance =</span> <span class="kw">map</span>(model, broom<span class="op">::</span>glance)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-7" data-line-number="7"><span class="st">  </span><span class="kw">unnest</span>(glance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-8" data-line-number="8"><span class="st">  </span><span class="kw">unnest</span>(data) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-9" data-line-number="9"><span class="st">  </span><span class="kw">filter</span>(r.squared <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.25</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2599-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(year, lifeExp)) <span class="op">+</span></a>
<a class="sourceLine" id="cb2599-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">color =</span> country))</a></code></pre></div>
<pre><code>## Error in map.poly(database, regions, exact, xlim, ylim, boundary, interior, : no recognized region names</code></pre>
</div>
</div>
<div id="--1" class="section level3">
<h3><span class="header-section-number">5.3.3</span> Столбцы-списки</h3>
<p>Авторы книги лишь недавно по достоинству оценили вложенные столбцы-списки.
Эта структура данных неявно фигурирует в определении фрейма данных — фрейм данных это именованный список векторов равной длинны.
Список это вектор, поэтому всегда можно было на вполне законных основаниях использовать список в качетсве столбца фрейма данных.
Однако базовые пакеты R не позволяют столе же просто создавать столбцы-списки, и функция <code>data.frame()</code> торактует список, как список столбцов.</p>
<div class="sourceCode" id="cb2601"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2601-1" data-line-number="1"><span class="kw">data.frame</span>(<span class="dt">x =</span> <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>))</a></code></pre></div>
<pre><code>##   x.1.3 x.3.5
## 1     1     3
## 2     2     4
## 3     3     5</code></pre>
<p>Такое поведение функции можно предотвратить с помощи функции <code>I()</code>, однако при этом результат выводится не в самом удобном виде</p>
<div class="sourceCode" id="cb2603"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2603-1" data-line-number="1"><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb2603-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">I</span>(<span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>)),</a>
<a class="sourceLine" id="cb2603-3" data-line-number="3">  <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;1, 2&quot;</span>, <span class="st">&quot;3, 4, 5&quot;</span>)</a>
<a class="sourceLine" id="cb2603-4" data-line-number="4">)</a></code></pre></div>
<pre><code>##         x       y
## 1 1, 2, 3    1, 2
## 2 3, 4, 5 3, 4, 5</code></pre>
<p>Тиббл фрейм позволяет сгладить эту проблему, за счёт того что он более <em>ленивый</em> (функция тиббл не изменяет свои входные данные), а так же за счёт того что предоставляет более наглядный метод печати.</p>
<div class="sourceCode" id="cb2605"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2605-1" data-line-number="1"><span class="kw">tibble</span>(</a>
<a class="sourceLine" id="cb2605-2" data-line-number="2">  <span class="dt">x =</span> <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>),</a>
<a class="sourceLine" id="cb2605-3" data-line-number="3">  <span class="dt">y =</span> <span class="kw">c</span>(<span class="st">&quot;1, 2&quot;</span>, <span class="st">&quot;3, 4, 5&quot;</span>)</a>
<a class="sourceLine" id="cb2605-4" data-line-number="4">)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   x         y      
##   &lt;list&gt;    &lt;chr&gt;  
## 1 &lt;int [3]&gt; 1, 2   
## 2 &lt;int [3]&gt; 3, 4, 5</code></pre>
<p>Но с функцией <code>tribble()</code> ещё проще работать, по той причине, что она может автоматически определить, что вам нужен список.</p>
<div class="sourceCode" id="cb2607"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2607-1" data-line-number="1"><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2607-2" data-line-number="2">  <span class="op">~</span>x, <span class="op">~</span>y,</a>
<a class="sourceLine" id="cb2607-3" data-line-number="3">  <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="st">&quot;1, 2&quot;</span>,</a>
<a class="sourceLine" id="cb2607-4" data-line-number="4">  <span class="dv">3</span><span class="op">:</span><span class="dv">5</span>, <span class="st">&quot;3, 4, 5&quot;</span></a>
<a class="sourceLine" id="cb2607-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   x         y      
##   &lt;list&gt;    &lt;chr&gt;  
## 1 &lt;int [3]&gt; 1, 2   
## 2 &lt;int [3]&gt; 3, 4, 5</code></pre>
<p>Стоит понимать, что столбцы списки наиболее полезны в качестве промежуточных структур данных. С ними тяжело работать непосредственно, поскольку большинство функцй имеют дело с атомарными векторами или фреймами данных, но возможность содержать вместе все родственные эдементы в одном фрейме данных стоит дополнительных хлопот.</p>
<p>В общем случае эффективный канал столбцов-списков состоит из трёх частей</p>
<ol style="list-style-type: decimal">
<li>ВЫ создаёте столбец-список с помощью одного из следующих вариантов nest()<code>,</code>summarise() + list()<code>,</code>mutate()<code>+ функция</code>map` как описано в разделе создания столбцов-списков.</li>
<li>Вы создаёте другие промежуточные столбцы-списки, преобразуя существующие столбцы-списки с помощью функций <code>map()</code>, <code>map2()</code> или <code>pmap()</code>. Так в предыдуущем типовом примере мы создавали столбец — список моделей путем преобразования столбца — списка фреймов данных.</li>
<li>Вы упрощаете столбец-список путем его обратного преобразования во фрейм данных или атомарный вектор, как описано в разделе упрощения столбцов-списков.</li>
</ol>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">5.3.4</span> Создание столбцов-списков</h3>
<p>Для создания используется один из трёх методов</p>
<ol style="list-style-type: decimal">
<li><code>nest()</code>. Для преобразования сгруппированного фрейма данных во вложненный фрейм, в котором вы имеете столбец — список фреймов данных.</li>
<li>с помощью <code>mutate()</code> и векторизованных функций, возвращающих список</li>
<li>с помощью <code>summarise()</code> и <code>summary()</code>, которые возвращают несколько резельтатов.</li>
</ol>
<p>Есть ещё альтернативный способ при помощи <code>tibble::enframe()</code></p>
<p>Объекты в столбцах списках должны быть однородны — каждый элемент должен содержать объекты одного и того же типа.</p>
<div id="-----" class="section level4">
<h4><span class="header-section-number">5.3.4.1</span> Создание столбцов списков на основе вложений</h4>
<p><code>nest()</code> создает вложенный фрейм данных, представляющий собой столбец-список фреймов данных. Во вложенном фрейму данных каждая строка является метанаблюдением: переменные, которые определяют наблюдение, предоставляются другими столбцами, а столбец — список фреймов данных предоставляет индивидуальные наблюдения, которые образуют метанаблюдение.</p>
<p>Можно использовать двумя способами</p>
<div class="sourceCode" id="cb2609"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2609-1" data-line-number="1">gapminder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2609-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(country, continent) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2609-3" data-line-number="3"><span class="st">  </span><span class="kw">nest</span>()</a></code></pre></div>
<pre><code>## # A tibble: 142 x 3
##    country     continent data             
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           
##  1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;
##  2 Albania     Europe    &lt;tibble [12 × 4]&gt;
##  3 Algeria     Africa    &lt;tibble [12 × 4]&gt;
##  4 Angola      Africa    &lt;tibble [12 × 4]&gt;
##  5 Argentina   Americas  &lt;tibble [12 × 4]&gt;
##  6 Australia   Oceania   &lt;tibble [12 × 4]&gt;
##  7 Austria     Europe    &lt;tibble [12 × 4]&gt;
##  8 Bahrain     Asia      &lt;tibble [12 × 4]&gt;
##  9 Bangladesh  Asia      &lt;tibble [12 × 4]&gt;
## 10 Belgium     Europe    &lt;tibble [12 × 4]&gt;
## # … with 132 more rows</code></pre>
<p>И вот так. Указываем явно, какие столбцы должны быть сгруппированы.</p>
<div class="sourceCode" id="cb2611"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2611-1" data-line-number="1">gapminder <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2611-2" data-line-number="2"><span class="st">  </span><span class="kw">nest</span>(year<span class="op">:</span>gdpPercap)</a></code></pre></div>
<pre><code>## # A tibble: 142 x 3
##    country     continent data             
##    &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           
##  1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;
##  2 Albania     Europe    &lt;tibble [12 × 4]&gt;
##  3 Algeria     Africa    &lt;tibble [12 × 4]&gt;
##  4 Angola      Africa    &lt;tibble [12 × 4]&gt;
##  5 Argentina   Americas  &lt;tibble [12 × 4]&gt;
##  6 Australia   Oceania   &lt;tibble [12 × 4]&gt;
##  7 Austria     Europe    &lt;tibble [12 × 4]&gt;
##  8 Bahrain     Asia      &lt;tibble [12 × 4]&gt;
##  9 Bangladesh  Asia      &lt;tibble [12 × 4]&gt;
## 10 Belgium     Europe    &lt;tibble [12 × 4]&gt;
## # … with 132 more rows</code></pre>
</div>
<div id="------" class="section level4">
<h4><span class="header-section-number">5.3.4.2</span> Создание столбцов списков на основе векторизованных функций</h4>
<p>Некоторые полезные функции принимают атомарный вектор и возваразают список. Например, функция <code>stringr::str_split()</code>, она принимает символьный вектор и возвращает список символьных векторов.</p>
<p>Если использовать этот подход в функции <code>mutate()</code>, то получим столбец-список</p>
<div class="sourceCode" id="cb2613"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2613-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2613-2" data-line-number="2">  <span class="op">~</span>x1,</a>
<a class="sourceLine" id="cb2613-3" data-line-number="3">  <span class="st">&quot;a,b,c&quot;</span>, </a>
<a class="sourceLine" id="cb2613-4" data-line-number="4">  <span class="st">&quot;d,e,f,g&quot;</span></a>
<a class="sourceLine" id="cb2613-5" data-line-number="5">) </a>
<a class="sourceLine" id="cb2613-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2613-7" data-line-number="7">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2613-8" data-line-number="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x2 =</span> stringr<span class="op">::</span><span class="kw">str_split</span>(x1, <span class="st">&quot;,&quot;</span>))</a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   x1      x2       
##   &lt;chr&gt;   &lt;list&gt;   
## 1 a,b,c   &lt;chr [3]&gt;
## 2 d,e,f,g &lt;chr [4]&gt;</code></pre>
<p>Функция <code>unnest()</code> знает как обрабатывать такие списки векторов.</p>
<div class="sourceCode" id="cb2615"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2615-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2615-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">x2 =</span> stringr<span class="op">::</span><span class="kw">str_split</span>(x1, <span class="st">&quot;,&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2615-3" data-line-number="3"><span class="st">  </span><span class="kw">unnest</span>()</a></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##   x1      x2   
##   &lt;chr&gt;   &lt;chr&gt;
## 1 a,b,c   a    
## 2 a,b,c   b    
## 3 a,b,c   c    
## 4 d,e,f,g d    
## 5 d,e,f,g e    
## 6 d,e,f,g f    
## 7 d,e,f,g g</code></pre>
<p>Есть полезная функция <code>tidyr::separate_rows()</code> она является обёрткой для этого полезного шаблона.</p>
<p>Альтернативный вариант этого шаблона предполагает использование функций <code>map()</code>, <code>map2()</code>, <code>pmap()</code>. Например</p>
<div class="sourceCode" id="cb2617"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2617-1" data-line-number="1">sim &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2617-2" data-line-number="2">  <span class="op">~</span>f,      <span class="op">~</span>params,</a>
<a class="sourceLine" id="cb2617-3" data-line-number="3">  <span class="st">&quot;runif&quot;</span>, <span class="kw">list</span>(<span class="dt">min =</span> <span class="dv">-1</span>, <span class="dt">max =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb2617-4" data-line-number="4">  <span class="st">&quot;rnorm&quot;</span>, <span class="kw">list</span>(<span class="dt">sd =</span> <span class="dv">5</span>),</a>
<a class="sourceLine" id="cb2617-5" data-line-number="5">  <span class="st">&quot;rpois&quot;</span>, <span class="kw">list</span>(<span class="dt">lambda =</span> <span class="dv">10</span>)</a>
<a class="sourceLine" id="cb2617-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2617-7" data-line-number="7"></a>
<a class="sourceLine" id="cb2617-8" data-line-number="8">sim <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2617-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">sims =</span> <span class="kw">invoke_map</span>(f, params, <span class="dt">n =</span> <span class="dv">10</span>))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   f     params     sims      
##   &lt;chr&gt; &lt;list&gt;     &lt;list&gt;    
## 1 runif &lt;list [2]&gt; &lt;dbl [10]&gt;
## 2 rnorm &lt;list [1]&gt; &lt;dbl [10]&gt;
## 3 rpois &lt;list [1]&gt; &lt;int [10]&gt;</code></pre>
</div>
<div id="------" class="section level4">
<h4><span class="header-section-number">5.3.4.3</span> Создание столбцов списков на основе многозначных итогов</h4>
<p>Одним из ограничений <code>summarise()</code> является то, что она работает с итоговыми функциями, возвращающими одиночное значение. Таким образом, ее нельзя использовать с функциями наподобие <code>quantile()</code> которые возвращают вектор произвольной длины.</p>
<div class="sourceCode" id="cb2619"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2619-1" data-line-number="1"><span class="co"># Ошибка</span></a>
<a class="sourceLine" id="cb2619-2" data-line-number="2">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2619-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2619-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">q =</span> <span class="kw">quantile</span>(mpg))</a></code></pre></div>
<pre><code>## Error: Column `q` must be length 1 (a summary value), not 5</code></pre>
<div class="sourceCode" id="cb2621"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2621-1" data-line-number="1"><span class="co"># &gt; Column `q` must be length 1 (a summary value), not 5</span></a></code></pre></div>
<p>Однако этот результат можно свернуть в список</p>
<div class="sourceCode" id="cb2622"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2622-1" data-line-number="1">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2622-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2622-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">q =</span> <span class="kw">list</span>(<span class="kw">quantile</span>(mpg)))</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##     cyl q        
##   &lt;dbl&gt; &lt;list&gt;   
## 1    16 &lt;dbl [5]&gt;
## 2    24 &lt;dbl [5]&gt;
## 3    32 &lt;dbl [5]&gt;</code></pre>
<p>Для получения полезных результатов с помощью <code>unnest()</code> вам так же понадобится получить вероятности</p>
<div class="sourceCode" id="cb2624"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2624-1" data-line-number="1">probs &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.99</span>)</a>
<a class="sourceLine" id="cb2624-2" data-line-number="2">mtcars <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2624-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2624-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">p =</span> <span class="kw">list</span>(probs), <span class="dt">q =</span> <span class="kw">list</span>(<span class="kw">quantile</span>(mpg, probs))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2624-5" data-line-number="5"><span class="st">  </span><span class="kw">unnest</span>()</a></code></pre></div>
<pre><code>## # A tibble: 15 x 3
##      cyl     p     q
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1    16  0.01  21.4
##  2    16  0.25  22.8
##  3    16  0.5   26  
##  4    16  0.75  30.4
##  5    16  0.99  33.8
##  6    24  0.01  17.8
##  7    24  0.25  18.6
##  8    24  0.5   19.7
##  9    24  0.75  21  
## 10    24  0.99  21.4
## 11    32  0.01  10.4
## 12    32  0.25  14.4
## 13    32  0.5   15.2
## 14    32  0.75  16.2
## 15    32  0.99  19.1</code></pre>
</div>
<div id="------" class="section level4">
<h4><span class="header-section-number">5.3.4.4</span> Создание столбцов списков на основе именнованных списков</h4>
<p>Фрейм данных со столбцами-списками обеспечивают решение одной часто встречающейся задачи:
как быть, если необходимо итерировать как по содержимому списка, так и по его элементам?
Вместо того чтобы пытаться втиснуть всё в один объект, часто гораздо легче создать фрейм данных: один столбец модет содержать элементы, а другой — список. Простой способ создания такого фрейма данных из списка предлагает функция <code>tibble::enframe()</code></p>
<div class="sourceCode" id="cb2626"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2626-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb2626-2" data-line-number="2">  <span class="dt">a =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb2626-3" data-line-number="3">  <span class="dt">b =</span> <span class="dv">3</span><span class="op">:</span><span class="dv">4</span>, </a>
<a class="sourceLine" id="cb2626-4" data-line-number="4">  <span class="dt">c =</span> <span class="dv">5</span><span class="op">:</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb2626-5" data-line-number="5">) </a>
<a class="sourceLine" id="cb2626-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2626-7" data-line-number="7">df &lt;-<span class="st"> </span><span class="kw">enframe</span>(x)</a>
<a class="sourceLine" id="cb2626-8" data-line-number="8">df</a></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  value    
##   &lt;chr&gt; &lt;list&gt;   
## 1 a     &lt;int [5]&gt;
## 2 b     &lt;int [2]&gt;
## 3 c     &lt;int [2]&gt;</code></pre>
<p>Преимущество этой структуры — она обобщается самым непосредственным образом: имена полезны, если вы имеете дело с символьным вектором метаданных, но в случае других типов данных или нескольких векторов они вам не помогут.
Теперь, если вы хотите итерировать одновременно по именам и значениям, это можно сделать с помощью <code>map2</code></p>
<div class="sourceCode" id="cb2628"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2628-1" data-line-number="1">df <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2628-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2628-3" data-line-number="3">    <span class="dt">smry =</span> <span class="kw">map2_chr</span>(name, value, <span class="op">~</span><span class="st"> </span>stringr<span class="op">::</span><span class="kw">str_c</span>(.x, <span class="st">&quot;: &quot;</span>, .y[<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb2628-4" data-line-number="4">  )</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   name  value     smry 
##   &lt;chr&gt; &lt;list&gt;    &lt;chr&gt;
## 1 a     &lt;int [5]&gt; a: 1 
## 2 b     &lt;int [2]&gt; b: 3 
## 3 c     &lt;int [2]&gt; c: 5</code></pre>
</div>
<div id="-25.4.1" class="section level4">
<h4><span class="header-section-number">5.3.4.5</span> Упражнение 25.4.1</h4>
<div class="question">
<p>List all the functions that you can think of that take a atomic vector and return a list.</p>
</div>
<p>Многие функции работы со строками принимают атомарный вектор и возвращают список</p>
<div class="sourceCode" id="cb2630"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2630-1" data-line-number="1"><span class="kw">str_split</span>(sentences[<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>], <span class="st">&quot; &quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
## [1] &quot;The&quot;     &quot;birch&quot;   &quot;canoe&quot;   &quot;slid&quot;    &quot;on&quot;      &quot;the&quot;     &quot;smooth&quot; 
## [8] &quot;planks.&quot;
## 
## [[2]]
## [1] &quot;Glue&quot;        &quot;the&quot;         &quot;sheet&quot;       &quot;to&quot;          &quot;the&quot;        
## [6] &quot;dark&quot;        &quot;blue&quot;        &quot;background.&quot;
## 
## [[3]]
## [1] &quot;It&#39;s&quot;  &quot;easy&quot;  &quot;to&quot;    &quot;tell&quot;  &quot;the&quot;   &quot;depth&quot; &quot;of&quot;    &quot;a&quot;     &quot;well.&quot;</code></pre>
<div class="sourceCode" id="cb2632"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2632-1" data-line-number="1"><span class="kw">str_match_all</span>(<span class="kw">c</span>(<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;aa&quot;</span>, <span class="st">&quot;aabaa&quot;</span>, <span class="st">&quot;abbbc&quot;</span>), <span class="st">&quot;a+&quot;</span>)</a></code></pre></div>
<pre><code>## [[1]]
##      [,1]
## [1,] &quot;a&quot; 
## 
## [[2]]
##      [,1]
## [1,] &quot;aa&quot;
## 
## [[3]]
##      [,1]
## [1,] &quot;aa&quot;
## [2,] &quot;aa&quot;
## 
## [[4]]
##      [,1]
## [1,] &quot;a&quot;</code></pre>
<p>Функции семейства <code>map()</code> выполняют похожие вещи</p>
<div class="sourceCode" id="cb2634"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2634-1" data-line-number="1"><span class="kw">map</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, runif)</a></code></pre></div>
<pre><code>## Error in paste(&quot;(^&quot;, regions, &quot;)&quot;, sep = &quot;&quot;, collapse = &quot;|&quot;): cannot coerce type &#39;closure&#39; to vector of type &#39;character&#39;</code></pre>
</div>
<div id="-25.4.2" class="section level4">
<h4><span class="header-section-number">5.3.4.6</span> Упражнение 25.4.2</h4>
<div class="question">
<p>Brainstorm useful summary functions that, like <code>quantile()</code>, return multiple values.</p>
</div>
<div class="sourceCode" id="cb2636"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2636-1" data-line-number="1"><span class="kw">range</span>(mtcars<span class="op">$</span>mpg)</a></code></pre></div>
<pre><code>## [1] 10.4 33.9</code></pre>
<div class="sourceCode" id="cb2638"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2638-1" data-line-number="1"><span class="kw">fivenum</span>(mtcars<span class="op">$</span>mpg)</a></code></pre></div>
<pre><code>## [1] 10.40 15.35 19.20 22.80 33.90</code></pre>
<div class="sourceCode" id="cb2640"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2640-1" data-line-number="1"><span class="kw">boxplot.stats</span>(mtcars<span class="op">$</span>mpg)</a></code></pre></div>
<pre><code>## $stats
## [1] 10.40 15.35 19.20 22.80 33.90
## 
## $n
## [1] 32
## 
## $conf
## [1] 17.11916 21.28084
## 
## $out
## numeric(0)</code></pre>
</div>
<div id="-25.4.3" class="section level4">
<h4><span class="header-section-number">5.3.4.7</span> Упражнение 25.4.3</h4>
<div class="question">
<p>What’s missing in the following data frame? How does quantile() return that missing piece? Why isn’t that helpful here?</p>
</div>
<div class="sourceCode" id="cb2642"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2642-1" data-line-number="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2642-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2642-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">q =</span> <span class="kw">list</span>(<span class="kw">quantile</span>(mpg))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2642-4" data-line-number="4"><span class="st">  </span><span class="kw">unnest</span>()</a></code></pre></div>
<pre><code>## # A tibble: 15 x 2
##      cyl     q
##    &lt;dbl&gt; &lt;dbl&gt;
##  1    16  21.4
##  2    16  22.8
##  3    16  26  
##  4    16  30.4
##  5    16  33.9
##  6    24  17.8
##  7    24  18.6
##  8    24  19.7
##  9    24  21  
## 10    24  21.4
## 11    32  10.4
## 12    32  14.4
## 13    32  15.2
## 14    32  16.2
## 15    32  19.2</code></pre>
<p>Не хватает конкретные значения квантилей от 0 до 1.
Функция <code>quantile()</code> возвращает их в названиях столбцов.</p>
<div class="sourceCode" id="cb2644"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2644-1" data-line-number="1"><span class="kw">quantile</span>(mtcars<span class="op">$</span>mpg)</a></code></pre></div>
<pre><code>##     0%    25%    50%    75%   100% 
## 10.400 15.425 19.200 22.800 33.900</code></pre>
<p>Поскольку функция <code>unnest()</code> отбрасывает имена векторов, они здесь бесполезны.</p>
</div>
<div id="-25.4.3-1" class="section level4">
<h4><span class="header-section-number">5.3.4.8</span> Упражнение 25.4.3</h4>
<div class="question">
<p>What does this code do? Why might might it be useful?</p>
</div>
<div class="sourceCode" id="cb2646"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2646-1" data-line-number="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2646-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2646-3" data-line-number="3"><span class="st">  </span><span class="kw">summarise_each</span>(<span class="kw">funs</span>(list))</a></code></pre></div>
<pre><code>## Warning: funs() is soft deprecated as of dplyr 0.8.0
## please use list() instead
## 
## # Before:
## funs(name = f(.)
## 
## # After: 
## list(name = ~f(.))
## This warning is displayed once per session.</code></pre>
<pre><code>## # A tibble: 3 x 11
##     cyl mpg    disp   hp     drat   wt     qsec   vs     am     gear  carb 
##   &lt;dbl&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;list&gt; &lt;lis&gt; &lt;lis&gt;
## 1    16 &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;fct … &lt;dbl… &lt;dbl…
## 2    24 &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;fct … &lt;dbl… &lt;dbl…
## 3    32 &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;dbl … &lt;fct … &lt;dbl… &lt;dbl…</code></pre>
<p>Этот код создает фрейм данных, в котором каждая строка соответствует значению цилиндров <code>group_by(cyl)</code>, а каждое наблюдение для каждого столбца (кроме <code>cyl</code>) является вектором всех значений этого столбца для этого значения цилиндров.</p>
</div>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">5.3.5</span> Упрощение столбцов-списков</h3>
<p>Чтобы применить методы манипулирования данными и визуализации, которые вы изучили в этой книге, вам нужно упростить список-столбец обратно до обычного столбца (атомарного вектора) или набора столбцов. Техника, которую вы будете использовать, чтобы вернуться к более простой структуре, зависит от того, хотите ли вы одно значение для элемента или несколько значений:</p>
<ul>
<li><p>Если вам нужно одиночное значение, используйте <code>mutate()</code> с функциями <code>map_lgl()</code>, <code>map_int()</code>, <code>map_dbl()</code> и <code>map_chr()</code> для создания атомарного вектора.</p></li>
<li><p>Если вам нужно несколько значений, используйте <code>unnest()</code>, чтобы преобразовать столбцы списка обратно в обычные столбцы, повторяя строки столько раз, сколько необходимо.</p></li>
</ul>
<p>Разберём их подробнее</p>
<div id="---" class="section level4">
<h4><span class="header-section-number">5.3.5.1</span> Преобразование списка в вектор</h4>
<p>Преобразовав свой столбец-список в атомарный выектор, вы получите обычный столбец. Например, вы всегда можете суммировать объект по типу и длине, поэтому следующий код будет работать для любого списка столбца</p>
<div class="sourceCode" id="cb2649"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2649-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2649-2" data-line-number="2">  <span class="op">~</span>x,</a>
<a class="sourceLine" id="cb2649-3" data-line-number="3">  letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>],</a>
<a class="sourceLine" id="cb2649-4" data-line-number="4">  <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb2649-5" data-line-number="5">  <span class="kw">runif</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb2649-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2649-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb2649-8" data-line-number="8">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2649-9" data-line-number="9">  <span class="dt">type =</span> <span class="kw">map_chr</span>(x, typeof),</a>
<a class="sourceLine" id="cb2649-10" data-line-number="10">  <span class="dt">length =</span> <span class="kw">map_int</span>(x, length)</a>
<a class="sourceLine" id="cb2649-11" data-line-number="11">)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##   x         type      length
##   &lt;list&gt;    &lt;chr&gt;      &lt;int&gt;
## 1 &lt;chr [5]&gt; character      5
## 2 &lt;int [3]&gt; integer        3
## 3 &lt;dbl [5]&gt; double         5</code></pre>
<p>Это та же основная информация, которую вы получаете из функции <code>print()</code> по умолчанию, но теперь вы можете использовать ее для фильтрации. Это полезный метод, если у вас есть неоднородный список, и вы хотите отфильтровать части, которые не нужны.</p>
<p>Не забывайте о сокращенных вызовах функций <code>map_*()</code> - вы можете использовать <code>map_chr(x, &quot;apple&quot;)</code>, чтобы извлечь строку, хранящуюся в <code>apple</code>, для каждого элемента <code>x</code>. Это полезно для разделения вложенных списков в обычные столбцы. Используйте аргумент <code>.null</code>, чтобы указать значение, которое будет использоваться, если элемент отсутствует (вместо возврата <code>NULL</code>):</p>
<div class="sourceCode" id="cb2651"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2651-1" data-line-number="1">df &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2651-2" data-line-number="2">  <span class="op">~</span>x,</a>
<a class="sourceLine" id="cb2651-3" data-line-number="3">  <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">1</span>, <span class="dt">b =</span> <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb2651-4" data-line-number="4">  <span class="kw">list</span>(<span class="dt">a =</span> <span class="dv">2</span>, <span class="dt">c =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb2651-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb2651-6" data-line-number="6">df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb2651-7" data-line-number="7">  <span class="dt">a =</span> <span class="kw">map_dbl</span>(x, <span class="st">&quot;a&quot;</span>),</a>
<a class="sourceLine" id="cb2651-8" data-line-number="8">  <span class="dt">b =</span> <span class="kw">map_dbl</span>(x, <span class="st">&quot;b&quot;</span>, <span class="dt">.null =</span> <span class="ot">NA_real_</span>)</a>
<a class="sourceLine" id="cb2651-9" data-line-number="9">)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##   x              a     b
##   &lt;list&gt;     &lt;dbl&gt; &lt;dbl&gt;
## 1 &lt;list [2]&gt;     1     2
## 2 &lt;list [2]&gt;     2    NA</code></pre>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">5.3.5.2</span> Отмена вложения</h4>
<p>Функция <code>unnest()</code> работает, повторяя обычные столбцы один раз для каждого элемента списка-столбца. Например, в следующем очень простом примере мы повторяем первую строку 4 раза (потому что там первый элемент y имеет длину четыре), а вторую строку один раз:</p>
<div class="sourceCode" id="cb2653"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2653-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">y =</span> <span class="kw">list</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(y)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##       x     y
##   &lt;int&gt; &lt;dbl&gt;
## 1     1     1
## 2     1     2
## 3     1     3
## 4     1     4
## 5     2     1</code></pre>
<p>Это означает, что вы не можете одновременно удалить два столбца, которые содержат разное количество элементов:</p>
<div class="sourceCode" id="cb2655"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2655-1" data-line-number="1"><span class="co"># работает, поскольку y и z содержат одинаковое кол-во элементов</span></a>
<a class="sourceLine" id="cb2655-2" data-line-number="2"><span class="co"># в каждой строке</span></a>
<a class="sourceLine" id="cb2655-3" data-line-number="3">df1 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2655-4" data-line-number="4">  <span class="op">~</span>x, <span class="op">~</span>y,           <span class="op">~</span>z,</a>
<a class="sourceLine" id="cb2655-5" data-line-number="5">   <span class="dv">1</span>, <span class="kw">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb2655-6" data-line-number="6">   <span class="dv">2</span>, <span class="st">&quot;c&quot;</span>,           <span class="dv">3</span></a>
<a class="sourceLine" id="cb2655-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb2655-8" data-line-number="8">df1</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       x y         z        
##   &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
## 1     1 &lt;chr [2]&gt; &lt;int [2]&gt;
## 2     2 &lt;chr [1]&gt; &lt;dbl [1]&gt;</code></pre>
<div class="sourceCode" id="cb2657"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2657-1" data-line-number="1">df1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">unnest</span>(y, z)</a></code></pre></div>
<pre><code>## # A tibble: 3 x 3
##       x y         z
##   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
## 1     1 a         1
## 2     1 b         2
## 3     2 c         3</code></pre>
<div class="sourceCode" id="cb2659"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2659-1" data-line-number="1"><span class="co"># Не работает, поскольку y и z имеют разное кол-во элементов</span></a>
<a class="sourceLine" id="cb2659-2" data-line-number="2">df2 &lt;-<span class="st"> </span><span class="kw">tribble</span>(</a>
<a class="sourceLine" id="cb2659-3" data-line-number="3">  <span class="op">~</span>x, <span class="op">~</span>y,           <span class="op">~</span>z,</a>
<a class="sourceLine" id="cb2659-4" data-line-number="4">   <span class="dv">1</span>, <span class="st">&quot;a&quot;</span>,         <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>,  </a>
<a class="sourceLine" id="cb2659-5" data-line-number="5">   <span class="dv">2</span>, <span class="kw">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),   <span class="dv">3</span></a>
<a class="sourceLine" id="cb2659-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb2659-7" data-line-number="7">df2</a></code></pre></div>
<pre><code>## # A tibble: 2 x 3
##       x y         z        
##   &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   
## 1     1 &lt;chr [1]&gt; &lt;int [2]&gt;
## 2     2 &lt;chr [2]&gt; &lt;dbl [1]&gt;</code></pre>
<div class="sourceCode" id="cb2661"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2661-1" data-line-number="1"><span class="co"># df2 %&gt;% unnest(y, z) </span></a></code></pre></div>
<p>Тот же принцип применяется при развертывании списка-столбцов фреймов данных. Вы можете отложить несколько списочных столбцов, если все фреймы данных в каждой строке имеют одинаковое количество строк.</p>
</div>
<div id="-25.5.1" class="section level4">
<h4><span class="header-section-number">5.3.5.3</span> Упражнение 25.5.1</h4>
<div class="question">
<p>Why might the <code>lengths()</code> function be useful for creating atomic vector columns from list-columns?</p>
</div>
<p>Функция <code>lengths()</code> возвращает длину каждого элемента в списке. Это может быть полезно для проверки, имеют ли все элементы в столбце списка одинаковую длину. Вы можете получить максимальную длину, чтобы определить, сколько атомных векторных столбцов создать. Это также замена для чего-то вроде <code>map_int(x, length)</code> или <code>sapply(x, length)</code>.</p>
</div>
<div id="-25.5.2" class="section level4">
<h4><span class="header-section-number">5.3.5.4</span> Упражнение 25.5.2</h4>
<div class="question">
<p>ist the most common types of vector found in a data frame. What makes lists different?</p>
</div>
<p>Частовстречающиеся вектора это</p>
<ul>
<li><p><code>logical</code></p></li>
<li><p><code>numeric</code></p></li>
<li><p><code>integer</code></p></li>
<li><p><code>character</code></p></li>
<li><p><code>factor</code></p></li>
</ul>
<p>Все распространенные типы векторов во фремйах данных являются атомарными. Списки не являются атомарными, поскольку они могут содержать другие списки и другие векторы.</p>
</div>
</div>
<div id="--------broom" class="section level3">
<h3><span class="header-section-number">5.3.6</span> Приведение данных к аккуратной форме при помоще пакета <code>broom</code></h3>
<p>Пакет <code>broom</code> предоставляет три основных инструмента для превращения моделей в аккуратные фреймы данных:</p>
<ul>
<li><p><code>broom::glance(model)</code> возвращает строку для каждой модели. В каждом столбце дается сводка модели: либо показатель качества модели, либо сложность, либо их комбинация.</p></li>
<li><p><code>broom::tidy(model)</code> возвращает строку для каждого коэффициента в модели. Каждый столбец содержит информацию об оценке или ее изменчивости.</p></li>
<li><p><code>broom::augment(модель, данные)</code> возвращает строку для каждой строки в данных, добавляя дополнительные значения, такие как невязки, и влияет на статистику.</p></li>
</ul>
<!--chapter:end:20_purrr_and_broom.Rmd-->
</div>
</div>
</div>
<div class="section level1">
<h1><span class="header-section-number">6</span> Коммуникация</h1>
<div id="--r-markdown" class="section level2">
<h2><span class="header-section-number">6.1</span> Язык разметки R Markdown</h2>
<div id="-19" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Введение</h3>
<p>Не буду копипастить эту главу книги, в оригинале всё довольно подробно и понятно описано.</p>
<!--chapter:end:21_communication.Rmd-->
</div>
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
