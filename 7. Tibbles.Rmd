---
output: html_document
editor_options: 
  chunk_output_type: console
---

# Подготовка данных

В этой части я узнаю о подготовке данных --- искусстве приведения исходных данных к виде, обеспечивающему возможность их визуализации и моделировании в среде R.

Без подготовки нельзя работать с данными. Это огромный пласт, который необходимо освоить

## Создание tibble-фреймов с помощью пакета `tibble`

### Введение
На протяжении всей книги, мы будем работать не с традиционными фреймами данных R (`data.frame`), а с так называемыми tibble-фреймами.

Так как R старенький язык, в нём многое устарело, но чтобы революционно что-то менять нужно потрать много времени, поэтому большая часть полезных функций реализуется пакетами. Это касается и фреймов данных, встроенный стандартный `data.frame` как говорят, не всегда удобный. Поэто при помощи пакета `tibble` реализовали возможность работать с упрощённой формой фреймов данных.

Получить более подробную информацию можно по команде `vignette("tibble")`

#### Необходимые ресурсы

Пакет `tibble` является частью ядра библиотеки `tidyverse`.

```{r}
library("tidyverse")
library("viridis")
library("forcats")
library("nycflights13")
library("Lahman")
library("dplyr")
```

### Создание tibble-фреймов 

Многие пакеты на выходе создают стандартный `data.frame`, частенько нужно будет приводить такие данные к виду тиббл. Это можно делать при помощи функции `as_tibble()`

```{r}
as_tibble(iris)
```

Можно создавать тиббл формат самому при помощи функции `tibble()`

```{r}
tibble(
  x = 1:5,
  y = 1,
  z = x ^ 2 + y
)
```

Тиббл не изменяет тип входных данных, не преобразует строки в факторы, не изменяет имена переменных и не создаёт имена строк.

Можно создавать  "несистемные" имена столбцов --- начинать с символов, пробелов, знаков.

```{r}
(tb <- tibble(
  `:)` = "smile", 
  ` ` = "space",
  `2000` = "number"
)) 
```

Чтобы задать непростое имя, следует, как видно выше, воспользоваться обратными апострофами. Точно такими же, которые открывают/закрывают чанк. 

Еще один способ задавать тиббл-фреймы. Пока не понятно зачем, но можно задавать следующим образом

```{r}
tribble(
  ~x, ~y, ~z,
  #--|--|----
  "a", 2, 3.6,
  "b", 1, 8.5
)
```

### Сравнение tibble-фреймов с фреймами `data.frame`

Различия двух типов касаются двух, описанных ниже операций

#### Вывод на печать

Tibble-фреймы спроектированы таким образом, чтобы случайно не перезагрузить консоль выводом данных. Они выводят на экран первые десять строк таблицы и столько столбцов, сколько поместится на экран. Это великое благо.

```{r}
tibble(
  a = lubridate::now() + runif(1e3) * 86400,
  b = lubridate::today() + runif(1e3) * 30,
  c = 1:1e3,
  d = runif(1e3),
  e = sample(letters, 1e3, replace = TRUE)
)
```

Полезной фичей иногда бывает указать напрямую сколько нужно отображать строк.

```{r}
nycflights13::flights %>% 
  print(n = 10, width = Inf) # Параметр width = Inf указывает что выводить нужно все столбцы
```

КРоме того можно управлять поведением при печати заданным по умолчанию, с помощью группы настроек `options`

* `options(tibble.print_max = n, tibble.print_min = m)`: если количество строк больше `m` вывести на печать лишь `n` строк. Чтобы всегда отображались все строки, используй вариант `ooptions(dplyr.print_min = Inf)`

* Чтобы всегда выводить на печать все столбцы, независимо от ширины экрана, используй `options(tibble.width = Inf)

полный список возможных опций `packege?tibble`.

МОжно воспользоваться встроенным средством просмотра

```{r}
nycflights13::flights %>% 
  View()
```

#### Извлечение поднаборов
